(()=>{var Sj=Object.defineProperty;var Nj=(r,e,t)=>e in r?Sj(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var lS=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var X=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var hg=(r,e,t)=>(Nj(r,typeof e!="symbol"?e+"":e,t),t);var Lu=X((Pst,fS)=>{var Tj=new Function(`
  try {
    return this === window
  } catch(e) {}

  try {
    return typeof importScripts !== "undefined"
  } catch(e) {}

  return false
`),pg=class extends Error{constructor(e){Tj()?super(e):super(`

\x1B[31m`+e+`
\x1B[0m`)}};fS.exports=pg});var We=X((Mst,hS)=>{var Ej=Lu();hS.exports=function(r,e){if(!r)throw new Ej(e)}});var yt=X((Bst,pS)=>{function Ij(r){return r===null||typeof r>"u"}pS.exports=Ij});var vS=X((Lst,dS)=>{dS.exports=[Array,ArrayBuffer,BigInt64Array,BigUint64Array,Float32Array,Float64Array,Int16Array,Int32Array,Int8Array,Uint16Array,Uint32Array,Uint8Array,Uint8ClampedArray]});var Ke=X((zst,gS)=>{var Cj=yt(),mS=vS(),Aj=mS.map(r=>r.name);function Dj(r){try{return r instanceof Array?!0:Cj(r.constructor)?!1:mS.indexOf(r.constructor)>-1||Aj.indexOf(r.constructor.name)>-1}catch{return!1}}gS.exports=Dj});var lt=X(($st,yS)=>{function _j(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/dataframe")}catch{return!1}}yS.exports=_j});var Cn=X((Wst,bS)=>{function Fj(r){return typeof r=="function"}bS.exports=Fj});var rt=X((qst,wS)=>{function Rj(r){return typeof r=="number"&&!isNaN(r)}wS.exports=Rj});var So=X((Ust,xS)=>{var Oj=Ke(),Pj=yt();function Mj(r){return typeof r=="object"&&!Pj(r)&&!Oj(r)}xS.exports=Mj});var ut=X((Vst,kS)=>{function Bj(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/series")}catch{return!1}}kS.exports=Bj});var Tl=X((Gst,TS)=>{var Lj=We(),SS=Ke(),zj=lt(),$j=Cn(),dg=rt(),NS=So(),Wj=ut();function vg(r,e){if(zj(r)){let i=vg(r.values,e);return i.length>0&&dg(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i.length>1&&dg(i[1])&&i[1]>=0&&i[1]<r.columns.length&&(i[1]=r.columns[i[1]]),i}if(Wj(r)){let i=vg(r.values,e);return i.length>0&&dg(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i}if(Lj(NS(r)||SS(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `indexOf` function!"),!$j(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(NS(i)){s.push(i);let u=Object.keys(i).concat(Object.getOwnPropertySymbols(i));for(let c=0;c<u.length;c++){let l=u[c],f=i[l];if(o(f))return[l];let h=t(f,o,s);if(h&&h.length>0)return[l].concat(h)}}else if(SS(i)){s.push(i);for(let u=0;u<i.length;u++){let c=i[u];if(o(c))return[u];let l=t(c,o,s);if(l&&l.length>0)return[u].concat(l)}}else if(o(i))return[];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}TS.exports=vg});var ji=X((Hst,AS)=>{var qj=Tl(),ES=Ke(),IS=lt(),CS=ut();function El(r){function e(t){if(typeof t=="object"){if(t===null)return null;if(ES(t))return t instanceof Array?t.map(a=>El(a)):t.slice();if(CS(t)){let a=t.copy();return a.values=El(a.values),a}if(IS(t)){let a=t.copy();return a.values=El(t.values),a}if(t instanceof Date)return new Date(t.getTime());t=mg(t);let n={};return Object.keys(t).concat(Object.getOwnPropertySymbols(t)).forEach(a=>{n[a]=El(t[a])}),n}else return t}return e(mg(r))}function mg(r){function e(a,i,o){if(i=i||[],o=o||"",i.indexOf(a)>-1){let s=o.split("/").slice(o.startsWith("/")?1:0);if(s.some((c,l)=>{let f=s.slice(0,s.length-l-1),h=t;return f.forEach(p=>{h=h[p]}),h===a}))return`<reference to "${t===a?"/":"/"+qj(t,a).join("/")}">`}return typeof a=="object"?a===null?null:(i.push(a),ES(a)?typeof a.constructor<"u"&&a.constructor.name!=="Array"?a.slice():a.map((s,u)=>e(s,i,o+"/"+u)):(Object.keys(a).concat(Object.getOwnPropertySymbols(a)).forEach(s=>{a[s]=e(a[s],i,o+"/"+s.toString())}),a)):a}let t=r,n=e(t);if(IS(r)){let a=r.copy();a._values=n.values,a._columns=n.columns,a._index=n.index,n=a}if(CS(r)){let a=r.copy();a.name=n.name,a._values=n.values,a._index=n.index,n=a}return n}AS.exports={copy:El,decycle:mg}});var gr=X((Kst,FS)=>{var Uj=We(),DS=Ke(),Vj=lt(),Gj=ut();function _S(r){if(Vj(r)||Gj(r))return _S(r.values);Uj(DS(r),"The `flatten` function only works on arrays, Series, and DataFrames!");function e(t){let n=[];return t.forEach(a=>{DS(a)?n=n.concat(e(a)):n.push(a)}),n}return e(r)}FS.exports=_S});var Il=X((jst,RS)=>{function Hj(r){return r instanceof Date&&r.toString()!=="Invalid Date"}RS.exports=Hj});var ii=X((Xst,MS)=>{var{decycle:OS}=ji(),PS=Ke(),gg=Il();function Kj(r,e){function t(n,a){let i=typeof n;if(i!==typeof a)return!1;if(i==="undefined")return!0;if(i==="boolean"||i==="symbol")return n===a;if(i==="number"||i==="bigint")return n.toString()==="NaN"&&a.toString()==="NaN"?!0:n===a;if(i==="string"||i==="function")return n===a;if(i==="object"){if(n===null||a===null)return n===null&&a===null;{if(gg(n))return gg(a)?n.getTime()===a.getTime():!1;if(gg(a))return!1;if(n instanceof RegExp&&a instanceof RegExp)return n.toString()===a.toString();if(PS(n)!==PS(a))return!1;let s=Object.keys(n).concat(Object.getOwnPropertySymbols(n)),u=Object.keys(a).concat(Object.getOwnPropertySymbols(a));if(s.length!==u.length)return!1;for(let c=0;c<s.length;c++){let l=s[c];if(!t(n[l],a[l]))return!1}return!0}}}try{return t(r,e)}catch{return t(OS(r),OS(e))}}MS.exports=Kj});var Ca=X((Yst,$S)=>{var jj=We(),Xj=gr(),Yj=Ke(),BS=lt(),Zj=Cn(),LS=ut(),Jj=yt();function Cl(r){let e="abcdefg1234567890",t="";for(;t.length<r;)t+=e[parseInt(Math.random()*e.length)];return t}var Qj=Cl(256),e8=Cl(256),t8=Cl(256),r8=Cl(256),n8=Cl(256);function zS(r){if(BS(r)||LS(r))return zS(r.values);jj(Yj(r),"The `set` function only works on arrays, Series, and DataFrames!");let e=[],t={};return Xj(r).forEach(n=>{let a=typeof n=="object"&&n===null?Qj:Jj(n)?e8:Zj(n)?n.toString():typeof n=="symbol"?n.toString()+" - "+n8:n===1/0?t8:n===-1/0?r8:BS(n)?n.toJSONString():LS(n)?JSON.stringify(n.toObject()):JSON.stringify(n);t[a]||e.push(n),t[a]=!0}),e}$S.exports=zS});var Al=X((Zst,US)=>{var a8=We(),yg=gr(),WS=Ke(),i8=lt(),qS=ii(),o8=Cn(),s8=ut(),u8=Ca();function ap(r,e){if(i8(r)||s8(r))return arguments.length>1?ap(r.values,e):ap(r.values,r.values);if(a8(WS(r),"The first argument to the `count` function must be an array, Series, or DataFrame!"),o8(e))return yg(r).filter(t=>e(t)).length;if(WS(e)){let t=yg(r);return u8(e).map(n=>({value:n,count:t.filter(a=>qS(a,n)).length}))}else return arguments.length>1?yg(r).filter(t=>qS(t,e)).length:ap(r,r)}US.exports=ap});var Dl=X((Jst,GS)=>{var c8=We(),VS=Ke(),l8=lt(),f8=ut();function bg(r){if(l8(r)||f8(r))return bg(r.values);c8(VS(r),"The `isJagged` function only works on arrays, Series, and DataFrames!");let e=0,t=null;for(let n=0;n<r.length;n++)if(VS(r[n])){if(e++,bg(r[n]))return!0;if(t===null)t=r[n].length;else if(r[n].length!==t)return!0}return e>0&&e<r.length}GS.exports=bg});var ip=X((Qst,jS)=>{var h8=We(),HS=Ke(),p8=lt(),d8=ut();function KS(r){if(p8(r)||d8(r))return KS(r.values);h8(HS(r),"The `isNested` function only works on arrays, Series, and DataFrames!");for(let e=0;e<r.length;e++)if(HS(r[e]))return!0;return!1}jS.exports=KS});var No=X((eut,YS)=>{var bs=We(),v8=Ke(),m8=ip(),g8=rt(),y8=yt(),zu="You must pass a natural number or a one-dimensional array of natural numbers into the `ndarray` function!";function XS(r){bs(!y8(r),zu),v8(r)||(r=[r]),bs(!m8(r),zu),bs(r.length>0,zu);let e=r[0];if(bs(g8(e),zu),bs(parseInt(e)===e,zu),bs(e>=0,zu),bs(e!==1/0,"We can't create an array containing an infinite number of values!"),r.length===1){let t=[];for(let n=0;n<e;n++)t.push(void 0);return t}else{let t=[];for(let n=0;n<e;n++)t.push(XS(r.slice(1)));return t}}YS.exports=XS});var _l=X((tut,ZS)=>{var b8=We(),w8=Ke(),x8=lt(),k8=ut();function wg(r){if(x8(r)||k8(r)){let t=r.copy();return t.values=wg(t.values),t.index=wg(t.index),t}b8(w8(r),"The `reverse` function only works on arrays, Series, and DataFrames!");let e=[];for(let t=r.length-1;t>=0;t--)e.push(r[t]);return e}ZS.exports=wg});var pa=X((rut,JS)=>{var xg=We(),kg=rt(),Sg=yt(),S8=_l();function N8(r,e,t=1){xg(!Sg(r)&&!Sg(e)&&!Sg(t),"You must pass two numbers and optionally a step value to the `range` function!"),xg(kg(r)&&kg(e)&&kg(t),"You must pass two numbers and optionally a step value to the `range` function!"),xg(t>0,"The step value must be greater than 0! (NOTE: The step value is a magnitude; it does not indicate direction.)");let n=!1;if(r>e){n=!0;let i=r;r=e+t,e=i+t}let a=[];for(let i=r;i<e;i+=t)a.push(i);return n&&(a=S8(a)),a}JS.exports=N8});var sr=X((nut,rN)=>{var T8=We(),QS=Ke(),E8=lt(),I8=ii(),C8=ut(),A8=yt();function eN(r){if(!QS(r))return;let e=[r.length],t=0,n=r.map(a=>{let i=eN(a);return A8(i)?i:(t++,i.length===1?i[0]:i)});return t>0?t===r.length&&n.slice(0,-1).every((i,o)=>I8(i,n[o+1]))?e.concat(n[0]):(e.push(n),e):e}function tN(r){return E8(r)||C8(r)?tN(r.values):(T8(QS(r),"The `shape` function only works on arrays, Series, and DataFrames!"),eN(r))}rN.exports=tN});var uN=X((aut,sN)=>{var nN=We(),D8=Ke(),_8=lt(),F8=Dl(),R8=ut(),O8=yt(),aN=Lu(),op=No(),iN=pa(),P8=Ca(),M8=sr();function oN(r,e,t){if(O8(t)&&(t=0),nN(t===0||t===1||t==="vertical"||t==="horizontal",'The only valid axis values for use when appending data to a DataFrame are 0, 1, "vertical", and "horizontal". Note that 0 == "horizontal" and 1 == "vertical".'),D8(e)){nN(!F8(e),"The array of data you're trying to append to this DataFrame is jagged!");let n=M8(e);if(n.length===1)if(t===0){let a=r.copy();a._values.push(e);let i=Math.max(r.shape[1],n[0]);for(a._values.forEach(o=>{for(;o.length<i;)o.push(void 0)});a._index.length<a._values.length;)a._index.push("row"+a._index.length);for(;a._columns.length<i;)a._columns.push("col"+a._columns.length);return a}else{let a=Math.max(r.shape[0],n[0]),i=r.copy();for(iN(0,a).forEach(o=>{o>=i._values.length&&i._values.push(op(r.shape[1])),i._values[o].push(e[o])});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<i._values[0].length;)i._columns.push("col"+i._columns.length);return i}else if(n.length===2)if(t===0){let a=Math.max(...e.map(o=>o.length).concat([r.shape[1]])),i=r.copy();for(i._values=i._values.concat(e).map(o=>{for(;o.length<a;)o.push(void 0);return o});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<a;)i._columns.push("col"+i._columns.length);return i}else{let a=Math.max(...e.map(s=>s.length))+r.shape[1],i=Math.max(r.shape[0],n[0]),o=r.copy();for(iN(0,i).forEach(s=>{for(s>=o._values.length&&o._values.push(op(r.shape[1])),o._values[s]=o._values[s].concat(e[s]);o._values[s].length<a;)o._values[s].push(void 0)});o._index.length<o._values.length;)o._index.push("row"+o._index.length);for(;o._columns.length<a;)o._columns.push("col"+o._columns.length);return o}else throw new aN("Only 1- and 2-dimensional arrays can be appended to a DataFrame!")}else if(R8(e)){let n=oN(r,e.values,t);return t===0?n.index[n.index.length-1]=n.index.indexOf(e.name)>-1?e.name+" (2)":e.name:n.columns[n.columns.length-1]=n.columns.indexOf(e.name)>-1?e.name+" (2)":e.name,n}else if(_8(e))if(t===0){let n=r.copy(),a=P8(n._columns.concat(e._columns)).length;for(n._values.forEach(i=>{for(;i.length<a;)i.push(void 0)}),e.apply(i=>{let o=i.copy(),s=[];n._columns.forEach(u=>{let c=o._index.indexOf(u);c>-1?(s.push(o._values[c]),o._values.splice(c,1),o._index.splice(c,1)):s.push(void 0)}),n._values.push(s.concat(o._values))},1),n._columns=n._columns.concat(e._columns.filter(i=>n._columns.indexOf(i)<0));n._index.length<n._values.length;){let i="row"+n._index.length;n._index.push(i+(r._index.indexOf(i)>-1?" (2)":""))}return n}else{let n=r.copy();return n._index.forEach((a,i)=>{let o=e._index.indexOf(a);o>-1?n._values[i]=n._values[i].concat(e._values[o]):n._values[i]=n._values[i].concat(op(e.shape[1]))}),e._index.forEach((a,i)=>{n._index.indexOf(a)<0&&(n._index.push(a),n._values.push(op(n._columns.length).concat(e._values[i])))}),n._columns=n._columns.concat(e._columns.map(a=>a+(n._columns.indexOf(a)>-1?" (2)":""))),n}else throw new aN("Only 1- or 2-dimensional arrays, Series, and DataFrames can be appended to a DataFrame!")}sN.exports=oN});var pN=X((iut,hN)=>{var cN=We(),lN=Ke(),B8=Cn(),fN=yt();function L8(r,e,t,n,a){if(a=a||0,cN(B8(n),"The first parameter to the `apply` method must be a function."),cN(a===0||a===1,"The second parameter to the `apply` method (the `axis`) must be 0 or 1."),a===0){let i={},o;if(t.columns.forEach((s,u)=>{let c=new e(t.values.map(f=>f[u]));c.name=s,c.index=t.index;let l=n(c,u,t);l instanceof e?i[s]=l.values:i[s]=l,fN(o)&&(o=l instanceof e||lN(l))}),o){let s=new r(i);return s.index=t.index,s}else{let s=new e(t.columns.map(u=>i[u]));return s.index=t.columns,s}}else if(a===1){let i,o=t.values.map((s,u)=>{let c=new e(s);c.name=t.index[u],c.index=t.columns;let l=n(c,u,t);return fN(i)&&(i=l instanceof e||lN(l)),l instanceof e?l.values:l});if(i){let s=new r(o);return s.index=t.index,s.columns=t.columns,s}else{let s=new e(o);return s.index=t.index,s}}}hN.exports=L8});var qn=X((out,dN)=>{function z8(r){return typeof r=="string"}dN.exports=z8});var gN=X((sut,mN)=>{var vN=We(),$8=Ke(),W8=Dl(),q8=So(),U8=qn(),V8=yt(),G8=Lu(),H8=sr();function K8(r,e,t,n,a){let i=s=>s instanceof r,o=s=>s instanceof e;if(V8(a)){if(i(n))return t.append(n,1);if(o(n))return t.append(n,1);if(q8(n)){let s=Math.max(...Object.keys(n).concat(Object.getOwnPropertySymbols(n)).map(u=>n[u].length));return Object.keys(n).concat(Object.getOwnPropertySymbols(n)).forEach(u=>{for(;n[u].length<s;)n[u].push(void 0)}),t.append(new r(n),1)}else throw new G8("You must pass a DataFrame, Series, or object into the `assign` method!")}else{vN(U8(n),"If passing two arguments into the `assign` method, then the first argument must be a string name!"),vN($8(a)&&!W8(a)&&H8(a).length===1,"If passing two arguments into the `assign` method, then the second argument must be a 1-dimensional array!");let s=t.append(a,1);return s.columns[s.columns.length-1]=n,s}}mN.exports=K8});var bN=X((uut,yN)=>{var{copy:j8}=ji();function X8(r,e){if(e.isEmpty)return new r;let t=new r(j8(e.values));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}yN.exports=X8});var EN=X((cut,TN)=>{var sp=We(),wN=Ke(),xN=rt(),kN=qn(),SN=yt(),NN=sr();function Y8(r,e,t,n,a){SN(n)&&(n=[]),SN(a)&&(a=[]),(kN(n)||xN(n))&&(n=[n]),(kN(a)||xN(a))&&(a=[a]),sp(wN(n),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),sp(wN(a),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),sp(NN(n).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),sp(NN(a).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings.");let i,o;t.index.forEach((u,c)=>{n.indexOf(u)<0&&n.indexOf(c)<0&&(i||(i=[]),i.push(u))}),t.columns.forEach((u,c)=>{a.indexOf(u)<0&&a.indexOf(c)<0&&(o||(o=[]),o.push(u))});let s=t.get(i,o);if(s instanceof e){let u=new r;u=u.assign(s),t.index.indexOf(s.name)>-1&&(u=u.transpose()),s=u}return s}TN.exports=Y8});var Fl=X((lut,IN)=>{var Z8=rt();function J8(r){return Z8(r)&&parseInt(r)===r}function Q8(r){return J8(r)&&r>=0}IN.exports=Q8});var AN=X((fut,CN)=>{var Ng=We(),e7=qn(),up=yt(),t7=Fl(),r7=sr();function n7(r,e,t,n,a,i){n=n||0,Ng(n===0||n===1,"The first parameter of the `dropMissing` method (the `axis`) must be 0 or 1."),i=i||0,Ng(t7(i),"The third parameter of the `dropMissing` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` null values)."),a=i>0?"none":a||"any",Ng(a==="any"||a==="all"||a==="none","The second parameter of the `dropMissing` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains null values, then it should be dropped; or that if 'all' of the data contains null values, then it should be dropped).");function o(c){if(i>0){let l=0;for(let f=0;f<c.length;f++){let h=c[f];if(up(h)&&l++,l>=i)return[]}}else if(a==="any")for(let l=0;l<c.length;l++){let f=c[l];if(up(f))return[]}else if(a==="all"){for(let l=0;l<c.length;l++){let f=c[l];if(!up(f))return c}return[]}return c}let s=t.copy(),u=Math.random().toString();if(n===0){s=s.assign(u,s.index);let c=s.values.map(o).filter(f=>f.length>0);if(r7(c).length<2)return new r;s.values=c;let l=s.get(null,u);if(up(l))return new r;e7(l)&&(l=[l]),l instanceof e&&(l=l.values),s.index=l,s=s.drop(null,u)}else if(n===1){let c={};if(s.columns.forEach((f,h)=>{let p=s.values.map(m=>m[h]),d=o(p);d.length>0&&(c[f]=d)}),Object.keys(c).length+Object.getOwnPropertySymbols(c).length===0)return new r;let l=new r(c);return l.index=s.index,l}return s}CN.exports=n7});var Tg=X((hut,_N)=>{var a7=We(),i7=Ke(),o7=lt(),s7=rt(),u7=ut();function DN(r){if(o7(r)||u7(r))return r.dropNaN(...Object.values(arguments).slice(1));a7(i7(r),"The `dropNaN` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(DN(t))}catch{if(s7(t))return e.push(t)}}),e}_N.exports=DN});var RN=X((put,FN)=>{var Eg=We(),c7=Tg(),l7=Fl();function f7(r,e,t,n,a){t=t||0,Eg(t===0||t===1,"The first parameter of the `dropNaN` method (the `axis`) must be 0 or 1."),a=a||0,Eg(l7(a),"The third parameter of the `dropNaN` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` NaN values)."),n=a>0?"none":n||"any",Eg(n==="any"||n==="all"||n==="none","The second parameter of the `dropNaN` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains NaN values, then it should be dropped; or that if 'all' of the data contains NaN values, then it should be dropped).");function i(s){let u=c7(s);return a>0?s.length-u.length<a:n==="any"?u.length===s.length:n==="all"?u.length>0:!0}let o=e.copy();if(t===0){let s=o.index.filter(u=>{let c=o.get(u,null).values;return i(c)});return s.length>0?o.get(s,null):new r}else if(t===1){let s=o.columns.filter(u=>{let c=o.get(null,u).values;return i(c)});return s.length>0?o.get(null,s):new r}return o}FN.exports=f7});var BN=X((dut,MN)=>{var ON=We(),Rl=gr(),h7=Cn(),p7=yt();function PN(r){let e={};return Rl(r).forEach((t,n)=>{e[t]=n}),e}function $u(r){return Object.keys(r).concat(Object.getOwnPropertySymbols(r)).sort((e,t)=>r[e]-r[t])}function d7(r,e,t,n,a){ON(h7(n),"The `filter` method takes a single parameter: a function that is used to filter the values."),p7(a)&&(a=0),ON(a===0||a===1,"The `axis` parameter to the `filter` method must be 0 or 1.");let i=t.copy();if(i.isEmpty)return i;let o=PN(i.index),s=PN(i.columns);if(a===0){let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.index[l],f.index=t.columns;let h=n(f,l,t);return h||delete o[i.index[l]],h});if(Rl(u).length===0)return new r;if(u.length===1){let c=new e(Rl(u));return c.name=$u(o)[0],c.index=$u(s),c}i.values=u,i.index=$u(o)}else if(a===1){i=i.transpose();let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.columns[l],f.index=t.index;let h=n(f,l,t);return h||delete s[i.index[l]],h});if(Rl(u).length===0)return new r;if(u.length===1){let c=new e(Rl(u));return c.name=$u(s)[0],c.index=$u(o),c}i.values=u,i.index=$u(s),i=i.transpose()}return i}MN.exports=d7});var $N=X((vut,zN)=>{var Aa=We(),cp=rt(),lp=qn(),LN=yt(),v7=Ca();function m7(r,e,t){(lp(e)||cp(e))&&(e=[e]),(lp(t)||cp(t))&&(t=[t]);let n=v7((e||[]).concat(t||[]).map(a=>typeof a));return Aa(n.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===1&&Aa(n[0]==="string"||n[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===2&&(Aa(n.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Aa(n.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),LN(e)||(e=e.map(a=>{if(lp(a))return Aa(r.index.indexOf(a)>-1,`Row "${a}" does not exist!`),a;if(cp(a))return Aa(a>=0,`Index ${a} is out of bounds!`),Aa(parseInt(a)===a,"Row numbers must be integers!"),Aa(a<r.index.length,`Index ${a} is out of bounds!`),r.index[a]})),LN(t)||(t=t.map(a=>{if(lp(a))return Aa(r.columns.indexOf(a)>-1,`Column "${a}" does not exist!`),a;if(cp(a))return Aa(a>=0,`Column ${a} is out of bounds!`),Aa(parseInt(a)===a,"Column numbers must be integers!"),Aa(a<r.columns.length,`Column ${a} is out of bounds!`),r.columns[a]})),r.getSubsetByNames(e,t)}zN.exports=m7});var To=X((mut,qN)=>{var WN=We(),g7=Ke(),y7=lt(),b7=Cn(),w7=ut(),x7=yt();function k7(r,e){try{return r<e?-1:r>e?1:0}catch{return r=typeof r=="object"&&r!==null?JSON.stringify(r):r.toString(),e=typeof e=="object"&&e!==null?JSON.stringify(e):e.toString(),r<e?-1:r>e?1:0}}function S7(r,e){if(x7(e)&&(e=k7),y7(r)||w7(r))return r.sort(...Object.values(arguments).slice(1));WN(g7(r),"The `sort` function only works on arrays, Series, and DataFrames!"),WN(b7(e),"The second parameter of the `sort` function must be a comparison function!");let t=r.slice();return t.sort(e),t}qN.exports=S7});var HN=X((gut,GN)=>{var UN=We(),VN=qn(),N7=yt(),T7=Ca(),E7=To();function I7(r){let e=r.toLowerCase(),t="";for(let a=0;a<e.length;a++){let i=e[a];i.match(/[a-z0-9]/g)?t+=i:t+=" "}let n=t.split(" ").filter(a=>a.length>0);return n[0]+n.slice(1).map(a=>a[0].toUpperCase()+a.substring(1)).join("")}function C7(r,e,t){N7(t)?t=e.columns:VN(t)&&(t=[t]);let n={};t.forEach(i=>{UN(VN(i),"You must pass either a string or a one-dimensional array of strings into the `getDummies` (AKA `oneHotEncode`) method!");let o=e.columns.indexOf(i);UN(o>-1,`The given DataFrame does not have a column called "${i}"!`);let s=e.values.map(c=>c[o]),u=E7(T7(s));s.forEach(c=>{u.forEach(l=>{let f=i+"_"+I7(l.toString());n[f]||(n[f]=[]),c===l?n[f].push(1):n[f].push(0)})})});let a=new r(n);return a.index=e.index,a}GN.exports=C7});var eT=X((yut,QN)=>{var Eo=We(),KN=Ke(),jN=rt(),XN=yt(),YN=Fl(),ZN=pa(),JN=sr();function A7(r,e,t){let n=r.shape;XN(e)&&(e=ZN(0,n[0])),XN(t)&&(t=ZN(0,n[1])),jN(e)&&(e=[e]),jN(t)&&(t=[t]),Eo(KN(e)&&KN(t),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Eo(JN(e).length===1&&JN(t).length===1,"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Eo(e.length>0,"The `rowIndices` array must contain at least one index."),Eo(t.length>0,"The `colIndices` array must contain at least one index."),e.forEach(o=>{Eo(YN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Eo(o<r.index.length,`The row index ${o} is out of bounds.`)}),t.forEach(o=>{Eo(YN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Eo(o<r.columns.length,`The column index ${o} is out of bounds.`)});let a=e.map(o=>r.index[o]),i=t.map(o=>r.columns[o]);return r.getSubsetByNames(a,i)}QN.exports=A7});var iT=X((but,aT)=>{var Io=We(),Ig=gr(),tT=Ke(),fp=qn(),rT=yt(),nT=sr();function D7(r,e,t,n,a){rT(n)&&(n=t.index),rT(a)&&(a=t.columns),fp(n)&&(n=[n]),fp(a)&&(a=[a]),Io(tT(n)&&tT(a),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Io(nT(n).length===1&&nT(a).length===1,"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Io(n.length>0,"The `rows` array must contain at least one row name."),Io(a.length>0,"The `cols` array must contain at least one column name."),n.forEach(s=>{Io(fp(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Io(t.index.indexOf(s)>-1,`The row name "${s}" does not exist in the list of rows.`)}),a.forEach(s=>{Io(fp(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Io(t.columns.indexOf(s)>-1,`The column name "${s}" does not exist in the list of columns.`)});let i=n.map(s=>a.map(u=>t.values[t.index.indexOf(s)][t.columns.indexOf(u)]));if(n.length===1&&a.length===1)return Ig(i)[0];if(n.length===1){let s=new e(Ig(i));return s.name=n[0],s.index=a,s}if(a.length===1){let s=new e(Ig(i));return s.name=a[0],s.index=n,s}let o=new r(i);return o.columns=a,o.index=n,o}aT.exports=D7});var sT=X((wut,oT)=>{var _7=qn(),Ol=pa();function F7(r,e,t){function n(h,p){return _7(h)&&h.length>p?h.substring(0,p-3)+"...":h}if(t.isEmpty)return console.table({}),console.log("Shape:",[0,0],`
`),t;let a=typeof window>"u"?20:10,i=parseInt(a/2),o=typeof process>"u"?10:Math.floor(process.stdout.columns/24)-1,s=parseInt(o/2),u=a>t.index.length?null:Ol(0,i).concat(Ol(t.index.length-i,t.index.length)),c=o>t.columns.length?null:Ol(0,s).concat(Ol(t.columns.length-s,t.columns.length)),l=t.get(u,c);l instanceof e&&(t.shape[0]===1?(l=new r([l.values]),l.index=t.index,l.columns=new e(t.columns).get(c).values):t.shape[1]===1&&(l=new r([l.values]).transpose(),l.index=new e(t.index).get(u).values,l.columns=t.columns)),a<=t.index.length&&(l._index.splice(i,0,"..."),l._values.splice(i,0,Ol(0,l.columns.length).map(()=>"..."))),o<=t.columns.length&&(l._columns.splice(s,0,"..."),l._values=l._values.map(h=>(h.splice(s,0,"..."),h)));let f=28;return l instanceof e?(l.values=l.values.map(h=>n(h,f)),l.name=n(l.name,f),l.index=l.index.map(h=>n(h,f))):(l.values=l.values.map(h=>h.map(p=>n(p,f))),l.columns=l.columns.map(h=>n(h,f)),l.index=l.index.map(h=>n(h,f))),console.table(l.toDetailedObject()),console.log("Shape:",t.shape,`
`),t}oT.exports=F7});var hp=X((xut,uT)=>{var R7=We(),O7=rt();function P7(r,e){R7(O7(r),"The `leftPad` function only works on numbers!");let t=r.toString();for(;t.length<e;)t="0"+t;return t}uT.exports=P7});var lT=X((kut,cT)=>{var M7=hp(),B7=pa();function L7(r,e){let t=e?r:r.copy();return t.index=B7(0,r.shape[0]).map(n=>"row"+M7(n,(t.index.length-1).toString().length)),t}cT.exports=L7});var Pl=X((Sut,hT)=>{var z7=We(),$7=gr(),W7=Ke(),q7=lt(),U7=ut();function fT(r){if(q7(r)||U7(r))return fT(r.values);z7(W7(r),"The `product` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:$7(r).reduce((e,t)=>e*t,1)}catch{return NaN}}hT.exports=fT});var pp=X((Nut,mT)=>{var Ml=We(),pT=gr(),dT=Ke(),V7=lt(),vT=rt(),G7=ut(),H7=Pl(),K7=sr();function Cg(r,e){if(V7(r)||G7(r))return Cg(r.values,e);if(Ml(dT(r),"The first argument passed into the `reshape` function must be an array!"),vT(e)&&(e=[e]),Ml(dT(e),"The second argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),Ml(K7(e).length===1,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),e.forEach(i=>{Ml(vT(i)&&parseInt(i)===i&&i>0,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!")}),e.length===0)return pT(r);let t=pT(r);if(e.length===1&&e[0]===t.length)return t;Ml(H7(e)===t.length,"The new shape doesn't match the number of values available in `x` (the first argument passed into the `reshape` function)!");let n=[],a=parseInt(t.length/e[0]);for(let i=0;i<e[0];i++){let o=t.slice(i*a,(i+1)*a);n.push(Cg(o,e.slice(1)))}return n}mT.exports=Cg});var Wu=X((Tut,ST)=>{var{copy:bT}=ji(),j7=We(),X7=Ke(),Y7=rt(),wT=yt(),Z7=No(),J7=Pl(),Q7=pp(),xT=Math.pow(2,64),ur=[];kT(parseInt(Math.random()*xT));function eX(r,e){r=bn(r);function t(){r+=bn("0x9e3779b97f4a7c15");let a=bT(r);return a=(a^a>>BigInt(30))*bn("0xbf58476d1ce4e5b9"),a=(a^a>>BigInt(27))*bn("0x94d049bb133111eb"),a^a>>BigInt(31)}let n=[];for(let a=0;a<e;a++)n.push(t());return n}function bn(r){return BigInt.asUintN(64,BigInt(r))}function gT(r,e){return r=bn(r),e=BigInt(e),bn(bn(r<<e)|bn(r>>bn(BigInt(64)-e)))}function kT(r){if(wT(r))return bT(ur);{j7(Y7(r),"If passing a value into the `seed` function, then that value must be an integer!");let e=eX(parseInt(r),4);ur[0]=e[0],ur[1]=e[1],ur[2]=e[2],ur[3]=e[3]}}function yT(){let r=bn(gT(ur[0]+ur[3],23)+ur[0]),e=bn(ur[1]<<BigInt(17));return ur[2]=bn(ur[2]^ur[0]),ur[3]=bn(ur[3]^ur[1]),ur[1]=bn(ur[1]^ur[2]),ur[0]=bn(ur[0]^ur[3]),ur[2]=bn(ur[2]^e),ur[3]=gT(ur[3],45),parseInt(r)/xT}function tX(r){return wT(r)?yT():(X7(r)||(r=[r]),Q7(Z7(J7(r)).map(yT),r))}ST.exports={random:tX,seed:kT}});var dp=X((Eut,NT)=>{var{random:rX}=Wu(),nX=We(),aX=Ke(),iX=lt(),oX=ut();function sX(r){if(iX(r)||oX(r))return r.shuffle(...Object.values(arguments).slice(1));nX(aX(r),"The `shuffle` function only works on arrays, Series, and DataFrames!");let e=[],t=r.slice();for(let n=0;n<r.length;n++){let a=parseInt(rX()*t.length);e.push(t.splice(a,1)[0])}return e}NT.exports=sX});var IT=X((Iut,ET)=>{var uX=We(),cX=yt(),TT=dp();function lX(r,e){return cX(e)&&(e=0),uX(e===0||e===1,"The `axis` parameter to the `shuffle` must be 0, 1, or undefined."),r.get(e===0?TT(r.index):null,e===1?TT(r.columns):null)}ET.exports=lX});var vp=X((Cut,CT)=>{function fX(r){return typeof r=="boolean"}CT.exports=fX});var RT=X((Aut,FT)=>{var{random:hX}=Wu(),Un=We(),pX=gr(),AT=Ke(),Ag=vp(),_T=Cn(),mp=rt(),qu=qn(),Dg=yt(),dX=pa(),DT=sr(),_g=To();function vX(r,e,t){return _T(e)?mX(r,e,t):gX(r,e,t)}function mX(r,e,t){if(t=Dg(t)?0:t,Un(_T(e),"When sorting a DataFrame using a function, the first argument to the `sort` method must be a function!"),Un(mp(t),"When sorting a DataFrame using a function, the second argument to the `sort` method must be null, undefined, 0, or 1 to indicate the axis along which the data should be sorted! An axis of 0 means that the rows will be sorted relative to each other, whereas an axis of 1 means that the columns will be sorted relative to each other."),t===0){let n=_g(r.index,(a,i)=>e(r.get(a,null),r.get(i,null)));return r.get(n,null)}else{let n=_g(r.columns,(a,i)=>e(r.get(null,a),r.get(null,i)));return r.get(null,n)}}function gX(r,e,t){let n=r.copy(),a=hX().toString();return n=n.assign(a,n.index),Dg(e)&&(e=[a],t=[!0]),(mp(e)||qu(e))&&(e=[e],(Ag(t)||qu(t))&&(t=[t])),Un(AT(e),"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),Un(DT(e).length===1,"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),Dg(t)&&(t=dX(0,e.length).map(()=>!0)),Un(AT(t),"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),Un(DT(t).length===1,"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),Un(e.length===t.length,"The arrays passed into the `sort` method must be equal in length."),e=e.map(i=>{if(Un(qu(i)||mp(i),"Column references can either be column names (as strings) or column indices (as whole numbers)."),qu(i)){let o=n.columns.indexOf(i);return Un(o>-1,`The column "${i}" does not exist!`),o}if(mp(i))return Un(parseInt(i)===i,"Column indices must be whole numbers!"),Un(i>=0,`The column index ${i} is out of bounds!`),Un(i<n.columns.length,`The index ${i} is out of bounds!`),i}),t=t.map(i=>{if(Un(qu(i)||Ag(i),"Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),qu(i)){let o=i.trim().toLowerCase();return Un(o==="ascending"||o==="descending","Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),o==="ascending"}if(Ag(i))return i}),n.values=_g(n.values,(i,o)=>{let s=0;for(;i[e[s]]===o[e[s]]&&s<e.length;)s++;let u=t[s];if(i[e[s]]===o[e[s]])return 0;if(i[e[s]]<o[e[s]])return u?-1:1;if(i[e[s]]>o[e[s]])return u?1:-1}),n.index=pX(n.get(null,a).values),n=n.dropColumns(a),n}FT.exports=vX});var PT=X((Dut,OT)=>{var yX=We(),bX=yt();function wX(r,e){bX(e)?e=0:yX(e===0||e===1,"The axis parameter of the `toDetailedObject` method must be undefined, 0, or 1. An axis of 0 indicates that the returned object should be organized first by rows and then by columns. An axis of 1 indicates that the returned object should be organized first by columns and then by rows.");let t={};return e===0?r.index.forEach((n,a)=>{let i={};r.columns.forEach((o,s)=>{i[o]=r.values[a][s]}),t[n]=i}):r.columns.forEach((n,a)=>{let i={};r.index.forEach((o,s)=>{i[o]=r.values[s][a]}),t[n]=i}),t}OT.exports=wX});var Fg=X((_ut,MT)=>{function xX(r,e){return JSON.stringify(r.toObject(e))}MT.exports=xX});var BT=X((Fut,Og)=>{var Rg=Lu(),kX=Fg();function SX(r,e,t){let n=kX(r,t),a=!1,i=!1,o,s;try{let u=e;if(e.includes("/")){let l=e.split("/");u=l[l.length-1]}let c=document.createElement("a");c.href=`data:application/json;charset=utf-8,${encodeURIComponent(n)}`,c.download=u,c.dispatchEvent(new MouseEvent("click")),a=!0}catch(u){o=u}try{let u=lS("fs"),c=lS("path");u.writeFileSync(c.resolve(e),n,"utf8"),i=!0}catch(u){s=u}if(!a&&!i)throw typeof window<"u"?new Rg(o):typeof Og<"u"?new Rg(s):new Rg("I don't know what's going wrong, but it doesn't seem like you're in Node or the browser, and we couldn't download and/or write the file to disk!");return r}Og.exports=SX});var zT=X((Rut,LT)=>{function NX(r){let e={};return r.columns.forEach(t=>{e[t]=r.get(t).values}),e}LT.exports=NX});var ws=X((Out,qT)=>{var $T=We(),TX=Ke(),EX=lt(),IX=ut(),CX=No(),WT=_l(),AX=sr();function DX(r){if(EX(r)||IX(r))return r.transpose();$T(TX(r),"The `transpose` function only works on arrays, Series, and DataFrames!");let e=AX(r);if($T(e.length<=2,"I'm not smart enough to know how to transpose arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `transpose` function!"),e.length===1)return WT(r);if(e.length===2){let t=CX(WT(e));for(let n=0;n<e[0];n++)for(let a=0;a<e[1];a++)t[a][n]=r[n][a];return t}}qT.exports=DX});var HT=X((Put,GT)=>{var UT=We(),_X=Ke(),FX=lt(),RX=ip(),OX=ut(),PX=sr();function VT(r,e,t){if(OX(t))return new r(e.values.concat(t.values));if(_X(t)){let n=PX(t);UT(n.length===1&&!RX(n),"Only vectors can be appended to Series!");let a=e.copy();return t.forEach((i,o)=>{a._values.push(i),a._index.push("item"+(e.values.length+o))}),a}return UT(!FX(t),"DataFrames cannot be appended to Series!"),VT(e,[t])}GT.exports=VT});var jT=X((Mut,KT)=>{var MX=We(),BX=Cn();function LX(r,e){MX(BX(e),"The parameter to the `apply` method must be a function.");let t=r.copy();return t._values=t._values.map((n,a)=>e(n,a)),t}KT.exports=LX});var YT=X((But,XT)=>{var zX=yt();function $X(r){let e=r.copy(),t=[];return e._values=e.values.filter((n,a)=>zX(n)?!1:(t.push(e.index[a]),!0)),e._index=t,e}XT.exports=$X});var JT=X((Lut,ZT)=>{var WX=rt();function qX(r,e){let t=[],n=[];e.values.forEach((i,o)=>{WX(i)&&(n.push(i),t.push(e.index[o]))});let a=new r(n);return a.name=e.name,a.index=t,a}ZT.exports=qX});var eE=X((zut,QT)=>{var{copy:UX}=ji();function VX(r,e,t){let n=e.copy(),a=UX(n.index),i=[],o=n.values.filter((s,u)=>{let c=t(s,u,n.values);return c||i.push(n.index[u]),c});return i.forEach(s=>{a.splice(a.indexOf(s),1)}),o.length===0?(n=new r,n.name=e.name,n):(n.values=o,n.index=a,n)}QT.exports=VX});var rE=X(($ut,tE)=>{var Co=We(),GX=rt(),HX=qn(),KX=yt(),jX=Ca();function XX(r,e){(HX(e)||GX(e))&&(e=[e]);let t=jX((e||[]).map(n=>typeof n));return Co(t.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===1&&Co(t[0]==="string"||t[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===2&&(Co(t.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Co(t.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),KX(e)||(e=e.map(n=>{if(typeof n=="string")return Co(r.index.indexOf(n)>-1,`Index "${n}" does not exist!`),n;if(typeof n=="number")return Co(n>=0,`Index ${n} is out of bounds!`),Co(parseInt(n)===n,"Indices must be integers!"),Co(n<r.index.length,`Index ${n} is out of bounds!`),r.index[n]})),r.getSubsetByNames(e)}tE.exports=XX});var aE=X((Wut,nE)=>{var Bl=We(),YX=Ke(),ZX=yt(),JX=Fl(),QX=pa(),e9=sr();function t9(r,e){let t=r.shape;ZX(e)&&(e=QX(0,t[0])),Bl(YX(e),"The `indices` array must be 1-dimensional array of whole numbers."),Bl(e9(e).length===1,"The `indices` array must be a 1-dimensional array of whole numbers."),Bl(e.length>0,"The `indices` array must contain at least one index."),e.forEach(a=>{Bl(JX(a),"The `indices` array must be a 1-dimensional array of whole numbers."),Bl(a<r.index.length,`The row index ${a} is out of bounds.`)});let n=e.map(a=>r.index[a]);return r.getSubsetByNames(n)}nE.exports=t9});var oE=X((qut,iE)=>{var Ll=We(),r9=Ke(),n9=qn(),a9=yt(),i9=sr();function o9(r,e,t){a9(t)&&(t=e.index),Ll(r9(t),"The `indices` array must be a 1-dimensional array of strings."),Ll(i9(t).length===1,"The `indices` array must be a 1-dimensional array of strings."),Ll(t.length>0,"The `indices` array must contain at least one index name."),t.forEach(i=>{Ll(n9(i),"The `indices` array must contain only strings."),Ll(e.index.indexOf(i)>-1,`The name "${i}" does not exist in the index.`)});let n=t.map(i=>e.values[e.index.indexOf(i)]);if(n.length===1)return n[0];let a=new r(n);return a.index=t,a.name=e.name,a}iE.exports=o9});var cE=X((Uut,uE)=>{var{copy:s9}=ji(),sE=pa();function u9(r){let e=r.copy(),t=typeof window>"u"?20:10;if(e.index.length>t){e=e.get(sE(0,t/2).concat(sE(e.index.length-t/2,e.index.length)));let a=s9(e.index);a.splice(parseInt(a.length/2),0,"..."),e.values.push("..."),e.index.push("..."),e=e.get(a)}let n={};return e.values.forEach((a,i)=>{let o={};o[e.name]=a,n[e.index[i]]=o}),console.table(n),console.log("Shape:",r.shape,`
`),r}uE.exports=u9});var fE=X((Vut,lE)=>{var c9=dp();function l9(r){let e=r.copy();return e.get(c9(e.index))}lE.exports=l9});var pE=X((Gut,hE)=>{var f9=We(),h9=Cn(),p9=yt(),d9=To(),v9=ws();function m9(r,e,t){t=t||((u,c)=>u<c?-1:1),f9(p9(t)||h9(t),"You must pass undefined, null, or a comparison function as the second argument to the `sort` method!");let n=v9([e.values,e.index]),a=d9(n,(u,c)=>t(u[0],c[0])),i=[],o=[];a.forEach(u=>{i.push(u[0]),o.push(u[1])});let s=new r;return s._values=i,s._index=o,s.name=e.name,s}hE.exports=m9});var mE=X((Hut,vE)=>{var g9=To(),dE=ws();function y9(r,e){let t=dE([e.values,e.index]);t=dE(g9(t,(a,i)=>{if(a[1]===i[1])return 0;if(a[1]<i[1])return-1;if(a[1]>i[1])return 1}));let n=new r(t[0]);return n.index=t[1],n.name=e.name,n}vE.exports=y9});var yE=X((Kut,gE)=>{function b9(r){let e={};return e[r.name]={},r.index.forEach((t,n)=>{e[r.name][t]=r.values[n]}),e}gE.exports=b9});var SE=X((jut,kE)=>{var{copy:gp}=ji(),Xi=We(),Pg=Ke(),w9=qn(),x9=yt(),bE=hp(),wE=pa(),yp=_l(),k9=HT(),S9=jT(),N9=YT(),T9=JT(),E9=eE(),I9=rE(),C9=aE(),A9=oE(),D9=cE(),_9=fE(),F9=pE(),R9=mE(),O9=yE(),zl=sr(),P9=ws(),xE=Symbol.for("@jrc03c/js-math-tools/series");kE.exports=function(r){class e{static[Symbol.hasInstance](n){try{return!!n._symbol&&n._symbol===xE}catch{return!1}}constructor(n){if(this.name="data",Object.defineProperty(this,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:xE}),Object.defineProperty(this,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"values",{configurable:!0,enumerable:!0,get(){return this._values},set(a){Xi(Pg(a),"The new values must be a 1-dimensional array!");let i=zl(a);Xi(i.length===1,"The new array of values must be 1-dimensional!"),i[0]<this._index.length?this._index=this._index.slice(0,i[0]):i[0]>this._index.length&&(this._index=this._index.concat(wE(this._index.length,i[0]).map(o=>"item"+bE(o,(a.length-1).toString().length)))),this._values=a}}),Object.defineProperty(this,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"index",{configurable:!0,enumerable:!0,get(){return this._index},set(a){Xi(Pg(a),"The new index must be a 1-dimensional array of strings!"),Xi(a.length===this.shape[0],"The new index must be the same length as the old index!"),Xi(zl(a).length===1,"The new index must be a 1-dimensional array of strings!"),a.forEach(i=>{Xi(w9(i),"All of the row names must be strings!")}),this._index=a}}),n){if(n instanceof e)this.name=n.name,this.values=gp(n.values),this.index=gp(n.index);else if(Pg(n)){let a=zl(n);Xi(a.length===1,"When passing an array into the constructor of a Series, the array must be 1-dimensional!"),this.values=n}else if(n instanceof Object){let a=Object.keys(n).concat(Object.getOwnPropertySymbols(n)).map(s=>s.toString());Xi(a.length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!");let i=a[0],o=n[i];Xi(zl(o).length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!"),this.name=i,this.values=o.slice()}}}get shape(){return zl(this.values)}get length(){return this.shape[0]}get isEmpty(){return this.values.filter(n=>!x9(n)).length===0}clear(){let n=this.copy();return n.values.forEach((a,i)=>{n.values[i]=void 0}),n}get(n){return I9(this,n)}getSubsetByNames(n){return A9(e,this,n)}getSubsetByIndices(n){return C9(this,n)}loc(n){return this.getSubsetByNames(n)}iloc(n){return this.getSubsetByIndices(n)}reverse(){let n=new e(yp(this.values));return n.index=yp(this.index),n.name=this.name,n}resetIndex(){let n=this.copy();return n.index=wE(0,this.shape[0]).map(a=>"item"+bE(a,(n.index.length-1).toString().length)),n}copy(){let n=new e;return n._values=gp(this.values),n._index=gp(this.index),n.name=this.name,n}append(n){return k9(e,this,n)}apply(n){return S9(this,n)}concat(n){return this.append(n)}dropMissing(n,a){return N9(this,n,a)}dropNaN(){return T9(e,this)}toObject(){return O9(this)}print(){return D9(this)}shuffle(){return _9(this)}sort(n){return F9(e,this,n)}sortByIndex(){return R9(e,this)}filter(n){return E9(e,this,n)}toDataFrame(){let n=new r(P9([this.values]));return n.columns=[this.name],n.index=this.index,n}transpose(){let n=this.copy();return n.values=yp(n.values),n.index=yp(n.index),n}getDummies(){return this.toDataFrame().getDummies()}oneHotEncode(){return this.getDummies()}}return e}});var Wl=X((Xut,CE)=>{var{copy:Mg}=ji(),Da=We(),NE=Al(),M9=uN(),B9=pN(),L9=gN(),z9=bN(),$9=EN(),W9=AN(),q9=RN(),U9=BN(),V9=$N(),TE=HN(),G9=eT(),H9=iT(),K9=sT(),j9=lT(),X9=IT(),Y9=RT(),Z9=PT(),J9=BT(),Q9=Fg(),eY=zT(),tY=gr(),$l=Ke(),rY=So(),Bg=yt(),Lg=hp(),nY=No(),zg=pa(),aY=Ca(),Uu=sr(),EE=ws(),IE=Symbol.for("@jrc03c/js-math-tools/dataframe");function bp(r){let e="abcdefghijklmnopqrstuvwxyz1234567890",t="";for(let n=0;n<r;n++)t+=e[parseInt(Math.random()*e.length)];return t}var Kr=class{static[Symbol.hasInstance](e){try{return!!e._symbol&&e._symbol===IE}catch{return!1}}constructor(e){if(Object.defineProperty(this,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:IE}),Object.defineProperty(this,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"values",{configurable:!0,enumerable:!0,get(){return this._values.length===0||!Bg(this._values[0])&&this._values[0].length===0?[[]]:this._values},set(t){Da($l(t),"The new values must be a 2-dimensional array!");let n=Uu(t);Da(n.length===2,"The new array of values must be 2-dimensional!"),n[0]<this._index.length?this._index=this._index.slice(0,n[0]):n[0]>this._index.length&&(this._index=this._index.concat(zg(this._index.length,n[0]).map(a=>"row"+Lg(a,(n[0]-1).toString().length)))),n[1]<this._columns.length?this._columns=this._columns.slice(0,n[1]):n[1]>this._columns.length&&(this._columns=this._columns.concat(zg(this._columns.length,n[1]).map(a=>"col"+Lg(a,(n[1]-1).toString().length)))),this._values=t}}),Object.defineProperty(this,"_columns",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"columns",{configurable:!0,enumerable:!0,get(){return this._columns},set(t){Da($l(t),"The new columns list must be a 1-dimensional array of strings!"),Da(this.isEmpty||t.length===this.shape[1],"The new columns list must be the same length as the old columns list!"),Da(Uu(t).length===1,"The new columns list must be a 1-dimensional array of strings!"),t=t.map(a=>(typeof a!="string"&&(a=JSON.stringify(a)||a.toString()),a.trim().length===0?"untitled_"+bp(8):a.trim()));let n=(()=>{let a=NE(t),i={};return a.forEach(o=>{i[o.value]=o.count}),i})();t=t.map(a=>n[a]>1?a+"_"+bp(8):a),this._columns=t}}),Object.defineProperty(this,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"index",{configurable:!0,enumerable:!0,get(){return this._index},set(t){Da($l(t),"The new index must be a 1-dimensional array of strings!"),Da(this.isEmpty||t.length===this.shape[0],"The new index must be the same length as the old index!"),Da(Uu(t).length===1,"The new index must be a 1-dimensional array of strings!"),t=t.map(a=>(typeof a!="string"&&(a=JSON.stringify(a)||a.toString()),a.trim().length===0?"untitled_"+bp(8):a.trim()));let n=(()=>{let a=NE(t),i={};return a.forEach(o=>{i[o.value]=o.count}),i})();t=t.map(a=>n[a]>1?a+"_"+bp(8):a),this._index=t}}),Da(Bg(e)||rY(e)||$l(e),"The `data` passed into the constructor of a DataFrame must be either (1) an object where the key-value pairs are (respectively) column names and 1-dimensional arrays of values, or (2) a 2-dimensional array of values."),e)if(e instanceof Kr)this.values=Mg(e.values),this.columns=Mg(e.columns),this.index=Mg(e.index);else if($l(e)){let t=Uu(e);Da(t.length===2,"The `data` array passed into the constructor of a DataFrame must be 2-dimensional!"),Da(aY(e.map(n=>n.length)).length===1,"The 2-dimensional array passed into the constructor of a DataFrame must not contain sub-arrays (i.e., rows) of different lengths!"),this.values=e}else{this._columns=Object.keys(e).concat(Object.getOwnPropertySymbols(e)).map(o=>o.toString());let t=[],n=null,a=null;this._columns.forEach(o=>{Bg(a)&&(n=o,a=e[o].length),Da(e[o].length===a,`The object passed into the DataFrame constructor contains arrays of different lengths! The key "${n}" points to an array containing ${a} items, and the key "${o}" points to an array containing ${e[o].length} items.`),a=e[o].length;let s=e[o];t.push(s)}),this._values=EE(t);let i=Uu(this.values);this._index=zg(0,i[0]).map(o=>"row"+Lg(o,(i[0]-1).toString().length))}}get shape(){return Uu(this.values)}get length(){return this.shape[0]}get width(){return this.shape[1]}get rows(){return this.index}set rows(e){this.index=e}get isEmpty(){return tY(this.values).length===0}clear(){let e=new Kr(nY(this.shape));return e.columns=this.columns.slice(),e.index=this.index.slice(),e}get(e,t){if(arguments.length===0)return this;if(arguments.length===1)try{return this.get(null,e)}catch{return this.get(e,null)}return V9(this,e,t)}getSubsetByNames(e,t){return H9(Kr,Ao,this,e,t)}getSubsetByIndices(e,t){return G9(this,e,t)}getDummies(e){return TE(Kr,this,e)}oneHotEncode(e){return TE(Kr,this,e)}transpose(){let e=new Kr(EE(this.values));return e.columns=this.index.slice(),e.index=this.columns.slice(),e}get T(){return this.transpose()}resetIndex(e){return j9(this,e)}copy(){return z9(Kr,this)}assign(e,t){return L9(Kr,Ao,this,e,t)}apply(e,t){return B9(Kr,Ao,this,e,t)}dropMissing(e,t,n){return W9(Kr,Ao,this,e,t,n)}dropNaN(e,t,n){return q9(Kr,this,e,t,n)}drop(e,t){return $9(Kr,Ao,this,e,t)}dropColumns(e){return this.drop(null,e)}dropRows(e){return this.drop(e,null)}toDetailedObject(e){return Z9(this,e)}toObject(){return eY(this)}toJSONString(e){return Q9(this,e)}saveAsJSON(e,t){return J9(this,e,t)}print(){return K9(Kr,Ao,this)}sort(e,t){return Y9(this,e,t)}sortByIndex(){return this.sort()}filter(e,t){return U9(Kr,Ao,this,e,t)}shuffle(e){return X9(this,e)}append(e,t){return M9(this,e,t)}concat(e,t){return this.append(e,t)}join(e,t){return this.append(e,t)}toString(){return JSON.stringify(this)}},Ao=SE()(Kr);CE.exports={DataFrame:Kr,Series:Ao}});var Vu=X((Yut,DE)=>{var iY=We(),oY=gr(),sY=Ke(),uY=lt(),cY=ut();function AE(r){if(uY(r)||cY(r))return AE(r.values);iY(sY(r),"The `max` function only works on arrays, Series, and DataFrames!");try{r=oY(r);let e=-1/0;for(let t of r)t>e&&(e=t);return e}catch{return NaN}}DE.exports=AE});var Wt=X((Zut,PE)=>{var{DataFrame:_E,Series:FE}=Wl(),RE=We(),ql=Ke(),$g=lt(),OE=ii(),lY=Cn(),Wg=ut(),fY=Vu(),hY=pa(),wp=sr();function pY(r){return ql(r)||Wg(r)||$g(r)}function dY(r){return RE(lY(r),"You must pass a function into the `vectorize` function!"),function e(){let t,n,a=[],i=[],o=Object.keys(arguments).filter(s=>{let u=arguments[s];return ql(u)?!0:Wg(u)?(t=!0,a.push(u),!0):$g(u)?(n=!0,i.push(u),!0):!1}).map(s=>arguments[s]);if(o.slice(0,-1).forEach((s,u)=>{RE(OE(ql(s)?wp(s):s.shape,ql(o[u+1])?wp(o[u+1]):o[u+1].shape),`When passing multiple arrays into the \`${r.name}\` function, all of the arrays must have the same shape!`)}),o.length>0){let s=fY(o.map(c=>c.length?c.length:c.values.length)),u=hY(0,s).map(c=>{let l=Object.keys(arguments).map(f=>{if(pY(arguments[f])){if(ql(arguments[f]))return arguments[f][c];if(Wg(arguments[f]))return arguments[f].values[c];if($g(arguments[f]))return arguments[f].values[c]}else return arguments[f]});return e(...l)});if(n)try{if(i.length===1&&OE(wp(i[0]),wp(u))){let c=new _E(u);return c.index=i[0].index.slice(),c.columns=i[0].columns.slice(),c}else return new _E(u)}catch{return u}if(t)try{if(a.length===1&&a[0].length===u.length){let c=new FE(u);return c.name=a[0].name,c.index=a[0].index.slice(),c}else return new FE(u)}catch{return u}return u}else return r(...arguments)}}PE.exports=dY});var xp=X((Jut,ME)=>{var vY=rt(),mY=Wt();function gY(r){try{return vY(r)?Math.abs(r):NaN}catch{return NaN}}ME.exports=mY(gY)});var kp=X((Qut,BE)=>{var yY=rt(),bY=Wt();function wY(){try{let r=0,e=Object.values(arguments);for(let t=0;t<e.length;t++){if(!yY(e[t]))return NaN;r+=e[t]}return r}catch{return NaN}}BE.exports=bY(wY)});var Ul=X((ect,LE)=>{var xY=Wt();function kY(r,e){try{return e(r)}catch{return NaN}}LE.exports=xY(kY)});var $E=X((tct,zE)=>{var SY=rt(),NY=Wt();function TY(r){try{return SY(r)?Math.acos(r):NaN}catch{return NaN}}zE.exports=NY(TY)});var qE=X((rct,WE)=>{var EY=rt(),IY=Wt();function CY(r){try{return EY(r)?Math.asin(r):NaN}catch{return NaN}}WE.exports=IY(CY)});var VE=X((nct,UE)=>{var AY=rt(),DY=Wt();function _Y(r){try{return AY(r)?Math.atan(r):NaN}catch{return NaN}}UE.exports=DY(_Y)});var HE=X((act,GE)=>{var FY=We(),RY=Tl(),OY=Ke(),PY=lt(),MY=ut(),BY=Vu();function qg(r){if(PY(r)){let e=qg(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(MY(r)){let e=qg(r.values);return[r.index[e]]}FY(OY(r),"The `argmax` function only works on arrays, Series, and DataFrames!");try{let e=RY(r,BY(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}GE.exports=qg});var Sp=X((ict,jE)=>{var LY=We(),zY=gr(),$Y=Ke(),WY=lt(),qY=ut();function KE(r){if(WY(r)||qY(r))return KE(r.values);LY($Y(r),"The `min` function only works on arrays, Series, and DataFrames!");try{r=zY(r);let e=1/0;for(let t of r)t<e&&(e=t);return e}catch{return NaN}}jE.exports=KE});var YE=X((oct,XE)=>{var UY=We(),VY=Tl(),GY=Ke(),HY=lt(),KY=ut(),jY=Sp();function Ug(r){if(HY(r)){let e=Ug(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(KY(r)){let e=Ug(r.values);return[r.index[e]]}UY(GY(r),"The `argmin` function only works on arrays, Series, and DataFrames!");try{let e=VY(r,jY(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}XE.exports=Ug});var Kg=X((sct,QE)=>{var ZE=Ke(),Vg=vp(),XY=lt(),Gg=Il(),YY=ii(),JE=rt(),ZY=So(),JY=ut(),Hg=yt();function Yi(r,e){if(XY(r)||JY(r))return r.apply(t=>Yi(t,e));if(ZE(r))return r.map(t=>Yi(t,e));if(e==="null")return null;if(e==="number"){if(Hg(r))return NaN;let t=Yi(r,"boolean");if(Vg(t))return t?1:0;try{JSON.parse(r)}catch{let i=Yi(r,"date");if(Gg(i))return i.getTime()}let n=parseFloat(r);return isNaN(n)?NaN:n}if(e==="boolean"){if(Vg(r))return r;if(JE(r))return r===0?!1:r===1?!0:null;try{let t=(typeof r=="object"?r.toString()==="null"?"false":JSON.stringify(r):r.toString()).trim().toLowerCase();return t==="true"||t==="yes"||t==="y"?!0:t==="false"||t==="no"||t==="n"?!1:null}catch{return null}}if(e==="date"){if(Gg(r))return r;if(Hg(r))return null;let t=parseFloat(r);if(!isNaN(t)){let a=new Date(r);return Gg(a)?a:null}let n=Date.parse(r);return isNaN(n)?null:new Date(n)}if(e==="object"){if(ZY(r))return r;let t=Yi(r,"boolean");if(Vg(t))return null;try{let a=Yi(r,"number");if(JE(a))return JSON.parse(r),null}catch{}let n=Yi(r,"date");if(n)return n;try{let a=JSON.parse(r);return ZE(a)?a.map(i=>Yi(i,e)):a}catch{return null}}if(e==="string")return Hg(r)?YY(r,void 0)?"undefined":"null":r instanceof Date?r.toJSON():(()=>typeof r=="object"?r===null?"null":JSON.stringify(r):r.toString())()}QE.exports=Yi});var tI=X((uct,eI)=>{var QY=rt(),eZ=Wt();function tZ(r){try{return QY(r)?Math.ceil(r):NaN}catch{return NaN}}eI.exports=eZ(tZ)});var aI=X((cct,nI)=>{var rZ=xp(),rI=rt(),nZ=yt(),aZ=Wt();function iZ(r,e){try{if(!rI(r))return NaN;if(nZ(e))e=1e-10;else if(!rI(e))return NaN;return rZ(r)<e?0:r}catch{return NaN}}nI.exports=aZ(iZ)});var oI=X((lct,iI)=>{var jg=rt(),oZ=Wt();function sZ(r,e,t){try{return jg(r)?jg(e)?jg(t)?r<e?e:r>t?t:r:NaN:NaN:NaN}catch{return NaN}}iI.exports=oZ(sZ)});var uI=X((fct,sI)=>{var Xg=We(),uZ=gr(),cZ=Ke(),lZ=lt(),fZ=rt(),hZ=ut();function Yg(r,e){if(lZ(r)||hZ(r))return Yg(r.values,e);if(Xg(cZ(r),"The `combinations` function only works on arrays, Series, and DataFrames!"),Xg(fZ(e),"`r` must be a whole number!"),r=uZ(r),e>r.length)return[r];if(e<=0)return[[]];if(Xg(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(a+1);if(i.length<e-1)return;Yg(i,e-1).forEach(s=>{t.push([n].concat(s))})}),t}sI.exports=Yg});var Np=X((hct,lI)=>{var pZ=We(),dZ=gr(),vZ=Ke(),mZ=lt(),gZ=ut();function cI(r){if(mZ(r)||gZ(r))return cI(r.values);pZ(vZ(r),"The `mean` function only works on arrays, Series, and DataFrames!");try{let e=dZ(r),t=0;return e.forEach(n=>{t+=n}),t/e.length}catch{return NaN}}lI.exports=cI});var Jg=X((pct,mI)=>{var fI=We(),hI=Ke(),Tp=rt(),pI=ut(),dI=Np(),vI=sr();function Zg(r,e){if(pI(r))return Zg(r.values,e);if(pI(e))return Zg(r,e.values);fI(hI(r)&&hI(e)&&vI(r).length===1&&vI(e).length===1,"The `covariance` function only works on 1-dimensional arrays and Series!"),fI(r.length===e.length,"The two arrays or Series passed into the `covariance` function must have the same length!");try{let t=dI(r),n=dI(e);if(!Tp(t)||!Tp(n))return NaN;let a=Math.max(r.length,e.length),i=0;for(let o=0;o<a;o++){if(!Tp(r[o]))return NaN;if(!Tp(e[o]))return NaN;i+=(r[o]-t)*(e[o]-n)}return i/r.length}catch{return NaN}}mI.exports=Zg});var Ep=X((dct,gI)=>{var yZ=rt(),bZ=Wt();function wZ(r){try{return yZ(r)?Math.sqrt(r):NaN}catch{return NaN}}gI.exports=bZ(wZ)});var Qg=X((vct,bI)=>{var xZ=We(),kZ=gr(),SZ=Ke(),NZ=lt(),TZ=rt(),EZ=ut(),IZ=Np();function yI(r){if(NZ(r)||EZ(r))return yI(r.values);xZ(SZ(r),"The `variance` function only works on arrays, Series, and DataFrames!");try{let e=kZ(r),t=IZ(e),n=0;for(let a=0;a<e.length;a++){if(!TZ(e[a]))return NaN;n+=(e[a]-t)*(e[a]-t)}return n/e.length}catch{return NaN}}bI.exports=yI});var Ip=X((mct,xI)=>{var CZ=We(),AZ=Ke(),DZ=lt(),_Z=ut(),FZ=Ep(),RZ=Qg();function wI(r){if(DZ(r)||_Z(r))return wI(r.values);CZ(AZ(r),"The `std` function only works on arrays, Series, and DataFrames!");try{return FZ(RZ(r))}catch{return NaN}}xI.exports=wI});var CI=X((gct,II)=>{var kI=We(),OZ=Jg(),SI=Ke(),NI=ut(),TI=sr(),EI=Ip();function ey(r,e){if(NI(r))return ey(r.values,e);if(NI(e))return ey(r,e.values);kI(SI(r)&&SI(e)&&TI(r).length===1&&TI(e).length===1,"The `correl` function only works on 1-dimensional arrays and Series!"),kI(r.length===e.length,"The two arrays or Series passed into the `correl` function must have the same length!");try{return OZ(r,e)/(EI(r)*EI(e))}catch{return NaN}}II.exports=ey});var DI=X((yct,AI)=>{var PZ=rt(),MZ=Wt();function BZ(r){try{return PZ(r)?Math.cos(r):NaN}catch{return NaN}}AI.exports=MZ(BZ)});var FI=X((bct,_I)=>{_I.exports=Object.freeze({boolean:"boolean",date:"date",null:"null",number:"number",object:"object",string:"string"})});var LI=X((wct,BI)=>{var LZ=We(),RI=Ke(),OI=lt(),zZ=ii(),PI=ut(),MI=Ca();function ty(r,e){if(OI(r)||PI(r))return ty(r.values,e);if(OI(e)||PI(e))return ty(r,e.values);LZ(RI(r)&&RI(e),"The `diff` function only works on arrays, Series, and DataFrames!");let t=MI(r),n=MI(e),a=[];return t.forEach(i=>{n.findIndex(o=>zZ(o,i))<0&&a.push(i)}),a}BI.exports=ty});var Cp=X((xct,$I)=>{var zI=rt(),$Z=Wt();function WZ(r,e){try{return zI(r)?zI(e)?Math.pow(r,e):NaN:NaN}catch{return NaN}}$I.exports=$Z(WZ)});var ry=X((kct,WI)=>{var qZ=rt(),UZ=Wt();function VZ(){try{let r=Object.values(arguments);if(r.length===0)return NaN;let e=1;for(let t=0;t<r.length;t++){if(!qZ(r[t]))return NaN;e*=r[t]}return e}catch{return NaN}}WI.exports=UZ(VZ)});var Gu=X((Sct,qI)=>{var GZ=ry();function HZ(){return GZ(...arguments)}qI.exports=HZ});var ny=X((Nct,UI)=>{var KZ=kp(),jZ=Gu();function XZ(r,e){return KZ(r,jZ(e,-1))}UI.exports=XZ});var Ap=X((Tct,GI)=>{var YZ=We(),ZZ=gr(),JZ=Ke(),QZ=lt(),eJ=ut();function VI(r){if(QZ(r)||eJ(r))return VI(r.values);YZ(JZ(r),"The `sum` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:ZZ(r).reduce((e,t)=>e+t,0)}catch{return NaN}}GI.exports=VI});var JI=X((Ect,ZI)=>{var tJ=xp(),rJ=We(),HI=Ke(),KI=lt(),nJ=ii(),jI=rt(),XI=ut(),aJ=Cp(),YI=sr(),iJ=Ep(),oJ=ny(),sJ=Ap();function ay(r,e){if(jI(r)&&jI(e))return tJ(r-e);if(KI(r)||XI(r))return ay(r.values,e);if(KI(e)||XI(e))return ay(r,e.values);HI(r)&&HI(e)&&rJ(nJ(YI(r),YI(e)),"If passing two arrays, Series, or DataFrames into the `distance` function, then those objects must have the same shape!");try{return iJ(sJ(aJ(oJ(r,e),2)))}catch{return NaN}}ZI.exports=ay});var eC=X((Ict,QI)=>{var uJ=Cp(),cJ=Gu();function lJ(r,e){return cJ(r,uJ(e,-1))}QI.exports=lJ});var oy=X((Cct,oC)=>{var{DataFrame:tC,Series:rC}=Wl(),Dp=We(),nC=gr(),aC=Ke(),iy=lt(),fJ=rt(),_p=ut(),hJ=Gu(),Fp=sr(),pJ=Ap(),iC=ws();function Do(r,e){if(iy(r)){let a=Do(r.values,e);if(Fp(a).length===1){let i=new rC(a);return i.name=_p(e)?e.name:i.name,i.index=r.index.slice(),i}else{let i=new tC(a);return i.index=r.index.slice(),iy(e)&&(i.columns=e.columns.slice()),i}}if(iy(e)){let a=Do(r,e.values);if(Fp(a).length===1){let i=new rC(a);return i.name=_p(r)?r.name:i.name,i.index=e.columns.slice(),i}else{let i=new tC(a);return i.columns=e.columns.slice(),i}}if(_p(r))return Do(r.values,e);if(_p(e))return Do(r,e.values);Dp(aC(r)&&aC(e),"The `dot` function only works on arrays, Series, and DataFrames!"),nC(r).concat(nC(e)).forEach(a=>{Dp(fJ(a),"One of the arrays you passed into the `dot` function contains non-numerical values!")});let t=Fp(r),n=Fp(e);if(Dp(t.length<=2&&n.length<=2,"I'm not smart enough to know how to get the dot-product of arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `dot` function!"),Dp(t[t.length-1]===n[0],`There's a dimension misalignment in the two arrays you passed into the \`dot\` function. (${t[t.length-1]} !== ${n[0]})`),t.length===1&&n.length===1)return pJ(hJ(r,e));if(t.length===1&&n.length===2)return iC(e).map(a=>Do(r,a));if(t.length===2&&n.length===1)return r.map(a=>Do(a,e));if(t.length===2&&n.length===2){let a=iC(e),i=[];for(let o=0;o<r.length;o++){let s=[];for(let u=0;u<a.length;u++)s.push(Do(r[o],a[u]));i.push(s)}return i}}oC.exports=Do});var sy=X((Act,uC)=>{var dJ=We(),vJ=Ke(),mJ=lt(),gJ=ut(),yJ=yt();function sC(r){if(mJ(r)||gJ(r))return r.dropMissing(...Object.values(arguments).slice(1));dJ(vJ(r),"The `dropMissing` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(sC(t))}catch{yJ(t)||e.push(t)}}),e}uC.exports=sC});var mC=X((Dct,vC)=>{var cC=We(),lC=Ke(),fC=lt(),bJ=ii(),hC=ut(),pC=yt(),dC=sr();function Rp(r,e){if(fC(r)||hC(r))return Rp(r.values,e);if(fC(e)||hC(e))return Rp(r,e.values);cC(lC(r)&&lC(e),"The `dropMissingPairwise` function only works on arrays, Series, and DataFrames!"),cC(bJ(dC(r),dC(e)),"The two arrays, Series, and/or DataFrames passed into the `dropMissingPairwise` function must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=Rp(r[a],e[a]);t.push(i),n.push(o)}catch{!pC(r[a])&&!pC(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}vC.exports=Rp});var NC=X((_ct,SC)=>{var gC=We(),yC=Ke(),bC=lt(),wJ=ii(),wC=rt(),xC=ut(),kC=sr();function Op(r,e){if(bC(r)||xC(r))return Op(r.values,e);if(bC(e)||xC(e))return Op(r,e.values);gC(yC(r)&&yC(e),"The `dropNaNPairwise` only works on arrays, Series, and DataFrames!"),gC(wJ(kC(r),kC(e)),"The two arrays, Series, and/or DataFrames passed into the `dropNaNPairwise` must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=Op(r[a],e[a]);t.push(i),n.push(o)}catch{wC(r[a])&&wC(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}SC.exports=Op});var EC=X((Fct,TC)=>{var xJ=sy();function kJ(r){return xJ(r)}TC.exports=kJ});var CC=X((Rct,IC)=>{var SJ=rt(),NJ=Wt();function TJ(r){try{return SJ(r)?Math.exp(r):NaN}catch{return NaN}}IC.exports=NJ(TJ)});var _C=X((Oct,DC)=>{var EJ=Wt();function AC(r){try{return r!==parseInt(r)?NaN:r<=1?1:r*AC(r-1)}catch{return NaN}}DC.exports=EJ(AC)});var PC=X((Pct,OC)=>{var IJ=We(),CJ=gr(),FC=Ke(),AJ=lt(),DJ=Cn(),RC=So(),_J=ut();function uy(r,e){if(AJ(r))return uy(CJ(r.values),e);if(_J(r))return uy(r.values,e);if(IJ(RC(r)||FC(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `find` function!"),!DJ(e)){let a=e;e=i=>i===a}function t(a,i,o){if(o=o||[],o.indexOf(a)>-1)return null;if(RC(a)){o.push(a);let s=Object.keys(a).concat(Object.getOwnPropertySymbols(a));for(let u=0;u<s.length;u++){let c=s[u],l=a[c];if(i(l))return l;let f=t(l,i,o);if(f)return f}}else if(FC(a)){o.push(a);for(let s=0;s<a.length;s++){let u=a[s];if(i(u))return u;let c=t(u,i,o);if(c)return c}}else if(i(a))return a;return null}function n(a){try{return e(a)}catch{return!1}}return t(r,n)}OC.exports=uy});var zC=X((Mct,LC)=>{var FJ=We(),RJ=gr(),MC=Ke(),OJ=lt(),PJ=Cn(),BC=So(),MJ=ut();function cy(r,e){if(OJ(r))return cy(RJ(r.values),e);if(MJ(r))return cy(r.values,e);if(FJ(BC(r)||MC(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `findAll` function!"),!PJ(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(BC(i)){s.push(i);let u=Object.keys(i).concat(Object.getOwnPropertySymbols(i)),c=[];for(let l=0;l<u.length;l++){let f=u[l],h=i[f],p=!1;o(h)&&(c.push(h),p=!0);let d=t(h,o,s);d&&d.length>0&&d.slice(p?1:0).forEach(m=>c.push(m))}return c}else if(MC(i)){s.push(i);let u=[];for(let c=0;c<i.length;c++){let l=i[c],f=!1;o(l)&&(u.push(l),f=!0);let h=t(l,o,s);h&&h.length>0&&h.slice(f?1:0).forEach(p=>u.push(p))}return u}else if(o(i))return[i];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}LC.exports=cy});var WC=X((Bct,$C)=>{var BJ=rt(),LJ=Wt();function zJ(r){try{if(r==="Infinity")return 1/0;if(r==="-Infinity")return-1/0;let e=JSON.parse(r);return BJ(e)?e:NaN}catch{return NaN}}$C.exports=LJ(zJ)});var UC=X((Lct,qC)=>{var $J=rt(),WJ=Wt();function qJ(r){try{return $J(r)?Math.floor(r):NaN}catch{return NaN}}qC.exports=WJ(qJ)});var ly=X((zct,VC)=>{var UJ=rt(),VJ=Pl(),GJ=pp();function HJ(r){UJ(r)&&(r=[r]);let e=[],t=VJ(r);for(let n=0;n<t;n++)e.push(0);return GJ(e,r)}VC.exports=HJ});var HC=X(($ct,GC)=>{var Pp=We(),KJ=rt(),jJ=yt(),XJ=ly();function YJ(r){Pp(!jJ(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Pp(KJ(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Pp(parseInt(r)===r,"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Pp(r>0,"You must pass an integer greater than 0 (representing the size) into the `identity` function!");let e=XJ([r,r]);for(let t=0;t<r;t++)e[t][t]=1;return e}GC.exports=YJ});var jC=X((Wct,KC)=>{KC.exports=["true","false","yes","no"]});var YC=X((qct,XC)=>{XC.exports=["null","none","nan","na","n/a","","undefined"]});var tA=X((Uct,eA)=>{var ZJ=Ul(),JJ=We(),QJ=jC(),eQ=Kg(),tQ=Al(),JC=gr(),fy=Ke(),rQ=lt(),ZC=Il(),QC=rt(),nQ=ut(),aQ=qn(),iQ=YC();function Mp(r){return r.type==="number"&&(typeof r.value<"u"?r.isInteger=parseInt(r.value)===r.value:r.isInteger=JC(r.values).every(e=>QC(e)?parseInt(e)===e:!0)),r}function Bp(r){if(rQ(r)){let a=r.copy(),i=Bp(r.values);return a.values=i.values,Mp({type:i.type,values:a})}if(nQ(r)){let a=r.copy(),i=Bp(r.values);return a.values=i.values,Mp({type:i.type,values:a})}if(!fy(r)){let a=Bp([r]);return a.value=a.values[0],delete a.values,Mp(a)}JJ(fy(r),"The `inferType` function only works on arrays, Series, and DataFrames!");let e=JC(r).map(a=>{if(a===void 0)return"null";try{if(typeof a=="object"){let s=new Date(a.getTime());if(ZC(s))return"date"}}catch{}aQ(a)||(a=JSON.stringify(a));let o=a.toLowerCase().trim();if(iQ.indexOf(o)>-1)return"null";if(QJ.indexOf(o)>-1)return"boolean";try{let s=JSON.parse(a);return QC(s)?"number":typeof s=="object"?fy(s)?"string":"object":"string"}catch{let u=new Date(a);return ZC(u)?"date":"string"}}),n=tQ(e).sort((a,i)=>i.count-a.count)[0].value;return Mp({type:n,values:ZJ(r,a=>eQ(a,n))})}eA.exports=Bp});var nA=X((Vct,rA)=>{var oQ=rt(),sQ=Wt();function uQ(r){try{let e=JSON.parse(r);return oQ(e)?parseInt(e):NaN}catch{return NaN}}rA.exports=sQ(uQ)});var iA=X((Gct,aA)=>{var cQ=We(),lQ=Ke(),fQ=lt(),hQ=ii(),pQ=ut(),hy=Ca();function dQ(){let r=Object.values(arguments).map(t=>fQ(t)||pQ(t)?hy(t.values):(cQ(lQ(t),"The `intersect` function only works on arrays, Series, and DataFrames!"),hy(t)));return hy(r).filter(t=>r.every(n=>n.findIndex(a=>hQ(a,t))>-1))}aA.exports=dQ});var cA=X((Hct,uA)=>{var oA=kp(),_o=We(),vQ=oy(),mQ=gr(),gQ=Ke(),yQ=lt(),py=rt(),sA=Gu(),bQ=sr();function Lp(r){if(yQ(r)){let t=r.copy();return t.values=Lp(t.values),t}_o(gQ(r),"The `inverse` function only works on square 2-dimensional arrays or DataFrames!"),mQ(r).forEach(t=>_o(py(t),"The array passed into the `inverse` function must contain only numbers!"));let e=bQ(r);if(_o(e.length===2,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),_o(e[0]===e[1],"The array passed into the `inverse` function must be exactly two-dimensional and square!"),_o(e[0]>=0,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),e[0]===0)return r;if(e[0]===1)return _o(r[0][0]!==0,"This matrix cannot be inverted!"),1/r[0][0];if(e[0]===2){let t=r[0][0],n=r[0][1],a=r[1][0],i=r[1][1],o=t*i-n*a;_o(o!==0,"This matrix cannot be inverted!");let s=[[i,-n],[-a,t]];return sA(s,1/o)}else if(e[0]>1){let t=(n,a)=>py(n)||py(a)?sA(n,a):vQ(n,a);for(let n=1;n<e[0]-1;n++)try{let a=r.slice(0,n).map(m=>m.slice(0,n)),i=r.slice(0,n).map(m=>m.slice(n,e[0])),o=r.slice(n,e[0]).map(m=>m.slice(0,n)),s=r.slice(n,e[0]).map(m=>m.slice(n,e[0])),u=Lp(a),c=Lp(oA(s,t(-1,t(t(o,u),i)))),l=oA(u,t(t(t(t(u,i),c),o),u)),f=t(-1,t(t(u,i),c)),h=t(-1,t(t(c,o),u)),p=c;return l.map((m,v)=>m.concat(f[v])).concat(h.map((m,v)=>m.concat(p[v])))}catch{}_o(!1,"This matrix cannot be inverted!")}}uA.exports=Lp});var fA=X((Kct,lA)=>{var wQ=new Function(`
    try {
      return this === window
    } catch(e) {}

    try {
      return !!importScripts
    } catch(e){}

    return false
  `);lA.exports=wQ});var pA=X((jct,hA)=>{var dy=rt(),xQ=Wt();function kQ(r,e,t){try{return dy(r)?dy(e)?dy(t)?t*(e-r)+r:NaN:NaN:NaN}catch{return NaN}}hA.exports=xQ(kQ)});var mA=X((Xct,vA)=>{var dA=rt(),SQ=yt(),NQ=Wt();function TQ(r,e){try{return e=SQ(e)?Math.E:e,dA(r)?dA(e)?Math.log(r)/Math.log(e):NaN:NaN}catch{return NaN}}vA.exports=NQ(TQ)});var bA=X((Yct,yA)=>{var EQ=We(),IQ=gr(),CQ=Ke(),AQ=lt(),DQ=ut(),_Q=To();function gA(r){if(AQ(r)||DQ(r))return gA(r.values);EQ(CQ(r),"The `median` function only works on arrays, Series, and DataFrames!");try{let e=_Q(IQ(r));return e.length===0?NaN:e.length%2===0?(e[e.length/2-1]+e[e.length/2])/2:e[parseInt(e.length/2)]}catch{return NaN}}yA.exports=gA});var kA=X((Zct,xA)=>{var wA=rt(),FQ=Wt();function RQ(r,e){try{return wA(r)?wA(e)?r%e:NaN:NaN}catch{return NaN}}xA.exports=FQ(RQ)});var EA=X((Jct,TA)=>{var OQ=We(),PQ=Al(),MQ=gr(),BQ=Ke(),LQ=lt(),zQ=ut(),$Q=Ca(),SA=To();function NA(r){if(LQ(r)||zQ(r))return NA(r.values);OQ(BQ(r),"The `mode` function only works on arrays, Series, and DataFrames!");try{if(r.length===0)return NaN;let e=MQ(r);if(e.length===0)return NaN;let t={},n=$Q(e);n.forEach(s=>{t[s]=PQ(e,s)});let a=SA(n,(s,u)=>t[u]-t[s]),i=a[0];return SA(a.filter(s=>t[s]===t[i]))}catch{return NaN}}TA.exports=NA});var DA=X((Qct,AA)=>{var{random:IA}=Wu(),WQ=Ul(),qQ=yt(),UQ=No();function CA(){let r=IA(),e=IA();return Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*e)}function VQ(r){return qQ(r)?CA():WQ(UQ(r),CA)}AA.exports=VQ});var FA=X((elt,_A)=>{var GQ=Ul(),HQ=No();function KQ(r){return GQ(HQ(r),()=>1)}_A.exports=KQ});var OA=X((tlt,RA)=>{var vy=We(),jQ=gr(),XQ=Ke(),YQ=lt(),ZQ=rt(),JQ=ut(),QQ=yt();function zp(r,e){if(YQ(r)||JQ(r))return zp(r.values,e);if(vy(XQ(r),"The `permutations` function only works on arrays, Series, and DataFrames!"),QQ(e)&&(e=r.length),vy(ZQ(e),"`r` must be a whole number!"),r=jQ(r),e>r.length)return zp(r);if(e<=0)return[[]];if(vy(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(0,a),o=r.slice(a+1),s=i.concat(o);zp(s,e-1).forEach(c=>{t.push([n].concat(c))})}),t}RA.exports=zp});var MA=X((rlt,PA)=>{var{DataFrame:eee,Series:tee}=Wl(),ree=Ke(),nee=lt(),aee=Dl(),iee=ut(),oee=sr();function see(){Object.keys(arguments).forEach(r=>{let e=arguments[r];if(ree(e))if(aee(e))console.log(e);else{let t=oee(e);t.length===1?new tee(e).print():t.length==2?new eee(e).print():console.log(e)}else nee(e)||iee(e)?e.print():console.log(e)})}PA.exports=see});var zA=X((nlt,LA)=>{var uee=Ke(),cee=rt(),BA=yt(),lee=Vu(),fee=Sp(),hee=Wt(),pee=hee(function(r,e,t,n,a){try{return[r,e,t,n,a].every(i=>cee(i))?t-e===0?NaN:(a-n)*(r-e)/(t-e)+n:NaN}catch{return NaN}});function dee(r,e,t,n,a){return uee(r)&&BA(n)&&BA(a)&&(n=e,a=t,e=fee(r),t=lee(r)),pee(r,e,t,n,a)}LA.exports=dee});var WA=X((alt,$A)=>{var vee=rt(),mee=Wt();function gee(r){try{return vee(r)?Math.round(r):NaN}catch{return NaN}}$A.exports=mee(gee)});var UA=X((ilt,qA)=>{var yee=rt(),bee=Wt();function wee(r){try{return yee(r)?r<0?-1:r>0?1:0:NaN}catch{return NaN}}qA.exports=bee(wee)});var GA=X((olt,VA)=>{var xee=rt(),kee=Wt();function See(r){try{return xee(r)?Math.sin(r):NaN}catch{return NaN}}VA.exports=kee(See)});var KA=X((slt,HA)=>{var Nee=Ip();function Tee(r){return Nee(r)}HA.exports=Tee});var XA=X((ult,jA)=>{var Eee=rt(),Iee=Wt();function Cee(r){try{return Eee(r)?Math.tan(r):NaN}catch{return NaN}}jA.exports=Iee(Cee)});var $p=X((clt,JA)=>{var YA=We(),ZA=Cn();function Aee(r,e){YA(ZA(r),"`fn` must be a function!");let t=new Date;return e?r(...e):r(),new Date-t}async function Dee(r,e){YA(ZA(r),"`fn` must be a function!");let t=new Date;return e?await r(...e):await r(),new Date-t}JA.exports={timeSync:Aee,timeAsync:Dee}});var eD=X((llt,QA)=>{var _ee=Ke(),Fee=lt(),Ree=ut(),Oee=Ca();function Pee(){return Oee([...arguments].map(r=>_ee(r)?r:Fee(r)||Ree(r)?r.values:[r]))}QA.exports=Pee});var rD=X((flt,tD)=>{var Mee=We(),Bee=Ke(),Lee=lt(),zee=ut(),$ee=yt(),Wee=Vu(),qee=pa();function Uee(){let r=[],e=Object.values(arguments).map(t=>((Lee(t)||zee(t))&&(t=t.values),Mee(Bee(t),"The `zip` function only works on arrays, Series, and DataFrames!"),t));return qee(0,Wee(e.map(t=>t.length))).forEach(t=>{let n=[];e.forEach(a=>{let i=a[t];n.push($ee(i)?void 0:i)}),r.push(n)}),r}tD.exports=Uee});var Tt=X((hlt,my)=>{var{copy:Vee,decycle:Gee}=ji(),{DataFrame:Hee,Series:Kee}=Wl(),Hu={abs:xp(),add:kp(),apply:Ul(),arccos:$E(),arcsin:qE(),arctan:VE(),argmax:HE(),argmin:YE(),assert:We(),cast:Kg(),ceil:tI(),chop:aI(),clamp:oI(),combinations:uI(),copy:Vee,correl:CI(),cos:DI(),count:Al(),covariance:Jg(),DataFrame:Hee,dataTypes:FI(),decycle:Gee,diff:LI(),distance:JI(),divide:eC(),dot:oy(),dropMissing:sy(),dropMissingPairwise:mC(),dropNaN:Tg(),dropNaNPairwise:NC(),dropUndefined:EC(),exp:CC(),factorial:_C(),find:PC(),findAll:zC(),flatten:gr(),float:WC(),floor:UC(),identity:HC(),indexOf:Tl(),inferType:tA(),int:nA(),intersect:iA(),inverse:cA(),isArray:Ke(),isBoolean:vp(),isBrowser:fA(),isDataFrame:lt(),isDate:Il(),isEqual:ii(),isFunction:Cn(),isJagged:Dl(),isNested:ip(),isNumber:rt(),isObject:So(),isSeries:ut(),isString:qn(),isUndefined:yt(),lerp:pA(),log:mA(),MathError:Lu(),max:Vu(),mean:Np(),median:bA(),min:Sp(),mod:kA(),mode:EA(),multiply:ry(),ndarray:No(),normal:DA(),ones:FA(),permutations:OA(),pow:Cp(),print:MA(),product:Pl(),random:Wu().random,range:pa(),remap:zA(),reshape:pp(),reverse:_l(),round:WA(),scale:Gu(),seed:Wu().seed,Series:Kee,set:Ca(),shape:sr(),shuffle:dp(),sign:UA(),sin:GA(),sort:To(),sqrt:Ep(),std:Ip(),stdev:KA(),subtract:ny(),sum:Ap(),tan:XA(),time:$p().timeSync,timeSync:$p().timeSync,timeAsync:$p().timeAsync,transpose:ws(),union:eD(),variance:Qg(),vectorize:Wt(),zeros:ly(),zip:rD(),dump:function(){let r=typeof globalThis<"u"?globalThis:typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:void 0;if(!r)throw new Hu.MathError("Cannot dump functions into global scope because none of `globalThis`, `global`, `window`, or `self` exist in the current context!");Object.keys(Hu).forEach(e=>{try{Object.defineProperty(r,e,{configurable:!1,enumerable:!0,writable:!1,value:Hu[e]})}catch{r[e]=Hu[e]}})}};typeof my<"u"&&(my.exports=Hu);typeof window<"u"&&(window.JSMathTools=Hu)});var nD=X(()=>{});var aD=X(()=>{});var Wp=X(()=>{});var Ls=X(D=>{"use strict";function jee(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var Sy=function(r,e){return Sy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Sy(r,e)};function eo(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Sy(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function qe(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Ue(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function nn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Se(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function wt(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Xee=1e-7,Yee=1e-4,Zee=function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),ED=function(){function r(){}return r.prototype.refCount=function(e){return Vn("refCount")},r.prototype.incRef=function(e){return Vn("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return Vn("time")},r.prototype.read=function(e){return Vn("read")},r.prototype.readSync=function(e){return Vn("readSync")},r.prototype.readToGPU=function(e,t){return Vn("readToGPU")},r.prototype.numDataIds=function(){return Vn("numDataIds")},r.prototype.disposeData=function(e,t){return Vn("disposeData")},r.prototype.write=function(e,t,n){return Vn("write")},r.prototype.move=function(e,t,n,a,i){return Vn("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return Vn("createTensorFromGPUData")},r.prototype.memory=function(){return Vn("memory")},r.prototype.floatPrecision=function(){return Vn("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Xee:Yee},r.prototype.dispose=function(){return Vn("dispose")},r}();function Vn(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function ID(r){for(var e=r.length,t=0;e>0;)t=Math.random()*e|0,e--,jp(r,e,t)}function Jee(r,e){if(r.length!==e.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(r.length)+"Second array length was ".concat(e.length));for(var t=r.length,n=0;t>0;)n=Math.random()*t|0,t--,jp(r,t,n),jp(e,t,n)}function Yl(r,e,t){return Math.max(r,Math.min(e,t))}function Qee(r){return r%2===0?r:r+1}function jp(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function ete(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function tte(r,e){var t=Math.random();return e*t+(1-t)*r}function rte(r,e){for(var t=0,n=0;n<r.length;n++){var a=Number(r[n])-Number(e[n]);t+=a*a}return t}function W(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function xn(r,e,t){t===void 0&&(t=""),W(to(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function Os(r){W(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Lt(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function nte(r){return r.length===0}function CD(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==null&&e[t]!==null&&r[t]!==e[t])return!1;return!0}function to(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function nc(r){return r%1===0}function ate(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function ite(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function ote(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return ID(e),e}function Kl(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function ste(r,e,t,n){return e===void 0&&(e=function(a){return 0}),new Promise(function(a,i){var o=0,s=function(){if(r()){a();return}o++;var u=e(o);if(t!=null&&o>=t){i();return}n!=null?n(s,u):setTimeout(s,u)};s()})}function ute(r,e){for(var t=1,n=-1,a=0;a<r.length;++a)if(r[a]>=0)t*=r[a];else if(r[a]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(n," and dim ").concat(a));n=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found ".concat(r[a]," at dim ").concat(a));if(n===-1){if(e>0&&e!==t)throw Error("Size(".concat(e,") must match the product of shape ").concat(r));return r}if(t===0)throw Error("Cannot infer the missing size in [".concat(r,"] when ")+"there are 0 elements");if(e%t!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(e," / ").concat(t));var i=r.slice();return i[n]=e/t,i}function hf(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),W(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),W(r.every(function(n){return nc(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function AD(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:hf(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(r[s],"' is not 1"));(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function DD(r,e){return Xy(r,e)}function Xy(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function _D(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function FD(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function cte(r,e){return!(e==="complex64"||e==="float32"&&r!=="complex64"||e==="int32"&&r!=="float32"&&r!=="complex64"||e==="bool"&&r==="bool")}function Xp(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function RD(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function Oo(r){return typeof r=="string"||r instanceof String}function OD(r){return typeof r=="boolean"}function PD(r){return typeof r=="number"}function pf(r){return Array.isArray(r)?pf(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":PD(r)?"float32":Oo(r)?"string":OD(r)?"bool":"float32"}function Lo(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Yp(r,e){for(var t=e;t<r;++t)if(r%t===0)return t;return r}function sc(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function MD(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=MD(r+o*u,s,t,n);return a}function Zu(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return MD(0,r,e,t)}function lte(r,e){if(Array.isArray(r))return r;if(e==="float32")return r instanceof Float32Array?r:new Float32Array(r);if(e==="int32")return r instanceof Int32Array?r:new Int32Array(r);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(r));throw new Error("Unknown dtype ".concat(e))}function Yy(r,e){for(var t=sd(r,e),n=0;n<t.length;n++)t[n]=1;return t}function sd(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function fte(r,e){var t=r.reduce(function(n,a){return n*a},1);if(e==null||e==="float32")return Zu(r,new Float32Array(t));if(e==="int32")return Zu(r,new Int32Array(t));if(e==="bool")return Zu(r,new Uint8Array(t));throw new Error("Unknown data type ".concat(e))}function Kn(r){r.forEach(function(e){W(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function hte(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],a=0;a<r.length-1;++a)n+=t[a]*r[a];return n}function pte(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),a=0;a<n.length-1;++a)n[a]=Math.floor(r/t[a]),r-=n[a]*t[a];return n[n.length-1]=r,n}function ud(r){return r&&r.then&&typeof r.then=="function"}var iD="tfjsflags",BD=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=dte,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(pt().getBool("IS_TEST")||pt().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];pt().getBool("IS_TEST")||pt().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return qe(this,void 0,void 0,function(){var t,n;return Ue(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(ud(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(iD in t){var n=t[iD].split(",");n.forEach(function(a){var i=Se(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=mte(o,s)})}}},r}();function dte(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return vte(e,n[0],n[1]),n.join("=")}),e}function vte(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function mte(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function pt(){return D.ENV}D.ENV=null;function gte(r){D.ENV=r}var gy;function LD(){if(gy==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");gy=r}return gy}function yte(){var r=LD();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Zy(r,e){var t=yte();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var zD="Abs",$D="Acos",WD="Acosh",Jy="Add",qD="AddN",UD="All",VD="Any",GD="ArgMax",HD="ArgMin",KD="Asin",jD="Asinh",XD="Atan",YD="Atanh",ZD="Atan2",JD="AvgPool",bte="AvgPoolGrad",QD="AvgPool3D",wte="AvgPool3DGrad",e3="BatchMatMul",t3="BatchToSpaceND",r3="Bincount",n3="BitwiseAnd",xte="BroadcastTo",a3="BroadcastArgs",Qy="Cast",i3="Ceil",o3="ClipByValue",s3="Complex",u3="ComplexAbs",c3="Concat",l3="Conv2D",f3="Conv2DBackpropFilter",h3="Conv2DBackpropInput",p3="Conv3D",kte="Conv3DBackpropFilterV2",d3="Conv3DBackpropInputV2",v3="Cos",m3="Cosh",g3="Cumprod",y3="Cumsum",b3="CropAndResize",w3="DenseBincount",x3="DepthToSpace",k3="DepthwiseConv2dNative",S3="DepthwiseConv2dNativeBackpropFilter",N3="DepthwiseConv2dNativeBackpropInput",T3="Diag",E3="Dilation2D",Ste="Dilation2DBackpropInput",Nte="Dilation2DBackpropFilter",e0="Draw",I3="RealDiv",C3="Einsum",A3="Elu",Tte="EluGrad",D3="Erf",_3="Equal",F3="Exp",R3="ExpandDims",O3="Expm1",P3="FFT",M3="Fill",B3="FlipLeftRight",L3="Floor",z3="FloorDiv",$3="FusedBatchNorm",W3="GatherV2",q3="GatherNd",U3="Greater",V3="GreaterEqual",t0="Identity",G3="IFFT",H3="Imag",K3="IsFinite",j3="IsInf",X3="IsNan",Y3="LeakyRelu",Z3="Less",J3="LessEqual",Q3="LinSpace",e_="Log",t_="Log1p",r_="LogicalAnd",n_="LogicalNot",a_="LogicalOr",Ete="LogicalXor",Ite="LogSoftmax",Cte="LowerBound",i_="LRN",Ate="LRNGrad",Dte="MatrixBandPart",o_="Max",s_="Maximum",u_="MaxPool",_te="MaxPoolGrad",c_="MaxPool3D",Fte="MaxPool3DGrad",l_="MaxPoolWithArgmax",f_="Mean",h_="Min",p_="Minimum",d_="MirrorPad",v_="Mod",m_="Multinomial",g_="Multiply",y_="Neg",b_="NotEqual",w_="NonMaxSuppressionV3",x_="NonMaxSuppressionV4",k_="NonMaxSuppressionV5",S_="OnesLike",N_="OneHot",T_="Pack",E_="PadV2",Rte="Pool",I_="Pow",C_="Prelu",A_="Prod",D_="RaggedGather",__="RaggedRange",F_="RaggedTensorToTensor",R_="Range",O_="Real",P_="Reciprocal",M_="Relu",B_="Reshape",L_="ResizeNearestNeighbor",Ote="ResizeNearestNeighborGrad",z_="ResizeBilinear",Pte="ResizeBilinearGrad",$_="Relu6",W_="Reverse",q_="Round",U_="Rsqrt",V_="ScatterNd",G_="TensorScatterUpdate",H_="SearchSorted",K_="Select",j_="Selu",X_="Slice",Y_="Sin",Z_="Sinh",J_="Sign",Q_="Sigmoid",eF="Softplus",tF="Sqrt",rF="Sum",nF="SpaceToBatchND",aF="SplitV",iF="Softmax",oF="SparseFillEmptyRows",sF="SparseReshape",uF="SparseSegmentMean",cF="SparseSegmentSum",lF="SparseToDense",fF="SquaredDifference",Mte="Square",hF="StaticRegexReplace",pF="StridedSlice",dF="StringNGrams",vF="StringSplit",mF="StringToHashBucketFast",gF="Sub",yF="Tan",bF="Tanh",r0="Tile",wF="TopK",xF="Transform",Vp="Transpose",kF="Unique",SF="Unpack",NF="UnsortedSegmentSum",Bte="UpperBound",TF="ZerosLike",EF="Step",Ny="FromPixels",IF="RotateWithOffset",Ty="_FusedMatMul",Ey="FusedConv2D",Iy="FusedDepthwiseConv2D";function Ro(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];pt().getBool("IS_TEST")||pt().getBool("PROD")||console.warn.apply(console,wt([],Se(r),!1))}function Lte(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];pt().getBool("IS_TEST")||pt().getBool("PROD")||console.log.apply(console,wt([],Se(r),!1))}var ac=Zy("kernelRegistry",function(){return new Map}),Zl=Zy("gradRegistry",function(){return new Map});function Jl(r,e){var t=n0(r,e);return ac.get(t)}function Cy(r){return Zl.get(r)}function Zp(r){for(var e=ac.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=Se(i,2),s=o[0],u=o[1],c=Se(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function CF(r){var e=r.kernelName,t=r.backendName,n=n0(e,t);ac.has(n)&&Ro("The kernel '".concat(e,"' for backend ")+"'".concat(t,"' is already registered")),ac.set(n,r)}function zte(r){var e=r.kernelName;Zl.has(e)&&pt().getBool("DEBUG")&&Ro("Overriding the gradient for '".concat(e,"'")),Zl.set(e,r)}function $te(r,e){var t=n0(r,e);if(!ac.has(t))throw new Error("The kernel '".concat(r,"' for backend ")+"'".concat(e,"' is not registered"));ac.delete(t)}function Wte(r){if(!Zl.has(r))throw new Error("The gradient '".concat(r,"' for backend is not registered"));Zl.delete(r)}function qte(r,e){var t=Zp(r);t.forEach(function(n){var a=Object.assign({},n,{backendName:e});CF(a)})}function n0(r,e){return"".concat(e,"_").concat(r)}function AF(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var Ps=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ute(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var DF=jt,_a=null;try{_a=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function jt(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}jt.prototype.__isLong__;Object.defineProperty(jt.prototype,"__isLong__",{value:!0});function jn(r){return(r&&r.__isLong__)===!0}jt.isLong=jn;var oD={},sD={};function Ms(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=sD[r],n)?n:(t=Xt(r,(r|0)<0?-1:0,!0),a&&(sD[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=oD[r],n)?n:(t=Xt(r,r<0?-1:0,!1),a&&(oD[r]=t),t))}jt.fromInt=Ms;function Fa(r,e){if(isNaN(r))return e?Ns:Ra;if(e){if(r<0)return Ns;if(r>=_F)return OF}else{if(r<=-cD)return Gn;if(r+1>=cD)return RF}return r<0?Fa(-r,e).neg():Xt(r%ic|0,r/ic|0,e)}jt.fromNumber=Fa;function Xt(r,e,t){return new jt(r,e,t)}jt.fromBits=Xt;var Jp=Math.pow;function a0(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Ra;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return a0(r.substring(1),e,t).neg();for(var a=Fa(Jp(t,8)),i=Ra,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Fa(Jp(t,s));i=i.mul(c).add(Fa(u))}else i=i.mul(a),i=i.add(Fa(u))}return i.unsigned=e,i}jt.fromString=a0;function ui(r,e){return typeof r=="number"?Fa(r,e):typeof r=="string"?a0(r,e):Xt(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}jt.fromValue=ui;var uD=1<<16,Vte=1<<24,ic=uD*uD,_F=ic*ic,cD=_F/2,lD=Ms(Vte),Ra=Ms(0);jt.ZERO=Ra;var Ns=Ms(0,!0);jt.UZERO=Ns;var Yu=Ms(1);jt.ONE=Yu;var FF=Ms(1,!0);jt.UONE=FF;var Ay=Ms(-1);jt.NEG_ONE=Ay;var RF=Xt(-1,2147483647,!1);jt.MAX_VALUE=RF;var OF=Xt(-1,-1,!0);jt.MAX_UNSIGNED_VALUE=OF;var Gn=Xt(0,-2147483648,!1);jt.MIN_VALUE=Gn;var _e=jt.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*ic+(this.low>>>0):this.high*ic+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Gn)){var t=Fa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Fa(Jp(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Gn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return jn(e)||(e=ui(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(jn(e)||(e=ui(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(Gn)?Gn:this.not().add(Yu)};_e.neg=_e.negate;_e.add=function(e){jn(e)||(e=ui(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Xt(h<<16|p,l<<16|f,this.unsigned)};_e.subtract=function(e){return jn(e)||(e=ui(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return Ra;if(jn(e)||(e=ui(e)),_a){var t=_a.mul(this.low,this.high,e.low,e.high);return Xt(t,_a.get_high(),this.unsigned)}if(e.isZero())return Ra;if(this.eq(Gn))return e.isOdd()?Gn:Ra;if(e.eq(Gn))return this.isOdd()?Gn:Ra;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(lD)&&e.lt(lD))return Fa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,Xt(p<<16|d,f<<16|h,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(jn(e)||(e=ui(e)),e.isZero())throw Error("division by zero");if(_a){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?_a.div_u:_a.div_s)(this.low,this.high,e.low,e.high);return Xt(t,_a.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ns:Ra;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ns;if(e.gt(this.shru(1)))return FF;i=Ns}else{if(this.eq(Gn)){if(e.eq(Yu)||e.eq(Ay))return Gn;if(e.eq(Gn))return Yu;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Ra)?e.isNegative()?Yu:Ay:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Gn))return this.unsigned?Ns:Ra;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ra}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Jp(2,s-48),c=Fa(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Fa(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=Yu),i=i.add(c),a=a.sub(l)}return i};_e.div=_e.divide;_e.modulo=function(e){if(jn(e)||(e=ui(e)),_a){var t=(this.unsigned?_a.rem_u:_a.rem_s)(this.low,this.high,e.low,e.high);return Xt(t,_a.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return Xt(~this.low,~this.high,this.unsigned)};_e.and=function(e){return jn(e)||(e=ui(e)),Xt(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return jn(e)||(e=ui(e)),Xt(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return jn(e)||(e=ui(e)),Xt(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return jn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Xt(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return jn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Xt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(jn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return Xt(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Xt(t,0,this.unsigned):Xt(t>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?Xt(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:Xt(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};jt.fromBytes=function(e,t,n){return n?jt.fromBytesLE(e,t):jt.fromBytesBE(e,t)};jt.fromBytesLE=function(e,t){return new jt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};jt.fromBytesBE=function(e,t){return new jt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var PF=Ute(DF),Gte=jee({__proto__:null,default:PF},[DF]),Ss=PF||Gte;function df(r){return Ss.fromString(r,!0,16)}var MF=df("c3a5c85c97cb3127"),ks=df("b492b66fbe98f273"),wn=df("9ae16a3b2f90404f");function Dy(r){return r.xor(r.shru(47))}function BF(r,e,t){var n=r.slice(e,e+t);return Ss.fromBytes(Array.from(n),!0,!0)}function Vt(r,e){return BF(r,e,8)}function fD(r,e){return BF(r,e,4)}function jr(r,e){return e===0?r:r.shru(e).or(r.shl(64-e))}function Mo(r,e,t){t===void 0&&(t=df("9ddfea08eb382d69"));var n=r.xor(e).mul(t);n=n.xor(n.shru(47));var a=e.xor(n).mul(t);return a=a.xor(a.shru(47)),a=a.mul(t),a}function Hte(r,e,t,n,a,i){a=a.add(r),i=jr(i.add(a).add(n),21);var o=a;return a=a.add(e),a=a.add(t),i=i.add(jr(a,44)),[a.add(n),i.add(o)]}function qp(r,e,t,n){return Hte(Vt(r,e),Vt(r,e+8),Vt(r,e+16),Vt(r,e+24),t,n)}function Kte(r,e){if(e===void 0&&(e=r.length),e>=8){var t=wn.add(e*2),n=Vt(r,0).add(wn),a=Vt(r,e-8),i=jr(a,37).mul(t).add(n),o=jr(n,25).add(a).mul(t);return Mo(i,o,t)}if(e>=4){var t=wn.add(e*2),n=fD(r,0);return Mo(n.shl(3).add(e),fD(r,e-4),t)}if(e>0){var n=r[0],a=r[e>>1],i=r[e-1],s=n+(a<<8),u=e+(i<<2);return Dy(wn.mul(s).xor(MF.mul(u))).mul(wn)}return wn}function jte(r,e){e===void 0&&(e=r.length);var t=wn.add(e*2),n=Vt(r,0).mul(ks),a=Vt(r,8),i=Vt(r,e-8).mul(t),o=Vt(r,e-16).mul(wn);return Mo(jr(n.add(a),43).add(jr(i,30)).add(o),n.add(jr(a.add(wn),18)).add(i),t)}function Xte(r,e){e===void 0&&(e=r.length);var t=wn.add(e*2),n=Vt(r,0).mul(wn),a=Vt(r,8),i=Vt(r,e-8).mul(t),o=Vt(r,e-16).mul(wn),s=jr(n.add(a),43).add(jr(i,30)).add(o),u=Mo(s,n.add(jr(a.add(wn),18)).add(i),t),c=Vt(r,16).mul(t),l=Vt(r,24),f=s.add(Vt(r,e-32)).mul(t),h=u.add(Vt(r,e-24)).mul(t);return Mo(jr(c.add(l),43).add(jr(f,30)).add(h),c.add(jr(l.add(n),18)).add(f),t)}function Yte(r,e){var t,n;e===void 0&&(e=r.length);var a=Ss.fromNumber(81,!0);if(e<=32)return e<=16?Kte(r,e):jte(r,e);if(e<=64)return Xte(r,e);var i=a,o=a.mul(ks).add(113),s=Dy(o.mul(wn).add(113)).mul(wn),u=[Ss.UZERO,Ss.UZERO],c=[Ss.UZERO,Ss.UZERO];i=i.mul(wn).add(Vt(r,0));var l=0,f=(e-1>>6)*64,h=f+(e-1&63)-63;do i=jr(i.add(o).add(u[0]).add(Vt(r,l+8)),37).mul(ks),o=jr(o.add(u[1]).add(Vt(r,l+48)),42).mul(ks),i=i.xor(c[1]),o=o.add(u[0]).add(Vt(r,l+40)),s=jr(s.add(c[0]),33).mul(ks),u=qp(r,l,u[1].mul(ks),i.add(c[0])),c=qp(r,l+32,s.add(c[1]),o.add(Vt(r,l+16))),t=Se([i,s],2),s=t[0],i=t[1],l+=64;while(l!==f);var p=ks.add(s.and(255).shl(1));return l=h,c[0]=c[0].add(e-1&63),u[0]=u[0].add(c[0]),c[0]=c[0].add(u[0]),i=jr(i.add(o).add(u[0]).add(Vt(r,l+8)),37).mul(p),o=jr(o.add(u[1]).add(Vt(r,l+48)),42).mul(p),i=i.xor(c[1].mul(9)),o=o.add(u[0].mul(9).add(Vt(r,l+40))),s=jr(s.add(c[0]),33).mul(p),u=qp(r,l,u[1].mul(p),i.add(c[0])),c=qp(r,l+32,s.add(c[1]),o.add(Vt(r,l+16))),n=Se([i,s],2),s=n[0],i=n[1],Mo(Mo(u[0],c[0],p).add(Dy(o).mul(MF)).add(s),Mo(u[1],c[1],p).add(i),p)}function Zte(r,e){return e==="string"?vf(r):cd([r],e)}function Jte(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function cd(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=zo(r)),pt().getBool("DEBUG")&&_D(r,e),Jte(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Ql(){return pt().platform.now()}function Qte(r,e){return pt().platform.fetch(r,e)}function vf(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",pt().platform.encode(r,e)}function Qp(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",pt().platform.decode(r,e)}function Xr(r){return pt().platform.isTypedArray!=null?pt().platform.isTypedArray(r):AF(r)}function zo(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||ud(r)||r==null||Xr(r)&&t)e.push(r);else if(Array.isArray(r)||Xr(r))for(var i=0;i<r.length;++i)zo(r[i],e,t);else{var o=-1;try{for(var s=nn(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)zo(r[i],e,t)}return e}var ere={__proto__:null,arraysEqual:to,arraysEqualWithNull:CD,assert:W,assertNonNegativeIntegerDimensions:Kn,assertNonNull:Os,assertShapesMatch:xn,bytesFromStringArray:RD,bytesPerElement:Xp,checkConversionForErrors:_D,clamp:Yl,computeStrides:sc,convertBackendValuesAndArrayBuffer:lte,createScalarValue:Zte,createShuffledIndices:ote,decodeString:Qp,distSquared:rte,encodeString:vf,fetch:Qte,fingerPrint64:Yte,flatten:zo,getArrayFromDType:Xy,getTypedArrayFromDType:DD,hasEncodingLoss:cte,hexToLong:df,indexToLoc:pte,inferDtype:pf,inferFromImplicitShape:ute,isBoolean:OD,isFunction:Lo,isInt:nc,isNumber:PD,isPromise:ud,isScalarShape:nte,isString:Oo,isTypedArray:Xr,isValidDtype:FD,locToIndex:hte,makeOnesTypedArray:Yy,makeZerosNestedTypedArray:fte,makeZerosTypedArray:sd,nearestDivisor:Yp,nearestLargerEven:Qee,now:Ql,parseAxisParam:hf,randUniform:tte,repeatedTry:ste,rightPad:Kl,shuffle:ID,shuffleCombo:Jee,sizeFromShape:Lt,sizeToSquarishShape:ite,squeezeShape:AD,sum:ete,swap:jp,tanh:ate,toNestedArray:Zu,toTypedArray:cd},tre=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new nre)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=Ql();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=nn(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Ql()-c})}if(pt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){rre(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r}();function rre(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var nre=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?Kl("".concat(a,"ms"),9):a.error,u=Kl(e,25),c=t.rank,l=t.size,f=Kl(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function are(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function ire(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!to(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var hD=20,Vl=3,yy=7;function ore(r,e,t,n){var a=sc(e),i=sre(r,e,t,a),o=e.length,s=Gp(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function sre(r,e,t,n){var a=Lt(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Hl(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Gl(u[l+f],0,t).length);return o}function Gl(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(yy))," + ")+"".concat(parseFloat(r[1].toFixed(yy)),"j"):Oo(r)?n="'".concat(r,"'"):t==="bool"?n=LF(r):n=parseFloat(r.toFixed(yy)).toString(),Kl(n,e)}function LF(r){return r===0?"false":"true"}function Gp(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Hl(r);return[Gl(c[0],0,t)]}return t==="bool"?[LF(r[0])]:[r[0].toString()]}if(u===1){if(s>hD){var l=Vl*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-Vl)*o,s*o));return t==="complex64"&&(f=Hl(f),h=Hl(h)),["["+f.map(function(T,E){return Gl(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Gl(T,a[s-Vl+E],t)}).join(", ")+"]"]}var p=t==="complex64"?Hl(r):Array.from(r);return["["+p.map(function(T,E){return Gl(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>hD){for(var y=0;y<Vl;y++){var w=y*v,b=w+v;g.push.apply(g,wt([],Se(Gp(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-Vl;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,wt([],Se(Gp(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,wt([],Se(Gp(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function Hl(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var ed=function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Lt(e),n!=null){var i=n.length;W(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Xy(t,this.size),this.strides=sc(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),W(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=nn(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return oi().makeTensor(this.values,this.shape,this.dtype)},r}(),oi=null,Ku=null;function ure(r){oi=r}function cre(r){Ku=r}var Pr=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Lt(e),this.strides=sc(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return qe(this,void 0,void 0,function(){var e;return Ue(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Ku.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return Ku.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return qe(this,void 0,void 0,function(){var e;return Ue(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Zu(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return Zu(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return qe(this,void 0,void 0,function(){var e,t;return Ue(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=oi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return Qp(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),oi().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=oi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Qp(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return qe(this,void 0,void 0,function(){var e;return Ue(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,oi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),oi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),Ku.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Ku.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return ore(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Ku.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),oi().makeVariable(this,e,t,n)},r}();Object.defineProperty(Pr,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function zF(){return Zy("Tensor",function(){return Pr})}zF();var ef=function(r){eo(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!to(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));oi().disposeTensor(this),this.dataId=t.dataId,oi().incRef(this,null)},e.prototype.dispose=function(){oi().disposeVariable(this),this.isDisposedInternal=!0},e}(Pr);Object.defineProperty(ef,Symbol.hasInstance,{value:function(r){return r instanceof Pr&&r.assign!=null&&r.assign instanceof Function}});D.Rank=void 0;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(D.Rank||(D.Rank={}));var _y;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(_y||(_y={}));var Fy;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(Fy||(Fy={}));var Ry;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(Ry||(Ry={}));var Oy;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Oy||(Oy={}));var lre={float32:Ry,int32:_y,bool:Fy,complex64:Oy};function ld(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return lre[r][e]}function fre(r){return ld(r,"int32")}function $F(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function WF(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function yr(r,e){if(r.dtype===e.dtype)return[r,e];var t=ld(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function qF(r,e){W(r.dtype===e.dtype,function(){return"The dtypes of the first(".concat(r.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function hre(r,e){return e.some(function(t){return t.id===r.id})}function i0(r){var e=[],t=new Set;return UF(r,e,t),e}function UF(r,e,t){if(r!=null){if(r instanceof Pr){e.push(r);return}if(!!pre(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),UF(i,e,t))}}}}function pre(r){return Array.isArray(r)||typeof r=="object"}var dre={__proto__:null,assertTypesMatch:qF,getTensorsInContainer:i0,isTensorInList:hre,makeTypesMatch:yr};function by(r){return r.kernelName!=null}var pD=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),o0=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new pD}return r.prototype.ready=function(){return qe(this,void 0,void 0,function(){var e,t,n,a;return Ue(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(Ro("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return qe(this,void 0,void 0,function(){var t,n,a,i,o;return Ue(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new tre(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=Zp(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=Zp(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof ED)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Ro("Initialization of backend ".concat(e," failed")),Ro(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Ro("Initialization of backend ".concat(e," failed")),Ro(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=H.runKernel(t0,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return H.runKernel(Qy,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=Jl(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=by(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(by(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=Jl(f,this.backendName);W(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=by(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=Cy(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(W(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&Oo(e[0])&&(i=e.map(function(l){return vf(l)}));var o=a.write(i,t,n),s=new Pr(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=RD(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Pr(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new ef(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*Xp(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof ef||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*Xp(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return qe(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ue(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,wt([],Se(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=nn(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=Cy(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=sd(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=i0(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),W(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});W(o instanceof Pr,function(){return"The result y returned by f() must be a tensor."});var s=are(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??vre(o.shape),ire(u,s,function(l){return i.tidy(l)},mre);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=nn(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return W(Lo(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];W(n.every(function(c){return c instanceof Pr}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,wt([],Se(wt(wt([],Se(n),!1),[l],!1)),!1)),W(i.value instanceof Pr,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),W(Lo(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];W(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),W(h.every(function(d){return d instanceof Pr}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return qe(this,void 0,void 0,function(){var t,n;return Ue(this,function(a){switch(a.label){case 0:return t=Ql(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Ql()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new pD;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();o0.nextTensorId=0;o0.nextVariableId=0;function vre(r){var e=Yy(Lt(r),"float32");return H.makeTensor(e,r,"float32")}function VF(){var r=LD();if(r._tfengine==null){var e=new BD(r);r._tfengine=new o0(e)}return gte(r._tfengine.ENV),ure(function(){return r._tfengine}),r._tfengine}var H=VF();function mre(r,e){var t={a:r,b:e};return H.runKernel(Jy,t)}function gre(){return typeof navigator<"u"&&navigator!=null}var Py;function yre(r){Py=r}function bre(r){if(Py!==void 0)return Py;if(r||gre()){if(r||(r=navigator),r.product==="ReactNative")return!0;var e=r.userAgent||r.vendor||(typeof window<"u"?window.opera:"");if(!e){var t=r;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function GF(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var wre={__proto__:null,isBrowser:GF,isMobile:bre,mockIsMobile:yre};var Dn=pt();Dn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Dn.registerFlag("IS_BROWSER",function(){return GF()});Dn.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});Dn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});Dn.registerFlag("IS_SAFARI",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)});Dn.registerFlag("PROD",function(){return!1});Dn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Dn.getBool("DEBUG")});Dn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});Dn.registerFlag("IS_TEST",function(){return!1});Dn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return Dn.getBool("DEBUG")});Dn.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});Dn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});Dn.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function Ai(r,e){var t=r;if(Xr(r))return e==="string"?[]:[r.length];if($F(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(WF(r))return[r.buffer.size/(e==null?4:Xp(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||Xr(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&pt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&HF(r,a,[]),a}function HF(r,e,t){if(t=t||[],!Array.isArray(r)&&!Xr(r)){W(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}W(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),W(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)HF(r[a],n,t.concat(a))}function dD(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function O(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof zF())return dD(n,r.dtype,e,t),r;var a=pf(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),dD(n,a,e,t),r==null||!Xr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Ai(r,a);!Xr(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?cd(r,a):zo(r,[],s);return H.makeTensor(u,o,a)}function tf(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return O(i,"".concat(e,"[").concat(o,"]"),t,n)})}var KF="__op";function G(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+KF;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];H.startScope(t);try{var s=n.apply(void 0,wt([],Se(i),!1));return ud(s)&&console.error("Cannot return a Promise inside of tidy."),H.endScope(s),s}catch(u){throw H.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function xre(r,e){var t=O(r,"real","complex"),n=O(e,"imag","complex");xn(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return H.runKernel(s3,a)}var $o=G({complex_:xre});function Uo(r,e,t,n){if(n==null)n=pf(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(WF(r)||$F(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return H.backend.createTensorFromGPUData(r,e||t,n)}if(!Xr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Kn(e);var a=Lt(e),i=Lt(t);W(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Lt(e.slice(o)):!0;W(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!Xr(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?cd(r,n):zo(r,[],!0),H.makeTensor(r,e,n)}function Ju(r,e,t){var n=Ai(r,t);return Uo(r,e,n,t)}var Cs={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},ro=function(){function r(e){if(this.shards=[],this.previousShardIndex=0,e!=null&&(e instanceof Array||(e=[e]),e=e.map(function(o){return Xr(o)?o.buffer:o}),e.length!==0)){this.bufferUniformSize=e[0].byteLength;for(var t=0,n=0;n<e.length;n++){var a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return r.join=function(e){return new r(e).slice()},r.prototype.slice=function(e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.byteLength),this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(n===-1)throw new Error("Could not find start shard for byte ".concat(e));for(var a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0,u=n;u<this.shards.length;u++){var c=this.shards[u],l=e+s,f=l-c.start,h=s,p=Math.min(t,c.end),d=p-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i},r.prototype.findShardForByte=function(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;var n=kre(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)},r}();function kre(r,e){for(var t=0,n=r.length;t<=n;){var a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}function Sre(){pt().set("PROD",!0)}function Nre(){pt().set("DEBUG",!0)}function Tre(){pt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Ere(r){pt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ire(){H.disposeVariables()}function Cre(){return H}function Are(){return H.memory()}function Dre(r){return H.profile(r)}function Mr(r,e){return H.tidy(r,e)}function An(r){var e=i0(r);e.forEach(function(t){return t.dispose()})}function jF(r){return H.keep(r)}function _re(r){return H.time(r)}function Fre(r){return H.setBackend(r)}function Rre(){return H.ready()}function XF(){return H.backendName}function Ore(r){H.removeBackend(r)}function Pre(r){return H.findBackend(r)}function Mre(r){return H.findBackendFactory(r)}function Bre(r,e,t){return t===void 0&&(t=1),H.registerBackend(r,e,t)}function YF(){return H.backend}function Lre(r,e){pt().setPlatform(r,e)}var Wo=4;function zre(r,e){return qe(this,void 0,void 0,function(){var t,n,a,i,o,s,u=this;return Ue(this,function(c){switch(c.label){case 0:for(t=[],n=[],a=Array.isArray(r)?r.map(function(l){return l.name}):Object.keys(r),i=function(l){var f=a[l],h=Array.isArray(r)?r[l].tensor:r[f];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h.dtype));var p={name:f,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(m){return qe(u,void 0,void 0,function(){var v,g,y,w,b,x,S;return Ue(this,function(T){switch(T.label){case 0:return[4,h.bytes()];case 1:for(v=T.sent(),g=v.reduce(function(E,C){return E+C.length},0)+Wo*v.length,y=new Uint8Array(g),w=0,b=0;b<v.length;b++)x=v[b],S=new Uint8Array(new Uint32Array([x.length]).buffer),y.set(S,w),w+=Wo,y.set(x,w),w+=x.length;return m(y),[2]}})})});n.push(d)}else n.push(h.data());e!=null&&(p.group=e),t.push(p)},o=0;o<a.length;++o)i(o);return[4,Promise.all(n)];case 1:return s=c.sent(),[2,{data:Ure(s),specs:t}]}})})}function ZF(r,e){var t,n,a=new ro(r),i={},o=0;try{for(var s=nn(e),u=s.next();!u.done;u=s.next()){var c=u.value,l=$re(c,function(f,h){return a.slice(o+f,o+h)});i[c.name]=JF(c,a.slice(o,o+l)),o+=l}}catch(f){t={error:f}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return i}function $re(r,e){var t=Lt(r.shape),n;if("quantization"in r){var a=r.quantization;n=Cs[a.dtype]}else if(r.dtype==="string"){for(var i=0,o=0;o<t;o++)i+=Wo+new Uint32Array(e(i,i+Wo))[0];return i}else n=Cs[r.dtype];return t*n}function Wre(r,e){return qe(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c;return Ue(this,function(l){switch(l.label){case 0:return t=Lt(r.shape),"quantization"in r?(a=r.quantization,n=Cs[a.dtype],[3,7]):[3,1];case 1:if(r.dtype!=="string")return[3,6];i=0,o=0,l.label=2;case 2:return o<t?(s=i,u=Wo,c=Uint32Array.bind,[4,e(i,i+Wo)]):[3,5];case 3:i=s+(u+new(c.apply(Uint32Array,[void 0,l.sent()]))()[0]),l.label=4;case 4:return o++,[3,2];case 5:return[2,i];case 6:n=Cs[r.dtype],l.label=7;case 7:return[2,t*n]}})})}function JF(r,e){var t=r.name,n=r.dtype,a=r.shape,i=Lt(a),o,s=0;if("quantization"in r){var u=r.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error("Weight ".concat(r.name," with quantization ").concat(u.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(u.dtype==="float16"){if(n!=="float32")throw new Error("Weight ".concat(r.name," is quantized with ").concat(u.dtype," ")+"which only supports weights of type float32 not ".concat(n,"."))}else throw new Error("Weight ".concat(r.name," has unknown ")+"quantization dtype ".concat(u.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var c=Cs[u.dtype],l=u.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(n==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){o=new Float32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=h*u.scale+u.min}}else if(u.dtype==="float16"){var p=Yre();o=p(l)}else throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type float32.");else if(n==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type int32.");o=new Int32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=Math.round(h*u.scale+u.min)}}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*c}else if(n==="string"){var d=Lt(r.shape);o=[];for(var f=0;f<d;f++){var m=new Uint32Array(e.slice(s,s+Wo))[0];s+=Wo;var v=new Uint8Array(e.slice(s,s+m));o.push(v),s+=m}}else{var g=Cs[n];if(n==="float32")o=new Float32Array(e);else if(n==="int32")o=new Int32Array(e);else if(n==="bool")o=new Uint8Array(e);else if(n==="complex64"){o=new Float32Array(e);for(var y=new Float32Array(o.length/2),w=new Float32Array(o.length/2),f=0;f<y.length;f++)y[f]=o[f*2],w[f]=o[f*2+1];var b=Ju(y,a,"float32"),x=Ju(w,a,"float32"),S=$o(b,x);return b.dispose(),x.dispose(),S}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*g}return Ju(o,a,n)}function vD(r,e,t){return qe(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ue(this,function(c){switch(c.label){case 0:n=new Uint8Array(e),c.label=1;case 1:return n.byteLength<t?[4,r.read()]:[3,3];case 2:if(a=c.sent(),i=a.done,o=a.value,i&&o==null)throw s=t-n.byteLength,new Error("Reader is done but ".concat(s," bytes are still expected"));return u=new Uint8Array(n.length+o.byteLength),u.set(n,0),u.set(new Uint8Array(o),n.length),n=u,[3,1];case 3:return[2,n.buffer]}})})}function qre(r,e){return qe(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m=this;return Ue(this,function(v){switch(v.label){case 0:t={},n=r.getReader(),a=new ArrayBuffer(0),v.label=1;case 1:v.trys.push([1,7,8,9]),i=nn(e),o=i.next(),v.label=2;case 2:return o.done?[3,6]:(s=o.value,[4,Wre(s,function(g,y){return qe(m,void 0,void 0,function(){return Ue(this,function(w){switch(w.label){case 0:return[4,vD(n,a,y)];case 1:return a=w.sent(),[2,a.slice(g,y)]}})})})]);case 3:return u=v.sent(),[4,vD(n,a,u)];case 4:a=v.sent(),c=a.slice(0,u),a=a.slice(u),l=JF(s,c),t[s.name]=l,XF()==="webgpu"&&(f=YF(),"uploadToGPU"in f&&Lt(l.shape)>=pt().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&f.uploadToGPU(l.dataId)),v.label=5;case 5:return o=i.next(),[3,2];case 6:return[3,9];case 7:return h=v.sent(),p={error:h},[3,9];case 8:try{o&&!o.done&&(d=i.return)&&d.call(i)}finally{if(p)throw p.error}return[7];case 9:return[2,t]}})})}function Ure(r){if(r===null)throw new Error("Invalid input value: ".concat(JSON.stringify(r)));var e=0,t=[];r.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(i.constructor.name))});var n=new Uint8Array(e),a=0;return t.forEach(function(i){n.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),n.buffer}var s0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function mD(r){return s0?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function Vre(r){if(s0)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function Gre(r){if(s0){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function Hre(r){return ro.join(r)}function gD(r){var e="/";for(r=r.trim();r.endsWith(e);)r=r.slice(0,r.length-1);var t=r.split(e);return t[t.length-1]}function QF(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function eR(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}function u0(r,e){return qe(this,void 0,void 0,function(){var t,n,a;return Ue(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=Se.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,eR(r,t,n)]}})})}function mf(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:mD(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:mD(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new ro(r.weightData).byteLength}}function My(r){var e,t,n=[];try{for(var a=nn(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,wt([],Se(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function Kre(){var r=function(n){for(var a=n<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=r(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function jre(){var r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(var e=1;e<31;e++)r[e]=e<<23;for(var e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function Xre(){for(var r=new Uint32Array(64),e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function Yre(){var r=Kre(),e=jre(),t=Xre();return function(n){for(var a=new ArrayBuffer(4*n.length),i=new Uint32Array(a),o=0;o<n.length;o++){var s=n[o],u=r[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var ma=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r}(),Zre=function(r){return ma.registerSaveRouter(r)},Jre=function(r){return ma.registerLoadRouter(r)},Qre=function(r){return ma.getSaveHandlers(r)},ene=function(r,e){return ma.getLoadHandlers(r,e)},By="tensorflowjs",Ly=1,Ts="models_store",Po="model_info_store";function tR(){if(!pt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function zy(r){var e=r.result;e.createObjectStore(Ts,{keyPath:"modelPath"}),e.createObjectStore(Po,{keyPath:"modelPath"})}var As=function(){function r(e){if(this.indexedDB=tR(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return qe(this,void 0,void 0,function(){return Ue(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return qe(this,void 0,void 0,function(){return Ue(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(By,Ly);o.onupgradeneeded=function(){return zy(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(Ts,"readonly"),c=u.objectStore(Ts),l=c.get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{t.weightData=ro.join(t.weightData);var f=mf(t),h=s.transaction(Po,"readwrite"),p=h.objectStore(Po),d;try{d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f})}catch(v){return i(v)}var m;d.onsuccess=function(){m=s.transaction(Ts,"readwrite");var v=m.objectStore(Ts),g;try{g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f})}catch(y){return i(y)}g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Po);var w=p.delete(n.modelPath);w.onsuccess=function(){return s.close(),i(g.error)},w.onerror=function(b){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r}();As.URL_SCHEME="indexeddb://";var rR=function(r){return pt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(As.URL_SCHEME)?tne(r.slice(As.URL_SCHEME.length)):null};ma.registerSaveRouter(rR);ma.registerLoadRouter(rR);function tne(r){return new As(r)}function rne(r){return r.startsWith(As.URL_SCHEME)?r.slice(As.URL_SCHEME.length):r}var nne=function(){function r(){this.indexedDB=tR()}return r.prototype.listModels=function(){return qe(this,void 0,void 0,function(){var e=this;return Ue(this,function(t){return[2,new Promise(function(n,a){var i=e.indexedDB.open(By,Ly);i.onupgradeneeded=function(){return zy(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(Po,"readonly"),u=s.objectStore(Po),c=u.getAll();c.onsuccess=function(){var l,f,h={};try{for(var p=nn(c.result),d=p.next();!d.done;d=p.next()){var m=d.value;h[m.modelPath]=m.modelArtifactsInfo}}catch(v){l={error:v}}finally{try{d&&!d.done&&(f=p.return)&&f.call(p)}finally{if(l)throw l.error}}n(h)},c.onerror=function(l){return o.close(),a(c.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},r.prototype.removeModel=function(e){return qe(this,void 0,void 0,function(){var t=this;return Ue(this,function(n){return e=rne(e),[2,new Promise(function(a,i){var o=t.indexedDB.open(By,Ly);o.onupgradeneeded=function(){return zy(o)},o.onsuccess=function(){var s=o.result,u=s.transaction(Po,"readwrite"),c=u.objectStore(Po),l=c.get(e),f;l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));var h=c.delete(e),p=function(){f=s.transaction(Ts,"readwrite");var d=f.objectStore(Ts),m=d.delete(e);m.onsuccess=function(){return a(l.result.modelArtifactsInfo)},m.onerror=function(v){return i(l.error)}};h.onsuccess=p,h.onerror=function(d){return p(),s.close(),i(l.error)}},l.onerror=function(h){return s.close(),i(l.error)},u.oncomplete=function(){f==null?s.close():f.oncomplete=function(){return s.close()}}},o.onerror=function(s){return i(o.error)}})]})})},r}(),Zi="/",ju="tensorflowjs_models",nR="info",ane="model_topology",ine="weight_specs",one="weight_data",sne="model_metadata";function aR(r){return{info:[ju,r,nR].join(Zi),topology:[ju,r,ane].join(Zi),weightSpecs:[ju,r,ine].join(Zi),weightData:[ju,r,one].join(Zi),modelMetadata:[ju,r,sne].join(Zi)}}function iR(r){var e,t;try{for(var n=nn(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}function une(r){var e=r.split(Zi);if(e.length<3)throw new Error("Invalid key format: ".concat(r));return e.slice(1,e.length-1).join(Zi)}function cne(r){return r.startsWith(Ds.URL_SCHEME)?r.slice(Ds.URL_SCHEME.length):r}var Ds=function(){function r(e){if(!pt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=aR(this.modelPath)}return r.prototype.save=function(e){return qe(this,void 0,void 0,function(){var t,n,a,i,o;return Ue(this,function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=mf(e),i=ro.join(e.weightData);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,Vre(i)),o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),[2,{modelArtifactsInfo:a}]}catch{throw iR(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},r.prototype.load=function(){return qe(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Ue(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=Gre(s),[2,t]})})},r}();Ds.URL_SCHEME="localstorage://";var oR=function(r){return pt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ds.URL_SCHEME)?lne(r.slice(Ds.URL_SCHEME.length)):null};ma.registerSaveRouter(oR);ma.registerLoadRouter(oR);function lne(r){return new Ds(r)}var fne=function(){function r(){W(pt().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),W(typeof window>"u"||typeof window.localStorage<"u",function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return qe(this,void 0,void 0,function(){var e,t,n,a,i,o;return Ue(this,function(s){for(e={},t=ju+Zi,n=Zi+nR,a=0;a<this.LS.length;++a)i=this.LS.key(a),i.startsWith(t)&&i.endsWith(n)&&(o=une(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},r.prototype.removeModel=function(e){return qe(this,void 0,void 0,function(){var t,n;return Ue(this,function(a){if(e=cne(e),t=aR(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '".concat(e,"'"));return n=JSON.parse(this.LS.getItem(t.info)),iR(t),[2,n]})})},r}(),Qu="://",qo=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){W(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Qu)&&(e=e.slice(0,e.indexOf(Qu))),W(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();W(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '".concat(e,"'.")}),n.managers[e]=t},r.getManager=function(e){var t=r.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t},r.getSchemes=function(){return Object.keys(r.getInstance().managers)},r}();function Hp(r){if(r.indexOf(Qu)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(qo.getSchemes().join(",")));return{scheme:r.split(Qu)[0],path:r.split(Qu)[1]}}function sR(r,e,t){return t===void 0&&(t=!1),qe(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return Ue(this,function(h){switch(h.label){case 0:return W(r!==e,function(){return"Old path and new path are the same: '".concat(r,"'")}),n=ma.getLoadHandlers(r),W(n.length>0,function(){return"Copying failed because no load handler is found for source URL ".concat(r,".")}),W(n.length<2,function(){return"Copying failed because more than one (".concat(n.length,") ")+"load handlers for source URL ".concat(r,".")}),a=n[0],i=ma.getSaveHandlers(e),W(i.length>0,function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(e,".")}),W(i.length<2,function(){return"Copying failed because more than one (".concat(n.length,") ")+"save handlers for destination URL ".concat(e,".")}),o=i[0],s=Hp(r).scheme,u=Hp(r).path,c=s===Hp(r).scheme,[4,a.load()];case 1:return l=h.sent(),t&&c?[4,qo.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(l)];case 4:return f=h.sent(),t&&!c?[4,qo.getManager(s).removeModel(u)]:[3,6];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}function hne(){return qe(this,void 0,void 0,function(){var r,e,t,n,a,i,o,s,u,c,l;return Ue(this,function(f){switch(f.label){case 0:r=qo.getSchemes(),e={},f.label=1;case 1:f.trys.push([1,6,7,8]),t=nn(r),n=t.next(),f.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,qo.getManager(a).listModels()]);case 3:i=f.sent();for(o in i)s=a+Qu+o,e[s]=i[o];f.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),c={error:u},[3,8];case 7:try{n&&!n.done&&(l=t.return)&&l.call(t)}finally{if(c)throw c.error}return[7];case 8:return[2,e]}})})}function pne(r){return qe(this,void 0,void 0,function(){var e,t;return Ue(this,function(n){return e=Hp(r),t=qo.getManager(e.scheme),[2,t.removeModel(e.path)]})})}function dne(r,e){return qe(this,void 0,void 0,function(){var t;return Ue(this,function(n){return t=!1,[2,sR(r,e,t)]})})}function vne(r,e){return qe(this,void 0,void 0,function(){var t;return Ue(this,function(n){return t=!0,[2,sR(r,e,t)]})})}var mne=function(){function r(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r.prototype.setTimeoutCustom=function(e,t){var n=this;if(typeof window>"u"||!pt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",function(a){if(a.source===window&&a.data.name===n.messageName){a.stopPropagation();var i=n.functionRefs[a.data.index];i(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0)}},!0))},r.prototype.isTypedArray=function(e){return AF(e)},r}();if(pt().get("IS_BROWSER")){pt().setPlatform("browser",new mne);try{qo.registerManager(Ds.URL_SCHEME,new fne)}catch{}try{qo.registerManager(As.URL_SCHEME,new nne)}catch{}}var gne={importFetch:function(){return nD()}},wy,yne=function(){function r(){this.util=aD(),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return pt().global.fetch!=null?pt().global.fetch(e,t):(wy==null&&(wy=gne.importFetch()),wy(e,t))},r.prototype.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r.prototype.isTypedArray=function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)},r}();pt().get("IS_NODE")&&!pt().get("IS_BROWSER")&&pt().setPlatform("node",new yne);function Ji(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",Kn(r),new ed(r,e,t)}function bne(r,e){var t=O(r,"x","cast");if(!FD(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return H.runKernel(Qy,n,a)}var Yt=G({cast_:bne});function wne(r){var e=O(r,"x","clone","string_or_numeric"),t={x:e};return H.runKernel(t0,t)}var Is=G({clone_:wne});function uR(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}VF();var xne={buffer:Ji,cast:Yt,clone:Is,print:uR};cre(xne);function kne(r,e){var t,n=O(r,"a","add"),a=O(e,"b","add");t=Se(yr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(Jy,i)}var ct=G({add_:kne});function Sne(r,e){var t,n=O(r,"a","floorDiv"),a=O(e,"b","floorDiv");t=Se(yr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(z3,i)}var cR=G({floorDiv_:Sne});function Nne(r,e){var t,n=O(r,"a","div"),a=O(e,"b","div");if(t=Se(yr(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return cR(n,a);var i={a:n,b:a},o={};return H.runKernel(I3,i,o)}var Kt=G({div_:Nne});function Tne(r,e){var t,n=O(r,"a","mul"),a=O(e,"b","mul");t=Se(yr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(g_,i)}var Me=G({mul_:Tne});function Ene(r){var e=O(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return H.runKernel(u3,t)}else{var t={x:e};return H.runKernel(zD,t)}}var da=G({abs_:Ene});function Ine(r){var e=O(r,"x","acos"),t={x:e};return H.runKernel($D,t)}var Cne=G({acos_:Ine});function Ane(r){var e=O(r,"x","acosh"),t={x:e};return H.runKernel(WD,t)}var Dne=G({acosh_:Ane});function _ne(r){W(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),W(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(r.length)});var e=r.map(function(a,i){return O(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!to(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return H.runKernel(qD,n)}var Fne=G({addN_:_ne});function Rne(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return H.runKernel(UD,a,i)}var One=G({all_:Rne});function Pne(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return H.runKernel(VD,a,i)}var Mne=G({any_:Pne});function Bne(r,e){e===void 0&&(e=0);var t=O(r,"x","argMax"),n={x:t},a={axis:e};return H.runKernel(GD,n,a)}var Lne=G({argMax_:Bne});function zne(r,e){e===void 0&&(e=0);var t=O(r,"x","argMin"),n={x:t},a={axis:e};return H.runKernel(HD,n,a)}var $ne=G({argMin_:zne});function Wne(r){var e=O(r,"x","asin"),t={x:e};return H.runKernel(KD,t)}var qne=G({asin_:Wne});function Une(r){var e=O(r,"x","asinh"),t={x:e};return H.runKernel(jD,t)}var Vne=G({asinh_:Une});function Gne(r){var e=O(r,"x","atan"),t={x:e};return H.runKernel(XD,t)}var Hne=G({atan_:Gne});function Kne(r,e){var t,n=O(r,"a","atan2"),a=O(e,"b","atan2");t=Se(yr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(ZD,i)}var jne=G({atan2_:Kne});function Xne(r){var e=O(r,"x","atanh"),t={x:e};return H.runKernel(YD,t)}var Yne=G({atanh_:Xne});function Zne(r,e,t,n,a,i){a===void 0&&(a="NHWC");var o=r[3],s=wt(wt([],Se(e),!1),[o],!1),u=hR(a);return gf(r,s,t,i,n,null,null,u)}function lR(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=Se(rf(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,r[3],r[3]];else if(o==="channelsFirst")l=[u,c,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return gf(r,l,t,n,a,i,!1,o)}function Jne(r,e,t,n,a,i,o){o===void 0&&(o="NDHWC");var s=Se($y(e),3),u=s[0],c=s[1],l=s[2],f,h;if(o==="NDHWC")h="channelsLast",f=[u,c,l,r[4],r[4]];else if(o==="NCDHW")h="channelsFirst",f=[u,c,l,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return fR(r,f,t,n,a,!1,h,i)}function gf(r,e,t,n,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=Se([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=Se(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=Se(r,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var m=Se(e,4),v=m[0],g=m[1],y=m[3],w=Se(rf(t),2),b=w[0],x=w[1],S=Se(rf(n),2),T=S[0],E=S[1],C=ec(v,T),R=ec(g,E),_=tae(a,h,p,b,x,C,R,i,s),P=_.padInfo,$=_.outHeight,z=_.outWidth,L=o?y*d:y,B;return s==="channelsFirst"?B=[f,L,$,z]:s==="channelsLast"&&(B=[f,$,z,L]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:$,outWidth:z,outChannels:L,padInfo:P,strideHeight:b,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:T,dilationWidth:E,inShape:r,outShape:B,filterShape:e}}function fR(r,e,t,n,a,i,o,s){var u,c;i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var l=Se([-1,-1,-1,-1,-1],5),f=l[0],h=l[1],p=l[2],d=l[3],m=l[4];if(o==="channelsLast")u=Se(r,5),f=u[0],h=u[1],p=u[2],d=u[3],m=u[4];else if(o==="channelsFirst")c=Se(r,5),f=c[0],m=c[1],h=c[2],p=c[3],d=c[4];else throw new Error("Unknown dataFormat ".concat(o));var v=Se(e,5),g=v[0],y=v[1],w=v[2],b=v[4],x=Se($y(t),3),S=x[0],T=x[1],E=x[2],C=Se($y(n),3),R=C[0],_=C[1],P=C[2],$=ec(g,R),z=ec(y,_),L=ec(w,P),B=rae(a,h,p,d,S,T,E,$,z,L,s),q=B.padInfo,Y=B.outDepth,J=B.outHeight,U=B.outWidth,j=i?b*m:b,ne;return o==="channelsFirst"?ne=[f,j,Y,J,U]:o==="channelsLast"&&(ne=[f,Y,J,U,j]),{batchSize:f,dataFormat:o,inDepth:h,inHeight:p,inWidth:d,inChannels:m,outDepth:Y,outHeight:J,outWidth:U,outChannels:j,padInfo:q,strideDepth:S,strideHeight:T,strideWidth:E,filterDepth:g,filterHeight:y,filterWidth:w,effectiveFilterDepth:$,effectiveFilterHeight:z,effectiveFilterWidth:L,dilationDepth:R,dilationHeight:_,dilationWidth:P,inShape:r,outShape:ne,filterShape:e}}function Qne(r,e,t,n,a){n==null&&(n=c0(r,e,t));var i=r[0],o=r[1],s=nf((i-e+2*n)/t+1,a),u=nf((o-e+2*n)/t+1,a);return[s,u]}function eae(r,e,t,n,a,i){a==null&&(a=c0(r,e[0],n[0]));for(var o=[0,0,0,t],s=0;s<3;s++)r[s]+2*a>=e[s]&&(o[s]=nf((r[s]-e[s]+2*a)/n[s]+1,i));return o}function c0(r,e,t,n){n===void 0&&(n=1);var a=ec(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function rf(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function $y(r){return typeof r=="number"?[r,r,r]:r}function ec(r,e){return e<=1?r:r+(r-1)*(e-1)}function tae(r,e,t,n,a,i,o,s,u){var c,l,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";c={top:r,bottom:r,left:r,right:r,type:h};var p=Qne([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),w=m-y;c={top:v,bottom:g,left:y,right:w,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],w=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT";c={top:v,bottom:g,left:y,right:w,type:h},l=nf((e-i+v+g)/n+1,s),f=nf((t-o+y+w)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:c,outHeight:l,outWidth:f}}function rae(r,e,t,n,a,i,o,s,u,c,l){var f,h,p,d;if(r==="valid"&&(r=0),typeof r=="number"){var m=r===0?"VALID":"NUMBER";f={top:r,bottom:r,left:r,right:r,front:r,back:r,type:m};var v=eae([e,t,n,1],[s,u,c],1,[a,i,o],r,l);h=v[0],p=v[1],d=v[2]}else if(r==="same"){h=Math.ceil(e/a),p=Math.ceil(t/i),d=Math.ceil(n/o);var g=(h-1)*a+s-e,y=(p-1)*i+u-t,w=(d-1)*o+c-n,b=Math.floor(g/2),x=g-b,S=Math.floor(y/2),T=y-S,E=Math.floor(w/2),C=w-E;f={top:S,bottom:T,left:E,right:C,front:b,back:x,type:"SAME"}}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}function nf(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode ".concat(e))}}function af(r){var e=Se(rf(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function no(r,e){return af(r)||af(e)}function _s(r){return rf(r).every(function(e){return e>0})}function hR(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat ".concat(r))}function Pa(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")W(nc(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){W(nc(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function nae(r,e){var t=O(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return H.runKernel(B_,n,a)}var me=G({reshape_:nae});function aae(r,e,t,n,a){var i=O(r,"x","avgPool","float32"),o=1;W(no(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=me(i,[1,i.shape[0],i.shape[1],i.shape[2]])),W(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),Pa("avgPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=H.runKernel(JD,c,l);return f=Yt(f,i.dtype),u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var pR=G({avgPool_:aae});function iae(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=O(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),W(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),W(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),W(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),Pa("avgPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=H.runKernel(QD,c,l);return f=Yt(f,s.dtype),u?me(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var oae=G({avgPool3d_:iae});function sae(r,e){e===void 0&&(e=0),W(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=tf(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return Is(t[0]);var n=t,a={axis:e};return H.runKernel(c3,n,a)}var Hn=G({concat_:sae});function uae(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=O(r,"a","matMul"),o=O(e,"b","matMul");a=Se(yr(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return H.runKernel(e3,s,u)}var Ot=G({matMul_:uae});function cae(r){var e=O(r,"x","sigmoid","float32"),t={x:e};return H.runKernel(Q_,t)}var tc=G({sigmoid_:cae});function lae(r,e,t){var n=O(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return H.runKernel(X_,a,i)}var cr=G({slice_:lae});function fae(r){var e=O(r,"x","tanh","float32"),t={x:e};return H.runKernel(bF,t)}var Wy=G({tanh_:fae});function hae(r,e,t,n,a,i){var o=O(r,"forgetBias","basicLSTMCell"),s=O(e,"lstmKernel","basicLSTMCell"),u=O(t,"lstmBias","basicLSTMCell"),c=O(n,"data","basicLSTMCell"),l=O(a,"c","basicLSTMCell"),f=O(i,"h","basicLSTMCell"),h=Hn([c,f],1),p=Ot(h,s),d=ct(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=cr(d,[0,0],g),w=cr(d,[0,v],g),b=cr(d,[0,v*2],g),x=cr(d,[0,v*3],g),S=ct(Me(tc(y),Wy(w)),Me(l,tc(ct(o,b)))),T=Me(Wy(S),tc(x));return[S,T]}var pae=G({basicLSTMCell_:hae});function dae(r,e,t){var n=O(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});W(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),W(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),W(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return H.runKernel(t3,i,o)}var dR=G({batchToSpaceND_:dae});function vae(r){var e;return r.rank===0||r.rank===1?e=me(r,[1,1,1,r.size]):r.rank===2?e=me(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function mae(r,e,t,n,a,i){i==null&&(i=.001);var o=O(r,"x","batchNorm"),s=O(e,"mean","batchNorm"),u=O(t,"variance","batchNorm"),c;a!=null&&(c=O(a,"scale","batchNorm"));var l;n!=null&&(l=O(n,"offset","batchNorm")),W(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),W(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),W(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=vae(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=H.runKernel($3,h,p);return me(d,o.shape)}var fd=G({batchNorm_:mae});function gae(r,e,t,n,a,i){var o=O(r,"x","batchNorm"),s=O(e,"mean","batchNorm"),u=O(t,"variance","batchNorm"),c;a!=null&&(c=O(a,"scale","batchNorm"));var l;return n!=null&&(l=O(n,"offset","batchNorm")),W(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),W(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),W(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&W(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&W(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),fd(o,s,u,l,c,i)}var yae=G({batchNorm2d_:gae});function bae(r,e,t,n,a,i){var o=O(r,"x","batchNorm"),s=O(e,"mean","batchNorm"),u=O(t,"variance","batchNorm"),c;a!=null&&(c=O(a,"scale","batchNorm"));var l;return n!=null&&(l=O(n,"offset","batchNorm")),W(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),W(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),W(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&W(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&W(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),fd(o,s,u,l,c,i)}var wae=G({batchNorm3d_:bae});function xae(r,e,t,n,a,i){var o=O(r,"x","batchNorm"),s=O(e,"mean","batchNorm"),u=O(t,"variance","batchNorm"),c;a!=null&&(c=O(a,"scale","batchNorm"));var l;return n!=null&&(l=O(n,"offset","batchNorm")),W(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),W(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),W(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&W(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&W(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),fd(o,s,u,l,c,i)}var kae=G({batchNorm4d_:xae});function Sae(r,e,t){var n=O(r,"x","bincount"),a=O(e,"weights","bincount");W(n.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(n.dtype)}),W(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),W(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(n.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:n,weights:a},o={size:t};return H.runKernel(r3,i,o)}var vR=G({bincount_:Sae});function Nae(r,e){var t=O(r,"x","bitwiseAnd"),n=O(e,"y","bitwiseAnd");if(!to(t.shape,n.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(t.shape,", y: ").concat(n.shape));if(t.dtype!=="int32"||n.dtype!=="int32")throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(t.dtype," and type of y: ").concat(n.dtype));var a={a:t,b:n};return H.runKernel(n3,a)}var Tae=G({bitwiseAnd_:Nae});function Eae(r,e){var t=O(r,"s0","broadcastArgs","int32"),n=O(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(n.rank));var a={s0:t,s1:n};return H.runKernel(a3,a)}var Iae=G({broadcastArgs_:Eae});function Cae(r,e){var t=O(r,"broadcastTo","x"),n=t.shape;if(Kn(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=me(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return Is(t);var c={x:t},l={reps:o};return H.runKernel(r0,c,l)}var Kp=G({broadcastTo_:Cae});function Aae(r){var e=O(r,"x","ceil","float32"),t={x:e};return H.runKernel(i3,t)}var Dae=G({ceil_:Aae});function yf(r,e,t){Kn(r),t=t||pf(e);var n={shape:r,value:e,dtype:t};return H.runKernel(M3,{},n)}function _ae(r,e,t){var n=O(r,"x","clipByValue");if(W(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return yf(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return H.runKernel(o3,a,i)}var Fae=G({clipByValue_:_ae});function Rae(r){return Hn(r,0)}var Oae=G({concat1d_:Rae});function Pae(r,e){return Hn(r,e)}var Mae=G({concat2d_:Pae});function Bae(r,e){return Hn(r,e)}var Lae=G({concat3d_:Bae});function zae(r,e){return Hn(r,e)}var $ae=G({concat4d_:zae});function Wae(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=O(r,"x","conv2d","float32"),u=O(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),W(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),W(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Pa("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];W(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),W(no(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),W(_s(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),W(_s(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=H.runKernel(l3,h,p);return l?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var hd=G({conv2d_:Wae});function qae(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=O(r,"x","conv1d"),u=O(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1]])),W(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),W(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),Pa("conv1d",n,o),W(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),W(no(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),W(_s(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),W(_s(t),function(){return"Error in conv1D: Stride should be larger than 0."}),W(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=me(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=me(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=hd(h,f,p,n,m,d,o);return l?me(v,[v.shape[2],v.shape[3]]):me(v,[v.shape[0],v.shape[2],v.shape[3]])}var Uae=G({conv1d_:qae});function Vae(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),W(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),W(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),W(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),W(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];W(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),W(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Pa("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=H.runKernel(h3,h,p);return c?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var mR=G({conv2DBackpropInput_:Vae});function Gae(r,e,t,n,a,i){var o=O(r,"x","conv2dTranspose"),s=O(e,"filter","conv2dTranspose");return mR(t,o,s,n,a,"NHWC",i)}var Hae=G({conv2dTranspose_:Gae});function Kae(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=O(r,"x","conv3d"),s=O(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),W(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),W(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),W(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),W(no(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),W(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),W(_s(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),W(_s(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=H.runKernel(p3,l,f);return c?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var jae=G({conv3d_:Kae});function Xae(r,e,t,n,a){W(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=me(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];W(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),W(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),W(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),W(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),W(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=H.runKernel(d3,l,f);return s?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Yae=G({conv3DBackpropInput_:Xae});function Zae(r,e,t,n,a){var i=O(r,"x","conv3dTranspose"),o=O(e,"filter","conv3dTranspose");return Yae(t,i,o,n,a)}var Jae=G({conv3dTranspose_:Zae});function Qae(r){var e=O(r,"x","cos","float32"),t={x:e};return H.runKernel(v3,t)}var eie=G({cos_:Qae});function tie(r){var e=O(r,"x","cosh","float32"),t={x:e};return H.runKernel(m3,t)}var rie=G({cosh_:tie});function nie(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=O(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return H.runKernel(g3,i,o)}var aie=G({cumprod_:nie});function iie(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=O(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return H.runKernel(y3,i,o)}var oie=G({cumsum_:iie});function sie(r,e,t,n){n===void 0&&(n=!1);var a=O(r,"x","denseBincount"),i=O(e,"weights","denseBincount");W(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),W(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),W(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),W(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return H.runKernel(w3,o,s)}var uie=G({denseBincount_:sie});function cie(r,e,t){t===void 0&&(t="NHWC");var n=O(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];W(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),W(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(n.shape)}),W(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(n.shape)}),W(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(n.shape)});var s={x:n},u={blockSize:e,dataFormat:t};return H.runKernel(x3,s,u)}var lie=G({depthToSpace_:cie});function fie(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=O(r,"x","depthwiseConv2d","float32"),u=O(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),W(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),W(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];W(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),Pa("depthwiseConv2d",n,o);var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=H.runKernel(k3,h,p);return l?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var l0=G({depthwiseConv2d_:fie});function hie(r){var e=O(r,"x","diag"),t={x:e};return H.runKernel(T3,t)}var pie=G({diag_:hie});function die(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=O(r,"x","dilation2d"),s=O(e,"filter","dilation2d");W(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),W(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),W(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=me(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),W(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=H.runKernel(E3,l,f);return c?me(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var vie=G({dilation2d_:die});function gR(r,e){for(var t=r.length,n=[],a=0;a<t;a++){var i=t-1-a,o=r[i]||1,s=e[e.length-1-a]||1;s>1&&o===1&&n.unshift(i)}return n}function f0(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Br(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}var mie={__proto__:null,assertAndGetBroadcastShape:Br,getBroadcastDims:gR,getReductionAxes:f0};function gie(r,e){var t,n=O(r,"a","equal","string_or_numeric"),a=O(e,"b","equal","string_or_numeric");t=Se(yr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(_3,i)}var yR=G({equal_:gie});function yie(r,e,t){var n=O(e,"a","where"),a=O(t,"b","where"),i=O(r,"condition","where","bool"),o=Br(Br(i.shape,n.shape),a.shape),s=Kp(i,o),u=Kp(n,o),c=Kp(a,o),l={condition:s,t:u,e:c};return H.runKernel(K_,l)}var Bo=G({where_:yie});function bie(r){var e=O(r,"x","zerosLike"),t={x:e};return H.runKernel(TF,t)}var va=G({zerosLike_:bie});function wie(r,e){var t,n=O(r,"a","div"),a=O(e,"b","div");t=Se(yr(n,a),2),n=t[0],a=t[1];var i=Kt(n,a),o=va(i),s=yR(a,o);return Bo(s,o,i)}var xie=G({divNoNan_:wie});function kie(r,e){var t=O(r,"t1","dot"),n=O(e,"t2","dot");W((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(W(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&n.rank===1){var o=me(t,[1,-1]),s=me(n,[-1,1]),u=Ot(o,s);return me(u,[])}else if(t.rank===1&&n.rank===2){var o=me(t,[1,-1]),s=me(n,[n.shape[0],n.shape[1]]),u=Ot(o,s);return me(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=me(n,[-1,1]),u=Ot(t,s);return me(u,[u.size])}else{var s=me(n,[n.shape[0],n.shape[1]]),u=Ot(t,s);return u}}var Sie=G({dot_:kie});function Nie(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return O(i,"tensors".concat(o),"einsum")}),a={equation:r};return H.runKernel(C3,n,a)}var Xu=G({einsum_:Nie});function Tie(r){var e=O(r,"x","elu","float32"),t={x:e};return H.runKernel(A3,t)}var bR=G({elu_:Tie});function Eie(r,e){var t=O(r,"x","ensureShape","string_or_numeric");if(!CD(t.shape,e))throw new Error("EnsureShape: Shape of tensor ".concat(t.shape," is not compatible with expected shape ").concat(e));return r}var Iie=G({ensureShape_:Eie});function Cie(r){var e=O(r,"x","erf");W(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=Yt(e,"float32"));var t={x:e};return H.runKernel(D3,t)}var Aie=G({erf_:Cie});function h0(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function wR(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function Die(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function bf(r,e){var t=e.map(function(n){return 1});return wR(r,t,e)}function _ie(r,e,t){W(h0(e,t),function(){return"".concat(r," supports only inner-most axes for now. ")+"Got axes ".concat(e," and rank-").concat(t," input.")})}function Fie(r,e){if(h0(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function Rie(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Oie(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function Pie(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return H.runKernel(o_,a,i)}var rc=G({max_:Pie});function Mie(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return H.runKernel(h_,a,i)}var qy=G({min_:Mie});function Bie(r,e){var t,n=O(r,"base","pow"),a=O(e,"exp","pow");t=Se(yr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(I_,i)}var of=G({pow_:Bie});function qt(r,e){if((Xr(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Xr(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return Uo(r,t,n,e)}function Lie(r){var e=O(r,"x","sqrt","float32"),t={x:e};return H.runKernel(tF,t)}var Qi=G({sqrt_:Lie});function zie(r){var e=O(r,"x","square"),t={};return H.runKernel("Square",{x:e},t)}var si=G({square_:zie});function $ie(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","sum");n.dtype==="bool"&&(n=Yt(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return H.runKernel(rF,a,i)}var Ht=G({sum_:$ie});function Wie(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=O(r,"x","norm");var a=xR(r,e,t),i=a.shape;if(n){var o=hf(t,r.shape);i=bf(a.shape,o)}return me(a,i)}function xR(r,e,t){if(t===void 0&&(t=null),r.rank===0)return da(r);if(r.rank!==1&&t===null)return xR(me(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ht(da(r),t);if(e===1/0)return rc(da(r),t);if(e===-1/0)return qy(da(r),t);if(e==="euclidean"||e===2)return Qi(Ht(of(da(r),qt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return rc(Ht(da(r),t[0]),t[1]-1);if(e===1/0)return rc(Ht(da(r),t[1]),t[0]);if(e===-1/0)return qy(Ht(da(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Qi(Ht(si(r),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var pd=G({norm_:Wie});function qie(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),pd(r,"euclidean",e,t)}var Uie=G({euclideanNorm_:qie});function Vie(r){var e=O(r,"x","exp"),t={x:e};return H.runKernel(F3,t)}var Fs=G({exp_:Vie});function Gie(r,e){e===void 0&&(e=0);var t=O(r,"x","expandDims","string_or_numeric");W(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return H.runKernel(R3,n,a)}var Fo=G({expandDims_:Gie});function Hie(r){var e=O(r,"x","expm1"),t={x:e};return H.runKernel(O3,t)}var Kie=G({expm1_:Hie});function jie(r,e){var t=O(r,"x","tile","string_or_numeric");W(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return H.runKernel(r0,n,a)}var jl=G({tile_:jie});function Xie(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=Ji([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=me(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return jl(Fo(s,0),[t[0],1,1]);if(t.length===2)return jl(Fo(Fo(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return jl(Fo(Fo(Fo(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var kR=G({eye_:Xie});function Yie(r){var e=O(r,"x","floor","float32"),t={x:e};return H.runKernel(L3,t)}var SR=G({floor_:Yie});function Zie(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=O(r,"x","gather"),i=O(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return H.runKernel(W3,o,s)}var NR=G({gather_:Zie});function Jie(r,e){var t,n=O(r,"a","greater","string_or_numeric"),a=O(e,"b","greater","string_or_numeric");t=Se(yr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(U3,i)}var dd=G({greater_:Jie});function Qie(r,e){var t,n=O(r,"a","greaterEqual","string_or_numeric"),a=O(e,"b","greaterEqual","string_or_numeric");t=Se(yr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(V3,i)}var TR=G({greaterEqual_:Qie});function eoe(r){var e=O(r,"input","imag"),t={input:e};return H.runKernel(H3,t)}var vd=G({imag_:eoe});function toe(r){var e=O(r,"x","isFinite"),t={x:e};return H.runKernel(K3,t)}var roe=G({isFinite_:toe});function noe(r){var e=O(r,"x","isInf"),t={x:e};return H.runKernel(j3,t)}var aoe=G({isInf_:noe});function ioe(r){var e=O(r,"x","isNaN"),t={x:e};return H.runKernel(X3,t)}var ooe=G({isNaN_:ioe});function soe(r,e){e===void 0&&(e=.2);var t=O(r,"x","leakyRelu"),n={x:t},a={alpha:e};return H.runKernel(Y3,n,a)}var ER=G({leakyRelu_:soe});function uoe(r,e){var t,n=O(r,"a","less","string_or_numeric"),a=O(e,"b","less","string_or_numeric");t=Se(yr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(Z3,i)}var Uy=G({less_:uoe});function coe(r,e){var t,n=O(r,"a","lessEqual","string_or_numeric"),a=O(e,"b","lessEqual","string_or_numeric");t=Se(yr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(J3,i)}var p0=G({lessEqual_:coe});function loe(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return H.runKernel(Q3,{},n)}function foe(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=O(r,"x","localResponseNormalization");W(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),W(nc(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=me(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=H.runKernel(i_,u,c);return s?me(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var hoe=G({localResponseNormalization_:foe});function poe(r){var e=O(r,"x","log","float32"),t={x:e};return H.runKernel(e_,t)}var sf=G({log_:poe});function doe(r){var e=O(r,"x","log1p"),t={x:e};return H.runKernel(t_,t)}var IR=G({log1p_:doe});function voe(r){return W(Lo(r),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var n=O(e,"x","tf.grad","string_or_numeric"),a=t!=null?O(t,"dy","tf.grad"):null;return H.tidy(function(){var i=H.gradients(function(){return r(n)},[n],a),o=i.value,s=i.grads;return a!=null&&xn(o.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),md(s),s[0]})}}function moe(r){return W(Lo(r),function(){return"The f passed in grads(f) must be a function"}),function(e,t){W(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=tf(e,"args","tf.grads","string_or_numeric"),a=t!=null?O(t,"dy","tf.grads"):null;return H.tidy(function(){var i=H.gradients(function(){return r.apply(void 0,wt([],Se(n),!1))},n,a),o=i.value,s=i.grads;return a!=null&&xn(o.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),md(s),s})}}function goe(r){return W(Lo(r),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){W(e instanceof Pr,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),W(t==null||t instanceof Pr,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=H.gradients(function(){return r(e)},[e],t),a=n.grads,i=n.value;return md(a),{grad:a[0],value:i}}}function yoe(r){return W(Lo(r),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){W(Array.isArray(e)&&e.every(function(a){return a instanceof Pr}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),W(t==null||t instanceof Pr,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=H.gradients(function(){return r.apply(void 0,wt([],Se(e),!1))},e,t);return t!=null&&xn(n.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),md(n.grads),n}}function CR(r,e){W(Lo(r),function(){return"The f passed in variableGrads(f) must be a function"}),W(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof ef}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in H.registeredVariables)e.push(H.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),W(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=H.gradients(r,e,null,o),u=s.value,c=s.grads;W(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),W(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function Di(r){return H.customGrad(r)}function md(r){var e=r.filter(function(t){return t==null}).length;if(e>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function boe(r){var e=O(r,"x","neg"),t={x:e};return H.runKernel(y_,t)}var Ci=G({neg_:boe});function woe(r){var e=O(r,"x","softplus"),t={x:e};return H.runKernel(eF,t)}var AR=G({softplus_:woe});function xoe(r){var e=O(r,"x","logSigmoid"),t=Di(function(n){var a=Ci(AR(Ci(n))),i=function(o){var s=Me(o,tc(Ci(n)));return s};return{value:a,gradFunc:i}});return t(e)}var koe=G({logSigmoid_:xoe});function Soe(r,e){var t,n=O(r,"a","sub"),a=O(e,"b","sub");t=Se(yr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(gF,i)}var bt=G({sub_:Soe});function Noe(r,e){e===void 0&&(e=-1);var t=O(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var n=Di(function(a,i){var o=!0,s=rc(a,e,!0),u=bt(a,s),c=bt(Yt(u,"float32"),sf(Ht(Fs(u),e,o)));i([c]);var l=function(f,h){var p=Se(h,1),d=p[0],m=!0,v=Fs(d);return bt(f,Me(Ht(f,e,m),v))};return{value:c,gradFunc:l}});return n(t)}var Toe=G({logSoftmax_:Noe});function Eoe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","logSumExp"),a=hf(e,n.shape),i=rc(n,a,!0),o=bt(n,i),s=Fs(o),u=Ht(s,a),c=sf(u),l=ct(me(i,c.shape),c);if(t){var f=bf(l.shape,a);return me(l,f)}return l}var DR=G({logSumExp_:Eoe});function Ioe(r,e){var t=O(r,"a","logicalAnd","bool"),n=O(e,"b","logicalAnd","bool");Br(t.shape,n.shape);var a={a:t,b:n};return H.runKernel(r_,a)}var td=G({logicalAnd_:Ioe});function Coe(r){var e=O(r,"x","logicalNot","bool"),t={x:e};return H.runKernel(n_,t)}var _R=G({logicalNot_:Coe});function Aoe(r,e){var t=O(r,"a","logicalOr","bool"),n=O(e,"b","logicalOr","bool");Br(t.shape,n.shape);var a={a:t,b:n};return H.runKernel(a_,a)}var FR=G({logicalOr_:Aoe});function Doe(r,e){var t=O(r,"a","logicalXor","bool"),n=O(e,"b","logicalXor","bool");return Br(t.shape,n.shape),td(FR(r,e),_R(td(r,e)))}var _oe=G({logicalXor_:Doe});var Up=2147483648;function Foe(r,e,t){t===void 0&&(t="left");var n=O(r,"sortedSequence","searchSorted"),a=O(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=me(n,[-1,i]),u=me(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Lt(u.shape)>=Up)throw new Error("values tensor size must less than ".concat(Up));if(s.shape[1]>=Up)throw new Error("trailing dim_size must less than ".concat(Up," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return H.runKernel(H_,c,l)}var d0=G({searchSorted_:Foe});function Roe(r,e){return d0(r,e,"left")}function Ooe(r,e,t,n,a){var i=O(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=me(i,[1,i.shape[0],i.shape[1],i.shape[2]])),W(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),W(no(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),Pa("maxPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=H.runKernel(u_,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var RR=G({maxPool_:Ooe});function Poe(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=O(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),W(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),W(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),Pa("maxPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=H.runKernel(c_,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Moe=G({maxPool3d_:Poe});function Boe(r,e,t,n,a){a===void 0&&(a=!1);var i=O(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=H.runKernel(l_,o,s);return{result:u[0],indexes:u[1]}}var Loe=G({maxPoolWithArgmax_:Boe});function zoe(r,e){var t,n=O(r,"a","maximum"),a=O(e,"b","maximum");t=Se(yr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Yt(n,"int32"),a=Yt(a,"int32")),Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(s_,i)}var OR=G({maximum_:zoe});function $oe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return H.runKernel(f_,a,i)}var rd=G({mean_:$oe});function oc(r,e){if(e===void 0&&(e="float32"),Kn(r),e==="complex64"){var t=oc(r,"float32"),n=oc(r,"float32");return $o(t,n)}var a=sd(Lt(r),e);return H.makeTensor(a,r,e)}function Es(r,e){if(e===void 0&&(e="float32"),Kn(r),e==="complex64"){var t=Es(r,"float32"),n=oc(r,"float32");return $o(t,n)}var a=Yy(Lt(r),e);return H.makeTensor(a,r,e)}function Woe(r,e,t){var n=t===void 0?{}:t,a=n.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(r===void 0)return[];var o=O(r,"x","meshgrid",r instanceof Pr?r.dtype:"float32");if(e===void 0)return[o];var s=O(e,"y","meshgrid",e instanceof Pr?e.dtype:"float32"),u=Lt(o.shape),c=Lt(s.shape);return i==="xy"?(o=me(o,[1,-1]),s=me(s,[-1,1]),[Ot(Es([c,1],o.dtype),o),Ot(s,Es([1,u],s.dtype))]):(o=me(o,[-1,1]),s=me(s,[1,-1]),[Ot(o,Es([1,c],o.dtype)),Ot(Es([u,1],s.dtype),s)])}function qoe(r,e){var t,n=O(r,"a","minimum"),a=O(e,"b","minimum");t=Se(yr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Yt(n,"int32"),a=Yt(a,"int32")),Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(p_,i)}var nd=G({minimum_:qoe});function Uoe(r,e,t){W(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var n=O(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");W(e.length===n.rank,function(){return"Padding doesn't match input. Must be ".concat(n.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){W(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),W(e[c][0]>=0&&e[c][0]<=n.shape[c]-a&&e[c][1]>=0&&e[c][1]<=n.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(n.shape[c]-a," or less than 0 for input of ")+"shape ".concat(n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return H.runKernel(d_,u,s)}var Voe=G({mirrorPad_:Uoe});function Goe(r,e){var t,n=O(r,"a","mod"),a=O(e,"b","mod");t=Se(yr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(v_,i)}var Hoe=G({mod_:Goe});function Koe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=O(r,"x","moments");var n=hf(e,r.shape),a=rd(r,n,t),i=a.shape;t||(i=bf(a.shape,n));var o=si(bt(Yt(r,"float32"),me(a,i))),s=rd(o,n,t);return{mean:a,variance:s}}var joe=G({moments_:Koe});function Xoe(r,e,t,n){for(var a=O(e,"data","multiRNNCell"),i=tf(t,"c","multiRNNCell"),o=tf(n,"h","multiRNNCell"),s=a,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var Yoe=G({multiRNNCell_:Xoe});function Zoe(r,e,t,n){n===void 0&&(n=!1);var a=O(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?me(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:n},l=H.runKernel(m_,u,c);return o===1?me(l,[l.size]):l}var Joe=G({multinomial_:Zoe});function Qoe(r,e){var t,n=O(r,"a","notEqual","string_or_numeric"),a=O(e,"b","notEqual","string_or_numeric");t=Se(yr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(b_,i)}var PR=G({notEqual_:Qoe});function ese(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=O(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return H.runKernel(N_,o,s)}var Vy=G({oneHot_:ese});function tse(r){var e=O(r,"x","onesLike"),t={x:e};return H.runKernel(S_,t)}var rse=G({onesLike_:tse});function nse(r,e){var t=O(r,"v1","outerProduct"),n=O(e,"v2","outerProduct");W(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=me(t,[-1,1]),i=me(n,[1,-1]);return Ot(a,i)}var ase=G({outerProduct_:nse});function ise(r,e,t){t===void 0&&(t=0);var n=O(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return H.runKernel(E_,i,a)}var wf=G({pad_:ise});function ose(r,e,t){return t===void 0&&(t=0),W(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),wf(r,[e],t)}var sse=G({pad1d_:ose});function use(r,e,t){return t===void 0&&(t=0),W(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),wf(r,e,t)}var cse=G({pad2d_:use});function lse(r,e,t){return t===void 0&&(t=0),W(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),wf(r,e,t)}var fse=G({pad3d_:lse});function hse(r,e,t){return t===void 0&&(t=0),W(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),wf(r,e,t)}var pse=G({pad4d_:hse});function dse(r,e,t){var n=O(r,"x","spaceToBatchND");W(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),W(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),W(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return H.runKernel(nF,a,i)}var MR=G({spaceToBatchND_:dse});function vse(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=O(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),W(no(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=lR(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=gse([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=Se(mse([l.inHeight,l.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:MR(u,f,m),w=t==="avg"?function(){return pR(y,e,i,g,o)}:function(){return RR(y,e,i,g,o)},b=w(),x=p?b:dR(b,f,v);return c?me(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function mse(r,e,t){var n=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=r.concat(n,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[n[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function gse(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var yse=G({pool_:vse});function bse(r,e){var t=O(r,"x","prelu"),n=O(e,"alpha","prelu"),a={x:t,alpha:n};return H.runKernel(C_,a)}var BR=G({prelu_:bse});function wse(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","prod");n.dtype==="bool"&&(n=Yt(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return H.runKernel(A_,a,i)}var xse=G({prod_:wse});function kse(r,e,t,n){var a=r.map(function(l,f){return O(l,"tensors".concat(f),"raggedGather","int32")}),i=O(e,"paramsDenseValues","raggedGather"),o=O(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},c=H.runKernel(D_,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var Sse=G({raggedGather_:kse});function Nse(r,e,t){var n=O(r,"starts","raggedRange"),a=O(e,"limits","raggedRange",n.dtype),i=O(t,"deltas","raggedRange",n.dtype),o={starts:n,limits:a,deltas:i},s=H.runKernel(__,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var Tse=G({raggedRange_:Nse});function Ese(r,e,t,n,a){var i=O(r,"shape","raggedTensorToTensor","int32"),o=O(e,"values","raggedTensorToTensor"),s=O(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return O(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return H.runKernel(F_,c,l)}var Ise=G({raggedTensorToTensor_:Ese});function Cse(r,e,t){Kn(r);var n=Lt(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<n;i++)a[i]=e();return H.makeTensor(a,r,t)}var Ase=G({rand_:Cse}),LR={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Ps,r,!1)})(LR);var Dse=LR.exports,zR={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Ps,r,!1)})(zR);var _se=zR.exports,$R={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Ps,r,!1)})($R);var Fse=$R.exports,WR={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Ps,r,!1)})(WR);var Rse=WR.exports,qR={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Ps,r,!1)})(qR);var Ose=qR.exports,UR={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Ps,r,!1)})(UR);var Pse=UR.exports,VR={exports:{}};(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=Wp()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Ps,[],Math)})(VR);var Mse=VR.exports,Bse=Dse,Lse=_se,zse=Fse,$se=Rse,Wse=Ose,qse=Pse,Bs=Mse;Bs.alea=Bse;Bs.xor128=Lse;Bs.xorwow=zse;Bs.xorshift7=$se;Bs.xor4096=Wse;Bs.tychei=qse;var v0=Bs,Use=.001,GR=.1;function Vse(r,e,t){return t==null&&(t=m0()),Gy(r,e,function(n,a){return g0(n,a,t)})}function m0(){return H.backend.floatPrecision()===32?Use:GR}function Gy(r,e,t){var n=!0;if((Xr(r)||Xr(e))&&(n=!1),Xr(r)&&Xr(e)&&(n=!0),n){var a=r.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". ")+"Expected: ".concat(i))}if(Array.isArray(r)&&Array.isArray(e)){var o=Ai(r),s=Ai(e);if(!to(o,s))throw new Error("Arrays have different shapes. "+"Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=Xr(r)?r:zo(r),c=Xr(e)?e:zo(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs ")+"expected: ".concat(c.length,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."));for(var l=0;l<c.length;++l){var f=u[l],h=c[l];if(!t(f,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(f,", expected[").concat(l,"] = ").concat(h,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."))}typeof expect<"u"&&expect().nothing()}function Gse(r,e){r().then(function(){return e.fail()},function(){return e()}),typeof expect<"u"&&expect().nothing()}function Hse(r,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Oo(r)||Oo(r[0])||Oo(e)||Oo(e[0])?Gy(r,t,function(n,a){return n==a}):Gy(r,e,function(n,a){return g0(n,a,0)})}function Kse(r,e,t){if(t==null&&(t=m0()),!g0(r,e,t))throw new Error("Numbers differ: actual === ".concat(r,", expected === ").concat(e));typeof expect<"u"&&expect().nothing()}function g0(r,e,t){return!isFinite(r)&&!isFinite(e)?!0:!(isNaN(r)||isNaN(e)||Math.abs(r-e)>t)}function jse(r,e,t){for(var n=0;n<r.length;n++)if(r[n]<e||r[n]>t)throw new Error("Value out of range:".concat(r[n]," low: ").concat(e,", high: ").concat(t))}function Xse(r,e){var t=new Float32Array(r),n=new Float32Array(e);if(t.length!==n.length)throw new Error("Expected ArrayBuffer to be of length "+"".concat(n.length,", but it was ").concat(t.length));for(var a=0;a<n.length;a++)if(t[a]!==n[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ")+"".concat(n[a]," but got ").concat(t[a]," instead"))}function HR(r){for(var e=0;e<r.length;e++){var t=r[e];Array.isArray(t)?HR(t):r[e]=vf(t)}return r}function Yse(r){var e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(r),new Promise(function(t){e.addEventListener("loadeddata",function(n){return t(e)}),e.load()})}function Zse(r){return qe(this,void 0,void 0,function(){return Ue(this,function(e){switch(e.label){case 0:return[4,r.play()];case 1:return e.sent(),"requestVideoFrameCallback"in r?[4,new Promise(function(t){r.requestVideoFrameCallback(t)})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}var Jse={__proto__:null,TEST_EPSILON_FLOAT16:GR,createVideoElement:Yse,encodeStrings:HR,expectArrayBuffersEqual:Xse,expectArraysClose:Vse,expectArraysEqual:Hse,expectNumbersClose:Kse,expectPromiseToFail:Gse,expectValuesInRange:jse,play:Zse,testEpsilon:m0};var y0=function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=v0.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),Qse=function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=v0.alea(i.toString()),this.randn=new y0(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),eue=function(){function r(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=v0.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function tue(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),Kn(r),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type ".concat(n));for(var i=new Qse(e,t,n,a),o=Ji(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var rue=G({randomGamma_:tue});function nue(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Kn(r),n!=null&&n==="bool")throw new Error("Unsupported data type ".concat(n));for(var i=new y0(e,t,n,!1,a),o=Ji(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var KR=G({randomNormal_:nue});function aue(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return KR(r,0,1,e,t)}var iue=G({randomStandardNormal_:aue});function oue(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32"),Kn(r);for(var i=Ji(r,n),o=new eue(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var b0=G({randomUniform_:oue});function sue(r,e,t,n){return b0(r,e,t,"int32",n)}var uue=G({randomUniformInt_:sue});function uf(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return H.runKernel(R_,{},a)}function cue(r){var e=O(r,"input","real"),t={input:e};return H.runKernel(O_,t)}var cf=G({real_:cue});function lue(r){var e=O(r,"x","reciprocal"),t={x:e};return H.runKernel(P_,t)}var fue=G({reciprocal_:lue});function hue(r){var e=O(r,"x","relu"),t={x:e};return H.runKernel(M_,t)}var gd=G({relu_:hue});function pue(r){var e=O(r,"x","relu6"),t={x:e};return H.runKernel($_,t)}var jR=G({relu6_:pue});function due(r,e){var t=O(r,"x","reverse"),n={x:t},a={dims:e};return H.runKernel(W_,n,a)}var Rs=G({reverse_:due});function vue(r){var e=O(r,"x","reverse");return W(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),Rs(e,0)}var mue=G({reverse1d_:vue});function gue(r,e){var t=O(r,"x","reverse");return W(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),Rs(t,e)}var yue=G({reverse2d_:gue});function bue(r,e){var t=O(r,"x","reverse");return W(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),Rs(t,e)}var wue=G({reverse3d_:bue});function xue(r,e){var t=O(r,"x","reverse");return W(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),Rs(t,e)}var kue=G({reverse4d_:xue});function Sue(r){var e=O(r,"x","round"),t={x:e};return H.runKernel(q_,t)}var XR=G({round_:Sue});function Nue(r){var e=O(r,"x","rsqrt","float32"),t={x:e};return H.runKernel(U_,t)}var Tue=G({rsqrt_:Nue});function Eue(r){var e=O(r,"x","selu"),t={x:e};return H.runKernel(j_,t)}var Iue=G({selu_:Eue});function Cue(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=O(r,"x","separableConv2d"),u=O(e,"depthwiseFilter","separableConv2d"),c=O(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");W(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),W(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),W(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),W(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),W(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];W(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=l0(l,u,n,a,o,i),m=1,v=hd(d,c,m,"valid",o);return f?me(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var Aue=G({separableConv2d_:Cue});function Due(r,e){return qe(this,void 0,void 0,function(){var t,n,a,i,o,s,l,u,c,l,f;return Ue(this,function(h){switch(h.label){case 0:return t=O(r,"x","setdiff1d"),n=O(e,"y","setdiff1d"),W(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(n.dtype,").")}),W(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),W(n.rank===1,function(){return"y should be 1D tensor, but got y (".concat(n.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new ed([s],t.dtype),c=new ed([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var _ue=Due;function Fue(r){var e=O(r,"x","sign"),t={x:e};return H.runKernel(J_,t)}var Rue=G({sign_:Fue});function Oue(r){var e=O(r,"x","sin","float32"),t={x:e};return H.runKernel(Y_,t)}var Pue=G({sin_:Oue});function Mue(r){var e=O(r,"x","sinh"),t={x:e};return H.runKernel(Z_,t)}var Bue=G({sinh_:Mue});function Lue(r,e,t){var n=O(r,"x","slice1d");return W(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(n.rank," tensor")}),cr(n,[e],[t])}var zue=G({slice1d_:Lue});function $ue(r,e,t){var n=O(r,"x","slice2d");return W(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(n.rank," tensor")}),cr(n,e,t)}var Wue=G({slice2d_:$ue});function que(r,e,t){var n=O(r,"x","slice3d");return W(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(n.rank," tensor")}),cr(n,e,t)}var Uue=G({slice3d_:que});function Vue(r,e,t){var n=O(r,"x","slice4d");return W(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(n.rank," tensor")}),cr(n,e,t)}var Gue=G({slice4d_:Vue});function Hue(r,e){e===void 0&&(e=-1);var t=O(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var n={logits:t},a={dim:e};return H.runKernel(iF,n,a)}var Kue=G({softmax_:Hue});function jue(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return H.runKernel(P3,e)}var w0=G({fft_:jue});function Xue(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return H.runKernel(G3,e)}var ad=G({ifft_:Xue});function Yue(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=me(r,[t,e]);n=ad(a)}else{var i=[t,2*(e-1)],o=me(cf(r),[t,e]),s=me(vd(r),[t,e]),u=Rs(cr(o,[0,1],[t,e-2]),1),c=Me(Rs(cr(s,[0,1],[t,e-2]),1),qt(-1)),l=Hn([o,u],1),f=Hn([s,c],1),a=me($o(l,f),[i[0],i[1]]);n=ad(a)}if(n=cf(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=me(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var YR=G({irfft_:Yue});function Zue(r,e,t){t===void 0&&(t=0);var n=O(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return H.runKernel(aF,a,i)}var lf=G({split_:Zue});function Jue(r,e){W(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(r.dtype)});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=cr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=Hn([r,oc(s)],r.shape.length-1),t=e}else a=r;var u=va(a),c=me($o(a,u),[n,t]),l=w0(c),f=Math.floor(t/2)+1,h=cf(l),p=vd(l),d=lf(h,[f,t-f],h.shape.length-1),m=lf(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,me($o(d[0],m[0]),v)}var x0=G({rfft_:Jue});function Que(r,e){var t,n=O(r,"a","squaredDifference"),a=O(e,"b","squaredDifference");t=Se(yr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a},o={};return H.runKernel(fF,i,o)}var ZR=G({squaredDifference_:Que});function ece(r,e){var t=O(r,"x","squeeze","string_or_numeric");return me(t,AD(t.shape,e).newShape)}var k0=G({squeeze_:ece});function tce(r,e){e===void 0&&(e=0);var t=tf(r,"tensors","stack","string_or_numeric");W(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&W(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return H.runKernel(T_,n,a)}var ff=G({stack_:tce});function rce(r,e){e===void 0&&(e=0);var t=O(r,"x","step"),n={x:t},a={alpha:e};return H.runKernel(EF,n,a)}var JR=G({step_:rce});function nce(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=O(r,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return H.runKernel(pF,l,f)}var ace=G({stridedSlice_:nce});function ice(r){var e=O(r,"x","tan","float32"),t={x:e};return H.runKernel(yF,t)}var oce=G({tan_:ice});function Oa(r,e){Os(r);var t=Ai(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return Uo(r,n,t,e)}function Xl(r,e,t){if(Os(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Ai(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Uo(r,e,n,t)}function QR(r,e,t){if(Os(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Ai(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Uo(r,e,n,t)}function sce(r,e,t){if(Os(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Ai(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Uo(r,e,n,t)}function uce(r,e,t){if(Os(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Ai(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Uo(r,e,n,t)}function cce(r,e,t){if(Os(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Ai(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,Uo(r,e,n,t)}function S0(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function yd(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}S0(t,e,r)}function eO(r,e,t){for(var n=e.shape.length,a=n>1?e.shape[n-1]:1,i=t.length,o=1,s=a;s<i;++s)o*=t[s];var u=a<1?1:a,c=Lt(e.shape)/u,l=wt(wt([],Se(sc(t.slice(0,a))),!1),[1],!1),f=Lt(t);return{sliceRank:a,numUpdates:c,sliceSize:o,strides:l,outputSize:f}}var lce={__proto__:null,calculateShapes:eO,validateInput:yd,validateUpdateShape:S0};function fce(r,e,t){var n=O(r,"tensor","tensorScatterupdate"),a=O(e,"indices","tensorScatterupdate","int32"),i=O(t,"updates","tensorScatterupdate");if(yd(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return H.runKernel(G_,o,s)}var hce=G({tensorScatterUpdate_:fce});function pce(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=O(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:n},o={k:e,sorted:t},s=Se(H.runKernel(wF,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var dce=G({topk_:pce});function vce(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Kn(r),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new y0(e,t,n,!0,a),o=Ji(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var mce=G({truncatedNormal_:vce});function gce(r,e){e===void 0&&(e=0);var t=O(r,"x","unique","string_or_numeric");W(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=Se(H.runKernel(kF,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var yce=G({unique_:gce});function bce(r,e,t){var n=O(r,"x","unsortedSegmentSum"),a=O(e,"segmentIds","unsortedSegmentSum","int32");W(nc(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return H.runKernel(NF,i,o)}var wce=G({unsortedSegmentSum_:bce});function xce(r,e){e===void 0&&(e=0);var t=O(r,"x","unstack","string_or_numeric");W(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return H.runKernel(SF,n,a)}var N0=G({unstack_:xce});function kce(r,e){return d0(r,e,"right")}function Sce(r,e,t,n){return e===void 0&&(e=!0),H.makeVariable(r,e,t,n)}function tO(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=Ji(r,"int32"),i=Ji([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function Nce(r){return qe(this,void 0,void 0,function(){var e,t,n;return Ue(this,function(a){switch(a.label){case 0:return e=O(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=tO(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var rO=Nce;function Tce(r,e,t){return qe(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m;return Ue(this,function(v){switch(v.label){case 0:for(n=O(r,"tensor","boolMask"),a=O(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,W(o>0,function(){return"mask cannot be scalar"}),xn(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=me(n,l),h=me(a,[-1]),[4,rO(h)];case 1:return p=v.sent(),d=k0(p,[1]),m=NR(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var Ece=Tce;function Ice(r,e,t){var n=O(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),W(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){W(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Mr(function(){var o=cf(n),s=vd(n);return o=H.runKernel(Vp,{x:o},i),s=H.runKernel(Vp,{x:s},i),t&&(s=Ci(s)),$o(o,s)}):H.runKernel(Vp,a,i)}var id=G({transpose_:Ice});function Cce(r,e,t,n,a){a===void 0&&(a=!0);var i=O(r,"v","movingAverage"),o=O(e,"x","movingAverage"),s=O(t,"decay","movingAverage");qF(i,o),W(to(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=qt(1),c=bt(u,s),l=Me(bt(o,i),c);if(a){W(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=O(n,"step","movingAverage");l=Kt(l,bt(u,of(s,f)))}return ct(i,l)}var Ace=G({movingAverage_:Cce});function Dce(r,e,t){Kn(t);var n=O(r,"indices","scatterND","int32"),a=O(e,"updates","scatterND");yd(a,n,t);var i={indices:n,updates:a},o={shape:t};return H.runKernel(V_,i,o)}var _ce=G({scatterND_:Dce});function Fce(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(r.dtype,"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(r.shape,"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Rce(r,e,t,n){n===void 0&&(n=0),Kn(t);var a=O(r,"sparseIndices","sparseToDense","int32"),i=O(e,"sparseValues","sparseToDense","string_or_numeric"),o=O(n,"defaultValue","sparseToDense",i.dtype);Fce(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return H.runKernel(lF,s,u)}var Oce=G({sparseToDense_:Rce});function Pce(r,e){var t=O(e,"indices","gatherND","int32"),n=O(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return H.runKernel(q3,a)}var Mce=G({gatherND_:Pce});function Bce(r,e){if(e==null)return r.shape.slice();if(to(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function Lce(r,e,t,n){var a=O(r,"x","dropout");if(W(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),W(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return r instanceof Pr?a.clone():a;var i=Bce(a,t),o=1-e,s=Kt(SR(ct(b0(i,0,1,"float32",n),o)),o);return Me(a,s)}var zce=G({dropout_:Lce});function nO(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function T0(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return Oa(a,"float32")}function $ce(r,e,t){return t===void 0&&(t=1),qe(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,v;return Ue(this,function(g){switch(g.label){case 0:return n=O(r,"predictions","inTopK"),a=O(e,"targets","inTopK"),W(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(n.rank)}),W(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(n.rank," and targets rank ").concat(a.rank)}),xn(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],W(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=Se([o.length/i,i],2),c=u[0],l=u[1],f=DD("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,w){return w.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,Ju(f,a.shape,"bool")]}})})}var Wce=$ce;function qce(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]])),W(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),W(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),W(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];W(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),W(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Pa("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return H.runKernel(f3,f,h)}var Uce=G({conv2DBackpropFilter_:qce});function bd(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return Me(r,JR(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function wd(r,e){var t=e,n=f0(r.shape,e.shape);return n.length>0&&(t=Ht(t,n)),me(t,r.shape)}function xd(r,e,t,n){if(e==="linear")return r;if(e==="relu")return gd(r);if(e==="elu")return bR(r);if(e==="relu6")return jR(r);if(e==="prelu")return BR(r,t);if(e==="leakyrelu")return ER(r,n);if(e==="sigmoid")return tc(r);throw new Error("Unknown fused activation ".concat(e,"."))}var kd=function(r,e){var t=r>0;return!t||e==="linear"};function Vce(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",kd(H.state.gradientDepth,p)===!1){W(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=hd(t,n,a,i,s,c,l);return f!=null&&(v=ct(v,f)),xd(v,p,d,m)}var g=O(t,"x","conv2d","float32"),y=O(n,"filter","conv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=me(g,[1,g.shape[0],g.shape[1],g.shape[2]])),W(w.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(w.rank,".")}),W(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),Pa("fused conv2d",i,l);var x=s==="NHWC"?w.shape[3]:w.shape[1];W(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),W(no(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var S=gf(w.shape,y.shape,a,c,i,l),T;f!=null&&(T=O(f,"bias","fused conv2d"),e=Se(yr(T,g),1),T=e[0],s==="NHWC"?Br(S.outShape,T.shape):(W(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),W(T.shape.length===0||T.shape[0]===S.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(S.outChannels,")")})));var E;if(d!=null){var C=d.shape;if(W(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)W(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(S.outChannels,").")});else if(C.length===3)try{Br(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(S.outShape,").");throw Error(R)}E=O(d,"prelu weights","fused conv2d")}var _=function(B,q){W(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var Y=Se(q,4),J=Y[0],U=Y[1],j=Y[2],ne=Y[3],re=bd(B,j,p);W(af(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var se=mR(U.shape,re,J,a,i),le=Uce(U,re,J.shape,a,i),de=[se,le];if(ne!=null){var ke=wd(ne,re);de.push(ke)}return de},P={x:w,filter:y,bias:T,preluActivationWeights:E},$={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var z=Di(function(B,q,Y){var J=H.runKernel(Ey,P,$);return Y([q,B,J]),b&&(J=me(J,[J.shape[1],J.shape[2],J.shape[3]])),{value:J,gradFunc:_}});return z(w,y)}else{var L=Di(function(B,q,Y,J){var U=H.runKernel(Ey,P,$);return J([q,B,U,Y]),b&&(U=me(U,[U.shape[1],U.shape[2],U.shape[3]])),{value:U,gradFunc:_}});return L(w,y,T)}}var Gce=G({fusedConv2d_:Vce});function Hce(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return H.runKernel(S3,c,l)}var Kce=G({depthwiseConv2dNativeBackpropFilter_:Hce});function jce(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=H.runKernel(N3,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Xce=G({depthwiseConv2dNativeBackpropInput_:jce});function Yce(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(kd(H.state.gradientDepth,p)===!1){var v=l0(t,n,a,i,s,c,l);return f!=null&&(v=ct(v,f)),xd(v,p,d,m)}var g=O(t,"x","depthwiseConv2d","float32"),y=O(n,"filter","depthwiseConv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=me(g,[1,g.shape[0],g.shape[1],g.shape[2]])),W(w.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(w.rank,".")}),W(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),W(w.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(w.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),W(no(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),Pa("fused depthwiseConv2d",i,l);var x=gf(w.shape,y.shape,a,c,i,l,!0),S;f!=null&&(S=O(f,"bias","fused conv2d"),e=Se(yr(S,g),1),S=e[0],Br(x.outShape,S.shape));var T;d!=null&&(T=O(d,"prelu weights","fused depthwiseConv2d"));var E=function($,z){W(af(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var L=Se(z,4),B=L[0],q=L[1],Y=L[2],J=L[3],U=bd($,Y,p),j=Xce(q.shape,U,B,a,i,c,l),ne=Kce(q,U,B.shape,a,i,c,l);if(J!=null){var re=wd(S,U);return[j,ne,re]}return[j,ne]},C={x:w,filter:y,bias:S,preluActivationWeights:T},R={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var _=Di(function($,z,L){var B=H.runKernel(Iy,C,R);return L([z,$,B]),b&&(B=me(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return _(w,y)}else{var P=Di(function($,z,L,B){var q=H.runKernel(Iy,C,R);return B([z,$,q,L]),b&&(q=me(q,[q.shape[1],q.shape[2],q.shape[3]])),{value:q,gradFunc:E}});return P(w,y,S)}}var Zce=G({fusedDepthwiseConv2d_:Yce});function Jce(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,c=r.bias,l=r.activation,f=l===void 0?"linear":l,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(kd(H.state.gradientDepth,f)===!1){var m=Ot(n,a,o,u);return c!=null&&(m=ct(m,c)),xd(m,f,h,d)}var v=O(n,"a","fused matMul"),g=O(a,"b","fused matMul");e=Se(yr(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?g.shape[g.rank-1]:g.shape[g.rank-2],b=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=v.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Lt(S),C=Lt(T);W(y===w,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(v.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var R=Br(v.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([b,x]),P=o?me(v,[E,y,b]):me(v,[E,b,y]),$=u?me(g,[C,x,w]):me(g,[C,w,x]),z;c!=null&&(z=O(c,"bias","fused matMul"),t=Se(yr(z,v),1),z=t[0],Br(_,z.shape));var L;h!=null&&(L=O(h,"prelu weights","fused matMul"));var B=function(j,ne){var re=Se(ne,4),se=re[0],le=re[1],de=re[2],ke=re[3],he=bd(me(j,de.shape),de,f),ye,xe;if(!o&&!u?(ye=Ot(he,le,!1,!0),xe=Ot(se,he,!0,!1)):!o&&u?(ye=Ot(he,le,!1,!1),xe=Ot(he,se,!0,!1)):o&&!u?(ye=Ot(le,he,!1,!0),xe=Ot(se,he,!1,!1)):(ye=Ot(le,he,!0,!0),xe=Ot(he,se,!0,!0)),c!=null){var De=wd(ke,he);return[ye,xe,De]}else return[ye,xe]},q={a:P,b:$,bias:z,preluActivationWeights:L},Y={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var J=Di(function(j,ne,re){var se=H.runKernel(Ty,q,Y);return re([j,ne,se]),{value:me(se,_),gradFunc:B}});return J(P,$)}else{var U=Di(function(j,ne,re,se){var le=H.runKernel(Ty,q,Y);return se([j,ne,le,re]),{value:me(le,_),gradFunc:B}});return U(P,$,z)}}var Qce=G({fusedMatMul_:Jce});var ele={__proto__:null,conv2d:Gce,depthwiseConv2d:Zce,matMul:Qce};function tle(r){return T0(r,.54,.46)}var rle=G({hammingWindow_:tle});function nle(r){return T0(r,.5,.5)}var aO=G({hannWindow_:nle});function ale(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(cr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=Hn([cr(r,i,e-s),yf([s],a)]);o.push(u),i+=t}return o.length===0?Xl([],[0,e]):me(Hn(o),[o.length,e])}var iO=G({frame_:ale});function ile(r,e,t,n,a){a===void 0&&(a=aO),n==null&&(n=nO(e));var i=iO(r,e,t),o=Me(i,a(e));return x0(o,n)}var ole=G({stft_:ile});function sle(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=O(r,"image","cropAndResize"),s=O(e,"boxes","cropAndResize","float32"),u=O(t,"boxInd","cropAndResize","int32"),c=s.shape[0];W(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),W(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),W(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),W(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(n.length,".")}),W(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(n)}),W(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=H.runKernel(b3,l,f);return h}var ule=G({cropAndResize_:sle});function cle(r){var e=O(r,"image","flipLeftRight","float32");W(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},n=H.runKernel(B3,t,{});return n}var lle=G({flipLeftRight_:cle});function fle(r){var e=O(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];W(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),W(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(n,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,jl(e,a)}var hle=G({grayscaleToRGB_:fle});function ple(r){var e=O(r,"image","RGBToGrayscale"),t=e.rank-1,n=e.shape[t];W(e.rank>=2,function(){return"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),W(n===3,function(){return"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(n,".")});var a=e.dtype,i=Yt(e,"float32"),o=Oa([.2989,.587,.114]),s;switch(e.rank){case 2:s=Xu("ij,j->i",i,o);break;case 3:s=Xu("ijk,k->ij",i,o);break;case 4:s=Xu("ijkl,l->ijk",i,o);break;case 5:s=Xu("ijklm,m->ijkl",i,o);break;case 6:s=Xu("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return s=Fo(s,-1),Yt(s,a)}var dle=G({rgbToGrayscale_:ple});function vle(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=O(r,"image","rotateWithOffset","float32");W(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=H.runKernel(IF,i,o);return s}var mle=G({rotateWithOffset_:vle});function uc(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),W(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(n,"'")}),W(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(r.rank,"'")}),W(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(r.shape[1])}),W(e.rank===1,function(){return"scores must be a 1D tensor"}),W(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),W(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function gle(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=O(r,"boxes","nonMaxSuppression","float32"),o=O(e,"scores","nonMaxSuppression","float32"),s=uc(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return H.runKernel(w_,{boxes:i,scores:o},u)}var yle=G({nonMaxSuppression_:gle});function ble(r,e,t){var n=wle(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function wle(r,e,t){return kle(r,e,t||xle)}function xle(r,e){return r>e?1:r<e?-1:0}function kle(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function oO(r,e,t,n,a){return E0(r,e,t,n,a,0)}function sO(r,e,t,n,a,i){return E0(r,e,t,n,a,0,!1,i,!0)}function uO(r,e,t,n,a,i){return E0(r,e,t,n,a,i,!0)}function E0(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(yD);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,w=h.length-1;w>=g;--w){var b=Sle(r,v,h[w]);if(b>=n){y=!0;break}if(d.score=d.score*Nle(n,f,b),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&ble(c,d,yD))}var x=h.length,S=t-x;s&&S>0&&(h.push.apply(h,wt([],Se(new Array(S).fill(0)),!1)),p.push.apply(p,wt([],Se(new Array(S).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function Sle(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),w=Math.max(g-m,0)*Math.max(y-v,0);return w/(p+d-w)}function Nle(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function yD(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function Tle(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),qe(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return Ue(this,function(h){switch(h.label){case 0:return i=O(r,"boxes","nonMaxSuppressionAsync"),o=O(e,"scores","nonMaxSuppressionAsync"),s=uc(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=oO(c,l,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,Oa(f,"int32")]}})})}var Ele=Tle;function Ile(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=O(r,"boxes","nonMaxSuppression"),s=O(e,"scores","nonMaxSuppression"),u=uc(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=H.runKernel(k_,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var Cle=G({nonMaxSuppressionWithScore_:Ile});function Ale(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),qe(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return Ue(this,function(m){switch(m.label){case 0:return o=O(r,"boxes","nonMaxSuppressionAsync"),s=O(e,"scores","nonMaxSuppressionAsync"),u=uc(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=m.sent(),l=c[0],f=c[1],h=uO(l,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Oa(p,"int32"),selectedScores:Oa(d)}]}})})}var Dle=Ale;function _le(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=O(r,"boxes","nonMaxSuppression"),s=O(e,"scores","nonMaxSuppression"),u=uc(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=H.runKernel(x_,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var Fle=G({nonMaxSuppressionPadded_:_le});function Rle(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),qe(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,m,v,g;return Ue(this,function(y){switch(y.label){case 0:return o=O(r,"boxes","nonMaxSuppressionAsync"),s=O(e,"scores","nonMaxSuppressionAsync"),u=uc(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=Se.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=sO(p,d,c,l,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Oa(v,"int32"),validOutputs:qt(g,"int32")}]}})})}var Ole=Rle;function Ple(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=O(r,"images","resizeBilinear");W(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),W(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),W(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=me(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Se(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=H.runKernel(z_,s,u);return o?me(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var Mle=G({resizeBilinear_:Ple});function Ble(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=O(r,"images","resizeNearestNeighbor");W(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),W(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),W(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),W(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=me(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Se(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=H.runKernel(L_,s,u);return o?me(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var Lle=G({resizeNearestNeighbor_:Ble});function zle(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=O(r,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=Me(Oa([n]),255),f,h,p,d;if(W(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),W(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),W(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),W(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=Se(lf(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=Me(f,o),v=Me(h,s),g=Me(p,u);d=ct(ct(m,v),g)}else d=r;if(e==="otsu"){var y=vR(Yt(XR(d),"int32"),Ju([]),256);l=$le(y,c)}var w=t?p0(d,l):dd(d,l),b=Yt(Me(w,255),"int32");return b}function $le(r,e){for(var t=Oa([-1]),n=Oa([0]),a=Oa([0]),i,o,s,u,c,l,f=0;f<r.size-1;f++){i=cr(r,0,f+1),o=cr(r,f+1),c=Kt(Ht(i),e),l=Kt(Ht(o),e);var h=Ht(Me(i,uf(0,i.size)));s=Kt(h,Ht(i));var p=yf(o.shape,i.size),d=ct(uf(0,o.size),p),m=Me(o,d);u=Kt(Ht(m),Ht(o));var v=bt(s,u),g=bt(s,u),y=Me(c,l);a=Me(Me(y,v),g);var w=dd(a,n);n=Bo(w,a,n),t=Bo(w,Oa([f]),t)}return t}var Wle=G({threshold_:zle});function qle(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=O(r,"image","transform","float32"),s=O(e,"transforms","transform","float32");W(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),W(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),W(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return H.runKernel(xF,u,c)}var Ule=G({transform_:qle});function Vle(r,e,t){var n=O(r,"a","bandPart");W(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(n.rank,".")});var a=n.shape,i=Se(n.shape.slice(-2),2),o=i[0],s=i[1],u,c;typeof e=="number"?(W(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),W(e<=o,function(){return"bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,").")}),u=O(e<0?o:e,"numLower","bandPart")):(W(e.dtype==="int32",function(){return"bandPart(): numLower's dtype must be an int32."}),u=Bo(Uy(e,0),o,nd(e,o))),typeof t=="number"?(W(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")}),W(t<=s,function(){return"bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,").")}),c=O(t<0?s:t,"numUpper","bandPart")):(W(t.dtype==="int32",function(){return"bandPart(): numUpper's dtype must be an int32."}),c=Bo(Uy(t,0),s,nd(t,s)));var l=me(uf(0,o,1,"int32"),[-1,1]),f=uf(0,s,1,"int32"),h=bt(l,f),p=td(p0(h,u),TR(h,Ci(c))),d=oc([o,s],n.dtype);return me(ff(N0(me(n,[-1,o,s])).map(function(m){return Bo(p,m,d)})),a)}var Gle=G({bandPart_:Vle});function Hle(r){var e;if(Array.isArray(r)){e=!1,W(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){W(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(r[u].shape[0]," vs. ").concat(t,")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=lf(r,r.shape[0],0).map(function(u){return k0(u,[0])});W(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(r.length,") exceeds ")+"number of dimensions (".concat(r[0].shape[0],").")});for(var i=[],o=r,s=function(u){i.push(H.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=Me(Ht(Me(i[l],c)),i[l]);c=bt(c,f)}return Kt(c,pd(c,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?ff(i,0):i}var Kle=G({gramSchmidt_:Hle});function jle(r,e){if(e===void 0&&(e=!1),W(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(r.rank)}),r.rank===2)return bD(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,c){return u*c}),n=N0(me(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var c=Se(bD(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=me(ff(a,0),r.shape),s=me(ff(i,0),r.shape);return[o,s]}function bD(r,e){return e===void 0&&(e=!1),H.tidy(function(){W(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(r.shape.length,"D Tensor.")});for(var t=r.shape[0],n=r.shape[1],a=kR(t),i=Is(r),o=Xl([[1]],[1,1]),s=Is(o),u=t>=n?n:t,c=function(f){var h,p=i,d=s,m=a;h=Se(H.tidy(function(){var v=cr(i,[f,f],[t-f,1]),g=pd(v),y=cr(i,[f,f],[1,1]),w=Bo(dd(y,0),Xl([[-1]]),Xl([[1]])),b=bt(y,Me(w,g)),x=Kt(v,b);x.shape[0]===1?s=Is(o):s=Hn([o,cr(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var S=Ci(Kt(Ot(w,b),g)),T=cr(i,[f,0],[t-f,n]),E=Me(S,s),C=id(s);if(f===0)i=bt(T,Ot(E,Ot(C,T)));else{var R=bt(T,Ot(E,Ot(C,T)));i=Hn([cr(i,[0,0],[f,n]),R],0)}var _=id(E),P=cr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=bt(P,Ot(Ot(P,s),_));else{var $=bt(P,Ot(Ot(P,s),_));a=Hn([cr(a,[0,0],[t,f]),$],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],An([p,d,m])},l=0;l<u;++l)c(l);return!e&&t>n&&(a=cr(a,[0,0],[t,n]),i=cr(i,[0,0],[n,n])),[a,i]})}var Xle=G({qr_:jle});D.Reduction=void 0;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(D.Reduction||(D.Reduction={}));function Yle(r,e,t){t===void 0&&(t=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var n=O(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=O(e,"weights","computeWeightedLoss"));var i=a==null?n:Me(n,a);if(t===D.Reduction.NONE)return i;if(t===D.Reduction.SUM)return Ht(i);if(t===D.Reduction.MEAN){if(a==null)return rd(i);var o=n.size/a.size,s=Kt(Ht(i),Ht(a));return o>1?Kt(s,qt(o)):s}if(t===D.Reduction.SUM_BY_NONZERO_WEIGHTS){if(a==null)return Kt(Ht(i),qt(n.size));var u=Me(a,Es(n.shape)),c=Yt(Ht(PR(u,qt(0))),"float32");return Kt(Ht(i),c)}throw Error("Unknown reduction: ".concat(t))}var ao=G({computeWeightedLoss_:Yle});function Zle(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=O(r,"labels","absoluteDifference"),i=O(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=O(t,"weights","absoluteDifference")),xn(a.shape,i.shape,"Error in absoluteDifference: ");var s=da(bt(a,i));return ao(s,o,n)}var Jle=G({absoluteDifference_:Zle});function Qle(r,e,t,n,a){a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"labels","cosineDistance"),o=O(e,"predictions","cosineDistance"),s=null;n!=null&&(s=O(n,"weights","cosineDistance")),xn(i.shape,o.shape,"Error in cosineDistance: ");var u=qt(1),c=bt(u,Ht(Me(i,o),t,!0));return ao(c,s,a)}var efe=G({cosineDistance_:Qle});function tfe(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=O(r,"labels","hingeLoss"),i=O(e,"predictions","hingeLoss"),o=null;t!=null&&(o=O(t,"weights","hingeLoss")),xn(a.shape,i.shape,"Error in hingeLoss: ");var s=qt(1);a=bt(Me(qt(2),a),s);var u=gd(bt(s,Me(a,i)));return ao(u,o,n)}var rfe=G({hingeLoss_:tfe});function nfe(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"labels","huberLoss"),o=O(e,"predictions","huberLoss"),s=null;t!=null&&(s=O(t,"weights","huberLoss")),xn(i.shape,o.shape,"Error in huberLoss: ");var u=qt(n),c=da(bt(o,i)),l=nd(c,u),f=bt(c,l),h=ct(Me(qt(.5),si(l)),Me(u,f));return ao(h,s,a)}var afe=G({huberLoss_:nfe});function ife(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"labels","logLoss"),o=O(e,"predictions","logLoss"),s=null;t!=null&&(s=O(t,"weights","logLoss")),xn(i.shape,o.shape,"Error in logLoss: ");var u=qt(1),c=qt(n),l=Ci(Me(i,sf(ct(o,c)))),f=Me(bt(u,i),sf(ct(bt(u,o),c))),h=bt(l,f);return ao(h,s,a)}var ofe=G({logLoss_:ife});function sfe(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=O(r,"labels","meanSquaredError"),i=O(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=O(t,"weights","meanSquaredError")),xn(a.shape,i.shape,"Error in meanSquaredError: ");var s=ZR(a,i);return ao(s,o,n)}var ufe=G({meanSquaredError_:sfe});function cfe(r,e){var t=O(r,"labels","sigmoidCrossEntropyWithLogits"),n=O(e,"logits","sigmoidCrossEntropyWithLogits");xn(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=gd(n),i=Me(n,t),o=IR(Fs(Ci(da(n))));return ct(bt(a,i),o)}function lfe(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"multiClassLabels","sigmoidCrossEntropy"),o=O(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=O(t,"weights","sigmoidCrossEntropy")),xn(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=qt(n),c=qt(1),l=qt(.5);i=ct(Me(i,bt(c,u)),Me(l,u))}var f=cfe(i,o);return ao(f,s,a)}var ffe=G({sigmoidCrossEntropy_:lfe});function hfe(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var n=Di(function(a,i,o){var s=!0,u=DR(i,[t],s),c=bt(Yt(i,"float32"),u);o([a,c]);var l=Ci(Me(c,a)),f=Ht(l,[t]),h=function(p,d){var m=Se(d,2),v=m[0],g=m[1],y=bf(p.shape,[t]);return[Me(me(p,y),bt(Yt(v,"float32"),Fs(g))),Me(me(p,y),bt(Fs(g),Yt(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function pfe(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"onehotLabels","softmaxCrossEntropy"),o=O(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=O(t,"weights","softmaxCrossEntropy")),xn(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=qt(n),c=qt(1),l=qt(i.shape[1]);i=ct(Me(i,bt(c,u)),Kt(u,l))}var f=hfe(i,o);return ao(f,s,a)}var dfe=G({softmaxCrossEntropy_:pfe});function vfe(r,e,t,n){var a=O(r,"indices","sparseFillEmptyRows","int32"),i=O(e,"values","sparseFillEmptyRows"),o=O(t,"denseShape","sparseFillEmptyRows","int32"),s=O(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=H.runKernel(oF,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var mfe=G({sparseFillEmptyRows_:vfe});function gfe(r,e,t){var n=O(r,"inputIndices","sparseReshape","int32"),a=O(e,"inputShape","sparseReshape","int32"),i=O(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(n.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:n,inputShape:a,newShape:i},s=H.runKernel(sF,o);return{outputIndices:s[0],outputShape:s[1]}}var yfe=G({sparseReshape_:gfe});function bfe(r,e,t){var n=O(r,"data","sparseSegmentMean"),a=O(e,"indices","sparseSegmentMean","int32"),i=O(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return H.runKernel(uF,o)}var wfe=G({sparseSegmentMean_:bfe});function xfe(r,e,t){var n=O(r,"data","sparseSegmentSum"),a=O(e,"indices","sparseSegmentSum","int32"),i=O(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return H.runKernel(cF,o)}var kfe=G({sparseSegmentSum_:xfe});function Sfe(r,e,t,n,a,i,o,s){var u=O(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=O(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=H.runKernel(dF,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var Nfe=G({stringNGrams_:Sfe});function Tfe(r,e,t){t===void 0&&(t=!0);var n=O(r,"input","stringSplit","string"),a=O(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(n.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:n,delimiter:a},s=H.runKernel(vF,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var Efe=G({stringSplit_:Tfe});function Ife(r,e){var t=O(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return H.runKernel(mF,a,n)}var Cfe=G({stringToHashBucketFast_:Ife});function Afe(r,e,t,n){n===void 0&&(n=!0);var a=O(r,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:n};return H.runKernel(hF,{x:a},i)}var Dfe=G({staticRegexReplace_:Afe});var _fe={fft:w0,ifft:ad,rfft:x0,irfft:YR},Ffe={hammingWindow:rle,hannWindow:aO,frame:iO,stft:ole},Rfe={flipLeftRight:lle,grayscaleToRGB:hle,resizeNearestNeighbor:Lle,resizeBilinear:Mle,rgbToGrayscale:dle,rotateWithOffset:mle,cropAndResize:ule,nonMaxSuppression:yle,nonMaxSuppressionAsync:Ele,nonMaxSuppressionWithScore:Cle,nonMaxSuppressionWithScoreAsync:Dle,nonMaxSuppressionPadded:Fle,nonMaxSuppressionPaddedAsync:Ole,threshold:Wle,transform:Ule},Ofe={bandPart:Gle,gramSchmidt:Kle,qr:Xle},Pfe={absoluteDifference:Jle,computeWeightedLoss:ao,cosineDistance:efe,hingeLoss:rfe,huberLoss:afe,logLoss:ofe,meanSquaredError:ufe,sigmoidCrossEntropy:ffe,softmaxCrossEntropy:dfe},Mfe={sparseFillEmptyRows:mfe,sparseReshape:yfe,sparseSegmentMean:wfe,sparseSegmentSum:kfe},Bfe={stringNGrams:Nfe,stringSplit:Efe,stringToHashBucketFast:Cfe,staticRegexReplace:Dfe};var Lfe=new Map,Hy=new Map,cO=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),lO=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function fO(r,e,t){W(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),W(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),W(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=r.className);var n=t,a=e+">"+n;return lO.register(r),Lfe.set(a,r),Hy.set(r,a),r}function zfe(r){return Hy.has(r)?Hy.get(r):r.className}var $fe={__proto__:null,Serializable:cO,SerializationMap:lO,getRegisteredName:zfe,registerClass:fO},Vo=function(r){eo(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return An(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return CR(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&An(this.iterations_)},e.prototype.saveIterations=function(){return qe(this,void 0,void 0,function(){return Ue(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:qt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ue(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){return Ue(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return qe(this,void 0,void 0,function(){var n;return Ue(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(cO);Object.defineProperty(Vo,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var I0=function(r){eo(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=H.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=H.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:Mr(function(){return va(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:Mr(function(){return va(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;Mr(function(){var h=ct(Me(l,n.rho),Me(si(c),1-n.rho)),p=Me(Kt(Qi(ct(f,n.epsilon)),Qi(ct(l,n.epsilon))),c),d=ct(Me(f,n.rho),Me(si(p),1-n.rho));l.assign(h),f.assign(d);var m=ct(Me(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(An(this.accumulatedGrads.map(function(t){return t.variable})),An(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){var t;return Ue(this,function(n){switch(n.label){case 0:return t=wt(wt([],Se(this.accumulatedGrads),!1),Se(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){var n,a;return Ue(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e}(Vo),C0=function(r){eo(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=H.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:Mr(function(){return yf(s.shape,n.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable;Mr(function(){var f=ct(l,si(c));l.assign(f);var h=ct(Me(Kt(c,Qi(ct(f,H.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&An(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ue(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){var n;return Ue(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e}(Vo),A0=function(r){eo(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Mr(function(){o.accBeta1=qt(n).variable(),o.accBeta2=qt(a).variable()}),i==null&&(o.epsilon=H.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mr(function(){var i=bt(1,n.accBeta1),o=bt(1,n.accBeta2);a.forEach(function(s,u){var c=H.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Mr(function(){return va(c).variable(l)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:Mr(function(){return va(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=ct(Me(h,n.beta1),Me(f,1-n.beta1)),m=ct(Me(p,n.beta2),Me(si(f),1-n.beta2)),v=Kt(d,i),g=Kt(m,o);h.assign(d),p.assign(m);var y=ct(Me(Kt(v,ct(Qi(g),n.epsilon)),-n.learningRate),c);c.assign(y)}}),n.accBeta1.assign(Me(n.accBeta1,n.beta1)),n.accBeta2.assign(Me(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&An(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&An(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){var t;return Ue(this,function(n){switch(n.label){case 0:return t=wt(wt([],Se(this.accumulatedFirstMoment),!1),Se(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){var n,a,i=this;return Ue(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Mr(function(){i.accBeta1.assign(of(i.beta1,i.iterations_+1)),i.accBeta2.assign(of(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e}(Vo),D0=function(r){eo(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Mr(function(){s.iteration=qt(0).variable(),s.accBeta1=qt(n).variable()}),i==null&&(s.epsilon=H.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mr(function(){var i=bt(1,n.accBeta1),o=Kt(-n.learningRate,ct(Me(n.iteration,n.decay),1));a.forEach(function(s,u){var c=H.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:va(c).variable(l)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:va(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=ct(Me(h,n.beta1),Me(f,1-n.beta1)),m=Me(p,n.beta2),v=da(f),g=OR(m,v);h.assign(d),p.assign(g);var y=ct(Me(Kt(o,i),Kt(d,ct(g,n.epsilon))),c);c.assign(y)}}),n.iteration.assign(ct(n.iteration,1)),n.accBeta1.assign(Me(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&An(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&An(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ue(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){return Ue(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e}(Vo),Sd=function(r){eo(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=H.registeredVariables[i];Mr(function(){var c=ct(Me(n.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=jF(qt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ue(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){return Ue(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e}(Vo),_0=function(r){eo(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=qt(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=H.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:Mr(function(){return va(s).variable(u)})}}var c=n.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&Mr(function(){var f,h=ct(Me(n.m,c),l);n.useNesterov?f=ct(Me(n.c,ct(l,Me(h,n.m))),s):f=ct(Me(n.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&An(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){return Ue(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){var n;return Ue(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e}(Sd),F0=function(r){eo(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=H.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=H.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:Mr(function(){return va(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:Mr(function(){return va(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:Mr(function(){return va(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;Mr(function(){var h=ct(Me(l,n.decay),Me(si(c),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=ct(Me(p,n.decay),Me(c,1-n.decay)),m=Kt(Me(c,n.learningRate),Qi(bt(h,ct(si(d),n.epsilon)))),v=ct(Me(f,n.momentum),m);l.assign(h),p.assign(d),f.assign(v);var g=bt(s,v);s.assign(g)}else{var y=ct(Me(l,n.decay),Me(si(c),1-n.decay)),v=ct(Me(f,n.momentum),Kt(Me(c,n.learningRate),Qi(ct(y,n.epsilon))));l.assign(y),f.assign(v);var g=bt(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&An(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&An(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&An(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return qe(this,void 0,void 0,function(){var t;return Ue(this,function(n){switch(n.label){case 0:return t=wt(wt([],Se(this.accumulatedMeanSquares),!1),Se(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,wt([],Se(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return qe(this,void 0,void 0,function(){var n,a;return Ue(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e}(Vo),Wfe=[I0,C0,A0,D0,_0,F0,Sd];function qfe(){var r,e;try{for(var t=nn(Wfe),n=t.next();!n.done;n=t.next()){var a=n.value;fO(a)}}catch(i){r={error:i}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(r)throw r.error}}}var Ufe="model",Vfe=".json",Gfe=".weights.bin";function wD(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var od=function(){function r(e){if(!pt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Ufe),this.modelJsonFileName=e+Vfe,this.weightDataFileName=e+Gfe}return r.prototype.save=function(e){return qe(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Ue(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=ro.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=QF(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,s.download=this.modelJsonFileName,s.href=o,[4,wD(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:(u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,u.download=this.weightDataFileName,u.href=n,[4,wD(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:mf(e)}]}})})},r}();od.URL_SCHEME="downloads://";var Hfe=function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}return r.prototype.load=function(){return qe(this,void 0,void 0,function(){var e=this;return Ue(this,function(t){return[2,new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(u==null){a(new Error("modelTopology field is missing from file ".concat(e.jsonFile.name)));return}var c=s.weightsManifest;if(c==null){a(new Error("weightManifest field is missing from file ".concat(e.jsonFile.name)));return}if(e.weightsFiles.length===0){n({modelTopology:u});return}var l=u0(s,function(f){return e.loadWeights(f)});n(l)},i.onerror=function(o){return a("Failed to read model topology and weights manifest JSON "+"from file '".concat(e.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(e.jsonFile)})]})})},r.prototype.loadWeights=function(e){var t,n,a=this,i=[],o=[];try{for(var s=nn(e),u=s.next();!u.done;u=s.next()){var c=u.value;i.push.apply(i,wt([],Se(c.weights),!1)),o.push.apply(o,wt([],Se(c.paths),!1))}}catch(h){t={error:h}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}var l=this.checkManifestAndWeightFiles(e),f=o.map(function(h){return a.loadWeightsFile(h,l[h])});return Promise.all(f).then(function(h){return[i,h]})},r.prototype.loadWeightsFile=function(e,t){return new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=o.target.result;n(s)},i.onerror=function(o){return a("Failed to weights data from file of path '".concat(e,"'."))},i.readAsArrayBuffer(t)})},r.prototype.checkManifestAndWeightFiles=function(e){var t,n,a=this,i=[],o=this.weightsFiles.map(function(f){return gD(f.name)}),s={};try{for(var u=nn(e),c=u.next();!c.done;c=u.next()){var l=c.value;l.paths.forEach(function(f){var h=gD(f);if(i.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(h,"'"));if(i.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '".concat(h,"' is not provided."));s[f]=a.weightsFiles[o.indexOf(h)]})}}catch(f){t={error:f}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}if(i.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(i.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return s},r}(),Kfe=function(r){return pt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(od.URL_SCHEME)?jfe(r.slice(od.URL_SCHEME.length)):null};ma.registerSaveRouter(Kfe);function jfe(r){return r===void 0&&(r="model"),new od(r)}function Xfe(r){return new Hfe(r)}function xD(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/r.length*(n-t);return e(l),c}),u};function o(u){W(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){W(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),W(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),W(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(r.map(i))}function hO(r,e){return qe(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ue(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?pt().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,xD(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,xD(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function Yfe(r,e){var t=this,n,a=e.fetchFunc==null?pt().platform.fetch:e.fetchFunc,i=0,o;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:function(s){return qe(t,void 0,void 0,function(){var u,c,l,f,h;return Ue(this,function(p){switch(p.label){case 0:return i<r.length?o?[3,2]:[4,a(r[i],e.requestInit,{isBinary:!0})]:[3,4];case 1:c=p.sent().body,o=c.getReader(),p.label=2;case 2:return[4,o.read()];case 3:return l=p.sent(),f=l.done,h=l.value,f?(i++,o=void 0,(u=e.onProgress)===null||u===void 0||u.call(e,i/r.length),[3,0]):(s.enqueue(h),[2]);case 4:return s.close(),[2]}})})}})}function Zfe(r,e,t,n){return e===void 0&&(e=""),qe(this,void 0,void 0,function(){var a,i;return Ue(this,function(o){return a=function(s){return hO(s,{requestInit:n})},i=pO(a),[2,i(r,e,t)]})})}function pO(r){var e=this;return function(t,n,a){return n===void 0&&(n=""),qe(e,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d;return Ue(this,function(m){switch(m.label){case 0:if(i=t.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],t.forEach(function(v,g){var y=0;v.weights.forEach(function(w){var b="quantization"in w?w.quantization.dtype:w.dtype,x=Cs[b]*Lt(w.shape),S=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:w,groupOffset:y,sizeBytes:x})};a!=null?a.forEach(function(T,E){T===w.name&&(S(),s[E]=!0)}):S(),u.push(w.name),y+=x})}),!s.every(function(v){return v}))throw c=a.filter(function(v,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),`. 
`)+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));return l=i.reduce(function(v,g,y){return g&&v.push(y),v},[]),f=[],l.forEach(function(v){t[v].paths.forEach(function(g){var y=n+(n.endsWith("/")?"":"/")+g;f.push(y)})}),[4,r(f)];case 1:return h=m.sent(),p={},d=0,l.forEach(function(v){var g=t[v].paths.length,y=new ro(h.slice(d,d+g)),w=o[v];w.forEach(function(b){var x=y.slice(b.groupOffset,b.groupOffset+b.sizeBytes),S=ZF(x,[b.manifestEntry]);for(var T in S)p[T]=S[T]}),d+=g}),[2,p]}})})}}var Jfe="application/octet-stream",Qfe="application/json",R0=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(W(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=pt().platform.fetch,W(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&W(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}return r.prototype.save=function(e){return qe(this,void 0,void 0,function(){var t,n,a,i,o;return Ue(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=QF(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:Qfe}),"model.json"),e.weightData!=null&&(i=ro.join(e.weightData),t.body.append("model.weights.bin",new Blob([i],{type:Jfe}),"model.weights.bin")),[4,this.fetch(this.path,t)];case 1:if(o=s.sent(),o.ok)return[2,{modelArtifactsInfo:mf(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."))}})})},r.prototype.loadModelJSON=function(){return qe(this,void 0,void 0,function(){var e,t,n,a,i;return Ue(this,function(o){switch(o.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=o.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e.json()];case 3:return t=o.sent(),[3,5];case 4:throw o.sent(),n="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,t]}})})},r.prototype.load=function(){return qe(this,void 0,void 0,function(){var e,t=this;return Ue(this,function(n){switch(n.label){case 0:return this.loadOptions.streamWeights?[2,this.loadStream()]:[4,this.loadModelJSON()];case 1:return e=n.sent(),[2,u0(e,function(a){return t.loadWeights(a)})]}})})},r.prototype.loadStream=function(){return qe(this,void 0,void 0,function(){var e,t,n,a,i=this;return Ue(this,function(o){switch(o.label){case 0:return[4,this.loadModelJSON()];case 1:return e=o.sent(),[4,this.getWeightUrls(e.weightsManifest)];case 2:return t=o.sent(),n=My(e.weightsManifest),a=function(){return Yfe(t,i.loadOptions)},[2,Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:a})]}})})},r.prototype.getWeightUrls=function(e){return qe(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S;return Ue(this,function(T){switch(T.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=Se(ehe(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=[],u=[];try{for(c=nn(e),l=c.next();!l.done;l=c.next()){f=l.value;try{for(h=(x=void 0,nn(f.paths)),p=h.next();!p.done;p=h.next())d=p.value,this.weightUrlConverter!=null?u.push(this.weightUrlConverter(d)):s.push(o+d+i)}catch(E){x={error:E}}finally{try{p&&!p.done&&(S=h.return)&&S.call(h)}finally{if(x)throw x.error}}}}catch(E){w={error:E}}finally{try{l&&!l.done&&(b=c.return)&&b.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(v=(m=s.push).apply,g=[s],y=[[]],[4,Promise.all(u)]):[3,2];case 1:v.apply(m,g.concat([wt.apply(void 0,y.concat([Se.apply(void 0,[T.sent()]),!1]))])),T.label=2;case 2:return[2,s]}})})},r.prototype.loadWeights=function(e){return qe(this,void 0,void 0,function(){var t,n,a;return Ue(this,function(i){switch(i.label){case 0:return[4,this.getWeightUrls(e)];case 1:return t=i.sent(),n=My(e),[4,hO(t,this.loadOptions)];case 2:return a=i.sent(),[2,[n,a]]}})})},r}();R0.URL_SCHEME_REGEX=/^https?:\/\//;function ehe(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function Ky(r){return r.match(R0.URL_SCHEME_REGEX)!=null}var dO=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return Ky(n)}):t=Ky(r),t?O0(r,e):null};ma.registerSaveRouter(dO);ma.registerLoadRouter(dO);function O0(r,e){return new R0(r,e)}function the(r,e){return O0(r,e)}var xy=function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return this.modelArtifacts},r}(),vO=function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return this.saveHandler(e)},r}(),rhe=function(){function r(e){e.load&&(this.load=function(){return Promise.resolve(e.load())}),e.save&&(this.save=function(t){return Promise.resolve(e.save(t))})}return r}();function nhe(r,e,t,n){var a=arguments;return new rhe(mO.apply(void 0,wt([],Se(a),!1)))}function mO(r,e,t,n){if(arguments.length===1){var a=r.modelTopology!=null||r.weightSpecs!=null;return a?new xy(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xy({modelTopology:r}))}else return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xy({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n})}function ahe(r){return new vO(r)}function ihe(r){return new vO(r)}var ohe={__proto__:null,CompositeArrayBuffer:ro,browserFiles:Xfe,browserHTTPRequest:the,concatenateArrayBuffers:Hre,copyModel:dne,decodeWeights:ZF,decodeWeightsStream:qre,encodeWeights:zre,fromMemory:nhe,fromMemorySync:mO,getLoadHandlers:ene,getModelArtifactsForJSON:u0,getModelArtifactsForJSONSync:eR,getModelArtifactsInfoForJSON:mf,getSaveHandlers:Qre,getWeightSpecs:My,http:O0,isHTTPScheme:Ky,listModels:hne,loadWeights:Zfe,moveModel:vne,registerLoadRouter:Jre,registerSaveRouter:Zre,removeModel:pne,weightsLoaderFactory:pO,withSaveHandler:ahe,withSaveHandlerSync:ihe};function she(r,e,t){var n=O(r,"labels","confusionMatrix"),a=O(e,"predictions","confusionMatrix");W(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(t)}),W(n.rank===1,function(){return"Expected the rank of labels to be 1, but got ".concat(n.rank)}),W(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)}),W(n.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+"".concat(n.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."}),W(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+"".concat(t)});var i=Vy(Yt(n,"int32"),t),o=Vy(Yt(a,"int32"),t),s=id(i),u=Ot(s,o);return Yt(u,"int32")}var uhe=G({confusionMatrix_:she});var che={__proto__:null,confusionMatrix:uhe},xs,kD=!1;function gO(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(r.constructor.name));var u=Jl(Ny,H.backendName);if(u!=null){var c={pixels:r},l={numChannels:e};return H.runKernel(Ny,c,l)}var f=Se(a?[r.videoWidth,r.videoHeight]:[r.width,r.height],2),h=f[0],p=f[1],d;if(o)d=r.getContext("2d").getImageData(0,0,h,p).data;else if(n||t)d=r.data;else if(i||a||s){if(xs==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")xs=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else xs=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});xs.canvas.width=h,xs.canvas.height=p,xs.drawImage(r,0,0,h,p),d=xs.getImageData(0,0,h,p).data}var m;if(e===4)m=new Int32Array(d);else{var v=h*p;m=new Int32Array(v*e);for(var g=0;g<v;g++)for(var y=0;y<e;++y)m[g*e+y]=d[g*4+y]}var w=[p,h,e];return QR(m,w,"int32")}function lhe(r){return r!=null&&r.data instanceof Uint8Array}function fhe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function hhe(r){return r!=null&&r.width!==0&&r.height!==0}function phe(r){return fhe()&&!(r instanceof ImageBitmap)&&hhe(r)&&!lhe(r)}function dhe(r,e){return e===void 0&&(e=3),qe(this,void 0,void 0,function(){var t,n;return Ue(this,function(a){switch(a.label){case 0:if(t=null,!(pt().getBool("WRAP_TO_IMAGEBITMAP")&&phe(r)))return[3,5];n=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,createImageBitmap(r,{premultiplyAlpha:"none"})];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),n=null,[3,4];case 4:return n!=null&&n.width===r.width&&n.height===r.height?t=n:t=r,[3,6];case 5:t=r,a.label=6;case 6:return[2,gO(t,e)]}})})}function yO(r){if(r.rank!==2&&r.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));var e=r.rank===2?1:r.shape[2];if(e>4||e===2)throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(e));if(r.dtype!=="float32"&&r.dtype!=="int32")throw new Error("Unsupported type for toPixels: ".concat(r.dtype,".")+" Please use float32 or int32 tensors.")}function vhe(r){var e=r?.alpha||1;if(e>1||e<0)throw new Error("Alpha value ".concat(e," is suppoed to be in range [0 - 1]."))}function mhe(r,e){return qe(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y;return Ue(this,function(w){switch(w.label){case 0:return t=O(r,"img","toPixels"),r instanceof Pr||(n=t,t=Yt(n,"int32"),n.dispose()),yO(t),a=Se(t.shape.slice(0,2),2),i=a[0],o=a[1],s=t.rank===2?1:t.shape[2],[4,t.data()];case 1:for(u=w.sent(),c=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*i*4),f=0;f<i*o;++f){for(h=[0,0,0,255],p=0;p<s;p++){if(d=u[f*s+p],t.dtype==="float32"){if(d<0||d>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(d,"."))}else if(t.dtype==="int32"&&(d<0||d>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(d,"."));s===1?(h[0]=d*c,h[1]=d*c,h[2]=d*c):h[p]=d*c}m=f*4,l[m+0]=Math.round(h[0]),l[m+1]=Math.round(h[1]),l[m+2]=Math.round(h[2]),l[m+3]=Math.round(h[3])}return e!=null&&(kD||(v=Jl(e0,H.backendName),v!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),kD=!0)),e.width=o,e.height=i,g=e.getContext("2d"),y=new ImageData(l,o,i),g.putImageData(y,0,0)),t!==r&&t.dispose(),[2,l]}})})}function ghe(r,e,t){var n=O(r,"img","draw");if(!(r instanceof Pr)){var a=n;n=Yt(a,"int32"),a.dispose()}yO(n),vhe(t?.imageOptions);var i={image:n},o={canvas:e,options:t};H.runKernel(e0,i,o)}var yhe=G({fromPixels_:gO}),bhe={__proto__:null,draw:ghe,fromPixels:yhe,fromPixelsAsync:dhe,toPixels:mhe};function bO(r,e){var t=r.shape.length,n=e.shape.length;if(t<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(t,"."));if(n<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.shape[n-1]>t)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(e.shape[n-1]," vs. ").concat(t));if(Lt(r.shape)===0)throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(r.shape,"."));for(var a=e.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=r.shape,c=a.slice();c.pop();for(var l=1,s=i;s<t;++s)l*=u[s],c.push(u[s]);var f=wt(wt([],Se(sc(r.shape).map(function(h){return h/l})),!1),[1],!1).slice(0,i);return[c,o,l,f]}var whe={__proto__:null,prepareAndValidate:bO},jy=-2,xhe=-1;function khe(r,e,t){var n=r.shape.length;W(n===e.length,function(){return"Error in slice".concat(n,"D: Length of begin ").concat(e," must ")+"match the rank of the array (".concat(n,").")}),W(n===t.length,function(){return"Error in slice".concat(n,"D: Length of size ").concat(t," must ")+"match the rank of the array (".concat(n,").")});for(var a=function(o){W(e[o]+t[o]<=r.shape[o],function(){return"Error in slice".concat(n,"D: begin[").concat(o,"] + size[").concat(o,"] ")+"(".concat(e[o]+t[o],") would overflow input.shape[").concat(o,"] (").concat(r.shape[o],")")})},i=0;i<n;++i)a(i)}function She(r){for(var e=[],t=0;r>0;)r&1&&e.push(t),r/=2,t++;return e}function Nhe(r,e,t){for(var n=[],a=0;a<r.length;a++)n[a]=Math.ceil((e[a]-r[a])/t[a]);return n}function wO(r,e,t,n){for(var a=wt([],Se(r),!1),i=a.length;i<n.length;i++)a.push(1);for(var i=0;i<t;i++)i===0?a[e]=1:(a.splice(e,0,1),a.pop());return a}function xO(r,e,t){return t<=r?t:t-(e-1)}function kO(r,e){for(var t=[],n=0;n<r;n++)t.push(e+n);return t}function The(r,e,t,n,a,i,o,s,u){var c=r.length,l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&t>0){var p=e[0],d=t+1;l=SO(o,p,d,n,r),f=NO(s,p,d,a,r),h=wO(i,p,d,r)}else for(var m=0;m<c;m++)l[m]=EO(o,n,i,r,m,u),f[m]=IO(s,a,i,r,m,u),h[m]=TO(i,m,u);return{begin:l,end:f,strides:h}}function SO(r,e,t,n,a){for(var i=wt([],Se(a),!1),o=kO(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=xO(e,t,s),c=n[u];r&1<<u&&(c=0),i[s]=c}return i}function NO(r,e,t,n,a){for(var i=wt([],Se(a),!1),o=kO(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=xO(e,t,s),c=n[u];r&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var f=a[l];i[l]<0&&(i[l]+=f),i[l]=Yl(0,i[l],a[l])}return i}function TO(r,e,t){var n=r[e];return(t&1<<e||n==null)&&(n=1),n}function EO(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),o=Yl(0,o,u-1),o}function IO(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),s>0?o=Yl(0,o,u):o=Yl(-1,o,u-1),o}function Ehe(r,e,t){for(var n=t.length,a=0;a<t.length;a++)if(t[a]>1){n=a;break}for(var a=n+1;a<t.length;a++)if(e[a]>0||t[a]!==r[a])return!1;return!0}function Ihe(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function Che(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=wt([e],Se(new Array(a-1).fill(0)),!1):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){W(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=wt([t],Se(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(W(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),r.shape[s]-n[s])}),[n,i]}function Ahe(r,e,t,n,a,i,o,s,u){var c;if(n==null?(c=new Array(e.length),c.fill(1)):c=n,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<f.dims;h++)l&&(1<<h&s)!==0&&f.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);var p={dims:r.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Dhe(f,p);for(var d=!0,m=!0,v=!0,g=[],y=[],h=0;h<r.length;++h){if(p.strides[h]===0)throw Error("strides[".concat(h,"] must be non-zero"));var w=!!(p.shrinkAxisMask&1<<h),b=r[h];if(b===-1){g.push(w?1:-1);continue}var x=[p.beginMask&1<<h,p.endMask&1<<h],S=[p.strides[h]>0?0:-1,p.strides[h]>0?b:b-1];if(w&&p.strides[h]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&p.strides[h]===1;var T=!!(p.beginMask&1<<h&&p.endMask&1<<h);if(p.beginValid&&p.endValid){if(w){var E=p.begin[h]<0?b+p.begin[h]:p.begin[h];if(p.begin[h]=E,p.end[h]=p.begin[h]+1,E<0||E>=b)throw Error("slice index ".concat(p.begin[h]," of dimension ").concat(h," out of bounds."))}else p.begin[h]=SD(p.begin[h],0,p.strides[h],b,x,S),p.end[h]=SD(p.end[h],1,p.strides[h],b,x,S);var C=p.strides[h]===1&&p.begin[h]===0&&p.end[h]===b;d=d&&C,m=m&&(h===0&&p.strides[h]===1||C)}else d=d&&p.strides[h]===1&&T,m=m&&(h===0&&p.strides[h]===1||T);var R=void 0,_=!1;if(p.beginValid&&p.endValid?(R=p.end[h]-p.begin[h],_=!0):w?(R=1,_=!0):T&&b>=0&&(p.strides[h]<0?R=-b:R=b,_=!0),_){var P=void 0;R===0||R<0!=p.strides[h]<0?P=0:P=Math.trunc(R/p.strides[h])+(R%p.strides[h]!==0?1:0),g.push(P)}else g.push(-1)}for(var $=0;$<p.finalShapeGatherIndices.length;++$){var z=p.finalShapeGatherIndices[$];z>=0?y.push(g[z]):z===jy&&y.push(1)}var L=y.filter(function(B,q){return p.finalShapeGatherIndices[q]!==jy});return{finalShapeSparse:L,finalShape:y,isIdentity:d,sliceDim0:m,isSimpleSlice:v,begin:p.begin,end:p.end,strides:p.strides}}function Dhe(r,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;var t=0;e.beginValid=r.begin!=null,e.endValid=r.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(var n=0;n<r.dims;n++)if(1<<n&r.ellipsisMask)for(var a=Math.min(e.dims-(r.dims-n)+1+r.numAddAxisAfterEllipsis,e.dims);t<a;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=n;else if(1<<n&r.newAxisMask)e.finalShapeGatherIndices.push(jy),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error("Index out of range using input dim ".concat(t,"; input ")+"has only ".concat(e.dims," dims, ").concat(e.begin.length,"."));r.begin!=null&&(e.begin[t]=r.begin[n]),r.end!=null&&(e.end[t]=r.end[n]),e.strides[t]=r.strides[n],r.beginMask&1<<n&&(e.beginMask|=1<<t),r.endMask&1<<n&&(e.endMask|=1<<t),r.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(xhe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[t]=n,t++}}function SD(r,e,t,n,a,i){if(a[e])return t>0?i[e]:i[e+1&1];var o=r<0?n+r:r;return o<i[0]?i[0]:o>i[1]?i[1]:o}var CO={__proto__:null,assertParamsValid:khe,computeFlatOffset:Ihe,computeOutShape:Nhe,getNormalizedAxes:The,isSliceContinous:Ehe,maskToAxes:She,parseSliceParams:Che,sliceInfo:Ahe,startForAxis:EO,startIndicesWithElidedDims:SO,stopForAxis:IO,stopIndicesWithElidedDims:NO,stridesForAxis:TO,stridesWithElidedDims:wO};var _he="4.19.0";var AO=function(){function r(){}return r.sgd=function(e){return new Sd(e)},r.momentum=function(e,t,n){return n===void 0&&(n=!1),new _0(e,t,n)},r.rmsprop=function(e,t,n,a,i){return t===void 0&&(t=.9),n===void 0&&(n=0),a===void 0&&(a=null),i===void 0&&(i=!1),new F0(e,t,n,a,i)},r.adam=function(e,t,n,a){return e===void 0&&(e=.001),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),new A0(e,t,n,a)},r.adadelta=function(e,t,n){return e===void 0&&(e=.001),t===void 0&&(t=.95),n===void 0&&(n=null),new I0(e,t,n)},r.adamax=function(e,t,n,a,i){return e===void 0&&(e=.002),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),i===void 0&&(i=0),new D0(e,t,n,a,i)},r.adagrad=function(e,t){return t===void 0&&(t=.1),new C0(e,t)},r}();var Fhe=AO;var Rhe=function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}}();function Ohe(){return new Promise(function(r){return Rhe(function(){return r()})})}function Phe(r,e){var t=r[0].length;r.forEach(function(a,i){W(a.length===t,function(){return"Error in concat".concat(t,"D: rank of tensors[").concat(i,"] must be the same ")+"as the rank of the rest (".concat(t,")")})}),W(e>=0&&e<t,function(){return"Error in concat".concat(t,"D: axis must be between 0 and ").concat(t-1,".")});var n=r[0];r.forEach(function(a,i){for(var o=0;o<t;o++)W(o===e||a[o]===n[o],function(){return"Error in concat".concat(t,"D: Shape of tensors[").concat(i,"] (").concat(a,") ")+"does not match the shape of the rest (".concat(n,") ")+"along the non-concatenated axis ".concat(i,".")})})}function Mhe(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}var Ii;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(Ii||(Ii={}));function Bhe(r,e,t){var n=new Array;if(t==null&&e==null)return n;if(e==null)for(;n.length<r+t.length;)n.push(-1);else n=e.slice();if(t==null)return n;if(r+t.length!==n.length)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.rank = ").concat(r+t.length,", but shape.rank = ").concat(n.length));for(var a=1;a<t.length;++a){var i=t[a],o=n[n.length-t.length+a],s=n[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.shape[").concat(a+r,"] = ").concat(i," but shape[").concat(a+r,"] = ").concat(s))}else n[o]=i}return n}function Lhe(r){var e,t,n={FIRST_DIM_SIZE:Ii.FIRST_DIM_SIZE,VALUE_ROWIDS:Ii.VALUE_ROWIDS,ROW_LENGTHS:Ii.ROW_LENGTHS,ROW_SPLITS:Ii.ROW_SPLITS,ROW_LIMITS:Ii.ROW_LIMITS,ROW_STARTS:Ii.ROW_STARTS},a=[];try{for(var i=nn(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s in n)a.push(n[s]);else break}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return a}function zhe(r){return r.length===0?0:r[0]===Ii.FIRST_DIM_SIZE?r.length-1:r.length}function $he(r,e){if(!(r==null||e==null)){var t=r.length,n=e.length;if(t>=n)throw new Error("defaultValue.shape=".concat(r," and ragged tensor flatValues.shape=").concat(e,", are incompatible: defaultValue.rank = ").concat(t," must be less than ragged tensor input flatValues.rank = ").concat(n,")"));for(var a=0;a<Math.min(t,n-1);++a){var i=r[a],o=e[a+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error("defaultValue.shape=".concat(r,", and ragged tensor input flatValues.shape=").concat(e," are incompatible: defaultValue.shape[").concat(a-r.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-r.length,"] = ").concat(o))}}}var P0=30;function Whe(r){return r<=P0?r:Yp(r,Math.floor(Math.sqrt(r)))}function qhe(r,e,t){var n=t*(typeof r=="number"?r:r[0]),a=e*(typeof r=="number"?r:r[1]);return[n,a]}function Uhe(r,e,t,n){n===void 0&&(n=!0);var a=[];if(n)a=a.concat(e.slice(0)),a.push(r[0]/t),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var i=e.length,o=0;o<i;++o)a=a.concat([r[o+1]/e[o],e[o]]);a=a.concat(r.slice(i+1))}return a}function Vhe(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var a=e+1;a<r;++a)a<=2*e?(n.push(a),n.push(a-(e+1))):n.push(a)}else{for(var i=[],o=[],a=1;a<r;++a)a>=e*2+1||a%2===1?o.push(a):i.push(a);n.push.apply(n,wt([],Se(i),!1)),n.push(0),n.push.apply(n,wt([],Se(o),!1))}return n}function Ghe(r,e,t,n){n===void 0&&(n=!0);var a=[];n?a.push(r[0]/t):a.push(r[0]*t);for(var i=1;i<r.length;++i)i<=e.length?n?a.push(e[i-1]*r[i]):a.push(r[i]/e[i-1]):a.push(r[i]);return a}function Hhe(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function Khe(r,e,t){for(var n=r.slice(0,1),a=0;a<t;++a)n.push(r[a+1]-e[a][0]-e[a][1]);return n}var jhe=1.7580993408473768,Xhe=1.0507009873554805;var Yhe=.3275911,Zhe=.254829592,Jhe=-.284496736,Qhe=1.421413741,epe=-1.453152027,tpe=1.061405429;function rpe(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(r.length,", imag: ").concat(e.length,"."));for(var t=new Float32Array(r.length*2),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function npe(r){for(var e=new Float32Array(r.length/2),t=new Float32Array(r.length/2),n=0;n<r.length;n+=2)e[n/2]=r[n],t[n/2]=r[n+1];return{real:e,imag:t}}function ape(r){for(var e=Math.ceil(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=0;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function ipe(r){for(var e=Math.floor(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=2;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function ope(r,e){var t=r[e*2],n=r[e*2+1];return{real:t,imag:n}}function spe(r,e,t,n){r[n*2]=e,r[n*2+1]=t}function upe(r,e){for(var t=new Float32Array(r/2),n=new Float32Array(r/2),a=0;a<Math.ceil(r/2);a++){var i=(e?2:-2)*Math.PI*(a/r);t[a]=Math.cos(i),n[a]=Math.sin(i)}return{real:t,imag:n}}function cpe(r,e,t){var n=(t?2:-2)*Math.PI*(r/e),a=Math.cos(n),i=Math.sin(n);return{real:a,imag:i}}var ky="->",lpe=/->/g,ND=",",TD="...";function fpe(r,e){r=r.replace(/\s/g,"");var t=(r.length-r.replace(lpe,"").length)/ky.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error('Equation must contain exactly one arrow ("'.concat(ky,'").'));var n=Se(r.split(ky),2),a=n[0],i=n[1];W(a.indexOf(TD)===-1,function(){return'The ellipsis notation ("'.concat(TD,'") is not supported yet.')});var o=a.split(ND),s=o.length;if(e!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(e));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],c=function(g){var y=i[g];if(!o.some(function(w){return w.indexOf(y)!==-1}))throw new Error("Output subscripts contain the label ".concat(y," ")+"not present in the input subscripts.");u.indexOf(y)===-1&&u.push(y)},l=0;l<i.length;++l)c(l);for(var l=0;l<a.length;++l){var f=a[l];u.indexOf(f)===-1&&f!==ND&&u.push(f)}for(var h=new Array(o.length),l=0;l<s;++l){if(new Set(o[l].split("")).size!==o[l].length)throw new Error("Found duplicate axes in input component ".concat(o[l],". ")+"Support for duplicate axes in input is not implemented yet.");h[l]=[];for(var p=0;p<o[l].length;++p)h[l].push(u.indexOf(o[l][p]))}for(var d=u.length,m=i.length,v=[],l=m;l<d;++l)v.push(l);return{allDims:u,summedDims:v,idDims:h}}function hpe(r,e){var t=new Array(r);t.fill(-1);for(var n=0;n<e.length;++n)t[e[n]]=n;for(var a=[],n=0;n<r;++n)t[n]===-1&&a.push(n);return t=t.filter(function(i){return i!==-1}),{permutationIndices:t,expandDims:a}}function ppe(r,e,t){for(var n=new Array(r),a=function(o){for(var s=t[o].shape,u=function(l){n[e[o][l]]===void 0?n[e[o][l]]=s[l]:W(n[e[o][l]]===s[l],function(){return"Expected dimension ".concat(n[e[o][l]]," at axis ").concat(l," ")+"of input shaped ".concat(JSON.stringify(s),", ")+"but got dimension ".concat(s[l])})},c=0;c<e[o].length;++c)u(c)},i=0;i<t.length;++i)a(i)}function dpe(r,e){var t,n,a=r,i=[],o=0;r.length===0&&a.push(-1),o=r.length+1;for(var s=0;s<o;++s)i.push([]);for(var u=[],s=0;s<a.length;++s){var c=a[s],l=mpe(e,c);try{for(var f=(t=void 0,nn(l)),h=f.next();!h.done;h=f.next()){var p=h.value;u.indexOf(p)===-1&&(i[s].push(p),u.push(p))}}catch(m){t={error:m}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}}return{path:a,steps:i}}function vpe(r){return r.every(function(e,t){return e===t})}function mpe(r,e){for(var t=[],n=0;n<r.length;++n)(r[n].length===0||r[n].indexOf(e)!==-1||e===-1)&&t.push(n);return t}function gpe(r,e,t){t===void 0&&(t=0);var n=[];if(typeof e=="number")W(r.shape[t]%e===0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(r.shape[t]/e);else{var a=e.reduce(function(s,u){return u===-1&&(s+=1),s},0);W(a<=1,function(){return"There should be only one negative value in split array."});var i=e.indexOf(-1);if(i!==-1){var o=e.reduce(function(s,u){return u>0?s+u:s});e[i]=r.shape[t]-o}W(r.shape[t]===e.reduce(function(s,u){return s+u}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e}return n}function ype(r){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = `.concat(r)}function bpe(r,e){return"indices(".concat(r,", 0) is invalid: ").concat(e," < 0")}function wpe(r,e,t){return"indices(".concat(r,", 0) is invalid: ").concat(e," >= ").concat(t)}function xpe(r,e){return"only one output dimension may be -1, not both ".concat(r," and ").concat(e)}function kpe(r,e){return"size ".concat(r," must be non-negative, not ").concat(e)}function Spe(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Npe(r,e){var t=Lt(r),n=Lt(e);return"Input to reshape is a SparseTensor with ".concat(t,`
  dense values, but the requested shape requires a multiple of `).concat(n,". inputShape=").concat(r," outputShape= ").concat(e)}function Tpe(r,e){var t=Lt(r),n=Lt(e);return"Input to reshape is a tensor with ".concat(t," dense values, but the requested shape has ").concat(n,". inputShape=").concat(r," outputShape=").concat(e)}function Epe(){return"segment ids must be >= 0"}function Ipe(){return"segment ids are not increasing"}function Cpe(r,e){return"Segment id ".concat(r," out of range [0, ").concat(e,"), possibly because segmentIds input is not sorted.")}function Ape(r,e,t){return"Bad: indices[".concat(r,"] == ").concat(e," out of range [0, ").concat(t,")")}function Dpe(r,e){var t=!1,n;for(r<=P0?(n=r,t=!0):n=Yp(r,Math.floor(Math.sqrt(r)));!t;)n>e||n===r?t=!0:n=Yp(r,n+1);return n}function _pe(r,e,t){for(var n=[],a=r.length,i=0;i<a;i++)i!==e?n.push(r[i]):n.push(t);return n}function Fpe(r,e,t,n){var a=e.shape.length,i=r.shape.length;if(n!==0&&(n<-a||n>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(n));if(n<0&&(n+=a),n>i)throw new Error("batchDims (".concat(n,`) must be less than rank(x) (
    `).concat(i,")."));if(t<n)throw new Error("batchDims (".concat(n,") must be less than or equal to axis (").concat(t,")."));for(var o=0;o<n;++o)if(r.shape[o]!==e.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(r.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(e.shape[o],"."));for(var s=r.shape[t],u=[],c=1,l=1,f=1,o=0;o<n;++o)u.push(r.shape[o]),c*=r.shape[o];for(var o=n;o<t;o++)u.push(r.shape[o]),l*=r.shape[o];for(var o=n;o<a;o++)u.push(e.shape[o]);for(var o=t+1;o<i;o++)u.push(r.shape[o]),f*=r.shape[o];return{batchSize:c,sliceSize:f,outerSize:l,dimSize:s,outputShape:u}}var Rpe={__proto__:null,collectGatherOpShapeInfo:Fpe,computeOutShape:_pe,segOpComputeOptimalWindowSize:Dpe};function Ope(r){try{return r.map(function(e){return Qp(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function Ppe(r){return r.map(function(e){return vf(e)})}var Mpe={__proto__:null,ERF_A1:Zhe,ERF_A2:Jhe,ERF_A3:Qhe,ERF_A4:epe,ERF_A5:tpe,ERF_P:Yhe,PARALLELIZE_THRESHOLD:P0,get RowPartitionType(){return Ii},SELU_SCALE:Xhe,SELU_SCALEALPHA:jhe,applyActivation:xd,assertAndGetBroadcastShape:Br,assertAxesAreInnerMostDims:_ie,assertParamsConsistent:Phe,assignToTypedArray:spe,axesAreInnerMostDims:h0,calculateShapes:eO,checkEinsumDimSizes:ppe,checkPadOnDimRoundingMode:Pa,combineLocations:wR,combineRaggedTensorToTensorShapes:Bhe,complexWithEvenIndex:ape,complexWithOddIndex:ipe,computeConv2DInfo:gf,computeConv3DInfo:fR,computeDefaultPad:c0,computeDilation2DInfo:Zne,computeOptimalWindowSize:Whe,computeOutAndReduceShapes:Die,computeOutShape:Mhe,computePool2DInfo:lR,computePool3DInfo:Jne,convertConv2DDataFormat:hR,decodeEinsumEquation:fpe,eitherStridesOrDilationsAreOne:no,expandShapeToKeepDim:bf,exponent:cpe,exponents:upe,fromStringArrayToUint8:Ppe,fromUint8ToStringArray:Ope,getAxesPermutation:Fie,getBroadcastDims:gR,getComplexWithIndex:ope,getEinsumComputePath:dpe,getEinsumPermutation:hpe,getFusedBiasGradient:wd,getFusedDyActivation:bd,getImageCenter:qhe,getInnerMostAxes:Oie,getPermuted:Vhe,getRaggedRank:zhe,getReductionAxes:f0,getReshaped:Uhe,getReshapedPermuted:Ghe,getRowPartitionTypesHelper:Lhe,getSliceBeginCoords:Hhe,getSliceSize:Khe,getSparseFillEmptyRowsIndicesDenseShapeMismatch:ype,getSparseFillEmptyRowsNegativeIndexErrorMessage:bpe,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:wpe,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Spe,getSparseReshapeInputOutputMismatchErrorMessage:Tpe,getSparseReshapeInputOutputMultipleErrorMessage:Npe,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:xpe,getSparseReshapeNegativeOutputDimErrorMessage:kpe,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Ape,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Epe,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Ipe,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Cpe,getUndoAxesPermutation:Rie,isIdentityPermutation:vpe,log:Lte,mergeRealAndImagArrays:rpe,prepareAndValidate:bO,prepareSplitSize:gpe,segment_util:Rpe,shouldFuse:kd,slice_util:CO,splitRealAndImagArrays:npe,stridesOrDilationsArePositive:_s,tupleValuesAreOne:af,upcastType:ld,validateDefaultValueShape:$he,validateInput:yd,validateUpdateShape:S0,warn:Ro};var Bpe={__proto__:null,nonMaxSuppressionV3Impl:oO,nonMaxSuppressionV4Impl:sO,nonMaxSuppressionV5Impl:uO,whereImpl:tO};qfe();D.Abs=zD;D.Acos=$D;D.Acosh=WD;D.AdadeltaOptimizer=I0;D.AdagradOptimizer=C0;D.AdamOptimizer=A0;D.AdamaxOptimizer=D0;D.Add=Jy;D.AddN=qD;D.All=UD;D.Any=VD;D.ArgMax=GD;D.ArgMin=HD;D.Asin=KD;D.Asinh=jD;D.Atan=XD;D.Atan2=ZD;D.Atanh=YD;D.AvgPool=JD;D.AvgPool3D=QD;D.AvgPool3DGrad=wte;D.AvgPoolGrad=bte;D.BatchMatMul=e3;D.BatchToSpaceND=t3;D.Bincount=r3;D.BitwiseAnd=n3;D.BroadcastArgs=a3;D.BroadcastTo=xte;D.Cast=Qy;D.Ceil=i3;D.ClipByValue=o3;D.Complex=s3;D.ComplexAbs=u3;D.Concat=c3;D.Conv2D=l3;D.Conv2DBackpropFilter=f3;D.Conv2DBackpropInput=h3;D.Conv3D=p3;D.Conv3DBackpropFilterV2=kte;D.Conv3DBackpropInputV2=d3;D.Cos=v3;D.Cosh=m3;D.CropAndResize=b3;D.Cumprod=g3;D.Cumsum=y3;D.DataStorage=Zee;D.DenseBincount=w3;D.DepthToSpace=x3;D.DepthwiseConv2dNative=k3;D.DepthwiseConv2dNativeBackpropFilter=S3;D.DepthwiseConv2dNativeBackpropInput=N3;D.Diag=T3;D.Dilation2D=E3;D.Dilation2DBackpropFilter=Nte;D.Dilation2DBackpropInput=Ste;D.Draw=e0;D.Einsum=C3;D.Elu=A3;D.EluGrad=Tte;D.Environment=BD;D.Equal=_3;D.Erf=D3;D.Exp=F3;D.ExpandDims=R3;D.Expm1=O3;D.FFT=P3;D.Fill=M3;D.FlipLeftRight=B3;D.Floor=L3;D.FloorDiv=z3;D.FromPixels=Ny;D.FusedBatchNorm=$3;D.FusedConv2D=Ey;D.FusedDepthwiseConv2D=Iy;D.GatherNd=q3;D.GatherV2=W3;D.Greater=U3;D.GreaterEqual=V3;D.IFFT=G3;D.Identity=t0;D.Imag=H3;D.IsFinite=K3;D.IsInf=j3;D.IsNan=X3;D.KernelBackend=ED;D.LRN=i_;D.LRNGrad=Ate;D.LeakyRelu=Y3;D.Less=Z3;D.LessEqual=J3;D.LinSpace=Q3;D.Log=e_;D.Log1p=t_;D.LogSoftmax=Ite;D.LogicalAnd=r_;D.LogicalNot=n_;D.LogicalOr=a_;D.LogicalXor=Ete;D.LowerBound=Cte;D.MatrixBandPart=Dte;D.Max=o_;D.MaxPool=u_;D.MaxPool3D=c_;D.MaxPool3DGrad=Fte;D.MaxPoolGrad=_te;D.MaxPoolWithArgmax=l_;D.Maximum=s_;D.Mean=f_;D.Min=h_;D.Minimum=p_;D.MirrorPad=d_;D.Mod=v_;D.MomentumOptimizer=_0;D.Multinomial=m_;D.Multiply=g_;D.Neg=y_;D.NonMaxSuppressionV3=w_;D.NonMaxSuppressionV4=x_;D.NonMaxSuppressionV5=k_;D.NotEqual=b_;D.OP_SCOPE_SUFFIX=KF;D.OneHot=N_;D.OnesLike=S_;D.Optimizer=Vo;D.OptimizerConstructors=AO;D.Pack=T_;D.PadV2=E_;D.Pool=Rte;D.Pow=I_;D.Prelu=C_;D.Prod=A_;D.RMSPropOptimizer=F0;D.RaggedGather=D_;D.RaggedRange=__;D.RaggedTensorToTensor=F_;D.Range=R_;D.Real=O_;D.RealDiv=I3;D.Reciprocal=P_;D.Relu=M_;D.Relu6=$_;D.Reshape=B_;D.ResizeBilinear=z_;D.ResizeBilinearGrad=Pte;D.ResizeNearestNeighbor=L_;D.ResizeNearestNeighborGrad=Ote;D.Reverse=W_;D.RotateWithOffset=IF;D.Round=q_;D.Rsqrt=U_;D.SGDOptimizer=Sd;D.ScatterNd=V_;D.SearchSorted=H_;D.Select=K_;D.Selu=j_;D.Sigmoid=Q_;D.Sign=J_;D.Sin=Y_;D.Sinh=Z_;D.Slice=X_;D.Softmax=iF;D.Softplus=eF;D.SpaceToBatchND=nF;D.SparseFillEmptyRows=oF;D.SparseReshape=sF;D.SparseSegmentMean=uF;D.SparseSegmentSum=cF;D.SparseToDense=lF;D.SplitV=aF;D.Sqrt=tF;D.Square=Mte;D.SquaredDifference=fF;D.StaticRegexReplace=hF;D.Step=EF;D.StridedSlice=pF;D.StringNGrams=dF;D.StringSplit=vF;D.StringToHashBucketFast=mF;D.Sub=gF;D.Sum=rF;D.Tan=yF;D.Tanh=bF;D.Tensor=Pr;D.TensorBuffer=ed;D.TensorScatterUpdate=G_;D.Tile=r0;D.TopK=wF;D.Transform=xF;D.Transpose=Vp;D.Unique=kF;D.Unpack=SF;D.UnsortedSegmentSum=NF;D.UpperBound=Bte;D.Variable=ef;D.ZerosLike=TF;D._FusedMatMul=Ty;D.abs=da;D.acos=Cne;D.acosh=Dne;D.add=ct;D.addN=Fne;D.all=One;D.any=Mne;D.argMax=Lne;D.argMin=$ne;D.asin=qne;D.asinh=Vne;D.atan=Hne;D.atan2=jne;D.atanh=Yne;D.avgPool=pR;D.avgPool3d=oae;D.backend=YF;D.backend_util=Mpe;D.basicLSTMCell=pae;D.batchNorm=fd;D.batchNorm2d=yae;D.batchNorm3d=wae;D.batchNorm4d=kae;D.batchToSpaceND=dR;D.bincount=vR;D.bitwiseAnd=Tae;D.booleanMaskAsync=Ece;D.broadcastArgs=Iae;D.broadcastTo=Kp;D.broadcast_util=mie;D.browser=bhe;D.buffer=Ji;D.cast=Yt;D.ceil=Dae;D.clipByValue=Fae;D.clone=Is;D.complex=$o;D.concat=Hn;D.concat1d=Oae;D.concat2d=Mae;D.concat3d=Lae;D.concat4d=$ae;D.conv1d=Uae;D.conv2d=hd;D.conv2dTranspose=Hae;D.conv3d=jae;D.conv3dTranspose=Jae;D.copyRegisteredKernels=qte;D.cos=eie;D.cosh=rie;D.cosineWindow=T0;D.cumprod=aie;D.cumsum=oie;D.customGrad=Di;D.denseBincount=uie;D.deprecationWarn=Ere;D.depthToSpace=lie;D.depthwiseConv2d=l0;D.device_util=wre;D.diag=pie;D.dilation2d=vie;D.disableDeprecationWarnings=Tre;D.dispose=An;D.disposeVariables=Ire;D.div=Kt;D.divNoNan=xie;D.dot=Sie;D.dropout=zce;D.einsum=Xu;D.elu=bR;D.enableDebugMode=Nre;D.enableProdMode=Sre;D.enclosingPowerOfTwo=nO;D.engine=Cre;D.ensureShape=Iie;D.env=pt;D.equal=yR;D.erf=Aie;D.euclideanNorm=Uie;D.exp=Fs;D.expandDims=Fo;D.expm1=Kie;D.eye=kR;D.fft=w0;D.fill=yf;D.findBackend=Pre;D.findBackendFactory=Mre;D.floor=SR;D.floorDiv=cR;D.fused=ele;D.gather=NR;D.gatherND=Mce;D.gather_util=whe;D.getBackend=XF;D.getGradient=Cy;D.getKernel=Jl;D.getKernelsForBackend=Zp;D.grad=voe;D.grads=moe;D.greater=dd;D.greaterEqual=TR;D.ifft=ad;D.imag=vd;D.image=Rfe;D.inTopKAsync=Wce;D.io=ohe;D.irfft=YR;D.isFinite=roe;D.isInf=aoe;D.isNaN=ooe;D.keep=jF;D.kernel_impls=Bpe;D.leakyRelu=ER;D.less=Uy;D.lessEqual=p0;D.linalg=Ofe;D.linspace=loe;D.localResponseNormalization=hoe;D.log=sf;D.log1p=IR;D.logSigmoid=koe;D.logSoftmax=Toe;D.logSumExp=DR;D.logicalAnd=td;D.logicalNot=_R;D.logicalOr=FR;D.logicalXor=_oe;D.losses=Pfe;D.lowerBound=Roe;D.matMul=Ot;D.math=che;D.max=rc;D.maxPool=RR;D.maxPool3d=Moe;D.maxPoolWithArgmax=Loe;D.maximum=OR;D.mean=rd;D.memory=Are;D.meshgrid=Woe;D.min=qy;D.minimum=nd;D.mirrorPad=Voe;D.mod=Hoe;D.moments=joe;D.movingAverage=Ace;D.mul=Me;D.multiRNNCell=Yoe;D.multinomial=Joe;D.neg=Ci;D.nextFrame=Ohe;D.norm=pd;D.notEqual=PR;D.oneHot=Vy;D.ones=Es;D.onesLike=rse;D.op=G;D.outerProduct=ase;D.pad=wf;D.pad1d=sse;D.pad2d=cse;D.pad3d=fse;D.pad4d=pse;D.pool=yse;D.pow=of;D.prelu=BR;D.print=uR;D.prod=xse;D.profile=Dre;D.raggedGather=Sse;D.raggedRange=Tse;D.raggedTensorToTensor=Ise;D.rand=Ase;D.randomGamma=rue;D.randomNormal=KR;D.randomStandardNormal=iue;D.randomUniform=b0;D.randomUniformInt=uue;D.range=uf;D.ready=Rre;D.real=cf;D.reciprocal=fue;D.registerBackend=Bre;D.registerGradient=zte;D.registerKernel=CF;D.relu=gd;D.relu6=jR;D.removeBackend=Ore;D.reshape=me;D.reverse=Rs;D.reverse1d=mue;D.reverse2d=yue;D.reverse3d=wue;D.reverse4d=kue;D.rfft=x0;D.round=XR;D.rsqrt=Tue;D.scalar=qt;D.scatterND=_ce;D.scatter_util=lce;D.searchSorted=d0;D.selu=Iue;D.separableConv2d=Aue;D.serialization=$fe;D.setBackend=Fre;D.setPlatform=Lre;D.setdiff1dAsync=_ue;D.sigmoid=tc;D.sign=Rue;D.signal=Ffe;D.sin=Pue;D.sinh=Bue;D.slice=cr;D.slice1d=zue;D.slice2d=Wue;D.slice3d=Uue;D.slice4d=Gue;D.slice_util=CO;D.softmax=Kue;D.softplus=AR;D.spaceToBatchND=MR;D.sparse=Mfe;D.sparseToDense=Oce;D.spectral=_fe;D.split=lf;D.sqrt=Qi;D.square=si;D.squaredDifference=ZR;D.squeeze=k0;D.stack=ff;D.step=JR;D.stridedSlice=ace;D.string=Bfe;D.sub=bt;D.sum=Ht;D.sumOutType=fre;D.tan=oce;D.tanh=Wy;D.tensor=Ju;D.tensor1d=Oa;D.tensor2d=Xl;D.tensor3d=QR;D.tensor4d=sce;D.tensor5d=uce;D.tensor6d=cce;D.tensorScatterUpdate=hce;D.tensor_util=dre;D.test_util=Jse;D.tidy=Mr;D.tile=jl;D.time=_re;D.topk=dce;D.train=Fhe;D.transpose=id;D.truncatedNormal=mce;D.unique=yce;D.unregisterGradient=Wte;D.unregisterKernel=$te;D.unsortedSegmentSum=wce;D.unstack=N0;D.upcastType=ld;D.upperBound=kce;D.util=ere;D.valueAndGrad=goe;D.valueAndGrads=yoe;D.variable=Sce;D.variableGrads=CR;D.version_core=_he;D.where=Bo;D.whereAsync=rO;D.zeros=oc;D.zerosLike=va});var $O=X((wlt,zO)=>{zO.exports=Zt;var Ma=null;try{Ma=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Zt(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Zt.prototype.__isLong__;Object.defineProperty(Zt.prototype,"__isLong__",{value:!0});function Yn(r){return(r&&r.__isLong__)===!0}Zt.isLong=Yn;var DO={},_O={};function $s(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=_O[r],n)?n:(t=Jt(r,(r|0)<0?-1:0,!0),a&&(_O[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=DO[r],n)?n:(t=Jt(r,r<0?-1:0,!1),a&&(DO[r]=t),t))}Zt.fromInt=$s;function Ba(r,e){if(isNaN(r))return e?zs:La;if(e){if(r<0)return zs;if(r>=PO)return LO}else{if(r<=-RO)return Xn;if(r+1>=RO)return BO}return r<0?Ba(-r,e).neg():Jt(r%lc|0,r/lc|0,e)}Zt.fromNumber=Ba;function Jt(r,e,t){return new Zt(r,e,t)}Zt.fromBits=Jt;var Nd=Math.pow;function B0(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return La;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return B0(r.substring(1),e,t).neg();for(var a=Ba(Nd(t,8)),i=La,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Ba(Nd(t,s));i=i.mul(c).add(Ba(u))}else i=i.mul(a),i=i.add(Ba(u))}return i.unsigned=e,i}Zt.fromString=B0;function ci(r,e){return typeof r=="number"?Ba(r,e):typeof r=="string"?B0(r,e):Jt(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Zt.fromValue=ci;var FO=1<<16,Lpe=1<<24,lc=FO*FO,PO=lc*lc,RO=PO/2,OO=$s(Lpe),La=$s(0);Zt.ZERO=La;var zs=$s(0,!0);Zt.UZERO=zs;var cc=$s(1);Zt.ONE=cc;var MO=$s(1,!0);Zt.UONE=MO;var M0=$s(-1);Zt.NEG_ONE=M0;var BO=Jt(-1,2147483647,!1);Zt.MAX_VALUE=BO;var LO=Jt(-1,-1,!0);Zt.MAX_UNSIGNED_VALUE=LO;var Xn=Jt(0,-2147483648,!1);Zt.MIN_VALUE=Xn;var Fe=Zt.prototype;Fe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Fe.toNumber=function(){return this.unsigned?(this.high>>>0)*lc+(this.low>>>0):this.high*lc+(this.low>>>0)};Fe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Xn)){var t=Ba(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ba(Nd(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Fe.getHighBits=function(){return this.high};Fe.getHighBitsUnsigned=function(){return this.high>>>0};Fe.getLowBits=function(){return this.low};Fe.getLowBitsUnsigned=function(){return this.low>>>0};Fe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Xn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Fe.isZero=function(){return this.high===0&&this.low===0};Fe.eqz=Fe.isZero;Fe.isNegative=function(){return!this.unsigned&&this.high<0};Fe.isPositive=function(){return this.unsigned||this.high>=0};Fe.isOdd=function(){return(this.low&1)===1};Fe.isEven=function(){return(this.low&1)===0};Fe.equals=function(e){return Yn(e)||(e=ci(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Fe.eq=Fe.equals;Fe.notEquals=function(e){return!this.eq(e)};Fe.neq=Fe.notEquals;Fe.ne=Fe.notEquals;Fe.lessThan=function(e){return this.comp(e)<0};Fe.lt=Fe.lessThan;Fe.lessThanOrEqual=function(e){return this.comp(e)<=0};Fe.lte=Fe.lessThanOrEqual;Fe.le=Fe.lessThanOrEqual;Fe.greaterThan=function(e){return this.comp(e)>0};Fe.gt=Fe.greaterThan;Fe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Fe.gte=Fe.greaterThanOrEqual;Fe.ge=Fe.greaterThanOrEqual;Fe.compare=function(e){if(Yn(e)||(e=ci(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Fe.comp=Fe.compare;Fe.negate=function(){return!this.unsigned&&this.eq(Xn)?Xn:this.not().add(cc)};Fe.neg=Fe.negate;Fe.add=function(e){Yn(e)||(e=ci(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Jt(h<<16|p,l<<16|f,this.unsigned)};Fe.subtract=function(e){return Yn(e)||(e=ci(e)),this.add(e.neg())};Fe.sub=Fe.subtract;Fe.multiply=function(e){if(this.isZero())return La;if(Yn(e)||(e=ci(e)),Ma){var t=Ma.mul(this.low,this.high,e.low,e.high);return Jt(t,Ma.get_high(),this.unsigned)}if(e.isZero())return La;if(this.eq(Xn))return e.isOdd()?Xn:La;if(e.eq(Xn))return this.isOdd()?Xn:La;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(OO)&&e.lt(OO))return Ba(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,Jt(p<<16|d,f<<16|h,this.unsigned)};Fe.mul=Fe.multiply;Fe.divide=function(e){if(Yn(e)||(e=ci(e)),e.isZero())throw Error("division by zero");if(Ma){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ma.div_u:Ma.div_s)(this.low,this.high,e.low,e.high);return Jt(t,Ma.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?zs:La;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return zs;if(e.gt(this.shru(1)))return MO;i=zs}else{if(this.eq(Xn)){if(e.eq(cc)||e.eq(M0))return Xn;if(e.eq(Xn))return cc;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(La)?e.isNegative()?cc:M0:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Xn))return this.unsigned?zs:La;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=La}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Nd(2,s-48),c=Ba(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Ba(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=cc),i=i.add(c),a=a.sub(l)}return i};Fe.div=Fe.divide;Fe.modulo=function(e){if(Yn(e)||(e=ci(e)),Ma){var t=(this.unsigned?Ma.rem_u:Ma.rem_s)(this.low,this.high,e.low,e.high);return Jt(t,Ma.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Fe.mod=Fe.modulo;Fe.rem=Fe.modulo;Fe.not=function(){return Jt(~this.low,~this.high,this.unsigned)};Fe.and=function(e){return Yn(e)||(e=ci(e)),Jt(this.low&e.low,this.high&e.high,this.unsigned)};Fe.or=function(e){return Yn(e)||(e=ci(e)),Jt(this.low|e.low,this.high|e.high,this.unsigned)};Fe.xor=function(e){return Yn(e)||(e=ci(e)),Jt(this.low^e.low,this.high^e.high,this.unsigned)};Fe.shiftLeft=function(e){return Yn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Jt(0,this.low<<e-32,this.unsigned)};Fe.shl=Fe.shiftLeft;Fe.shiftRight=function(e){return Yn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Jt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Fe.shr=Fe.shiftRight;Fe.shiftRightUnsigned=function(e){if(Yn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return Jt(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Jt(t,0,this.unsigned):Jt(t>>>e-32,0,this.unsigned)};Fe.shru=Fe.shiftRightUnsigned;Fe.shr_u=Fe.shiftRightUnsigned;Fe.toSigned=function(){return this.unsigned?Jt(this.low,this.high,!1):this};Fe.toUnsigned=function(){return this.unsigned?this:Jt(this.low,this.high,!0)};Fe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Fe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Fe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Zt.fromBytes=function(e,t,n){return n?Zt.fromBytesLE(e,t):Zt.fromBytesBE(e,t)};Zt.fromBytesLE=function(e,t){return new Zt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Zt.fromBytesBE=function(e,t){return new Zt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var FB=X(pr=>{"use strict";var F=Ls();function zpe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}function $pe(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var A=zpe(F),X0=function(r,e){return X0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},X0(r,e)};function oe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");X0(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ce(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Ee(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function fe(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function te(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Je(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Ko=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Ri=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Z=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),vt=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Wpe=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error);(function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error);var UP=function(){function r(e){this.maxEntries=e||100,this.cache=new Map}return r.prototype.get=function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t},r.prototype.put=function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)},r.prototype.getMaxEntries=function(){return this.maxEntries},r.prototype.setMaxEntries=function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e},r}();function Gs(r,e){if(Array.isArray(r)){for(var t=[],n=0;n<e;n++)t=t.concat(r);return t}else{var t=new Array(e);return t.fill(r),t}}function _i(r,e){if(!r)throw new Wpe(e)}function WO(r,e){var t,n,a=0;try{for(var i=fe(r),o=i.next();!o.done;o=i.next()){var s=o.value;s===e&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function _n(r){return r.length===1?r[0]:r}function Pt(r){return Array.isArray(r)?r:[r]}function io(r){var e=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ws(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var za={};function pb(r){if(r==null)return null;var e={};return e.className=r.getClassName(),e.config=r.getConfig(),e}function Y0(r){var e,t;if(!(r==null||typeof r!="object"))if(Array.isArray(r))r.forEach(function(u){return Y0(u)});else{var n=Object.keys(r);try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value,s=r[o];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?r[o]=s.value:Y0(s))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}}function Lf(r,e,t,n,a){var i,o,s,u,c,l,f,h,p,d,m;if(e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n="object"),a===void 0&&(a=!1),typeof r=="string"){var v=r,g=void 0;if(v in t)g=t[v];else if(v in za)g=za[v];else if(g=e[v],g==null)throw new Z("Unknown ".concat(n,": ").concat(r,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(n," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(n," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return g}else{var y=r;if(y.className==null||y.config==null)throw new Z("".concat(n,": Improper config format: ")+"".concat(JSON.stringify(y),`.
`)+"'className' and 'config' must set.");var w=y.className,b=void 0,x=void 0;if(w in t?(i=te(t[w],2),b=i[0],x=i[1]):w in za?(o=te(za.className,2),b=o[0],x=o[1]):w in e&&(s=te(e[w],2),b=s[0],x=s[1]),b==null)throw new Z("Unknown ".concat(n,": ").concat(w,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(n," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(n," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(x!=null){var S={};try{for(var T=fe(Object.keys(za)),E=T.next();!E.done;E=T.next()){var C=E.value;S[C]=za[C]}}catch(J){u={error:J}}finally{try{E&&!E.done&&(c=T.return)&&c.call(T)}finally{if(u)throw u.error}}try{for(var R=fe(Object.keys(t)),_=R.next();!_.done;_=R.next()){var C=_.value;S[C]=t[C]}}catch(J){l={error:J}}finally{try{_&&!_.done&&(f=R.return)&&f.call(R)}finally{if(l)throw l.error}}var P=y.config;P.customObjects=S;var $=Object.assign({},za);try{for(var z=fe(Object.keys(t)),L=z.next();!L.done;L=z.next()){var C=L.value;za[C]=t[C]}}catch(J){h={error:J}}finally{try{L&&!L.done&&(p=z.return)&&p.call(z)}finally{if(h)throw h.error}}Y0(y.config);var B=x(b,y.config,t,a);return za=Object.assign({},$),B}else{var $=Object.assign({},za);try{for(var q=fe(Object.keys(t)),Y=q.next();!Y.done;Y=q.next()){var C=Y.value;za[C]=t[C]}}catch(j){d={error:j}}finally{try{Y&&!Y.done&&(m=q.return)&&m.call(q)}finally{if(d)throw d.error}}var B=new b(y.config);return za=Object.assign({},$),B}}}function qpe(r,e){return r<e?-1:r>e?1:0}function Td(r,e){return-1*qpe(r,e)}function jo(r){var e,t;if(r==null)return r;var n=[];try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.indexOf(o)===-1&&n.push(o)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function Upe(r){if(r==null)throw new Z("Invalid value in obj: ".concat(JSON.stringify(r)));for(var e in r)if(r.hasOwnProperty(e))return!1;return!0}function Ks(r,e,t){if(t!=null&&r.indexOf(t)<0)throw new Z("".concat(t," is not a valid ").concat(e,".  Valid values are ").concat(r," or null/undefined."))}function db(r,e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1/0),_i(t>=0),_i(n>=t),Array.isArray(r)&&r.length>=t&&r.length<=n&&r.every(function(a){return typeof a===e})}function Yr(r,e){Array.isArray(r)?(F.util.assert(r.length>0,function(){return"".concat(e," is unexpectedly an empty array.")}),r.forEach(function(t,n){return Yr(t,"element ".concat(n+1," of ").concat(e))})):F.util.assert(Number.isInteger(r)&&r>0,function(){return"Expected ".concat(e," to be a positive integer, but got ")+"".concat(VP(r),".")})}function VP(r){return r===null?"null":Array.isArray(r)?"["+r.map(function(e){return VP(e)}).join(",")+"]":typeof r=="string"?'"'.concat(r,'"'):"".concat(r)}function Vpe(r,e,t){var n=t!=null?t():F.util.now(),a,i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=t!=null?t():F.util.now();return u-n<e||(n=u,a=r.apply(void 0,Je([],te(o),!1))),a};return i}function GP(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}var Gpe=0;function HP(){return Gpe++}var Ed={};function Jd(r){return r===void 0&&(r=""),r in Ed||(Ed[r]=0),Ed[r]+=1,r+Ed[r].toString()}var Hpe=["channelsFirst","channelsLast"],Kpe=["nearest","bilinear"],jpe=["valid","same","causal"],Xpe=["max","avg"],Ype=["sum","mul","concat","ave"];var fc=new Map;function Ar(r){Ks(Hpe,"DataFormat",r)}function Zpe(r){Ks(Kpe,"InterpolationFormat",r)}function ya(r){Ks(jpe,"PaddingMode",r)}function KP(r){Ks(Xpe,"PoolMode",r)}var Ff=[],qO="/";function Us(r,e){Ff.push(r);try{var t=e();return Ff.pop(),t}catch(n){throw Ff.pop(),n}}function Jpe(){return Ff.length===0?"":Ff.join(qO)+qO}function jP(r){if(!YP(r))throw new Error("Not a valid tensor name: '"+r+"'");return Jpe()+r}function XP(r){if(!YP(r))throw new Error("Not a valid tensor name: '"+r+"'");fc.has(r)||fc.set(r,0);var e=fc.get(r);if(fc.set(r,fc.get(r)+1),e>0){var t="".concat(r,"_").concat(e);return fc.set(t,1),t}else return r}var Qpe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function YP(r){return!!r.match(Qpe)}function ede(r){return r===parseInt(r.toString(),10)}function Xo(r,e,t){e==null&&(e=0),t==null&&(t=r.length);for(var n=1,a=e;a<t;++a)n*=r[a];return n}function yc(r){if(r.length===0)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n<e&&(e=n)}return e}function Yo(r){if(r.length===0)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n>e&&(e=n)}return e}function vi(r,e){if(e<r)throw new Z("end (".concat(e,") < begin (").concat(r,") is forbidden."));for(var t=[],n=r;n<e;++n)t.push(n);return t}var L0;function $r(){return L0==null&&(L0=F.backend().epsilon()),L0}function mi(){return"channelsLast"}function Oi(r,e){return A.cast(r,e)}function zf(r,e){e===void 0&&(e=-1);var t=r.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),A.reshape(r,t)}function tde(r,e){return F.tidy(function(){if(r.shape.length!==2)throw new Z("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(r.shape.length," tensor."));var t=zf(r,1);return Z0(t,[1,e,1])})}function rde(r){var e=[Xo(r.shape)];return A.reshape(r,e)}function nde(r){if(r.rank<=1)throw new Z("batchFlatten requires a minimum rank of 2. Got rank: ".concat(r.rank,"."));var e=[r.shape[0],Xo(r.shape,1)];return A.reshape(r,e)}function Vs(r,e,t){return F.tidy(function(){switch(r.rank){case 1:return A.slice1d(r,e,t);case 2:return A.slice2d(r,[e,0],[t,r.shape[1]]);case 3:return A.slice3d(r,[e,0,0],[t,r.shape[1],r.shape[2]]);case 4:return A.slice4d(r,[e,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3]]);case 5:return A.slice(r,[e,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return A.slice(r,[e,0,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new Z("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function z0(r,e,t){return F.tidy(function(){switch(r.rank){case 1:return A.slice1d(r,e,t);case 2:return A.slice2d(r,[0,e],[r.shape[0],t]);case 3:return A.slice3d(r,[0,0,e],[r.shape[0],r.shape[1],t]);case 4:return A.slice4d(r,[0,0,0,e],[r.shape[0],r.shape[1],r.shape[2],t]);default:throw new Z("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function Id(r,e,t,n){return F.tidy(function(){switch(r.rank){case 1:return A.slice1d(r,e,t);case 2:switch(n){case 1:return Vs(r,e,t);case 2:return z0(r,e,t);default:throw new Z("The axis is not within the rank of the tensor "+"".concat(n))}case 3:switch(n){case 1:return Vs(r,e,t);case 2:return A.slice3d(r,[0,e,0],[r.shape[0],t,r.shape[2]]);case 3:return z0(r,e,t);default:throw new Z("The axis is not within the rank of the tensor "+"".concat(n))}case 4:switch(n){case 1:return Vs(r,e,t);case 2:return A.slice4d(r,[0,e,0,0],[r.shape[0],t,r.shape[2],r.shape[3]]);case 3:return A.slice4d(r,[0,0,e,0],[r.shape[0],r.shape[1],t,r.shape[3]]);case 4:return z0(r,e,t);default:throw new Z("The axis is not within the rank of the tensor "+"".concat(n))}default:throw new Z("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function vb(r,e){e===void 0&&(e=-1);var t;return e<0&&(t=r[0].rank,t!==0?e=t:e=0),e===r[0].rank&&(e=-1),A.concat(r,e)}function UO(r,e){switch(r.rank){case 1:return A.concat1d([r,e]);case 2:return A.concat2d([r,e],0);case 3:return A.concat3d([r,e],0);case 4:return A.concat4d([r,e],0);default:throw new Z("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(r.rank))}}function Z0(r,e){if(Array.isArray(e)||(e=[e]),r.rank!==e.length)throw new Z("The length of input n (".concat(e.length,") does not match ")+"the number of dimensions in input x (".concat(r.rank,")"));return A.tile(r,e)}function Qd(r,e,t,n,a){return e===void 0&&(e=0),t===void 0&&(t=1),A.randomNormal(r,e,t,n,a)}function Pi(r,e,t,n){if(r.rank<2||e.rank<2)throw new vt("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(r.shape," and y shape = ").concat(e.shape));if(e.rank>=3){var a=r.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(a!==i)throw new vt("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(r.shape," and ")+" y shape = ".concat(e.shape))}if(r.rank===2&&e.rank===2){var o=!1,s=!1;return A.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?J0(r.rank,n,mi()):null,activation:t})}else{var u=r.shape.slice(),c=u.pop();r=A.reshape(r,[-1,c]);var l=e.shape.slice(),f=l.pop(),i=l.pop(),h=Je(Je([],te(l),!1),[f],!1),p=Array.from({length:e.rank},function(y,w){return w===0?e.rank-2:w<=e.rank-2?w-1:w});e=A.reshape(A.transpose(e,p),[i,-1]);var d=Je(Je([],te(u),!1),te(h),!1),o=!1,s=!1;return A.reshape(A.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?J0(r.rank,n,mi()):null,activation:t}),d)}}function ZP(r,e,t){return F.tidy(function(){return Array.isArray(e)?e=F.tensor1d(e,"int32"):e=A.cast(e,"int32"),A.gather(r,e,t)})}function $f(r){return A.mul(r,r)}function J0(r,e,t){var n=e.shape;if(e.rank!==1&&e.rank!==r)throw new Z("Unexpected bias dimensions: ".concat(e.rank)+"; expected it to be 1 or ".concat(r));if(r===5){if(t==="channelsFirst")return n.length===1?A.reshape(e,[1,n[0],1,1,1]):A.reshape(e,[1,n[3],n[0],n[1],n[2]]);if(t==="channelsLast")return n.length===1?A.reshape(e,[1,1,1,1,n[0]]):A.reshape(e,[1].concat(n))}else if(r===4){if(t==="channelsFirst")return n.length===1?A.reshape(e,[1,n[0],1,1]):A.reshape(e,[1,n[2],n[0],n[1]]);if(t==="channelsLast")return n.length===1?A.reshape(e,[1,1,1,n[0]]):A.reshape(e,[1].concat(n))}else if(r===3){if(t==="channelsFirst")return n.length===1?A.reshape(e,[1,n[0],1]):A.reshape(e,[1,n[1],n[0]]);if(t==="channelsLast")return n.length===1?A.reshape(e,[1,1,n[0]]):A.reshape(e,[1].concat(n))}else if(r<3)return e;throw new Z("Unsupported input rank by biasAdd: ".concat(e.rank))}function bi(r,e,t){return F.tidy(function(){return t==null&&(t=mi()),Ar(t),A.add(r,J0(r.rank,e,t))})}function ade(r,e){if(e===void 0&&(e=1),e!==1)throw new vt("Support for alpha values other than 1 (".concat(e,") is not implemented ")+"yet.");return A.elu(r)}function ide(r){return F.tidy(function(){return A.div(r,A.add(A.abs(r),1))})}function JP(r,e,t,n){return F.tidy(function(){return A.dropout(r,e,t,n)})}function ode(r){return F.tidy(function(){var e=A.add(.5,A.mul(.2,r));return A.clipByValue(e,0,1)})}function Wf(r,e,t){return t===void 0&&(t=!1),t?r():e()}var sde=["fanIn","fanOut","fanAvg"],ude=["normal","uniform","truncatedNormal"];function cde(r){Ks(sde,"FanMode",r)}function lde(r){Ks(ude,"Distribution",r)}var Va=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(F.serialization.Serializable),mb=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return F.zeros(t,n)},e}(Va);mb.className="Zeros";F.serialization.registerClass(mb);var ev=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return F.ones(t,n)},e}(Va);ev.className="Ones";F.serialization.registerClass(ev);var gb=function(r){oe(e,r);function e(t){var n=r.call(this)||this;if(typeof t!="object")throw new Z("Expected argument of type ConstantConfig but got ".concat(t));if(t.value===void 0)throw new Z("config must have value set but got ".concat(t));return n.value=t.value,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){return F.mul(F.scalar(a.value),F.ones(t,n))})},e.prototype.getConfig=function(){return{value:this.value}},e}(Va);gb.className="Constant";F.serialization.registerClass(gb);var yb=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return e.prototype.apply=function(t,n){return F.randomUniform(t,this.minval,this.maxval,n,this.seed)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e}(Va);yb.className="RandomUniform";F.serialization.registerClass(yb);var bb=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new vt("randomNormal does not support dType ".concat(n,"."));return Qd(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(Va);bb.className="RandomNormal";F.serialization.registerClass(bb);var wb=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new vt("truncatedNormal does not support dType ".concat(n,"."));return F.truncatedNormal(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(Va);wb.className="TruncatedNormal";F.serialization.registerClass(wb);var xb=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.gain=t.gain!=null?t.gain:1,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){if(t.length!==2||t[0]!==t[1])throw new Z("Identity matrix initializer can only be used for 2D square matrices.");return F.mul(a.gain,F.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e}(Va);xb.className="Identity";F.serialization.registerClass(xb);function fde(r,e){e===void 0&&(e="channelsLast");var t,n;if(Ar(e),r.length===2)t=r[0],n=r[1];else if([3,4,5].indexOf(r.length)!==-1){if(e==="channelsFirst"){var a=Xo(r,2);t=r[1]*a,n=r[0]*a}else if(e==="channelsLast"){var a=Xo(r,0,r.length-2);t=r[r.length-2]*a,n=r[r.length-1]*a}}else{var i=Xo(r);t=Math.sqrt(i),n=Math.sqrt(i)}return[t,n]}var Fn=function(r){oe(e,r);function e(t){var n=r.call(this)||this;if(t.scale<0)throw new Z("scale must be a positive float. Got: ".concat(t.scale));return n.scale=t.scale==null?1:t.scale,n.mode=t.mode==null?"fanIn":t.mode,cde(n.mode),n.distribution=t.distribution==null?"normal":t.distribution,lde(n.distribution),n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=fde(t),i=a[0],o=a[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,i):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(i+o)/2),this.distribution==="normal"){var u=Math.sqrt(s);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new vt("".concat(this.getClassName()," does not support dType ").concat(n,"."));return F.truncatedNormal(t,0,u,n,this.seed)}else{var c=Math.sqrt(3*s);return F.randomUniform(t,-c,c,n,this.seed)}},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e}(Va);Fn.className="VarianceScaling";F.serialization.registerClass(Fn);var tv=function(r){oe(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Fn.className},e}(Fn);tv.className="GlorotUniform";F.serialization.registerClass(tv);var rv=function(r){oe(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Fn.className},e}(Fn);rv.className="GlorotNormal";F.serialization.registerClass(rv);var nv=function(r){oe(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Fn.className},e}(Fn);nv.className="HeNormal";F.serialization.registerClass(nv);var av=function(r){oe(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Fn.className},e}(Fn);av.className="HeUniform";F.serialization.registerClass(av);var iv=function(r){oe(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Fn.className},e}(Fn);iv.className="LeCunNormal";F.serialization.registerClass(iv);var ov=function(r){oe(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Fn.className},e}(Fn);ov.className="LeCunUniform";F.serialization.registerClass(ov);var kb=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_GAIN=1,n.ELEMENTS_WARN_SLOW=2e3,n.gain=t.gain==null?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){if(t.length<2)throw new vt("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError("Unsupported data type ".concat(n,"."));n=n;var i=F.util.sizeFromShape(t.slice(0,-1)),o=t[t.length-1],s=i*o;s>a.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(a.ELEMENTS_WARN_SLOW," (").concat(s,") elements: ")+"Slowness may result.");var u=[Math.max(o,i),Math.min(o,i)],c=Qd(u,0,1,n,a.seed),l=F.linalg.qr(c,!1),f=l[0],h=l[1],p=h.flatten().stridedSlice([0],[Math.min(o,i)*Math.min(o,i)],[Math.min(o,i)+1]);return f=F.mul(f,p.sign()),i<o&&(f=f.transpose()),F.mul(F.scalar(a.gain),f.reshape(t))})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e}(Va);kb.className="Orthogonal";F.serialization.registerClass(kb);var VO={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function GO(r,e){return e===void 0&&(e={}),Lf(r,F.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function br(r){return pb(r)}function lr(r){if(typeof r=="string"){var e=r in VO?VO[r]:r;if(e==="GlorotNormal")return new rv;if(e==="GlorotUniform")return new tv;if(e==="HeNormal")return new nv;if(e==="HeUniform")return new av;if(e==="LeCunNormal")return new iv;if(e==="LeCunUniform")return new ov;var t={};return t.className=e,t.config={},GO(t)}else return r instanceof Va?r:GO(r)}function Q0(r){return Array.isArray(r)&&Array.isArray(r[0])}function Od(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function it(r){var e;if(Array.isArray(r)){if(r.length!==1)throw new Z("Expected Tensor length to be 1; got ".concat(r.length));e=r[0]}else e=r;return e}function Ct(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return r=r,r[0];throw new Z("Expected exactly 1 Shape; got ".concat(r.length))}else return r}function Pd(r){var e,t,n=0;try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;o.shape.length===0?n+=1:n+=o.shape.reduce(function(s,u){return s*u})}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var HO="Variable",QP=function(){function r(e,t,n,a,i){t===void 0&&(t="float32"),n===void 0&&(n=HO),a===void 0&&(a=!0),i===void 0&&(i=null),this.dtype=t??"float32",this.shape=e.shape,this.id=HP(),n=n??HO,this.originalName=jP(n),this.name=XP(this.originalName),this.trainable_=a,this.constraint=i,this.val=A.variable(e,this.trainable_,this.name,this.dtype)}return r.prototype.read=function(){return this.assertNotDisposed(),this.val},r.prototype.write=function(e){return this.assertNotDisposed(),hde(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},r.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},r.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))},Object.defineProperty(r.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!1,configurable:!0}),r}();function hde(r,e){if(r.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(e.shape))}function eb(r){return r.map(function(e){return e.read()})}function Sb(r){r.forEach(function(e){var t=e[0];t.write(e[1])})}var Lr=function(){function r(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}return r}(),gi=function(){function r(e,t,n,a,i,o,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=HP(),o!=null&&(this.originalName=jP(o),this.name=XP(this.originalName)),this.rank=t.length}return r}(),pde=0,sv=function(){function r(e,t){var n,a;this.callArgs=t,this.id=pde++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;try{for(var i=fe(e.inboundLayers),o=i.next();!o.done;o=i.next()){var s=o.value;s?.outboundNodes.push(this)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}e.outboundLayer.inboundNodes.push(this)}return r.prototype.getConfig=function(){var e,t,n=[];try{for(var a=fe(this.inboundLayers),i=a.next();!i.done;i=a.next()){var o=i.value;o!=null?n.push(o.name):n.push(null)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},r}(),dde=0,mt=function(r){oe(e,r);function e(t){t===void 0&&(t={});var n=r.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=dde++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var a=t.name;if(!a){var i=n.getClassName();a=io(i)+"_"+Jd(i)}if(n.name=a,n.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var s=null;t.batchSize!=null&&(s=t.batchSize),o=[s].concat(t.inputShape)}n.batchInputShape=o;var u=t.dtype;u==null&&(u=t.inputDType),u==null&&(u="float32"),n.dtype=u}return t.weights!=null?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return e.nodeKey=function(t,n){return t.name+"_ib-"+n.toString()},e.prototype.getNodeAtIndex=function(t,n){if(this.inboundNodes.length===0)throw new Ri("The layer has never been called "+"and thus has no defined ".concat(n,"."));if(this.inboundNodes.length<=t)throw new Z("Asked to get ".concat(n," at node ").concat(t,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return _n(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return _n(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new Ko("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new Ko("Layer ".concat(this.name)+" is not connected, no input to return.");return _n(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new Ko("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new Ko("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return _n(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!1,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(n){return n.trainable=t}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){var n=Pt(t);if(!(this.inputSpec==null||this.inputSpec.length===0)){var a=Pt(this.inputSpec);if(n.length!==a.length)throw new Z("Layer ".concat(this.name," expects ").concat(a.length," inputs, ")+"but it received ".concat(n.length," input tensors. ")+"Input received: ".concat(t));for(var i=0;i<n.length;i++){var o=n[i],s=a[i];if(s!=null){var u=o.rank;if(s.ndim!=null&&u!==s.ndim)throw new Z("Input ".concat(i," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(s.ndim,", found ndim=").concat(u));if(s.maxNDim!=null&&u>s.maxNDim)throw new Z("Input ".concat(i," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(s.maxNDim,", found ndim=").concat(u));if(s.minNDim!=null&&u<s.minNDim)throw new Z("Input ".concat(i," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(s.minNDim,", found ndim=").concat(u,"."));if(s.dtype!=null&&o.dtype!==s.dtype)throw new Z("Input ".concat(i," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(s.dtype,", found dtype=").concat(o.dtype,"."));if(s.axes){var c=o.shape;for(var l in s.axes){var f=Number(l),h=s.axes[l],p=f>=0?c[f]:c[c.length+f];if(h!=null&&[h,null].indexOf(p)===-1)throw new Z("Input ".concat(i," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(f," of input shape to ")+"have value ".concat(h," but got shape ").concat(c,"."))}}if(s.shape!=null)for(var d=0;d<s.shape.length;++d){var m=s.shape[d],v=o.shape[d];if(m!=null&&v!=null&&m!==v)throw new Z("Input ".concat(i," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(s.shape,", ")+"found shape=".concat(o.shape,"."))}}}}},e.prototype.call=function(t,n){return t},e.prototype.invokeCallHook=function(t,n){this._callHook!=null&&this._callHook(t,n)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,n){var a=this;n=n||{},this.assertNotDisposed();var i=Pt(t),o=gde(t),s=yde(t);if(o===s)throw new Z("Arguments to apply() must be all SymbolicTensors or all Tensors");return Us(this.name,function(){var u,c,l,f;if(!a.built){a.assertInputCompatibility(t);var h=[];try{for(var p=fe(Pt(t)),d=p.next();!d.done;d=p.next()){var m=d.value;h.push(m.shape)}}catch(C){u={error:C}}finally{try{d&&!d.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}a.build(_n(h)),a.built=!0,a.initialWeights&&a.setWeights(a.initialWeights),a._refCount===null&&s&&(a._refCount=1)}if(a.assertInputCompatibility(t),s){var v=a.call(t,n);a.supportsMasking&&a.setMaskMetadata(t,v);var g=Pt(v),y=[];try{for(var w=fe(g),b=w.next();!b.done;b=w.next()){var x=b.value;i.indexOf(x)!==-1&&(x=x.clone()),y.push(x)}}catch(C){l={error:C}}finally{try{b&&!b.done&&(f=w.return)&&f.call(w)}finally{if(l)throw l.error}}if(v=_n(y),a.activityRegularizer!=null)throw new vt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}else{var S=vde(t),T=a.computeOutputShape(S),v=void 0,E=mde(t);if(a.warnOnIncompatibleInputShape(Array.isArray(t)?S[0]:S),T!=null&&T.length>0&&Array.isArray(T[0])?v=T.map(function(R,_){return new gi(E,R,a,Pt(t),n,a.name,_)}):v=new gi(E,T,a,Pt(t),n,a.name),a.addInboundNode(t,v,null,null,S,T,n),a._refCount++,a.activityRegularizer!=null)throw new vt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(t),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var n=!1;this.batchInputShape.forEach(function(a,i){a!=null&&t[i]!=null&&t[i]!==a&&(n=!0)}),n&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(t),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){var t,n;if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Ko("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var a=[];try{for(var i=fe(this.inboundNodes),o=i.next();!o.done;o=i.next()){var s=o.value,u=JSON.stringify(s.outputShapes);a.indexOf(u)===-1&&a.push(u)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}if(a.length===1){var c=this.inboundNodes[0].outputShapes;return Array.isArray(c)&&Array.isArray(c[0])&&c.length===1?c[0]:c}else throw new Ko("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!1,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new Ri("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return Pd(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),eb(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var n=this;F.tidy(function(){var a=n.weights;if(a.length!==t.length)throw new Z('You called setWeights(weights) on layer "'.concat(n.name,'" ')+"with a weight list of length ".concat(t.length,", ")+"but the layer was expecting ".concat(a.length," weights. ")+"Provided weights: ".concat(t,"..."));if(a.length!==0){for(var i=[],o=eb(a),s=0;s<o.length;++s){var u=o[s],c=a[s],l=t[s];if(!F.util.arraysEqual(u.shape,l.shape))throw new Z("Layer weight shape ".concat(u.shape," ")+"not compatible with provided weight shape ".concat(l.shape));i.push([c,l])}Sb(i)}})},e.prototype.addWeight=function(t,n,a,i,o,s,u,c){if(this._addedWeightNames.indexOf(t)!==-1)throw new Z("Duplicate weight name ".concat(t," for layer ").concat(this.name));this._addedWeightNames.push(t),a==null&&(a="float32"),this.fastWeightInitDuringBuild&&(i=c!=null?c():lr("zeros"));var l=i.apply(n,a),f=new QP(l,a,t,s,u);return l.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),s==null&&(s=!0),s?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var n;t==null||Array.isArray(t)&&t.length===0||(t=Pt(t),this._losses!==void 0&&this._losses!==null&&(n=this.losses).push.apply(n,Je([],te(t),!1)))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,n){var a=this;if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(function(i){if(i!=null)throw new TypeError("Layer ".concat(a.name," does not support masking, ")+"but was passed an inputMask.")});else throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");return null}return n},e.prototype.setMaskMetadata=function(t,n,a){if(!!this.supportsMasking){var i=this.computeMask(t,a),o=Pt(n),s=Pt(i);if(o.length!==s.length)throw new Error("".concat(this.name," outputs ").concat(o.length," tensors ")+"but ".concat(o.length," masks for those tensors"));for(var u=0;u<o.length;u++)o[u].kerasMask=s[u]}},e.prototype.addInboundNode=function(t,n,a,i,o,s,u){var c,l;u===void 0&&(u=null);var f=Pt(t);n=Pt(n),a=Pt(a),i=Pt(i),o=Od(o),s=Od(s);var h=[],p=[],d=[];try{for(var m=fe(f),v=m.next();!v.done;v=m.next()){var g=v.value;h.push(g.sourceLayer),p.push(g.nodeIndex),d.push(g.tensorIndex)}}catch(w){c={error:w}}finally{try{v&&!v.done&&(l=m.return)&&l.call(m)}finally{if(c)throw c.error}}new sv({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:d,inputTensors:f,outputTensors:n,inputMasks:a,outputMasks:i,inputShapes:o,outputShapes:s},u);for(var y=0;y<n.length;y++)n[y].sourceLayer=this,n[y].nodeIndex=this.inboundNodes.length-1,n[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(F.serialization.Serializable);function vde(r){var e,t;r=Pt(r);var n=[];try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push(o.shape)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return _n(n)}function mde(r){return"float32"}function eM(r,e,t){var n,a;if((e==null||t!=null&&t>0)&&(e=r.sourceLayer,t=r.nodeIndex),e.inboundNodes.length===0)return[r];var i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;for(var o=[],s=0;s<i.inboundLayers.length;s++){var u=i.inputTensors[s],c=i.inboundLayers[s],l=i.nodeIndices[s],f=eM(u,c,l);try{for(var h=(n=void 0,fe(f)),p=h.next();!p.done;p=h.next()){var d=p.value;o.indexOf(d)===-1&&o.push(d)}}catch(m){n={error:m}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}}return o}function gde(r){var e,t,n=!0;try{for(var a=fe(Pt(r)),i=a.next();!i.done;i=a.next()){var o=i.value;if(!(o instanceof gi)){n=!1;break}}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function yde(r){var e,t,n=!0;try{for(var a=fe(Pt(r)),i=a.next();!i.done;i=a.next()){var o=i.value;if(o instanceof gi){n=!1;break}}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var kc=function(r){oe(e,r);function e(t){var n=r.call(this,{dtype:t.dtype,name:t.name!=null?t.name:Jd("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new Z("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=t.batchInputShape;if(a==null){if(t.inputShape==null)throw new Z("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new Z("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=a,n.dtype=i,n.inputSpec=[{shape:a}];var o=new gi(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new sv({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),n}return e.prototype.apply=function(t,n){throw new Z("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e}(mt);kc.className="InputLayer";F.serialization.registerClass(kc);function tM(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new Z("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=r.batchShape;r.shape!=null&&e==null&&(e=[null].concat(r.shape));var t=r.dtype;t==null&&(t="float32");var n=new kc({batchInputShape:e,name:r.name,dtype:t,sparse:r.sparse}),a=n.inboundNodes[0].outputTensors;return a[0]}function bde(r,e){if(r.dtype==null||r.dtype===e.dtype)return e;try{return F.cast(e,r.dtype)}catch{throw new Z("The dtype of the feed (".concat(e.dtype,") can not be cast to the dtype ")+"of the key '".concat(r.name,"' (").concat(r.dtype,")."))}}var dc=function(){function r(e){var t,n;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof r)for(var a in e.id2Value)this.id2Value[a]=e.id2Value[a],a in e.id2Mask&&(this.id2Mask[a]=e.id2Mask[a]);else{if(e==null)return;try{for(var i=fe(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s.key,s.value)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}return r.prototype.add=function(e,t,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=bde(e,t),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new Z("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this},r.prototype.addFeed=function(e){this.add(e.key,e.value)},r.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},r.prototype.names=function(){return Object.keys(this.name2Id)},r.prototype.getValue=function(e){if(e instanceof gi){if(this.id2Value[e.id]==null)throw new Z("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}else{var t=this.name2Id[e];if(t==null)throw new Z("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},r.prototype.getMask=function(e){if(e instanceof gi){if(this.id2Value[e.id]==null)throw new Z("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}else{var t=this.name2Id[e];if(t==null)throw new Z("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},r.prototype.disposeMasks=function(){this.id2Mask!=null&&F.dispose(this.id2Mask)},r}(),Md=new UP,Bd=new UP;function wde(r){Md?.setMaxEntries(r),Bd?.setMaxEntries(r)}function Cf(r,e,t,n){var a,i,o,s,u=t==null?!1:t.training,c=Array.isArray(r),l=c?r:[r],f=l.map(function(le){return le.name}),h=[],p=e.names();try{for(var d=fe(f),m=d.next();!m.done;m=d.next()){var v=m.value;p.indexOf(v)!==-1?h.push(e.getValue(v)):h.push(null)}}catch(le){a={error:le}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}n!=null&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);var g=f.join(",")+"|"+e.names().sort().join(","),y=Md.get(g),w;if(y==null){var b=xde(l,e);y=b.sorted,w=b.recipientCounts,Md.put(g,y),Bd.put(g,w)}w={},u||Object.assign(w,Bd.get(g));for(var x=new dc(e),S=0;S<y.length;++S){if(n!=null){var T=F.memory().numTensors;T>n.maxNumTensors&&(n.maxNumTensors=T),T<n.minNumTensors&&(n.minNumTensors=T)}var E=y[S],C=E.sourceLayer;if(!(C instanceof kc)){var R=[],_=[],P=[],$=!1;try{for(var z=(o=void 0,fe(E.inputs)),L=z.next();!L.done;L=z.next()){var B=L.value,q=x.getValue(B),Y=x.getMask(B);R.push(q),_.push(Y),Y!=null&&($=!0),u||(w[B.name]--,w[B.name]===0&&!e.hasKey(B)&&f.indexOf(B.name)===-1&&!q.isDisposed&&B.sourceLayer.stateful!==!0&&P.push(q))}}catch(le){o={error:le}}finally{try{L&&!L.done&&(s=z.return)&&s.call(z)}finally{if(o)throw o.error}}$&&(t=t||{},t.mask=_[0]);var J=Pt(C.apply(R,t)),U=null;C.supportsMasking&&(U=C.computeMask(R,_));for(var j=Sde(E),ne=Array.isArray(j)?j:[j],re=0;re<ne.length;++re){x.hasKey(ne[re])||x.add(ne[re],J[re],Array.isArray(U)?U[0]:U);var se=f.indexOf(ne[re].name);se!==-1&&(h[se]=J[re])}u||F.dispose(P)}}return x.disposeMasks(),c?h:h[0]}function xde(r,e){var t,n,a,i;F.util.assert(r!=null&&r.length>0,function(){return"Expected at least one fetch, got none"});var o=[],s={};if(r.length===1){var u=KO(r[0],e);o=u.sorted,s=u.recipientMap}else{var c=new Set;try{for(var l=fe(r),f=l.next();!f.done;f=l.next()){var h=f.value,p=KO(h,e),d=p.sorted,m=p.recipientMap;try{for(var v=(a=void 0,fe(d)),g=v.next();!g.done;g=v.next()){var y=g.value;c.has(y.name)||(o.push(y),c.add(y.name))}}catch(x){a={error:x}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}var w=function(x){s[x]==null&&(s[x]=new Set),m[x].forEach(function(S){return s[x].add(S)})};for(var b in m)w(b)}}catch(x){t={error:x}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}}return{sorted:o,recipientCounts:kde(s)}}function kde(r){var e={};for(var t in r)e[t]=r[t].size;return e}function KO(r,e){var t,n,a,i,o=new Set,s=[],u={};try{for(var c=fe(e.names()),l=c.next();!l.done;l=c.next()){var f=l.value;o.add(f)}}catch(w){t={error:w}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}var h=[],p=[];for(h.push(r);h.length>0;){var d=h[h.length-1];if(o.has(d.name)){h.pop();continue}var m=p[p.length-1]===h.length-1;if(d.inputs.length===0||m)h.pop(),s.push(d),o.add(d.name),m&&p.pop();else{p.push(h.length-1);try{for(var v=(a=void 0,fe(d.inputs)),g=v.next();!g.done;g=v.next()){var y=g.value;u[y.name]==null&&(u[y.name]=new Set),u[y.name].add(d.name),!o.has(y.name)&&h.push(y)}}catch(w){a={error:w}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}}}return{sorted:s,recipientMap:u}}function Sde(r){var e,t,n;if(r.sourceLayer.inboundNodes.length===1)n=r.sourceLayer.output;else{for(var a=null,i=0;i<r.sourceLayer.inboundNodes.length;++i)try{for(var o=(e=void 0,fe(r.sourceLayer.inboundNodes[i].outputTensors)),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===r.id){a=i;break}}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}n=r.sourceLayer.getOutputAt(a)}return n}var Nde=F.env();Nde.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",function(){return 100},wde);var rM="Abs",Tde="Acos",Ede="Acosh",Nb="Add",Ide="AddN",Cde="ArgMax",Ade="ArgMin",Dde="Asin",_de="Asinh",Fde="Atan",Rde="Atanh",Ode="Atan2",Pde="AvgPool",Mde="AvgPoolGrad",Bde="AvgPool3D",Lde="AvgPool3DGrad",nM="BatchMatMul",aM="BatchToSpaceND",zde="BroadcastTo",Tb="Cast",$de="Ceil",Wde="ClipByValue",qde="Complex",iM="ComplexAbs",oM="Concat",sM="Conv2D",Ude="Conv2DBackpropFilter",uM="Conv2DBackpropInput",Vde="Conv3D",Gde="Conv3DBackpropFilterV2",Hde="Conv3DBackpropInputV2",cM="Cos",lM="Cosh",Kde="Cumprod",fM="Cumsum",jde="DepthwiseConv2dNative",Xde="DepthwiseConv2dNativeBackpropFilter",Yde="DepthwiseConv2dNativeBackpropInput",Zde="Dilation2D",Jde="Dilation2DBackpropInput",Qde="Dilation2DBackpropFilter",hM="RealDiv",eve="Elu",tve="EluGrad",rve="Erf",nve="Equal",pM="Exp",dM="ExpandDims",ave="Expm1",ive="Fill",vM="Floor",mM="FloorDiv",ove="FusedBatchNorm",gM="GatherV2",sve="Greater",yM="GreaterEqual",Eb="Identity",uve="Imag",cve="IsFinite",lve="IsInf",fve="IsNan",hve="LeakyRelu",pve="Less",dve="LessEqual",bM="Log",vve="Log1p",mve="LogicalAnd",gve="LogicalNot",yve="LogSoftmax",bve="LRN",wve="LRNGrad",xve="Max",wM="Maximum",kve="MaxPool",Sve="MaxPoolGrad",Nve="MaxPool3D",Tve="MaxPool3DGrad",Eve="Mean",Ive="Min",Cve="Minimum",Ave="MirrorPad",Dve="Mod",xM="Multiply",kM="Neg",_ve="OnesLike",Fve="OneHot",SM="Pack",NM="PadV2",TM="Pow",Rve="Prelu",Ove="Prod",Pve="Real",Mve="Reciprocal",Bve="Relu",EM="Reshape",Lve="ResizeNearestNeighbor",zve="ResizeNearestNeighborGrad",$ve="ResizeBilinear",Wve="ResizeBilinearGrad",qve="Relu6",IM="Reverse",Uve="Round",CM="Rsqrt",Vve="TensorScatterUpdate",AM="Select",Gve="Selu",DM="Slice",_M="Sin",FM="Sinh",Hve="Sign",RM="Sigmoid",Kve="Softplus",OM="Sqrt",PM="Sum",MM="SpaceToBatchND",BM="SplitV",jve="Softmax",Xve="SquaredDifference",Yve="Square",LM="Sub",Zve="Tan",Jve="Tanh",Ib="Tile",Dd="Transpose",zM="Unpack",$M="UnsortedSegmentSum",WM="ZerosLike",qM="Step";var Qve=1e-7,eme=1e-4,tme=function(){function r(){}return r.prototype.refCount=function(e){return Zn("refCount")},r.prototype.incRef=function(e){return Zn("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return Zn("time")},r.prototype.read=function(e){return Zn("read")},r.prototype.readSync=function(e){return Zn("readSync")},r.prototype.readToGPU=function(e,t){return Zn("readToGPU")},r.prototype.numDataIds=function(){return Zn("numDataIds")},r.prototype.disposeData=function(e,t){return Zn("disposeData")},r.prototype.write=function(e,t,n){return Zn("write")},r.prototype.move=function(e,t,n,a,i){return Zn("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return Zn("createTensorFromGPUData")},r.prototype.memory=function(){return Zn("memory")},r.prototype.floatPrecision=function(){return Zn("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Qve:eme},r.prototype.dispose=function(){return Zn("dispose")},r}();function Zn(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Ne(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function rme(r,e,t){t===void 0&&(t=""),Ne(Cb(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function Mi(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function Cb(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Ld(r){return r%1===0}function _d(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function js(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),Ne(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),Ne(r.every(function(n){return Ld(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function nme(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function ame(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function ime(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function tb(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function ome(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function Ab(r){return typeof r=="string"||r instanceof String}function sme(r){return typeof r=="boolean"}function ume(r){return typeof r=="number"}function uv(r){return Array.isArray(r)?uv(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":ume(r)?"float32":Ab(r)?"string":sme(r)?"bool":"float32"}function rb(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Db(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function UM(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=UM(r+o*u,s,t,n);return a}function jO(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return UM(0,r,e,t)}function VM(r,e){for(var t=_b(r,e),n=0;n<t.length;n++)t[n]=1;return t}function _b(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function qf(r){r.forEach(function(e){Ne(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function Fb(r){return r&&r.then&&typeof r.then=="function"}var XO="tfjsflags",cme=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=lme,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(fr().getBool("IS_TEST")||fr().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];fr().getBool("IS_TEST")||fr().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return Ce(this,void 0,void 0,function(){var t,n;return Ee(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Fb(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(XO in t){var n=t[XO].split(",");n.forEach(function(a){var i=te(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=hme(o,s)})}}},r}();function lme(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return fme(e,n[0],n[1]),n.join("=")}),e}function fme(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function hme(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function fr(){return GM}var GM=null;function pme(r){GM=r}var $0;function HM(){if($0==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");$0=r}return $0}function dme(){var r=HM();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Rb(r,e){var t=dme();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}function pc(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];fr().getBool("IS_TEST")||fr().getBool("PROD")||console.warn.apply(console,Je([],te(r),!1))}var KM=Rb("kernelRegistry",function(){return new Map}),nb=Rb("gradRegistry",function(){return new Map});function YO(r,e){var t=mme(r,e);return KM.get(t)}function ZO(r){return nb.get(r)}function JO(r){for(var e=KM.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=te(i,2),s=o[0],u=o[1],c=te(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function vme(r){var e=r.kernelName;nb.has(e)&&fr().getBool("DEBUG")&&pc("Overriding the gradient for '".concat(e,"'")),nb.set(e,r)}function mme(r,e){return"".concat(e,"_").concat(r)}function gme(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var Xs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yme(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function bme(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var jM=Qt,$a=null;try{$a=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Qt(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Qt.prototype.__isLong__;Object.defineProperty(Qt.prototype,"__isLong__",{value:!0});function Qn(r){return(r&&r.__isLong__)===!0}Qt.isLong=Qn;var QO={},eP={};function Ys(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=eP[r],n)?n:(t=er(r,(r|0)<0?-1:0,!0),a&&(eP[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=QO[r],n)?n:(t=er(r,r<0?-1:0,!1),a&&(QO[r]=t),t))}Qt.fromInt=Ys;function Wa(r,e){if(isNaN(r))return e?qs:qa;if(e){if(r<0)return qs;if(r>=XM)return JM}else{if(r<=-rP)return Jn;if(r+1>=rP)return ZM}return r<0?Wa(-r,e).neg():er(r%bc|0,r/bc|0,e)}Qt.fromNumber=Wa;function er(r,e,t){return new Qt(r,e,t)}Qt.fromBits=er;var zd=Math.pow;function Ob(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return qa;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Ob(r.substring(1),e,t).neg();for(var a=Wa(zd(t,8)),i=qa,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Wa(zd(t,s));i=i.mul(c).add(Wa(u))}else i=i.mul(a),i=i.add(Wa(u))}return i.unsigned=e,i}Qt.fromString=Ob;function wi(r,e){return typeof r=="number"?Wa(r,e):typeof r=="string"?Ob(r,e):er(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Qt.fromValue=wi;var tP=1<<16,wme=1<<24,bc=tP*tP,XM=bc*bc,rP=XM/2,nP=Ys(wme),qa=Ys(0);Qt.ZERO=qa;var qs=Ys(0,!0);Qt.UZERO=qs;var vc=Ys(1);Qt.ONE=vc;var YM=Ys(1,!0);Qt.UONE=YM;var ab=Ys(-1);Qt.NEG_ONE=ab;var ZM=er(-1,2147483647,!1);Qt.MAX_VALUE=ZM;var JM=er(-1,-1,!0);Qt.MAX_UNSIGNED_VALUE=JM;var Jn=er(0,-2147483648,!1);Qt.MIN_VALUE=Jn;var Re=Qt.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*bc+(this.low>>>0):this.high*bc+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Jn)){var t=Wa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Wa(zd(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Jn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return Qn(e)||(e=wi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(Qn(e)||(e=wi(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(Jn)?Jn:this.not().add(vc)};Re.neg=Re.negate;Re.add=function(e){Qn(e)||(e=wi(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,er(h<<16|p,l<<16|f,this.unsigned)};Re.subtract=function(e){return Qn(e)||(e=wi(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return qa;if(Qn(e)||(e=wi(e)),$a){var t=$a.mul(this.low,this.high,e.low,e.high);return er(t,$a.get_high(),this.unsigned)}if(e.isZero())return qa;if(this.eq(Jn))return e.isOdd()?Jn:qa;if(e.eq(Jn))return this.isOdd()?Jn:qa;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(nP)&&e.lt(nP))return Wa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,er(p<<16|d,f<<16|h,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(Qn(e)||(e=wi(e)),e.isZero())throw Error("division by zero");if($a){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?$a.div_u:$a.div_s)(this.low,this.high,e.low,e.high);return er(t,$a.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?qs:qa;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return qs;if(e.gt(this.shru(1)))return YM;i=qs}else{if(this.eq(Jn)){if(e.eq(vc)||e.eq(ab))return Jn;if(e.eq(Jn))return vc;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(qa)?e.isNegative()?vc:ab:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Jn))return this.unsigned?qs:qa;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=qa}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:zd(2,s-48),c=Wa(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Wa(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=vc),i=i.add(c),a=a.sub(l)}return i};Re.div=Re.divide;Re.modulo=function(e){if(Qn(e)||(e=wi(e)),$a){var t=(this.unsigned?$a.rem_u:$a.rem_s)(this.low,this.high,e.low,e.high);return er(t,$a.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return er(~this.low,~this.high,this.unsigned)};Re.and=function(e){return Qn(e)||(e=wi(e)),er(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return Qn(e)||(e=wi(e)),er(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return Qn(e)||(e=wi(e)),er(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return Qn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?er(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):er(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return Qn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?er(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):er(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(Qn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return er(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?er(t,0,this.unsigned):er(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?er(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:er(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Qt.fromBytes=function(e,t,n){return n?Qt.fromBytesLE(e,t):Qt.fromBytesBE(e,t)};Qt.fromBytesLE=function(e,t){return new Qt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Qt.fromBytesBE=function(e,t){return new Qt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var QM=yme(jM),xme=$pe({__proto__:null,default:QM},[jM]),kme=QM||xme;function Pb(r){return kme.fromString(r,!0,16)}Pb("c3a5c85c97cb3127");Pb("b492b66fbe98f273");Pb("9ae16a3b2f90404f");function Sme(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function e4(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Rf(r)),fr().getBool("DEBUG")&&ame(r,e),Sme(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function $d(){return fr().platform.now()}function Nme(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",fr().platform.encode(r,e)}function aP(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",fr().platform.decode(r,e)}function Ua(r){return fr().platform.isTypedArray!=null?fr().platform.isTypedArray(r):gme(r)}function Rf(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||Fb(r)||r==null||Ua(r)&&t)e.push(r);else if(Array.isArray(r)||Ua(r))for(var i=0;i<r.length;++i)Rf(r[i],e,t);else{var o=-1;try{for(var s=fe(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)Rf(r[i],e,t)}return e}var Tme=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Ime)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=$d();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=fe(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:$d()-c})}if(fr().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){Eme(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r}();function Eme(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var Ime=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?_d("".concat(a,"ms"),9):a.error,u=_d(e,25),c=t.rank,l=t.size,f=_d(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function Cme(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function Ame(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!Cb(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var iP=20,xf=3,W0=7;function Dme(r,e,t,n){var a=Db(e),i=_me(r,e,t,a),o=e.length,s=Fd(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function _me(r,e,t,n){var a=Mi(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Df(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Af(u[l+f],0,t).length);return o}function Af(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(W0))," + ")+"".concat(parseFloat(r[1].toFixed(W0)),"j"):Ab(r)?n="'".concat(r,"'"):t==="bool"?n=t4(r):n=parseFloat(r.toFixed(W0)).toString(),_d(n,e)}function t4(r){return r===0?"false":"true"}function Fd(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Df(r);return[Af(c[0],0,t)]}return t==="bool"?[t4(r[0])]:[r[0].toString()]}if(u===1){if(s>iP){var l=xf*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-xf)*o,s*o));return t==="complex64"&&(f=Df(f),h=Df(h)),["["+f.map(function(T,E){return Af(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Af(T,a[s-xf+E],t)}).join(", ")+"]"]}var p=t==="complex64"?Df(r):Array.from(r);return["["+p.map(function(T,E){return Af(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>iP){for(var y=0;y<xf;y++){var w=y*v,b=w+v;g.push.apply(g,Je([],te(Fd(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-xf;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Je([],te(Fd(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Je([],te(Fd(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function Df(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}(function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Mi(e),n!=null){var i=n.length;Ne(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||nme(t,this.size),this.strides=Db(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),Ne(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=fe(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return fi().makeTensor(this.values,this.shape,this.dtype)},r})();var fi=null,kf=null;function Fme(r){fi=r}var hi=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Mi(e),this.strides=Db(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,kf.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return kf.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,jO(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return jO(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Ce(this,void 0,void 0,function(){var e,t;return Ee(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=fi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return aP(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),fi().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=fi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return aP(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,fi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),fi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),kf.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),kf.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return Dme(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),kf.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),fi().makeVariable(this,e,t,n)},r}();Object.defineProperty(hi,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function r4(){return Rb("Tensor",function(){return hi})}r4();var Wd=function(r){oe(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Cb(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));fi().disposeTensor(this),this.dataId=t.dataId,fi().incRef(this,null)},e.prototype.dispose=function(){fi().disposeVariable(this),this.isDisposedInternal=!0},e}(hi);Object.defineProperty(Wd,Symbol.hasInstance,{value:function(r){return r instanceof hi&&r.assign!=null&&r.assign instanceof Function}});var oP;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(oP||(oP={}));var ib;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(ib||(ib={}));var ob;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(ob||(ob={}));var sb;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(sb||(sb={}));var ub;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(ub||(ub={}));var Rme={float32:sb,int32:ib,bool:ob,complex64:ub};function Ome(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return Rme[r][e]}function n4(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function a4(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function ba(r,e){if(r.dtype===e.dtype)return[r,e];var t=Ome(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function i4(r){var e=[],t=new Set;return o4(r,e,t),e}function o4(r,e,t){if(r!=null){if(r instanceof hi){e.push(r);return}if(!!Pme(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),o4(i,e,t))}}}}function Pme(r){return Array.isArray(r)||typeof r=="object"}function q0(r){return r.kernelName!=null}var sP=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),Mb=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new sP}return r.prototype.ready=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a;return Ee(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(pc("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ee(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Tme(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=JO(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=JO(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof tme)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,pc("Initialization of backend ".concat(e," failed")),pc(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return pc("Initialization of backend ".concat(e," failed")),pc(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=ve.runKernel(Eb,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return ve.runKernel(Tb,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=YO(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=q0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(q0(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=YO(f,this.backendName);Ne(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=q0(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=ZO(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(Ne(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&Ab(e[0])&&(i=e.map(function(l){return Nme(l)}));var o=a.write(i,t,n),s=new hi(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=ome(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new hi(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Wd(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*tb(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Wd||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*tb(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ee(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Je([],te(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=fe(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=ZO(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=_b(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=i4(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),Ne(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});Ne(o instanceof hi,function(){return"The result y returned by f() must be a tensor."});var s=Cme(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??Mme(o.shape),Ame(u,s,function(l){return i.tidy(l)},Lme);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=fe(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return Ne(rb(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];Ne(n.every(function(c){return c instanceof hi}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Je([],te(Je(Je([],te(n),!1),[l],!1)),!1)),Ne(i.value instanceof hi,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Ne(rb(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];Ne(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Ne(h.every(function(d){return d instanceof hi}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Ce(this,void 0,void 0,function(){var t,n;return Ee(this,function(a){switch(a.label){case 0:return t=$d(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=$d()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new sP;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();Mb.nextTensorId=0;Mb.nextVariableId=0;function Mme(r){var e=VM(Mi(r),"float32");return ve.makeTensor(e,r,"float32")}function Bme(){var r=HM();if(r._tfengine==null){var e=new cme(r);r._tfengine=new Mb(e)}return pme(r._tfengine.ENV),Fme(function(){return r._tfengine}),r._tfengine}var ve=Bme();function Lme(r,e){var t={a:r,b:e};return ve.runKernel(Nb,t)}function zme(r,e){var t=r;if(Ua(r))return e==="string"?[]:[r.length];if(n4(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(a4(r))return[r.buffer.size/(e==null?4:tb(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||Ua(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&fr().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&s4(r,a,[]),a}function s4(r,e,t){if(t=t||[],!Array.isArray(r)&&!Ua(r)){Ne(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}Ne(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),Ne(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)s4(r[a],n,t.concat(a))}function uP(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function Ie(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof r4())return uP(n,r.dtype,e,t),r;var a=uv(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),uP(n,a,e,t),r==null||!Ua(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=zme(r,a);!Ua(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?e4(r,a):Rf(r,[],s);return ve.makeTensor(u,o,a)}function u4(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return Ie(i,"".concat(e,"[").concat(o,"]"),t,n)})}var $me="__op";function Ge(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+$me;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ve.startScope(t);try{var s=n.apply(void 0,Je([],te(i),!1));return Fb(s)&&console.error("Cannot return a Promise inside of tidy."),ve.endScope(s),s}catch(u){throw ve.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function Wme(r,e){var t=Ie(r,"x","cast");if(!ime(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return ve.runKernel(Tb,n,a)}var St=Ge({cast_:Wme});function qme(r,e){var t,n=Ie(r,"a","mul"),a=Ie(e,"b","mul");t=te(ba(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(xM,i)}var be=Ge({mul_:qme});function Ume(r,e){e===void 0&&(e=0);var t=Ie(r,"x","step"),n={x:t},a={alpha:e};return ve.runKernel(qM,n,a)}var Bb=Ge({step_:Ume}),c4={kernelName:rM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,Bb(St(n,"float32"),-1))}}}};function Vme(r,e){var t,n=Ie(r,"a","floorDiv"),a=Ie(e,"b","floorDiv");t=te(ba(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(mM,i)}var Gme=Ge({floorDiv_:Vme});function Hme(r,e){var t,n=Ie(r,"a","div"),a=Ie(e,"b","div");if(t=te(ba(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return Gme(n,a);var i={a:n,b:a},o={};return ve.runKernel(hM,i,o)}var Mt=Ge({div_:Hme});function Kme(r){var e=Ie(r,"x","neg"),t={x:e};return ve.runKernel(kM,t)}var Ga=Ge({neg_:Kme});function jme(r,e,t,n){if(n==null)n=uv(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(a4(r)||n4(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return ve.backend.createTensorFromGPUData(r,e||t,n)}if(!Ua(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){qf(e);var a=Mi(e),i=Mi(t);Ne(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Mi(e.slice(o)):!0;Ne(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!Ua(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?e4(r,n):Rf(r,[],!0),ve.makeTensor(r,e,n)}function Nr(r,e){if((Ua(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ua(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return jme(r,t,n,e)}function Xme(r){var e=Ie(r,"x","sqrt","float32"),t={x:e};return ve.runKernel(OM,t)}var yi=Ge({sqrt_:Xme});function Yme(r){var e=Ie(r,"x","square"),t={};return ve.runKernel("Square",{x:e},t)}var Tr=Ge({square_:Yme});function Zme(r,e){var t,n=Ie(r,"a","sub"),a=Ie(e,"b","sub");t=te(ba(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(LM,i)}var an=Ge({sub_:Zme}),Jme={kernelName:Tde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=Tr(St(n,"float32")),i=yi(an(Nr(1),a));return Ga(Mt(r,i))}}}},Qme={kernelName:Ede,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=yi(an(Tr(St(n,"float32")),1));return Mt(r,a)}}}};function on(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function pn(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}function ege(r,e){var t=Ie(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return ve.runKernel(EM,n,a)}var Qe=Ge({reshape_:ege});function tge(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=Ie(r,"x","sum");n.dtype==="bool"&&(n=St(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return ve.runKernel(PM,a,i)}var wr=Ge({sum_:tge}),rge={kernelName:Nb,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=pn(n.shape,a.shape),o=function(){var u=r,c=on(n.shape,i);return c.length>0&&(u=wr(u,c)),Qe(u,n.shape)},s=function(){var u=r,c=on(a.shape,i);return c.length>0&&(u=wr(u,c)),Qe(u,a.shape)};return{a:o,b:s}}};var nge={kernelName:Ide,saveAllInputs:!0,gradFunc:function(r,e){var t={};return e.forEach(function(n,a){t[a]=function(){return r.clone()}}),t}};function age(r){var e=Ie(r,"x","zerosLike"),t={x:e};return ve.runKernel(WM,t)}var _t=Ge({zerosLike_:age}),ige={kernelName:Cde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return _t(n)}}}},oge={kernelName:Ade,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return _t(n)}}}},sge={kernelName:Dde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Mt(r,yi(an(Nr(1),Tr(St(n,"float32")))))}}}};function uge(r,e){var t,n=Ie(r,"a","add"),a=Ie(e,"b","add");t=te(ba(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(Nb,i)}var xt=Ge({add_:uge}),cge={kernelName:_de,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=yi(xt(Nr(1),Tr(St(n,"float32"))));return Mt(r,a)}}}},lge={kernelName:Ode,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=pn(n.shape,a.shape),o=function(){var u=xt(Tr(n),Tr(a)),c=be(r,Mt(a,u)),l=on(n.shape,i);return l.length>0&&(c=wr(c,l)),Qe(c,n.shape)},s=function(){var u=xt(Tr(n),Tr(a)),c=Ga(be(r,Mt(n,u))),l=on(a.shape,i);return l.length>0&&(c=wr(c,l)),Qe(c,a.shape)};return{a:o,b:s}}},fge={kernelName:Fde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Mt(r,xt(Tr(St(n,"float32")),1))}}}},hge={kernelName:Rde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Mt(r,an(Nr(1),Tr(St(n,"float32"))))}}}};function l4(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Of(r){var e=te(l4(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function f4(r,e){return Of(r)||Of(e)}function cP(r){return l4(r).every(function(e){return e>0})}function Zs(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")Ne(Ld(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){Ne(Ld(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function pge(r,e,t,n,a,i){var o=Ie(r,"dy","avgPool3dGrad"),s=Ie(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=Qe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Qe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Ne(u.rank===5,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")}),Ne(c.rank===5,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")}),Zs("avgPool3dGrad",a,i);var f={dy:u,input:c},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ve.runKernel(Lde,f,h);return l?Qe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var dge=Ge({avgPool3dGrad_:pge}),vge={kernelName:Bde,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad,u=t.dimRoundingMode;return{x:function(){return dge(r,a,i,o,s,u)}}}};function mge(r,e,t,n,a){var i=Ie(r,"dy","avgPoolGrad"),o=Ie(e,"input","avgPoolGrad");Ne(o.rank===i.rank,function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")});var s=o,u=i,c=!1;o.rank===3&&(c=!0,s=Qe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Qe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Ne(u.rank===4,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")}),Ne(s.rank===4,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")});var l={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ve.runKernel(Mde,l,f);return c?Qe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var gge=Ge({avgPoolGrad_:mge}),yge={kernelName:Pde,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad;return{x:function(){return gge(r,a,i,o,s)}}}};function bge(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=Ie(r,"a","matMul"),o=Ie(e,"b","matMul");a=te(ba(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return ve.runKernel(nM,s,u)}var Go=Ge({matMul_:bge}),wge={kernelName:nM,inputsToSave:["a","b"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.transposeA,s=t.transposeB;return!o&&!s?{a:function(){return Go(r,i,!1,!0)},b:function(){return Go(a,r,!0,!1)}}:!o&&s?{a:function(){return Go(r,i,!1,!1)},b:function(){return Go(r,a,!0,!1)}}:o&&!s?{a:function(){return Go(i,r,!1,!0)},b:function(){return Go(a,r,!1,!1)}}:{a:function(){return Go(i,r,!0,!0)},b:function(){return Go(r,a,!0,!0)}}}};function xge(r,e,t){var n=Ie(r,"x","spaceToBatchND");Ne(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),Ne(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),Ne(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return ve.runKernel(MM,a,i)}var kge=Ge({spaceToBatchND_:xge});var Sge={kernelName:aM,gradFunc:function(r,e,t){var n=t.blockShape,a=t.crops;return{x:function(){return kge(r,n,a)}}}};var Nge={kernelName:zde,gradFunc:function(r,e,t){for(var n=t,a=n.inputShape,i=n.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(a[s]!==1)throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return wr(r,u,!0)}}}};var Tge={kernelName:Tb,gradFunc:function(r){return{x:function(){return r.clone()}}}};var Ege={kernelName:$de,gradFunc:function(r){return{x:function(){return _t(r)}}}};function Ige(r,e){var t,n=Ie(r,"a","greaterEqual","string_or_numeric"),a=Ie(e,"b","greaterEqual","string_or_numeric");t=te(ba(n,a),2),n=t[0],a=t[1],pn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(yM,i)}var Lb=Ge({greaterEqual_:Ige});function Cge(r,e){var t,n=Ie(r,"a","lessEqual","string_or_numeric"),a=Ie(e,"b","lessEqual","string_or_numeric");t=te(ba(n,a),2),n=t[0],a=t[1],pn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(dve,i)}var zb=Ge({lessEqual_:Cge});function Age(r,e){var t=Ie(r,"a","logicalAnd","bool"),n=Ie(e,"b","logicalAnd","bool");pn(t.shape,n.shape);var a={a:t,b:n};return ve.runKernel(mve,a)}var h4=Ge({logicalAnd_:Age});function Dge(r){var e=Ie(r,"x","clone","string_or_numeric"),t={x:e};return ve.runKernel(Eb,t)}var p4=Ge({clone_:Dge});function _ge(r,e){var t=Ie(r,"broadcastTo","x"),n=t.shape;if(qf(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Qe(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return p4(t);var c={x:t},l={reps:o};return ve.runKernel(Ib,c,l)}var U0=Ge({broadcastTo_:_ge});function Fge(r,e,t){var n=Ie(e,"a","where"),a=Ie(t,"b","where"),i=Ie(r,"condition","where","bool"),o=pn(pn(i.shape,n.shape),a.shape),s=U0(i,o),u=U0(n,o),c=U0(a,o),l={condition:s,t:u,e:c};return ve.runKernel(AM,l)}var Hs=Ge({where_:Fge}),Rge={kernelName:Wde,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.clipValueMin,o=t.clipValueMax;return{x:function(){return Hs(h4(Lb(a,i),zb(a,o)),r,_t(r))}}}};var Oge={kernelName:iM,inputsToSave:["x"],gradFunc:c4.gradFunc};function Pge(r,e,t){t===void 0&&(t=0);var n=Ie(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return ve.runKernel(BM,a,i)}var Mge=Ge({split_:Pge});var Bge={kernelName:oM,saveAllInputs:!0,gradFunc:function(r,e,t){var n=e.map(function(u){return u.shape}),a=t.axis,i=js(a,e[0].shape)[0],o=n.map(function(u){return u[i]}),s=Mge(r,o,i);return s.map(function(u){return function(){return u}})}};function Lge(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=Qe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Ne(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),Ne(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),Ne(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];Ne(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),Ne(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Zs("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ve.runKernel(Ude,f,h)}var d4=Ge({conv2DBackpropFilter_:Lge});function zge(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),Ne(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),Ne(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),Ne(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),Ne(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];Ne(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),Ne(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Zs("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ve.runKernel(uM,h,p);return c?Qe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var $ge=Ge({conv2DBackpropInput_:zge}),Wge={kernelName:sM,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.dilations,s=t.strides,u=t.pad,c=t.dataFormat;return Ne(Of(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")}),{x:function(){return $ge(a.shape,r,i,s,u,c)},filter:function(){return d4(a,r,i.shape,s,u,c)}}}};function qge(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=Ie(r,"x","conv2d","float32"),u=Ie(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=Qe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Ne(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),Ne(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Zs("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];Ne(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),Ne(f4(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),Ne(cP(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),Ne(cP(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ve.runKernel(sM,h,p);return l?Qe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Uge=Ge({conv2d_:qge}),Vge={kernelName:uM,inputsToSave:["dy","filter"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.strides,s=t.pad,u=t.dataFormat,c=t.dimRoundingMode;return{dy:function(){return Uge(r,i,o,s,u,1,c)},filter:function(){return d4(r,a,i.shape,o,s,u,c)}}}};function Gge(r,e,t,n,a){var i=r;r.rank===4&&(i=Qe(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));var o=e;o.rank===4&&(o=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Ne(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")}),Ne(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")}),Ne(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(t,".")}),Ne(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(t[3],".")}),Ne(o.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(t[4],").")});var s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ve.runKernel(Gde,s,u)}var Hge=Ge({conv3DBackpropFilter_:Gge});function Kge(r,e,t,n,a){Ne(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];Ne(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),Ne(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),Ne(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),Ne(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),Ne(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ve.runKernel(Hde,l,f);return s?Qe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var jge=Ge({conv3DBackpropInput_:Kge}),Xge={kernelName:Vde,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad;Ne(Of(n),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(n,"'")});var o=te(e,2),s=o[0],u=o[1];return{x:function(){return jge(s.shape,r,u,a,i)},filter:function(){return Hge(s,r,u.shape,a,i)}}}};function Yge(r){var e=Ie(r,"x","sin","float32"),t={x:e};return ve.runKernel(_M,t)}var Zge=Ge({sin_:Yge}),Jge={kernelName:cM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(Ga(Zge(St(n,"float32"))),r)}}}};function Qge(r){var e=Ie(r,"x","sinh"),t={x:e};return ve.runKernel(FM,t)}var eye=Ge({sinh_:Qge}),tye={kernelName:lM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(eye(St(n,"float32")),r)}}}};function rye(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function nye(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function aye(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function lP(r,e){var t=e.map(function(n){return 1});return nye(r,t,e)}function v4(r,e){if(rye(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function $b(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function iye(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=Ie(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ve.runKernel(fM,i,o)}var oye=Ge({cumsum_:iye});function zr(r,e){return ve.tidy(r,e)}function ga(r){var e=i4(r);e.forEach(function(t){return t.dispose()})}function sye(r){return ve.keep(r)}function uye(r,e){var t=Ie(r,"real","complex"),n=Ie(e,"imag","complex");rme(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return ve.runKernel(qde,a)}var Wb=Ge({complex_:uye});function cye(r){var e=Ie(r,"input","imag"),t={input:e};return ve.runKernel(uve,t)}var lye=Ge({imag_:cye});function fye(r){var e=Ie(r,"input","real"),t={input:e};return ve.runKernel(Pve,t)}var hye=Ge({real_:fye});function pye(r,e,t){var n=Ie(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),Ne(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){Ne(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?zr(function(){var o=hye(n),s=lye(n);return o=ve.runKernel(Dd,{x:o},i),s=ve.runKernel(Dd,{x:s},i),t&&(s=Ga(s)),Wb(o,s)}):ve.runKernel(Dd,a,i)}var wc=Ge({transpose_:pye}),dye={kernelName:fM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis,o=t.exclusive,s=t.reverse;return{x:function(){var u=v4([i],a.rank),c=oye(r,i,o,!s);return u!=null&&(c=wc(c,u)),c}}}};function vye(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=Qe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ve.runKernel(Xde,c,l)}var mye=Ge({depthwiseConv2dNativeBackpropFilter_:vye});function gye(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ve.runKernel(Yde,c,l);return u?Qe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var yye=Ge({depthwiseConv2dNativeBackpropInput_:gye}),bye={kernelName:jde,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad,o=t.dimRoundingMode,s=n??[1,1];Ne(Of(s),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")});var u=te(e,2),c=u[0],l=u[1];return Ne(c.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")}),Ne(l.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")}),Ne(c.shape[3]===l.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")}),Ne(f4(a,s),function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")}),Zs("depthwiseConv2d",i,o),{x:function(){return yye(c.shape,r,l,a,i,s,o)},filter:function(){return mye(c,r,l.shape,a,i,s,o)}}}},wye={kernelName:Zde,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o={x:a,filter:i,dy:r},s={x:a,filter:i,dy:r};return{x:function(){return ve.runKernel(Jde,o,t)},filter:function(){return ve.runKernel(Qde,s,t)}}}},xye={kernelName:eve,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0],a={dy:r,y:n};return{x:function(){return ve.runKernel(tve,a)}}}};function kye(r){var e=Ie(r,"x","exp"),t={x:e};return ve.runKernel(pM,t)}var cv=Ge({exp_:kye}),Sye={kernelName:rve,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0],a=be(cv(Ga(Tr(n))),2/Math.sqrt(Math.PI));return{x:function(){return be(r,a)}}}},Nye={kernelName:pM,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,n)}}}},Tye={kernelName:dM,inputsToSave:["input"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{input:function(){return Qe(r,n.shape)}}}},Eye={kernelName:ave,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,cv(n))}}}};var Iye={kernelName:vM,gradFunc:function(r){return{x:function(){return _t(r)}}}},Cye={kernelName:mM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=pn(n.shape,a.shape),o=function(){var u=Mt(r,St(a,"float32")),c=on(n.shape,i);return c.length>0?Qe(wr(u,c),n.shape):u},s=function(){var u=be(r,St(n,"float32")),c=on(a.shape,i);c.length>0&&(u=Qe(wr(u,c),a.shape));var l=Tr(a);return Ga(Mt(u,St(l,"float32")))};return{a:o,b:s}}};function Aye(r){var e=Ie(r,"x","rsqrt","float32"),t={x:e};return ve.runKernel(CM,t)}var Dye=Ge({rsqrt_:Aye});function _ye(r,e){var t=Ie(r,"x","tile","string_or_numeric");Ne(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return ve.runKernel(Ib,n,a)}var Fye=Ge({tile_:_ye}),Rye={kernelName:ove,inputsToSave:["x","mean","variance","scale"],gradFunc:function(r,e,t){var n=t.varianceEpsilon,a=te(e,4),i=a[0],o=a[1],s=a[2],u=a[3],c=u??Nr(1),l=on(o.shape,i.shape),f=[];if(o.rank===1){for(var h=0;h<i.shape.length-1;++h)f.push(i.shape[h]);f.push(1)}var p=an(i,o),d=be(r,c),m=Dye(xt(s,Nr(n))),v=be(be(be(m,m),m),Nr(-.5)),g=function(){return o.rank===1?Qe(be(be(r,Fye(Qe(m,[1,1,1,o.shape[0]]),f)),c),i.shape):Qe(be(be(r,m),c),i.shape)},y=function(){var S=be(be(m,Nr(-1)),d);return o.rank===1&&(S=wr(S,l)),Qe(S,o.shape)},w=function(){var S=be(be(v,p),d);return o.rank===1&&(S=wr(S,l)),Qe(S,o.shape)},b=function(){var S=be(p,m),T=be(r,S);return o.rank===1&&(T=wr(T,l)),Qe(T,o.shape)},x=function(){var S=r;return o.rank===1&&(S=wr(S,l)),Qe(S,o.shape)};return{x:g,mean:y,variance:w,scale:b,offset:x}}};function Oye(r,e){e===void 0&&(e=0);var t=u4(r,"tensors","stack","string_or_numeric");Ne(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&Ne(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return ve.runKernel(SM,n,a)}var m4=Ge({stack_:Oye});function Pye(r,e,t){var n=Ie(r,"x","unsortedSegmentSum"),a=Ie(e,"segmentIds","unsortedSegmentSum","int32");Ne(Ld(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return ve.runKernel($M,i,o)}var Mye=Ge({unsortedSegmentSum_:Pye}),Bye={kernelName:gM,inputsToSave:["x","indices"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.axis,s=t.batchDims,u=js(o,a.shape)[0],c=function(p,d,m){return function(){var v=p.shape,g=d.size,y=v.slice(0,u),w=y.length,b=v.slice(o,v.length).slice(1),x=b.length,S=fP(0,w),T=fP(w+1,w+1+x),E=hP([y,[g],b]),C=Qe(m,E),R=Qe(d,[g]),_=hP([[w],S,T]),P=wc(C,_),$=Mye(P,R,p.shape[u]),z=$b(_);return $=wc($,z),$}};if(s===1){var l=a.shape[0],f=a.split(l,0),h=function(){var p=m4(f.map(function(d,m){return c(d,i.slice(m,1),r.slice(m,1))()}));return p.reshape(a.shape)};return{x:h,indices:function(){return i}}}else return{x:c(a,i,r),indices:function(){return i}}}};function fP(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function hP(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var Lye={kernelName:yM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1];return{a:function(){return _t(n)},b:function(){return _t(a)}}}};var zye={kernelName:Eb,gradFunc:function(r){return{x:function(){return St(r,"float32")}}}};var $ye={kernelName:cve,gradFunc:function(r){return{x:function(){return _t(r)}}}};var Wye={kernelName:lve,gradFunc:function(r){return{x:function(){return _t(r)}}}};var qye={kernelName:fve,gradFunc:function(r){return{x:function(){return _t(r)}}}};function Uye(r,e){var t,n=Ie(r,"a","greater","string_or_numeric"),a=Ie(e,"b","greater","string_or_numeric");t=te(ba(n,a),2),n=t[0],a=t[1],pn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(sve,i)}var Uf=Ge({greater_:Uye}),Vye={kernelName:hve,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.alpha,o=Uf(a,0);return{x:function(){return Hs(o,r,be(r,i))}}}},Gye={kernelName:vve,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Mt(r,xt(n,1))}}}},Hye={kernelName:bM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Mt(r,St(n,"float32"))}}}},Kye={kernelName:yve,inputsToSave:[],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis;return{logits:function(){var o=!0,s=cv(a);return an(r,be(wr(r,i,o),s))}}}};function jye(r,e,t,n,a,i,o){n===void 0&&(n=5),a===void 0&&(a=1),i===void 0&&(i=1),o===void 0&&(o=.5);var s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ve.runKernel(wve,s,u)}var Xye=Ge({localResponseNormalizationBackprop_:jye}),Yye={kernelName:bve,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.depthRadius,s=t.bias,u=t.alpha,c=t.beta;return{x:function(){return Xye(a,i,r,o,s,u,c)}}}};function Zye(r,e){var t,n=Ie(r,"a","equal","string_or_numeric"),a=Ie(e,"b","equal","string_or_numeric");t=te(ba(n,a),2),n=t[0],a=t[1],pn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(nve,i)}var Jye=Ge({equal_:Zye});function g4(r,e,t,n){return e.rank<t.rank&&(e=Qe(e,lP(e.shape,n))),r.rank<t.rank&&(r=Qe(r,lP(r.shape,n))),{x:function(){var a=be(r,St(Jye(t,e),r.dtype));return a}}}var pP={kernelName:xve,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.reductionIndices,i=e[0],o=e[1],s=js(a,i.shape),u=g4(r,o,i,s);return{x:function(){return u.x()}}}};function Qye(r,e){var t,n=Ie(r,"a","less","string_or_numeric"),a=Ie(e,"b","less","string_or_numeric");t=te(ba(n,a),2),n=t[0],a=t[1],pn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(pve,i)}var e0e=Ge({less_:Qye}),t0e={kernelName:wM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=function(){return be(r,St(Lb(n,a),"float32"))},o=function(){return be(r,St(e0e(n,a),"float32"))};return{a:i,b:o}}};function r0e(r,e,t,n,a,i,o){var s=Ie(r,"dy","maxPool3dGrad"),u=Ie(e,"input","maxPool3dGrad"),c=Ie(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=Qe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=Qe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=Qe(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Ne(l.rank===5,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")}),Ne(f.rank===5,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,".")}),Ne(h.rank===5,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(h.rank,".")}),Zs("maxPool3dGrad",i,o);var d={dy:l,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=ve.runKernel(Tve,d,m);return p?Qe(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var n0e=Ge({maxPool3dGrad_:r0e}),a0e={kernelName:Nve,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad,c=t.dimRoundingMode;return{x:function(){return n0e(r,a,i,o,s,u,c)}}}};function i0e(r,e,t,n,a,i,o){var s=Ie(r,"dy","maxPoolGrad"),u=Ie(e,"input","maxPoolGrad"),c=Ie(t,"output","maxPoolGrad");Ne(u.rank===s.rank,function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")}),Ne(s.rank===4,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")}),Ne(u.rank===4,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")}),Zs("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ve.runKernel(Sve,l,f)}var o0e=Ge({maxPoolGrad_:i0e}),s0e={kernelName:kve,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad;return{x:function(){return o0e(r,a,i,o,s,u)}}}};function qd(r,e){if(e===void 0&&(e="float32"),qf(r),e==="complex64"){var t=qd(r,"float32"),n=qd(r,"float32");return Wb(t,n)}var a=_b(Mi(r),e);return ve.makeTensor(a,r,e)}function lv(r,e){if(e===void 0&&(e="float32"),qf(r),e==="complex64"){var t=lv(r,"float32"),n=qd(r,"float32");return Wb(t,n)}var a=VM(Mi(r),e);return ve.makeTensor(a,r,e)}var u0e={kernelName:Eve,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis,o=js(i,a.shape),s=aye(a.shape,o),u=s[1],c=Mi(u),l=function(){var f=a.shape.slice();o.forEach(function(d){f[d]=1});var h=Qe(r,f),p=Mt(be(h,lv(a.shape,"float32")),c);return p};return{x:l}}},c0e={kernelName:Ive,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.axis,i=te(e,2),o=i[0],s=i[1],u=js(a,o.shape),c=g4(r,s,o,u);return{x:function(){return c.x()}}}},l0e={kernelName:Cve,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=function(){return be(r,St(zb(n,a),"float32"))},o=function(){return be(r,St(Uf(n,a),"float32"))};return{a:i,b:o}}};function f0e(r,e,t){var n=Ie(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return ve.runKernel(DM,a,i)}var mc=Ge({slice_:f0e});var h0e={kernelName:Ave,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return mc(r,i,n.shape)}}}};function p0e(r){var e=Ie(r,"x","floor","float32"),t={x:e};return ve.runKernel(vM,t)}var d0e=Ge({floor_:p0e}),v0e={kernelName:Dve,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=pn(n.shape,a.shape),o=function(){var u=on(n.shape,i);return u.length>0?Qe(wr(r,u),n.shape):r},s=function(){var u=be(r,Ga(d0e(Mt(n,a)))),c=on(a.shape,i);return c.length>0?Qe(wr(u,c),a.shape):u};return{a:o,b:s}}},m0e={kernelName:xM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=pn(n.shape,a.shape),o=function(){var u=be(r,St(a,"float32")),c=on(n.shape,i);return c.length>0?Qe(wr(u,c),n.shape):u},s=function(){var u=be(r,St(n,"float32")),c=on(a.shape,i);return c.length>0?Qe(wr(u,c),a.shape):u};return{a:o,b:s}}};var g0e={kernelName:kM,gradFunc:function(r){return{x:function(){return Ga(r)}}}};var y0e={kernelName:Fve,inputsToSave:["indices"],gradFunc:function(r,e){var t=e[0];return{indices:function(){return qd(t.shape,"float32")}}}};var b0e={kernelName:_ve,gradFunc:function(r){return{x:function(){return _t(r)}}}};function w0e(r,e){e===void 0&&(e=0);var t=Ie(r,"x","unstack","string_or_numeric");Ne(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return ve.runKernel(zM,n,a)}var x0e=Ge({unstack_:w0e});var k0e={kernelName:SM,saveAllInputs:!0,gradFunc:function(r,e,t){var n=t.axis,a=x0e(r,n);return a.map(function(i){return function(){return i}})}};var dP={kernelName:NM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return mc(r,i,n.shape)}}}};function S0e(r){var e=Ie(r,"x","log","float32"),t={x:e};return ve.runKernel(bM,t)}var N0e=Ge({log_:S0e});function T0e(r,e){var t,n=Ie(r,"base","pow"),a=Ie(e,"exp","pow");t=te(ba(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(TM,i)}var Ud=Ge({pow_:T0e}),E0e={kernelName:TM,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,3),n=t[0],a=t[1],i=t[2],o=n,s=a,u=pn(o.shape,s.shape),c=function(){var f=St(s,"float32"),h=be(r,be(f,Ud(o,an(f,Nr(1))))),p=on(o.shape,u);return p.length>0&&(h=wr(h,p)),Qe(h,o.shape)},l=function(){var f=Uf(o,0),h=Hs(f,N0e(o),_t(o)),p=be(r,be(i,h)),d=on(s.shape,u);return d.length>0&&(p=wr(p,d)),Qe(p,s.shape)};return{a:c,b:l}}},I0e={kernelName:Rve,inputsToSave:["x","alpha"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Uf(n,0);return{x:function(){return Hs(i,r,be(r,a))},alpha:function(){var o=Hs(i,_t(r),be(r,n)),s=on(a.shape,r.shape);return s.length>0&&(o=wr(o,s)),Qe(o,a.shape)}}}};function C0e(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Rn=fr();Rn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Rn.registerFlag("IS_BROWSER",function(){return C0e()});Rn.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});Rn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});Rn.registerFlag("IS_SAFARI",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)});Rn.registerFlag("PROD",function(){return!1});Rn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Rn.getBool("DEBUG")});Rn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});Rn.registerFlag("IS_TEST",function(){return!1});Rn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return Rn.getBool("DEBUG")});Rn.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});Rn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});Rn.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});var Vf=function(){function r(e){if(this.shards=[],this.previousShardIndex=0,e!=null&&(e instanceof Array||(e=[e]),e=e.map(function(o){return Ua(o)?o.buffer:o}),e.length!==0)){this.bufferUniformSize=e[0].byteLength;for(var t=0,n=0;n<e.length;n++){var a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return r.join=function(e){return new r(e).slice()},r.prototype.slice=function(e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.byteLength),this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(n===-1)throw new Error("Could not find start shard for byte ".concat(e));for(var a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0,u=n;u<this.shards.length;u++){var c=this.shards[u],l=e+s,f=l-c.start,h=s,p=Math.min(t,c.end),d=p-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i},r.prototype.findShardForByte=function(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;var n=A0e(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)},r}();function A0e(r,e){for(var t=0,n=r.length;t<=n;){var a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}var qb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function vP(r){return qb?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function D0e(r){if(qb)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function _0e(r){if(qb){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function y4(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function F0e(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}function R0e(r,e){return Ce(this,void 0,void 0,function(){var t,n,a;return Ee(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=te.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,F0e(r,t,n)]}})})}function fv(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:vP(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:vP(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new Vf(r.weightData).byteLength}}function mP(r){var e,t,n=[];try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,Je([],te(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var Js=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r}(),O0e="tensorflowjs",P0e=1,_f="models_store",Rd="model_info_store";function M0e(){if(!fr().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function B0e(r){var e=r.result;e.createObjectStore(_f,{keyPath:"modelPath"}),e.createObjectStore(Rd,{keyPath:"modelPath"})}var Vd=function(){function r(e){if(this.indexedDB=M0e(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(O0e,P0e);o.onupgradeneeded=function(){return B0e(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(_f,"readonly"),c=u.objectStore(_f),l=c.get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{t.weightData=Vf.join(t.weightData);var f=fv(t),h=s.transaction(Rd,"readwrite"),p=h.objectStore(Rd),d;try{d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f})}catch(v){return i(v)}var m;d.onsuccess=function(){m=s.transaction(_f,"readwrite");var v=m.objectStore(_f),g;try{g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f})}catch(y){return i(y)}g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Rd);var w=p.delete(n.modelPath);w.onsuccess=function(){return s.close(),i(g.error)},w.onerror=function(b){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r}();Vd.URL_SCHEME="indexeddb://";var b4=function(r){return fr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Vd.URL_SCHEME)?L0e(r.slice(Vd.URL_SCHEME.length)):null};Js.registerSaveRouter(b4);Js.registerLoadRouter(b4);function L0e(r){return new Vd(r)}var Sf="/",Nf="tensorflowjs_models",z0e="info",$0e="model_topology",W0e="weight_specs",q0e="weight_data",U0e="model_metadata";function V0e(r){return{info:[Nf,r,z0e].join(Sf),topology:[Nf,r,$0e].join(Sf),weightSpecs:[Nf,r,W0e].join(Sf),weightData:[Nf,r,q0e].join(Sf),modelMetadata:[Nf,r,U0e].join(Sf)}}function G0e(r){var e,t;try{for(var n=fe(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}var Gd=function(){function r(e){if(!fr().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=V0e(this.modelPath)}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ee(this,function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=fv(e),i=Vf.join(e.weightData);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,D0e(i)),o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),[2,{modelArtifactsInfo:a}]}catch{throw G0e(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Ee(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=_0e(s),[2,t]})})},r}();Gd.URL_SCHEME="localstorage://";var w4=function(r){return fr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Gd.URL_SCHEME)?H0e(r.slice(Gd.URL_SCHEME.length)):null};Js.registerSaveRouter(w4);Js.registerLoadRouter(w4);function H0e(r){return new Gd(r)}var K0e="model",j0e=".json",X0e=".weights.bin";function gP(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var Hd=function(){function r(e){if(!fr().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=K0e),this.modelJsonFileName=e+j0e,this.weightDataFileName=e+X0e}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=Vf.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=y4(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,s.download=this.modelJsonFileName,s.href=o,[4,gP(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:(u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,u.download=this.weightDataFileName,u.href=n,[4,gP(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:fv(e)}]}})})},r}();Hd.URL_SCHEME="downloads://";var Y0e=function(r){return fr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Hd.URL_SCHEME)?Z0e(r.slice(Hd.URL_SCHEME.length)):null};Js.registerSaveRouter(Y0e);function Z0e(r){return r===void 0&&(r="model"),new Hd(r)}function yP(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/r.length*(n-t);return e(l),c}),u};function o(u){Ne(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){Ne(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),Ne(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),Ne(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(r.map(i))}function J0e(r,e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ee(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?fr().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,yP(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,yP(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function Q0e(r,e){var t=this,n,a=e.fetchFunc==null?fr().platform.fetch:e.fetchFunc,i=0,o;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:function(s){return Ce(t,void 0,void 0,function(){var u,c,l,f,h;return Ee(this,function(p){switch(p.label){case 0:return i<r.length?o?[3,2]:[4,a(r[i],e.requestInit,{isBinary:!0})]:[3,4];case 1:c=p.sent().body,o=c.getReader(),p.label=2;case 2:return[4,o.read()];case 3:return l=p.sent(),f=l.done,h=l.value,f?(i++,o=void 0,(u=e.onProgress)===null||u===void 0||u.call(e,i/r.length),[3,0]):(s.enqueue(h),[2]);case 4:return s.close(),[2]}})})}})}var ebe="application/octet-stream",tbe="application/json",Ub=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Ne(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=fr().platform.fetch,Ne(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Ne(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ee(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=y4(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:tbe}),"model.json"),e.weightData!=null&&(i=Vf.join(e.weightData),t.body.append("model.weights.bin",new Blob([i],{type:ebe}),"model.weights.bin")),[4,this.fetch(this.path,t)];case 1:if(o=s.sent(),o.ok)return[2,{modelArtifactsInfo:fv(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."))}})})},r.prototype.loadModelJSON=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i;return Ee(this,function(o){switch(o.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=o.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e.json()];case 3:return t=o.sent(),[3,5];case 4:throw o.sent(),n="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,t]}})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t=this;return Ee(this,function(n){switch(n.label){case 0:return this.loadOptions.streamWeights?[2,this.loadStream()]:[4,this.loadModelJSON()];case 1:return e=n.sent(),[2,R0e(e,function(a){return t.loadWeights(a)})]}})})},r.prototype.loadStream=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i=this;return Ee(this,function(o){switch(o.label){case 0:return[4,this.loadModelJSON()];case 1:return e=o.sent(),[4,this.getWeightUrls(e.weightsManifest)];case 2:return t=o.sent(),n=mP(e.weightsManifest),a=function(){return Q0e(t,i.loadOptions)},[2,Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:a})]}})})},r.prototype.getWeightUrls=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S;return Ee(this,function(T){switch(T.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=te(rbe(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=[],u=[];try{for(c=fe(e),l=c.next();!l.done;l=c.next()){f=l.value;try{for(h=(x=void 0,fe(f.paths)),p=h.next();!p.done;p=h.next())d=p.value,this.weightUrlConverter!=null?u.push(this.weightUrlConverter(d)):s.push(o+d+i)}catch(E){x={error:E}}finally{try{p&&!p.done&&(S=h.return)&&S.call(h)}finally{if(x)throw x.error}}}}catch(E){w={error:E}}finally{try{l&&!l.done&&(b=c.return)&&b.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(v=(m=s.push).apply,g=[s],y=[[]],[4,Promise.all(u)]):[3,2];case 1:v.apply(m,g.concat([Je.apply(void 0,y.concat([te.apply(void 0,[T.sent()]),!1]))])),T.label=2;case 2:return[2,s]}})})},r.prototype.loadWeights=function(e){return Ce(this,void 0,void 0,function(){var t,n,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.getWeightUrls(e)];case 1:return t=i.sent(),n=mP(e),[4,J0e(t,this.loadOptions)];case 2:return a=i.sent(),[2,[n,a]]}})})},r}();Ub.URL_SCHEME_REGEX=/^https?:\/\//;function rbe(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function bP(r){return r.match(Ub.URL_SCHEME_REGEX)!=null}var x4=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return bP(n)}):t=bP(r),t?nbe(r,e):null};Js.registerSaveRouter(x4);Js.registerLoadRouter(x4);function nbe(r,e){return new Ub(r,e)}function abe(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function ibe(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}abe(t,e,r)}function obe(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=Je([e],te(new Array(a-1).fill(0)),!1):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){Ne(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=Je([t],te(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(Ne(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),r.shape[s]-n[s])}),[n,i]}var sbe=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}();function ube(r){var e=Ie(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return ve.runKernel(iM,t)}else{var t={x:e};return ve.runKernel(rM,t)}}var cbe=Ge({abs_:ube});function lbe(r,e){e===void 0&&(e=0),Ne(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=u4(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return p4(t[0]);var n=t,a={axis:e};return ve.runKernel(oM,n,a)}var fbe=Ge({concat_:lbe});function hbe(r){var e=Ie(r,"x","sigmoid","float32"),t={x:e};return ve.runKernel(RM,t)}var pbe=Ge({sigmoid_:hbe});function dbe(r,e,t){var n=Ie(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});Ne(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),Ne(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),Ne(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return ve.runKernel(aM,i,o)}var vbe=Ge({batchToSpaceND_:dbe});function mbe(r,e,t){qf(r),t=t||uv(e);var n={shape:r,value:e,dtype:t};return ve.runKernel(ive,{},n)}function gbe(r){var e=Ie(r,"x","cos","float32"),t={x:e};return ve.runKernel(cM,t)}var k4=Ge({cos_:gbe});function ybe(r){var e=Ie(r,"x","cosh","float32"),t={x:e};return ve.runKernel(lM,t)}var bbe=Ge({cosh_:ybe});function wbe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=Ie(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ve.runKernel(Kde,i,o)}var wP=Ge({cumprod_:wbe});function xbe(r,e){e===void 0&&(e=0);var t=Ie(r,"x","expandDims","string_or_numeric");Ne(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return ve.runKernel(dM,n,a)}var kbe=Ge({expandDims_:xbe});function Sbe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=Ie(r,"x","gather"),i=Ie(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ve.runKernel(gM,o,s)}var Nbe=Ge({gather_:Sbe});function Tbe(r,e){Ne(rb(r),function(){return"The f passed in variableGrads(f) must be a function"}),Ne(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Wd}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in ve.registeredVariables)e.push(ve.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),Ne(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=ve.gradients(r,e,null,o),u=s.value,c=s.grads;Ne(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Ne(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function Ebe(r){var e=Ie(r,"x","logicalNot","bool"),t={x:e};return ve.runKernel(gve,t)}var Ibe=Ge({logicalNot_:Ebe});function Cbe(r,e){var t,n=Ie(r,"a","maximum"),a=Ie(e,"b","maximum");t=te(ba(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=St(n,"int32"),a=St(a,"int32")),pn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(wM,i)}var S4=Ge({maximum_:Cbe});function Abe(r,e,t){t===void 0&&(t=0);var n=Ie(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return ve.runKernel(NM,i,a)}var Dbe=Ge({pad_:Abe}),N4={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Xs,r,!1)})(N4);var _be=N4.exports,T4={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Xs,r,!1)})(T4);var Fbe=T4.exports,E4={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Xs,r,!1)})(E4);var Rbe=E4.exports,I4={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Xs,r,!1)})(I4);var Obe=I4.exports,C4={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Xs,r,!1)})(C4);var Pbe=C4.exports,A4={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Xs,r,!1)})(A4);var Mbe=A4.exports,D4={exports:{}},Bbe={},Lbe={__proto__:null,default:Bbe},zbe=bme(Lbe);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=zbe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Xs,[],Math)})(D4);var $be=D4.exports,Wbe=_be,qbe=Fbe,Ube=Rbe,Vbe=Obe,Gbe=Pbe,Hbe=Mbe,Sc=$be;Sc.alea=Wbe;Sc.xor128=qbe;Sc.xorwow=Ube;Sc.xorshift7=Vbe;Sc.xor4096=Gbe;Sc.tychei=Hbe;function Kbe(r,e){var t=Ie(r,"x","reverse"),n={x:t},a={dims:e};return ve.runKernel(IM,n,a)}var jbe=Ge({reverse_:Kbe});function Xbe(r,e,t){var n=Ie(r,"tensor","tensorScatterupdate"),a=Ie(e,"indices","tensorScatterupdate","int32"),i=Ie(t,"updates","tensorScatterupdate");if(ibe(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return ve.runKernel(Vve,o,s)}Ge({tensorScatterUpdate_:Xbe});var xP;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(xP||(xP={}));var Qs=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return ga(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return Tbe(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&ga(this.iterations_)},e.prototype.saveIterations=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Nr(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ce(this,void 0,void 0,function(){var n;return Ee(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(sbe);Object.defineProperty(Qs,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});(function(r){oe(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=ve.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:zr(function(){return _t(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:zr(function(){return _t(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;zr(function(){var h=xt(be(l,n.rho),be(Tr(c),1-n.rho)),p=be(Mt(yi(xt(f,n.epsilon)),yi(xt(l,n.epsilon))),c),d=xt(be(f,n.rho),be(Tr(p),1-n.rho));l.assign(h),f.assign(d);var m=xt(be(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ga(this.accumulatedGrads.map(function(t){return t.variable})),ga(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(n){switch(n.label){case 0:return t=Je(Je([],te(this.accumulatedGrads),!1),te(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e})(Qs);(function(r){oe(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:zr(function(){return mbe(s.shape,n.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable;zr(function(){var f=xt(l,Tr(c));l.assign(f);var h=xt(be(Mt(c,yi(xt(f,ve.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&ga(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e})(Qs);(function(r){oe(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],zr(function(){o.accBeta1=Nr(n).variable(),o.accBeta2=Nr(a).variable()}),i==null&&(o.epsilon=ve.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);zr(function(){var i=an(1,n.accBeta1),o=an(1,n.accBeta2);a.forEach(function(s,u){var c=ve.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:zr(function(){return _t(c).variable(l)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:zr(function(){return _t(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=xt(be(h,n.beta1),be(f,1-n.beta1)),m=xt(be(p,n.beta2),be(Tr(f),1-n.beta2)),v=Mt(d,i),g=Mt(m,o);h.assign(d),p.assign(m);var y=xt(be(Mt(v,xt(yi(g),n.epsilon)),-n.learningRate),c);c.assign(y)}}),n.accBeta1.assign(be(n.accBeta1,n.beta1)),n.accBeta2.assign(be(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ga(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&ga(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(n){switch(n.label){case 0:return t=Je(Je([],te(this.accumulatedFirstMoment),!1),te(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a,i=this;return Ee(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),zr(function(){i.accBeta1.assign(Ud(i.beta1,i.iterations_+1)),i.accBeta2.assign(Ud(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e})(Qs);(function(r){oe(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],zr(function(){s.iteration=Nr(0).variable(),s.accBeta1=Nr(n).variable()}),i==null&&(s.epsilon=ve.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);zr(function(){var i=an(1,n.accBeta1),o=Mt(-n.learningRate,xt(be(n.iteration,n.decay),1));a.forEach(function(s,u){var c=ve.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:_t(c).variable(l)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:_t(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=xt(be(h,n.beta1),be(f,1-n.beta1)),m=be(p,n.beta2),v=cbe(f),g=S4(m,v);h.assign(d),p.assign(g);var y=xt(be(Mt(o,i),Mt(d,xt(g,n.epsilon))),c);c.assign(y)}}),n.iteration.assign(xt(n.iteration,1)),n.accBeta1.assign(be(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ga(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&ga(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e})(Qs);var Ybe=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=ve.registeredVariables[i];zr(function(){var c=xt(be(n.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=sye(Nr(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e}(Qs);(function(r){oe(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=Nr(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:zr(function(){return _t(s).variable(u)})}}var c=n.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&zr(function(){var f,h=xt(be(n.m,c),l);n.useNesterov?f=xt(be(n.c,xt(l,be(h,n.m))),s):f=xt(be(n.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ga(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e})(Ybe);(function(r){oe(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=ve.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:zr(function(){return _t(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:zr(function(){return _t(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:zr(function(){return _t(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;zr(function(){var h=xt(be(l,n.decay),be(Tr(c),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=xt(be(p,n.decay),be(c,1-n.decay)),m=Mt(be(c,n.learningRate),yi(an(h,xt(Tr(d),n.epsilon)))),v=xt(be(f,n.momentum),m);l.assign(h),p.assign(d),f.assign(v);var g=an(s,v);s.assign(g)}else{var y=xt(be(l,n.decay),be(Tr(c),1-n.decay)),v=xt(be(f,n.momentum),Mt(be(c,n.learningRate),yi(xt(y,n.epsilon))));l.assign(y),f.assign(v);var g=an(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ga(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&ga(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&ga(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(n){switch(n.label){case 0:return t=Je(Je([],te(this.accumulatedMeanSquares),!1),te(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,Je([],te(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e})(Qs);(function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}})();var kP;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(kP||(kP={}));var Zbe=1.7580993408473768,Jbe=1.0507009873554805;function Qbe(r,e,t){var n=r.shape.slice();n[t]=1;var a=Qe(e,n),i=wP(r,t,!0,!1),o=wP(r,t,!0,!0),s=be(i,o);return be(a,s)}function ewe(r,e,t){var n=r.shape.length,a=n-t.length,i=v4(t,n),o=r;i!=null&&(o=wc(r,i));var s=o.shape.slice(),u=s.splice(n-t.length,t.length),c=u.reduce(function(p,d){return p*d},1);s.push(c);var l=o.reshape(s),f=Qbe(l,e,a);if(f=f.reshape(o.shape),i!=null){var h=$b(i);f=wc(f,h)}return f}var twe={kernelName:Ove,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis,o=[];return i==null?o=a.shape.map(function(s,u){return u}):typeof i=="number"?o=[i]:o=i,{x:function(){return ewe(a,r,o)}}}},rwe={kernelName:hM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=pn(n.shape,a.shape),o=function(){var u=Mt(r,St(a,"float32")),c=on(n.shape,i);return c.length>0?Qe(wr(u,c),n.shape):u},s=function(){var u=be(r,St(n,"float32")),c=on(a.shape,i);c.length>0&&(u=Qe(wr(u,c),a.shape));var l=Tr(a);return Ga(Mt(u,St(l,"float32")))};return{a:o,b:s}}},nwe={kernelName:Mve,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Mt(r,Ga(Tr(n)))}}}},awe={kernelName:qve,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0],a=be(zb(n,6),Bb(n));return{x:function(){return be(r,St(a,"float32"))}}}},iwe={kernelName:Bve,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,St(Bb(n),"float32"))}}}},owe={kernelName:EM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Qe(r,n.shape)}}}},swe={kernelName:$ve,inputsToSave:["images"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i={dy:r,images:a},o=function(){return ve.runKernel(Wve,i,t)};return{images:o}}},uwe={kernelName:Lve,inputsToSave:["images"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i={dy:r,images:a},o=function(){return ve.runKernel(zve,i,t)};return{images:o}}};var cwe={kernelName:IM,gradFunc:function(r,e,t){var n=t.dims,a=js(n,r.shape);return{x:function(){return jbe(r,a)}}}};var lwe={kernelName:Uve,gradFunc:function(r){return{x:function(){return _t(r)}}}},fwe={kernelName:CM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Ga(Mt(r,be(Ud(n,1.5),2)))}}}},hwe={kernelName:AM,inputsToSave:["condition"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{condition:function(){return St(_t(n),"float32")},t:function(){return be(r,St(n,r.dtype))},e:function(){return be(r,St(Ibe(n),r.dtype))}}}},pwe={kernelName:Gve,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=Uf(n,Nr(0)),i=Nr(Zbe),o=Nr(Jbe),s=be(r,o),u=be(be(r,i),cv(St(n,"float32")));return Hs(a,s,u)}}}},dwe={kernelName:RM,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,be(n,an(Nr(1),n)))}}}};var vwe={kernelName:Hve,gradFunc:function(r){return{x:function(){return _t(r)}}}},mwe={kernelName:_M,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(k4(St(n,"float32")),r)}}}},gwe={kernelName:FM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(bbe(St(n,"float32")),r)}}}},ywe={kernelName:DM,inputsToSave:["x"],gradFunc:function(r,e,t){for(var n=te(e,1),a=n[0],i=t.begin,o=t.size,s=a.shape,u=te(obe(a,i,o),2),c=u[0],l=u[1],f=[],h=0;h<r.rank;h++)f.push([c[h],s[h]-c[h]-l[h]]);return{x:function(){return Dbe(r,f)}}}},bwe={kernelName:jve,outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.dim,o=!0,s=be(r,a);return{logits:function(){return an(s,be(wr(s,[i],o),a))}}}},wwe={kernelName:Kve,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,pbe(n))}}}};var SP={kernelName:MM,gradFunc:function(r,e,t){var n=t.blockShape,a=t.paddings;return{x:function(){return vbe(r,n,a)}}}};var NP={kernelName:BM,gradFunc:function(r,e,t){var n=t.axis;return{x:function(){return fbe(r,n)}}}},xwe={kernelName:OM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Mt(r,be(yi(St(n,"float32")),2))}}}},kwe={kernelName:Yve,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,be(St(n,"float32"),2))}}}},Swe={kernelName:Xve,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Nr(2),o=function(){return be(r,be(i,an(n,a)))},s=function(){return be(r,be(i,an(a,n)))};return{a:o,b:s}}};var Nwe={kernelName:qM,gradFunc:function(r){return{x:function(){return _t(r)}}}},Twe={kernelName:LM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=pn(n.shape,a.shape),o=function(){var u=r,c=on(n.shape,i);return c.length>0&&(u=wr(u,c)),Qe(u,n.shape)},s=function(){var u=r,c=on(a.shape,i);return c.length>0&&(u=wr(u,c)),Qe(Ga(u),a.shape)};return{a:o,b:s}}},Ewe={kernelName:PM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=a.shape.slice(),o=t.axis,s=js(o,a.shape);s.forEach(function(l){i[l]=1});var u=Qe(r,i),c=be(u,lv(a.shape,"float32"));return{x:function(){return c}}}},Iwe={kernelName:Zve,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Mt(r,Tr(k4(n)))}}}},Cwe={kernelName:Jve,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(an(Nr(1),Tr(n)),r)}}}},Awe={kernelName:Ib,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.reps,o=function(){var s=_t(a);if(a.rank===1)for(var u=0;u<i[0];++u)s=xt(s,mc(r,[u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)s=xt(s,mc(r,[u*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)s=xt(s,mc(r,[u*a.shape[0],c*a.shape[1],l*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else if(a.rank===4)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)for(var f=0;f<i[3];++f)s=xt(s,mc(r,[u*a.shape[0],c*a.shape[1],l*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));else throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(a.rank," tensors yet."));return s};return{x:o}}};var Dwe={kernelName:Dd,gradFunc:function(r,e,t){var n=t,a=n.perm,i=$b(a);return{x:function(){return wc(r,i)}}}};var _we={kernelName:zM,gradFunc:function(r,e,t){var n=t,a=n.axis;return{value:function(){return m4(r,a)}}}},Fwe={kernelName:$M,inputsToSave:["segmentIds"],gradFunc:function(r,e){var t=te(e,1),n=t[0],a=function(){return Rwe(r,n)};return{x:a}}};function Rwe(r,e){for(var t=S4(e,_t(e)),n=Nbe(r,t),a=Lb(e,Nr(0,"int32")),i=n.rank-a.rank,o=0;o<i;++o)a=kbe(a,o+1);a=h4(a,lv(n.shape,"bool"));var s=_t(n);return Hs(a,n,s)}var Owe={kernelName:WM,gradFunc:function(r){return{x:function(){return _t(r)}}}},V0,TP,Pwe=[c4,Jme,Qme,rge,nge,ige,oge,sge,cge,lge,fge,hge,vge,yge,wge,Sge,Nge,Tge,Ege,Rge,Oge,Bge,Vge,Wge,Xge,Jge,tye,dye,bye,wye,rwe,xye,Sye,Nye,Tye,Eye,Cye,Iye,Rye,Bye,Lye,zye,$ye,Wye,qye,Vye,Gye,Hye,Kye,Yye,pP,pP,t0e,a0e,s0e,u0e,c0e,l0e,h0e,v0e,m0e,g0e,y0e,b0e,k0e,dP,dP,E0e,I0e,twe,nwe,awe,iwe,owe,swe,uwe,cwe,lwe,fwe,hwe,pwe,dwe,vwe,mwe,gwe,ywe,bwe,wwe,SP,SP,NP,NP,xwe,Swe,kwe,Nwe,Twe,Ewe,Iwe,Cwe,Awe,Dwe,_we,Fwe,Owe];try{for(Tf=fe(Pwe),hc=Tf.next();!hc.done;hc=Tf.next())EP=hc.value,vme(EP)}catch(r){V0={error:r}}finally{try{hc&&!hc.done&&(TP=Tf.return)&&TP.call(Tf)}finally{if(V0)throw V0.error}}var EP,Tf,hc;function Vb(r,e){return F.tidy(function(){return A.sqrt(A.sum(A.mul(r,r),e,!0))})}var Gf=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(F.serialization.Serializable),Gb=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=Vb(t,n.axis),i=A.clipByValue(a,0,n.maxValue);return A.mul(t,A.div(i,A.add($r(),a)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e}(Gf);Gb.className="MaxNorm";F.serialization.registerClass(Gb);var Hb=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.defaultAxis=0,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){return A.div(t,A.add($r(),Vb(t,n.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e}(Gf);Hb.className="UnitNorm";F.serialization.registerClass(Hb);var Kb=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.relu(t)},e}(Gf);Kb.className="NonNeg";F.serialization.registerClass(Kb);var jb=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=t.minValue!=null?t.minValue:n.defaultMinValue,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.rate=t.rate!=null?t.rate:n.defaultRate,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=Vb(t,n.axis),i=A.add(A.mul(n.rate,A.clipByValue(a,n.minValue,n.maxValue)),A.mul(1-n.rate,a));return A.mul(t,A.div(i,A.add($r(),a)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e}(Gf);jb.className="MinMaxNorm";F.serialization.registerClass(jb);var IP={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Wr(r){return pb(r)}function CP(r,e){return e===void 0&&(e={}),Lf(r,F.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function qr(r){if(r==null)return null;if(typeof r=="string"){var e=r in IP?IP[r]:r,t={className:e,config:{}};return CP(t)}else return r instanceof Gf?r:CP(r)}function Mwe(r){return new Gb(r)}function Bwe(r){return new Hb(r)}function Lwe(){return new Kb}function zwe(r){return new jb(r)}var $we={__proto__:null,maxNorm:Mwe,minMaxNorm:zwe,nonNeg:Lwe,unitNorm:Bwe};function Wwe(){return new mb}function qwe(){return new ev}function Uwe(r){return new gb(r)}function Vwe(r){return new yb(r)}function Gwe(r){return new bb(r)}function Hwe(r){return new wb(r)}function Kwe(r){return new xb(r)}function jwe(r){return new Fn(r)}function Xwe(r){return new tv(r)}function Ywe(r){return new rv(r)}function Zwe(r){return new nv(r)}function Jwe(r){return new av(r)}function Qwe(r){return new iv(r)}function e1e(r){return new ov(r)}function t1e(r){return new kb(r)}var r1e={__proto__:null,constant:Uwe,glorotNormal:Ywe,glorotUniform:Xwe,heNormal:Zwe,heUniform:Jwe,identity:Kwe,leCunNormal:Qwe,leCunUniform:e1e,ones:qwe,orthogonal:t1e,randomNormal:Gwe,randomUniform:Vwe,truncatedNormal:Hwe,varianceScaling:jwe,zeros:Wwe};function Ho(r){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(r==null)return[2];e=[],t=[],n=[];for(a in r)i=r[a],typeof i!="number"&&(o=i,e.push(o.data()),t.push(a),n.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=c.sent(),u=0;u<s.length;++u)r[t[u]]=s[u][0];F.dispose(n),c.label=2;case 2:return[2]}})})}function _4(r){if(r!=null)for(var e in r){var t=r[e];typeof t!="number"&&t.dispose()}}var AP;(function(r){r[r.SILENT=0]="SILENT",r[r.VERBOSE=1]="VERBOSE"})(AP||(AP={}));var n1e=125,xc=function(){function r(){this.validationData=null}return r.prototype.setParams=function(e){this.params=e},r.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return[2]})})},r.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return[2]})})},r.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return[2]})})},r.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return[2]})})},r.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},r.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},r.prototype.setModel=function(e){},r}(),F4=function(){function r(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return r.prototype.append=function(e){this.callbacks.push(e)},r.prototype.setParams=function(e){var t,n;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setParams(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.setModel=function(e){var t,n;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setModel(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainBegin(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainEnd(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r}(),a1e=function(r){oe(e,r);function e(){return r.call(this)||this}return e.prototype.onEpochBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u=this;return Ee(this,function(c){n==null&&(n={}),a=n.size==null?0:n.size,this.seen+=a,i=function(l){var f=n[l];if(typeof f=="number")o.totals.hasOwnProperty(l)||(o.totals[l]=0),o.totals[l]=o.totals[l]+f*a;else{var h=void 0;l in o.totals?h=o.totals[l]:o.totals[l]=0;var p=F.tidy(function(){return F.add(u.totals[l],F.mul(f,a))});o.totals[l]=p,h?.dispose()}},o=this;for(s in n)i(s);return[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f=this;return Ee(this,function(h){if(n!=null){a=function(p){if(i.totals[p]==null)return"continue";typeof i.totals[p]=="number"?n[p]=i.totals[p]/i.seen:F.tidy(function(){var d=F.mul(F.div(1,f.seen),f.totals[p]);n[p]=d,f.totals[p].dispose(),F.keep(n[p])})},i=this;try{for(o=fe(this.params.metrics),s=o.next();!s.done;s=o.next())u=s.value,a(u)}catch(p){c={error:p}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}}return[2]})})},e}(xc),R4=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){n==null&&(n={}),this.epoch.push(t);for(a in n)this.history[a]==null&&(this.history[a]=[]),this.history[a].push(n[a]);return[2]})})},e.prototype.syncData=function(){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:t=[],n=[],a=[];for(i in this.history)for(o=this.history[i],s=0;s<o.length;++s)typeof o[s]!="number"&&(u=o[s],t.push(u.data()),n.push(i),a.push(s));return[4,Promise.all(t)];case 1:for(c=h.sent(),l=0;l<c.length;++l)f=this.history[n[l]][a[l]],f.dispose(),this.history[n[l]][a[l]]=c[l][0];return[2]}})})},e}(xc),O4=function(r){oe(e,r);function e(t,n){var a=r.call(this)||this;if(a.currentEpoch=0,a.nowFunc=t.nowFunc,a.nextFrameFunc=t.nextFrameFunc||F.nextFrame,a.yieldEvery=n||"auto",a.yieldEvery==="auto"&&(a.yieldEvery=n1e),a.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return F.util.isNumber(a.yieldEvery)&&(a.maybeWait=Vpe(a.maybeWait.bind(a),a.yieldEvery,a.nowFunc)),a.trainBegin=t.onTrainBegin,a.trainEnd=t.onTrainEnd,a.epochBegin=t.onEpochBegin,a.epochEnd=t.onEpochEnd,a.batchBegin=t.onBatchBegin,a.batchEnd=t.onBatchEnd,a.yield=t.onYield,a}return e.prototype.maybeWait=function(t,n,a){return Ce(this,void 0,void 0,function(){var i;return Ee(this,function(o){switch(o.label){case 0:return i=[],this.yield==null?[3,2]:[4,Ho(a)];case 1:o.sent(),i.push(this.yield(t,n,a)),o.label=2;case 2:return i.push(this.nextFrameFunc()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,Ho(n)];case 1:return a.sent(),[4,this.epochBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.epochEnd==null?[3,2]:[4,Ho(n)];case 1:i.sent(),a.push(this.epochEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="epoch"&&a.push(this.nextFrameFunc()),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.batchBegin==null?[3,3]:[4,Ho(n)];case 1:return a.sent(),[4,this.batchBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.batchEnd==null?[3,2]:[4,Ho(n)];case 1:i.sent(),a.push(this.batchEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="batch"?a.push(this.nextFrameFunc()):F.util.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,n)),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){switch(n.label){case 0:return this.trainBegin==null?[3,3]:[4,Ho(t)];case 1:return n.sent(),[4,this.trainBegin(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){switch(n.label){case 0:return this.trainEnd==null?[3,3]:[4,Ho(t)];case 1:return n.sent(),[4,this.trainEnd(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e}(xc);function P4(r,e){if(r==null&&(r={}),r instanceof xc)return[r];if(Array.isArray(r)&&r[0]instanceof xc)return r;var t=Pt(r);return t.map(function(n){return new O4(n,e)})}var Xb=function(){function r(){}return r.registerCallbackConstructor=function(e,t){F.util.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)}),r.checkForDuplicate(t),r.constructors[e]==null&&(r.constructors[e]=[]),r.constructors[e].push(t)},r.checkForDuplicate=function(e){for(var t in r.constructors){var n=r.constructors[+t];n.forEach(function(a){if(a===e)throw new Z("Duplicate callback constructor.")})}},r.clear=function(){r.constructors={}},r.createCallbacks=function(e){var t=[];for(var n in r.constructors){var a=+n;e>=a&&t.push.apply(t,Je([],te(r.constructors[a]),!1))}return t.map(function(i){return new i})},r}();Xb.constructors={};function M4(r,e,t,n,a,i,o,s,u){var c=new R4,l=Je([new a1e],te(Xb.createCallbacks(e)),!1);r!=null&&l.push.apply(l,Je([],te(r),!1)),l.push(c);var f=new F4(l);return f.setParams({epochs:t,initialEpoch:n,samples:a,steps:i,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:f,history:c}}function pi(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),Lf(r,F.serialization.SerializationMap.getMap().classNameMap,e,"layer",t)}function Kd(r,e){return F.tidy(function(){r.dtype!=="float32"&&(r=A.cast(r,"float32"));var t=A.sum($f(r),e,!0),n=A.fill(t.shape,$r()),a=A.sqrt(A.maximum(t,n));return A.div(r,a)})}function eu(r,e){return F.tidy(function(){return A.mean($f(A.sub(e,r)),-1)})}function hv(r,e){return F.tidy(function(){return A.mean(A.abs(A.sub(e,r)),-1)})}function Nc(r,e){return F.tidy(function(){var t=A.sub(r,e),n=A.clipByValue(A.abs(r),$r(),Number.MAX_VALUE),a=A.abs(A.div(t,n));return A.mul(100,A.mean(a,-1))})}function i1e(r,e){return F.tidy(function(){var t=A.clipByValue(e,$r(),Number.MAX_VALUE),n=A.log(A.add(1,t)),a=A.clipByValue(r,$r(),Number.MAX_VALUE),i=A.log(A.add(1,a));return A.mean($f(A.sub(n,i)),-1)})}function o1e(r,e){return F.tidy(function(){var t=A.maximum(0,A.sub(1,A.mul(r,e)));return A.mean($f(t),-1)})}function s1e(r,e){return F.tidy(function(){var t=A.maximum(0,A.sub(1,A.mul(r,e)));return A.mean(t,-1)})}function u1e(r,e){return F.tidy(function(){var t=A.sum(A.mul(r,e),-1),n=A.max(A.mul(A.sub(1,r),e),-1);return A.maximum(0,A.add(1,A.sub(n,t)))})}function c1e(r,e){return F.tidy(function(){var t=Math.log(2),n=A.sub(e,r),a=A.sub(A.add(n,A.softplus(A.mul(-2,n))),t);return A.mean(a,-1)})}function Pf(r,e,t){return t===void 0&&(t=!1),F.tidy(function(){if(t)e=A.softmax(e);else{var n=A.sum(e,e.shape.length-1,!0);e=A.div(e,n)}return e=A.clipByValue(e,$r(),1-$r()),A.neg(A.sum(A.mul(A.cast(r,"float32"),A.log(e)),e.shape.length-1))})}function jd(r,e,t){return t===void 0&&(t=!1),F.tidy(function(){var n=A.cast(A.floor(rde(r)),"int32");e=A.clipByValue(e,$r(),1-$r());var a=e.shape,i=A.reshape(A.oneHot(n,a[a.length-1]),a);return Pf(i,e,t)})}function l1e(r,e){if(!F.util.arraysEqual(r.shape,e.shape))throw new Z("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(r.shape)," and ").concat(JSON.stringify(e.shape)));return F.tidy(function(){var t=A.relu(e),n=A.neg(A.abs(e));return A.add(A.sub(t,A.mul(e,r)),A.log1p(A.exp(n)))})}function pv(r,e){return F.tidy(function(){var t;return t=A.clipByValue(e,$r(),1-$r()),t=A.log(A.div(t,A.sub(1,t))),A.mean(l1e(r,t),-1)})}function f1e(r,e){return F.tidy(function(){var t=A.clipByValue(r,$r(),1),n=A.clipByValue(e,$r(),1);return A.sum(A.mul(r,A.log(A.div(t,n))),-1)})}function h1e(r,e){return F.tidy(function(){var t=A.log(A.add($r(),e));return A.mean(A.sub(e,A.mul(r,t)),-1)})}function Yb(r,e){return F.tidy(function(){var t=Kd(r,-1),n=Kd(e,-1),a=A.mul(t,n);return A.neg(A.sum(a,-1))})}var Xd={meanSquaredError:eu,meanAbsoluteError:hv,meanAbsolutePercentageError:Nc,meanSquaredLogarithmicError:i1e,squaredHinge:o1e,hinge:s1e,categoricalHinge:u1e,logcosh:c1e,categoricalCrossentropy:Pf,sparseCategoricalCrossentropy:jd,binaryCrossentropy:pv,kullbackLeiblerDivergence:f1e,poisson:h1e,cosineProximity:Yb};function G0(r){if(typeof r=="string"){if(r in Xd)return Xd[r];var e="Unknown loss ".concat(r);throw r.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss ".concat(r,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new Z(e)}else return r}function Zb(r,e){return F.tidy(function(){var t=A.mul(.5,A.onesLike(e)),n=Oi(A.greater(e,t),r.dtype);return A.mean(A.equal(r,n),-1)})}function Jb(r,e){return F.tidy(function(){return Oi(A.equal(A.argMax(r,-1),A.argMax(e,-1)),"float32")})}function B4(r,e){return F.tidy(function(){return A.cast(A.sum(A.logicalAnd(A.equal(r,1),A.equal(e,1))),"float32")})}function p1e(r,e){return F.tidy(function(){return A.cast(A.sum(A.logicalAnd(A.equal(r,1),A.equal(e,0))),"float32")})}function d1e(r,e){return F.tidy(function(){return A.cast(A.sum(A.logicalAnd(A.equal(r,0),A.equal(e,1))),"float32")})}function L4(r,e){return F.tidy(function(){var t=B4(r,e),n=d1e(r,e),a=A.add(t,n);return A.cast(A.where(A.greater(a,0),A.div(t,a),0),"float32")})}function v1e(r,e){return F.tidy(function(){var t=B4(r,e),n=p1e(r,e),a=A.add(t,n);return A.cast(A.where(A.greater(a,0),A.div(t,a),0),"float32")})}function z4(r,e){return pv(r,e)}function $4(r,e){return r.rank===e.rank&&(r=A.squeeze(r,[r.rank-1])),e=A.argMax(e,-1),e.dtype!==r.dtype&&(e=A.cast(e,r.dtype)),A.cast(A.equal(r,e),"float32")}var m1e=eu,g1e=eu,y1e=hv,b1e=hv,w1e=Nc,x1e=Nc,Qb=Pf,k1e=Yb,W4=jd,Yd={binaryAccuracy:Zb,categoricalAccuracy:Jb,precision:L4,categoricalCrossentropy:Qb,sparseCategoricalCrossentropy:W4,mse:m1e,MSE:g1e,mae:y1e,MAE:b1e,mape:w1e,MAPE:x1e,cosine:k1e};function S1e(r){if(typeof r=="string"&&r in Yd)return Yd[r];if(typeof r!="string"&&r!=null)return r;throw new Z("Unknown metric ".concat(r))}function Cd(r){var e,t,n,a;if(_i(r!==null,"Unknown LossOrMetricFn ".concat(r)),typeof r=="string")return r;var i=void 0;try{for(var o=fe(Object.keys(Xd)),s=o.next();!s.done;s=o.next()){var u=s.value;if(Xd[u]===r){i=u;break}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(i!==void 0)return i;try{for(var c=fe(Object.keys(Yd)),l=c.next();!l.done;l=c.next()){var u=l.value;if(Yd[u]===r){i=u;break}}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return i!==void 0?i:r.name}function N1e(r){var e={Adagrad:function(){return F.train.adagrad(.01)},Adadelta:function(){return F.train.adadelta(1,.95,$r())},Adam:function(){return F.train.adam(.001,.9,.999,$r())},Adamax:function(){return F.train.adamax(.002,.9,.999,$r(),0)},RMSProp:function(){return F.train.rmsprop(.001,.9,0,$r())},SGD:function(){return F.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,r in e)return e[r]();throw new Z("Unknown Optimizer ".concat(r))}var DP=1*1024*1024;function _P(r,e,t){if(t===void 0&&(t=!1),r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!cb(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var n=JSON.stringify(r);n.length>DP&&console.warn('User-defined metadata of model "'.concat(e,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(DP,"."))}}function cb(r){var e,t,n,a;if(r===null)return!0;if(typeof r=="object")if(Object.getPrototypeOf(r)===Object.prototype){var i=Object.keys(r);try{for(var o=fe(i),s=o.next();!s.done;s=o.next()){var u=s.value;if(typeof u!="string"||!cb(r[u]))return!1}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!0}else if(Array.isArray(r)){try{for(var c=fe(r),l=c.next();!l.done;l=c.next()){var f=l.value;if(!cb(f))return!1}}catch(p){n={error:p}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return!0}else return!1;else{var h=typeof r;return h==="string"||h==="number"||h==="boolean"}}function T1e(r,e,t,n){n===void 0&&(n=console.log);var a=I1e(r),i=["Layer (type)","Input Shape","Output shape","Param #"];a?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(function(h){return Math.floor(e*h)}));var o;if(!a){i.push("Receives inputs"),o=[];for(var s in r.nodesByDepth)o.push.apply(o,Je([],te(r.nodesByDepth[s]),!1))}n("_".repeat(e)),Zd(i,t,n),n("=".repeat(e));for(var u=r.layers,c=0;c<u.length;++c)a?C1e(u[c],t,n):A1e(u[c],t,o,n),n((c===u.length-1?"=":"_").repeat(e));r.checkTrainableWeightsConsistency();var l=E1e(r),f=Pd(r.nonTrainableWeights);n("Total params: ".concat(l+f)),n("Trainable params: ".concat(l)),n("Non-trainable params: ".concat(f)),n("_".repeat(e))}function E1e(r){var e;return r.collectedTrainableWeights!=null?e=Pd(r.collectedTrainableWeights):e=Pd(r.trainableWeights),e}function I1e(r){var e,t,n,a,i,o,s=!0,u=[],c=[];for(var l in r.nodesByDepth)u.push(r.nodesByDepth[l]);try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var p=h.value;if(p.length>1||p.length===1&&p[0].inboundLayers.length>1){s=!1;break}c.push.apply(c,Je([],te(p),!1))}}catch(x){e={error:x}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(s)try{for(var d=fe(r.layers),m=d.next();!m.done;m=d.next()){var v=m.value,g=!1;try{for(var y=(i=void 0,fe(v.inboundNodes)),w=y.next();!w.done;w=y.next()){var b=w.value;if(c.indexOf(b)!==-1)if(g){s=!1;break}else g=!0}}catch(x){i={error:x}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}if(!s)break}}catch(x){n={error:x}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return s}function Zd(r,e,t){t===void 0&&(t=console.log);for(var n="",a=0;a<r.length;++a)a>0&&(n=n.slice(0,n.length-1)+" "),n+=r[a],n=n.slice(0,e[a]),n+=" ".repeat(e[a]-n.length);t(n)}function C1e(r,e,t){var n,a;try{a=r.inboundNodes.map(function(u){return JSON.stringify(u.inputShapes)}).join(",")}catch{a="multiple"}try{n=JSON.stringify(r.outputShape)}catch{n="multiple"}var i=r.name,o=r.getClassName(),s=["".concat(i," (").concat(o,")"),a,n,r.countParams().toString()];Zd(s,e,t)}function A1e(r,e,t,n){var a,i,o,s;try{s=r.inboundNodes.map(function(b){return JSON.stringify(b.inputShapes)}).join(",")}catch{s="multiple"}try{o=JSON.stringify(r.outputShape)}catch{o="multiple"}var u=[];try{for(var c=fe(r.inboundNodes),l=c.next();!l.done;l=c.next()){var f=l.value;if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(var h=0;h<f.inboundLayers.length;++h){var p=f.inboundLayers[h].name,d=f.nodeIndices[h],m=f.tensorIndices[h];u.push("".concat(p,"[").concat(d,"][").concat(m,"]"))}}}catch(b){a={error:b}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}var v=r.name,g=r.getClassName(),y=u.length===0?"":u[0],w=["".concat(v," (").concat(g,")"),s,o,r.countParams().toString(),y];Zd(w,e,n);for(var h=1;h<u.length;++h)Zd(["","","","",u[h]],e,n)}function q4(r,e,t){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&e===0&&typeof t=="string"}function Mf(r,e){var t,n;if(r===null)return null;if(typeof r=="string")return Ws(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];q4(e,o,s)?a.push(s):a.push(Mf(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(r)),l=c.next();!l.done;l=c.next()){var f=l.value,h=r[f];if(f==="name"&&typeof h=="string")u[f]=h;else{var p=Ws(f);u[p]=Mf(h,p)}}}catch(d){t={error:d}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return u}}function lb(r,e){var t,n;if(r==null)return null;if(typeof r=="string")return io(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];q4(e,o,s)?a.push(s):a.push(lb(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(r)),l=c.next();!l.done;l=c.next()){var f=l.value,h=r[f],p=io(f);(f==="name"||f==="className")&&typeof h=="string"?u[p]=h:u[p]=lb(h,f)}}catch(d){t={error:d}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return u}}var ew="4.19.0",D1e=function(r){var e=Object.keys(r);if(e.length===0)return!1;var t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))},_1e=function(r){oe(e,r);function e(t){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C,R,_=r.call(this,{})||this;if(_.containerNodes=new Set,_.name=t.name,_.name==null){var P=_.getClassName().toLowerCase();_.name=Jd(P)}if(_.supportsMasking=!1,_.trainable_=!0,Array.isArray(t.inputs)?_.inputs=t.inputs.slice():_.inputs=[t.inputs],Array.isArray(t.outputs)?_.outputs=t.outputs.slice():_.outputs=[t.outputs],jo(_.inputs).length!==_.inputs.length)throw new Z("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(_.inputs.map(function(dt){return dt.name})));jo(_.outputs).length!==_.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(_.outputs.map(function(dt){return dt.name}))),_.inputLayers=[],_.inputLayersNodeIndices=[],_.inputLayersTensorIndices=[],_.outputLayers=[],_.outputLayersNodeIndices=[],_.outputLayersTensorIndices=[],_.layers=[],_.internalContainerRefs=[];try{for(var $=fe(_.outputs),z=$.next();!z.done;z=$.next()){var L=z.value,B=L.sourceLayer,q=L.nodeIndex,Y=L.tensorIndex;_.outputLayers.push(B),_.outputLayersNodeIndices.push(q),_.outputLayersTensorIndices.push(Y)}}catch(dt){n={error:dt}}finally{try{z&&!z.done&&(a=$.return)&&a.call($)}finally{if(n)throw n.error}}try{for(var J=fe(_.inputs),U=J.next();!U.done;U=J.next()){var L=U.value,B=L.sourceLayer,q=L.nodeIndex,Y=L.tensorIndex;_i(q===0,"input layer has >1 nodes"),_i(Y===0,"input layer has >1 tensors"),_.inputLayers.push(B),_.inputLayersNodeIndices.push(q),_.inputLayersTensorIndices.push(Y)}}catch(dt){i={error:dt}}finally{try{U&&!U.done&&(o=J.return)&&o.call(J)}finally{if(i)throw i.error}}_.inputNames=[],_.outputNames=[],_.feedInputShapes=[],_.feedInputNames=[],_.feedOutputNames=[];for(var j=0;j<_.inputLayers.length;j++){var B=_.inputLayers[j];if(!(B instanceof kc))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(t.inputs,". ")+"Input ".concat(j," (0-based) originates ")+"from layer type ".concat(B.getClassName(),"."));_.inputNames.push(B.name),_.feedInputShapes.push(B.batchInputShape),_.feedInputNames.push(B.name)}try{for(var ne=fe(_.outputLayers),re=ne.next();!re.done;re=ne.next()){var B=re.value;_.outputNames.push(B.name)}}catch(dt){s={error:dt}}finally{try{re&&!re.done&&(u=ne.return)&&u.call(ne)}finally{if(s)throw s.error}}_.internalInputShapes=_.inputs.map(function(dt){return dt.shape}),_.internalOutputShapes=_.outputs.map(function(dt){return dt.shape});var se={},le={},de={},ke={},he={},ye=[],xe=function(dt,Ia,ai,Wn,ys,cS){(Wn==null||ys==null||cS==null)&&(Wn=dt.sourceLayer,ys=dt.nodeIndex,cS=dt.tensorIndex);var ha=Wn.inboundNodes[ys];if(ai.indexOf(ha)!==-1)throw new Ri("The tensor ".concat(dt.name,' at layer "').concat(Wn.name,'" ')+"is part of a cycle.");if(Ia.indexOf(ha)===-1){_.containerNodes.add(e.nodeKey(Wn,ys)),Wn.id in he||(he[Wn.id]=Object.keys(he).length),ai.indexOf(ha)===-1&&ai.push(ha);for(var yj=ha.inboundLayers.length,Bu=0;Bu<yj;Bu++){var bj=ha.inputTensors[Bu],wj=ha.inboundLayers[Bu],xj=ha.nodeIndices[Bu],kj=ha.tensorIndices[Bu];xe(bj,Ia,ai,wj,xj,kj)}for(Ia.push(ha);ai.indexOf(ha)>=0;)ai.splice(ai.indexOf(ha),1);ye.push(ha)}},De=[],Ye=[];try{for(var ht=fe(_.outputs),at=ht.next();!at.done;at=ht.next()){var L=at.value;xe(L,De,Ye)}}catch(dt){c={error:dt}}finally{try{at&&!at.done&&(l=ht.return)&&l.call(ht)}finally{if(c)throw c.error}}var nt=ye.slice().reverse();try{for(var ft=fe(nt),st=ft.next();!st.done;st=ft.next()){var Ze=st.value;le[Ze.id]=Ze,Ze.id in se||(se[Ze.id]=0);var tt=se[Ze.id],et=de[Ze.outboundLayer.id]==null?0:de[Ze.outboundLayer.id];tt=Math.max(tt,et),de[Ze.outboundLayer.id]=tt,ke[Ze.outboundLayer.id]=Ze.outboundLayer,se[Ze.id]=tt;for(var j=0;j<Ze.inboundLayers.length;j++){var ir=Ze.inboundLayers[j],q=Ze.nodeIndices[j],Xe=ir.inboundNodes[q],kt=se[Xe.id]==null?0:se[Xe.id];se[Xe.id]=Math.max(tt+1,kt),le[Xe.id]=Xe}}}catch(dt){f={error:dt}}finally{try{st&&!st.done&&(h=ft.return)&&h.call(ft)}finally{if(f)throw f.error}}var Ir={};for(var gn in se){var tt=se[gn];tt in Ir||(Ir[tt]=[]),Ir[tt].push(le[gn])}var Or={};for(var Cr in de){var tt=de[Cr];tt in Or||(Or[tt]=[]),Or[tt].push(ke[Cr])}var or=Object.keys(Or).map(function(dt){return parseInt(dt,10)}).sort(Td);_.layers=[];try{for(var zn=fe(or),yn=zn.next();!yn.done;yn=zn.next()){var tt=yn.value,$n=Or[tt];$n.sort(function(Ia,ai){var Wn=he[Ia.id],ys=he[ai.id];return Wn<ys?-1:Wn>ys?1:0});try{for(var Sr=(m=void 0,fe($n)),Hi=Sr.next();!Hi.done;Hi=Sr.next()){var B=Hi.value;B instanceof e&&_.internalContainerRefs.push(B),_.layers.push(B)}}catch(Ia){m={error:Ia}}finally{try{Hi&&!Hi.done&&(v=Sr.return)&&v.call(Sr)}finally{if(m)throw m.error}}}}catch(dt){p={error:dt}}finally{try{yn&&!yn.done&&(d=zn.return)&&d.call(zn)}finally{if(p)throw p.error}}_.layersByDepth=Or,or=Object.keys(Ir).map(function(dt){return parseInt(dt,10)}).sort(Td);var Pu=_.inputs.slice(),ep=[];try{for(var Ki=fe(or),gs=Ki.next();!gs.done;gs=Ki.next()){var tt=gs.value;try{for(var Mu=(w=void 0,fe(Ir[tt])),xl=Mu.next();!xl.done;xl=Mu.next()){var Ze=xl.value,B=Ze.outboundLayer;if(B!=null){try{for(var tp=(x=void 0,fe(Ze.inputTensors)),kl=tp.next();!kl.done;kl=tp.next()){var L=kl.value;if(Pu.indexOf(L)===-1)throw new Ri("Graph disconnected: cannot obtain value for tensor ".concat(L)+' at layer "'.concat(B.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(ep))}}catch(Wn){x={error:Wn}}finally{try{kl&&!kl.done&&(S=tp.return)&&S.call(tp)}finally{if(x)throw x.error}}try{for(var rp=(T=void 0,fe(Ze.outputTensors)),Sl=rp.next();!Sl.done;Sl=rp.next()){var L=Sl.value;Pu.push(L)}}catch(Wn){T={error:Wn}}finally{try{Sl&&!Sl.done&&(E=rp.return)&&E.call(rp)}finally{if(T)throw T.error}}ep.push(B.name)}}}catch(Ia){w={error:Ia}}finally{try{xl&&!xl.done&&(b=Mu.return)&&b.call(Mu)}finally{if(w)throw w.error}}}}catch(dt){g={error:dt}}finally{try{gs&&!gs.done&&(y=Ki.return)&&y.call(Ki)}finally{if(g)throw g.error}}_.nodesByDepth=Ir;var fg=_.layers.map(function(dt){return dt.name}),mj=function(dt){var Ia=fg.filter(function(ai){return ai===dt}).length;if(Ia!==1)throw new Ri('The name "'.concat(dt,'" is used ').concat(Ia," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(fg))};try{for(var np=fe(fg),Nl=np.next();!Nl.done;Nl=np.next()){var gj=Nl.value;mj(gj)}}catch(dt){C={error:dt}}finally{try{Nl&&!Nl.done&&(R=np.return)&&R.call(np)}finally{if(C)throw C.error}}return _.outboundNodes=[],_.inboundNodes=[],new sv({outboundLayer:_,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:_.inputs,outputTensors:_.outputs,inputMasks:_.inputs.map(function(dt){return null}),outputMasks:_.outputs.map(function(dt){return null}),inputShapes:_.inputs.map(function(dt){return dt.shape}),outputShapes:_.outputs.map(function(dt){return dt.shape})}),_.built=!0,_._refCount=1,_}return e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){var t,n,a,i;this.assertNotDisposed();var o={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.numDisposedVariables+=c.dispose().numDisposedVariables}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var l=fe(this.internalContainerRefs),f=l.next();!f.done;f=l.next()){var h=f.value;o.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(p){a={error:p}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}}return o.refCountAfterDispose=this._refCount,o},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(n){n._trainableWeights.forEach(function(a){return a.trainable=t})}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(this._trainableWeights.length>0)throw new Z("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value;a=a.concat(s.trainableWeights)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Je([],te(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.layers),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Je([],te(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.loadWeights=function(t,n){var a,i,o,s;n===void 0&&(n=!0);var u={},c=0,l=D1e(t);l&&this.parseWeights(t);try{for(var f=fe(this.layers),h=f.next();!h.done;h=f.next()){var p=h.value;try{for(var d=(o=void 0,fe(p.weights.entries())),m=d.next();!m.done;m=d.next()){var v=te(m.value,2),g=v[0],y=v[1],w=l?"".concat(y.name.split("/").slice(0,-1).join("/")+"/").concat(g):y.originalName;if(u[w]!=null)throw new Z("Duplicate weight name: ".concat(w));u[w]=y,c++}}catch(R){o={error:R}}finally{try{m&&!m.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}}}catch(R){a={error:R}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var b=[];for(var x in t){var S=x;if(u[x]==null){var T=x.split("/"),E=T.slice(0,-2).concat([T[T.length-1]]);S=E.join("/")}if(u[S]!=null)b.push([u[S],t[x]]);else if(n)throw new Z("Provided weight data has no target variable: ".concat(x));delete u[S]}if(n){var C=[];for(var x in u)C.push(x);if(C.length>0)throw new Z("".concat(C.length," of ").concat(c," weights are not set: ")+"".concat(C))}Sb(b)},e.prototype.parseWeights=function(t){var n=function(i){var o=i.split("/"),s=["vars","layer_checkpoint_dependencies"],u=o.map(function(c){return c.startsWith("_")?c.slice(1):c}).filter(function(c){return!s.includes(c)}).join("/");u!==i&&(t[u]=t[i],delete t[i])};for(var a in Object.keys(t))n(a)},e.prototype.updatedConfig=function(){var t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion="tfjs-layers ".concat(ew),n.backend="TensorFlow.js",n},e.prototype.toJSON=function(t,n){n===void 0&&(n=!0);var a=lb(this.updatedConfig());return n?JSON.stringify(a):a},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=Pt(t);for(var i=new dc,o=0;o<a.inputs.length;++o)i.add(a.inputs[o],t[o]);return Cf(a.outputs,i,n)})},e.prototype.computeMask=function(t,n){var a=this;return F.tidy(function(){t=Pt(t);var i;return n==null?i=Gs(null,t.length):i=Pt(n),a.runInternalGraph(t,i)[1]})},e.prototype.computeOutputShape=function(t){var n,a,i,o,s=Od(t);if(s.length!==this.inputLayers.length)throw new Z("Invalid inputShape argument ".concat(t,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var u={},c=0;c<s.length;c++){var l=this.inputLayers[c],f=s[c],h=l.name+"_0_0";u[h]=f}var p=Object.keys(this.nodesByDepth).map(function(q){return parseInt(q,10)}).sort(Td);if(p.length>1)try{for(var d=fe(p),m=d.next();!m.done;m=d.next()){var v=m.value,g=this.nodesByDepth[v];try{for(var y=(i=void 0,fe(g)),w=y.next();!w.done;w=y.next()){var b=w.value,l=b.outboundLayer;if(this.inputLayers.map(function(Y){return Y.id}).indexOf(l.id)===-1){for(var x=[],S=0;S<b.inboundLayers.length;S++){var T=b.inboundLayers[S],E=b.nodeIndices[S],C=b.tensorIndices[S],h="".concat(T.name,"_").concat(E,"_").concat(C),R=u[h];x.push(R)}for(var _=l.computeOutputShape(_n(x)),P=Od(_),$=l.inboundNodes.indexOf(b),S=0;S<P.length;S++){var h="".concat(l.name,"_").concat($,"_").concat(S);u[h]=P[S]}}}}catch(q){i={error:q}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(q){n={error:q}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}for(var z=[],L=[],c=0;c<this.outputLayers.length;c++){var l=this.outputLayers[c],$=this.outputLayersNodeIndices[c],C=this.outputLayersTensorIndices[c],h="".concat(l.name,"_").concat($,"_").concat(C);L.push(h)}for(var c=0;c<L.length;c++){var B=L[c];_i(B in u),z.push(u[B])}return _n(z)},e.prototype.runInternalGraph=function(t,n){var a,i,o,s,u,c,l,f;n==null&&(n=Gs(null,t.length));for(var h={},p=0;p<this.inputs.length;++p){var d=this.inputs[p],m=t[p],v=n[p];h[d.id]=[m,v]}var g=Object.keys(this.nodesByDepth).map(function(xe){return parseInt(xe,10)}).sort(Td);try{for(var y=fe(g),w=y.next();!w.done;w=y.next()){var b=w.value,x=this.nodesByDepth[b];try{for(var S=(o=void 0,fe(x)),T=S.next();!T.done;T=S.next()){var E=T.value,C=E.outboundLayer,R=E.inputTensors,_=E.outputTensors,P=new Array;try{for(var $=(u=void 0,fe(R)),z=$.next();!z.done;z=$.next()){var d=z.value;d.id in h&&P.push(h[d.id])}}catch(xe){u={error:xe}}finally{try{z&&!z.done&&(c=$.return)&&c.call($)}finally{if(u)throw u.error}}if(P.length===R.length){var L={},B=void 0,q=void 0,Y=void 0,J=void 0;if(E.callArgs!=null&&(L=E.callArgs),P.length===1){var U=te(P[0],2),j=U[0],ne=U[1];L.mask==null&&(L.mask=ne),Y=Pt(C.call(j,L)),J=Pt(C.computeMask(j,ne)),B=[j],q=[ne]}else B=P.map(function(xe){return xe[0]}),q=P.map(function(xe){return xe[1]}),L.mask==null&&(L.mask=q),Y=Pt(C.call(B,L)),J=Pt(C.computeMask(B,q));if(C.activityRegularizer)throw new vt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var p=0;p<_.length;++p){var d=_[p],m=Y[p],v=J[p];h[d.id]=[m,v]}}}}catch(xe){o={error:xe}}finally{try{T&&!T.done&&(s=S.return)&&s.call(S)}finally{if(o)throw o.error}}}}catch(xe){a={error:xe}}finally{try{w&&!w.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}var re=[],se=[],le=[];try{for(var de=fe(this.outputs),ke=de.next();!ke.done;ke=de.next()){var d=ke.value;_i(d.id in h,"Could not compute output ".concat(d.name," : ").concat(d.id));var he=te(h[d.id],2),ye=he[0],v=he[1];le.push(ye.shape),re.push(ye),se.push(v)}}catch(xe){l={error:xe}}finally{try{ke&&!ke.done&&(f=de.return)&&f.call(de)}finally{if(l)throw l.error}}return[re,se,le]},e.prototype.buildNodeConversionMap=function(t){var n,a,i={},o;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o=c instanceof e?1:0;for(var l=0;l<c.inboundNodes.length;l++){var f=e.nodeKey(c,l);this.containerNodes.has(f)&&(i[f]=o,o+=1)}}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return i},e.prototype.getLayer=function(t,n){var a,i;if(n!=null)return this.findLayer(n);if(t==null)throw new Z("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);try{for(var o=fe(this.layers),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.name===t)return u}}catch(c){a={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}throw new Z("No such layer: ".concat(t))},e.prototype.findLayer=function(t){if(this.layers.length<=t)throw new Z("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]},e.prototype.calculateLosses=function(){var t=this;return F.tidy(function(){var n,a,i=[];try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next())for(var u=s.value,c=0;c<u.inboundNodes.length;++c){var l=e.nodeKey(u,c);t.containerNodes.has(l)&&i.push.apply(i,Je([],te(u.calculateLosses()),!1))}}catch(f){n={error:f}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i})},e.prototype.getConfig=function(){var t,n,a={name:this.name},i=this.buildNodeConversionMap(this.layers),o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=c.getClassName(),f=c.getConfig(),h=[],p=0;p<c.inboundNodes.length;p++){var d=c.inboundNodes[p],m=e.nodeKey(c,p),v={};if(this.containerNodes.has(m)){if(d.callArgs)try{JSON.stringify(d.callArgs),v=d.callArgs}catch{console.warn("Layer ".concat(c.name," was passed ")+"non-serializable keyword arguments: "+"".concat(d.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),v={}}if(d.inboundLayers.length>0){for(var g=[],y=0;y<d.inboundLayers.length;y++){var w=d.inboundLayers[y],b=d.nodeIndices[y],x=d.tensorIndices[y],S=e.nodeKey(w,b),T=i[S];T==null&&(T=0),g.push([w.name,T,x,v])}h.push(g)}}}var E={};E.name=c.name,E.className=l,E.config=f,E.inboundNodes=h,o.push(E)}}catch(_){t={error:_}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}a.layers=o;for(var C=[],y=0;y<this.inputLayers.length;y++){var c=this.inputLayers[y],b=this.inputLayersNodeIndices[y],m=e.nodeKey(c,b);if(!!this.containerNodes.has(m)){var T=i[m];T==null&&(T=0);var x=this.inputLayersTensorIndices[y];C.push([c.name,T,x])}}a.inputLayers=C;for(var R=[],y=0;y<this.outputLayers.length;y++){var c=this.outputLayers[y],b=this.outputLayersNodeIndices[y],m=e.nodeKey(c,b);if(!!this.containerNodes.has(m)){var T=i[m];T==null&&(T=0);var x=this.outputLayersTensorIndices[y];R.push([c.name,T,x])}}return a.outputLayers=R,a},e.fromConfig=function(t,n,a,i){var o,s,u,c,l,f,h,p,d,m;i===void 0&&(i=!1);var v={},g={};function y(ye,xe){ye.name in g?g[ye.name].push(xe):g[ye.name]=[xe]}function w(ye,xe){var De,Ye,ht=[],at;try{for(var nt=fe(xe),ft=nt.next();!ft.done;ft=nt.next()){var st=ft.value,Ze=st[0],tt=st[1],et=st[2];if(at=st[3]==null?{}:st[3],!(Ze in v)){y(ye,xe);return}var ir=v[Ze];if(ir.inboundNodes.length<=tt){y(ye,xe);return}var Xe=ir.inboundNodes[tt];ht.push(Xe.outputTensors[et])}}catch(kt){De={error:kt}}finally{try{ft&&!ft.done&&(Ye=nt.return)&&Ye.call(nt)}finally{if(De)throw De.error}}ht.length>0&&ye.apply(_n(ht),at)}function b(ye){var xe=ye.name,De=pi(ye,n.customObjects!=null?n.customObjects:{});De.setFastWeightInitDuringBuild(i),v[xe]=De;var Ye=ye.inboundNodes;Ye.forEach(function(ht){if(!(ht instanceof Array))throw new Z("Corrupted configuration, expected array for nodeData: ".concat(ht));y(De,ht)})}var x=n.name,S=n.layers;try{for(var T=fe(S),E=T.next();!E.done;E=T.next()){var C=E.value;b(C)}}catch(ye){o={error:ye}}finally{try{E&&!E.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}for(;!Upe(g);)try{for(var R=(u=void 0,fe(S)),_=R.next();!_.done;_=R.next()){var C=_.value,P=v[C.name];if(P.name in g){var $=g[P.name];delete g[P.name];try{for(var z=(l=void 0,fe($)),L=z.next();!L.done;L=z.next()){var B=L.value;w(P,B)}}catch(xe){l={error:xe}}finally{try{L&&!L.done&&(f=z.return)&&f.call(z)}finally{if(l)throw l.error}}}}}catch(ye){u={error:ye}}finally{try{_&&!_.done&&(c=R.return)&&c.call(R)}finally{if(u)throw u.error}}var q=[],Y=[],J=n.inputLayers;try{for(var U=fe(J),j=U.next();!j.done;j=U.next()){var C=j.value,ne=C[0],re=C[1],se=C[2];_i(ne in v);var P=v[ne],le=P.inboundNodes[re].outputTensors;q.push(le[se])}}catch(ye){h={error:ye}}finally{try{j&&!j.done&&(p=U.return)&&p.call(U)}finally{if(h)throw h.error}}var de=n.outputLayers;try{for(var ke=fe(de),he=ke.next();!he.done;he=ke.next()){var C=he.value,ne=C[0],re=C[1],se=C[2];_i(ne in v);var P=v[ne],le=P.inboundNodes[re].outputTensors;Y.push(le[se])}}catch(ye){d={error:ye}}finally{try{he&&!he.done&&(m=ke.return)&&m.call(ke)}finally{if(d)throw d.error}}return new t({inputs:q,outputs:Y,name:x})},Object.defineProperty(e.prototype,"stateful",{get:function(){var t,n;if(this._stateful)throw new Z("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var a=fe(this.layers),i=a.next();!i.done;i=a.next()){var o=i.value;if(o.stateful)return!0}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){var t=this;F.tidy(function(){t.layers.forEach(function(n){n.stateful&&n.resetStates()})})},e}(mt);function F1e(r,e,t){var n=e.length;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(i){return null});if(n===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&e[0]in r?[r[e[0]]]:[r];if(Array.isArray(r)){if(r.length!==n)throw new Error("Provided ".concat(t," is an array of ").concat(r.length," ")+"element(s), but the model has ".concat(n," outputs. ")+"Make sure a set of weights is provided for each model output.");return r}else if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){var a=[];return e.forEach(function(i){i in r?a.push(r[i]):a.push(null)}),a}else throw new Error("The model has multiple (".concat(n,") outputs, ")+"so ".concat(t," must be either an array with ")+"".concat(n," elements or an object with ").concat(e," keys. ")+"Provided ".concat(t," not understood: ").concat(JSON.stringify(r)))}function U4(r,e){return F1e(r,e,"classWeight")}function V4(r,e,t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(e!=null||n!=null)throw new Error("Support sampleWeight is not implemented yet");return t==null?[3,2]:(a=F.tidy(function(){if(r.shape.length===1)return F.clone(r);if(r.shape.length===2)if(r.shape[1]>1){var l=1;return F.argMax(r,l)}else{if(r.shape[1]===1)return F.reshape(r,[r.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(r.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}else throw new Error("Unexpected rank of target (y) tensor (".concat(r.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),s=(o=Array).from,[4,a.data()]);case 1:return i=s.apply(o,[c.sent()]),F.dispose(a),u=[],i.forEach(function(l){if(t[l]==null)throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(l," exists in the data but not in ")+"classWeight");u.push(t[l])}),[2,F.tensor1d(u,"float32")];case 2:return[2,null]}})})}function R1e(r,e){return F.mul(r,e)}var O1e=32;function G4(r,e){var t,n,a=e;t=a.xs,n=a.ys,A.util.assert(t!=null&&n!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(e)});var i=FP("input",r.inputNames,t),o=FP("output",r.outputNames,n),s=i[0].shape[0];A.util.assert(i.length===r.inputs.length,function(){return"LayersModel has ".concat(r.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(r.inputNames),")")}),A.util.assert(o.length===r.outputs.length,function(){return"LayersModel has ".concat(r.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(r.outputNames),")")});for(var u=function(h){A.util.assert(i[h].shape[0]===s,function(){return"Batch size mismatch: input "+"".concat(r.inputNames[h]," has ").concat(i[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(r.inputNames[0],".")})},c=0;c<i.length;c++)u(c);for(var l=function(h){A.util.assert(o[h].shape[0]===s,function(){return"Batch size mismatch: output "+"".concat(r.outputNames[h]," has ").concat(o[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(r.inputNames[0],".")})},f=0;f<o.length;f++)l(f);return{xs:i,ys:o}}function FP(r,e,t){var n,a;if(t instanceof A.Tensor)return[t];if(Array.isArray(t))return A.util.assert(t.length===e.length,function(){return"Received an array of ".concat(t.length," Tensors, but expected ").concat(e.length," to match the ").concat(r," keys ").concat(e,".")}),t;var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value;if(t[u]==null)throw new Z("The feature data generated by the dataset lacks the required "+"".concat(r," key '").concat(u,"'."));i.push(t[u])}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}function P1e(r){if(r.length===3)throw new vt("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}function M1e(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C,R,_,U,P,$,z,L,U,B,q,Y,J,U;return Ee(this,function(j){switch(j.label){case 0:if(n=t.batchesPerEpoch!=null,A.util.assert(r.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),A.util.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),A.util.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(t.epochs)}),A.util.assert(!n||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(t.batchesPerEpoch)}),A.util.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,j.label=1;case 1:return j.trys.push([1,,26,27]),a=t.validationData!=null,i=void 0,o=void 0,a&&(RP(t.validationData)?A.util.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(t.validationBatches)}):(s=P1e(t.validationData),i=s.xs,o=s.ys)),u=r.makeTrainFunction(),c=r.getDedupedMetricsNames(),l=void 0,a?l=c.slice().concat(c.map(function(ne){return"val_"+ne})):l=c.slice(),f=P4(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,p=M4(f,h,t.epochs,null,null,B1e(e,t),null,a,l),d=p.callbackList,m=p.history,d.setModel(r),r.history=m,[4,d.onTrainBegin()];case 2:return j.sent(),r.stopTraining_=!1,v=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:g=j.sent(),j.label=4;case 4:return v<t.epochs?(y={},[4,d.onEpochBegin(v)]):[3,23];case 5:return j.sent(),w=0,b=0,n?[3,7]:[4,e.iterator()];case 6:g=j.sent(),j.label=7;case 7:return!n||w<t.batchesPerEpoch?[4,g.next()]:[3,21];case 8:return x=j.sent(),n&&x.done?(console.warn("You provided `batchesPerEpoch` as "+"".concat(t.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(w," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(t.batchesPerEpoch*t.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),[3,21]):x.value==null?[3,15]:(S=G4(r,x.value),T=S.xs,E=S.ys,C={},C.batch=b,C.size=T[0].shape[0],[4,d.onBatchBegin(b,C)]);case 9:if(j.sent(),R=[],t.classWeight==null)return[3,13];_=U4(t.classWeight,r.outputNames),U=0,j.label=10;case 10:return U<_.length?($=(P=R).push,[4,V4(E[U],null,_[U])]):[3,13];case 11:$.apply(P,[j.sent()]),j.label=12;case 12:return++U,[3,10];case 13:for(z=T.concat(E).concat(R),L=u(z),A.dispose(z),U=0;U<c.length;++U)B=c[U],q=L[U],C[B]=q,A.keep(q);return[4,d.onBatchEnd(b,C)];case 14:j.sent(),_4(C),b++,w++,j.label=15;case 15:return(n?w>=t.batchesPerEpoch:x.done)?a?(Y=void 0,RP(t.validationData)?(J=Pt,[4,r.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return Y=J.apply(void 0,[j.sent()]),[3,18];case 17:Y=Pt(r.evaluate(i,o,{batchSize:t.validationBatchSize==null?O1e:t.validationBatchSize,verbose:0})),j.label=18;case 18:for(U=0;U<r.metricsNames.length;++U)y["val_".concat(r.metricsNames[U])]=Y[U];j.label=19;case 19:return[3,21];case 20:return r.stopTraining_?[3,21]:[3,7];case 21:return[4,d.onEpochEnd(v,y)];case 22:return j.sent(),v++,r.stopTraining_?[3,23]:[3,4];case 23:return[4,d.onTrainEnd()];case 24:return j.sent(),[4,r.history.syncData()];case 25:return j.sent(),[2,r.history];case 26:return r.isTraining=!1,[7];case 27:return[2]}})})}function B1e(r,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(r.size)&&(t=r.size),t}function RP(r){return typeof r.iterator=="function"}function L1e(r){return typeof r.next=="function"}function z1e(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p;return Ee(this,function(d){switch(d.label){case 0:if(t=t||{},n=t.batches!=null,a=r.testFunction,i=[],t.verbose>0)throw new vt("Verbose mode is not implemented yet.");return A.util.assert(!n||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(t.batches))}),L1e(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=d.sent(),d.label=3;case 3:o=s,u=0,c=0,l=function(){var m;return Ee(this,function(v){switch(v.label){case 0:return[4,o.next()];case 1:return m=v.sent(),i=A.tidy(function(){if(m.value){var g=G4(r,m.value),y=g.xs,w=g.ys,b=y.concat(w),x=A.tidy(function(){return a(b)});if(A.dispose(b),c===0)for(var S=0;S<x.length;++S)i.push(F.scalar(0));for(var T=b[0].shape[0],E=function(C){var R=x[C],_=i[C];i[C]=A.tidy(function(){return A.add(i[C],A.mul(T,R))}),c>0&&A.dispose(_)},S=0;S<x.length;++S)E(S);A.dispose(x),u+=T,++c}return i}),m.done?(n&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(t.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},d.label=4;case 4:return!n||c<t.batches?[5,l()]:[3,6];case 5:return f=d.sent(),f==="break"?[3,6]:[3,4];case 6:for(h=0;h<i.length;++h)p=i[h],i[h]=A.div(i[h],u),A.dispose(p);return[2,_n(i)]}})})}function H0(r){A.util.assert(r>0&&Number.isInteger(r),function(){return"batchSize is required to be a positive integer, but got ".concat(r)})}function Ef(r,e,t){return r==null?[null]:Array.isArray(r)?r.map(function(n){return Vs(n,e,t-e)}):Vs(r,e,t-e)}function fb(r,e){return A.tidy(function(){return r==null?null:Array.isArray(r)?r.map(function(t){return fb(t,e)}):ZP(r,e.dtype==="int32"?e:A.cast(e,"int32"))})}function K0(r,e){for(var t=[],n=0,a=null;n<r;)a=n+e,a>=r&&(a=r),t.push([n,a]),n=a;return t}function H4(r){var e=[];r instanceof F.Tensor&&(r=[r]);for(var t=0;t<r.length;++t){var n=r[t];if(n.rank===1)e.push(zf(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function li(r,e){if(r!=null){var t=[];if(e instanceof F.Tensor)t.push(e.id);else if(Array.isArray(e))e.forEach(function(s){return t.push(s.id)});else if(e!=null)for(var n in e){var a=e[n];t.push(a.id)}var i=[];if(r instanceof F.Tensor)t.indexOf(r.id)===-1&&i.push(r);else if(Array.isArray(r))r.forEach(function(s){t.indexOf(s.id)===-1&&i.push(s)});else if(r!=null)for(var n in r){var o=r[n];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(function(s){s.isDisposed||s.dispose()})}}function $1e(r){return r instanceof F.Tensor}function hb(r){return Array.isArray(r)}function OP(r){return!$1e(r)&&!hb(r)}function PP(r,e,t,n,a){var i,o;if(n===void 0&&(n=!0),a===void 0&&(a=""),e==null||e.length===0){if(r!=null){var s=!1;if(hb(r)&&r.length>0)s=!0;else if(OP(r)){for(var u in r)if(r.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new Z("Error when checking model ".concat(a," expected no data, ")+"but got ".concat(r))}return[]}if(r==null)return e.map(function(y){return null});var c;if(OP(r)){r=r,c=[];try{for(var l=fe(e),f=l.next();!f.done;f=l.next()){var h=f.value;if(r[h]==null)throw new Z('No data provided for "'.concat(h,'". Need data for each key in: ')+"".concat(e));c.push(r[h])}}catch(y){i={error:y}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}else if(hb(r)){if(r=r,r.length!==e.length)throw new Z("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(e.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(r));c=r}else{if(r=r,e.length>1)throw new Z("The model ".concat(a," expects ").concat(e.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(r.shape));c=[r]}if(c=H4(c),t!=null){for(var p=0;p<e.length;++p)if(t[p]!=null){var d=c[p];if(d.shape.length!==t[p].length)throw new Z("Error when checking ".concat(a,": expected ").concat(e[p]," ")+"to have ".concat(t[p].length," dimension(s). but got array with ")+"shape ".concat(d.shape));for(var m=0;m<t[p].length;++m)if(!(m===0&&!n)){var v=d.shape[m],g=t[p][m];if(g!=null&&g>=0&&v!==g)throw new Z("".concat(a," expected a batch of elements where each ")+"example has shape [".concat(t[p].slice(1,t[p].length),"] ")+"(i.e.,tensor shape [*,".concat(t[p].slice(1,t[p].length),"])")+" but the ".concat(a," received an input with ").concat(d.shape[0])+" examples, each with shape [".concat(d.shape.slice(1,d.shape.length),"]")+" (tensor shape [".concat(d.shape,"])"))}}}return c}function W1e(r,e,t){var n=jo(r.map(function(i){return i.shape[0]}));n.sort();var a=jo(e.map(function(i){return i.shape[0]}));if(a.sort(),n.length>1)throw new Z("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(r.map(function(i){return i.shape}))));if(a.length>1)throw new Z("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(function(i){return i.shape}))));if(n.length>0&&a.length>0&&!F.util.arraysEqual(n,a))throw new Z("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function q1e(r,e,t){for(var n=[eu,pv,Pf],a=0;a<r.length;++a){var i=r[a],o=e[a],s=t[a];if(o!=null){if(o===Pf&&i.shape[i.shape.length-1]===1)throw new Z("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(n.indexOf(o)!==-1)for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var f=u[l],h=c[l];if(h!=null&&f!==h)throw new Z("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function MP(r,e,t,n,a){n===void 0&&(n=!0),a===void 0&&(a="");var i;if(Array.isArray(r)){if(r.length!==e.length)throw new Z("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(e.length," Tensor(s),")+" but instead got ".concat(r.length," Tensors(s)."));i=r}else{if(e.length>1)throw new Z("The model expects ".concat(e.length," ").concat(a," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(r.shape),"."));i=[r]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var s=i[o];if(s.shape.length!==t[o].length)throw new Z("Error when checking ".concat(a,": expected ").concat(e[o]," ")+"to have ".concat(t[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<t[o].length;++u)if(!(u===0&&!n)){var c=s.shape[u],l=t[o][u];if(l!=null&&l!==c)throw new Z("Error when checking ".concat(a,": expected ")+"".concat(e[o]," to have shape ").concat(JSON.stringify(t[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}}function U1e(r,e){var t,n;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(l){return[]});var a;if(typeof r=="string"||typeof r=="function")a=[r];else if(Array.isArray(r)||typeof r=="object")a=r;else throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(r));if(Array.isArray(a))return e.map(function(l){return a});var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value,c=a.hasOwnProperty(u)?a[u]:[];Array.isArray(c)||(c=[c]),i.push(c)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}var V1e="layers-model",oo=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.isTraining=!1,n}return e.prototype.summary=function(t,n,a){if(a===void 0&&(a=console.log),!this.built)throw new Z("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");T1e(this,t,n,a)},e.prototype.compile=function(t){var n,a,i=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=N1e(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof F.Optimizer))throw new Z("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var o=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(var s in t.loss)if(this.outputNames.indexOf(s)===-1)throw new Z('Unknown entry in loss dictionary: "'.concat(s,'". ')+"Only expected the following keys: ".concat(this.outputNames));try{for(var u=fe(this.outputNames),c=u.next();!c.done;c=u.next()){var s=c.value;t.loss[s]==null&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(s," during training")),o.push(G0(t.loss[s]))}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new Z("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(t.loss,"."));var l=t.loss;o=l.map(function(g){return G0(g)})}else{var f=G0(t.loss);this.outputs.forEach(function(g){o.push(f)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var h=0;h<this.outputs.length;++h){var p=this.internalOutputShapes[h],s=this.outputNames[h];this.feedOutputNames.push(s),this.feedOutputShapes.push(p),this.feedLossFns.push(this.lossFunctions[h])}var d=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Us("loss",function(){for(var g=0;g<i.outputs.length;++g)if(d.indexOf(g)===-1){var y=i.lossFunctions[g];i.outputs.length>1&&(i.metricsTensors.push([y,g]),i.metricsNames.push(i.outputNames[g]+"_loss"))}});var m=U1e(t.metrics,this.outputNames),v=function(g,y,w){i.outputNames.length>1&&(y=i.outputNames[g]+"_"+y),i.metricsNames.push(y),i.metricsTensors.push([w,g])};Us("metric",function(){for(var g=function(w){if(d.indexOf(w)!==-1)return"continue";var b=m[w],x=function(S){var T,E,C="",R,_,P,$=function(q){if(typeof q=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(q)!==-1){var Y=i.internalOutputShapes[w];Y[Y.length-1]===1||i.lossFunctions[w]===pv?["accuracy","acc"].indexOf(q)!==-1?_=Zb:["crossentropy","ce"].indexOf(q)!==-1&&(_=z4):i.lossFunctions[w]===jd?["accuracy","acc"].indexOf(q)!==-1?_=$4:["crossentropy","ce"].indexOf(q)!==-1&&(_=W4):["accuracy","acc"].indexOf(q)!==-1?_=Jb:["crossentropy","ce"].indexOf(q)!==-1&&(_=Qb);var J=void 0;["accuracy","acc"].indexOf(q)!==-1?J="acc":["crossentropy","ce"].indexOf(q)!==-1&&(J="ce"),P=_,R=C+J}else{var U=S1e(q);P=U,R=C+Cd(q)}var j;Us(R,function(){j=P}),v(w,R,j)};try{for(var z=(T=void 0,fe(S)),L=z.next();!L.done;L=z.next()){var B=L.value;$(B)}}catch(q){T={error:q}}finally{try{L&&!L.done&&(E=z.return)&&E.call(z)}finally{if(T)throw T.error}}};x(b)},y=0;y<i.outputs.length;++y)g(y)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,n,a){a===void 0&&(a={});var i=a.batchSize==null?32:a.batchSize;H0(i);var o=!0,s=this.standardizeUserDataXY(t,n,o,i);try{var u=s[0].concat(s[1]);this.makeTestFunction();var c=this.testFunction,l=this.testLoop(c,u,i,a.verbose,a.steps);return _n(l)}finally{li(s[0],t),li(s[1],n)}},e.prototype.evaluateDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return this.makeTestFunction(),[2,z1e(this,t,n)]})})},e.prototype.checkNumSamples=function(t,n,a,i){i===void 0&&(i="steps");var o;if(a!=null){if(o=null,n!=null)throw new Z("If ".concat(i," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(n))}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new Z("Either the input data should have a defined shape, or "+"".concat(i," shoud be specified."));return o},e.prototype.execute=function(t,n){var a,i;if(Array.isArray(n)&&n.length===0)throw new Z("`outputs` is an empty Array, which is not allowed.");var o=Array.isArray(n),s=o?n:[n],u=this.retrieveSymbolicTensors(s),c=new dc;if(t instanceof F.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new Z("The number of inputs provided (".concat(t.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var l=0;l<this.inputs.length;++l)c.add(this.inputs[l],t[l])}else try{for(var f=fe(this.inputs),h=f.next();!h.done;h=f.next()){var p=h.value,d=t[p.name];if(d==null)throw new Z("No value is provided for the model's input ".concat(p.name));c.add(p,d)}}catch(v){a={error:v}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var m=Cf(u,c);return o?m:m[0]},e.prototype.retrieveSymbolicTensors=function(t){var n,a,i=Gs(null,t.length),o=t.length;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=Array.isArray(c.output)?c.output:[c.output],f=l.map(function(m){return m.name}),h=0;h<t.length;++h){var p=f.indexOf(t[h]);if(p!==-1&&(i[h]=l[p],o--),o===0)break}if(o===0)break}}catch(m){n={error:m}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(o>0){var d=[];throw i.forEach(function(m,v){m==null&&d.push(t[v])}),new Z("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(d)))}return i},e.prototype.predictLoop=function(t,n,a){var i=this;return n===void 0&&(n=32),a===void 0&&(a=!1),A.tidy(function(){var o=i.checkNumSamples(t);if(a)throw new vt("Verbose predictLoop() is not implemented yet.");for(var s=K0(o,n),u=i.outputs.map(function(f){return[]}),c=function(f){var h=A.tidy(function(){var p=s[f][0],d=s[f][1],m=Ef(t,p,d),v=[];if(Array.isArray(m))for(var g=0;g<m.length;++g)v.push({key:i.inputs[g],value:m[g]});else v.push({key:i.inputs[0],value:m});var y=new dc(v);return Cf(i.outputs,y)});h.forEach(function(p,d){return u[d].push(p)})},l=0;l<s.length;++l)c(l);return _n(u.map(function(f){return A.concat(f,0)}))})},e.prototype.predict=function(t,n){n===void 0&&(n={});var a=H4(t);MP(a,this.inputNames,this.feedInputShapes,!1);try{var i=n.batchSize==null?32:n.batchSize;return H0(i),this.predictLoop(a,i)}finally{li(a,t)}},e.prototype.predictOnBatch=function(t){MP(t,this.inputNames,this.feedInputShapes,!0);var n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)},e.prototype.standardizeUserDataXY=function(t,n,a,i){if(this.optimizer_==null)throw new Ri("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s],c=this.feedLossFns[s];c===jd?o.push(u.slice(0,u.length-1).concat([1])):o.push(u)}if(t=PP(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=PP(n,this.feedOutputNames,o,!1,"target"),W1e(t,n),q1e(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new Z("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(i,". Found: ").concat(t[0].shape[0]," sample(s)."));return[t,n]},e.prototype.standardizeUserData=function(t,n,a,i,o,s){return o===void 0&&(o=!0),Ce(this,void 0,void 0,function(){var u,c,l,f,h,p,d,m;return Ee(this,function(v){switch(v.label){case 0:if(u=te(this.standardizeUserDataXY(t,n,o,s),2),c=u[0],l=u[1],a!=null)throw new Error("sample weight is not supported yet.");if(f=null,i==null)return[3,4];h=U4(i,this.outputNames),f=[],p=0,v.label=1;case 1:return p<h.length?(m=(d=f).push,[4,V4(l[p],null,h[p])]):[3,4];case 2:m.apply(d,[v.sent()]),v.label=3;case 3:return++p,[3,1];case 4:return[2,[c,l,f]]}})})},e.prototype.testLoop=function(t,n,a,i,o){var s=this;return i===void 0&&(i=0),A.tidy(function(){var u=s.checkNumSamples(n,a,o,"steps"),c=[];if(i>0)throw new vt("Verbose mode is not implemented yet.");if(o!=null)throw new vt("steps mode in testLoop() is not implemented yet");for(var l=K0(u,a),f=F.tensor1d(vi(0,u)),h=0;h<l.length;++h){var p=l[h][0],d=l[h][1],m=Vs(f,p,d-p),v=fb(n,m),g=t(v);if(h===0)for(var y=0;y<g.length;++y)c.push(F.scalar(0));for(var y=0;y<g.length;++y){var w=g[y];c[y]=A.add(c[y],A.mul(d-p,w))}}for(var y=0;y<c.length;++y)c[y]=A.div(c[y],u);return c})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,n=[],a=0;a<t.length;++a){var i=t[a],o=i;if(WO(t,i)>1){var s=WO(t.slice(0,a),i);o+="_".concat(s)}n.push(o)}return n},e.prototype.makeTrainFunction=function(){var t=this;return function(n){var a=[],i=n.slice(0,t.inputs.length),o=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=n.slice(t.inputs.length+t.outputs.length,t.inputs.length+t.outputs.length*2),u=[],c=function(){for(var p=[],d=0;d<t.inputs.length;++d)p.push({key:t.inputs[d],value:i[d]});for(var m=new dc(p),v=Cf(t.outputs,m,{training:!0}),g,d=0;d<t.lossFunctions.length;++d){var y=t.lossFunctions[d],w=y(o[d],v[d]);s[d]!=null&&(w=R1e(w,s[d]));var b=A.mean(w);a.push(b),d===0?g=w:g=A.add(g,w)}for(var d=0;d<t.metricsTensors.length;++d){var x=void 0;if(t.outputs.length>1&&d<t.outputs.length)x=a[d];else{var S=t.metricsTensors[d][0],T=t.metricsTensors[d][1];x=A.mean(S(o[T],v[T]))}A.keep(x),u.push(x)}return g=A.mean(g),t.calculateLosses().forEach(function(E){g=A.add(g,E)}),g},l=t.collectedTrainableWeights.map(function(p){return p.read()}),f=!0,h=t.optimizer_.minimize(c,f,l);return[h].concat(u)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(n){return A.tidy(function(){for(var a=[],i,o=n.slice(0,t.inputs.length),s=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=[],c=0;c<t.inputs.length;++c)u.push({key:t.inputs[c],value:o[c]});for(var l=new dc(u),f=Cf(t.outputs,l),c=0;c<t.lossFunctions.length;++c){var h=t.lossFunctions[c],p=A.mean(h(s[c],f[c]));c===0?i=p:i=A.add(i,p),a.push(i)}for(var c=0;c<t.metricsTensors.length;++c){var d=t.metricsTensors[c][0],m=t.metricsTensors[c][1],v=A.mean(d(s[m],f[m]));a.push(v)}return a})}},e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C,R,_,P,$;return Ee(this,function(z){switch(z.label){case 0:if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0,z.label=1;case 1:return z.trys.push([1,,7,8]),d=a.batchSize==null?32:a.batchSize,H0(d),m=!1,[4,this.standardizeUserData(t,n,a.sampleWeight,a.classWeight,m,d)];case 2:if(v=z.sent(),i=v[0],o=v[1],p=v[2],g=!1,y=void 0,!(a.validationData!=null&&a.validationData.length>0))return[3,4];if(g=!0,a.validationData.length===2)c=a.validationData[0],l=a.validationData[1];else throw a.validationData.length===3?new vt("validationData including sample weights is not supported yet."):new Z("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));return w=!0,[4,this.standardizeUserData(c,l,null,null,w,d)];case 3:return b=z.sent(),f=b[0],h=b[1],y=f.concat(h),[3,5];case 4:a.validationSplit!=null&&a.validationSplit>0&&a.validationSplit<1?(g=!0,x=Math.floor(i[0].shape[0]*(1-a.validationSplit)),S=i[0].shape[0],f=Ef(i,x,S),s=i,i=Ef(i,0,x),h=Ef(o,x,S),u=o,o=Ef(o,0,x),y=f.concat(h)):a.validationSteps!=null&&(g=!0),z.label=5;case 5:return T=i.concat(o).concat(p),this.checkTrainableWeightsConsistency(),E=this.makeTrainFunction(),C=this.getDedupedMetricsNames(),R=void 0,_=void 0,g?(this.makeTestFunction(),R=this.testFunction,_=C.slice().concat(C.map(function(L){return"val_"+L}))):(R=null,y=[],_=C.slice()),P=P4(a.callbacks,a.yieldEvery),[4,this.fitLoop(E,T,C,d,a.epochs,a.verbose,P,R,y,a.shuffle,_,a.initialEpoch,null,null)];case 6:return $=z.sent(),[2,$];case 7:return this.isTraining=!1,li(i,t),li(o,n),li(s,t),li(u,n),li(f,c),li(h,l),p!=null&&A.dispose(p),[7];case 8:return[2]}})})},e.prototype.fitLoop=function(t,n,a,i,o,s,u,c,l,f,h,p,d,m){return Ce(this,void 0,void 0,function(){var v,g,y,w,b,x,S,T,E,C,R=this;return Ee(this,function(_){switch(_.label){case 0:if(i==null&&(i=32),o==null&&(o=1),f==null&&(f=!0),p==null&&(p=0),v=!1,c!=null&&l!=null&&(v=!0),m!=null&&(v=!0,d==null))throw new Z("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return g=this.checkNumSamples(n,i,d,"steps_per_epoch"),g!=null&&(y=vi(0,g)),s==null&&(s=1),w=M4(u,s,o,p,g,d,i,v,h),b=w.callbackList,x=w.history,b.setModel(this),this.history=x,[4,b.onTrainBegin()];case 1:_.sent(),this.stopTraining_=!1,S=function(P){var $,z,L,B,q,Y;return Ee(this,function(J){switch(J.label){case 0:return[4,b.onEpochBegin(P)];case 1:if(J.sent(),$={},d==null)return[3,2];throw new vt("stepsPerEpoch mode is not implemented yet.");case 2:if(f==="batch")throw new vt("batch shuffling is not implemneted yet");f&&F.util.shuffle(y),z=F.tensor1d(y),L=K0(g,i),B=function(U){var j;return Ee(this,function(ne){switch(ne.label){case 0:return j={},[4,b.onBatchBegin(U,j)];case 1:return ne.sent(),A.tidy(function(){var re=L[U][0],se=L[U][1],le=Vs(z,re,se-re);j.batch=U,j.size=se-re;for(var de=fb(n,le),ke=t(de),he=0;he<a.length;++he){var ye=a[he],xe=ke[he];j[ye]=xe,A.keep(xe)}if(U===L.length-1&&v)for(var De=R.testLoop(c,l,i),he=0;he<a.length;++he){var ye=a[he],xe=De[he];A.keep(xe),$["val_"+ye]=xe}}),[4,b.onBatchEnd(U,j)];case 2:return ne.sent(),_4(j),T.stopTraining_?[2,"break"]:[2]}})},q=0,J.label=3;case 3:return q<L.length?[5,B(q)]:[3,6];case 4:if(Y=J.sent(),Y==="break")return[3,6];J.label=5;case 5:return++q,[3,3];case 6:z.dispose(),J.label=7;case 7:return[4,b.onEpochEnd(P,$)];case 8:return J.sent(),T.stopTraining_?[2,"break"]:[2]}})},T=this,E=p,_.label=2;case 2:return E<o?[5,S(E)]:[3,5];case 3:if(C=_.sent(),C==="break")return[3,5];_.label=4;case 4:return++E,[3,2];case 5:return[4,b.onTrainEnd()];case 6:return _.sent(),[4,this.history.syncData()];case 7:return _.sent(),[2,this.history]}})})},e.prototype.fitDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,M1e(this,t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,m,v;return Ee(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(t,n)];case 1:a=g.sent(),i=a[0],o=a[1],s=this.makeTrainFunction(),u=s(i.concat(o)),c=[],g.label=2;case 2:g.trys.push([2,7,8,9]),l=fe(u),f=l.next(),g.label=3;case 3:return f.done?[3,6]:(h=f.value,[4,h.data()]);case 4:p=g.sent(),c.push(p[0]),g.label=5;case 5:return f=l.next(),[3,3];case 6:return[3,9];case 7:return d=g.sent(),m={error:d},[3,9];case 8:try{f&&!f.done&&(v=l.return)&&v.call(l)}finally{if(m)throw m.error}return[7];case 9:return A.dispose(u),li(a[0],t),li(a[1],n),[2,_n(c)]}})})},e.prototype.getNamedWeights=function(t){for(var n=[],a=t!=null&&t.trainableOnly,i=a?this.trainableWeights:this.weights,o=this.getWeights(a),s=0;s<i.length;++s)a&&!i[s].trainable||n.push({name:i[s].originalName,tensor:o[s]});return n},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var t=r.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var n=A.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-A.memory().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t,n,a,i,o;if(typeof this.loss=="string")o=io(this.loss);else if(Array.isArray(this.loss)){try{for(var s=fe(this.loss),u=s.next();!u.done;u=s.next()){var c=u.value;if(typeof c!="string")throw new Error("Serialization of non-string loss is not supported.")}}catch(m){t={error:m}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}o=this.loss.map(function(m){return io(m)})}else{var l=Object.keys(this.loss);o={};var f=this.loss;try{for(var h=fe(l),p=h.next();!p.done;p=h.next()){var d=p.value;if(typeof f[d]=="string")o[d]=io(f[d]);else throw new Error("Serialization of non-string loss is not supported.")}}catch(m){a={error:m}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}}return o},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[io(Cd(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(a){return io(Cd(a))});var t={};for(var n in this.metrics)t[n]=io(Cd(this.metrics[n]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var n=Mf(t.optimizer_config),a=pi(n),i;if(typeof t.loss=="string")i=Ws(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(function(u){return Ws(u)});else if(t.loss!=null){i={};for(var o in t.loss)i[o]=Ws(t.loss[o])}var s;if(Array.isArray(t.metrics))s=t.metrics.map(function(u){return Ws(u)});else if(t.metrics!=null){s={};for(var o in t.metrics)s[o]=Ws(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:a})},e.prototype.save=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,m,v,g,y;return Ee(this,function(w){switch(w.label){case 0:if(typeof t=="string"){if(a=F.io.getSaveHandlers(t),a.length===0)throw new Z("Cannot find any save handlers for URL '".concat(t,"'"));if(a.length>1)throw new Z("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(t,"'"));t=a[0]}if(t.save==null)throw new Z("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,F.io.encodeWeights(this.getNamedWeights(n))];case 1:return i=w.sent(),o=!1,s=null,u=this.toJSON(s,o),c={modelTopology:u,format:V1e,generatedBy:"TensorFlow.js tfjs-layers v".concat(ew),convertedBy:null},l=n==null?!1:n.includeOptimizer,l&&this.optimizer!=null?(c.trainingConfig=this.getTrainingConfig(),f="optimizer",v=(m=F.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,v.apply(m,[w.sent(),f])];case 3:h=w.sent(),p=h.data,d=h.specs,(y=i.specs).push.apply(y,Je([],te(d),!1)),i.data=F.io.concatenateArrayBuffers([i.data,p]),w.label=4;case 4:return this.userDefinedMetadata!=null&&(g=!0,_P(this.userDefinedMetadata,this.name,g),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=i.data,c.weightSpecs=i.specs,[2,t.save(c)]}})})},e.prototype.setUserDefinedMetadata=function(t){_P(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e}(_1e);oo.className="Model";F.serialization.registerClass(oo);var K4=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(oo);K4.className="Functional";F.serialization.registerClass(K4);function G1e(r,e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:return"modelTopology"in r||(r={modelTopology:r}),r=r,t=r.modelTopology,t.model_config!=null&&(t=t.model_config),n=Mf(t),a=pi(n,e),r.weightsManifest==null?[3,2]:[4,F.io.loadWeights(r.weightsManifest,r.pathPrefix,a.weights.map(function(p){return p.originalName}))];case 1:i=h.sent(),o={};try{for(s=fe(a.weights),u=s.next();!u.done;u=s.next())c=u.value,o[c.originalName]=i[c.originalName]}catch(p){l={error:p}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(l)throw l.error}}a.loadWeights(o),F.dispose(i),h.label=2;case 2:return[2,a]}})})}function H1e(r,e){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(n){if(e==null&&(e={}),typeof r=="string"){if(t=F.io.getLoadHandlers(r,e),t.length===0)t.push(F.io.browserHTTPRequest(r,e));else if(t.length>1)throw new Z("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat(r,"'"));r=t[0]}return[2,K1e(r,void 0,e)]})})}function K1e(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:if(t==null&&(t={}),r.load==null)throw new Z("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,r.load()];case 1:if(n=h.sent(),a=n.modelTopology,a.model_config!=null&&(a=a.model_config),i=t.strict==null?!0:t.strict,o=n.weightData!=null&&n.weightSpecs!=null&&i,s=pi(Mf(a),e,o),u=n.trainingConfig,u!=null&&s.loadTrainingConfig(u),n.userDefinedMetadata!=null&&s.setUserDefinedMetadata(n.userDefinedMetadata),n.weightData==null)return[3,4];if(n.weightSpecs==null)throw new Z("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return c=j1e(n.weightData,n.weightSpecs),l=c.modelWeights,f=c.optimizerWeights,s.loadWeights(l,i),s.optimizer!=null&&f.length>0?[4,s.optimizer.setWeights(f)]:[3,3];case 2:h.sent(),h.label=3;case 3:F.dispose(l),F.dispose(f.map(function(p){return p.tensor})),h.label=4;case 4:return[2,s]}})})}function j1e(r,e){var t=F.io.decodeWeights(r,e),n={},a=[];return e.forEach(function(i){i.group==="optimizer"?a.push({name:i.name,tensor:t[i.name]}):n[i.name]=t[i.name]}),{modelWeights:n,optimizerWeights:a}}var dv=function(r){oe(e,r);function e(t){var n,a,i=r.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},i.trainable=!0,i.built=!1,i.name=t.name!=null?t.name:Jd("sequential_"),t.layers!=null)try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next()){var u=s.value;i.add(u)}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}return e.prototype.checkShape=function(t){var n=t.inboundNodes[0].outputTensors[0].shape;if(n.some(function(a){return a<0}))throw new Z("Negative dimension size caused by adding layer "+"".concat(t.name," with input shape [")+"".concat(t.inboundNodes[0].inputTensors[0].shape,"]"))},e.prototype.add=function(t){var n=t instanceof e||t instanceof oo,a;if(n){if(a=t,a.outputs.length!==1)throw new Z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(a.inputs.length!==1)throw new Z("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new Z("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=tM({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=a.outputs,this.inputs=a.inputs;else{if(t.inboundNodes.length!==1)throw new Z("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(t.name," ")+"which has ".concat(t.inboundNodes.length," pre-existing inbound ")+"connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new Z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=eM(this.outputs[0])}this.inboundNodes=[],new sv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Gs(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,n){return this.model==null&&this.build(),this.model.call(t,n)},e.prototype.build=function(t){if(Ct(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new oo({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),r.prototype.countParams.call(this)},e.prototype.summary=function(t,n,a){a===void 0&&(a=console.log),this.built||this.build(),r.prototype.summary.call(this,t,n,a)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,n,a){if(a===void 0&&(a={}),!this.built)throw new Ri("The model needs to be compiled before being used.");return this.model.evaluate(t,n,a)},e.prototype.evaluateDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new Ri("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,n)]})})},e.prototype.predict=function(t,n){return n===void 0&&(n={}),this.model==null&&this.build(),this.model.predict(t,n)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!1,configurable:!0}),e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){return Ee(this,function(i){if(!this.built)throw new Ri("The model needs to be compiled before being used.");return[2,this.model.fit(t,n,a)]})})},e.prototype.fitDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new Ri("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,this.model.trainOnBatch(t,n)]})})},e.fromConfig=function(t,n,a,i){var o,s;i===void 0&&(i=!1);var u,c={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new Z("Legacy serialization format not supported yet.");u=n}else F.util.assert(n.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),u=n.layers,delete n.layers,c=n;var l=new t(c);if(!(l instanceof e))throw new vt("Sequential.fromConfig called on non-Sequential input: ".concat(l));try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var p=h.value,d=void 0,m=pi(p,d,i);i&&m.setFastWeightInitDuringBuild(!0),l.add(m)}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return l},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new Z("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new Z("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!1,configurable:!0}),e.prototype.getConfig=function(){var t,n,a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value,u={};u.className=s.getClassName(),u.config=s.getConfig(),a.push(u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return{name:this.name,layers:a}},e}(oo);dv.className="Sequential";F.serialization.registerClass(dv);function X1e(r){return new oo(r)}function Y1e(r){return new dv(r)}function j4(r){return tM(r)}function Z1e(r,e){Xb.registerCallbackConstructor(r,e)}var dn=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(F.serialization.Serializable),X4=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),ade(t,n)},e}(dn);X4.className="elu";F.serialization.registerClass(X4);var Y4=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.selu(t)},e}(dn);Y4.className="selu";F.serialization.registerClass(Y4);var Z4=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.relu(t)},e}(dn);Z4.className="relu";F.serialization.registerClass(Z4);var J4=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.minimum(6,A.relu(t))})},e}(dn);J4.className="relu6";F.serialization.registerClass(J4);var Q4=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return t},e}(dn);Q4.className="linear";F.serialization.registerClass(Q4);var eB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.sigmoid(t)},e}(dn);eB.className="sigmoid";F.serialization.registerClass(eB);var tB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return ode(t)},e}(dn);tB.className="hardSigmoid";F.serialization.registerClass(tB);var rB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.softplus(t)},e}(dn);rB.className="softplus";F.serialization.registerClass(rB);var nB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return ide(t)},e}(dn);nB.className="softsign";F.serialization.registerClass(nB);var aB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.tanh(t)},e}(dn);aB.className="tanh";F.serialization.registerClass(aB);var tw=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),A.softmax(t,n)},e}(dn);tw.className="softmax";F.serialization.registerClass(tw);var iB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),A.logSoftmax(t,n)},e}(dn);iB.className="logSoftmax";F.serialization.registerClass(iB);var oB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.tidy(function(){var n=Math.sqrt(2),a=A.mul(.5,A.add(1,A.erf(A.div(t,n))));return A.mul(t,a)})})},e}(dn);oB.className="gelu";F.serialization.registerClass(oB);var sB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.mul(.5,A.mul(t,A.add(1,A.tanh(A.mul(A.sqrt(A.div(2,Math.PI)),A.add(t,A.mul(.044715,A.pow(t,3))))))))})},e}(dn);sB.className="gelu_new";F.serialization.registerClass(sB);var uB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.mul(t,A.tanh(A.softplus(t)))})},e}(dn);uB.className="mish";F.serialization.registerClass(uB);var cB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),F.tidy(function(){return A.mul(A.sigmoid(A.mul(t,n)),t)})},e}(dn);cB.className="swish";F.serialization.registerClass(cB);function Zo(r){return r.getClassName()}function j0(r,e){return e===void 0&&(e={}),Lf(r,F.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function Jo(r){if(r==null){var e={};return e.className="linear",e.config={},j0(e)}if(typeof r=="string"){var e={};return e.className=r,e.config={},j0(e)}else return r instanceof dn?r:j0(r)}function rw(r){if(r!=null&&typeof r!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(r))}var lB=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(F.serialization.Serializable),Hf=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return rw(t),n.l1=t==null||t.l1==null?.01:t.l1,n.l2=t==null||t.l2==null?.01:t.l2,n.hasL1=n.l1!==0,n.hasL2=n.l2!==0,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=F.zeros([1]);return n.hasL1&&(a=F.add(a,F.sum(A.mul(n.l1,F.abs(t))))),n.hasL2&&(a=F.add(a,F.sum(A.mul(n.l2,$f(t))))),A.reshape(a,[])})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,n){return new t({l1:n.l1,l2:n.l2})},e}(lB);Hf.className="L1L2";F.serialization.registerClass(Hf);function J1e(r){return rw(r),new Hf({l1:r!=null?r.l1:null,l2:0})}function Q1e(r){return rw(r),new Hf({l2:r!=null?r.l2:null,l1:0})}var BP={l1l2:"L1L2"};function Ut(r){return pb(r)}function LP(r,e){return e===void 0&&(e={}),Lf(r,F.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function hr(r){if(r==null)return null;if(typeof r=="string"){var e=r in BP?BP[r]:r,t={className:e,config:{}};return LP(t)}else return r instanceof lB?r:LP(r)}var nw=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null&&(n.maxValue=t.maxValue),n}return e.prototype.call=function(t,n){t=it(t);var a=F.relu(t);return this.maxValue!=null&&(a=F.clipByValue(a,0,this.maxValue)),a},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);nw.className="ReLU";F.serialization.registerClass(nw);var aw=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_ALPHA=.3,t==null&&(t={}),n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=it(t);return F.leakyRelu(a,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);aw.className="LeakyReLU";F.serialization.registerClass(aw);var iw=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),n.supportsMasking=!0,n.alphaInitializer=lr(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=hr(t.alphaRegularizer),n.alphaConstraint=qr(t.alphaConstraint),t.sharedAxes==null)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")n.sharedAxes=[t.sharedAxes];else throw new Z("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(t.sharedAxes));return n}return e.prototype.build=function(t){var n,a;t=Ct(t);var i=t.slice(1);if(this.sharedAxes!=null)try{for(var o=fe(this.sharedAxes),s=o.next();!s.done;s=o.next()){var u=s.value;i[u-1]=1}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}this.alpha=this.addWeight("alpha",i,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var c={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)c[u]=t[u];this.inputSpec=[new Lr({ndim:t.length,axes:c})],this.built=!0},e.prototype.call=function(t,n){return t=it(t),F.prelu(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:br(this.alphaInitializer),alphaRegularizer:Ut(this.alphaRegularizer),alphaConstraint:Wr(this.alphaConstraint),sharedAxes:this.sharedAxes},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);iw.className="PReLU";F.serialization.registerClass(iw);var ow=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==n.DEFAULT_ALPHA)throw new vt("Non-default alpha value (".concat(t.alpha,") is not supported by the ")+"ELU layer yet.");return n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=it(t);return F.elu(a)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);ow.className="ELU";F.serialization.registerClass(ow);var sw=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_THETA=1,t==null&&(t={}),n.theta=t.theta==null?n.DEFAULT_THETA:t.theta,n}return e.prototype.call=function(t,n){var a=it(t);return F.mul(a,F.cast(F.greater(a,this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);sw.className="ThresholdedReLU";F.serialization.registerClass(sw);var uw=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_AXIS=1,t==null&&(t={}),n.softmax=new tw().apply,n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=it(t),o=n.mask;if(o!=null){var s=F.mul(F.sub(F.ones(i.shape),F.cast(o,i.dtype)),F.scalar(-1e9));i=F.add(i,s)}return a.axis instanceof Array?a.axis.length>1?F.exp(F.sub(i,F.logSumExp(i,a.axis,!0))):a.softmax(i,a.axis[0]):a.softmax(i,a.axis)})},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);uw.className="Softmax";F.serialization.registerClass(uw);function gc(r,e,t){if(typeof r=="number")return Gs(r,e);if(r.length!==e)throw new Z("The ".concat(t," argument must be an integer or tuple of ").concat(e," integers.")+" Received: ".concat(r.length," elements."));for(var n=0;n<e;++n){var a=r[n];if(!ede(a))throw new Z("The ".concat(t," argument must be an integer or tuple of ").concat(e)+" integers. Received: ".concat(JSON.stringify(r)," including a")+" non-integer number ".concat(a))}return r}function di(r,e,t,n,a){if(a===void 0&&(a=1),r==null)return r;var i=e+(e-1)*(a-1),o;return t==="same"?o=r:o=r-i+1,Math.floor((o+n-1)/n)}function Fi(r,e,t,n){if(r==null)return null;if(n==="valid")r=r*e+Yo([t-e,0]);else if(n==="same")r=r*e;else throw new Z("Unsupport padding mode: ".concat(n,"."));return r}function cw(r,e){return F.tidy(function(){return Ar(e),e==="channelsFirst"?A.transpose(r,[0,2,3,1]):r})}function fB(r,e){return F.tidy(function(){return Ar(e),e==="channelsFirst"?A.transpose(r,[0,2,3,4,1]):r})}function exe(r,e,t,n,a,i,o){return n===void 0&&(n=1),a===void 0&&(a="valid"),o===void 0&&(o=1),F.tidy(function(){if(i==null&&(i=mi()),Ar(i),r.shape.length!==3)throw new Z("The input of a conv1dWithBias operation should be 3, but is "+"".concat(r.shape.length," instead."));if(e.shape.length!==3)throw new Z("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead"));if(t!=null&&t.shape.length!==1)throw new Z("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if(i==="channelsFirst"&&(r=A.transpose(r,[0,2,1])),a==="causal")throw new vt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=A.conv1d(r,e,n,a==="same"?"same":"valid","NWC",o);return t!=null&&(s=bi(s,t)),s})}function zP(r,e,t,n,a,i,o,s){return n===void 0&&(n=[1,1]),a===void 0&&(a="valid"),s===void 0&&(s=null),F.tidy(function(){if(i==null&&(i=mi()),Ar(i),r.rank!==3&&r.rank!==4)throw new Z("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(r.rank,"."));if(e.rank!==3&&e.rank!==4)throw new Z("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(r.rank,"."));var u=cw(r,i);if(a==="causal")throw new vt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=A.fused.conv2d({x:u,filter:e,strides:n,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:s}),i==="channelsFirst"&&(u=A.transpose(u,[0,3,1,2])),u})}function txe(r,e,t,n,a,i,o){return n===void 0&&(n=[1,1,1]),a===void 0&&(a="valid"),F.tidy(function(){if(i==null&&(i=mi()),Ar(i),r.rank!==4&&r.rank!==5)throw new Z("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(r.rank,"."));if(e.rank!==4&&e.rank!==5)throw new Z("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(r.rank,"."));var s=fB(r,i);if(a==="causal")throw new vt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=A.conv3d(s,e,n,a==="same"?"same":"valid","NDHWC",o),t!=null&&(s=bi(s,t)),i==="channelsFirst"&&(s=A.transpose(s,[0,4,1,2,3])),s})}var hB=function(r){oe(e,r);function e(t,n){var a=r.call(this,n)||this;if(a.bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(n),a.rank=t,Yr(a.rank,"rank"),a.rank!==1&&a.rank!==2&&a.rank!==3)throw new vt("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=gc(n.kernelSize,t,"kernelSize"),a.strides=gc(n.strides==null?1:n.strides,t,"strides"),a.padding=n.padding==null?"valid":n.padding,ya(a.padding),a.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Ar(a.dataFormat),a.activation=Jo(n.activation),a.useBias=n.useBias==null?!0:n.useBias,a.biasInitializer=lr(n.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=qr(n.biasConstraint),a.biasRegularizer=hr(n.biasRegularizer),a.activityRegularizer=hr(n.activityRegularizer),a.dilationRate=gc(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),a.rank===1&&Array.isArray(a.dilationRate)&&a.dilationRate.length!==1)throw new Z("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(a.rank===2){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==2)throw new Z("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(a.rank===3){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==3)throw new Z("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}return a}return e.verifyArgs=function(t){if(_i("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!db(t.kernelSize,"number",1,3))throw new Z("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(t.kernelSize),"."))},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Zo(this.activation),useBias:this.useBias,biasInitializer:br(this.biasInitializer),biasRegularizer:Ut(this.biasRegularizer),activityRegularizer:Ut(this.activityRegularizer),biasConstraint:Wr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),vv=function(r){oe(e,r);function e(t,n){var a=r.call(this,t,n)||this;return a.kernel=null,e.verifyArgs(n),a.filters=n.filters,Yr(a.filters,"filters"),a.kernelInitializer=lr(n.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=qr(n.kernelConstraint),a.kernelRegularizer=hr(n.kernelRegularizer),a}return e.prototype.build=function(t){var n;t=Ct(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[a]=i,n)}],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t);var i,o=a.bias==null?null:a.bias.read(),s=GP(a.activation.getClassName());if(s!=null&&a.rank===2)i=zP(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate,s);else{if(a.rank===1)i=exe(t,a.kernel.read(),o,a.strides[0],a.padding,a.dataFormat,a.dilationRate[0]);else if(a.rank===2)i=zP(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else if(a.rank===3)i=txe(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else throw new vt("convolutions greater than 3D are not implemented yet.");a.activation!=null&&(i=a.activation.apply(i))}return i})},e.prototype.computeOutputShape=function(t){t=Ct(t);for(var n=[],a=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),i=0;i<a.length;++i){var o=di(a[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}var s=[t[0]];return this.dataFormat==="channelsLast"?(s=s.concat(n),s.push(this.filters)):(s.push(this.filters),s=s.concat(n)),s},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:br(this.kernelInitializer),kernelRegularizer:Ut(this.kernelRegularizer),kernelConstraint:Wr(this.kernelConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new Z("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(t.filters)))},e}(hB),mv=function(r){oe(e,r);function e(t){var n=r.call(this,2,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!db(t.kernelSize,"number",1,2))throw new Z("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(vv);mv.className="Conv2D";F.serialization.registerClass(mv);var gv=function(r){oe(e,r);function e(t){var n=r.call(this,3,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new Z("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(vv);gv.className="Conv3D";F.serialization.registerClass(gv);var lw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Lr({ndim:4})],n.padding!=="same"&&n.padding!=="valid")throw new Z("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(n.padding));return n}return e.prototype.build=function(t){var n;if(t=Ct(t),t.length!==4)throw new Z("Input should have rank 4; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Lr({ndim:4,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){var i=it(t);if(i.shape.length!==4)throw new Z("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c;a.dataFormat==="channelsFirst"?(u=2,c=3):(u=1,c=2);var l=o[u],f=o[c],h=a.kernelSize[0],p=a.kernelSize[1],d=a.strides[0],m=a.strides[1],v=Fi(l,d,h,a.padding),g=Fi(f,m,p,a.padding),y=[s,v,g,a.filters];a.dataFormat!=="channelsLast"&&(i=A.transpose(i,[0,2,3,1]));var w=A.conv2dTranspose(i,a.kernel.read(),y,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(w=A.transpose(w,[0,3,1,2])),a.bias!=null&&(w=bi(w,a.bias.read(),a.dataFormat)),a.activation!=null&&(w=a.activation.apply(w)),w})},e.prototype.computeOutputShape=function(t){t=Ct(t);var n=t.slice(),a,i,o;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3):(a=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return n[a]=this.filters,n[i]=Fi(n[i],c,s,this.padding),n[o]=Fi(n[o],l,u,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(mv);lw.className="Conv2DTranspose";F.serialization.registerClass(lw);var fw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Lr({ndim:5})],n.padding!=="same"&&n.padding!=="valid")throw new Z("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(n.padding));return n}return e.prototype.build=function(t){var n;if(t=Ct(t),t.length!==5)throw new Z("Input should have rank 5; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Lr({ndim:5,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){var i=it(t);if(i.shape.length!==5)throw new Z("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c,l;a.dataFormat==="channelsFirst"?(l=2,u=3,c=4):(l=1,u=2,c=3);var f=o[l],h=o[u],p=o[c],d=a.kernelSize[0],m=a.kernelSize[1],v=a.kernelSize[2],g=a.strides[0],y=a.strides[1],w=a.strides[2],b=Fi(f,g,d,a.padding),x=Fi(h,y,m,a.padding),S=Fi(p,w,v,a.padding),T=[s,b,x,S,a.filters];a.dataFormat!=="channelsLast"&&(i=A.transpose(i,[0,2,3,4,1]));var E=A.conv3dTranspose(i,a.kernel.read(),T,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(E=A.transpose(E,[0,4,1,2,3])),a.bias!==null&&(E=bi(E,a.bias.read(),a.dataFormat)),a.activation!==null&&(E=a.activation.apply(E)),E})},e.prototype.computeOutputShape=function(t){t=Ct(t);var n=t.slice(),a,i,o,s;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3,s=4):(a=4,i=1,o=2,s=3);var u=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],f=this.strides[0],h=this.strides[1],p=this.strides[2];return n[a]=this.filters,n[i]=Fi(n[i],f,u,this.padding),n[o]=Fi(n[o],h,c,this.padding),n[s]=Fi(n[s],p,l,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(gv);fw.className="Conv3DTranspose";F.serialization.registerClass(fw);var pB=function(r){oe(e,r);function e(t,n){var a=r.call(this,t,n)||this;if(a.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,n.filters==null)throw new Z("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new Z("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new Z("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(n.padding)));return a.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,a.depthwiseInitializer=lr(n.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=hr(n.depthwiseRegularizer),a.depthwiseConstraint=qr(n.depthwiseConstraint),a.pointwiseInitializer=lr(n.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=hr(n.pointwiseRegularizer),a.pointwiseConstraint=qr(n.pointwiseConstraint),a}return e.prototype.build=function(t){var n;if(t=Ct(t),t.length<this.rank+2)throw new Z("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(t)));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null||t[a]<0)throw new Z("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(t[a])));for(var i=t[a],o=this.kernelSize.concat([i,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(i*this.depthMultiplier,this.filters);var c=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,c,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,c,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,c,this.biasConstraint):this.bias=null,this.inputSpec=[new Lr({ndim:this.rank+2,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t);var i;if(a.rank===1)throw new vt("1D separable convolution is not implemented yet.");return a.rank===2&&(a.dataFormat==="channelsFirst"&&(t=A.transpose(t,[0,2,3,1])),i=A.separableConv2d(t,a.depthwiseKernel.read(),a.pointwiseKernel.read(),a.strides,a.padding,a.dilationRate,"NHWC")),a.useBias&&(i=bi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),a.dataFormat==="channelsFirst"&&(i=A.transpose(i,[0,3,1,2])),i})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=br(this.depthwiseInitializer),t.pointwiseInitializer=br(this.pointwiseInitializer),t.depthwiseRegularizer=Ut(this.depthwiseRegularizer),t.pointwiseRegularizer=Ut(this.pointwiseRegularizer),t.depthwiseConstraint=Wr(this.depthwiseConstraint),t.pointwiseConstraint=Wr(this.pointwiseConstraint),t},e}(vv);pB.className="SeparableConv";var hw=function(r){oe(e,r);function e(t){return r.call(this,2,t)||this}return e}(pB);hw.className="SeparableConv2D";F.serialization.registerClass(hw);var pw=function(r){oe(e,r);function e(t){var n=r.call(this,1,t)||this;return e.verifyArgs(t),n.inputSpec=[{ndim:3}],n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!db(t.kernelSize,"number",1,1))throw new Z("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(vv);pw.className="Conv1D";F.serialization.registerClass(pw);var dw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return typeof t.cropping=="number"?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=it(t),a.dataFormat==="channelsLast"){var i=Id(t,a.cropping[0][0],t.shape[1]-a.cropping[0][0]-a.cropping[0][1],2);return Id(i,a.cropping[1][0],t.shape[2]-a.cropping[1][1]-a.cropping[1][0],3)}else{var i=Id(t,a.cropping[0][0],t.shape[2]-a.cropping[0][0]-a.cropping[0][1],3);return Id(i,a.cropping[1][0],t.shape[3]-a.cropping[1][1]-a.cropping[1][0],4)}})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);dw.className="Cropping2D";F.serialization.registerClass(dw);var vw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=t.size==null?n.DEFAULT_SIZE:t.size,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ar(n.dataFormat),n.interpolation=t.interpolation==null?"nearest":t.interpolation,Zpe(n.interpolation),n}return e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var n=t[2]==null?null:this.size[0]*t[2],a=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,a]}else{var n=t[1]==null?null:this.size[0]*t[1],a=t[2]==null?null:this.size[1]*t[2];return[t[0],n,a,t[3]]}},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){var i=it(t),o=i.shape;if(a.dataFormat==="channelsFirst"){i=A.transpose(i,[0,2,3,1]);var s=a.size[0]*o[2],u=a.size[1]*o[3],c=a.interpolation==="nearest"?A.image.resizeNearestNeighbor(i,[s,u]):A.image.resizeBilinear(i,[s,u]);return A.transpose(c,[0,3,1,2])}else{var s=a.size[0]*o[1],u=a.size[1]*o[2];return a.interpolation==="nearest"?A.image.resizeNearestNeighbor(i,[s,u]):A.image.resizeBilinear(i,[s,u])}})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);vw.className="UpSampling2D";F.serialization.registerClass(vw);function rxe(r,e,t,n,a,i){return t===void 0&&(t=[1,1]),n===void 0&&(n="valid"),F.tidy(function(){a==null&&(a=mi()),Ar(a);var o=cw(r,a);if(r.rank!==4)throw new Z("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(r.rank,"-D"));if(e.rank!==4)throw new Z("depthwiseKernel is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));return o=A.depthwiseConv2d(o,e,t,n==="same"?"same":"valid","NHWC",i),a==="channelsFirst"&&(o=A.transpose(o,[0,3,1,2])),o})}var mw=function(r){oe(e,r);function e(t){var n=r.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,n.depthwiseInitializer=lr(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=qr(t.depthwiseConstraint),n.depthwiseRegularizer=hr(t.depthwiseRegularizer),n}return e.prototype.build=function(t){if(t=Ct(t),t.length<4)throw new Z("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(t),"."));var n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new Z("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(t[n],")."));var a=t[n],i=[this.kernelSize[0],this.kernelSize[1],a,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[a*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t);var i=rxe(t,a.depthwiseKernel.read(),a.strides,a.padding,a.dataFormat,null);return a.useBias&&(i=bi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),i})},e.prototype.computeOutputShape=function(t){t=Ct(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=di(n,this.kernelSize[0],this.padding,this.strides[0]),s=di(a,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,s]:[t[0],o,s,i]},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=br(this.depthwiseInitializer),t.depthwiseRegularizer=Ut(this.depthwiseRegularizer),t.depthwiseConstraint=Wr(this.depthwiseRegularizer),t},e}(hB);mw.className="DepthwiseConv2D";F.serialization.registerClass(mw);function dB(r,e,t,n){if(Array.isArray(r)){if(e!=null||t!=null)throw new Z("When inputs is an array, neither initialState or constants should be provided");n!=null&&(t=r.slice(r.length-n,r.length),r=r.slice(0,r.length-n)),r.length>1&&(e=r.slice(1,r.length)),r=r[0]}function a(i){return i==null||Array.isArray(i)?i:[i]}return e=a(e),t=a(t),{inputs:r,initialState:e,constants:t}}function vB(r,e,t,n,a,i,o,s){return n===void 0&&(n=!1),o===void 0&&(o=!1),s===void 0&&(s=!1),A.tidy(function(){var u=e.shape.length;if(u<3)throw new Z("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(vi(2,u));if(e=A.transpose(e,c),i!=null)throw new vt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=A.cast(A.cast(a,"bool"),"float32"),a.rank===u-1&&(a=A.expandDims(a,-1)),a=A.transpose(a,c)),n&&(e=A.reverse(e,0),a!=null&&(a=A.reverse(a,0)));var l=[],f,h=t,p=e.shape[0],d=A.unstack(e),m;a!=null&&(m=A.unstack(a));for(var v=function(b){var x=d[b],S=A.tidy(function(){return r(x,h)});if(a==null)f=S[0],h=S[1];else{var T=A.tidy(function(){var E=m[b],C=A.sub(A.onesLike(E),E),R=A.add(A.mul(S[0],E),A.mul(h[0],C)),_=h.map(function(P,$){return A.add(A.mul(S[1][$],E),A.mul(P,C))});return{output:R,newStates:_}});f=T.output,h=T.newStates}s&&l.push(f)},g=0;g<p;++g)v(g);var y;if(s){var w=1;y=A.stack(l,w)}return[f,y,h]})}var so=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this,a;if(t.cell==null)throw new Z("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?a=new wv({cells:t.cell}):a=t.cell,a.stateSize==null)throw new Z("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return n.cell=a,n.returnSequences=t.returnSequences==null?!1:t.returnSequences,n.returnState=t.returnState==null?!1:t.returnState,n.goBackwards=t.goBackwards==null?!1:t.goBackwards,n._stateful=t.stateful==null?!1:t.stateful,n.unroll=t.unroll==null?!1:t.unroll,n.supportsMasking=!0,n.inputSpec=[new Lr({ndim:3})],n.stateSpec=null,n.states_=null,n.numConstants=null,n.keptStates=[],n}return e.prototype.getStates=function(){if(this.states_==null){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return vi(0,t).map(function(n){return null})}else return this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){var n,a;Q0(t)&&(t=t[0]),t=t;var i=this.cell.stateSize;Array.isArray(i)||(i=[i]);var o=i[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){var u=[];try{for(var c=fe(i),l=c.next();!l.done;l=c.next()){var f=l.value;u.push([t[0],f])}}catch(h){n={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return[s].concat(u)}else return s},e.prototype.computeMask=function(t,n){var a=this;return A.tidy(function(){Array.isArray(n)&&(n=n[0]);var i=a.returnSequences?n:null;if(a.returnState){var o=a.states.map(function(s){return null});return[i].concat(o)}else return i})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[],a=0;a<t;++a)n.push(null);return n}else return this.states_},set:function(t){this.states_=t},enumerable:!1,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new vt("Constants support is not implemented in RNN yet.");Q0(t)&&(t=t[0]),t=t;var n=this.stateful?t[0]:null,a=t.slice(2);this.inputSpec[0]=new Lr({shape:Je([n,null],te(a),!1)});var i=[t[0]].concat(t.slice(2));this.cell.build(i);var o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!F.util.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new Z("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=o.map(function(s){return new Lr({shape:[null,s]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),F.tidy(function(){if(!a.stateful)throw new Ko("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape[0];if(i==null)throw new Z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.states_==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return A.zeros([i,l])}):a.states_=[A.zeros([i,a.cell.stateSize])];else if(t==null)A.dispose(a.states_),a.keptStates!=null&&(A.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return A.zeros([i,l])}):a.states_[0]=A.zeros([i,a.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new Z("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));n===!0?a.keptStates.push(a.states_.slice()):A.dispose(a.states_);for(var o=0;o<a.states_.length;++o){var s=t[o],u=Array.isArray(a.cell.stateSize)?a.cell.stateSize[o]:a.cell.stateSize,c=[i,u];if(!F.util.arraysEqual(s.shape,c))throw new Z("State ".concat(o," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(c,", received shape=").concat(s.shape));a.states_[o]=s}}a.states_=a.states_.map(function(l){return A.keep(l.clone())})})},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=dB(t,o,s,this.numConstants);t=u.inputs,o=u.initialState,s=u.constants;var c=[],l=[];if(o!=null){n.initialState=o,c=c.concat(o),this.stateSpec=[];try{for(var f=fe(o),h=f.next();!h.done;h=f.next()){var p=h.value;this.stateSpec.push(new Lr({shape:p.shape}))}}catch(w){a={error:w}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}l=l.concat(this.stateSpec)}s!=null&&(n.constants=s,c=c.concat(s),this.numConstants=s.length);var d=c[0]instanceof gi;if(d){var m=[t].concat(c),v=this.inputSpec.concat(l),g=this.inputSpec;this.inputSpec=v;var y=r.prototype.apply.call(this,m,n);return this.inputSpec=g,y}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;t=it(t),s==null&&(a.stateful?s=a.states_:s=a.getInitialState(t));var u=Array.isArray(a.cell.stateSize)?a.cell.stateSize.length:1;if(s.length!==u)throw new Z("RNN Layer has ".concat(u," state(s) but was passed ")+"".concat(s.length," initial state(s)."));a.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var c={training:o},l=function(v,g){var y=a.cell.call([v].concat(g),c);return[y[0],y.slice(1)]},f=vB(l,t,s,a.goBackwards,i,null,a.unroll,a.returnSequences),h=f[0],p=f[1],d=f[2];a.stateful&&a.resetStates(d,o);var m=a.returnSequences?p:h;return a.returnState?[m].concat(d):m})},e.prototype.getInitialState=function(t){var n=this;return F.tidy(function(){var a=A.zeros(t.shape);return a=A.sum(a,[1,2]),a=zf(a),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(i){return i>1?Z0(a,[1,i]):a}):n.cell.stateSize>1?[Z0(a,[1,n.cell.stateSize])]:[a]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);var a=this.cell.getConfig();return this.getClassName()===e.className&&(n.cell={className:this.cell.getClassName(),config:a}),Object.assign(Object.assign(Object.assign({},a),t),n)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.cell,o=pi(i,a);return new t(Object.assign(n,{cell:o}))},e}(mt);so.className="RNN";F.serialization.registerClass(so);var Tc=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(mt),yv=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,Yr(n.units,"units"),n.activation=Jo(t.activation==null?n.DEFAULT_ACTIVATION:t.activation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=lr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=lr(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=lr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=hr(t.kernelRegularizer),n.recurrentRegularizer=hr(t.recurrentRegularizer),n.biasRegularizer=hr(t.biasRegularizer),n.kernelConstraint=qr(t.kernelConstraint),n.recurrentConstraint=qr(t.recurrentConstraint),n.biasConstraint=qr(t.biasConstraint),n.dropout=yc([1,Yo([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=yc([1,Yo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=Ct(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=t,t.length!==2)throw new Z("SimpleRNNCell expects 2 input Tensors, got ".concat(t.length,"."));var i=t[1];t=t[0];var o=n.training==null?!1:n.training;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Qo({ones:function(){return A.onesLike(t)},rate:a.dropout,training:o,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Qo({ones:function(){return A.onesLike(i)},rate:a.recurrentDropout,training:o,dropoutFunc:a.dropoutFunc}));var s,u=a.dropoutMask,c=a.recurrentDropoutMask;u!=null?s=Pi(A.mul(t,u),a.kernel.read()):s=Pi(t,a.kernel.read()),a.bias!=null&&(s=bi(s,a.bias.read())),c!=null&&(i=A.mul(i,c));var l=A.add(s,Pi(i,a.recurrentKernel.read()));return a.activation!=null&&(l=a.activation.apply(l)),[l,l]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:Zo(this.activation),useBias:this.useBias,kernelInitializer:br(this.kernelInitializer),recurrentInitializer:br(this.recurrentInitializer),biasInitializer:br(this.biasInitializer),kernelRegularizer:Ut(this.kernelRegularizer),recurrentRegularizer:Ut(this.recurrentRegularizer),biasRegularizer:Ut(this.biasRegularizer),activityRegularizer:Ut(this.activityRegularizer),kernelConstraint:Wr(this.kernelConstraint),recurrentConstraint:Wr(this.recurrentConstraint),biasConstraint:Wr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)},e}(Tc);yv.className="SimpleRNNCell";F.serialization.registerClass(yv);var gw=function(r){oe(e,r);function e(t){return t.cell=new yv(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return new t(n)},e}(so);gw.className="SimpleRNN";F.serialization.registerClass(gw);var bv=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new Z("GRUCell does not support reset_after parameter set to true.");return n.units=t.units,Yr(n.units,"units"),n.activation=Jo(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Jo(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=lr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=lr(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=lr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=hr(t.kernelRegularizer),n.recurrentRegularizer=hr(t.recurrentRegularizer),n.biasRegularizer=hr(t.biasRegularizer),n.kernelConstraint=qr(t.kernelConstraint),n.recurrentConstraint=qr(t.recurrentConstraint),n.biasConstraint=qr(t.biasConstraint),n.dropout=yc([1,Yo([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=yc([1,Yo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=Ct(t);var n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=t,t.length!==2)throw new Z("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=n.training==null?!1:n.training,o=t[1];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Qo({ones:function(){return A.onesLike(t)},rate:a.dropout,training:i,count:3,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Qo({ones:function(){return A.onesLike(o)},rate:a.recurrentDropout,training:i,count:3,dropoutFunc:a.dropoutFunc}));var s=a.dropoutMask,u=a.recurrentDropoutMask,c,l,f;0<a.dropout&&a.dropout<1&&(t=A.mul(t,s[0]));var h=Pi(t,a.kernel.read());a.useBias&&(h=bi(h,a.bias.read())),0<a.recurrentDropout&&a.recurrentDropout<1&&(o=A.mul(o,u[0]));var p=a.recurrentKernel.read(),d=te(A.split(p,[2*a.units,a.units],p.rank-1),2),m=d[0],v=d[1],g=Pi(o,m),y=te(A.split(h,3,h.rank-1),3),w=y[0],b=y[1],x=y[2],S=te(A.split(g,2,g.rank-1),2),T=S[0],E=S[1];c=a.recurrentActivation.apply(A.add(w,T)),l=a.recurrentActivation.apply(A.add(b,E));var C=Pi(A.mul(l,o),v);f=a.activation.apply(A.add(x,C));var R=A.add(A.mul(c,o),A.mul(A.add(1,A.neg(c)),f));return[R,R]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:Zo(this.activation),recurrentActivation:Zo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:br(this.kernelInitializer),recurrentInitializer:br(this.recurrentInitializer),biasInitializer:br(this.biasInitializer),kernelRegularizer:Ut(this.kernelRegularizer),recurrentRegularizer:Ut(this.recurrentRegularizer),biasRegularizer:Ut(this.biasRegularizer),activityRegularizer:Ut(this.activityRegularizer),kernelConstraint:Wr(this.kernelConstraint),recurrentConstraint:Wr(this.recurrentConstraint),biasConstraint:Wr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)},e}(Tc);bv.className="GRUCell";F.serialization.registerClass(bv);var yw=function(r){oe(e,r);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new bv(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e}(so);yw.className="GRU";F.serialization.registerClass(yw);var Kf=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,Yr(n.units,"units"),n.activation=Jo(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Jo(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=lr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=lr(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=lr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=hr(t.kernelRegularizer),n.recurrentRegularizer=hr(t.recurrentRegularizer),n.biasRegularizer=hr(t.biasRegularizer),n.kernelConstraint=qr(t.kernelConstraint),n.recurrentConstraint=qr(t.recurrentConstraint),n.biasConstraint=qr(t.biasConstraint),n.dropout=yc([1,Yo([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=yc([1,Yo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){var n;t=Ct(t);var a=t[t.length-1];this.kernel=this.addWeight("kernel",[a,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,s=this.units;i=new(n=function(u){oe(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.prototype.apply=function(l,f){var h=o.apply([s]),p=new ev().apply([s]),d=o.apply([s*2]);return UO(UO(h,p),d)},c}(Va),n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new Z("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var o=t[1],s=t[2];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Qo({ones:function(){return A.onesLike(t)},rate:a.dropout,training:i,count:4,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Qo({ones:function(){return A.onesLike(o)},rate:a.recurrentDropout,training:i,count:4,dropoutFunc:a.dropoutFunc}));var u=a.dropoutMask,c=a.recurrentDropoutMask,l,f,h,p;0<a.dropout&&a.dropout<1&&(t=A.mul(t,u[0]));var d=Pi(t,a.kernel.read());0<a.recurrentDropout&&a.recurrentDropout<1&&(o=A.mul(o,c[0])),d=A.add(d,Pi(o,a.recurrentKernel.read())),a.useBias&&(d=bi(d,a.bias.read()));var m=te(A.split(d,4,d.rank-1),4),v=m[0],g=m[1],y=m[2],w=m[3];l=a.recurrentActivation.apply(v),f=a.recurrentActivation.apply(g),h=A.add(A.mul(f,s),A.mul(l,a.activation.apply(y))),p=a.recurrentActivation.apply(w);var b=A.mul(p,a.activation.apply(h));return[b,b,h]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:Zo(this.activation),recurrentActivation:Zo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:br(this.kernelInitializer),recurrentInitializer:br(this.recurrentInitializer),biasInitializer:br(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ut(this.kernelRegularizer),recurrentRegularizer:Ut(this.recurrentRegularizer),biasRegularizer:Ut(this.biasRegularizer),activityRegularizer:Ut(this.activityRegularizer),kernelConstraint:Wr(this.kernelConstraint),recurrentConstraint:Wr(this.recurrentConstraint),biasConstraint:Wr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)},e}(Tc);Kf.className="LSTMCell";F.serialization.registerClass(Kf);var bw=function(r){oe(e,r);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Kf(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e}(so);bw.className="LSTM";F.serialization.registerClass(bw);var wv=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.cells=t.cells,n}return Object.defineProperty(e.prototype,"stateSize",{get:function(){var t,n,a=[];try{for(var i=fe(this.cells.slice().reverse()),o=i.next();!o.done;o=i.next()){var s=o.value;Array.isArray(s.stateSize)?a.push.apply(a,Je([],te(s.stateSize),!1)):a.push(s.stateSize)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i,o,s,u;t=t;var c=t.slice(1),l=[];try{for(var f=fe(a.cells.slice().reverse()),h=f.next();!h.done;h=f.next()){var p=h.value;Array.isArray(p.stateSize)?l.push(c.splice(0,p.stateSize.length)):l.push(c.splice(0,1))}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}l.reverse();for(var d=[],m,v=0;v<a.cells.length;++v){var p=a.cells[v];c=l[v],v===0?m=[t[0]].concat(c):m=[m[0]].concat(c),m=p.call(m,n),d.push(m.slice(1))}c=[];try{for(var g=fe(d.slice().reverse()),y=g.next();!y.done;y=g.next()){var w=y.value;c.push.apply(c,Je([],te(w),!1))}}catch(b){s={error:b}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}return[m[0]].concat(c)})},e.prototype.build=function(t){Q0(t)&&(t=t[0]),t=t;var n;this.cells.forEach(function(a,i){Us("RNNCell_".concat(i),function(){a.build(t),Array.isArray(a.stateSize)?n=a.stateSize[0]:n=a.stateSize,t=[t[0],n]})}),this.built=!0},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n=function(o){return{className:o.getClassName(),config:o.getConfig()}},a=this.cells.map(n),i={cells:a};return Object.assign(Object.assign({},t),i)},e.fromConfig=function(t,n,a){var i,o;a===void 0&&(a={});var s=[];try{for(var u=fe(n.cells),c=u.next();!c.done;c=u.next()){var l=c.value;s.push(pi(l,a))}}catch(f){i={error:f}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return new t({cells:s})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(!this.trainable)return[];var a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Je([],te(s.trainableWeights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=fe(this.cells),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Je([],te(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.cells),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Je([],te(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){var t,n,a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Je([],te(s.weights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return eb(a)},e.prototype.setWeights=function(t){var n,a,i=[];try{for(var o=fe(this.cells),s=o.next();!s.done;s=o.next())for(var u=s.value,c=u.weights.length,l=t.splice(c),f=0;f<u.weights.length;++f)i.push([u.weights[f],l[f]])}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}Sb(i)},e}(Tc);wv.className="StackedRNNCells";F.serialization.registerClass(wv);function Qo(r){var e=r.ones,t=r.rate,n=r.training,a=n===void 0?!1:n,i=r.count,o=i===void 0?1:i,s=r.dropoutFunc,u=function(){return s!=null?s(e(),t):JP(e(),t)},c=function(){return Wf(u,e,a)};if(!o||o<=1)return A.keep(c().clone());var l=Array(o).fill(void 0).map(c);return l.map(function(f){return A.keep(f.clone())})}var nxe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t};(function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(Tc);var mB=function(r){oe(e,r);function e(t){var n=this;if(t.unroll)throw new vt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new vt("It is not possible at the moment to stack convolutional cells.");return n=r.call(this,t)||this,n.inputSpec=[new Lr({ndim:5})],n}return e.prototype.call=function(t,n){var a=this;return A.tidy(function(){if(a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null),n&&n.constants)throw new Z("ConvRNN2D cell does not support constants");var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.prototype.computeOutputShape=function(t){var n=this.computeSingleOutputShape(t);return this.returnSequences||(n=Je([n[0]],te(n.slice(2)),!1)),this.returnState&&(n=Je([n],te(Array(2).fill(Je([t[0]],te(n.slice(-3)),!1))),!1)),n},e.prototype.getInitialState=function(t){var n=this;return A.tidy(function(){var a=n.cell.stateSize,i=t.shape,o=n.computeSingleOutputShape(i),s=Je([o[0]],te(o.slice(2)),!1),u=A.zeros(s);return Array.isArray(a)?Array(a.length).fill(u):[u]})},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),A.tidy(function(){if(!a.stateful)throw new Ko("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape,o=a.computeSingleOutputShape(i),s=Je([o[0]],te(o.slice(2)),!1),u=i[0];if(u==null)throw new Z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.getStates()==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return A.zeros(s)}):a.states_=[A.zeros(s)];else if(t==null)A.dispose(a.states_),a.keptStates!=null&&(A.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return A.zeros(s)}):a.states_[0]=A.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new Z("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));n?a.keptStates.push(a.states_.slice()):A.dispose(a.states_);for(var c=0;c<a.states_.length;++c){var l=t[c],f=s;if(!F.util.arraysEqual(l.shape,f))throw new Z("State ".concat(c," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(f,", received shape=").concat(l.shape));a.states_[c]=l}}a.states_=a.states_.map(function(h){return A.keep(h.clone())})})},e.prototype.computeSingleOutputShape=function(t){var n=this.cell,a=n.dataFormat,i=n.filters,o=n.kernelSize,s=n.padding,u=n.strides,c=n.dilationRate,l=a==="channelsFirst",f=t[l?3:2],h=t[l?4:3],p=di(f,o[0],s,u[0],c[0]),d=di(h,o[1],s,u[1],c[1]),m=Je(Je([],te(t.slice(0,2)),!1),te(l?[i,p,d]:[p,d,i]),!1);return m},e}(so);mB.className="ConvRNN2D";var xv=function(r){oe(e,r);function e(t){var n=this,a=t.filters,i=t.kernelSize,o=t.strides,s=t.padding,u=t.dataFormat,c=t.dilationRate;return n=r.call(this,Object.assign(Object.assign({},t),{units:a}))||this,n.filters=a,Yr(n.filters,"filters"),n.kernelSize=gc(i,2,"kernelSize"),n.kernelSize.forEach(function(l){return Yr(l,"kernelSize")}),n.strides=gc(o||1,2,"strides"),n.strides.forEach(function(l){return Yr(l,"strides")}),n.padding=s||"valid",ya(n.padding),n.dataFormat=u||"channelsLast",Ar(n.dataFormat),n.dilationRate=gc(c||1,2,"dilationRate"),n.dilationRate.forEach(function(l){return Yr(l,"dilationRate")}),n}return e.prototype.build=function(t){var n;t=Ct(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=4,s=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var u=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var c=void 0;if(this.unitForgetBias){var l=this.biasInitializer,f=this.filters;c=new(n=function(h){oe(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.prototype.apply=function(d,m){var v=l.apply([f]),g=A.ones([f]),y=l.apply([f*2]);return vb([v,g,y])},p}(Va),n.className="CustomInit",n)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){if(t.length!==3)throw new Z("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=n.training||!1,o=t[0],s=t[1],u=t[2],c=4;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Qo({ones:function(){return A.onesLike(o)},rate:a.dropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var l=a.dropoutMask,f=function(le,de,ke){return!de||!de[ke]?le:A.mul(de[ke],le)},h=f(o,l,0),p=f(o,l,1),d=f(o,l,2),m=f(o,l,3);0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Qo({ones:function(){return A.onesLike(s)},rate:a.recurrentDropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var v=a.recurrentDropoutMask,g=f(s,v,0),y=f(s,v,1),w=f(s,v,2),b=f(s,v,3),x=3,S=te(A.split(a.kernel.read(),c,x),4),T=S[0],E=S[1],C=S[2],R=S[3],_=te(a.useBias?A.split(a.bias.read(),c):[null,null,null,null],4),P=_[0],$=_[1],z=_[2],L=_[3];h=a.inputConv(h,T,P,a.padding),p=a.inputConv(p,E,$,a.padding),d=a.inputConv(d,C,z,a.padding),m=a.inputConv(m,R,L,a.padding);var B=te(A.split(a.recurrentKernel.read(),c,x),4),q=B[0],Y=B[1],J=B[2],U=B[3];g=a.recurrentConv(g,q),y=a.recurrentConv(y,Y),w=a.recurrentConv(w,J),b=a.recurrentConv(b,U);var j=a.recurrentActivation.apply(A.add(h,g)),ne=a.recurrentActivation.apply(A.add(p,y)),re=A.add(A.mul(ne,u),A.mul(j,a.activation.apply(A.add(d,w)))),se=A.mul(a.recurrentActivation.apply(A.add(m,b)),a.activation.apply(re));return[se,se,re]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);t.units;var n=nxe(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),a)},e.prototype.inputConv=function(t,n,a,i){var o=A.conv2d(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return a?bi(o,a,this.dataFormat):o},e.prototype.recurrentConv=function(t,n){var a=1;return A.conv2d(t,n,a,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")},e}(Kf);xv.className="ConvLSTM2DCell";A.serialization.registerClass(xv);var ww=function(r){oe(e,r);function e(t){var n=new xv(t);return r.call(this,Object.assign(Object.assign({},t),{cell:n}))||this}return e.fromConfig=function(t,n){return new t(n)},e}(mB);ww.className="ConvLSTM2D";A.serialization.registerClass(ww);var kv=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var n=t.shape,a=[],i=0;i<this.noiseShape.length;++i)a.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return a},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);if(0<a.rate&&a.rate<1){var o=n.training==null?!1:n.training,s=a.getNoiseShape(i),u=Wf(function(){return JP(i,a.rate,s,a.seed)},function(){return i},o);return u}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.dispose=function(){return r.prototype.dispose.call(this)},e}(mt);kv.className="Dropout";F.serialization.registerClass(kv);var xw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[{ndim:3}],n}return e.prototype.getNoiseShape=function(t){var n=t.shape;return[n[0],1,n[2]]},e}(kv);xw.className="SpatialDropout1D";F.serialization.registerClass(xw);var kw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var a=null;t.batchSize!=null&&(a=t.batchSize),n.batchInputShape=[a,t.inputDim]}return n.units=t.units,Yr(n.units,"units"),n.activation=Jo(t.activation),t.useBias!=null&&(n.useBias=t.useBias),n.kernelInitializer=lr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=lr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=qr(t.kernelConstraint),n.biasConstraint=qr(t.biasConstraint),n.kernelRegularizer=hr(t.kernelRegularizer),n.biasRegularizer=hr(t.biasRegularizer),n.activityRegularizer=hr(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return e.prototype.build=function(t){var n;t=Ct(t);var a=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[a,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=a,n)}],this.built=!0},e.prototype.computeOutputShape=function(t){t=Ct(t);var n=t.slice();return n[n.length-1]=this.units,n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t),o=GP(a.activation.getClassName()),s;return o!=null?s=Pi(i,a.kernel.read(),o,a.bias?a.bias.read():null):(s=Pi(i,a.kernel.read()),a.bias!=null&&(s=bi(s,a.bias.read())),a.activation!=null&&(s=a.activation.apply(s))),s})},e.prototype.getConfig=function(){var t={units:this.units,activation:Zo(this.activation),useBias:this.useBias,kernelInitializer:br(this.kernelInitializer),biasInitializer:br(this.biasInitializer),kernelRegularizer:Ut(this.kernelRegularizer),biasRegularizer:Ut(this.biasRegularizer),activityRegularizer:Ut(this.activityRegularizer),kernelConstraint:Wr(this.kernelConstraint),biasConstraint:Wr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);kw.className="Dense";F.serialization.registerClass(kw);var Sw=function(r){oe(e,r);function e(t){var n=this;return t=t||{},n=r.call(this,t)||this,n.inputSpec=[{minNDim:3}],n.dataFormat=t.dataFormat,n}return e.prototype.computeOutputShape=function(t){var n,a;t=Ct(t);try{for(var i=fe(t.slice(1)),o=i.next();!o.done;o=i.next()){var s=o.value;if(s==null)throw new Z('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(t.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}return[t[0],Xo(t,1)]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);if(a.dataFormat==="channelsFirst"&&i.rank>1){for(var o=[0],s=2;s<i.rank;++s)o.push(s);o.push(1),i=F.transpose(i,o)}return nde(i)})},e.prototype.getConfig=function(){var t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);var n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Sw.className="Flatten";F.serialization.registerClass(Sw);var Nw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.activation=Jo(t.activation),n}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);return a.activation.apply(i)})},e.prototype.getConfig=function(){var t={activation:Zo(this.activation)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Nw.className="Activation";F.serialization.registerClass(Nw);var Tw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return t=it(t),tde(t,a.n)})},e.prototype.getConfig=function(){var t={n:this.n},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Tw.className="RepeatVector";F.serialization.registerClass(Tw);var Ew=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;n.targetShape=t.targetShape;for(var a=0;a<n.targetShape.length;++a)n.isUnknown(n.targetShape[a])&&(n.targetShape[a]=null);return n}return e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,n){for(var a="Total size of new array must be unchanged.",i=n.slice(),o=1,s=null,u=0;u<i.length;++u){var c=i[u];if(this.isUnknown(c))if(s===null)s=u;else throw new Z("Can only specifiy one unknown dimension.");else o*=c}var l=Xo(t);if(s!==null){if(o===0||l%o!==0)throw new Z(a);i[s]=l/o}else if(l!==o)throw new Z(a);return i},e.prototype.computeOutputShape=function(t){for(var n=!1,a=0;a<t.length;++a)if(this.isUnknown(t[a])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t),o=i.shape,s=o.slice(0,1).concat(a.fixUnknownDimension(o.slice(1),a.targetShape));return F.reshape(i,s)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Ew.className="Reshape";F.serialization.registerClass(Ew);var Iw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(t.dims," instead."));var a=vi(1,t.dims.length+1);if(!F.util.arraysEqual(t.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new Lr({ndim:n.dims.length+1})],n}return e.prototype.computeOutputShape=function(t){t=Ct(t);var n=t.slice();return this.dims.forEach(function(a,i){n[i+1]=t[a]}),n},e.prototype.call=function(t,n){return F.transpose(it(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Iw.className="Permute";F.serialization.registerClass(Iw);var Cw=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null?n.maskValue=t.maskValue==null?0:t.maskValue:n.maskValue=0,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},e.prototype.computeMask=function(t,n){var a=it(t),i=-1;return F.any(F.notEqual(a,this.maskValue),i)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t),o=-1,s=!0,u=F.any(F.notEqual(i,a.maskValue),o,s),c=F.mul(i,F.cast(u,i.dtype));return c})},e}(mt);Cw.className="Masking";F.serialization.registerClass(Cw);var Aw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var a=null;t.batchSize!=null&&(a=t.batchSize),t.inputLength==null?n.batchInputShape=[a,null]:n.batchInputShape=[a].concat(Pt(t.inputLength))}return n.inputDim=t.inputDim,Yr(n.inputDim,"inputDim"),n.outputDim=t.outputDim,Yr(n.outputDim,"outputDim"),n.embeddingsInitializer=lr(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=hr(t.embeddingsRegularizer),n.activityRegularizer=hr(t.activityRegularizer),n.embeddingsConstraint=qr(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,n){var a=this;return F.tidy(function(){return a.maskZero?(t=it(t),F.notEqual(t,F.zerosLike(t))):null})},e.prototype.computeOutputShape=function(t){if(t=Ct(t),this.inputLength==null)return Je(Je([],te(t),!1),[this.outputDim],!1);var n=Pt(this.inputLength);if(n.length!==t.length-1)throw new Z('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));for(var a=0,i=0;i<n.length;++i){var o=n[i],s=t[i+1];if(o!=null&&s!=null&&o!==s)throw new Z('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));o==null&&(n[a]=s),a++}return Je(Je([t[0]],te(n),!1),[this.outputDim],!1)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);i.dtype!=="int32"&&(i=Oi(i,"int32"));var o=ZP(a.embeddings.read(),F.reshape(i,[i.size]));return F.reshape(o,Ct(a.computeOutputShape(i.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:br(this.embeddingsInitializer),embeddingsRegularizer:Ut(this.embeddingsRegularizer),activityRegularizer:Ut(this.activityRegularizer),embeddingsConstraint:Wr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Aw.className="Embedding";F.serialization.registerClass(Aw);var tu=function(r){oe(e,r);function e(t){var n=r.call(this,t||{})||this;return n.supportsMasking=!0,n}return e.prototype.mergeFunction=function(t){throw new vt},e.prototype.computeElementwiseOpOutputShape=function(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;for(var a=t.slice(0,t.length-n.length),i=0;i<n.length;++i){var o=t[t.length-n.length+i],s=n[i];if(o==null||s==null||o<0||s<0)a.push(null);else if(o===1)a.push(s);else if(s===1)a.push(o);else{if(o!==s)throw new Z("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));a.push(o)}}return a},e.prototype.build=function(t){var n,a;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Ct(t)]),t=t,t.length<2)throw new Z("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(t.length," input(s)."));var i=[];try{for(var o=fe(t),s=o.next();!s.done;s=o.next()){var u=s.value;u!=null&&u[0]!==null&&i.push(u[0])}}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}if(i=jo(i),i.length>1)throw new Z("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(t),"."));for(var c=t[0]==null?null:t[0].slice(1),l=1;l<t.length;++l){var u=t[l]==null?null:t[l].slice(1);c=this.computeElementwiseOpOutputShape(c,u)}var f=t.map(function(h){return h.length});t.indexOf(null)===-1&&jo(f).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i,o,s,u;if(t=t,a.reshapeRequired){var c=[],l=t.map(function($){return $.rank});if(l.indexOf(null)===-1){var f=Yo(l);try{for(var h=fe(t),p=h.next();!p.done;p=h.next()){for(var d=p.value,m=d.rank,v=0;v<f-m;++v)d=zf(d,1);c.push(d)}}catch($){i={error:$}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a.mergeFunction(c)}else{var g=!1;try{for(var y=fe(t),w=y.next();!w.done;w=y.next()){var d=w.value,m=d.rank;if(m==null){var b=d.shape,x=b[0],S=b.slice(1).concat([x]),T=A.reshape(d,[x].concat(Xo(b.slice(1))));T=A.transpose(T,[1,0]),T=A.reshape(T,S),c.push(T),g=!0}else if(m>1){var E=vi(1,m).concat([0]);c.push(A.transpose(d,E)),g=!0}else c.push(d)}}catch($){s={error:$}}finally{try{w&&!w.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}var C=a.mergeFunction(c),R=C.rank;if(g){if(R==null){var _=C.shape,P=_.length,x=_[P-1],S=[x].concat(_.slice(0,_.length-1));C=A.reshape(A.transpose(A.reshape(C,[-1,x]),[1,0]),S)}else if(R>1){var E=[R-1].concat(vi(0,R-1));C=A.transpose(C,E)}}return C}}else return a.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var n,a;t=t;var i;t[0]==null?i=null:i=t[0].slice(1);for(var o=1;o<t.length;++o){var s=t[o]==null?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=[];try{for(var c=fe(t),l=c.next();!l.done;l=c.next()){var s=l.value;s!=null&&s[0]!==null&&u.push(s[0])}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return u=jo(u),u.length===1?i=u.concat(i):i=[null].concat(i),i},e.prototype.computeMask=function(t,n){return A.tidy(function(){if(n==null)return null;if(!Array.isArray(n))throw new Z("`mask` should be an Array");if(!Array.isArray(t))throw new Z("`inputs` should be an Array");if(n.length!==t.length)throw new Z("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(t.length," vs ").concat(n.length,")"));if(n.every(function(o){return o==null}))return null;n=n.map(function(o){return o==null?o:A.expandDims(o,0)});for(var a=n[0],i=1;i<n.length-1;++i)a=A.logicalAnd(a,n[i]);return a})},e}(mt),Dw=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=A.add(n,t[a]);return n})},e}(tu);Dw.className="Add";F.serialization.registerClass(Dw);var _w=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=A.mul(n,t[a]);return n})},e}(tu);_w.className="Multiply";F.serialization.registerClass(_w);var Fw=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=A.add(n,t[a]);return A.mul(1/t.length,n)})},e}(tu);Fw.className="Average";F.serialization.registerClass(Fw);var Rw=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=A.maximum(n,t[a]);return n})},e}(tu);Rw.className="Maximum";F.serialization.registerClass(Rw);var Ow=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=A.minimum(n,t[a]);return n})},e}(tu);Ow.className="Minimum";F.serialization.registerClass(Ow);var Pw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_AXIS=-1,t==null&&(t={}),n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){var n,a,i,o;if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new Z("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var s=!0;try{for(var u=fe(t),c=u.next();!c.done;c=u.next()){var l=c.value;if(l!=null){s=!1;break}}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}if(!s){for(var f=[],h=0;h<t.length;++h){var p=t[h].slice();p.splice(this.axis,1);var d=!1;try{for(var m=(i=void 0,fe(f)),v=m.next();!v.done;v=m.next()){var l=v.value;if(F.util.arraysEqual(l,p)){d=!0;break}}}catch(g){i={error:g}}finally{try{v&&!v.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}d||f.push(p)}if(f.length>1)throw new Z("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var n=this;return F.tidy(function(){return vb(t,n.axis)})},e.prototype.computeOutputShape=function(t){var n,a;if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new Z("A `Concatenate` layer should be called on a list of inputs.");var i=t,o=i[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;try{for(var u=fe(i.slice(1)),c=u.next();!c.done;c=u.next()){var l=c.value;if(o[s]==null||l[s]==null){o[s]=null;break}o[s]+=l[s]}}catch(f){n={error:f}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}return o},e.prototype.computeMask=function(t,n){var a=this;if(n==null)return null;if(!Array.isArray(n))throw new Z("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new Z("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new Z("Mismatch in the length of mask (".concat(n.length,") ")+"and the legnth of inputs (".concat(t.length,")"));return A.tidy(function(){var i=!0;if(n.forEach(function(c){if(c!=null){i=!1;return}}),i)return null;for(var o=[],s=0;s<t.length;++s)n[s]==null?o.push(A.cast(A.onesLike(t[s]),"bool")):n[s].rank<t[s].rank?o.push(A.expandDims(n[s],-1)):o.push(n[s]);var u=A.concat(o,a.axis);return A.all(u,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(tu);Pw.className="Concatenate";F.serialization.registerClass(Pw);function If(r,e){for(;r<0;)r+=e;return r}function axe(r,e,t){if(r.shape.length>3||e.shape.length>3)throw new vt("batchDot is not implemented for tensors of 4D or higher rank yet");if(A.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(r.shape.length)}),A.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(e.shape.length)}),typeof t=="number"&&(t=[t,t]),r.dtype==="complex64"||e.dtype==="complex64")throw new vt("batchDot is not implemented for complex64-type Tensors yet.");var n=r.shape.length,a=e.shape.length;t==null&&(t=[n-1,a-2]);var i=t;return A.tidy(function(){var o;if(n>a){o=n-a;for(var s=[],u=0;u<o;++u)s.push(1);e=A.reshape(e,e.shape.concat(s))}else if(a>n){o=a-n;for(var s=[],u=0;u<o;++u)s.push(1);r=A.reshape(r,r.shape.concat(s))}else o=0;var c;if(r.shape.length===2&&e.shape.length===2)i[0]===i[1]?c=A.sum(A.mul(r,e),i[0]):c=A.sum(A.mul(A.transpose(r,[1,0]),e),i[1]);else{var l=i[0]!==r.shape.length-1,f=i[1]===e.shape.length-1;c=A.matMul(r,e,l,f)}if(o>0){var h=void 0;n>a?h=n+a-3:h=n-1;for(var p=[],u=h;u<h+o;++u)p.push(u);c=A.squeeze(c,p)}return c.shape.length===1&&(c=A.expandDims(c,1)),c})}var Mw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.axes=t.axes,n.normalize=t.normalize==null?!1:t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){A.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0],a=t[1];if(n.length>3||a.length>3)throw new vt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);if(n[i[0]]!==a[i[1]])throw new Z("Dimension incompatibility: "+"".concat(n[i[0]]," !== ").concat(a[i[1]]))},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new Z("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(t.length," input(s)."));var n=t[0],a=t[1],i;return Array.isArray(this.axes)?i=this.axes.map(function(o,s){return If(o,t[s].shape.length)}):i=[If(this.axes,n.shape.length),If(this.axes,a.shape.length)],this.normalize&&(n=Kd(n,i[0]),a=Kd(a,i[1])),axe(n,a,i)},e.prototype.interpretAxes=function(t,n){var a;return Array.isArray(this.axes)?a=this.axes:a=[If(this.axes,t.length),If(this.axes,n.length)],a},e.prototype.computeOutputShape=function(t){A.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0].slice(),a=t[1].slice();if(n.length>3||a.length>3)throw new vt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);n.splice(i[0],1),a.splice(i[1],1),a.splice(0,1);var o=n.concat(a);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,n){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(tu);Mw.className="Dot";F.serialization.registerClass(Mw);var Bw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t),o=function(){return F.add(Qd(i.shape,0,a.stddev),i)},s=Wf(o,function(){return i},n.training||!1);return s})},e}(mt);Bw.className="GaussianNoise";F.serialization.registerClass(Bw);var Lw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);if(a.rate>0&&a.rate<1){var o=function(){var s=Math.sqrt(a.rate/(1-a.rate));return F.mul(i,Qd(i.shape,1,s))};return Wf(o,function(){return i},n.training||!1)}return i})},e}(mt);Lw.className="GaussianDropout";F.serialization.registerClass(Lw);var zw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return e.prototype._getNoiseShape=function(t){return this.noiseShape||it(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(a.rate<1&&a.rate>0){var i=a._getNoiseShape(t),o=function(){var s=it(t),u=1.6732632423543772,c=1.0507009873554805,l=-u*c,f=F.greaterEqual(F.randomUniform(i),a.rate);f=Oi(f,"float32");var h=Math.pow((1-a.rate)*(1+a.rate*Math.pow(l,2)),-.5),p=-h*l*a.rate,d=F.add(F.mul(s,f),F.mul(F.add(f,-1),l));return F.add(F.mul(d,h),p)};return Wf(o,function(){return it(t)},n.training||!1)}return t})},e}(mt);zw.className="AlphaDropout";F.serialization.registerClass(zw);function Bf(r,e,t,n,a,i){i===void 0&&(i=.001);var o;if(r.rank===2)o=A.batchNorm2d(r,e,t,n,a,i);else if(r.rank===3)o=A.batchNorm3d(r,e,t,n,a,i);else if(r.rank===4)o=A.batchNorm4d(r,e,t,n,a,i);else throw new vt("batchNormalization is not implemented for array of rank ".concat(r.rank," ")+"yet");return o}function ixe(r,e,t,n,a){return a===void 0&&(a=.001),F.tidy(function(){var i=A.moments(r,n),o=i.mean,s=i.variance,u=Bf(r,o,s,t,e,a);return[u,o,s]})}function oxe(r,e,t,n,a){return a===void 0&&(a=.001),F.tidy(function(){var i,o,s=A.moments(r,n),u=s.mean,c=s.variance,l=[];try{for(var f=fe(vi(0,r.rank)),h=f.next();!h.done;h=f.next()){var p=h.value;n.indexOf(p)!==-1?l.push(1):l.push(r.shape[p])}}catch(w){i={error:w}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}var d=F.reshape(u,l),m=F.reshape(c,l),v=e==null?null:F.reshape(e,l),g=t==null?null:F.reshape(t,l),y=Bf(r,d,m,g,v,a);return[y,u,c]})}function sxe(r,e,t,n,a){return a===void 0&&(a=.001),F.util.arraysEqual(n.slice().sort(),vi(0,r.rank-1))?ixe(r,e,t,n,a):oxe(r,e,t,n,a)}var $w=function(r){oe(e,r);function e(t){var n=this;return t==null&&(t={}),n=r.call(this,t)||this,n.supportsMasking=!0,n.axis=t.axis==null?-1:t.axis,n.momentum=t.momentum==null?.99:t.momentum,n.epsilon=t.epsilon==null?.001:t.epsilon,n.center=t.center==null?!0:t.center,n.scale=t.scale==null?!0:t.scale,n.betaInitializer=lr(t.betaInitializer||"zeros"),n.gammaInitializer=lr(t.gammaInitializer||"ones"),n.movingMeanInitializer=lr(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=lr(t.movingVarianceInitializer||"ones"),n.betaConstraint=qr(t.betaConstraint),n.gammaConstraint=qr(t.gammaConstraint),n.betaRegularizer=hr(t.betaRegularizer),n.gammaRegularizer=hr(t.gammaRegularizer),n}return e.prototype.build=function(t){var n;t=Ct(t);var a=this.axis>=0?this.axis:this.axis+t.length,i=t[a];if(i==null)throw new Z("Axis ".concat(a," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(t),"."));this.inputSpec=[new Lr({ndim:t.length,axes:(n={},n[a]=i,n)})];var o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.training==null?!1:n.training,o=it(t),s=o.shape,u=s.length,c=vi(0,u),l=a.axis>=0?a.axis:a.axis+u;c.splice(l,1);var f=Gs(1,u);f[l]=s[l];var h=c.slice();h.sort();var p=!F.util.arraysEqual(h,vi(0,u).slice(0,u-1)),d=function(){if(p){var x=F.reshape(a.movingMean.read(),f),S=F.reshape(a.movingVariance.read(),f),T=a.center?F.reshape(a.beta.read(),f):null,E=a.scale?F.reshape(a.gamma.read(),f):null;return Bf(o,x,S,T,E,a.epsilon)}else return Bf(o,a.movingMean.read(),a.movingVariance.read(),a.beta==null?null:a.beta.read(),a.gamma==null?null:a.gamma.read(),a.epsilon)};if(!i)return d();var m=te(sxe(o,a.gamma.read(),a.beta.read(),c,a.epsilon),3),v=m[0],g=m[1],y=m[2],w=function(x,S,T){A.tidy(function(){var E=1-T,C=x.read(),R=A.mul(A.sub(C,S),E);x.write(A.sub(C,R))})},b=function(){w(a.movingMean,g,a.momentum),w(a.movingVariance,y,a.momentum)};return b(),v})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:br(this.betaInitializer),gammaInitializer:br(this.gammaInitializer),movingMeanInitializer:br(this.movingMeanInitializer),movingVarianceInitializer:br(this.movingVarianceInitializer),betaRegularizer:Ut(this.betaRegularizer),gammaRegularizer:Ut(this.gammaRegularizer),betaConstraint:Wr(this.betaConstraint),gammaConstraint:Wr(this.gammaConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);$w.className="BatchNormalization";F.serialization.registerClass($w);var Ww=function(r){oe(e,r);function e(t){var n,a,i=this;if(t==null&&(t={}),i=r.call(this,t)||this,i.axis=t.axis==null?-1:t.axis,typeof i.axis=="number"){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received ".concat(i.axis))}else if(Array.isArray(i.axis))try{for(var o=fe(i.axis),s=o.next();!s.done;s=o.next()){var u=s.value;if(!Number.isInteger(u))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(i.axis)))}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}else throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(i.axis)));return i.epsilon=t.epsilon==null?.001:t.epsilon,i.center=t.center==null?!0:t.center,i.scale=t.scale==null?!0:t.scale,i.betaInitializer=lr(t.betaInitializer||"zeros"),i.gammaInitializer=lr(t.gammaInitializer||"ones"),i.betaRegularizer=hr(t.betaRegularizer),i.gammaRegularizer=hr(t.gammaRegularizer),i.supportsMasking=!0,i}return e.prototype.build=function(t){var n,a;t=Ct(t);var i=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=i);try{for(var s=fe(this.axis),u=s.next();!u.done;u=s.next()){var c=u.value;if(c<0||c>=i)throw new Error("Invalid axis: ".concat(c))}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(this.axis.length!==jo(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var l=this.axis.map(function(h){return t[h]}),f=!0;this.scale?this.gamma=this.addWeight("gamma",l,"float32",this.gammaInitializer,this.gammaRegularizer,f):this.gamma=null,this.center?this.beta=this.addWeight("beta",l,"float32",this.betaInitializer,this.betaRegularizer,f):this.beta=null,this.built=!0},e.prototype.call=function(t,n){var a=this,i=it(t),o=i.shape,s=o.length;return F.tidy(function(){var u,c,l=!0,f=F.moments(i,a.axis,l),h=f.mean,p=f.variance,d=Gs(1,s);try{for(var m=fe(a.axis),v=m.next();!v.done;v=m.next()){var g=v.value;d[g]=o[g]}}catch(E){u={error:E}}finally{try{v&&!v.done&&(c=m.return)&&c.call(m)}finally{if(u)throw u.error}}for(var y=function(E){return E!=null&&E.shape.length!==s?A.reshape(E,d):E},w=a.scale?y(a.gamma.read()):null,b=a.center?y(a.beta.read()):null,x=[],S=[],T=0;T<s;++T)a.axis.indexOf(T)!==-1?(x.push(o[T]),S.push(1)):(x.push(1),S.push(o[T]));return h=A.tile(h,x),p=A.tile(p,x),w!=null&&(w=A.tile(w,S)),b!=null&&(b=A.tile(b,S)),Bf(i,h,p,b,w,a.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:br(this.betaInitializer),gammaInitializer:br(this.gammaInitializer),betaRegularizer:Ut(this.betaRegularizer),gammaRegularizer:Ut(this.gammaRegularizer)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Ww.className="LayerNormalization";F.serialization.registerClass(Ww);function uxe(r,e,t){return F.tidy(function(){if(r.rank!==4)throw new Z("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(r.rank,"-D tensor."));if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new Z("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=mi()),t!=="channelsLast"&&t!=="channelsFirst")throw new Z("Unknown data format: ".concat(t,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var n;return t==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],A.pad(r,n)})}var qw=function(r){oe(e,r);function e(t){var n=this;if(t==null&&(t={}),n=r.call(this,t)||this,n.dataFormat=t.dataFormat==null?mi():t.dataFormat,t.padding==null)n.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new Z("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(t.padding.length," array."));var a=void 0,i=void 0;if(typeof t.padding[0]=="number")a=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new Z("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(t.padding[0].length," array."));if(a=t.padding[0],t.padding[1].length!==2)throw new Z("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(t.padding[1].length," array."));i=t.padding[1]}n.padding=[a,i]}return n.inputSpec=[new Lr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=Ct(t);var n,a;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?a=t[3]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],t[1],n,a]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?a=t[2]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],n,a,t[3]])},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return uxe(it(t),a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);qw.className="ZeroPadding2D";F.serialization.registerClass(qw);function Sv(r,e,t,n,a,i){return F.tidy(function(){Ar(a),KP(i),ya(n),t==null&&(t=[1,1]),n==null&&(n="valid"),a==null&&(a=mi()),i==null&&(i="max"),r=cw(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=A.maxPool(r,e,t,s):o=A.avgPool(r,e,t,s),a==="channelsFirst"&&(o=A.transpose(o,[0,3,1,2])),o})}function gB(r,e,t,n,a,i){return F.tidy(function(){Ar(a),KP(i),ya(n),t==null&&(t=[1,1,1]),n==null&&(n="valid"),a==null&&(a=mi()),i==null&&(i="max"),r=fB(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=A.maxPool3d(r,e,t,s):o=A.avgPool3d(r,e,t,s),a==="channelsFirst"&&(o=A.transpose(o,[0,4,1,2,3])),o})}var yB=function(r){oe(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=2),n=r.call(this,t)||this,typeof t.poolSize=="number")n.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")n.poolSize=t.poolSize;else throw new Z("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.poolSize)));if(Yr(n.poolSize,"poolSize"),t.strides==null)n.strides=n.poolSize;else if(typeof t.strides=="number")n.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")n.strides=t.strides;else throw new Z("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.strides)));return Yr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,ya(n.padding),n.inputSpec=[new Lr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){t=Ct(t);var n=di(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n),t=zf(it(t),2);var i=a.poolingFunction(it(t),[a.poolSize[0],1],[a.strides[0],1],a.padding,"channelsLast");return A.squeeze(i,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),Uw=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Ar(o),ya(i),Sv(t,n,a,i,o,"max")},e}(yB);Uw.className="MaxPooling1D";F.serialization.registerClass(Uw);var Vw=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Ar(o),ya(i),Sv(t,n,a,i,o,"avg")},e}(yB);Vw.className="AveragePooling1D";F.serialization.registerClass(Vw);var bB=function(r){oe(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new Z("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(t.strides.length,"."));n.strides=t.strides}else n.strides=[t.strides,t.strides];return Yr(n.poolSize,"poolSize"),Yr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ar(n.dataFormat),ya(n.padding),n.inputSpec=[new Lr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=Ct(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=di(n,this.poolSize[0],this.padding,this.strides[0]),a=di(a,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a]:[t[0],n,a,t[3]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),Gw=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Ar(o),ya(i),Sv(t,n,a,i,o,"max")},e}(bB);Gw.className="MaxPooling2D";F.serialization.registerClass(Gw);var Hw=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Ar(o),ya(i),Sv(t,n,a,i,o,"avg")},e}(bB);Hw.className="AveragePooling2D";F.serialization.registerClass(Hw);var wB=function(r){oe(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new Z("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(t.strides.length,"."));n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return Yr(n.poolSize,"poolSize"),Yr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ar(n.dataFormat),ya(n.padding),n.inputSpec=[new Lr({ndim:5})],n}return e.prototype.computeOutputShape=function(t){t=Ct(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=di(n,this.poolSize[0],this.padding,this.strides[0]),a=di(a,this.poolSize[1],this.padding,this.strides[1]),i=di(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a,i]:[t[0],n,a,i,t[4]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),Kw=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Ar(o),ya(i),gB(t,n,a,i,o,"max")},e}(wB);Kw.className="MaxPooling3D";F.serialization.registerClass(Kw);var jw=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Ar(o),ya(i),gB(t,n,a,i,o,"avg")},e}(wB);jw.className="AveragePooling3D";F.serialization.registerClass(jw);var xB=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[new Lr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,n){throw new vt},e}(mt),Xw=function(r){oe(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return F.tidy(function(){var a=it(t);return A.mean(a,1)})},e}(xB);Xw.className="GlobalAveragePooling1D";F.serialization.registerClass(Xw);var Yw=function(r){oe(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return F.tidy(function(){var a=it(t);return A.max(a,1)})},e}(xB);Yw.className="GlobalMaxPooling1D";F.serialization.registerClass(Yw);var kB=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Ar(n.dataFormat),n.inputSpec=[new Lr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,n){throw new vt},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),Zw=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?A.mean(i,[1,2]):A.mean(i,[2,3])})},e}(kB);Zw.className="GlobalAveragePooling2D";F.serialization.registerClass(Zw);var Jw=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?A.max(i,[1,2]):A.max(i,[2,3])})},e}(kB);Jw.className="GlobalMaxPooling2D";F.serialization.registerClass(Jw);var SB=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.layer=t.layer,n}return e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null?this.layer.trainable:!1},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.layer,o=pi(i,a);delete n.layer;var s={layer:o};return Object.assign(s,n),new t(s)},e}(mt),Qw=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n}return e.prototype.build=function(t){if(t=Ct(t),t.length<3)throw new Z("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(t)));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),r.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){t=Ct(t);var n=[t[0]].concat(t.slice(2)),a=this.layer.computeOutputShape(n),i=t[1];return[a[0],i].concat(a.slice(1))},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t);var i=function(u,c){var l=it(a.layer.call(u,n));return[l,[]]},o=vB(i,t,[],!1,null,null,!1,!0),s=o[1];return s})},e}(SB);Qw.className="TimeDistributed";F.serialization.registerClass(Qw);function cxe(r){Ks(Ype,"BidirectionalMergeMode",r)}var lxe="concat",e1=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this,a=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=a,n.forwardLayer=pi(i),a.goBackwards=a.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=a,n.backwardLayer=pi(o),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=t.mergeMode===void 0?lxe:t.mergeMode,cxe(n.mergeMode),t.weights)throw new vt("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var n=t.length,a=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,a)),this.backwardLayer.setWeights(t.slice(a))},e.prototype.computeOutputShape=function(t){var n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;var a,i,o;return this.returnState&&(o=n.slice(1)),a=n[0],a=a,this.mergeMode==="concat"?(a[a.length-1]*=2,i=[a]):this.mergeMode==null?i=[a,a.slice()]:i=[a],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[a].concat(o).concat(o.slice()):_n(i)},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=dB(t,o,s,this.numConstants);if(t=u.inputs,o=u.initialState,s=u.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return r.prototype.apply.call(this,t,n);var c=[],l=[];if(o!=null){var f=o.length;if(f%2>0)throw new Z("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=o,c.push.apply(c,Je([],te(o),!1));var h=o.map(function(x){return new Lr({shape:x.shape})});this.forwardLayer.stateSpec=h.slice(0,f/2),this.backwardLayer.stateSpec=h.slice(f/2),l.push.apply(l,Je([],te(h),!1))}if(s!=null)throw new vt("Support for constants in Bidirectional layers is not implemented yet.");var p=c[0]instanceof gi;try{for(var d=fe(c),m=d.next();!m.done;m=d.next()){var v=m.value;if(v instanceof gi!==p)throw new Z("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(x){a={error:x}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}if(p){var g=[t].concat(c),y=this.inputSpec.concat(l),w=this.inputSpec;this.inputSpec=y;var b=r.prototype.apply.call(this,g,n);return this.inputSpec=w,b}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.initialState,o,s;if(i==null)o=a.forwardLayer.call(t,n),s=a.backwardLayer.call(t,n);else{var u=i.slice(0,i.length/2),c=i.slice(i.length/2);o=a.forwardLayer.call(t,Object.assign(n,{initialState:u})),s=a.backwardLayer.call(t,Object.assign(n,{initialState:c}))}var l;a.returnState&&(Array.isArray(o)&&(l=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),a.returnSequences&&(s=A.reverse(s,1));var f;return a.mergeMode==="concat"?f=vb([o,s]):a.mergeMode==="sum"?f=A.add(o,s):a.mergeMode==="ave"?f=A.mul(.5,A.add(o,s)):a.mergeMode==="mul"?f=A.mul(o,s):a.mergeMode==null&&(f=[o,s]),a.returnState?a.mergeMode==null?f.concat(l):[f].concat(l):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var n=this;Us(this.forwardLayer.name,function(){n.forwardLayer.build(t)}),Us(this.backwardLayer.name,function(){n.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,n){Array.isArray(n)&&(n=n[0]);var a;if(this.returnSequences?this.mergeMode==null?a=[n,n]:a=n:this.mergeMode==null?a=[null,null]:a=null,this.returnState){var i=this.forwardLayer.states,o=i.map(function(s){return null});return Array.isArray(a)?a.concat(o).concat(o):[a].concat(o).concat(o)}else return a},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.fromConfig=function(t,n){var a=pi(n.layer);if(delete n.layer,n.numConstants!=null)throw new vt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=n;return i.layer=a,new t(i)},e}(SB);e1.className="Bidirectional";F.serialization.registerClass(e1);var t1=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.scale=t.scale,t.offset?n.offset=t.offset:n.offset=0,n}return e.prototype.getConfig=function(){var t={scale:this.scale,offset:this.offset},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return t=it(t),t.dtype!=="float32"&&(t=Oi(t,"float32")),F.add(F.mul(t,a.scale),a.offset)})},e}(mt);t1.className="Rescaling";F.serialization.registerClass(t1);var fxe=F.image.resizeBilinear,hxe=F.image.cropAndResize,r1=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.height=t.height,n.width=t.width,n}return e.prototype.centerCrop=function(t,n,a,i,o,s,u,c){return F.tidy(function(){var l,f=!1,h=n/s,p=a/u,d=(i+n)/s,m=(o+a)/u,v=[h,p,d,m],g=[];t.rank===3?(f=!0,l=F.stack([t])):l=t;for(var y=0;y<l.shape[0];y++)g.push(v);var w=F.tensor(g,[g.length,4]),b=F.range(0,g.length,1,"int32"),x=[i,o],S=hxe(l,w,b,x,"nearest");return Oi(f?it(F.unstack(S)):S,c)})},e.prototype.upsize=function(t,n,a,i){return F.tidy(function(){var o=fxe(t,[n,a]);return Oi(o,i)})},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=it(t),o=i.dtype,s=i.shape,u=s[s.length-3],c=s[s.length-2],l=0;u!==a.height&&(l=Math.floor((u-a.height)/2));var f=0;return c!==a.width&&(f=Math.floor((c-a.width)/2),f===0&&(f=1)),l>=0&&f>=0?a.centerCrop(i,l,f,a.height,a.width,u,c,o):a.upsize(t,a.height,a.width,o)})},e.prototype.getConfig=function(){var t={height:this.height,width:this.width},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){t=Ct(t);var n=t.length-3,a=t.length-2;return t[n]=this.height,t[a]=this.width,t},e}(mt);r1.className="CenterCrop";F.serialization.registerClass(r1);function pxe(r,e,t,n){var a=it(r);if(a.dtype!=="int32"&&(a=Oi(a,"int32")),e==="int")return a;var i=a.shape;if(a.rank===0&&(a=F.expandDims(a,-1)),e==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=F.expandDims(a,-1)),a.rank>2)throw new Z("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(e," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o=["multiHot","oneHot"].includes(e),s=a,u;if(typeof n<"u"&&e==="count"?u=F.denseBincount(s,n,t,o):u=F.denseBincount(s,[],t,o),e!=="tfIdf")return u;if(n)return F.mul(u,n);throw new Z("When outputMode is 'tfIdf', weights must be provided.")}var n1=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.numTokens=t.numTokens,t.outputMode?n.outputMode=t.outputMode:n.outputMode="multiHot",n}return e.prototype.getConfig=function(){var t={numTokens:this.numTokens,outputMode:this.outputMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){return t=Ct(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t),t.dtype!=="int32"&&(t=Oi(t,"int32"));var i;if(typeof n.countWeights<"u"){if(a.outputMode!=="count")throw new Z(`countWeights is not used when outputMode !== count.
              Received countWeights=`.concat(n.countWeights));i=it(n.countWeights)}var o=F.max(t),s=F.min(t),u=F.greater(a.numTokens,o).bufferSync().get(0),c=F.greaterEqual(s,0).bufferSync().get(0);if(!(u&&c))throw new Z("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(a.numTokens));return pxe(t,a.outputMode,a.numTokens,i)})},e}(mt);n1.className="CategoryEncoding";F.serialization.registerClass(n1);var dxe=["bilinear","nearest"],$P=new Set(dxe),a1=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.height=t.height,n.width=t.width,t.interpolation)if($P.has(t.interpolation))n.interpolation=t.interpolation;else throw new Z("Invalid interpolation parameter: ".concat(t.interpolation," is not implemented"));else n.interpolation="bilinear";return n.cropToAspectRatio=Boolean(t.cropToAspectRatio),n}return e.prototype.computeOutputShape=function(t){t=Ct(t);var n=t[2];return[this.height,this.width,n]},e.prototype.getConfig=function(){var t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=[a.height,a.width];if(a.interpolation==="bilinear")return F.image.resizeBilinear(t,i,!a.cropToAspectRatio);if(a.interpolation==="nearest")return F.image.resizeNearestNeighbor(t,i,!a.cropToAspectRatio);throw new Error("Interpolation is ".concat(a.interpolation," but only ").concat(Je([],te($P),!1)," are supported"))})},e}(mt);a1.className="Resizing";F.serialization.registerClass(a1);var NB=function(){function r(e){this.seed=e}return r.prototype.next=function(){if(this.seed!==void 0)return this.seed++},r}();NB.className="RandomSeed";var TB=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.randomGenerator=new NB(t.seed),n}return e.prototype.getConfig=function(){var t={seed:this.randomGenerator.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);TB.className="BaseRandomLayer";var vxe=["bilinear","nearest"],WP=new Set(vxe),i1=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this,a=t.factor,i=t.interpolation,o=i===void 0?"bilinear":i;if(n.factor=a,Array.isArray(n.factor)&&n.factor.length===2)n.widthLower=n.factor[0],n.widthUpper=n.factor[1];else if(!Array.isArray(n.factor)&&n.factor>0)n.widthLower=-n.factor,n.widthUpper=n.factor;else throw new Z("Invalid factor: ".concat(n.factor,". Must be positive number or tuple of 2 numbers"));if(n.widthLower<-1||n.widthUpper<-1)throw new Z("factor must have values larger than -1. Got: ".concat(n.factor));if(n.widthUpper<n.widthLower)throw new Z(`factor cannot have upper bound less than lower bound.
        Got upper bound: `.concat(n.widthUpper,`.
        Got lower bound: `).concat(n.widthLower,`
      `));if(o)if(WP.has(o))n.interpolation=o;else throw new Z("Invalid interpolation parameter: ".concat(o," is not implemented"));return n}return e.prototype.getConfig=function(){var t={factor:this.factor,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){t=Ct(t);var n=t[2];return[this.imgHeight,-1,n]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=it(t);a.imgHeight=i.shape[i.shape.length-3];var o=i.shape[i.shape.length-2];a.widthFactor=F.randomUniform([1],1+a.widthLower,1+a.widthUpper,"float32",a.randomGenerator.next());var s=a.widthFactor.dataSync()[0]*o;s=Math.round(s);var u=[a.imgHeight,s];switch(a.interpolation){case"bilinear":return F.image.resizeBilinear(t,u);case"nearest":return F.image.resizeNearestNeighbor(t,u);default:throw new Error("Interpolation is ".concat(a.interpolation,`
          but only `).concat(Je([],te(WP),!1)," are supported"))}})},e}(TB);i1.className="RandomWidth";F.serialization.registerClass(i1);function mxe(r){return new kc(r)}function gxe(r){return new ow(r)}function yxe(r){return new nw(r)}function bxe(r){return new aw(r)}function wxe(r){return new iw(r)}function xxe(r){return new uw(r)}function kxe(r){return new sw(r)}function Sxe(r){return new pw(r)}function Nxe(r){return new mv(r)}function Txe(r){return new lw(r)}function Exe(r){return new gv(r)}function Ixe(r){return new fw(r)}function Cxe(r){return new hw(r)}function Axe(r){return new dw(r)}function Dxe(r){return new vw(r)}function _xe(r){return new mw(r)}function Fxe(r){return new Nw(r)}function Rxe(r){return new kw(r)}function Oxe(r){return new kv(r)}function Pxe(r){return new xw(r)}function Mxe(r){return new Sw(r)}function Bxe(r){return new Tw(r)}function Lxe(r){return new Ew(r)}function zxe(r){return new Iw(r)}function $xe(r){return new Aw(r)}function Wxe(r){return new Dw(r)}function qxe(r){return new Fw(r)}function Uxe(r){return new Pw(r)}function Vxe(r){return new Rw(r)}function Gxe(r){return new Ow(r)}function Hxe(r){return new _w(r)}function Kxe(r){return new Mw(r)}function jxe(r){return new $w(r)}function Xxe(r){return new Ww(r)}function Yxe(r){return new qw(r)}function o1(r){return new Vw(r)}function Zxe(r){return o1(r)}function Jxe(r){return o1(r)}function s1(r){return new Hw(r)}function Qxe(r){return s1(r)}function eke(r){return s1(r)}function u1(r){return new jw(r)}function tke(r){return u1(r)}function rke(r){return u1(r)}function nke(r){return new Xw(r)}function ake(r){return new Zw(r)}function EB(r){return new Yw(r)}function IB(r){return new Jw(r)}function CB(r){return new Uw(r)}function AB(r){return new Gw(r)}function ike(r){return new Kw(r)}function oke(r){return new yw(r)}function ske(r){return new bv(r)}function uke(r){return new bw(r)}function cke(r){return new Kf(r)}function lke(r){return new gw(r)}function fke(r){return new yv(r)}function hke(r){return new ww(r)}function pke(r){return new xv(r)}function dke(r){return new so(r)}function vke(r){return new wv(r)}function mke(r){return new e1(r)}function gke(r){return new Qw(r)}var yke=EB,bke=IB,wke=CB,xke=AB;function kke(r){return new Bw(r)}function Ske(r){return new Lw(r)}function Nke(r){return new zw(r)}function Tke(r){return new Cw(r)}function Eke(r){return new t1(r)}function Ike(r){return new r1(r)}function Cke(r){return new a1(r)}function Ake(r){return new n1(r)}function Dke(r){return new i1(r)}var _ke={__proto__:null,Layer:mt,RNN:so,RNNCell:Tc,activation:Fxe,add:Wxe,alphaDropout:Nke,average:qxe,averagePooling1d:o1,averagePooling2d:s1,averagePooling3d:u1,avgPool1d:Zxe,avgPool2d:Qxe,avgPool3d:tke,avgPooling1d:Jxe,avgPooling2d:eke,avgPooling3d:rke,batchNormalization:jxe,bidirectional:mke,categoryEncoding:Ake,centerCrop:Ike,concatenate:Uxe,conv1d:Sxe,conv2d:Nxe,conv2dTranspose:Txe,conv3d:Exe,conv3dTranspose:Ixe,convLstm2d:hke,convLstm2dCell:pke,cropping2D:Axe,dense:Rxe,depthwiseConv2d:_xe,dot:Kxe,dropout:Oxe,elu:gxe,embedding:$xe,flatten:Mxe,gaussianDropout:Ske,gaussianNoise:kke,globalAveragePooling1d:nke,globalAveragePooling2d:ake,globalMaxPool1d:yke,globalMaxPool2d:bke,globalMaxPooling1d:EB,globalMaxPooling2d:IB,gru:oke,gruCell:ske,input:j4,inputLayer:mxe,layerNormalization:Xxe,leakyReLU:bxe,lstm:uke,lstmCell:cke,masking:Tke,maxPool1d:wke,maxPool2d:xke,maxPooling1d:CB,maxPooling2d:AB,maxPooling3d:ike,maximum:Vxe,minimum:Gxe,multiply:Hxe,permute:zxe,prelu:wxe,randomWidth:Dke,reLU:yxe,repeatVector:Bxe,rescaling:Eke,reshape:Lxe,resizing:Cke,rnn:dke,separableConv2d:Cxe,simpleRNN:lke,simpleRNNCell:fke,softmax:xxe,spatialDropout1d:Pxe,stackedRNNCells:vke,thresholdedReLU:kxe,timeDistributed:gke,upSampling2d:Dxe,zeroPadding2d:Yxe};function Fke(r,e){return Zb(r,e)}function Rke(r,e){return z4(r,e)}function Oke(r,e){return $4(r,e)}function Pke(r,e){return Jb(r,e)}function Mke(r,e){return Qb(r,e)}function Bke(r,e){return L4(r,e)}function Lke(r,e){return v1e(r,e)}function zke(r,e){return Yb(r,e)}function $ke(r,e){return hv(r,e)}function Wke(r,e){return Nc(r,e)}function qke(r,e){return Nc(r,e)}function Uke(r,e){return Nc(r,e)}function Vke(r,e){return eu(r,e)}function Gke(r,e){return eu(r,e)}function Hke(r,e){return eu(r,e)}var Kke={__proto__:null,MAPE:qke,MSE:Gke,binaryAccuracy:Fke,binaryCrossentropy:Rke,categoricalAccuracy:Pke,categoricalCrossentropy:Mke,cosineProximity:zke,mape:Uke,meanAbsoluteError:$ke,meanAbsolutePercentageError:Wke,meanSquaredError:Vke,mse:Hke,precision:Bke,recall:Lke,sparseCategoricalAccuracy:Oke};var jke={__proto__:null,modelFromJSON:G1e};function Xke(r){return new Hf(r)}function Yke(r){return J1e(r)}function Zke(r){return Q1e(r)}var Jke={__proto__:null,l1:Yke,l1l2:Xke,l2:Zke},DB=function(r){oe(e,r);function e(){var t=r.apply(this,Je([],te(arguments),!1))||this;return t.model=null,t}return e.prototype.setModel=function(t){if(!(t instanceof oo))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(xc);function Ad(r,e){return r<e}function qP(r,e){return r>e}var _B=function(r){oe(e,r);function e(t){var n=r.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new vt("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,["auto","min","max"].indexOf(n.mode)===-1&&(console.warn("EarlyStopping mode '".concat(n.mode,"' is invalid. ")+"Falling back to mode 'auto'."),n.mode="auto"),n.mode==="min"?n.monitorFunc=Ad:n.mode==="max"||n.monitor.indexOf("acc")!==-1?n.monitorFunc=qP:n.monitorFunc=Ad,n.monitorFunc===Ad&&(n.minDelta*=-1),n}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===Ad?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return[4,Ho(n)];case 1:return i.sent(),a=this.getMonitorValue(n),a==null?[2]:(this.monitorFunc(a-this.minDelta,this.best)?(this.best=a,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping.")),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var n=t[this.monitor];return n==null&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. ")+"Available metrics are: ".concat(Object.keys(t))),n},e}(DB);function Qke(r){return new _B(r)}var e2e={earlyStopping:Qke};pr.Callback=DB;pr.CallbackList=F4;pr.CustomCallback=O4;pr.EarlyStopping=_B;pr.History=R4;pr.InputSpec=Lr;pr.LayerVariable=QP;pr.LayersModel=oo;pr.RNN=so;pr.Sequential=dv;pr.SymbolicTensor=gi;pr.callbacks=e2e;pr.constraints=$we;pr.initializers=r1e;pr.input=j4;pr.layers=_ke;pr.loadLayersModel=H1e;pr.metrics=Kke;pr.model=X1e;pr.models=jke;pr.registerCallbackConstructor=Z1e;pr.regularizers=Jke;pr.sequential=Y1e;pr.version_layers=ew});var Iz=X(fu=>{"use strict";var Be=Ls();function t2e(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}function r2e(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var RB=t2e(Be);var n2e=Be.env();n2e.registerFlag("KEEP_INTERMEDIATE_TENSORS",function(){return!1},function(r){r&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var d1=function(r,e){return d1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},d1(r,e)};function hL(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");d1(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Et(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Nt(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Ur(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function we(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Ft(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var ta;(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_QINT16=15]="DT_QINT16",r[r.DT_QUINT16=16]="DT_QUINT16",r[r.DT_UINT16=17]="DT_UINT16",r[r.DT_COMPLEX128=18]="DT_COMPLEX128",r[r.DT_HALF=19]="DT_HALF",r[r.DT_RESOURCE=20]="DT_RESOURCE",r[r.DT_VARIANT=21]="DT_VARIANT",r[r.DT_UINT32=22]="DT_UINT32",r[r.DT_UINT64=23]="DT_UINT64",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",r[r.DT_QINT16_REF=115]="DT_QINT16_REF",r[r.DT_QUINT16_REF=116]="DT_QUINT16_REF",r[r.DT_UINT16_REF=117]="DT_UINT16_REF",r[r.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",r[r.DT_HALF_REF=119]="DT_HALF_REF",r[r.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",r[r.DT_VARIANT_REF=121]="DT_VARIANT_REF",r[r.DT_UINT32_REF=122]="DT_UINT32_REF",r[r.DT_UINT64_REF=123]="DT_UINT64_REF"})(ta||(ta={}));var OB;(function(r){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))})(OB||(OB={}));var $1={};function a2e(r,e){var t={tfOpName:r,category:"custom",inputs:[],attrs:[],customExecutor:e};$1[r]=t}function pL(r){return $1[r]}function i2e(r){delete $1[r]}function I(r,e,t,n,a){var i=e.inputParams[r];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,s=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd,u=o<0?e.inputNames.length+o:o;if(i.type==="tensor")return sn(e.inputNames[u],t,n,a);if(i.type==="tensors"){var c=e.inputs.slice(o,s),l=e.inputNames.slice(o,s).filter(function(d,m){var v;return((v=c[m])===null||v===void 0?void 0:v.op)!=="NoOp"});return l.map(function(d){return sn(d,t,n,a)})}var f=sn(e.inputNames[u],t,n,a),h=f.dataSync();return i.type==="number"?h[0]:Be.util.toNestedArray(f.shape,h)}var p=e.attrParams[r];return p&&p.value}function sn(r,e,t,n){var a=we(ra(r,t),2),i=a[0],o=a[1];if(n!=null){var s=n.getHashTableHandleByName(i);if(s!=null)return s}var u=t.currentContextIds.find(function(c){return!!e[Dv(i,c)]});return u!==void 0?e[Dv(i,u)][o]:void 0}function PB(r,e,t){return e[Dv(r,t.currentContextId)]}function uo(r,e){var t=we(ra(r,e),3),n=t[0],a=t[1],i=t[2];return[Dv(n,e&&e.currentContextId),a,i]}function Dv(r,e){return e?"".concat(r,"-").concat(e):r}function ra(r,e){if(r==="")return["",0,void 0];var t=e!=null&&e.parseNodeNameCache!=null;if(t){var n=e.parseNodeNameCache.get(r);if(n!=null)return n}var a=r.split(":"),i;if(a.length===1)i=[r,0,void 0];else{var o=a[0],s=a.length===3?a[1]:void 0,u=Number(a[a.length-1]);i=[o,u,s]}return t&&e.parseNodeNameCache.set(r,i),i}function Ev(r,e,t){var n=I("pad",r,e,t);if(n==="explicit"){n=I("explicitPaddings",r,e,t);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=n[i*2],a[i][1]=n[i*2+1];return a}return n}function co(r){return r.kept?r:Be.clone(r)}var o2e=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],s2e={__proto__:null,json:o2e};var u2e=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],c2e={__proto__:null,json:u2e};var l2e=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],f2e={__proto__:null,json:l2e};var h2e=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],p2e={__proto__:null,json:h2e};var d2e=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],v2e={__proto__:null,json:d2e};var m2e=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],g2e={__proto__:null,json:m2e};var y2e=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],b2e={__proto__:null,json:y2e};var w2e=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],x2e={__proto__:null,json:w2e};var k2e=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],S2e={__proto__:null,json:k2e};var N2e=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],T2e={__proto__:null,json:N2e};var E2e=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],I2e={__proto__:null,json:E2e};var C2e=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],A2e={__proto__:null,json:C2e};var D2e=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],_2e={__proto__:null,json:D2e};var F2e=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],R2e={__proto__:null,json:F2e};var O2e=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],P2e={__proto__:null,json:O2e};var M2e=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],B2e={__proto__:null,json:M2e};var L2e=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],z2e={__proto__:null,json:L2e};var $2e=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],W2e={__proto__:null,json:$2e};var q2e=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],U2e={__proto__:null,json:q2e},MB=function(){function r(){var e=[s2e,c2e,f2e,p2e,v2e,g2e,b2e,x2e,S2e,T2e,I2e,A2e,_2e,R2e,P2e,B2e,z2e,W2e,U2e],t=[].concat.apply([],Ft([],we(e.map(function(n){return n.json})),!1));this.opMappers=t.reduce(function(n,a){return n[a.tfOpName]=a,n},{})}return Object.defineProperty(r,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!1,configurable:!0}),r.prototype.transformGraph=function(e,t){var n=this;t===void 0&&(t={});var a=e.node,i=[],o=[],s=[],u=a.reduce(function(v,g){return v[g.name]=n.mapNode(g),g.op.startsWith("Placeholder")?i.push(v[g.name]):g.op==="Const"?o.push(v[g.name]):(g.input==null||g.input.length===0)&&s.push(v[g.name]),v},{}),c=[],l=[],f={},h={};t!=null&&(f=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));var p=Object.keys(u);p.forEach(function(v){var g=u[v];g.inputNames.forEach(function(y,w){var b=we(uo(y),3),x=b[0],S=b[2],T=u[x];if(T.outputs!=null){var E=T.outputs.indexOf(S);if(E!==-1){var C="".concat(x,":").concat(E);g.inputNames[w]=C}}g.inputs.push(T),T.children.push(g)})}),Object.keys(h).length===0?p.forEach(function(v){var g=u[v];g.children.length===0&&l.push(g)}):Object.keys(h).forEach(function(v){var g=we(uo(v),1),y=g[0],w=u[y];w!=null&&(w.signatureKey=h[v],l.push(w))}),Object.keys(f).length>0?Object.keys(f).forEach(function(v){var g=we(uo(v),1),y=g[0],w=u[y];w&&(w.signatureKey=f[v],c.push(w))}):c=i;var d={};e.library!=null&&e.library.function!=null&&(d=e.library.function.reduce(function(v,g){return v[g.signature.name]=n.mapFunction(g),v},{}));var m={nodes:u,inputs:c,outputs:l,weights:o,placeholders:i,signature:t,functions:d};return s.length>0&&(m.initNodes=s),m},r.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,n){return t[e[n].name]=n,t},{})},r.prototype.mapNode=function(e){var t=pL(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(a){return a.startsWith("^")?a.slice(1):a}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce(function(a,i){return a[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},a},{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce(function(a,i){var o=i.type,s=void 0;switch(i.type){case"string":s=v1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=v1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":s=k1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=k1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":s=g1(e.attr,i.tfName,i.defaultValue||0),s===void 0&&!!i.tfDeprecatedName&&(s=g1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":s=x1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=x1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":s=m1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=m1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":s=N1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=N1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":s=w1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=w1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":s=S1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=S1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":s=y1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=y1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":s=b1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=b1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":s=BB(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=BB(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(i.type," for op: ").concat(e.op))}return a[i.name]={value:s,type:o},a},{})),n},r.prototype.mapFunction=function(e){var t=this,n=e.nodeDef,a=[],i=[],o={};n!=null&&(o=n.reduce(function(h,p){return h[p.name]=t.mapNode(p),p.op==="Const"&&i.push(h[p.name]),h},{}));var s=[],u=[];e.signature.inputArg.forEach(function(h){var p=we(uo(h.name),1),d=p[0],m={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:W1(h.type),type:"dtype"}},children:[]};m.signatureKey=h.name,s.push(m),o[d]=m});var c=Object.keys(o);c.forEach(function(h){var p=o[h];p.inputNames.forEach(function(d,m){var v=we(uo(d),3),g=v[0],y=v[2],w=o[g];if(w.outputs!=null){var b=w.outputs.indexOf(y);if(b!==-1){var x="".concat(g,":").concat(b);p.inputNames[m]=x}}p.inputs.push(w),w.children.push(p)})});var l=e.ret;e.signature.outputArg.forEach(function(h){var p=we(uo(l[h.name]),2),d=p[0],m=p[1],v=o[d];v!=null&&(v.defaultOutput=m,u.push(v))});var f=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:u,weights:i,placeholders:a,signature:f}},r.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a),n},{}),outputs:e.signature.outputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a,e.ret),n},{})}},r.prototype.mapArgToTensorInfo=function(e,t){var n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}},r}();function V2e(r){var e=Be.env().global;if(typeof e.atob<"u")return e.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function dL(r,e){var t=Array.isArray(r)?String.fromCharCode.apply(null,r):V2e(r);return e?t:t.toLowerCase()}function v1(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a!=null?dL(a.s,n):t}function m1(r,e,t){var n=r[e];return n?n.b:t}function g1(r,e,t){var n=r[e]||{},a=n.i!=null?n.i:n.f!=null?n.f:t;return typeof a=="number"?a:parseInt(a,10)}function W1(r){switch(typeof r=="string"&&(r=ta[r]),r){case ta.DT_FLOAT:case ta.DT_HALF:return"float32";case ta.DT_INT32:case ta.DT_INT64:case ta.DT_INT8:case ta.DT_UINT8:return"int32";case ta.DT_BOOL:return"bool";case ta.DT_DOUBLE:return"float32";case ta.DT_STRING:return"string";case ta.DT_COMPLEX64:case ta.DT_COMPLEX128:return"complex64";default:return null}}function BB(r,e,t){var n=r[e];return n&&n.func?n.func.name:t}function y1(r,e,t){var n=r[e];return n&&n.type?W1(n.type):t}function b1(r,e,t){var n=r[e];return n&&n.list&&n.list.type?n.list.type.map(function(a){return W1(a)}):t}function vL(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function w1(r,e,t){var n=r[e];return n&&n.shape?vL(n.shape):t}function x1(r,e,t){var n=r[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(function(a){return typeof a=="number"?a:parseInt(a,10)}):t}function k1(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a&&a.list&&a.list.s?a.list.s.map(function(i){return dL(i,n)}):t}function S1(r,e,t){var n=r[e];return n&&n.list&&n.list.shape?n.list.shape.map(function(a){return vL(a)}):t}function N1(r,e,t){var n=r[e];return n&&n.list&&n.list.b?n.list.b:t}var G2e=function(){function r(e,t,n){var a=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(i){return a.getInput(i)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(i,o){return i[o]=a.getAttr(o),i},{}))}return r.prototype.getInput=function(e){return sn(e,this.tensorMap,this.context)},r.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(n.tensor!=null)return sn(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return g1(this.node.rawAttrs,e,t);if(n.s!=null)return v1(this.node.rawAttrs,e,t);if(n.b!=null)return m1(this.node.rawAttrs,e,t);if(n.shape!=null)return w1(this.node.rawAttrs,e,t);if(n.type!=null)return y1(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return x1(this.node.rawAttrs,e,t);if(n.list.s!=null)return k1(this.node.rawAttrs,e,t);if(n.list.shape!=null)return S1(this.node.rawAttrs,e,t);if(n.list.b!=null)return N1(this.node.rawAttrs,e,t);if(n.list.type!=null)return b1(this.node.rawAttrs,e,t)}return t},r}();var H2e=1e-7,K2e=1e-4,j2e=function(){function r(){}return r.prototype.refCount=function(e){return ea("refCount")},r.prototype.incRef=function(e){return ea("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return ea("time")},r.prototype.read=function(e){return ea("read")},r.prototype.readSync=function(e){return ea("readSync")},r.prototype.readToGPU=function(e,t){return ea("readToGPU")},r.prototype.numDataIds=function(){return ea("numDataIds")},r.prototype.disposeData=function(e,t){return ea("disposeData")},r.prototype.write=function(e,t,n){return ea("write")},r.prototype.move=function(e,t,n,a,i){return ea("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return ea("createTensorFromGPUData")},r.prototype.memory=function(){return ea("memory")},r.prototype.floatPrecision=function(){return ea("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?H2e:K2e},r.prototype.dispose=function(){return ea("dispose")},r}();function ea(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function V(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Ja(r,e,t){t===void 0&&(t=""),V(su(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function Pc(r){V(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Zr(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function X2e(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==null&&e[t]!==null&&r[t]!==e[t])return!1;return!0}function su(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function rh(r){return r%1===0}function Iv(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function qv(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),V(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),V(r.every(function(n){return rh(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function Y2e(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:qv(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(r[s],"' is not 1"));(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function Z2e(r,e){return mL(r,e)}function mL(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function J2e(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function Q2e(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function T1(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function eSe(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function q1(r){return typeof r=="string"||r instanceof String}function tSe(r){return typeof r=="boolean"}function rSe(r){return typeof r=="number"}function Uv(r){return Array.isArray(r)?Uv(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":rSe(r)?"float32":q1(r)?"string":tSe(r)?"bool":"float32"}function LB(r){return!!(r&&r.constructor&&r.call&&r.apply)}function U1(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function gL(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=gL(r+o*u,s,t,n);return a}function zB(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return gL(0,r,e,t)}function yL(r,e){for(var t=V1(r,e),n=0;n<t.length;n++)t[n]=1;return t}function V1(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function wa(r){r.forEach(function(e){V(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function G1(r){return r&&r.then&&typeof r.then=="function"}var $B="tfjsflags",nSe=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=aSe,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(Pn().getBool("IS_TEST")||Pn().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];Pn().getBool("IS_TEST")||Pn().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return Et(this,void 0,void 0,function(){var t,n;return Nt(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(G1(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if($B in t){var n=t[$B].split(",");n.forEach(function(a){var i=we(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=oSe(o,s)})}}},r}();function aSe(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return iSe(e,n[0],n[1]),n.join("=")}),e}function iSe(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function oSe(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function Pn(){return bL}var bL=null;function sSe(r){bL=r}var c1;function wL(){if(c1==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");c1=r}return c1}function uSe(){var r=wL();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function H1(r,e){var t=uSe();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var cSe="Abs",lSe="Acos",fSe="Acosh",xL="Add",hSe="AddN",pSe="All",dSe="Any",vSe="ArgMax",mSe="ArgMin",gSe="Asin",ySe="Asinh",bSe="Atan",wSe="Atanh",xSe="Atan2",kSe="AvgPool",SSe="AvgPool3D",NSe="BatchMatMul",TSe="BatchToSpaceND",ESe="Bincount",ISe="BitwiseAnd",CSe="BroadcastArgs",kL="Cast",ASe="Ceil",DSe="ClipByValue",_Se="Complex",FSe="ComplexAbs",RSe="Concat",OSe="Conv2D",PSe="Conv2DBackpropFilter",MSe="Conv2DBackpropInput",BSe="Conv3D",LSe="Conv3DBackpropInputV2",zSe="Cos",$Se="Cosh",WSe="Cumprod",qSe="Cumsum",USe="CropAndResize",VSe="DenseBincount",GSe="DepthToSpace",HSe="DepthwiseConv2dNative",KSe="DepthwiseConv2dNativeBackpropFilter",jSe="DepthwiseConv2dNativeBackpropInput",XSe="Diag",YSe="Dilation2D",ZSe="RealDiv",JSe="Einsum",QSe="Elu",eNe="Erf",tNe="Equal",rNe="Exp",nNe="ExpandDims",aNe="Expm1",iNe="FFT",oNe="Fill",sNe="FlipLeftRight",uNe="Floor",cNe="FloorDiv",lNe="FusedBatchNorm",fNe="GatherV2",hNe="GatherNd",pNe="Greater",dNe="GreaterEqual",SL="Identity",vNe="IFFT",mNe="Imag",gNe="IsFinite",yNe="IsInf",bNe="IsNan",wNe="LeakyRelu",xNe="Less",kNe="LessEqual",SNe="LinSpace",NNe="Log",TNe="Log1p",ENe="LogicalAnd",INe="LogicalNot",CNe="LogicalOr",ANe="LRN",DNe="Max",_Ne="Maximum",FNe="MaxPool",RNe="MaxPool3D",ONe="MaxPoolWithArgmax",PNe="Mean",MNe="Min",BNe="Minimum",LNe="MirrorPad",zNe="Mod",$Ne="Multinomial",WNe="Multiply",qNe="Neg",UNe="NotEqual",VNe="NonMaxSuppressionV3",GNe="NonMaxSuppressionV4",HNe="NonMaxSuppressionV5",KNe="OnesLike",jNe="OneHot",XNe="Pack",YNe="PadV2",ZNe="Pow",JNe="Prelu",QNe="Prod",eTe="RaggedGather",tTe="RaggedRange",rTe="RaggedTensorToTensor",nTe="Range",aTe="Real",iTe="Reciprocal",oTe="Relu",sTe="Reshape",uTe="ResizeNearestNeighbor",cTe="ResizeBilinear",lTe="Relu6",fTe="Reverse",hTe="Round",pTe="Rsqrt",dTe="ScatterNd",vTe="TensorScatterUpdate",mTe="SearchSorted",gTe="Select",yTe="Selu",bTe="Slice",wTe="Sin",xTe="Sinh",kTe="Sign",STe="Sigmoid",NTe="Softplus",TTe="Sqrt",ETe="Sum",ITe="SpaceToBatchND",CTe="SplitV",ATe="Softmax",DTe="SparseFillEmptyRows",_Te="SparseReshape",FTe="SparseSegmentMean",RTe="SparseSegmentSum",OTe="SparseToDense",PTe="SquaredDifference",MTe="StaticRegexReplace",BTe="StridedSlice",LTe="StringNGrams",zTe="StringSplit",$Te="StringToHashBucketFast",WTe="Sub",qTe="Tan",UTe="Tanh",NL="Tile",VTe="TopK",GTe="Transform",l1="Transpose",HTe="Unique",KTe="Unpack",jTe="UnsortedSegmentSum",XTe="ZerosLike",YTe="Step",ZTe="RotateWithOffset",WB="_FusedMatMul",qB="FusedConv2D",UB="FusedDepthwiseConv2D";function jf(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];Pn().getBool("IS_TEST")||Pn().getBool("PROD")||console.warn.apply(console,Ft([],we(r),!1))}var TL=H1("kernelRegistry",function(){return new Map}),JTe=H1("gradRegistry",function(){return new Map});function VB(r,e){var t=QTe(r,e);return TL.get(t)}function GB(r){return JTe.get(r)}function HB(r){for(var e=TL.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=we(i,2),s=o[0],u=o[1],c=we(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function QTe(r,e){return"".concat(e,"_").concat(r)}function eEe(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var uu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tEe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function rEe(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var EL=rr,ja=null;try{ja=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function rr(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}rr.prototype.__isLong__;Object.defineProperty(rr.prototype,"__isLong__",{value:!0});function oa(r){return(r&&r.__isLong__)===!0}rr.isLong=oa;var KB={},jB={};function cu(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=jB[r],n)?n:(t=nr(r,(r|0)<0?-1:0,!0),a&&(jB[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=KB[r],n)?n:(t=nr(r,r<0?-1:0,!1),a&&(KB[r]=t),t))}rr.fromInt=cu;function Xa(r,e){if(isNaN(r))return e?nu:Ya;if(e){if(r<0)return nu;if(r>=IL)return DL}else{if(r<=-YB)return aa;if(r+1>=YB)return AL}return r<0?Xa(-r,e).neg():nr(r%Fc|0,r/Fc|0,e)}rr.fromNumber=Xa;function nr(r,e,t){return new rr(r,e,t)}rr.fromBits=nr;var _v=Math.pow;function K1(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Ya;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return K1(r.substring(1),e,t).neg();for(var a=Xa(_v(t,8)),i=Ya,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Xa(_v(t,s));i=i.mul(c).add(Xa(u))}else i=i.mul(a),i=i.add(Xa(u))}return i.unsigned=e,i}rr.fromString=K1;function Si(r,e){return typeof r=="number"?Xa(r,e):typeof r=="string"?K1(r,e):nr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}rr.fromValue=Si;var XB=1<<16,nEe=1<<24,Fc=XB*XB,IL=Fc*Fc,YB=IL/2,ZB=cu(nEe),Ya=cu(0);rr.ZERO=Ya;var nu=cu(0,!0);rr.UZERO=nu;var Ic=cu(1);rr.ONE=Ic;var CL=cu(1,!0);rr.UONE=CL;var E1=cu(-1);rr.NEG_ONE=E1;var AL=nr(-1,2147483647,!1);rr.MAX_VALUE=AL;var DL=nr(-1,-1,!0);rr.MAX_UNSIGNED_VALUE=DL;var aa=nr(0,-2147483648,!1);rr.MIN_VALUE=aa;var Oe=rr.prototype;Oe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Oe.toNumber=function(){return this.unsigned?(this.high>>>0)*Fc+(this.low>>>0):this.high*Fc+(this.low>>>0)};Oe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(aa)){var t=Xa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Xa(_v(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Oe.getHighBits=function(){return this.high};Oe.getHighBitsUnsigned=function(){return this.high>>>0};Oe.getLowBits=function(){return this.low};Oe.getLowBitsUnsigned=function(){return this.low>>>0};Oe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(aa)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Oe.isZero=function(){return this.high===0&&this.low===0};Oe.eqz=Oe.isZero;Oe.isNegative=function(){return!this.unsigned&&this.high<0};Oe.isPositive=function(){return this.unsigned||this.high>=0};Oe.isOdd=function(){return(this.low&1)===1};Oe.isEven=function(){return(this.low&1)===0};Oe.equals=function(e){return oa(e)||(e=Si(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Oe.eq=Oe.equals;Oe.notEquals=function(e){return!this.eq(e)};Oe.neq=Oe.notEquals;Oe.ne=Oe.notEquals;Oe.lessThan=function(e){return this.comp(e)<0};Oe.lt=Oe.lessThan;Oe.lessThanOrEqual=function(e){return this.comp(e)<=0};Oe.lte=Oe.lessThanOrEqual;Oe.le=Oe.lessThanOrEqual;Oe.greaterThan=function(e){return this.comp(e)>0};Oe.gt=Oe.greaterThan;Oe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Oe.gte=Oe.greaterThanOrEqual;Oe.ge=Oe.greaterThanOrEqual;Oe.compare=function(e){if(oa(e)||(e=Si(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Oe.comp=Oe.compare;Oe.negate=function(){return!this.unsigned&&this.eq(aa)?aa:this.not().add(Ic)};Oe.neg=Oe.negate;Oe.add=function(e){oa(e)||(e=Si(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,nr(h<<16|p,l<<16|f,this.unsigned)};Oe.subtract=function(e){return oa(e)||(e=Si(e)),this.add(e.neg())};Oe.sub=Oe.subtract;Oe.multiply=function(e){if(this.isZero())return Ya;if(oa(e)||(e=Si(e)),ja){var t=ja.mul(this.low,this.high,e.low,e.high);return nr(t,ja.get_high(),this.unsigned)}if(e.isZero())return Ya;if(this.eq(aa))return e.isOdd()?aa:Ya;if(e.eq(aa))return this.isOdd()?aa:Ya;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(ZB)&&e.lt(ZB))return Xa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,nr(p<<16|d,f<<16|h,this.unsigned)};Oe.mul=Oe.multiply;Oe.divide=function(e){if(oa(e)||(e=Si(e)),e.isZero())throw Error("division by zero");if(ja){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?ja.div_u:ja.div_s)(this.low,this.high,e.low,e.high);return nr(t,ja.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?nu:Ya;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return nu;if(e.gt(this.shru(1)))return CL;i=nu}else{if(this.eq(aa)){if(e.eq(Ic)||e.eq(E1))return aa;if(e.eq(aa))return Ic;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Ya)?e.isNegative()?Ic:E1:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(aa))return this.unsigned?nu:Ya;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ya}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:_v(2,s-48),c=Xa(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Xa(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=Ic),i=i.add(c),a=a.sub(l)}return i};Oe.div=Oe.divide;Oe.modulo=function(e){if(oa(e)||(e=Si(e)),ja){var t=(this.unsigned?ja.rem_u:ja.rem_s)(this.low,this.high,e.low,e.high);return nr(t,ja.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Oe.mod=Oe.modulo;Oe.rem=Oe.modulo;Oe.not=function(){return nr(~this.low,~this.high,this.unsigned)};Oe.and=function(e){return oa(e)||(e=Si(e)),nr(this.low&e.low,this.high&e.high,this.unsigned)};Oe.or=function(e){return oa(e)||(e=Si(e)),nr(this.low|e.low,this.high|e.high,this.unsigned)};Oe.xor=function(e){return oa(e)||(e=Si(e)),nr(this.low^e.low,this.high^e.high,this.unsigned)};Oe.shiftLeft=function(e){return oa(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):nr(0,this.low<<e-32,this.unsigned)};Oe.shl=Oe.shiftLeft;Oe.shiftRight=function(e){return oa(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):nr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Oe.shr=Oe.shiftRight;Oe.shiftRightUnsigned=function(e){if(oa(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return nr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?nr(t,0,this.unsigned):nr(t>>>e-32,0,this.unsigned)};Oe.shru=Oe.shiftRightUnsigned;Oe.shr_u=Oe.shiftRightUnsigned;Oe.toSigned=function(){return this.unsigned?nr(this.low,this.high,!1):this};Oe.toUnsigned=function(){return this.unsigned?this:nr(this.low,this.high,!0)};Oe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Oe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Oe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};rr.fromBytes=function(e,t,n){return n?rr.fromBytesLE(e,t):rr.fromBytesBE(e,t)};rr.fromBytesLE=function(e,t){return new rr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};rr.fromBytesBE=function(e,t){return new rr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var _L=tEe(EL),aEe=r2e({__proto__:null,default:_L},[EL]),iEe=_L||aEe;function j1(r){return iEe.fromString(r,!0,16)}j1("c3a5c85c97cb3127");j1("b492b66fbe98f273");j1("9ae16a3b2f90404f");function oEe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function FL(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=nh(r)),Pn().getBool("DEBUG")&&J2e(r,e),oEe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Fv(){return Pn().platform.now()}function sEe(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Pn().platform.encode(r,e)}function JB(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Pn().platform.decode(r,e)}function ki(r){return Pn().platform.isTypedArray!=null?Pn().platform.isTypedArray(r):eEe(r)}function nh(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||G1(r)||r==null||ki(r)&&t)e.push(r);else if(Array.isArray(r)||ki(r))for(var i=0;i<r.length;++i)nh(r[i],e,t);else{var o=-1;try{for(var s=Ur(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)nh(r[i],e,t)}return e}var uEe=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new lEe)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=Fv();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=Ur(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Fv()-c})}if(Pn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){cEe(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r}();function cEe(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var lEe=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?Iv("".concat(a,"ms"),9):a.error,u=Iv(e,25),c=t.rank,l=t.size,f=Iv(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function fEe(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function hEe(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!su(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var QB=20,Xf=3,f1=7;function pEe(r,e,t,n){var a=U1(e),i=dEe(r,e,t,a),o=e.length,s=Cv(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function dEe(r,e,t,n){var a=Zr(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Qf(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Jf(u[l+f],0,t).length);return o}function Jf(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(f1))," + ")+"".concat(parseFloat(r[1].toFixed(f1)),"j"):q1(r)?n="'".concat(r,"'"):t==="bool"?n=RL(r):n=parseFloat(r.toFixed(f1)).toString(),Iv(n,e)}function RL(r){return r===0?"false":"true"}function Cv(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Qf(r);return[Jf(c[0],0,t)]}return t==="bool"?[RL(r[0])]:[r[0].toString()]}if(u===1){if(s>QB){var l=Xf*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-Xf)*o,s*o));return t==="complex64"&&(f=Qf(f),h=Qf(h)),["["+f.map(function(T,E){return Jf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Jf(T,a[s-Xf+E],t)}).join(", ")+"]"]}var p=t==="complex64"?Qf(r):Array.from(r);return["["+p.map(function(T,E){return Jf(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>QB){for(var y=0;y<Xf;y++){var w=y*v,b=w+v;g.push.apply(g,Ft([],we(Cv(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-Xf;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Ft([],we(Cv(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Ft([],we(Cv(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function Qf(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var I1=function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Zr(e),n!=null){var i=n.length;V(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||mL(t,this.size),this.strides=U1(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),V(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=Ur(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return xi().makeTensor(this.values,this.shape,this.dtype)},r}(),xi=null,Yf=null;function vEe(r){xi=r}var na=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Zr(e),this.strides=U1(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return Et(this,void 0,void 0,function(){var e;return Nt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Yf.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return Yf.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Et(this,void 0,void 0,function(){var e;return Nt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,zB(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return zB(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Et(this,void 0,void 0,function(){var e,t;return Nt(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=xi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return JB(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),xi().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=xi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return JB(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Et(this,void 0,void 0,function(){var e;return Nt(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,xi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),xi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),Yf.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Yf.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return pEe(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Yf.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),xi().makeVariable(this,e,t,n)},r}();Object.defineProperty(na,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function OL(){return H1("Tensor",function(){return na})}OL();var C1=function(r){hL(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!su(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));xi().disposeTensor(this),this.dataId=t.dataId,xi().incRef(this,null)},e.prototype.dispose=function(){xi().disposeVariable(this),this.isDisposedInternal=!0},e}(na);Object.defineProperty(C1,Symbol.hasInstance,{value:function(r){return r instanceof na&&r.assign!=null&&r.assign instanceof Function}});var eL;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(eL||(eL={}));var A1;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(A1||(A1={}));var D1;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(D1||(D1={}));var _1;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(_1||(_1={}));var F1;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(F1||(F1={}));var mEe={float32:_1,int32:A1,bool:D1,complex64:F1};function gEe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return mEe[r][e]}function PL(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function ML(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function Er(r,e){if(r.dtype===e.dtype)return[r,e];var t=gEe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function yEe(r,e){V(r.dtype===e.dtype,function(){return"The dtypes of the first(".concat(r.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function BL(r){var e=[],t=new Set;return LL(r,e,t),e}function LL(r,e,t){if(r!=null){if(r instanceof na){e.push(r);return}if(!!bEe(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),LL(i,e,t))}}}}function bEe(r){return Array.isArray(r)||typeof r=="object"}function h1(r){return r.kernelName!=null}var tL=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),X1=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new tL}return r.prototype.ready=function(){return Et(this,void 0,void 0,function(){var e,t,n,a;return Nt(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(jf("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Et(this,void 0,void 0,function(){var t,n,a,i,o;return Nt(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new uEe(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=HB(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=HB(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof j2e)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,jf("Initialization of backend ".concat(e," failed")),jf(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return jf("Initialization of backend ".concat(e," failed")),jf(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=Q.runKernel(SL,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return Q.runKernel(kL,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=VB(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=h1(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(h1(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=VB(f,this.backendName);V(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=h1(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=GB(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(V(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&q1(e[0])&&(i=e.map(function(l){return sEe(l)}));var o=a.write(i,t,n),s=new na(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=eSe(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new na(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new C1(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*T1(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof C1||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*T1(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Et(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Nt(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Ft([],we(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=Ur(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=GB(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=V1(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=BL(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),V(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});V(o instanceof na,function(){return"The result y returned by f() must be a tensor."});var s=fEe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??wEe(o.shape),hEe(u,s,function(l){return i.tidy(l)},kEe);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=Ur(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return V(LB(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];V(n.every(function(c){return c instanceof na}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Ft([],we(Ft(Ft([],we(n),!1),[l],!1)),!1)),V(i.value instanceof na,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),V(LB(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];V(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),V(h.every(function(d){return d instanceof na}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Et(this,void 0,void 0,function(){var t,n;return Nt(this,function(a){switch(a.label){case 0:return t=Fv(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Fv()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new tL;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();X1.nextTensorId=0;X1.nextVariableId=0;function wEe(r){var e=yL(Zr(r),"float32");return Q.makeTensor(e,r,"float32")}function xEe(){var r=wL();if(r._tfengine==null){var e=new nSe(r);r._tfengine=new X1(e)}return sSe(r._tfengine.ENV),vEe(function(){return r._tfengine}),r._tfengine}var Q=xEe();function kEe(r,e){var t={a:r,b:e};return Q.runKernel(xL,t)}function as(r,e){var t=r;if(ki(r))return e==="string"?[]:[r.length];if(PL(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(ML(r))return[r.buffer.size/(e==null?4:T1(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||ki(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&Pn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&zL(r,a,[]),a}function zL(r,e,t){if(t=t||[],!Array.isArray(r)&&!ki(r)){V(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}V(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),V(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)zL(r[a],n,t.concat(a))}function rL(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function M(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof OL())return rL(n,r.dtype,e,t),r;var a=Uv(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),rL(n,a,e,t),r==null||!ki(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=as(r,a);!ki(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?FL(r,a):nh(r,[],s);return Q.makeTensor(u,o,a)}function Rv(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return M(i,"".concat(e,"[").concat(o,"]"),t,n)})}var $L="__op";function K(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+$L;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Q.startScope(t);try{var s=n.apply(void 0,Ft([],we(i),!1));return G1(s)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(s),s}catch(u){throw Q.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function SEe(r){var e=M(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return Q.runKernel(FSe,t)}else{var t={x:e};return Q.runKernel(cSe,t)}}var Ha=K({abs_:SEe});function NEe(r){var e=M(r,"x","acos"),t={x:e};return Q.runKernel(lSe,t)}var TEe=K({acos_:NEe});function EEe(r){var e=M(r,"x","acosh"),t={x:e};return Q.runKernel(fSe,t)}var IEe=K({acosh_:EEe});function CEe(r,e){var t,n=M(r,"a","add"),a=M(e,"b","add");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(xL,i)}var Jr=K({add_:CEe});function AEe(r){V(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),V(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(r.length)});var e=r.map(function(a,i){return M(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!su(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return Q.runKernel(hSe,n)}var DEe=K({addN_:AEe});function _Ee(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(pSe,a,i)}var FEe=K({all_:_Ee});function REe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(dSe,a,i)}var OEe=K({any_:REe});function PEe(r,e){e===void 0&&(e=0);var t=M(r,"x","argMax"),n={x:t},a={axis:e};return Q.runKernel(vSe,n,a)}var MEe=K({argMax_:PEe});function BEe(r,e){e===void 0&&(e=0);var t=M(r,"x","argMin"),n={x:t},a={axis:e};return Q.runKernel(mSe,n,a)}var LEe=K({argMin_:BEe});function zEe(r){var e=M(r,"x","asin"),t={x:e};return Q.runKernel(gSe,t)}var $Ee=K({asin_:zEe});function WEe(r){var e=M(r,"x","asinh"),t={x:e};return Q.runKernel(ySe,t)}var qEe=K({asinh_:WEe});function UEe(r){var e=M(r,"x","atan"),t={x:e};return Q.runKernel(bSe,t)}var VEe=K({atan_:UEe});function GEe(r,e){var t,n=M(r,"a","atan2"),a=M(e,"b","atan2");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(xSe,i)}var HEe=K({atan2_:GEe});function KEe(r){var e=M(r,"x","atanh"),t={x:e};return Q.runKernel(wSe,t)}var jEe=K({atanh_:KEe});function XEe(r,e){var t=M(r,"x","cast");if(!Q2e(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return Q.runKernel(kL,n,a)}var Vr=K({cast_:XEe});function YEe(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=we(ah(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,r[3],r[3]];else if(o==="channelsFirst")l=[u,c,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return Y1(r,l,t,n,a,i,!1,o)}function Y1(r,e,t,n,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=we([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=we(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=we(r,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var m=we(e,4),v=m[0],g=m[1],y=m[3],w=we(ah(t),2),b=w[0],x=w[1],S=we(ah(n),2),T=S[0],E=S[1],C=R1(v,T),R=R1(g,E),_=QEe(a,h,p,b,x,C,R,i,s),P=_.padInfo,$=_.outHeight,z=_.outWidth,L=o?y*d:y,B;return s==="channelsFirst"?B=[f,L,$,z]:s==="channelsLast"&&(B=[f,$,z,L]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:$,outWidth:z,outChannels:L,padInfo:P,strideHeight:b,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:T,dilationWidth:E,inShape:r,outShape:B,filterShape:e}}function ZEe(r,e,t,n,a){n==null&&(n=JEe(r,e,t));var i=r[0],o=r[1],s=Ov((i-e+2*n)/t+1,a),u=Ov((o-e+2*n)/t+1,a);return[s,u]}function JEe(r,e,t,n){n===void 0&&(n=1);var a=R1(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function ah(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function R1(r,e){return e<=1?r:r+(r-1)*(e-1)}function QEe(r,e,t,n,a,i,o,s,u){var c,l,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";c={top:r,bottom:r,left:r,right:r,type:h};var p=ZEe([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),w=m-y;c={top:v,bottom:g,left:y,right:w,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],w=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT";c={top:v,bottom:g,left:y,right:w,type:h},l=Ov((e-i+v+g)/n+1,s),f=Ov((t-o+y+w)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:c,outHeight:l,outWidth:f}}function Ov(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode ".concat(e))}}function Pv(r){var e=we(ah(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function is(r,e){return Pv(r)||Pv(e)}function Rc(r){return ah(r).every(function(e){return e>0})}function Ni(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")V(rh(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){V(rh(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function eIe(r,e){var t=M(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return Q.runKernel(sTe,n,a)}var ge=K({reshape_:eIe});function tIe(r,e,t,n,a){var i=M(r,"x","avgPool","float32"),o=1;V(is(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),Ni("avgPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=Q.runKernel(kSe,c,l);return f=Vr(f,i.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var WL=K({avgPool_:tIe});function rIe(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=M(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),V(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),V(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),Ni("avgPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(SSe,c,l);return f=Vr(f,s.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var nIe=K({avgPool3d_:rIe});function aIe(r){var e=M(r,"x","clone","string_or_numeric"),t={x:e};return Q.runKernel(SL,t)}var Cc=K({clone_:aIe});function iIe(r,e){e===void 0&&(e=0),V(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Rv(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return Cc(t[0]);var n=t,a={axis:e};return Q.runKernel(RSe,n,a)}var ia=K({concat_:iIe});function oIe(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=M(r,"a","matMul"),o=M(e,"b","matMul");a=we(Er(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return Q.runKernel(NSe,s,u)}var zt=K({matMul_:oIe});function sIe(r,e){var t,n=M(r,"a","mul"),a=M(e,"b","mul");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(WNe,i)}var gt=K({mul_:sIe});function uIe(r){var e=M(r,"x","sigmoid","float32"),t={x:e};return Q.runKernel(STe,t)}var Ac=K({sigmoid_:uIe});function cIe(r,e,t){var n=M(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return Q.runKernel(bTe,a,i)}var dr=K({slice_:cIe});function lIe(r){var e=M(r,"x","tanh","float32"),t={x:e};return Q.runKernel(UTe,t)}var O1=K({tanh_:lIe});function fIe(r,e,t,n,a,i){var o=M(r,"forgetBias","basicLSTMCell"),s=M(e,"lstmKernel","basicLSTMCell"),u=M(t,"lstmBias","basicLSTMCell"),c=M(n,"data","basicLSTMCell"),l=M(a,"c","basicLSTMCell"),f=M(i,"h","basicLSTMCell"),h=ia([c,f],1),p=zt(h,s),d=Jr(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=dr(d,[0,0],g),w=dr(d,[0,v],g),b=dr(d,[0,v*2],g),x=dr(d,[0,v*3],g),S=Jr(gt(Ac(y),O1(w)),gt(l,Ac(Jr(o,b)))),T=gt(O1(S),Ac(x));return[S,T]}var hIe=K({basicLSTMCell_:fIe});function pIe(r,e,t){var n=M(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});V(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),V(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),V(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return Q.runKernel(TSe,i,o)}var qL=K({batchToSpaceND_:pIe});function dIe(r){var e;return r.rank===0||r.rank===1?e=ge(r,[1,1,1,r.size]):r.rank===2?e=ge(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function vIe(r,e,t,n,a,i){i==null&&(i=.001);var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;n!=null&&(l=M(n,"offset","batchNorm")),V(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),V(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),V(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=dIe(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=Q.runKernel(lNe,h,p);return ge(d,o.shape)}var Vv=K({batchNorm_:vIe});function mIe(r,e,t,n,a,i){var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return n!=null&&(l=M(n,"offset","batchNorm")),V(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),V(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),V(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&V(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&V(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),Vv(o,s,u,l,c,i)}var gIe=K({batchNorm2d_:mIe});function yIe(r,e,t,n,a,i){var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return n!=null&&(l=M(n,"offset","batchNorm")),V(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),V(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),V(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&V(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&V(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),Vv(o,s,u,l,c,i)}var bIe=K({batchNorm3d_:yIe});function wIe(r,e,t,n,a,i){var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return n!=null&&(l=M(n,"offset","batchNorm")),V(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),V(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),V(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&V(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&V(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),Vv(o,s,u,l,c,i)}var xIe=K({batchNorm4d_:wIe});function kIe(r,e,t){var n=M(r,"x","bincount"),a=M(e,"weights","bincount");V(n.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(n.dtype)}),V(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),V(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(n.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:n,weights:a},o={size:t};return Q.runKernel(ESe,i,o)}var UL=K({bincount_:kIe});function SIe(r,e){var t=M(r,"x","bitwiseAnd"),n=M(e,"y","bitwiseAnd");if(!su(t.shape,n.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(t.shape,", y: ").concat(n.shape));if(t.dtype!=="int32"||n.dtype!=="int32")throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(t.dtype," and type of y: ").concat(n.dtype));var a={a:t,b:n};return Q.runKernel(ISe,a)}var NIe=K({bitwiseAnd_:SIe});function TIe(r,e){var t=M(r,"s0","broadcastArgs","int32"),n=M(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(n.rank));var a={s0:t,s1:n};return Q.runKernel(CSe,a)}var EIe=K({broadcastArgs_:TIe});function IIe(r,e){var t=M(r,"broadcastTo","x"),n=t.shape;if(wa(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ge(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return Cc(t);var c={x:t},l={reps:o};return Q.runKernel(NL,c,l)}var Av=K({broadcastTo_:IIe});function rs(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",wa(r),new I1(r,e,t)}function CIe(r){var e=M(r,"x","ceil","float32"),t={x:e};return Q.runKernel(ASe,t)}var AIe=K({ceil_:CIe});function Gv(r,e,t){wa(r),t=t||Uv(e);var n={shape:r,value:e,dtype:t};return Q.runKernel(oNe,{},n)}function DIe(r,e,t){var n=M(r,"x","clipByValue");if(V(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return Gv(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return Q.runKernel(DSe,a,i)}var _Ie=K({clipByValue_:DIe});function FIe(r,e){var t=M(r,"real","complex"),n=M(e,"imag","complex");Ja(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return Q.runKernel(_Se,a)}var ns=K({complex_:FIe});function RIe(r){return ia(r,0)}var OIe=K({concat1d_:RIe});function PIe(r,e){return ia(r,e)}var MIe=K({concat2d_:PIe});function BIe(r,e){return ia(r,e)}var LIe=K({concat3d_:BIe});function zIe(r,e){return ia(r,e)}var $Ie=K({concat4d_:zIe});function WIe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(r,"x","conv2d","float32"),u=M(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),V(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),V(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Ni("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];V(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),V(is(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),V(Rc(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),V(Rc(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(OSe,h,p);return l?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Hv=K({conv2d_:WIe});function qIe(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=M(r,"x","conv1d"),u=M(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1]])),V(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),V(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),Ni("conv1d",n,o),V(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),V(is(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),V(Rc(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),V(Rc(t),function(){return"Error in conv1D: Stride should be larger than 0."}),V(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ge(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ge(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=Hv(h,f,p,n,m,d,o);return l?ge(v,[v.shape[2],v.shape[3]]):ge(v,[v.shape[0],v.shape[2],v.shape[3]])}var UIe=K({conv1d_:qIe});function VIe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),V(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),V(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),V(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),V(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];V(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),V(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Ni("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=Q.runKernel(MSe,h,p);return c?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var VL=K({conv2DBackpropInput_:VIe});function GIe(r,e,t,n,a,i){var o=M(r,"x","conv2dTranspose"),s=M(e,"filter","conv2dTranspose");return VL(t,o,s,n,a,"NHWC",i)}var HIe=K({conv2dTranspose_:GIe});function KIe(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=M(r,"x","conv3d"),s=M(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),V(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),V(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),V(is(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),V(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),V(Rc(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),V(Rc(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=Q.runKernel(BSe,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var jIe=K({conv3d_:KIe});function XIe(r,e,t,n,a){V(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];V(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),V(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),V(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),V(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),V(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=Q.runKernel(LSe,l,f);return s?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var YIe=K({conv3DBackpropInput_:XIe});function ZIe(r,e,t,n,a){var i=M(r,"x","conv3dTranspose"),o=M(e,"filter","conv3dTranspose");return YIe(t,i,o,n,a)}var JIe=K({conv3dTranspose_:ZIe});function QIe(r){var e=M(r,"x","cos","float32"),t={x:e};return Q.runKernel(zSe,t)}var eCe=K({cos_:QIe});function tCe(r){var e=M(r,"x","cosh","float32"),t={x:e};return Q.runKernel($Se,t)}var rCe=K({cosh_:tCe});function nCe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return Q.runKernel(WSe,i,o)}var aCe=K({cumprod_:nCe});function iCe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return Q.runKernel(qSe,i,o)}var oCe=K({cumsum_:iCe});function sCe(r,e,t,n){n===void 0&&(n=!1);var a=M(r,"x","denseBincount"),i=M(e,"weights","denseBincount");V(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),V(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),V(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),V(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return Q.runKernel(VSe,o,s)}var uCe=K({denseBincount_:sCe});function cCe(r,e,t){t===void 0&&(t="NHWC");var n=M(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];V(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),V(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(n.shape)}),V(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(n.shape)}),V(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(n.shape)});var s={x:n},u={blockSize:e,dataFormat:t};return Q.runKernel(GSe,s,u)}var lCe=K({depthToSpace_:cCe});function fCe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(r,"x","depthwiseConv2d","float32"),u=M(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),V(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),V(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];V(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),Ni("depthwiseConv2d",n,o);var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(HSe,h,p);return l?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Z1=K({depthwiseConv2d_:fCe});function hCe(r){var e=M(r,"x","diag"),t={x:e};return Q.runKernel(XSe,t)}var pCe=K({diag_:hCe});function dCe(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=M(r,"x","dilation2d"),s=M(e,"filter","dilation2d");V(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),V(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),V(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),V(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=Q.runKernel(YSe,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var vCe=K({dilation2d_:dCe});function mCe(r,e){var t,n=M(r,"a","floorDiv"),a=M(e,"b","floorDiv");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(cNe,i)}var GL=K({floorDiv_:mCe});function gCe(r,e){var t,n=M(r,"a","div"),a=M(e,"b","div");if(t=we(Er(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return GL(n,a);var i={a:n,b:a},o={};return Q.runKernel(ZSe,i,o)}var kn=K({div_:gCe});function yCe(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Qr(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}function bCe(r,e){var t,n=M(r,"a","equal","string_or_numeric"),a=M(e,"b","equal","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(tNe,i)}var HL=K({equal_:bCe});function wCe(r,e,t){var n=M(e,"a","where"),a=M(t,"b","where"),i=M(r,"condition","where","bool"),o=Qr(Qr(i.shape,n.shape),a.shape),s=Av(i,o),u=Av(n,o),c=Av(a,o),l={condition:s,t:u,e:c};return Q.runKernel(gTe,l)}var ts=K({where_:wCe});function xCe(r){var e=M(r,"x","zerosLike"),t={x:e};return Q.runKernel(XTe,t)}var J1=K({zerosLike_:xCe});function kCe(r,e){var t,n=M(r,"a","div"),a=M(e,"b","div");t=we(Er(n,a),2),n=t[0],a=t[1];var i=kn(n,a),o=J1(i),s=HL(a,o);return ts(s,o,i)}var SCe=K({divNoNan_:kCe});function NCe(r,e){var t=M(r,"t1","dot"),n=M(e,"t2","dot");V((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(V(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&n.rank===1){var o=ge(t,[1,-1]),s=ge(n,[-1,1]),u=zt(o,s);return ge(u,[])}else if(t.rank===1&&n.rank===2){var o=ge(t,[1,-1]),s=ge(n,[n.shape[0],n.shape[1]]),u=zt(o,s);return ge(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=ge(n,[-1,1]),u=zt(t,s);return ge(u,[u.size])}else{var s=ge(n,[n.shape[0],n.shape[1]]),u=zt(t,s);return u}}var TCe=K({dot_:NCe});function ECe(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return M(i,"tensors".concat(o),"einsum")}),a={equation:r};return Q.runKernel(JSe,n,a)}var Ec=K({einsum_:ECe});function ICe(r){var e=M(r,"x","elu","float32"),t={x:e};return Q.runKernel(QSe,t)}var KL=K({elu_:ICe});function CCe(r,e){var t=M(r,"x","ensureShape","string_or_numeric");if(!X2e(t.shape,e))throw new Error("EnsureShape: Shape of tensor ".concat(t.shape," is not compatible with expected shape ").concat(e));return r}var ACe=K({ensureShape_:CCe});function DCe(r){var e=M(r,"x","erf");V(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=Vr(e,"float32"));var t={x:e};return Q.runKernel(eNe,t)}var _Ce=K({erf_:DCe});function FCe(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function Kv(r,e){var t=e.map(function(n){return 1});return FCe(r,t,e)}function RCe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return Q.runKernel(DNe,a,i)}var Dc=K({max_:RCe});function OCe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(MNe,a,i)}var P1=K({min_:OCe});function PCe(r,e){var t,n=M(r,"base","pow"),a=M(e,"exp","pow");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(ZNe,i)}var Q1=K({pow_:PCe});function os(r,e,t,n){if(n==null)n=Uv(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(ML(r)||PL(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return Q.backend.createTensorFromGPUData(r,e||t,n)}if(!ki(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){wa(e);var a=Zr(e),i=Zr(t);V(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Zr(e.slice(o)):!0;V(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!ki(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?FL(r,n):nh(r,[],!0),Q.makeTensor(r,e,n)}function Dr(r,e){if((ki(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ki(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return os(r,t,n,e)}function MCe(r){var e=M(r,"x","sqrt","float32"),t={x:e};return Q.runKernel(TTe,t)}var M1=K({sqrt_:MCe});function BCe(r){var e=M(r,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}var jv=K({square_:BCe});function LCe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","sum");n.dtype==="bool"&&(n=Vr(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return Q.runKernel(ETe,a,i)}var tr=K({sum_:LCe});function zCe(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=M(r,"x","norm");var a=jL(r,e,t),i=a.shape;if(n){var o=qv(t,r.shape);i=Kv(a.shape,o)}return ge(a,i)}function jL(r,e,t){if(t===void 0&&(t=null),r.rank===0)return Ha(r);if(r.rank!==1&&t===null)return jL(ge(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return tr(Ha(r),t);if(e===1/0)return Dc(Ha(r),t);if(e===-1/0)return P1(Ha(r),t);if(e==="euclidean"||e===2)return M1(tr(Q1(Ha(r),Dr(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return Dc(tr(Ha(r),t[0]),t[1]-1);if(e===1/0)return Dc(tr(Ha(r),t[1]),t[0]);if(e===-1/0)return P1(tr(Ha(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return M1(tr(jv(r),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var Xv=K({norm_:zCe});function $Ce(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),Xv(r,"euclidean",e,t)}var WCe=K({euclideanNorm_:$Ce});function qCe(r){var e=M(r,"x","exp"),t={x:e};return Q.runKernel(rNe,t)}var iu=K({exp_:qCe});function UCe(r,e){e===void 0&&(e=0);var t=M(r,"x","expandDims","string_or_numeric");V(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return Q.runKernel(nNe,n,a)}var es=K({expandDims_:UCe});function VCe(r){var e=M(r,"x","expm1"),t={x:e};return Q.runKernel(aNe,t)}var GCe=K({expm1_:VCe});function HCe(r,e){var t=M(r,"x","tile","string_or_numeric");V(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return Q.runKernel(NL,n,a)}var eh=K({tile_:HCe});function KCe(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=rs([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=ge(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return eh(es(s,0),[t[0],1,1]);if(t.length===2)return eh(es(es(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return eh(es(es(es(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var XL=K({eye_:KCe});function jCe(r){var e=M(r,"x","floor","float32"),t={x:e};return Q.runKernel(uNe,t)}var YL=K({floor_:jCe});function XCe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=M(r,"x","gather"),i=M(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return Q.runKernel(fNe,o,s)}var ZL=K({gather_:XCe});function YCe(r,e){var t,n=M(r,"a","greater","string_or_numeric"),a=M(e,"b","greater","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(pNe,i)}var Yv=K({greater_:YCe});function ZCe(r,e){var t,n=M(r,"a","greaterEqual","string_or_numeric"),a=M(e,"b","greaterEqual","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(dNe,i)}var JL=K({greaterEqual_:ZCe});function JCe(r){var e=M(r,"input","imag"),t={input:e};return Q.runKernel(mNe,t)}var Zv=K({imag_:JCe});function QCe(r){var e=M(r,"x","isFinite"),t={x:e};return Q.runKernel(gNe,t)}var eAe=K({isFinite_:QCe});function tAe(r){var e=M(r,"x","isInf"),t={x:e};return Q.runKernel(yNe,t)}var rAe=K({isInf_:tAe});function nAe(r){var e=M(r,"x","isNaN"),t={x:e};return Q.runKernel(bNe,t)}var aAe=K({isNaN_:nAe});function iAe(r,e){e===void 0&&(e=.2);var t=M(r,"x","leakyRelu"),n={x:t},a={alpha:e};return Q.runKernel(wNe,n,a)}var QL=K({leakyRelu_:iAe});function oAe(r,e){var t,n=M(r,"a","less","string_or_numeric"),a=M(e,"b","less","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(xNe,i)}var B1=K({less_:oAe});function sAe(r,e){var t,n=M(r,"a","lessEqual","string_or_numeric"),a=M(e,"b","lessEqual","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(kNe,i)}var ex=K({lessEqual_:sAe});function uAe(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return Q.runKernel(SNe,{},n)}function cAe(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=M(r,"x","localResponseNormalization");V(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),V(rh(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=Q.runKernel(ANe,u,c);return s?ge(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var lAe=K({localResponseNormalization_:cAe});function fAe(r){var e=M(r,"x","log","float32"),t={x:e};return Q.runKernel(NNe,t)}var ih=K({log_:fAe});function hAe(r){var e=M(r,"x","log1p"),t={x:e};return Q.runKernel(TNe,t)}var ez=K({log1p_:hAe});function lo(r){return Q.customGrad(r)}function pAe(r){var e=M(r,"x","neg"),t={x:e};return Q.runKernel(qNe,t)}var Bi=K({neg_:pAe});function dAe(r){var e=M(r,"x","softplus"),t={x:e};return Q.runKernel(NTe,t)}var tz=K({softplus_:dAe});function vAe(r){var e=M(r,"x","logSigmoid"),t=lo(function(n){var a=Bi(tz(Bi(n))),i=function(o){var s=gt(o,Ac(Bi(n)));return s};return{value:a,gradFunc:i}});return t(e)}var mAe=K({logSigmoid_:vAe});function gAe(r,e){var t,n=M(r,"a","sub"),a=M(e,"b","sub");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(WTe,i)}var Dt=K({sub_:gAe});function yAe(r,e){e===void 0&&(e=-1);var t=M(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var n=lo(function(a,i){var o=!0,s=Dc(a,e,!0),u=Dt(a,s),c=Dt(Vr(u,"float32"),ih(tr(iu(u),e,o)));i([c]);var l=function(f,h){var p=we(h,1),d=p[0],m=!0,v=iu(d);return Dt(f,gt(tr(f,e,m),v))};return{value:c,gradFunc:l}});return n(t)}var bAe=K({logSoftmax_:yAe});function wAe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","logSumExp"),a=qv(e,n.shape),i=Dc(n,a,!0),o=Dt(n,i),s=iu(o),u=tr(s,a),c=ih(u),l=Jr(ge(i,c.shape),c);if(t){var f=Kv(l.shape,a);return ge(l,f)}return l}var rz=K({logSumExp_:wAe});function xAe(r,e){var t=M(r,"a","logicalAnd","bool"),n=M(e,"b","logicalAnd","bool");Qr(t.shape,n.shape);var a={a:t,b:n};return Q.runKernel(ENe,a)}var Mv=K({logicalAnd_:xAe});function kAe(r){var e=M(r,"x","logicalNot","bool"),t={x:e};return Q.runKernel(INe,t)}var nz=K({logicalNot_:kAe});function SAe(r,e){var t=M(r,"a","logicalOr","bool"),n=M(e,"b","logicalOr","bool");Qr(t.shape,n.shape);var a={a:t,b:n};return Q.runKernel(CNe,a)}var az=K({logicalOr_:SAe});function NAe(r,e){var t=M(r,"a","logicalXor","bool"),n=M(e,"b","logicalXor","bool");return Qr(t.shape,n.shape),Mv(az(r,e),nz(Mv(r,e)))}var TAe=K({logicalXor_:NAe});var Nv=2147483648;function EAe(r,e,t){t===void 0&&(t="left");var n=M(r,"sortedSequence","searchSorted"),a=M(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=ge(n,[-1,i]),u=ge(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Zr(u.shape)>=Nv)throw new Error("values tensor size must less than ".concat(Nv));if(s.shape[1]>=Nv)throw new Error("trailing dim_size must less than ".concat(Nv," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return Q.runKernel(mTe,c,l)}var tx=K({searchSorted_:EAe});function IAe(r,e){return tx(r,e,"left")}function CAe(r,e,t,n,a){var i=M(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),V(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),V(is(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),Ni("maxPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=Q.runKernel(FNe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var iz=K({maxPool_:CAe});function AAe(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=M(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),V(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),V(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),Ni("maxPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(RNe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var DAe=K({maxPool3d_:AAe});function _Ae(r,e,t,n,a){a===void 0&&(a=!1);var i=M(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=Q.runKernel(ONe,o,s);return{result:u[0],indexes:u[1]}}var FAe=K({maxPoolWithArgmax_:_Ae});function RAe(r,e){var t,n=M(r,"a","maximum"),a=M(e,"b","maximum");t=we(Er(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Vr(n,"int32"),a=Vr(a,"int32")),Qr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(_Ne,i)}var OAe=K({maximum_:RAe});function PAe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(PNe,a,i)}var Bv=K({mean_:PAe});function Oc(r,e){if(e===void 0&&(e="float32"),wa(r),e==="complex64"){var t=Oc(r,"float32"),n=Oc(r,"float32");return ns(t,n)}var a=V1(Zr(r),e);return Q.makeTensor(a,r,e)}function au(r,e){if(e===void 0&&(e="float32"),wa(r),e==="complex64"){var t=au(r,"float32"),n=Oc(r,"float32");return ns(t,n)}var a=yL(Zr(r),e);return Q.makeTensor(a,r,e)}function MAe(r,e,t){var n=t===void 0?{}:t,a=n.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(r===void 0)return[];var o=M(r,"x","meshgrid",r instanceof na?r.dtype:"float32");if(e===void 0)return[o];var s=M(e,"y","meshgrid",e instanceof na?e.dtype:"float32"),u=Zr(o.shape),c=Zr(s.shape);return i==="xy"?(o=ge(o,[1,-1]),s=ge(s,[-1,1]),[zt(au([c,1],o.dtype),o),zt(s,au([1,u],s.dtype))]):(o=ge(o,[-1,1]),s=ge(s,[1,-1]),[zt(o,au([1,c],o.dtype)),zt(au([u,1],s.dtype),s)])}function BAe(r,e){var t,n=M(r,"a","minimum"),a=M(e,"b","minimum");t=we(Er(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Vr(n,"int32"),a=Vr(a,"int32")),Qr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(BNe,i)}var Lv=K({minimum_:BAe});function LAe(r,e,t){V(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var n=M(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");V(e.length===n.rank,function(){return"Padding doesn't match input. Must be ".concat(n.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){V(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),V(e[c][0]>=0&&e[c][0]<=n.shape[c]-a&&e[c][1]>=0&&e[c][1]<=n.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(n.shape[c]-a," or less than 0 for input of ")+"shape ".concat(n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return Q.runKernel(LNe,u,s)}var zAe=K({mirrorPad_:LAe});function $Ae(r,e){var t,n=M(r,"a","mod"),a=M(e,"b","mod");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(zNe,i)}var WAe=K({mod_:$Ae});function qAe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=M(r,"x","moments");var n=qv(e,r.shape),a=Bv(r,n,t),i=a.shape;t||(i=Kv(a.shape,n));var o=jv(Dt(Vr(r,"float32"),ge(a,i))),s=Bv(o,n,t);return{mean:a,variance:s}}var UAe=K({moments_:qAe});function VAe(r,e,t,n){for(var a=M(e,"data","multiRNNCell"),i=Rv(t,"c","multiRNNCell"),o=Rv(n,"h","multiRNNCell"),s=a,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var GAe=K({multiRNNCell_:VAe});function HAe(r,e,t,n){n===void 0&&(n=!1);var a=M(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ge(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:n},l=Q.runKernel($Ne,u,c);return o===1?ge(l,[l.size]):l}var KAe=K({multinomial_:HAe});function jAe(r,e){var t,n=M(r,"a","notEqual","string_or_numeric"),a=M(e,"b","notEqual","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(UNe,i)}var oz=K({notEqual_:jAe});function XAe(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=M(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return Q.runKernel(jNe,o,s)}var YAe=K({oneHot_:XAe});function ZAe(r){var e=M(r,"x","onesLike"),t={x:e};return Q.runKernel(KNe,t)}var JAe=K({onesLike_:ZAe});function QAe(r,e){var t=M(r,"v1","outerProduct"),n=M(e,"v2","outerProduct");V(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=ge(t,[-1,1]),i=ge(n,[1,-1]);return zt(a,i)}var eDe=K({outerProduct_:QAe});function tDe(r,e,t){t===void 0&&(t=0);var n=M(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return Q.runKernel(YNe,i,a)}var lh=K({pad_:tDe});function rDe(r,e,t){return t===void 0&&(t=0),V(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),lh(r,[e],t)}var nDe=K({pad1d_:rDe});function aDe(r,e,t){return t===void 0&&(t=0),V(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),lh(r,e,t)}var iDe=K({pad2d_:aDe});function oDe(r,e,t){return t===void 0&&(t=0),V(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),lh(r,e,t)}var sDe=K({pad3d_:oDe});function uDe(r,e,t){return t===void 0&&(t=0),V(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),lh(r,e,t)}var cDe=K({pad4d_:uDe});function lDe(r,e,t){var n=M(r,"x","spaceToBatchND");V(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),V(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),V(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return Q.runKernel(ITe,a,i)}var sz=K({spaceToBatchND_:lDe});function fDe(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=M(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),V(is(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=YEe(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=pDe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=we(hDe([l.inHeight,l.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:sz(u,f,m),w=t==="avg"?function(){return WL(y,e,i,g,o)}:function(){return iz(y,e,i,g,o)},b=w(),x=p?b:qL(b,f,v);return c?ge(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function hDe(r,e,t){var n=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=r.concat(n,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[n[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function pDe(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var dDe=K({pool_:fDe});function vDe(r,e){var t=M(r,"x","prelu"),n=M(e,"alpha","prelu"),a={x:t,alpha:n};return Q.runKernel(JNe,a)}var uz=K({prelu_:vDe});function mDe(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}function gDe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","prod");n.dtype==="bool"&&(n=Vr(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return Q.runKernel(QNe,a,i)}var yDe=K({prod_:gDe});function bDe(r,e,t,n){var a=r.map(function(l,f){return M(l,"tensors".concat(f),"raggedGather","int32")}),i=M(e,"paramsDenseValues","raggedGather"),o=M(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},c=Q.runKernel(eTe,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var wDe=K({raggedGather_:bDe});function xDe(r,e,t){var n=M(r,"starts","raggedRange"),a=M(e,"limits","raggedRange",n.dtype),i=M(t,"deltas","raggedRange",n.dtype),o={starts:n,limits:a,deltas:i},s=Q.runKernel(tTe,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var kDe=K({raggedRange_:xDe});function SDe(r,e,t,n,a){var i=M(r,"shape","raggedTensorToTensor","int32"),o=M(e,"values","raggedTensorToTensor"),s=M(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return M(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return Q.runKernel(rTe,c,l)}var NDe=K({raggedTensorToTensor_:SDe});function TDe(r,e,t){wa(r);var n=Zr(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<n;i++)a[i]=e();return Q.makeTensor(a,r,t)}var EDe=K({rand_:TDe}),cz={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(uu,r,!1)})(cz);var IDe=cz.exports,lz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(uu,r,!1)})(lz);var CDe=lz.exports,fz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(uu,r,!1)})(fz);var ADe=fz.exports,hz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(uu,r,!1)})(hz);var DDe=hz.exports,pz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(uu,r,!1)})(pz);var _De=pz.exports,dz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(uu,r,!1)})(dz);var FDe=dz.exports,vz={exports:{}},RDe={},ODe={__proto__:null,default:RDe},PDe=rEe(ODe);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=PDe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:uu,[],Math)})(vz);var MDe=vz.exports,BDe=IDe,LDe=CDe,zDe=ADe,$De=DDe,WDe=_De,qDe=FDe,lu=MDe;lu.alea=BDe;lu.xor128=LDe;lu.xorwow=zDe;lu.xorshift7=$De;lu.xor4096=WDe;lu.tychei=qDe;var rx=lu;var nx=function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=rx.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),UDe=function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=rx.alea(i.toString()),this.randn=new nx(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),VDe=function(){function r(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=rx.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function GDe(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),wa(r),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type ".concat(n));for(var i=new UDe(e,t,n,a),o=rs(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var HDe=K({randomGamma_:GDe});function KDe(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),wa(r),n!=null&&n==="bool")throw new Error("Unsupported data type ".concat(n));for(var i=new nx(e,t,n,!1,a),o=rs(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var mz=K({randomNormal_:KDe});function jDe(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return mz(r,0,1,e,t)}var XDe=K({randomStandardNormal_:jDe});function YDe(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32"),wa(r);for(var i=rs(r,n),o=new VDe(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var ax=K({randomUniform_:YDe});function ZDe(r,e,t,n){return ax(r,e,t,"int32",n)}var JDe=K({randomUniformInt_:ZDe});function oh(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return Q.runKernel(nTe,{},a)}function QDe(r){var e=M(r,"input","real"),t={input:e};return Q.runKernel(aTe,t)}var sh=K({real_:QDe});function e3e(r){var e=M(r,"x","reciprocal"),t={x:e};return Q.runKernel(iTe,t)}var t3e=K({reciprocal_:e3e});function r3e(r){var e=M(r,"x","relu"),t={x:e};return Q.runKernel(oTe,t)}var Jv=K({relu_:r3e});function n3e(r){var e=M(r,"x","relu6"),t={x:e};return Q.runKernel(lTe,t)}var gz=K({relu6_:n3e});function a3e(r,e){var t=M(r,"x","reverse"),n={x:t},a={dims:e};return Q.runKernel(fTe,n,a)}var ou=K({reverse_:a3e});function i3e(r){var e=M(r,"x","reverse");return V(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),ou(e,0)}var o3e=K({reverse1d_:i3e});function s3e(r,e){var t=M(r,"x","reverse");return V(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),ou(t,e)}var u3e=K({reverse2d_:s3e});function c3e(r,e){var t=M(r,"x","reverse");return V(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),ou(t,e)}var l3e=K({reverse3d_:c3e});function f3e(r,e){var t=M(r,"x","reverse");return V(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),ou(t,e)}var h3e=K({reverse4d_:f3e});function p3e(r){var e=M(r,"x","round"),t={x:e};return Q.runKernel(hTe,t)}var yz=K({round_:p3e});function d3e(r){var e=M(r,"x","rsqrt","float32"),t={x:e};return Q.runKernel(pTe,t)}var v3e=K({rsqrt_:d3e});function m3e(r){var e=M(r,"x","selu"),t={x:e};return Q.runKernel(yTe,t)}var g3e=K({selu_:m3e});function y3e(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=M(r,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),c=M(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");V(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),V(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),V(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),V(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),V(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];V(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=Z1(l,u,n,a,o,i),m=1,v=Hv(d,c,m,"valid",o);return f?ge(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var b3e=K({separableConv2d_:y3e});function w3e(r,e){return Et(this,void 0,void 0,function(){var t,n,a,i,o,s,l,u,c,l,f;return Nt(this,function(h){switch(h.label){case 0:return t=M(r,"x","setdiff1d"),n=M(e,"y","setdiff1d"),V(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(n.dtype,").")}),V(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),V(n.rank===1,function(){return"y should be 1D tensor, but got y (".concat(n.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new I1([s],t.dtype),c=new I1([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var x3e=w3e;function k3e(r){var e=M(r,"x","sign"),t={x:e};return Q.runKernel(kTe,t)}var S3e=K({sign_:k3e});function N3e(r){var e=M(r,"x","sin","float32"),t={x:e};return Q.runKernel(wTe,t)}var T3e=K({sin_:N3e});function E3e(r){var e=M(r,"x","sinh"),t={x:e};return Q.runKernel(xTe,t)}var I3e=K({sinh_:E3e});function C3e(r,e,t){var n=M(r,"x","slice1d");return V(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(n.rank," tensor")}),dr(n,[e],[t])}var A3e=K({slice1d_:C3e});function D3e(r,e,t){var n=M(r,"x","slice2d");return V(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(n.rank," tensor")}),dr(n,e,t)}var _3e=K({slice2d_:D3e});function F3e(r,e,t){var n=M(r,"x","slice3d");return V(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(n.rank," tensor")}),dr(n,e,t)}var R3e=K({slice3d_:F3e});function O3e(r,e,t){var n=M(r,"x","slice4d");return V(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(n.rank," tensor")}),dr(n,e,t)}var P3e=K({slice4d_:O3e});function M3e(r,e){e===void 0&&(e=-1);var t=M(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var n={logits:t},a={dim:e};return Q.runKernel(ATe,n,a)}var B3e=K({softmax_:M3e});function L3e(r){V(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return Q.runKernel(iNe,e)}var ix=K({fft_:L3e});function z3e(r){V(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return Q.runKernel(vNe,e)}var zv=K({ifft_:z3e});function $3e(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=ge(r,[t,e]);n=zv(a)}else{var i=[t,2*(e-1)],o=ge(sh(r),[t,e]),s=ge(Zv(r),[t,e]),u=ou(dr(o,[0,1],[t,e-2]),1),c=gt(ou(dr(s,[0,1],[t,e-2]),1),Dr(-1)),l=ia([o,u],1),f=ia([s,c],1),a=ge(ns(l,f),[i[0],i[1]]);n=zv(a)}if(n=sh(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=ge(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var bz=K({irfft_:$3e});function W3e(r,e,t){t===void 0&&(t=0);var n=M(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return Q.runKernel(CTe,a,i)}var uh=K({split_:W3e});function q3e(r,e){V(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(r.dtype)});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=dr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=ia([r,Oc(s)],r.shape.length-1),t=e}else a=r;var u=J1(a),c=ge(ns(a,u),[n,t]),l=ix(c),f=Math.floor(t/2)+1,h=sh(l),p=Zv(l),d=uh(h,[f,t-f],h.shape.length-1),m=uh(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,ge(ns(d[0],m[0]),v)}var ox=K({rfft_:q3e});function U3e(r,e){var t,n=M(r,"a","squaredDifference"),a=M(e,"b","squaredDifference");t=we(Er(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a},o={};return Q.runKernel(PTe,i,o)}var wz=K({squaredDifference_:U3e});function V3e(r,e){var t=M(r,"x","squeeze","string_or_numeric");return ge(t,Y2e(t.shape,e).newShape)}var sx=K({squeeze_:V3e});function G3e(r,e){e===void 0&&(e=0);var t=Rv(r,"tensors","stack","string_or_numeric");V(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&V(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return Q.runKernel(XNe,n,a)}var ch=K({stack_:G3e});function H3e(r,e){e===void 0&&(e=0);var t=M(r,"x","step"),n={x:t},a={alpha:e};return Q.runKernel(YTe,n,a)}var xz=K({step_:H3e});function K3e(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=M(r,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Q.runKernel(BTe,l,f)}var j3e=K({stridedSlice_:K3e});function X3e(r){var e=M(r,"x","tan","float32"),t={x:e};return Q.runKernel(qTe,t)}var Y3e=K({tan_:X3e});function _c(r,e,t){var n=as(r,t);return os(r,e,n,t)}function Za(r,e){Pc(r);var t=as(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return os(r,n,t,e)}function th(r,e,t){if(Pc(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=as(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return os(r,e,n,t)}function Z3e(r,e,t){if(Pc(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=as(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return os(r,e,n,t)}function J3e(r,e,t){if(Pc(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=as(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return os(r,e,n,t)}function Q3e(r,e,t){if(Pc(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=as(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return os(r,e,n,t)}function e_e(r,e,t){if(Pc(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=as(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,os(r,e,n,t)}function t_e(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function kz(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}t_e(t,e,r)}function r_e(r,e,t){var n=M(r,"tensor","tensorScatterupdate"),a=M(e,"indices","tensorScatterupdate","int32"),i=M(t,"updates","tensorScatterupdate");if(kz(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return Q.runKernel(vTe,o,s)}var n_e=K({tensorScatterUpdate_:r_e});function a_e(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=M(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:n},o={k:e,sorted:t},s=we(Q.runKernel(VTe,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var i_e=K({topk_:a_e});function o_e(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),wa(r),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new nx(e,t,n,!0,a),o=rs(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var s_e=K({truncatedNormal_:o_e});function u_e(r,e){e===void 0&&(e=0);var t=M(r,"x","unique","string_or_numeric");V(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=we(Q.runKernel(HTe,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var c_e=K({unique_:u_e});function l_e(r,e,t){var n=M(r,"x","unsortedSegmentSum"),a=M(e,"segmentIds","unsortedSegmentSum","int32");V(rh(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return Q.runKernel(jTe,i,o)}var f_e=K({unsortedSegmentSum_:l_e});function h_e(r,e){e===void 0&&(e=0);var t=M(r,"x","unstack","string_or_numeric");V(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return Q.runKernel(KTe,n,a)}var ux=K({unstack_:h_e});function p_e(r,e){return tx(r,e,"right")}function d_e(r,e,t,n){return e===void 0&&(e=!0),Q.makeVariable(r,e,t,n)}function v_e(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=rs(r,"int32"),i=rs([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function m_e(r){return Et(this,void 0,void 0,function(){var e,t,n;return Nt(this,function(a){switch(a.label){case 0:return e=M(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=v_e(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var Sz=m_e;function g_e(r,e,t){return Et(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m;return Nt(this,function(v){switch(v.label){case 0:for(n=M(r,"tensor","boolMask"),a=M(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,V(o>0,function(){return"mask cannot be scalar"}),Ja(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ge(n,l),h=ge(a,[-1]),[4,Sz(h)];case 1:return p=v.sent(),d=sx(p,[1]),m=ZL(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var y_e=g_e;function b_e(r,e){return Q.tidy(r,e)}function w_e(r){var e=BL(r);e.forEach(function(t){return t.dispose()})}function x_e(){return Q.backendName}function k_e(){return Q.backend}function S_e(r,e,t){var n=M(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),V(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){V(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?b_e(function(){var o=sh(n),s=Zv(n);return o=Q.runKernel(l1,{x:o},i),s=Q.runKernel(l1,{x:s},i),t&&(s=Bi(s)),ns(o,s)}):Q.runKernel(l1,a,i)}var L1=K({transpose_:S_e});function N_e(r,e,t,n,a){a===void 0&&(a=!0);var i=M(r,"v","movingAverage"),o=M(e,"x","movingAverage"),s=M(t,"decay","movingAverage");yEe(i,o),V(su(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Dr(1),c=Dt(u,s),l=gt(Dt(o,i),c);if(a){V(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=M(n,"step","movingAverage");l=kn(l,Dt(u,Q1(s,f)))}return Jr(i,l)}var T_e=K({movingAverage_:N_e});function E_e(r,e,t){wa(t);var n=M(r,"indices","scatterND","int32"),a=M(e,"updates","scatterND");kz(a,n,t);var i={indices:n,updates:a},o={shape:t};return Q.runKernel(dTe,i,o)}var I_e=K({scatterND_:E_e});function C_e(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(r.dtype,"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(r.shape,"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function A_e(r,e,t,n){n===void 0&&(n=0),wa(t);var a=M(r,"sparseIndices","sparseToDense","int32"),i=M(e,"sparseValues","sparseToDense","string_or_numeric"),o=M(n,"defaultValue","sparseToDense",i.dtype);C_e(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return Q.runKernel(OTe,s,u)}var D_e=K({sparseToDense_:A_e});function __e(r,e){var t=M(e,"indices","gatherND","int32"),n=M(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return Q.runKernel(hNe,a)}var F_e=K({gatherND_:__e});function R_e(r,e){if(e==null)return r.shape.slice();if(su(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function O_e(r,e,t,n){var a=M(r,"x","dropout");if(V(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),V(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return r instanceof na?a.clone():a;var i=R_e(a,t),o=1-e,s=kn(YL(Jr(ax(i,0,1,"float32",n),o)),o);return gt(a,s)}var P_e=K({dropout_:O_e});function Nz(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function cx(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return Za(a,"float32")}function M_e(r,e,t){return t===void 0&&(t=1),Et(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,v;return Nt(this,function(g){switch(g.label){case 0:return n=M(r,"predictions","inTopK"),a=M(e,"targets","inTopK"),V(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(n.rank)}),V(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(n.rank," and targets rank ").concat(a.rank)}),Ja(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],V(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=we([o.length/i,i],2),c=u[0],l=u[1],f=Z2e("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,w){return w.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,_c(f,a.shape,"bool")]}})})}var B_e=M_e;function L_e(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]])),V(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),V(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),V(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];V(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),V(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Ni("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return Q.runKernel(PSe,f,h)}var z_e=K({conv2DBackpropFilter_:L_e});function lx(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return gt(r,xz(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function fx(r,e){var t=e,n=yCe(r.shape,e.shape);return n.length>0&&(t=tr(t,n)),ge(t,r.shape)}function hx(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Jv(r);if(e==="elu")return KL(r);if(e==="relu6")return gz(r);if(e==="prelu")return uz(r,t);if(e==="leakyrelu")return QL(r,n);if(e==="sigmoid")return Ac(r);throw new Error("Unknown fused activation ".concat(e,"."))}var px=function(r,e){var t=r>0;return!t||e==="linear"};function $_e(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",px(Q.state.gradientDepth,p)===!1){V(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=Hv(t,n,a,i,s,c,l);return f!=null&&(v=Jr(v,f)),hx(v,p,d,m)}var g=M(t,"x","conv2d","float32"),y=M(n,"filter","conv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),V(w.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(w.rank,".")}),V(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),Ni("fused conv2d",i,l);var x=s==="NHWC"?w.shape[3]:w.shape[1];V(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),V(is(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var S=Y1(w.shape,y.shape,a,c,i,l),T;f!=null&&(T=M(f,"bias","fused conv2d"),e=we(Er(T,g),1),T=e[0],s==="NHWC"?Qr(S.outShape,T.shape):(V(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),V(T.shape.length===0||T.shape[0]===S.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(S.outChannels,")")})));var E;if(d!=null){var C=d.shape;if(V(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)V(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(S.outChannels,").")});else if(C.length===3)try{Qr(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(S.outShape,").");throw Error(R)}E=M(d,"prelu weights","fused conv2d")}var _=function(B,q){V(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var Y=we(q,4),J=Y[0],U=Y[1],j=Y[2],ne=Y[3],re=lx(B,j,p);V(Pv(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var se=VL(U.shape,re,J,a,i),le=z_e(U,re,J.shape,a,i),de=[se,le];if(ne!=null){var ke=fx(ne,re);de.push(ke)}return de},P={x:w,filter:y,bias:T,preluActivationWeights:E},$={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var z=lo(function(B,q,Y){var J=Q.runKernel(qB,P,$);return Y([q,B,J]),b&&(J=ge(J,[J.shape[1],J.shape[2],J.shape[3]])),{value:J,gradFunc:_}});return z(w,y)}else{var L=lo(function(B,q,Y,J){var U=Q.runKernel(qB,P,$);return J([q,B,U,Y]),b&&(U=ge(U,[U.shape[1],U.shape[2],U.shape[3]])),{value:U,gradFunc:_}});return L(w,y,T)}}var W_e=K({fusedConv2d_:$_e});function q_e(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return Q.runKernel(KSe,c,l)}var U_e=K({depthwiseConv2dNativeBackpropFilter_:q_e});function V_e(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=Q.runKernel(jSe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var G_e=K({depthwiseConv2dNativeBackpropInput_:V_e});function H_e(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(px(Q.state.gradientDepth,p)===!1){var v=Z1(t,n,a,i,s,c,l);return f!=null&&(v=Jr(v,f)),hx(v,p,d,m)}var g=M(t,"x","depthwiseConv2d","float32"),y=M(n,"filter","depthwiseConv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),V(w.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(w.rank,".")}),V(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),V(w.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(w.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),V(is(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),Ni("fused depthwiseConv2d",i,l);var x=Y1(w.shape,y.shape,a,c,i,l,!0),S;f!=null&&(S=M(f,"bias","fused conv2d"),e=we(Er(S,g),1),S=e[0],Qr(x.outShape,S.shape));var T;d!=null&&(T=M(d,"prelu weights","fused depthwiseConv2d"));var E=function($,z){V(Pv(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var L=we(z,4),B=L[0],q=L[1],Y=L[2],J=L[3],U=lx($,Y,p),j=G_e(q.shape,U,B,a,i,c,l),ne=U_e(q,U,B.shape,a,i,c,l);if(J!=null){var re=fx(S,U);return[j,ne,re]}return[j,ne]},C={x:w,filter:y,bias:S,preluActivationWeights:T},R={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var _=lo(function($,z,L){var B=Q.runKernel(UB,C,R);return L([z,$,B]),b&&(B=ge(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return _(w,y)}else{var P=lo(function($,z,L,B){var q=Q.runKernel(UB,C,R);return B([z,$,q,L]),b&&(q=ge(q,[q.shape[1],q.shape[2],q.shape[3]])),{value:q,gradFunc:E}});return P(w,y,S)}}var K_e=K({fusedDepthwiseConv2d_:H_e});function j_e(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,c=r.bias,l=r.activation,f=l===void 0?"linear":l,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(px(Q.state.gradientDepth,f)===!1){var m=zt(n,a,o,u);return c!=null&&(m=Jr(m,c)),hx(m,f,h,d)}var v=M(n,"a","fused matMul"),g=M(a,"b","fused matMul");e=we(Er(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?g.shape[g.rank-1]:g.shape[g.rank-2],b=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=v.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Zr(S),C=Zr(T);V(y===w,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(v.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var R=Qr(v.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([b,x]),P=o?ge(v,[E,y,b]):ge(v,[E,b,y]),$=u?ge(g,[C,x,w]):ge(g,[C,w,x]),z;c!=null&&(z=M(c,"bias","fused matMul"),t=we(Er(z,v),1),z=t[0],Qr(_,z.shape));var L;h!=null&&(L=M(h,"prelu weights","fused matMul"));var B=function(j,ne){var re=we(ne,4),se=re[0],le=re[1],de=re[2],ke=re[3],he=lx(ge(j,de.shape),de,f),ye,xe;if(!o&&!u?(ye=zt(he,le,!1,!0),xe=zt(se,he,!0,!1)):!o&&u?(ye=zt(he,le,!1,!1),xe=zt(he,se,!0,!1)):o&&!u?(ye=zt(le,he,!1,!0),xe=zt(se,he,!1,!1)):(ye=zt(le,he,!0,!0),xe=zt(he,se,!0,!0)),c!=null){var De=fx(ke,he);return[ye,xe,De]}else return[ye,xe]},q={a:P,b:$,bias:z,preluActivationWeights:L},Y={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var J=lo(function(j,ne,re){var se=Q.runKernel(WB,q,Y);return re([j,ne,se]),{value:ge(se,_),gradFunc:B}});return J(P,$)}else{var U=lo(function(j,ne,re,se){var le=Q.runKernel(WB,q,Y);return se([j,ne,le,re]),{value:ge(le,_),gradFunc:B}});return U(P,$,z)}}var X_e=K({fusedMatMul_:j_e});var Y_e={__proto__:null,conv2d:W_e,depthwiseConv2d:K_e,matMul:X_e};function Z_e(r){return cx(r,.54,.46)}var J_e=K({hammingWindow_:Z_e});function Q_e(r){return cx(r,.5,.5)}var Tz=K({hannWindow_:Q_e});function eFe(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(dr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=ia([dr(r,i,e-s),Gv([s],a)]);o.push(u),i+=t}return o.length===0?th([],[0,e]):ge(ia(o),[o.length,e])}var Ez=K({frame_:eFe});function tFe(r,e,t,n,a){a===void 0&&(a=Tz),n==null&&(n=Nz(e));var i=Ez(r,e,t),o=gt(i,a(e));return ox(o,n)}var rFe=K({stft_:tFe});function nFe(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=M(r,"image","cropAndResize"),s=M(e,"boxes","cropAndResize","float32"),u=M(t,"boxInd","cropAndResize","int32"),c=s.shape[0];V(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),V(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),V(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),V(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(n.length,".")}),V(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(n)}),V(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=Q.runKernel(USe,l,f);return h}var aFe=K({cropAndResize_:nFe});function iFe(r){var e=M(r,"image","flipLeftRight","float32");V(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},n=Q.runKernel(sNe,t,{});return n}var oFe=K({flipLeftRight_:iFe});function sFe(r){var e=M(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];V(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),V(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(n,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,eh(e,a)}var uFe=K({grayscaleToRGB_:sFe});function cFe(r){var e=M(r,"image","RGBToGrayscale"),t=e.rank-1,n=e.shape[t];V(e.rank>=2,function(){return"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),V(n===3,function(){return"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(n,".")});var a=e.dtype,i=Vr(e,"float32"),o=Za([.2989,.587,.114]),s;switch(e.rank){case 2:s=Ec("ij,j->i",i,o);break;case 3:s=Ec("ijk,k->ij",i,o);break;case 4:s=Ec("ijkl,l->ijk",i,o);break;case 5:s=Ec("ijklm,m->ijkl",i,o);break;case 6:s=Ec("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return s=es(s,-1),Vr(s,a)}var lFe=K({rgbToGrayscale_:cFe});function fFe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=M(r,"image","rotateWithOffset","float32");V(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=Q.runKernel(ZTe,i,o);return s}var hFe=K({rotateWithOffset_:fFe});function Mc(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),V(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(n,"'")}),V(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(r.rank,"'")}),V(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(r.shape[1])}),V(e.rank===1,function(){return"scores must be a 1D tensor"}),V(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),V(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function pFe(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=M(r,"boxes","nonMaxSuppression","float32"),o=M(e,"scores","nonMaxSuppression","float32"),s=Mc(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return Q.runKernel(VNe,{boxes:i,scores:o},u)}var dFe=K({nonMaxSuppression_:pFe});function vFe(r,e,t){var n=mFe(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function mFe(r,e,t){return yFe(r,e,t||gFe)}function gFe(r,e){return r>e?1:r<e?-1:0}function yFe(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function bFe(r,e,t,n,a){return dx(r,e,t,n,a,0)}function wFe(r,e,t,n,a,i){return dx(r,e,t,n,a,0,!1,i,!0)}function xFe(r,e,t,n,a,i){return dx(r,e,t,n,a,i,!0)}function dx(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(nL);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,w=h.length-1;w>=g;--w){var b=kFe(r,v,h[w]);if(b>=n){y=!0;break}if(d.score=d.score*SFe(n,f,b),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&vFe(c,d,nL))}var x=h.length,S=t-x;s&&S>0&&(h.push.apply(h,Ft([],we(new Array(S).fill(0)),!1)),p.push.apply(p,Ft([],we(new Array(S).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function kFe(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),w=Math.max(g-m,0)*Math.max(y-v,0);return w/(p+d-w)}function SFe(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function nL(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function NFe(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Et(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return Nt(this,function(h){switch(h.label){case 0:return i=M(r,"boxes","nonMaxSuppressionAsync"),o=M(e,"scores","nonMaxSuppressionAsync"),s=Mc(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=bFe(c,l,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,Za(f,"int32")]}})})}var TFe=NFe;function EFe(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=M(r,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=Mc(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=Q.runKernel(HNe,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var IFe=K({nonMaxSuppressionWithScore_:EFe});function CFe(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Et(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return Nt(this,function(m){switch(m.label){case 0:return o=M(r,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=Mc(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=m.sent(),l=c[0],f=c[1],h=xFe(l,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Za(p,"int32"),selectedScores:Za(d)}]}})})}var AFe=CFe;function DFe(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=M(r,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=Mc(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=Q.runKernel(GNe,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var _Fe=K({nonMaxSuppressionPadded_:DFe});function FFe(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),Et(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,m,v,g;return Nt(this,function(y){switch(y.label){case 0:return o=M(r,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=Mc(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=we.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=wFe(p,d,c,l,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Za(v,"int32"),validOutputs:Dr(g,"int32")}]}})})}var RFe=FFe;function OFe(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"images","resizeBilinear");V(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),V(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),V(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),we(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=Q.runKernel(cTe,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var PFe=K({resizeBilinear_:OFe});function MFe(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"images","resizeNearestNeighbor");V(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),V(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),V(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),V(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),we(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=Q.runKernel(uTe,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var BFe=K({resizeNearestNeighbor_:MFe});function LFe(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=M(r,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=gt(Za([n]),255),f,h,p,d;if(V(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),V(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),V(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),V(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=we(uh(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=gt(f,o),v=gt(h,s),g=gt(p,u);d=Jr(Jr(m,v),g)}else d=r;if(e==="otsu"){var y=UL(Vr(yz(d),"int32"),_c([]),256);l=zFe(y,c)}var w=t?ex(d,l):Yv(d,l),b=Vr(gt(w,255),"int32");return b}function zFe(r,e){for(var t=Za([-1]),n=Za([0]),a=Za([0]),i,o,s,u,c,l,f=0;f<r.size-1;f++){i=dr(r,0,f+1),o=dr(r,f+1),c=kn(tr(i),e),l=kn(tr(o),e);var h=tr(gt(i,oh(0,i.size)));s=kn(h,tr(i));var p=Gv(o.shape,i.size),d=Jr(oh(0,o.size),p),m=gt(o,d);u=kn(tr(m),tr(o));var v=Dt(s,u),g=Dt(s,u),y=gt(c,l);a=gt(gt(y,v),g);var w=Yv(a,n);n=ts(w,a,n),t=ts(w,Za([f]),t)}return t}var $Fe=K({threshold_:LFe});function WFe(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=M(r,"image","transform","float32"),s=M(e,"transforms","transform","float32");V(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),V(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),V(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return Q.runKernel(GTe,u,c)}var qFe=K({transform_:WFe});function UFe(r,e,t){var n=M(r,"a","bandPart");V(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(n.rank,".")});var a=n.shape,i=we(n.shape.slice(-2),2),o=i[0],s=i[1],u,c;typeof e=="number"?(V(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),V(e<=o,function(){return"bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,").")}),u=M(e<0?o:e,"numLower","bandPart")):(V(e.dtype==="int32",function(){return"bandPart(): numLower's dtype must be an int32."}),u=ts(B1(e,0),o,Lv(e,o))),typeof t=="number"?(V(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")}),V(t<=s,function(){return"bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,").")}),c=M(t<0?s:t,"numUpper","bandPart")):(V(t.dtype==="int32",function(){return"bandPart(): numUpper's dtype must be an int32."}),c=ts(B1(t,0),s,Lv(t,s)));var l=ge(oh(0,o,1,"int32"),[-1,1]),f=oh(0,s,1,"int32"),h=Dt(l,f),p=Mv(ex(h,u),JL(h,Bi(c))),d=Oc([o,s],n.dtype);return ge(ch(ux(ge(n,[-1,o,s])).map(function(m){return ts(p,m,d)})),a)}var VFe=K({bandPart_:UFe});function GFe(r){var e;if(Array.isArray(r)){e=!1,V(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){V(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(r[u].shape[0]," vs. ").concat(t,")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=uh(r,r.shape[0],0).map(function(u){return sx(u,[0])});V(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(r.length,") exceeds ")+"number of dimensions (".concat(r[0].shape[0],").")});for(var i=[],o=r,s=function(u){i.push(Q.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=gt(tr(gt(i[l],c)),i[l]);c=Dt(c,f)}return kn(c,Xv(c,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?ch(i,0):i}var HFe=K({gramSchmidt_:GFe});function KFe(r,e){if(e===void 0&&(e=!1),V(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(r.rank)}),r.rank===2)return aL(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,c){return u*c}),n=ux(ge(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var c=we(aL(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ge(ch(a,0),r.shape),s=ge(ch(i,0),r.shape);return[o,s]}function aL(r,e){return e===void 0&&(e=!1),Q.tidy(function(){V(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(r.shape.length,"D Tensor.")});for(var t=r.shape[0],n=r.shape[1],a=XL(t),i=Cc(r),o=th([[1]],[1,1]),s=Cc(o),u=t>=n?n:t,c=function(f){var h,p=i,d=s,m=a;h=we(Q.tidy(function(){var v=dr(i,[f,f],[t-f,1]),g=Xv(v),y=dr(i,[f,f],[1,1]),w=ts(Yv(y,0),th([[-1]]),th([[1]])),b=Dt(y,gt(w,g)),x=kn(v,b);x.shape[0]===1?s=Cc(o):s=ia([o,dr(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var S=Bi(kn(zt(w,b),g)),T=dr(i,[f,0],[t-f,n]),E=gt(S,s),C=L1(s);if(f===0)i=Dt(T,zt(E,zt(C,T)));else{var R=Dt(T,zt(E,zt(C,T)));i=ia([dr(i,[0,0],[f,n]),R],0)}var _=L1(E),P=dr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=Dt(P,zt(zt(P,s),_));else{var $=Dt(P,zt(zt(P,s),_));a=ia([dr(a,[0,0],[t,f]),$],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],w_e([p,d,m])},l=0;l<u;++l)c(l);return!e&&t>n&&(a=dr(a,[0,0],[t,n]),i=dr(i,[0,0],[n,n])),[a,i]})}var jFe=K({qr_:KFe});var On;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(On||(On={}));function XFe(r,e,t){t===void 0&&(t=On.SUM_BY_NONZERO_WEIGHTS);var n=M(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=M(e,"weights","computeWeightedLoss"));var i=a==null?n:gt(n,a);if(t===On.NONE)return i;if(t===On.SUM)return tr(i);if(t===On.MEAN){if(a==null)return Bv(i);var o=n.size/a.size,s=kn(tr(i),tr(a));return o>1?kn(s,Dr(o)):s}if(t===On.SUM_BY_NONZERO_WEIGHTS){if(a==null)return kn(tr(i),Dr(n.size));var u=gt(a,au(n.shape)),c=Vr(tr(oz(u,Dr(0))),"float32");return kn(tr(i),c)}throw Error("Unknown reduction: ".concat(t))}var fo=K({computeWeightedLoss_:XFe});function YFe(r,e,t,n){n===void 0&&(n=On.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","absoluteDifference"),i=M(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=M(t,"weights","absoluteDifference")),Ja(a.shape,i.shape,"Error in absoluteDifference: ");var s=Ha(Dt(a,i));return fo(s,o,n)}var ZFe=K({absoluteDifference_:YFe});function JFe(r,e,t,n,a){a===void 0&&(a=On.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"labels","cosineDistance"),o=M(e,"predictions","cosineDistance"),s=null;n!=null&&(s=M(n,"weights","cosineDistance")),Ja(i.shape,o.shape,"Error in cosineDistance: ");var u=Dr(1),c=Dt(u,tr(gt(i,o),t,!0));return fo(c,s,a)}var QFe=K({cosineDistance_:JFe});function eRe(r,e,t,n){n===void 0&&(n=On.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","hingeLoss"),i=M(e,"predictions","hingeLoss"),o=null;t!=null&&(o=M(t,"weights","hingeLoss")),Ja(a.shape,i.shape,"Error in hingeLoss: ");var s=Dr(1);a=Dt(gt(Dr(2),a),s);var u=Jv(Dt(s,gt(a,i)));return fo(u,o,n)}var tRe=K({hingeLoss_:eRe});function rRe(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=On.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"labels","huberLoss"),o=M(e,"predictions","huberLoss"),s=null;t!=null&&(s=M(t,"weights","huberLoss")),Ja(i.shape,o.shape,"Error in huberLoss: ");var u=Dr(n),c=Ha(Dt(o,i)),l=Lv(c,u),f=Dt(c,l),h=Jr(gt(Dr(.5),jv(l)),gt(u,f));return fo(h,s,a)}var nRe=K({huberLoss_:rRe});function aRe(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=On.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"labels","logLoss"),o=M(e,"predictions","logLoss"),s=null;t!=null&&(s=M(t,"weights","logLoss")),Ja(i.shape,o.shape,"Error in logLoss: ");var u=Dr(1),c=Dr(n),l=Bi(gt(i,ih(Jr(o,c)))),f=gt(Dt(u,i),ih(Jr(Dt(u,o),c))),h=Dt(l,f);return fo(h,s,a)}var iRe=K({logLoss_:aRe});function oRe(r,e,t,n){n===void 0&&(n=On.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","meanSquaredError"),i=M(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=M(t,"weights","meanSquaredError")),Ja(a.shape,i.shape,"Error in meanSquaredError: ");var s=wz(a,i);return fo(s,o,n)}var sRe=K({meanSquaredError_:oRe});function uRe(r,e){var t=M(r,"labels","sigmoidCrossEntropyWithLogits"),n=M(e,"logits","sigmoidCrossEntropyWithLogits");Ja(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Jv(n),i=gt(n,t),o=ez(iu(Bi(Ha(n))));return Jr(Dt(a,i),o)}function cRe(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=On.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"multiClassLabels","sigmoidCrossEntropy"),o=M(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","sigmoidCrossEntropy")),Ja(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=Dr(n),c=Dr(1),l=Dr(.5);i=Jr(gt(i,Dt(c,u)),gt(l,u))}var f=uRe(i,o);return fo(f,s,a)}var lRe=K({sigmoidCrossEntropy_:cRe});function fRe(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var n=lo(function(a,i,o){var s=!0,u=rz(i,[t],s),c=Dt(Vr(i,"float32"),u);o([a,c]);var l=Bi(gt(c,a)),f=tr(l,[t]),h=function(p,d){var m=we(d,2),v=m[0],g=m[1],y=Kv(p.shape,[t]);return[gt(ge(p,y),Dt(Vr(v,"float32"),iu(g))),gt(ge(p,y),Dt(iu(g),Vr(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function hRe(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=On.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"onehotLabels","softmaxCrossEntropy"),o=M(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","softmaxCrossEntropy")),Ja(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=Dr(n),c=Dr(1),l=Dr(i.shape[1]);i=Jr(gt(i,Dt(c,u)),kn(u,l))}var f=fRe(i,o);return fo(f,s,a)}var pRe=K({softmaxCrossEntropy_:hRe});function dRe(r,e,t,n){var a=M(r,"indices","sparseFillEmptyRows","int32"),i=M(e,"values","sparseFillEmptyRows"),o=M(t,"denseShape","sparseFillEmptyRows","int32"),s=M(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Q.runKernel(DTe,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var vRe=K({sparseFillEmptyRows_:dRe});function mRe(r,e,t){var n=M(r,"inputIndices","sparseReshape","int32"),a=M(e,"inputShape","sparseReshape","int32"),i=M(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(n.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:n,inputShape:a,newShape:i},s=Q.runKernel(_Te,o);return{outputIndices:s[0],outputShape:s[1]}}var gRe=K({sparseReshape_:mRe});function yRe(r,e,t){var n=M(r,"data","sparseSegmentMean"),a=M(e,"indices","sparseSegmentMean","int32"),i=M(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return Q.runKernel(FTe,o)}var bRe=K({sparseSegmentMean_:yRe});function wRe(r,e,t){var n=M(r,"data","sparseSegmentSum"),a=M(e,"indices","sparseSegmentSum","int32"),i=M(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return Q.runKernel(RTe,o)}var xRe=K({sparseSegmentSum_:wRe});function kRe(r,e,t,n,a,i,o,s){var u=M(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=M(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=Q.runKernel(LTe,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var SRe=K({stringNGrams_:kRe});function NRe(r,e,t){t===void 0&&(t=!0);var n=M(r,"input","stringSplit","string"),a=M(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(n.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:n,delimiter:a},s=Q.runKernel(zTe,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var TRe=K({stringSplit_:NRe});function ERe(r,e){var t=M(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return Q.runKernel($Te,a,n)}var IRe=K({stringToHashBucketFast_:ERe});function CRe(r,e,t,n){n===void 0&&(n=!0);var a=M(r,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:n};return Q.runKernel(MTe,{x:a},i)}var ARe=K({staticRegexReplace_:CRe});var DRe={fft:ix,ifft:zv,rfft:ox,irfft:bz},_Re={hammingWindow:J_e,hannWindow:Tz,frame:Ez,stft:rFe},FRe={flipLeftRight:oFe,grayscaleToRGB:uFe,resizeNearestNeighbor:BFe,resizeBilinear:PFe,rgbToGrayscale:lFe,rotateWithOffset:hFe,cropAndResize:aFe,nonMaxSuppression:dFe,nonMaxSuppressionAsync:TFe,nonMaxSuppressionWithScore:IFe,nonMaxSuppressionWithScoreAsync:AFe,nonMaxSuppressionPadded:_Fe,nonMaxSuppressionPaddedAsync:RFe,threshold:$Fe,transform:qFe},RRe={bandPart:VFe,gramSchmidt:HFe,qr:jFe},ORe={absoluteDifference:ZFe,computeWeightedLoss:fo,cosineDistance:QFe,hingeLoss:tRe,huberLoss:nRe,logLoss:iRe,meanSquaredError:sRe,sigmoidCrossEntropy:lRe,softmaxCrossEntropy:pRe},PRe={sparseFillEmptyRows:vRe,sparseReshape:gRe,sparseSegmentMean:bRe,sparseSegmentSum:xRe},MRe={stringNGrams:SRe,stringSplit:TRe,stringToHashBucketFast:IRe,staticRegexReplace:ARe};var un={__proto__:null,OP_SCOPE_SUFFIX:$L,abs:Ha,acos:TEe,acosh:IEe,add:Jr,addN:DEe,all:FEe,any:OEe,argMax:MEe,argMin:LEe,asin:$Ee,asinh:qEe,atan:VEe,atan2:HEe,atanh:jEe,avgPool:WL,avgPool3d:nIe,basicLSTMCell:hIe,batchNorm:Vv,batchNorm2d:gIe,batchNorm3d:bIe,batchNorm4d:xIe,batchToSpaceND:qL,bincount:UL,bitwiseAnd:NIe,booleanMaskAsync:y_e,broadcastArgs:EIe,broadcastTo:Av,buffer:rs,cast:Vr,ceil:AIe,clipByValue:_Ie,clone:Cc,complex:ns,concat:ia,concat1d:OIe,concat2d:MIe,concat3d:LIe,concat4d:$Ie,conv1d:UIe,conv2d:Hv,conv2dTranspose:HIe,conv3d:jIe,conv3dTranspose:JIe,cos:eCe,cosh:rCe,cosineWindow:cx,cumprod:aCe,cumsum:oCe,denseBincount:uCe,depthToSpace:lCe,depthwiseConv2d:Z1,diag:pCe,dilation2d:vCe,div:kn,divNoNan:SCe,dot:TCe,dropout:P_e,einsum:Ec,elu:KL,enclosingPowerOfTwo:Nz,ensureShape:ACe,equal:HL,erf:_Ce,euclideanNorm:WCe,exp:iu,expandDims:es,expm1:GCe,eye:XL,fft:ix,fill:Gv,floor:YL,floorDiv:GL,fused:Y_e,gather:ZL,gatherND:F_e,greater:Yv,greaterEqual:JL,ifft:zv,imag:Zv,image:FRe,inTopKAsync:B_e,irfft:bz,isFinite:eAe,isInf:rAe,isNaN:aAe,leakyRelu:QL,less:B1,lessEqual:ex,linalg:RRe,linspace:uAe,localResponseNormalization:lAe,log:ih,log1p:ez,logSigmoid:mAe,logSoftmax:bAe,logSumExp:rz,logicalAnd:Mv,logicalNot:nz,logicalOr:az,logicalXor:TAe,losses:ORe,lowerBound:IAe,matMul:zt,max:Dc,maxPool:iz,maxPool3d:DAe,maxPoolWithArgmax:FAe,maximum:OAe,mean:Bv,meshgrid:MAe,min:P1,minimum:Lv,mirrorPad:zAe,mod:WAe,moments:UAe,movingAverage:T_e,mul:gt,multiRNNCell:GAe,multinomial:KAe,neg:Bi,norm:Xv,notEqual:oz,oneHot:YAe,ones:au,onesLike:JAe,op:K,outerProduct:eDe,pad:lh,pad1d:nDe,pad2d:iDe,pad3d:sDe,pad4d:cDe,pool:dDe,pow:Q1,prelu:uz,print:mDe,prod:yDe,raggedGather:wDe,raggedRange:kDe,raggedTensorToTensor:NDe,rand:EDe,randomGamma:HDe,randomNormal:mz,randomStandardNormal:XDe,randomUniform:ax,randomUniformInt:JDe,range:oh,real:sh,reciprocal:t3e,relu:Jv,relu6:gz,reshape:ge,reverse:ou,reverse1d:o3e,reverse2d:u3e,reverse3d:l3e,reverse4d:h3e,rfft:ox,round:yz,rsqrt:v3e,scalar:Dr,scatterND:I_e,searchSorted:tx,selu:g3e,separableConv2d:b3e,setdiff1dAsync:x3e,sigmoid:Ac,sign:S3e,signal:_Re,sin:T3e,sinh:I3e,slice:dr,slice1d:A3e,slice2d:_3e,slice3d:R3e,slice4d:P3e,softmax:B3e,softplus:tz,spaceToBatchND:sz,sparse:PRe,sparseToDense:D_e,spectral:DRe,split:uh,sqrt:M1,square:jv,squaredDifference:wz,squeeze:sx,stack:ch,step:xz,stridedSlice:j3e,string:MRe,sub:Dt,sum:tr,tan:Y3e,tanh:O1,tensor:_c,tensor1d:Za,tensor2d:th,tensor3d:Z3e,tensor4d:J3e,tensor5d:Q3e,tensor6d:e_e,tensorScatterUpdate:n_e,tile:eh,topk:i_e,transpose:L1,truncatedNormal:s_e,unique:c_e,unsortedSegmentSum:f_e,unstack:ux,upperBound:p_e,variable:d_e,where:ts,whereAsync:Sz,zeros:Oc,zerosLike:J1};var BRe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"BiasAdd":case"AddV2":case"Add":return[n.add(I("a",r,e,t),I("b",r,e,t))];case"AddN":return[n.addN(I("tensors",r,e,t))];case"FloorMod":case"Mod":return[n.mod(I("a",r,e,t),I("b",r,e,t))];case"Mul":return[n.mul(I("a",r,e,t),I("b",r,e,t))];case"RealDiv":case"Div":return[n.div(I("a",r,e,t),I("b",r,e,t))];case"DivNoNan":return[n.divNoNan(I("a",r,e,t),I("b",r,e,t))];case"FloorDiv":return[n.floorDiv(I("a",r,e,t),I("b",r,e,t))];case"Sub":return[n.sub(I("a",r,e,t),I("b",r,e,t))];case"Minimum":return[n.minimum(I("a",r,e,t),I("b",r,e,t))];case"Maximum":return[n.maximum(I("a",r,e,t),I("b",r,e,t))];case"Pow":return[n.pow(I("a",r,e,t),I("b",r,e,t))];case"SquaredDifference":return[n.squaredDifference(I("a",r,e,t),I("b",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var LRe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"Abs":case"ComplexAbs":return[n.abs(I("x",r,e,t))];case"Acos":return[n.acos(I("x",r,e,t))];case"Acosh":return[n.acosh(I("x",r,e,t))];case"Asin":return[n.asin(I("x",r,e,t))];case"Asinh":return[n.asinh(I("x",r,e,t))];case"Atan":return[n.atan(I("x",r,e,t))];case"Atan2":return[n.atan2(I("x",r,e,t),I("y",r,e,t))];case"Atanh":return[n.atanh(I("x",r,e,t))];case"Ceil":return[n.ceil(I("x",r,e,t))];case"Complex":return[n.complex(I("real",r,e,t),I("imag",r,e,t))];case"Cos":return[n.cos(I("x",r,e,t))];case"Cosh":return[n.cosh(I("x",r,e,t))];case"Elu":return[n.elu(I("x",r,e,t))];case"Erf":return[n.erf(I("x",r,e,t))];case"Exp":return[n.exp(I("x",r,e,t))];case"Expm1":return[n.expm1(I("x",r,e,t))];case"Floor":return[n.floor(I("x",r,e,t))];case"Log":return[n.log(I("x",r,e,t))];case"Log1p":return[n.log1p(I("x",r,e,t))];case"Imag":return[n.imag(I("x",r,e,t))];case"Neg":return[n.neg(I("x",r,e,t))];case"Reciprocal":return[n.reciprocal(I("x",r,e,t))];case"Real":return[n.real(I("x",r,e,t))];case"Relu":return[n.relu(I("x",r,e,t))];case"Round":return[n.round(I("x",r,e,t))];case"Selu":return[n.selu(I("x",r,e,t))];case"Sigmoid":return[n.sigmoid(I("x",r,e,t))];case"Sin":return[n.sin(I("x",r,e,t))];case"Sign":return[n.sign(I("x",r,e,t))];case"Sinh":return[n.sinh(I("x",r,e,t))];case"Softplus":return[n.softplus(I("x",r,e,t))];case"Sqrt":return[n.sqrt(I("x",r,e,t))];case"Square":return[n.square(I("x",r,e,t))];case"Tanh":return[n.tanh(I("x",r,e,t))];case"Tan":return[n.tan(I("x",r,e,t))];case"ClipByValue":return[n.clipByValue(I("x",r,e,t),I("clipValueMin",r,e,t),I("clipValueMax",r,e,t))];case"Relu6":return[n.relu6(I("x",r,e,t))];case"Rsqrt":return[n.rsqrt(sn(r.inputNames[0],e,t))];case"LeakyRelu":return[n.leakyRelu(I("x",r,e,t),I("alpha",r,e,t))];case"Prelu":return[n.prelu(I("x",r,e,t),I("alpha",r,e,t))];case"IsNan":return[n.isNaN(sn(r.inputNames[0],e,t))];case"IsInf":return[n.isInf(sn(r.inputNames[0],e,t))];case"IsFinite":return[n.isFinite(sn(r.inputNames[0],e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function Ka(r,e,t){if(t===void 0&&(t=""),!(typeof r=="number"||typeof e=="number")){Be.util.assert(r.length===e.length,function(){return t+" Shapes ".concat(r," and ").concat(e," must match")});for(var n=0;n<r.length;n++){var a=r[n],i=e[n];Be.util.assert(a<0||i<0||a===i,function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}}}function iL(r){return!(typeof r=="number"||r.some(function(e){return e<0}))}function Zf(r,e,t){var n=z1(r,t),a=!iL(n);if(a&&e.length===0)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(n));if(a&&e.forEach(function(i){n=z1(i.shape,n)}),!iL(n))throw new Error("Non-fully-defined elementShape: ".concat(n));return n}function z1(r,e){if(typeof r=="number")return e;if(typeof e=="number")return r;if(r.length!==e.length)throw new Error("Incompatible ranks during merge: ".concat(r," vs. ").concat(e));for(var t=[],n=0;n<r.length;++n){var a=r[n],i=e[n];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(r," vs. ").concat(e));t[n]=a>=0?a:i}return t}var zRe=function(){function r(e,t,n,a,i,o,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Be.scalar(0),Be.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this.closed_},enumerable:!1,configurable:!0}),r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},r.prototype.readMany=function(e){var t=this;return e.map(function(n){return t.read(n)})},r.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,`,
          because the value dtype is `).concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Ka(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Be.keep(t),n.written=!0,this.tensors[e]=n},r.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach(function(a,i){return n.write(a,t[i])})},r.prototype.gather=function(e,t){if(!!t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(e.length===0)return Be.tensor([],[0].concat(this.elementShape));var a=this.readMany(e);return Ka(this.elementShape,a[0].shape,"TensorArray shape mismatch: "),Be.stack(a,0)},r.prototype.concat=function(e){if(!!e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(this.size()===0)return Be.tensor([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var a=this.readMany(t);return Ka(this.elementShape,a[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(a[0].shape,")")),Be.concat(a,0)},r.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Ft([],we(e),!1));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Be.unstack(t,0))},r.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var a=0,i=e.map(function(l){return a+=l,a});if(a!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(a,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var o=a===0?0:t.size/a,s=[];Be.tidy(function(){t=Be.reshape(t,[1,a,o]);for(var l=0;l<e.length;++l){var f=l===0?0:i[l-1],h=[0,f,0],p=[1,e[l],o];s[l]=Be.reshape(Be.slice(t,h,p),n.elementShape)}return s});for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)},r}(),Qv=function(){function r(e,t,n,a){a===void 0&&(a=-1),this.tensors=e,this.elementShape=t,this.elementDtype=n,e?.forEach(function(i){if(n!==i.dtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(i.dtype));Ka(t,i.shape,"TensorList shape mismatch: "),Be.keep(i)}),this.idTensor=Be.scalar(0),this.maxNumElements=a,Be.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),r.prototype.copy=function(){return new r(Ft([],we(this.tensors),!1),this.elementShape,this.elementDtype)},r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.stack=function(e,t,n){var a=this;if(n===void 0&&(n=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(n!==-1&&this.tensors.length!==n)throw new Error("Operation expected a list with ".concat(n," elements but got a list with ").concat(this.tensors.length," elements."));Ka(e,this.elementShape,"TensorList shape mismatch: ");var i=Zf(this.elementShape,this.tensors,e);return Be.tidy(function(){var o=a.tensors.map(function(s){return Be.reshape(s,i)});return Be.stack(o,0)})},r.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(this.size()===0)throw new Error("Trying to pop from an empty list.");var n=Zf(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,Ka(a.shape,e,"TensorList shape mismatch: "),Be.reshape(a,n)},r.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(Ka(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Be.keep(e),this.tensors.push(e)},r.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));var t=new r([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(var n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t},r.prototype.getItem=function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(this.tensors[e]==null)throw new Error("element at index ".concat(e," is null."));Ka(this.tensors[e].shape,t,"TensorList shape mismatch: ");var a=Zf(this.elementShape,this.tensors,t);return Be.reshape(this.tensors[e],a)},r.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));Ka(this.elementShape,t.shape,"TensorList shape mismatch: "),Be.keep(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t},r.prototype.gather=function(e,t,n){var a=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));Ka(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=Zf(this.elementShape,this.tensors,n);return e.length===0?Be.tensor([],[0].concat(i)):Be.tidy(function(){var o=e.map(function(s){return Be.reshape(a.tensors[s],i)});return Be.stack(o,0)})},r.prototype.concat=function(e,t){var n=this;if(!!e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));Ka(this.elementShape,t,"TensorList shape mismatch: ");var a=Zf(this.elementShape,this.tensors,t);return this.size()===0?Be.tensor([],[0].concat(a)):Be.tidy(function(){var i=n.tensors.map(function(o){return Be.reshape(o,a)});return Be.concat(i,0)})},r}();function $Re(r,e,t){var n=r.dtype;if(r.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(r.shape));if(r.dtype!==t)throw new Error("Invalid data types; op elements ".concat(r.dtype,", but list elements ").concat(t));var a=r.shape.slice(1);Ka(a,e,"TensorList shape mismatch: ");var i=Be.unstack(r);return new Qv(i,e,n)}function WRe(r,e,t,n){return new Qv([],r,e,n)}function qRe(r,e,t,n){if(e.length!==r.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(r.shape[0]));var a=Math.max.apply(Math,Ft([],we(e),!1));if(n!=null&&n!==-1&&a>=n)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(n,")"));var i=new Qv([],t,r.dtype,n),o=Be.unstack(r,0);return e.forEach(function(s,u){i.setItem(s,o[u])}),i}function URe(r,e,t){var n=0,a=e.map(function(f){return n+=f,n});if(n!==r.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(n,", and tensor's shape is: ").concat(r.shape));for(var i=r.shape.slice(1),o=z1(i,t),s=n===0?0:r.size/n,u=Be.tidy(function(){var f=[];r=Be.reshape(r,[1,n,s]);for(var h=0;h<e.length;++h){var p=h===0?0:a[h-1],d=[0,p,0],m=[1,e[h],s];f[h]=Be.reshape(Be.slice(r,d,m),o)}return r.dispose(),f}),c=new Qv([],t,r.dtype,e.length),l=0;l<u.length;l++)c.setItem(l,u[l]);return c}var VRe=function(r,e,t){return Et(void 0,void 0,void 0,function(){var n,a,i,o,c,h,s,u,c,l,f,h,p,d,m,m,y,v,y,g,y,y,y,Ir,w,et,b,x,S,T,E,C,se,st,R,_,le,P,xe,De,$,z,L,de,ke,B,nt,q,ft,Y,tt,ir,J,U,j,ne,re,kt,se,st,Xe,kt,le,et,Ze,Xe,de,ke,et,Ye,Xe,et,at,he,Ye,ye,Xe,xe,De,et,at,Xe,kt,et,at,Ye,Xe,ht,et,at,Xe,nt,Xe,ft,et,kt,st,Xe,kt,et,Ze,Xe,tt,et,ir,Xe,kt,Xe,kt,Ir,gn,Or;return Nt(this,function(Cr){switch(Cr.label){case 0:switch(n=r.op,n){case"If":return[3,1];case"StatelessIf":return[3,1];case"While":return[3,3];case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":return[3,27];case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"EmptyTensorList":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListConcatV2":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35];case"TensorListLength":return[3,36];case"TensorListResize":return[3,37]}return[3,38];case 1:return a=I("thenBranch",r,e,t),i=I("elseBranch",r,e,t),o=I("cond",r,e,t),c=I("args",r,e,t),[4,o.data()];case 2:return h=Cr.sent(),h[0]?[2,t.functionMap[a].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)]:[2,t.functionMap[i].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 3:return s=I("body",r,e,t),u=I("cond",r,e,t),c=I("args",r,e,t),[4,t.functionMap[u].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 4:return l=Cr.sent(),f=c.map(function(or){return or.id}),[4,l[0].data()];case 5:h=Cr.sent(),l.forEach(function(or){!or.kept&&f.indexOf(or.id)===-1&&or.dispose()}),p=c,d=function(){var or,zn,yn;return Nt(this,function($n){switch($n.label){case 0:return or=p,[4,t.functionMap[s].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 1:return p=$n.sent(),zn=p.map(function(Sr){return Sr.id}),or.forEach(function(Sr){!Sr.kept&&f.indexOf(Sr.id)===-1&&zn.indexOf(Sr.id)===-1&&Sr.dispose()}),[4,t.functionMap[u].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 2:return yn=$n.sent(),[4,yn[0].data()];case 3:return h=$n.sent(),yn.forEach(function(Sr){!Sr.kept&&f.indexOf(Sr.id)===-1&&zn.indexOf(Sr.id)===-1&&Sr.dispose()}),[2]}})},Cr.label=6;case 6:return h[0]?[5,d()]:[3,8];case 7:return Cr.sent(),[3,6];case 8:return[2,p];case 9:return m=I("pred",r,e,t),[2,[co(m)]];case 10:return m=I("pred",r,e,t),y=I("data",r,e,t),y.kept||(y=co(y)),[4,m.data()];case 11:return[2,Cr.sent()[0]?[void 0,y]:[y,void 0]];case 12:return v=r.inputNames.find(function(or){return sn(or,e,t)!==void 0}),v?(y=sn(v,e,t),[2,[co(y)]]):[2,void 0];case 13:return g=I("frameName",r,e,t),y=I("tensor",r,e,t),t.enterFrame(g),[2,[co(y)]];case 14:return y=I("tensor",r,e,t),t.exitFrame(),[2,[co(y)]];case 15:return y=I("tensor",r,e,t),t.nextIteration(),[2,[co(y)]];case 16:return Ir=I("size",r,e,t),w=I("dtype",r,e,t),et=I("elementShape",r,e,t),b=I("dynamicSize",r,e,t),x=I("clearAfterRead",r,e,t),S=I("identicalElementShapes",r,e,t),T=I("name",r,e,t),E=new zRe(T,w,Ir,et,S,b,x),t.addTensorArray(E),[2,[E.idTensor,Be.scalar(1)]];case 17:return C=I("tensorArrayId",r,e,t),se=I("index",r,e,t),st=I("tensor",r,e,t),R=t.getTensorArray(C.id),R.write(se,st),[2,[R.idTensor]];case 18:return _=I("tensorArrayId",r,e,t),le=I("index",r,e,t),P=t.getTensorArray(_.id),[2,[P.read(le)]];case 19:return xe=I("tensorArrayId",r,e,t),De=I("indices",r,e,t),$=I("dtype",r,e,t),z=t.getTensorArray(xe.id),[2,[z.gather(De,$)]];case 20:return L=I("tensorArrayId",r,e,t),de=I("indices",r,e,t),ke=I("tensor",r,e,t),B=t.getTensorArray(L.id),B.scatter(de,ke),[2,[B.idTensor]];case 21:return nt=I("tensorArrayId",r,e,t),q=t.getTensorArray(nt.id),ft=I("dtype",r,e,t),[2,[q.concat(ft)]];case 22:return Y=I("tensorArrayId",r,e,t),tt=I("tensor",r,e,t),ir=I("lengths",r,e,t),J=t.getTensorArray(Y.id),J.split(ir,tt),[2,[J.idTensor]];case 23:return U=I("tensorArrayId",r,e,t),j=t.getTensorArray(U.id),[2,[Be.scalar(j.size(),"int32")]];case 24:return ne=I("tensorArrayId",r,e,t),re=t.getTensorArray(ne.id),re.clearAndClose(),[2,[re.idTensor]];case 25:return kt=I("tensorListId",r,e,t),se=I("index",r,e,t),st=I("tensor",r,e,t),Xe=t.getTensorList(kt.id),Xe.setItem(se,st),[2,[Xe.idTensor]];case 26:return kt=I("tensorListId",r,e,t),le=I("index",r,e,t),et=I("elementShape",r,e,t),Ze=I("elementDType",r,e,t),Xe=t.getTensorList(kt.id),[2,[Xe.getItem(le,et,Ze)]];case 27:return de=I("indices",r,e,t),ke=I("tensor",r,e,t),et=I("elementShape",r,e,t),Ye=I("numElements",r,e,t),Xe=qRe(ke,de,et,Ye),t.addTensorList(Xe),[2,[Xe.idTensor]];case 28:return et=I("elementShape",r,e,t),at=I("elementDType",r,e,t),he=void 0,r.op==="TensorListReserve"?he="numElements":he="maxNumElements",Ye=I(he,r,e,t),ye=r.op==="TensorListReserve"?-1:Ye,Xe=WRe(et,at,Ye,ye),t.addTensorList(Xe),[2,[Xe.idTensor]];case 29:return xe=I("tensorListId",r,e,t),De=I("indices",r,e,t),et=I("elementShape",r,e,t),at=I("elementDType",r,e,t),Xe=t.getTensorList(xe.id),[2,[Xe.gather(De,at,et)]];case 30:return kt=I("tensorListId",r,e,t),et=I("elementShape",r,e,t),at=I("elementDType",r,e,t),Ye=I("numElements",r,e,t),Xe=t.getTensorList(kt.id),[2,[Xe.stack(et,at,Ye)]];case 31:return ht=I("tensor",r,e,t),et=I("elementShape",r,e,t),at=I("elementDType",r,e,t),Xe=$Re(ht,et,at),t.addTensorList(Xe),[2,[Xe.idTensor]];case 32:return nt=I("tensorListId",r,e,t),Xe=t.getTensorList(nt.id),ft=I("dtype",r,e,t),et=I("elementShape",r,e,t),[2,[Xe.concat(ft,et)]];case 33:return kt=I("tensorListId",r,e,t),st=I("tensor",r,e,t),Xe=t.getTensorList(kt.id),Xe.pushBack(st),[2,[Xe.idTensor]];case 34:return kt=I("tensorListId",r,e,t),et=I("elementShape",r,e,t),Ze=I("elementDType",r,e,t),Xe=t.getTensorList(kt.id),[2,[Xe.popBack(et,Ze)]];case 35:return tt=I("tensor",r,e,t),et=I("elementShape",r,e,t),ir=I("lengths",r,e,t),Xe=URe(tt,ir,et),t.addTensorList(Xe),[2,[Xe.idTensor]];case 36:return kt=I("tensorListId",r,e,t),Xe=t.getTensorList(kt.id),[2,[Be.scalar(Xe.size(),"int32")]];case 37:return kt=I("tensorListId",r,e,t),Ir=I("size",r,e,t),gn=t.getTensorList(kt.id),Or=gn.resize(Ir),t.addTensorList(Or),[2,[Or.idTensor]];case 38:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};function oL(r,e,t){var n=we(I("fusedOps",r,e,t),2),a=n[0],i=n[1],o=a==="biasadd",s=!o,u=i==="prelu",c=a==="fusedbatchnorm",l=I("numArgs",r,e,t);if(o){if(u&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=I("strides",r,e,t),h=Ev(r,e,t),p=I("dataFormat",r,e,t).toUpperCase(),d=I("dilations",r,e,t),m=we(I("args",r,e,t),2),v=m[0],g=m[1];s&&(g=v,v=void 0);var y=I("leakyreluAlpha",r,e,t);return{stride:f,pad:h,dataFormat:p,dilations:d,biasArg:v,preluArg:g,activationFunc:i,leakyreluAlpha:y}}var GRe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"Conv1D":{var a=I("stride",r,e,t),i=I("pad",r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),s=I("dilation",r,e,t);return[n.conv1d(I("x",r,e,t),I("filter",r,e,t),a,i,o,s)]}case"Conv2D":{var a=I("strides",r,e,t),i=Ev(r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),u=I("dilations",r,e,t);return[n.conv2d(I("x",r,e,t),I("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"_FusedConv2D":{var c=oL(r,e,t),a=c.stride,i=c.pad,o=c.dataFormat,u=c.dilations,l=c.biasArg,f=c.preluArg,h=c.activationFunc,p=c.leakyreluAlpha;return[n.fused.conv2d({x:I("x",r,e,t),filter:I("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{var d=oL(r,e,t),a=d.stride,i=d.pad,o=d.dataFormat,u=d.dilations,l=d.biasArg,f=d.preluArg,h=d.activationFunc,p=d.leakyreluAlpha;return[n.fused.depthwiseConv2d({x:I("x",r,e,t),filter:I("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{var m=I("outputShape",r,e,t),a=I("strides",r,e,t),i=Ev(r,e,t);return[n.conv2dTranspose(I("x",r,e,t),I("filter",r,e,t),m,[a[1],a[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{var a=I("strides",r,e,t),i=Ev(r,e,t),u=I("dilations",r,e,t),o=I("dataFormat",r,e,t).toUpperCase();return[n.depthwiseConv2d(I("input",r,e,t),I("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"Conv3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),u=I("dilations",r,e,t);return[n.conv3d(I("x",r,e,t),I("filter",r,e,t),[a[1],a[2],a[3]],i,o,[u[1],u[2],u[3]])]}case"AvgPool":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.avgPool(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPool":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.maxPool(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t),g=I("includeBatchInIndex",r,e,t),y=n.maxPoolWithArgmax(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i,g),w=y.result,b=y.indexes;return[w,b]}case"AvgPool3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.avgPool3d(I("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.maxPool3d(I("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{var x=I("strides",r,e,t),i=I("pad",r,e,t),u=I("dilations",r,e,t),S=x[1],T=x[2],E=u[1],C=u[2];return[n.dilation2d(I("x",r,e,t),I("filter",r,e,t),[S,T],i,[E,C],"NHWC")]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var HRe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"Fill":{var a=I("shape",r,e,t),i=I("dtype",r,e,t),o=I("value",r,e,t);return[n.fill(a,o,i)]}case"LinSpace":{var s=I("start",r,e,t),u=I("stop",r,e,t),c=I("num",r,e,t);return[n.linspace(s,u,c)]}case"Multinomial":{var l=I("logits",r,e,t),f=I("numSamples",r,e,t),h=I("seed",r,e,t);return[n.multinomial(l,f,h)]}case"OneHot":{var p=I("indices",r,e,t),d=I("depth",r,e,t),m=I("onValue",r,e,t),v=I("offValue",r,e,t),i=I("dtype",r,e,t);return[n.oneHot(p,d,m,v,i)]}case"Ones":return[n.ones(I("shape",r,e,t),I("dtype",r,e,t))];case"OnesLike":return[n.onesLike(I("x",r,e,t))];case"RandomStandardNormal":return[n.randomStandardNormal(I("shape",r,e,t),I("dtype",r,e,t),I("seed",r,e,t))];case"RandomUniform":return[n.randomUniform(I("shape",r,e,t),I("minval",r,e,t),I("maxval",r,e,t),I("dtype",r,e,t))];case"RandomUniformInt":return[n.randomUniformInt(I("shape",r,e,t),I("minval",r,e,t),I("maxval",r,e,t),I("seed",r,e,t))];case"Range":{var s=I("start",r,e,t),u=I("stop",r,e,t),g=I("step",r,e,t);return[n.range(s,u,g,I("dtype",r,e,t))]}case"TruncatedNormal":{var a=I("shape",r,e,t),y=I("mean",r,e,t),w=I("stdDev",r,e,t),h=I("seed",r,e,t);return[n.truncatedNormal(a,y,w,I("dtype",r,e,t),h)]}case"Zeros":return[n.zeros(I("shape",r,e,t),I("dtype",r,e,t))];case"ZerosLike":return[n.zerosLike(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function p1(r,e,t){var n=I("boxes",r,e,t),a=I("scores",r,e,t),i=I("maxOutputSize",r,e,t),o=I("iouThreshold",r,e,t),s=I("scoreThreshold",r,e,t),u=I("softNmsSigma",r,e,t);return{boxes:n,scores:a,maxOutputSize:i,iouThreshold:o,scoreThreshold:s,softNmsSigma:u}}var KRe=function(r,e,t,n,a){return a===void 0&&(a=un),Et(void 0,void 0,void 0,function(){var i,o,f,h,p,d,m,s,g,u,f,h,p,d,m,c,g,l,f,h,p,d,m,v,g;return Nt(this,function(y){switch(y.label){case 0:switch(i=r.op,i){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":return[3,5];case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return o=p1(r,e,t),f=o.boxes,h=o.scores,p=o.maxOutputSize,d=o.iouThreshold,m=o.scoreThreshold,s=o.softNmsSigma,[4,a.image.nonMaxSuppressionWithScoreAsync(f,h,p,d,m,s)];case 2:return g=y.sent(),[2,[g.selectedIndices,g.selectedScores]];case 3:return u=p1(r,e,t),f=u.boxes,h=u.scores,p=u.maxOutputSize,d=u.iouThreshold,m=u.scoreThreshold,c=I("padToMaxOutputSize",r,e,t),[4,a.image.nonMaxSuppressionPaddedAsync(f,h,p,d,m,c)];case 4:return g=y.sent(),[2,[g.selectedIndices,g.validOutputs]];case 5:return l=p1(r,e,t),f=l.boxes,h=l.scores,p=l.maxOutputSize,d=l.iouThreshold,m=l.scoreThreshold,[4,a.image.nonMaxSuppressionAsync(f,h,p,d,m)];case 6:return[2,[y.sent()]];case 7:return v=a.cast(I("condition",r,e,t),"bool"),[4,a.whereAsync(v)];case 8:return g=[y.sent()],v.dispose(),[2,g];case 9:return[2,a.setdiff1dAsync(I("x",r,e,t),I("y",r,e,t))];case 10:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};var jRe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"LowerBound":{var a=I("sortedSequence",r,e,t),i=I("values",r,e,t);return[n.lowerBound(a,i)]}case"TopKV2":{var o=I("x",r,e,t),s=I("k",r,e,t),u=I("sorted",r,e,t),c=n.topk(o,s,u);return[c.values,c.indices]}case"UpperBound":{var a=I("sortedSequence",r,e,t),i=I("values",r,e,t);return[n.upperBound(a,i)]}case"Unique":{var o=I("x",r,e,t),c=n.unique(o);return[c.values,c.indices]}case"UniqueV2":{var o=I("x",r,e,t),l=I("axis",r,e,t),c=n.unique(o,l);return[c.values,c.indices]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var XRe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"Const":return e[r.name];case"PlaceholderWithDefault":var a=I("default",r,e,t);return[sn(r.name,e,t)||a];case"Placeholder":return[sn(r.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{var i=I("x",r,e,t);return[co(i)]}case"IdentityN":return I("x",r,e,t).map(function(h){return co(h)});case"Snapshot":var o=I("x",r,e,t);return[co(o)];case"Shape":return[n.tensor1d(I("x",r,e,t).shape,"int32")];case"ShapeN":return I("x",r,e,t).map(function(h){return n.tensor1d(h.shape)});case"Size":return[n.scalar(I("x",r,e,t).size,"int32")];case"Rank":return[n.scalar(I("x",r,e,t).rank,"int32")];case"NoOp":return[n.scalar(1)];case"Print":var s=I("x",r,e,t),u=I("data",r,e,t),c=I("message",r,e,t),l=I("summarize",r,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var f=0;f<u.length;f++)console.log(Array.prototype.slice.call(u[f].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}},YRe=function(){function r(e,t){this.keyDType=e,this.valueDType=t,this.handle=Be.scalar(0),this.tensorMap=new Map,Be.keep(this.handle)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.handle.id},enumerable:!1,configurable:!0}),r.prototype.clearAndClose=function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()},r.prototype.size=function(){return this.tensorMap.size},r.prototype.tensorSize=function(){return Dr(this.size(),"int32")},r.prototype.import=function(e,t){return Et(this,void 0,void 0,function(){var n,a=this;return Nt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),this.tensorMap.forEach(function(o){return o.dispose()}),this.tensorMap.clear(),[2,Be.tidy(function(){var o=Be.unstack(t),s=n.length,u=o.length;Be.util.assert(s===u,function(){return"The number of elements doesn't match, keys has "+"".concat(s," elements, the values has ").concat(u," ")+"elements."});for(var c=0;c<s;c++){var l=n[c],f=o[c];Be.keep(f),a.tensorMap.set(l,f)}return a.handle})]}})})},r.prototype.find=function(e,t){return Et(this,void 0,void 0,function(){var n,a=this;return Nt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),[2,Be.tidy(function(){for(var o=[],s=0;s<n.length;s++){var u=n[s],c=a.findWithDefault(u,t);o.push(c)}return Be.stack(o)})]}})})},r.prototype.findWithDefault=function(e,t){var n=this.tensorMap.get(e);return n??t},r.prototype.checkKeyAndValueTensor=function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))},r}(),ZRe=function(r,e,t,n){return Et(void 0,void 0,void 0,function(){var a,i,o,s,h,f,c,u,h,f,c,l,h,f,h;return Nt(this,function(p){switch(p.label){case 0:switch(a=r.op,a){case"HashTable":return[3,1];case"HashTableV2":return[3,1];case"InitializeTable":return[3,2];case"InitializeTableV2":return[3,2];case"LookupTableImport":return[3,2];case"LookupTableImportV2":return[3,2];case"LookupTableFind":return[3,4];case"LookupTableFindV2":return[3,4];case"LookupTableSize":return[3,6];case"LookupTableSizeV2":return[3,6]}return[3,7];case 1:return i=n.getHashTableHandleByName(r.name),i!=null?[2,[i]]:(o=I("keyDType",r,e,t),s=I("valueDType",r,e,t),h=new YRe(o,s),n.addHashTable(r.name,h),[2,[h.handle]]);case 2:return f=I("tableHandle",r,e,t,n),c=I("keys",r,e,t),u=I("values",r,e,t),h=n.getHashTableById(f.id),[4,h.import(c,u)];case 3:return[2,[p.sent()]];case 4:return f=I("tableHandle",r,e,t,n),c=I("keys",r,e,t),l=I("defaultValue",r,e,t),h=n.getHashTableById(f.id),[4,h.find(c,l)];case 5:return[2,[p.sent()]];case 6:return f=I("tableHandle",r,e,t,n),h=n.getHashTableById(f.id),[2,[h.tensorSize()]];case 7:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};var JRe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"ResizeBilinear":{var a=I("images",r,e,t),i=I("size",r,e,t),o=I("alignCorners",r,e,t),s=I("halfPixelCenters",r,e,t);return[n.image.resizeBilinear(a,[i[0],i[1]],o,s)]}case"ResizeNearestNeighbor":{var a=I("images",r,e,t),i=I("size",r,e,t),o=I("alignCorners",r,e,t),s=I("halfPixelCenters",r,e,t);return[n.image.resizeNearestNeighbor(a,[i[0],i[1]],o,s)]}case"CropAndResize":{var u=I("image",r,e,t),c=I("boxes",r,e,t),l=I("boxInd",r,e,t),f=I("cropSize",r,e,t),h=I("method",r,e,t),p=I("extrapolationValue",r,e,t);return[n.image.cropAndResize(u,c,l,f,h,p)]}case"ImageProjectiveTransformV3":{var a=I("images",r,e,t),d=I("transforms",r,e,t),m=I("outputShape",r,e,t),v=I("fillValue",r,e,t),g=I("interpolation",r,e,t),y=I("fillMode",r,e,t);return[n.image.transform(a,d,g.toLowerCase(),y.toLowerCase(),v,m)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var QRe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"Equal":return[n.equal(I("a",r,e,t),I("b",r,e,t))];case"NotEqual":return[n.notEqual(I("a",r,e,t),I("b",r,e,t))];case"Greater":return[n.greater(I("a",r,e,t),I("b",r,e,t))];case"GreaterEqual":return[n.greaterEqual(I("a",r,e,t),I("b",r,e,t))];case"Less":return[n.less(I("a",r,e,t),I("b",r,e,t))];case"LessEqual":return[n.lessEqual(I("a",r,e,t),I("b",r,e,t))];case"LogicalAnd":return[n.logicalAnd(I("a",r,e,t),I("b",r,e,t))];case"LogicalNot":return[n.logicalNot(I("a",r,e,t))];case"LogicalOr":return[n.logicalOr(I("a",r,e,t),I("b",r,e,t))];case"Select":case"SelectV2":return[n.where(I("condition",r,e,t),I("a",r,e,t),I("b",r,e,t))];case"BitwiseAnd":return[n.bitwiseAnd(I("a",r,e,t),I("b",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}},eOe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[n.matMul(I("a",r,e,t),I("b",r,e,t),I("transposeA",r,e,t),I("transposeB",r,e,t))];case"Einsum":return[n.einsum.apply(n,Ft([I("equation",r,e,t)],we(I("tensors",r,e,t)),!1))];case"Transpose":return[n.transpose(I("x",r,e,t),I("perm",r,e,t))];case"_FusedMatMul":var a=we(I("fusedOps",r,e,t),2),i=a[0],o=a[1],s=i==="biasadd",u=o==="prelu",c=I("numArgs",r,e,t),l=I("leakyreluAlpha",r,e,t);if(s){if(u&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=we(I("args",r,e,t),2),h=f[0],p=f[1];return[n.fused.matMul({a:I("a",r,e,t),b:I("b",r,e,t),transposeA:I("transposeA",r,e,t),transposeB:I("transposeB",r,e,t),bias:h,activation:o,preluActivationWeights:p,leakyreluAlpha:l})];case"MatrixBandPart":return[n.linalg.bandPart(I("a",r,e,t),I("numLower",r,e,t),I("numUpper",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var tOe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"EuclideanNorm":return[n.euclideanNorm(I("x",r,e,t),I("axis",r,e,t),I("keepDims",r,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[n.batchNorm(I("x",r,e,t),I("mean",r,e,t),I("variance",r,e,t),I("offset",r,e,t),I("scale",r,e,t),I("epsilon",r,e,t))];case"FusedBatchNormV3":return[n.batchNorm(I("x",r,e,t),I("mean",r,e,t),I("variance",r,e,t),I("offset",r,e,t),I("scale",r,e,t),I("epsilon",r,e,t))];case"LRN":return[n.localResponseNormalization(I("x",r,e,t),I("radius",r,e,t),I("bias",r,e,t),I("alpha",r,e,t),I("beta",r,e,t))];case"Softmax":return[n.softmax(I("x",r,e,t))];case"LogSoftmax":return[n.logSoftmax(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var rOe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"RaggedGather":{var a=n.raggedGather(I("paramsNestedSplits",r,e,t),I("paramsDenseValues",r,e,t),I("indices",r,e,t),I("outputRaggedRank",r,e,t)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o)}case"RaggedRange":{var s=n.raggedRange(I("starts",r,e,t),I("limits",r,e,t),I("splits",r,e,t)),u=s.rtNestedSplits,c=s.rtDenseValues;return[u,c]}case"RaggedTensorToTensor":return[n.raggedTensorToTensor(I("shape",r,e,t),I("values",r,e,t),I("defaultValue",r,e,t),I("rowPartitionTensors",r,e,t),I("rowPartitionTypes",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var nOe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"Max":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.max(I("x",r,e,t),a,i)]}case"Mean":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.mean(I("x",r,e,t),a,i)]}case"Min":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.min(I("x",r,e,t),a,i)]}case"Sum":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.sum(I("x",r,e,t),a,i)]}case"All":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.all(I("x",r,e,t),a,i)]}case"Any":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.any(I("x",r,e,t),a,i)]}case"ArgMax":{var a=I("axis",r,e,t);return[n.argMax(I("x",r,e,t),a)]}case"ArgMin":{var a=I("axis",r,e,t);return[n.argMin(I("x",r,e,t),a)]}case"Prod":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.prod(I("x",r,e,t),a,i)]}case"Cumprod":{var a=I("axis",r,e,t),o=I("exclusive",r,e,t),s=I("reverse",r,e,t);return[n.cumprod(I("x",r,e,t),a,o,s)]}case"Cumsum":{var a=I("axis",r,e,t),o=I("exclusive",r,e,t),s=I("reverse",r,e,t);return[n.cumsum(I("x",r,e,t),a,o,s)]}case"Bincount":var u=I("x",r,e,t),c=I("weights",r,e,t),l=I("size",r,e,t);return[n.bincount(u,c,l)];case"DenseBincount":{var f=I("x",r,e,t),h=I("weights",r,e,t),p=I("size",r,e,t),d=I("binaryOutput",r,e,t);return[n.denseBincount(f,h,p,d)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var aOe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"ConcatV2":case"Concat":{var a=I("n",r,e,t),i=I("axis",r,e,t),o=I("tensors",r,e,t);return o=o.slice(0,a),[n.concat(o,i)]}case"Gather":{var s=I("x",r,e,t),u=I("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),0)]}case"GatherV2":{var i=I("axis",r,e,t),c=I("batchDims",r,e,t),s=I("x",r,e,t),u=I("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),i,c)]}case"Reverse":{for(var l=I("dims",r,e,t),i=[],f=0;f<l.length;f++)l[f]&&i.push(f);var s=I("x",r,e,t);return[n.reverse(s,i)]}case"ReverseV2":{var i=I("axis",r,e,t),s=I("x",r,e,t);return[n.reverse(s,i)]}case"Slice":{var h=I("begin",r,e,t),p=I("size",r,e,t);return[n.slice(I("x",r,e,t),h,p)]}case"StridedSlice":{var h=I("begin",r,e,t),d=I("end",r,e,t),m=I("strides",r,e,t),v=I("beginMask",r,e,t),g=I("endMask",r,e,t),y=I("ellipsisMask",r,e,t),w=I("newAxisMask",r,e,t),b=I("shrinkAxisMask",r,e,t),x=I("x",r,e,t);return[n.stridedSlice(x,h,d,m,v,g,y,w,b)]}case"Pack":return Be.tidy(function(){var $=I("axis",r,e,t),z=I("tensors",r,e,t),L=z[0].shape,B=n.squeeze(z[0]).shape,q=z.map(function(Y){var J=Be.util.arraysEqual(Y.shape,L);if(!J&&!Be.util.arraysEqual(n.squeeze(Y).shape,B))throw new Error("the input tensors shape does not match");return J?Y:n.reshape(Y,L)});return[n.stack(q,$)]});case"Unpack":{var i=I("axis",r,e,t),x=I("tensor",r,e,t);return n.unstack(x,i)}case"Tile":{var S=I("reps",r,e,t);return[n.tile(I("x",r,e,t),S)]}case"Split":case"SplitV":{var i=I("axis",r,e,t),T=I("numOrSizeSplits",r,e,t),x=I("x",r,e,t);return n.split(x,T,i)}case"ScatterNd":{var u=I("indices",r,e,t),E=I("values",r,e,t),C=I("shape",r,e,t);return[n.scatterND(u,E,C)]}case"GatherNd":{var R=I("x",r,e,t),u=I("indices",r,e,t);return[n.gatherND(R,u)]}case"SparseToDense":{var u=I("sparseIndices",r,e,t),C=I("outputShape",r,e,t),_=I("sparseValues",r,e,t),P=I("defaultValue",r,e,t);return[n.sparseToDense(u,_,C,_.dtype===P.dtype?P:n.cast(P,_.dtype))]}case"TensorScatterUpdate":{var u=I("indices",r,e,t),E=I("values",r,e,t),x=I("tensor",r,e,t);return[n.tensorScatterUpdate(x,u,E)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var iOe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"SparseFillEmptyRows":{var a=n.sparse.sparseFillEmptyRows(I("indices",r,e,t),I("values",r,e,t),I("denseShape",r,e,t),I("defaultValue",r,e,t)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u]}case"SparseReshape":{var c=n.sparse.sparseReshape(I("inputIndices",r,e,t),I("inputShape",r,e,t),I("newShape",r,e,t)),i=c.outputIndices,l=c.outputShape;return[i,l]}case"SparseSegmentMean":{var f=n.sparse.sparseSegmentMean(I("data",r,e,t),I("indices",r,e,t),I("segmentIds",r,e,t));return[f]}case"SparseSegmentSum":{var f=n.sparse.sparseSegmentSum(I("data",r,e,t),I("indices",r,e,t),I("segmentIds",r,e,t));return[f]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var oOe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"FFT":return[n.fft(I("x",r,e,t))];case"IFFT":return[n.ifft(I("x",r,e,t))];case"RFFT":return[n.rfft(I("x",r,e,t))];case"IRFFT":return[n.irfft(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var sOe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"StaticRegexReplace":return[n.string.staticRegexReplace(I("input",r,e,t),I("pattern",r,e,t),I("rewrite",r,e,t),I("replaceGlobal",r,e,t))];case"StringNGrams":{var a=n.string.stringNGrams(I("data",r,e,t),I("dataSplits",r,e,t),I("separator",r,e,t),I("nGramWidths",r,e,t),I("leftPad",r,e,t),I("rightPad",r,e,t),I("padWidth",r,e,t),I("preserveShortSequences",r,e,t)),i=a.nGrams,o=a.nGramsSplits;return[i,o]}case"StringSplit":{var s=n.string.stringSplit(I("input",r,e,t),I("delimiter",r,e,t),I("skipEmpty",r,e,t)),u=s.indices,c=s.values,l=s.shape;return[u,c,l]}case"StringToHashBucketFast":{var f=n.string.stringToHashBucketFast(I("input",r,e,t),I("numBuckets",r,e,t));return[f]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var uOe=function(r,e,t,n){switch(n===void 0&&(n=un),r.op){case"Cast":return[n.cast(I("x",r,e,t),I("dtype",r,e,t))];case"ExpandDims":{var a=I("axis",r,e,t);return[n.expandDims(I("x",r,e,t),a)]}case"Squeeze":{var a=I("axis",r,e,t);return[n.squeeze(I("x",r,e,t),a)]}case"Reshape":return[n.reshape(I("x",r,e,t),I("shape",r,e,t))];case"EnsureShape":return[n.ensureShape(I("x",r,e,t),I("shape",r,e,t))];case"MirrorPad":return[n.mirrorPad(I("x",r,e,t),I("padding",r,e,t),I("mode",r,e,t))];case"PadV2":case"Pad":return[n.pad(I("x",r,e,t),I("padding",r,e,t),I("constantValue",r,e,t))];case"SpaceToBatchND":{var i=I("blockShape",r,e,t),o=I("paddings",r,e,t);return[n.spaceToBatchND(I("x",r,e,t),i,o)]}case"BatchToSpaceND":{var i=I("blockShape",r,e,t),s=I("crops",r,e,t);return[n.batchToSpaceND(I("x",r,e,t),i,s)]}case"DepthToSpace":{var u=I("blockSize",r,e,t),c=I("dataFormat",r,e,t).toUpperCase();return[n.depthToSpace(I("x",r,e,t),u,c)]}case"BroadcastTo":return[n.broadcastTo(I("x",r,e,t),I("shape",r,e,t))];case"BroadcastArgs":return[n.broadcastArgs(I("s0",r,e,t),I("s1",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function sL(r,e,t,n,a){a===void 0&&(a=RB.tidy);var i=function(o,s,u){switch(o.category){case"arithmetic":return a(function(){return BRe(o,s,u)});case"basic_math":return a(function(){return LRe(o,s,u)});case"control":return VRe(o,s,u);case"convolution":return a(function(){return GRe(o,s,u)});case"creation":return a(function(){return HRe(o,s,u)});case"dynamic":return KRe(o,s,u);case"evaluation":return a(function(){return jRe(o,s,u)});case"image":return a(function(){return JRe(o,s,u)});case"graph":return a(function(){return XRe(o,s,u)});case"logical":return a(function(){return QRe(o,s,u)});case"matrices":return a(function(){return eOe(o,s,u)});case"normalization":return a(function(){return tOe(o,s,u)});case"ragged":return a(function(){return rOe(o,s,u)});case"reduction":return a(function(){return nOe(o,s,u)});case"slice_join":return a(function(){return aOe(o,s,u)});case"sparse":return a(function(){return iOe(o,s,u)});case"spectral":return a(function(){return oOe(o,s,u)});case"string":return a(function(){return sOe(o,s,u)});case"transformation":return a(function(){return uOe(o,s,u)});case"hash_table":return ZRe(o,s,u,n);case"custom":var c=pL(o.op);if(c&&c.customExecutor)return c.customExecutor(new G2e(o,s,u));throw TypeError("Custom op ".concat(o.op," is not registered."));default:throw TypeError("Unknown op '".concat(o.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(r,e,t);return RB.util.isPromise(i)?i.then(function(o){return[].concat(o)}):[].concat(i)}var uL=function(){function r(e,t,n,a,i){e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n={}),a===void 0&&(a={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=a,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return r.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(r.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!1,configurable:!0}),r.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},r.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":"".concat(t.frameName,"-").concat(t.iterationId)}).join("/"):""},r.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},r.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")},r.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")},r.prototype.getWeight=function(e){return this.weightMap[e]},r.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},r.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},r.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},r.prototype.getTensorList=function(e){return this.tensorListMap[e]},r.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},r}();function cL(r,e,t,n){var a=new Set,i=[],o=null,s=null,u=new Set,c=new Set(Object.keys(r).map(function(p){return ra(p)[0]}));n=n||[];for(var l=new Set(n.map(function(p){return ra(p.name)[0]})),f=Ft([],we(e),!1);f.length>0;){var h=f.pop();if((ru(h)||mOe(h)||gOe(h))&&o==null&&(o=h,s=o.children.map(function(p){return p.name}).filter(function(p){return a.has(p)})),a.add(h.name),t[h.name]==null&&!c.has(h.name)&&!l.has(h.name)){if(h.inputs.length===0){i.push(h.name);continue}h.inputs.forEach(function(p){u.has(p.name)||(u.add(p.name),f.push(p))})}}return{inputs:r,outputs:e,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function cOe(r,e){var t,n,a,i,o,s,u=e.usedNodes,c=e.inputs,l=Object.keys(c).map(function(L){return ra(L)[0]}).map(function(L){return r.nodes[L]}),f=r.initNodes||[],h=function(L){return u.has(typeof L=="string"?L:L.name)};function p(L){return Ft([],we(new Map(L.map(function(B){return[B.name,B]})).values()),!1)}var d=p(Ft(Ft(Ft([],we(l),!1),we(r.weights),!1),we(f),!1)).filter(h),m=p(Ft(Ft([],we(d),!1),we(Object.values(r.nodes)),!1)).filter(h),v=new Map(m.map(function(L){return[L.name,L]})),g={};try{for(var y=Ur(m),w=y.next();!w.done;w=y.next()){var b=w.value;g[b.name]=g[b.name]||0;try{for(var x=(a=void 0,Ur(b.children)),S=x.next();!S.done;S=x.next()){var T=S.value;h(T)||(g[T.name]=Number.POSITIVE_INFINITY),g[T.name]=(g[T.name]||0)+1}}catch(L){a={error:L}}finally{try{S&&!S.done&&(i=x.return)&&i.call(x)}finally{if(a)throw a.error}}}}catch(L){t={error:L}}finally{try{w&&!w.done&&(n=y.return)&&n.call(y)}finally{if(t)throw t.error}}for(var E=Object.entries(g).filter(function(L){var B=we(L,2),q=B[1];return q===0}).map(function(L){var B=we(L,1),q=B[0];return q}),C=Ft([],we(E),!1);E.length>0;){var R=E.pop(),b=v.get(R);try{for(var _=(o=void 0,Ur(b.children.filter(h))),P=_.next();!P.done;P=_.next()){var T=P.value;--g[T.name]===0&&(C.push(T.name),E.push(T.name))}}catch(B){o={error:B}}finally{try{P&&!P.done&&(s=_.return)&&s.call(_)}finally{if(o)throw o.error}}}var $=C.map(function(L){return v.get(L)}),z=lOe($,d);return fOe(z,d),z}function lOe(r,e){for(var t,n,a=new Map(r.map(function(p){return[p.name,p]})),i=e.map(function(p){return p.name}),o=new Set(i);i.length>0;){var s=i.pop(),u=a.get(s);try{for(var c=(t=void 0,Ur(u.children)),l=c.next();!l.done;l=c.next()){var f=l.value;!a.has(f.name)||o.has(f.name)||(o.add(f.name),i.push(f.name))}}catch(p){t={error:p}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}}var h=r.filter(function(p){return o.has(p.name)});return h}var Tv=function(r){hL(e,r);function e(t){return r.call(this,"NodesExecutionOrderError: ".concat(t))||this}return e}(Error);function fOe(r,e){var t,n,a,i,o,s,u=new Map(r.map(function(S,T){return[S.name,T]})),c=new Set(e.map(function(S){return S.name})),l=function(S){return c.has(typeof S=="string"?S:S.name)},f=new Set(r.map(function(S){return S.name})),h=function(S){return f.has(typeof S=="string"?S:S.name)};try{for(var p=Ur(r),d=p.next();!d.done;d=p.next()){var m=d.value;try{for(var v=(a=void 0,Ur(m.children.filter(h))),g=v.next();!g.done;g=v.next()){var y=g.value;if(!u.has(y.name))throw new Tv("Child ".concat(y.name," of node ").concat(m.name," is unreachable."));if(u.get(m.name)>u.get(y.name))throw new Tv("Node ".concat(m.name," is scheduled to run after its child ").concat(y.name,"."))}}catch(S){a={error:S}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}if(!l(m))try{for(var w=(o=void 0,Ur(m.inputs)),b=w.next();!b.done;b=w.next()){var x=b.value;if(!u.has(x.name))throw new Tv("Input ".concat(x.name," of node ").concat(m.name," is unreachable."));if(u.get(x.name)>u.get(m.name))throw new Tv("Node ".concat(m.name," is scheduled to run before its input ").concat(x.name,"."))}}catch(S){o={error:S}}finally{try{b&&!b.done&&(s=w.return)&&s.call(w)}finally{if(o)throw o.error}}}}catch(S){t={error:S}}finally{try{d&&!d.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}}function hOe(r){for(var e=new Map(r.map(function(f,h){return[f.name,h]})),t=Number.MAX_SAFE_INTEGER,n=r.map(function(f,h){return ru(f)?t:h}),a=function(f){var h=n[e.get(f.name)];return h??-1},i=r.map(function(f,h){return f.children.map(a).reduce(function(p,d){return Math.max(p,d)},n[h])}),o=new Map,s=0;s<r.length;++s){var u=i[s];if(u!==t){var c=r[s],l=r[u];o.has(l.name)||o.set(l.name,[]),o.get(l.name).push(c)}}return o}var pOe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),dOe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),vOe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function ru(r){return pOe.has(r.op)}function mOe(r){return dOe.has(r.op)}function gOe(r){return vOe.has(r.op)}var lL=function(){function r(e,t){var n=this;this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(function(a){n._functionExecutorMap[a]=new r(e.functions[a],n)})}return Object.defineProperty(r.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(n){return e[n].map(function(a){return a.id})});this._weightIds=[].concat.apply([],Ft([],we(t),!1)),this._weightMap=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"resourceManager",{set:function(e){this._resourceManager=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,n){return t[n]=e._functions[n].signature,t},{})},enumerable:!1,configurable:!0}),r.prototype.getCompilationKey=function(e,t){var n=e.map(function(i){return i.name}).sort(),a=t.map(function(i){return i.name}).sort();return n.join(this.SEPARATOR)+"--"+a.join(this.SEPARATOR)},r.prototype.compile=function(e,t){var n=cL(e,t,this.weightMap,this._initNodes),a=n.missingInputs,i=n.dynamicNode,o=n.syncInputs;if(i!=null)throw new Error("This execution contains the node '".concat(i.name,"', which has ")+"the dynamic op '".concat(i.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(o,"]"));if(a.length>0){var s=t.map(function(f){return f.name}),u=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(s,"] from the provided inputs ")+"[".concat(u,"]. Missing the following inputs: [").concat(a,"]"))}var c=cOe(this.graph,n),l=hOe(c);return{orderedNodes:c,nodeLiveUntilMap:l}},r.prototype.cloneAndKeepTensor=function(e){if(e==null)return null;var t=e.clone();return Be.keep(t),t},r.prototype.cloneTensorList=function(e){var t=this;if(!e)return null;var n=e.map(function(a){return t.cloneAndKeepTensor(a)});return n},r.prototype.cloneTensorMap=function(e){var t=this;return Object.fromEntries(Object.entries(e).map(function(n){var a=we(n,2),i=a[0],o=a[1];return[i,t.cloneTensorList(o)]}))},r.prototype.execute=function(e,t){var n=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(p){return n.graph.nodes[ra(p)[0]]}),o=t.map(function(p){return ra(p)[0]}),s=new Set(o),u=o.map(function(p){return n.graph.nodes[p]});u.length===0&&(u=this._outputs);var c=this.getCompilationKey(i,u),l=this.compiledMap.get(c);l==null&&(l=this.compile(e,u),this.compiledMap.set(c,l));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}var f={},h={};return Be.tidy(function(){var p,d,m=new uL(n.weightMap,f,h,n.functionExecutorMap,n.parseNodeNameCache),v=Object.assign({},n.weightMap);n.keepIntermediateTensors&&(n.clonedTensorsMap=n.cloneTensorMap(n.weightMap)),Object.keys(e).forEach(function(E){var C=we(ra(E,m),2),R=C[0],_=C[1],P=[];P[_]=e[E],v[R]=P,n.keepIntermediateTensors&&(n.clonedTensorsMap[R]=n.cloneTensorList(P))});var g=n.getFrozenTensorIds(v),y=l.orderedNodes,w=l.nodeLiveUntilMap;try{for(var b=Ur(y),x=b.next();!x.done;x=b.next()){var S=x.value;if(!v[S.name]){var T=sL(S,v,m,n._resourceManager);if(Be.util.isPromise(T))throw new Error("The execution of the op '".concat(S.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");v[S.name]=T,n.keepIntermediateTensors&&(n.clonedTensorsMap[S.name]=n.cloneTensorList(T)),n.checkTensorForDisposalWithNodeLiveUntilInfo(S,v,m,g,s,w.get(S.name))}}}catch(E){p={error:E}}finally{try{x&&!x.done&&(d=b.return)&&d.call(b)}finally{if(p)throw p.error}}return n.parent==null&&m.dispose(g),t.map(function(E){return sn(E,v,m)})})},r.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(n){return e[n]}).map(function(n){return n.map(function(a){return a.id})}));return new Set(t)},r.prototype.checkTensorForDisposal=function(e,t,n,a,i,o,s){var u,c,l,f,h,p;if(!(ru(t)||o.has(e))){try{for(var d=Ur(n[e]),m=d.next();!m.done;m=d.next()){var v=m.value;v!=null&&(s[v.id]=(s[v.id]||0)+t.children.length)}}catch(E){u={error:E}}finally{try{m&&!m.done&&(c=d.return)&&c.call(d)}finally{if(u)throw u.error}}try{for(var g=Ur(t.inputs),y=g.next();!y.done;y=g.next()){var w=y.value;if(!ru(w)){var b=PB(w.name,n,a);if(b!=null)try{for(var x=(h=void 0,Ur(b)),S=x.next();!S.done;S=x.next()){var v=S.value;if(!(!v||v.kept||i.has(v.id))){var T=s[v.id];T===1?(v.dispose(),delete s[v.id]):T!=null&&s[v.id]--}}}catch(E){h={error:E}}finally{try{S&&!S.done&&(p=x.return)&&p.call(x)}finally{if(h)throw h.error}}}}}catch(E){l={error:E}}finally{try{y&&!y.done&&(f=g.return)&&f.call(g)}finally{if(l)throw l.error}}}},r.prototype.checkTensorForDisposalWithNodeLiveUntilInfo=function(e,t,n,a,i,o){var s,u,c,l;function f(w){return ru(w)||i.has(w.name)}if(!(ru(e)||o==null))try{for(var h=Ur(o),p=h.next();!p.done;p=h.next()){var d=p.value;if(!f(d)){var m=PB(d.name,t,n);try{for(var v=(c=void 0,Ur(m)),g=v.next();!g.done;g=v.next()){var y=g.value;!y||y.kept||a.has(y.id)||y.dispose()}}catch(w){c={error:w}}finally{try{g&&!g.done&&(l=v.return)&&l.call(v)}finally{if(c)throw c.error}}}}}catch(w){s={error:w}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}},r.prototype.executeAsync=function(e,t){return Et(this,void 0,void 0,function(){return Nt(this,function(n){return[2,this._executeAsync(e,t)]})})},r.prototype.disposeIntermediateTensors=function(){!this.clonedTensorsMap||(Object.values(this.clonedTensorsMap).forEach(function(e){var t,n;try{for(var a=Ur(e),i=a.next();!i.done;i=a.next()){var o=i.value;o&&!o.isDisposed&&o.dispose()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}),this.clonedTensorsMap=null)},r.prototype.getIntermediateTensors=function(){return this.clonedTensorsMap},r.prototype._executeAsync=function(e,t,n,a,i){return n===void 0&&(n=!1),a===void 0&&(a={}),i===void 0&&(i={}),Et(this,void 0,void 0,function(){var o,s,u,c,l,f;return Nt(this,function(h){switch(h.label){case 0:this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}return o=new uL(this.weightMap,a,i,this.functionExecutorMap,this.parseNodeNameCache),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),[4,this.executeWithControlFlow(e,o,t,n)];case 1:return s=h.sent(),u=t.map(function(p){return sn(p,s,o)}),c=u.map(function(p){return p.id}),l=Object.keys(e).map(function(p){return e[p].id}),f=new Set(Ft(Ft(Ft([],we(c),!1),we(l),!1),we(this.weightIds),!1)),Object.values(s).forEach(function(p){p.forEach(function(d){d&&!d.isDisposed&&!f.has(d.id)&&d.dispose()})}),this.parent==null&&o.dispose(f),[2,u]}})})},r.prototype.executeFunctionAsync=function(e,t,n){return Et(this,void 0,void 0,function(){var a,i=this;return Nt(this,function(o){return a=e.reduce(function(s,u,c){return s[i.inputs[c].name]=u,s},{}),[2,this._executeAsync(a,this.outputNodes,!0,t,n)]})})},r.prototype.executeWithControlFlow=function(e,t,n,a){return Et(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T=this;return Nt(this,function(E){switch(E.label){case 0:i=Object.keys(e),o=i.map(function(C){return T.graph.nodes[ra(C)[0]]}),s=n.map(function(C){return ra(C)[0]}),u=new Set(s),c=s.map(function(C){return T.graph.nodes[C]}),c.length===0&&(c=this._outputs),l=cL(e,c,this.weightMap,this._initNodes),f=l.usedNodes,h=l.missingInputs,p=l.dynamicNode,d=l.syncInputs,m=Ft(Ft(Ft([],we(o),!1),we(this.graph.weights),!1),we(this._initNodes||[]),!1).map(function(C){return{node:C,contexts:t.currentContext}}),v=Object.assign({},this.weightMap),Object.keys(e).forEach(function(C){var R=we(ra(C),2),_=R[0],P=R[1],$=[];$[P]=e[C],v[_]=$}),g={},y=this.getFrozenTensorIds(v),w={},E.label=1;case 1:return m.length>0?(b=this.processStack(o,m,t,v,w,y,u,g,f),[4,Promise.all(b)]):[3,3];case 2:return E.sent(),[3,1];case 3:if(p==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),x=c.filter(function(C){return!ru(C)&&!sn(C.name,v,t)}).map(function(C){return C.name}),x.length>0)throw S="",p!=null&&(S="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(x,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(h,"]. ").concat(S));return[2,v]}})})},r.prototype.processStack=function(e,t,n,a,i,o,s,u,c){for(var l=this,f=[],h=function(){var d,m,v=t.pop();n.currentContext=v.contexts;var g="";if(v.node.op==="Enter"&&I("isConstant",v.node,a,n)&&(d=we(uo(v.node.name,n),1),g=d[0]),a[v.node.name]==null){var y=sL(v.node,a,n,p._resourceManager);g||(m=we(uo(v.node.name,n),1),g=m[0]);var w=n.currentContext;Be.util.isPromise(y)?f.push(y.then(function(b){return a[g]=b,l.keepIntermediateTensors&&(l.clonedTensorsMap[g]=l.cloneTensorList(b)),n.currentContext=w,l.checkTensorForDisposal(g,v.node,a,n,o,s,u),l.processChildNodes(v.node,t,n,a,i,c),b})):(a[g]=y,p.keepIntermediateTensors&&(p.clonedTensorsMap[g]=p.cloneTensorList(y)),p.checkTensorForDisposal(g,v.node,a,n,o,s,u),p.processChildNodes(v.node,t,n,a,i,c))}else p.processChildNodes(v.node,t,n,a,i,c)},p=this;t.length>0;)h();return f},r.prototype.processChildNodes=function(e,t,n,a,i,o){e.children.forEach(function(s){var u=we(uo(s.name,n),1),c=u[0];i[c]||!o.has(s.name)||(s.op==="Merge"?s.inputNames.some(function(l){return!!sn(l,a,n)})&&(i[c]=!0,t.push({contexts:n.currentContext,node:s})):s.inputNames.every(function(l){return!!sn(l,a,n)})&&(i[c]=!0,t.push({contexts:n.currentContext,node:s})))})},r.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(n){return n.dispose()})})},r.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(n){var a=e[n],i=we(ra(n),1),o=i[0],s=t.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){var u=s.attrParams.shape.value,c=u.length===a.shape.length&&a.shape.every(function(l,f){return u[f]===-1||u[f]===l});Be.util.assert(c,function(){return"The shape of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be [".concat(u,"], but was ")+"[".concat(a.shape,"]")})}s.attrParams.dtype&&s.attrParams.dtype.value&&Be.util.assert(a.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(s.attrParams.dtype.value,", but was ").concat(a.dtype)})})},r.prototype.mapInputs=function(e){var t,n,a={};for(var i in e){var o=(n=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||n===void 0?void 0:n[i];o!=null?a[o.name]=e[i]:a[i]=e[i]}return a},r.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter(function(a){var i=we(ra(a),1),o=i[0];return t.graph.nodes[o]==null});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(n,"] that are not part of graph"))},r.prototype.mapOutputs=function(e){var t=this;return e.map(function(n){var a,i,o=(i=(a=t._signature)===null||a===void 0?void 0:a.outputs)===null||i===void 0?void 0:i[n];return o!=null?o.name:n},{})},r.prototype.checkOutputs=function(e){var t=this;e.forEach(function(n){var a=we(ra(n),1),i=a[0];if(!t.graph.nodes[i])throw new Error("The output '".concat(n,"' is not found in the graph"))})},r}(),yOe=function(){function r(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.hashTableNameToHandle=e,this.hashTableMap=t}return r.prototype.addHashTable=function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t},r.prototype.getHashTableHandleByName=function(e){return this.hashTableNameToHandle[e]},r.prototype.getHashTableById=function(e){return this.hashTableMap[e]},r.prototype.dispose=function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]},r}();var $v={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Wv=4;function bOe(r,e){return Et(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c;return Nt(this,function(l){switch(l.label){case 0:return t=Zr(r.shape),"quantization"in r?(a=r.quantization,n=$v[a.dtype],[3,7]):[3,1];case 1:if(r.dtype!=="string")return[3,6];i=0,o=0,l.label=2;case 2:return o<t?(s=i,u=Wv,c=Uint32Array.bind,[4,e(i,i+Wv)]):[3,5];case 3:i=s+(u+new(c.apply(Uint32Array,[void 0,l.sent()]))()[0]),l.label=4;case 4:return o++,[3,2];case 5:return[2,i];case 6:n=$v[r.dtype],l.label=7;case 7:return[2,t*n]}})})}function wOe(r,e){var t=r.name,n=r.dtype,a=r.shape,i=Zr(a),o,s=0;if("quantization"in r){var u=r.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error("Weight ".concat(r.name," with quantization ").concat(u.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(u.dtype==="float16"){if(n!=="float32")throw new Error("Weight ".concat(r.name," is quantized with ").concat(u.dtype," ")+"which only supports weights of type float32 not ".concat(n,"."))}else throw new Error("Weight ".concat(r.name," has unknown ")+"quantization dtype ".concat(u.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var c=$v[u.dtype],l=u.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(n==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){o=new Float32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=h*u.scale+u.min}}else if(u.dtype==="float16"){var p=TOe();o=p(l)}else throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type float32.");else if(n==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type int32.");o=new Int32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=Math.round(h*u.scale+u.min)}}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*c}else if(n==="string"){var d=Zr(r.shape);o=[];for(var f=0;f<d;f++){var m=new Uint32Array(e.slice(s,s+Wv))[0];s+=Wv;var v=new Uint8Array(e.slice(s,s+m));o.push(v),s+=m}}else{var g=$v[n];if(n==="float32")o=new Float32Array(e);else if(n==="int32")o=new Int32Array(e);else if(n==="bool")o=new Uint8Array(e);else if(n==="complex64"){o=new Float32Array(e);for(var y=new Float32Array(o.length/2),w=new Float32Array(o.length/2),f=0;f<y.length;f++)y[f]=o[f*2],w[f]=o[f*2+1];var b=_c(y,a,"float32"),x=_c(w,a,"float32"),S=ns(b,x);return b.dispose(),x.dispose(),S}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*g}return _c(o,a,n)}function fL(r,e,t){return Et(this,void 0,void 0,function(){var n,a,i,o,s,u;return Nt(this,function(c){switch(c.label){case 0:n=new Uint8Array(e),c.label=1;case 1:return n.byteLength<t?[4,r.read()]:[3,3];case 2:if(a=c.sent(),i=a.done,o=a.value,i&&o==null)throw s=t-n.byteLength,new Error("Reader is done but ".concat(s," bytes are still expected"));return u=new Uint8Array(n.length+o.byteLength),u.set(n,0),u.set(new Uint8Array(o),n.length),n=u,[3,1];case 3:return[2,n.buffer]}})})}function xOe(r,e){return Et(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m=this;return Nt(this,function(v){switch(v.label){case 0:t={},n=r.getReader(),a=new ArrayBuffer(0),v.label=1;case 1:v.trys.push([1,7,8,9]),i=Ur(e),o=i.next(),v.label=2;case 2:return o.done?[3,6]:(s=o.value,[4,bOe(s,function(g,y){return Et(m,void 0,void 0,function(){return Nt(this,function(w){switch(w.label){case 0:return[4,fL(n,a,y)];case 1:return a=w.sent(),[2,a.slice(g,y)]}})})})]);case 3:return u=v.sent(),[4,fL(n,a,u)];case 4:a=v.sent(),c=a.slice(0,u),a=a.slice(u),l=wOe(s,c),t[s.name]=l,x_e()==="webgpu"&&(f=k_e(),"uploadToGPU"in f&&Zr(l.shape)>=Pn().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&f.uploadToGPU(l.dataId)),v.label=5;case 5:return o=i.next(),[3,2];case 6:return[3,9];case 7:return h=v.sent(),p={error:h},[3,9];case 8:try{o&&!o.done&&(d=i.return)&&d.call(i)}finally{if(p)throw p.error}return[7];case 9:return[2,t]}})})}function kOe(){var r=function(n){for(var a=n<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=r(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function SOe(){var r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(var e=1;e<31;e++)r[e]=e<<23;for(var e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function NOe(){for(var r=new Uint32Array(64),e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function TOe(){var r=kOe(),e=SOe(),t=NOe();return function(n){for(var a=new ArrayBuffer(4*n.length),i=new Uint32Array(a),o=0;o<n.length;o++){var s=n[o],u=r[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var EOe="?tfjs-format=file",IOe="model.json",vx=function(){function r(e,t,n){t===void 0&&(t={}),n===void 0&&(n=Be.io),this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new yOe}return Object.defineProperty(r.prototype,"modelVersion",{get:function(){return this.version},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"metadata",{get:function(){return this.artifacts.userDefinedMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelSignature",{get:function(){return this.signature},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelStructuredOutputKeys",{get:function(){return this.structuredOutputKeys},enumerable:!1,configurable:!0}),r.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}},r.prototype.load=function(){var e=this;if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Be.util.isPromise(t)?t.then(function(n){return n.getWeightStream==null?e.loadSync(n):e.loadStreaming(n)}):this.loadSync(t)},r.prototype.loadSync=function(e){var t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)},r.prototype.loadStreaming=function(e){return Et(this,void 0,void 0,function(){var t;return Nt(this,function(n){switch(n.label){case 0:if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");return[4,xOe(e.getWeightStream(),e.weightSpecs)];case 1:return t=n.sent(),[2,this.loadWithWeightMap(e,t)]}})})},r.prototype.loadWithWeightMap=function(e,t){this.artifacts=e;var n=this.artifacts.modelTopology,a=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){var i=this.artifacts.userDefinedMetadata;i.signature!=null&&(a=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=a,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer),this.executor=new lL(MB.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){var o=MB.Instance.transformGraph(e.modelInitializer);this.initializer=new lL(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0},r.prototype.save=function(e,t){return Et(this,void 0,void 0,function(){var n;return Nt(this,function(a){if(typeof e=="string"){if(n=this.io.getSaveHandlers(e),n.length===0)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(n.length>1)throw new Error("Found more than one (".concat(n.length,") save handlers for ")+"URL '".concat(e,"'"));e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},r.prototype.addStructuredOutputNames=function(e){var t=this;if(this.structuredOutputKeys){var n=e instanceof Be.Tensor?[e]:e,a={};return n.forEach(function(i,o){return a[t.structuredOutputKeys[o]]=i}),a}return e},r.prototype.predict=function(e,t){var n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)},r.prototype.predictAsync=function(e,t){return Et(this,void 0,void 0,function(){var n;return Nt(this,function(a){switch(a.label){case 0:return[4,this.executeAsync(e,this.outputNodes)];case 1:return n=a.sent(),[2,this.addStructuredOutputNames(n)]}})})},r.prototype.normalizeInputs=function(e){var t=this,n;if(!(e instanceof Be.Tensor)&&!Array.isArray(e)){var a=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(a!=null)for(var i in a){var o=a[i];o.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[o.resourceId])}return e}e=Array.isArray(e)?e:[e];var s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-s," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var u=0;return this.inputNodes.reduce(function(c,l){var f,h,p,d=(p=(h=(f=t.signature)===null||f===void 0?void 0:f.inputs)===null||h===void 0?void 0:h[l])===null||p===void 0?void 0:p.resourceId;return d!=null?c[l]=t.resourceIdToCapturedInput[d]:c[l]=e[u++],c},{})},r.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},r.prototype.executeInitializerGraph=function(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))},r.prototype.executeInitializerGraphAsync=function(){return Et(this,void 0,void 0,function(){return Nt(this,function(e){return this.initializer==null?[2,[]]:this.initializerSignature==null?[2,this.initializer.executeAsync({},[])]:[2,this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))]})})},r.prototype.setResourceIdToCapturedInput=function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,n=Object.keys(t),a=0;a<n.length;a++){var i=n[a],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[a]}},r.prototype.execute=function(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},r.prototype.executeAsync=function(e,t){return Et(this,void 0,void 0,function(){var n,a;return Nt(this,function(i){switch(i.label){case 0:return this.resourceIdToCapturedInput!=null?[3,2]:(n=this.setResourceIdToCapturedInput,[4,this.executeInitializerGraphAsync()]);case 1:n.apply(this,[i.sent()]),i.label=2;case 2:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 3:return a=i.sent(),[2,a.length>1?a:a[0]]}})})},r.prototype.getIntermediateTensors=function(){return this.executor.getIntermediateTensors()},r.prototype.disposeIntermediateTensors=function(){this.executor.disposeIntermediateTensors()},r.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,n){return t[n]=[e[n]],t},{})},r.prototype.dispose=function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Be.dispose(this.resourceIdToCapturedInput)),this.resourceManager.dispose()},r}();function COe(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=Be.io),Et(this,void 0,void 0,function(){var n;return Nt(this,function(a){switch(a.label){case 0:if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&typeof r=="string"&&(r=DOe(r)),n=new vx(r,e,t),[4,n.load()];case 1:return a.sent(),[2,n]}})})}function AOe(r){if(r==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var e;if(r instanceof Array){var t=we(r,2),n=t[0],a=t[1];if(!n)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");var i=Be.io.getWeightSpecs(n.weightsManifest),o=Be.io.getModelArtifactsForJSONSync(n,i,a);e=Be.io.fromMemorySync(o)}else if("load"in r)e=r;else if("modelTopology"in r&&"weightSpecs"in r&&"weightData"in r)e=Be.io.fromMemorySync(r);else throw new Error("Unknown model format");var s=new vx(e);return s.load(),s}function DOe(r){return r.endsWith("/")||(r=r+"/"),"".concat(r).concat(IOe).concat(EOe)}var _Oe="4.19.0";fu.GraphModel=vx;fu.deregisterOp=i2e;fu.loadGraphModel=COe;fu.loadGraphModelSync=AOe;fu.registerOp=a2e;fu.version_converter=_Oe});var mx=X(()=>{});var Cz=X(()=>{});var r$=X(ua=>{"use strict";var xr=Ls();function FOe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var vr=FOe(xr),yx=function(r,e){return yx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},yx(r,e)};function Rt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");yx(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Le(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function ze(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function hu(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ROe(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function OOe(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var pu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function POe(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var Fz={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(pu,r,!1)})(Fz);var MOe=Fz.exports,Rz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(pu,r,!1)})(Rz);var BOe=Rz.exports,Oz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(pu,r,!1)})(Oz);var LOe=Oz.exports,Pz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(pu,r,!1)})(Pz);var zOe=Pz.exports,Mz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(pu,r,!1)})(Mz);var $Oe=Mz.exports,Bz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(pu,r,!1)})(Bz);var WOe=Bz.exports,Lz={exports:{}},qOe={},UOe={__proto__:null,default:qOe},VOe=POe(UOe);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=VOe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:pu,[],Math)})(Lz);var GOe=Lz.exports,HOe=MOe,KOe=BOe,jOe=LOe,XOe=zOe,YOe=$Oe,ZOe=WOe,du=GOe;du.alea=HOe;du.xor128=KOe;du.xorwow=jOe;du.xorshift7=XOe;du.xor4096=YOe;du.tychei=ZOe;var zz=du;function JOe(r,e){return rm(r,e)}function rm(r,e,t,n){if(t===void 0&&(t=new Map),n===void 0&&(n=new Set),r==null)return null;if(typeof Blob=="function"&&r instanceof Blob)return r.slice();if(n.has(r))throw new Error("Circular references are not supported.");if(t.has(r))return t.get(r);var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(Bc(r)){var i=Array.isArray(r)?[]:{};n.add(r);for(var o in r){var s=r[o],u=rm(s,e,t,n);i[o]=u}return n.delete(r),r.__proto__&&(i.__proto__=r.__proto__),i}else throw new Error("Can't recurse into non-iterable type: ".concat(r));else return t.set(r,a.value),a.value}function QOe(r,e){return e===void 0&&(e=Wz),$z(r,e)}function $z(r,e,t){t===void 0&&(t=new Set);var n=r[0];if(t.has(n))throw new Error("Circular references are not supported.");var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(Bc(n)){var i=Array.isArray(n)?[]:{};t.add(n);var o=function(u){var c=r.map(function(f){return f[u]}),l=$z(c,e,t);i[u]=l};for(var s in n)o(s);return t.delete(n),i}else throw new Error("Can't recurse into non-iterable type: ".concat(n));else return a.value}function Wz(r){return r===null?null:Bc(r[0])?{value:null,recurse:!0}:{value:r,recurse:!1}}function qz(r,e){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return ze(this,function(h){switch(h.label){case 0:t=new Map,rm(r,e,t),h.label=1;case 1:h.trys.push([1,6,7,8]),n=hu(Array.from(t.keys())),a=n.next(),h.label=2;case 2:return a.done?[3,5]:(i=a.value,o=t.get(i),vr.util.isPromise(o)?[4,o]:[3,4]);case 3:s=h.sent(),t.set(i,s),h.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),l={error:u},[3,8];case 7:try{a&&!a.done&&(f=n.return)&&f.call(n)}finally{if(l)throw l.error}return[7];case 8:return c=rm(r,e,t),[2,c]}})})}function Bc(r){var e=!1;if(vr.env().get("IS_BROWSER"))e=r instanceof TextDecoder;else{var t=mx().StringDecoder;e=r instanceof t}return r!=null&&!ArrayBuffer.isView(r)&&(Array.isArray(r)||typeof r=="object"&&!(r instanceof vr.Tensor)&&!(r instanceof Promise)&&!e)}function ePe(r){return r==null||tPe(r)||Array.isArray(r)||typeof r=="object"&&r instanceof vr.Tensor||vr.util.isTypedArray(r)}function tPe(r){return r===null||typeof r!="object"&&typeof r!="function"}function rPe(r){return JOe(r,nPe)}function nPe(r){return r instanceof vr.Tensor?{value:r.clone(),recurse:!1}:Bc(r)?{value:null,recurse:!0}:{value:r,recurse:!1}}var Uz=function(){function r(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return r.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},r.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},r.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},r.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},r.prototype.isFull=function(){return this.length()===this.capacity},r.prototype.isEmpty=function(){return this.length()===0},r.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},r.prototype.pushAll=function(e){var t,n;try{for(var a=hu(e),i=a.next();!i.done;i=a.next()){var o=i.value;this.push(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},r.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},r.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},r.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},r}(),Vz=function(r){Rt(e,r);function e(){return r.call(this,e.INITIAL_CAPACITY)||this}return e.prototype.isFull=function(){return!1},e.prototype.push=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.push.call(this,t)},e.prototype.unshift=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=this.capacity*2,n=new Array(t),a=this.length(),i=0;i<a;i++)n[i]=this.get(this.wrap(this.begin+i));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=a},e}(Uz);Vz.INITIAL_CAPACITY=32;function Gz(r){return new oPe(r)}function bx(r){return new sPe(r)}function aPe(r,e){return new Hz(r,e)}function iPe(r,e){return e===void 0&&(e=ss.FAIL),new mPe(r,e)}var en=function(){function r(){}return r.prototype.toArray=function(){return Le(this,void 0,void 0,function(){var e,t;return ze(this,function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}})})},r.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){var e,t,n;return ze(this,function(a){switch(a.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=a.sent(),a.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=a.sent(),[3,2];case 4:return[2,t]}})})},r.prototype.resolveFully=function(){return Le(this,void 0,void 0,function(){var e;return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},r.prototype.resolveWhile=function(e){return Le(this,void 0,void 0,function(){var t,n;return ze(this,function(a){switch(a.label){case 0:return[4,this.next()];case 1:t=a.sent(),n=e(t.value),a.label=2;case 2:return!t.done&&n?[4,this.next()]:[3,4];case 3:return t=a.sent(),n=e(t.value),[3,2];case 4:return[2]}})})},r.prototype.handleErrors=function(e){return new dPe(this,e)},r.prototype.filter=function(e){return new hPe(this,e)},r.prototype.map=function(e){return new pPe(this,e)},r.prototype.mapAsync=function(e){return new Az(this,e)},r.prototype.serialMapAsync=function(e){return new Az(this,e).serial()},r.prototype.flatmap=function(e){return new vPe(this,e)},r.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.map(e).resolveFully()]})})},r.prototype.serialForEach=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(n){return n===!0})]})})},r.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new fPe(this,e,t)},r.prototype.columnMajorBatch=function(e,t,n){t===void 0&&(t=!0),n===void 0&&(n=Wz);var a=this.rowMajorBatch(e,t);return a.map(function(i){return QOe(i,n)})},r.prototype.concatenate=function(e,t){return new Hz(Gz([this,e]),t)},r.prototype.take=function(e){return e<0||e==null?this:new lPe(this,e)},r.prototype.skip=function(e){return e<0||e==null?this:new cPe(this,e)},r.prototype.prefetch=function(e){return new Kz(this,e)},r.prototype.shuffle=function(e,t){return new gPe(this,e,t)},r.prototype.serial=function(){return new uPe(this)},r}(),oPe=function(r){Rt(e,r);function e(t){var n=r.call(this)||this;return n.items=t,n.trav=0,n}return e.prototype.summary=function(){return"Array of ".concat(this.items.length," items")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:rPe(t),done:!1}])})})},e}(en),sPe=function(r){Rt(e,r);function e(t){var n=r.call(this)||this;return n.nextFn=t,n}return e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){try{return[2,this.nextFn()]}catch(n){throw n.message="Error thrown while iterating through a dataset: ".concat(n.message),n}return[2]})})},e}(en),uPe=function(r){Rt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Serial")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.upstream.next()]})})},e}(en),cPe=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Skip")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){switch(n.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return t=n.sent(),t.done?[2,t]:(vr.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(en),lPe=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Take")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(en),fPe=function(r){Rt(e,r);function e(t,n,a){a===void 0&&(a=!0);var i=r.call(this)||this;return i.upstream=t,i.batchSize=n,i.enableSmallLastBatch=a,i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,n;return ze(this,function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return n=a.sent(),n.done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(n.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(en),hPe=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.predicate=n,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Filter")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:return t=n.sent(),t.done||this.predicate(t.value)?[2,t]:(vr.dispose(t.value),[3,0]);case 2:return[2]}})})},e}(en),pPe=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Map")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,{value:null,done:!0}];n=vr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=vr.tensor_util.getTensorsInContainer(a);try{for(o=hu(n),s=o.next();!s.done;s=o.next())u=s.value,vr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(en),dPe=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.handler=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> handleErrors")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,n.sent()];case 3:return t=n.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(en),Az=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> AsyncMap")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:return t=f.sent(),t.done?[2,{value:null,done:!0}]:(n=vr.tensor_util.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:a=f.sent(),i=vr.tensor_util.getTensorsInContainer(a);try{for(o=hu(n),s=o.next();!s.done;s=o.next())u=s.value,vr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(en),wx=function(r){Rt(e,r);function e(){var t=r.call(this)||this;return t.outputQueue=new Vz,t.lastRead=Promise.resolve({value:null,done:!1}),t}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(en),vPe=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Flatmap")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,!1];n=vr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=vr.tensor_util.getTensorsInContainer(a),this.outputQueue.pushAll(a);try{for(o=hu(n),s=o.next();!s.done;s=o.next())u=s.value,vr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,!0]}})})},e}(wx),Hz=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.baseErrorHandler=n,a.lastRead=null,a.iterator=null,a.moreIterators=t,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of chained summaries";return"".concat(t," -> Chained")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return Le(this,void 0,void 0,function(){var n,a;return ze(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if(n=i.sent(),n.done)return[2,{value:null,done:!0}];this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),i.label=3;case 3:return[4,this.iterator.next()];case 4:return a=i.sent(),a.done?(this.iterator=null,[2,this.readFromChain(t)]):[2,a]}})})},e}(en),ss;(function(r){r[r.FAIL=0]="FAIL",r[r.SHORTEST=1]="SHORTEST",r[r.LONGEST=2]="LONGEST"})(ss||(ss={}));var mPe=function(r){Rt(e,r);function e(t,n){n===void 0&&(n=ss.FAIL);var a=r.call(this)||this;return a.iterators=t,a.mismatchMode=n,a.count=0,a.currentPromise=null,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of zip summaries";return"{".concat(t,"} -> Zip")},e.prototype.nextState=function(t){return Le(this,void 0,void 0,function(){function n(s){if(s instanceof en){var u=s.next();return{value:u.then(function(c){return a++,c.done&&i++,c.value}),recurse:!1}}else return{value:null,recurse:!0}}var a,i,o;return ze(this,function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),a=0,i=0,[4,qz(this.iterators,n)];case 2:if(o=s.sent(),a===i)return[2,{value:null,done:!0}];if(i>0)switch(this.mismatchMode){case ss.FAIL:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case ss.SHORTEST:return[2,{value:null,done:!0}];case ss.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e}(en),Kz=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.bufferSize=n,a.buffer=new Uz(n),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Prefetch")},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(en),gPe=function(r){Rt(e,r);function e(t,n,a){var i=r.call(this,t,n)||this;return i.upstream=t,i.windowSize=n,i.upstreamExhausted=!1,i.random=zz.alea(a||vr.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,n;return ze(this,function(a){switch(a.label){case 0:this.upstreamExhausted||this.refill(),a.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:if(n=a.sent(),n.done)this.upstreamExhausted=!0;else return this.refill(),[2,n];return[3,1];case 3:return[2,{value:null,done:!0}]}})})},e}(Kz),Lc=function(){function r(){this.size=null}return r.prototype.batch=function(e,t){var n=this;t===void 0&&(t=!0);var a=this;vr.util.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `.concat(e)});var i;return this.size===1/0||this.size==null?i=this.size:t?i=Math.ceil(this.size/e):i=Math.floor(this.size/e),sa(function(){return Le(n,void 0,void 0,function(){return ze(this,function(o){switch(o.label){case 0:return[4,a.iterator()];case 1:return[2,o.sent().columnMajorBatch(e,t,wPe)]}})})},i)},r.prototype.concatenate=function(e){var t=this,n=this,a;return this.size===1/0||e.size===1/0?a=1/0:this.size!=null&&e.size!=null?a=this.size+e.size:a=null,sa(function(){return Le(t,void 0,void 0,function(){var i,o;return ze(this,function(s){switch(s.label){case 0:return[4,n.iterator()];case 1:return o=(i=s.sent()).concatenate,[4,e.iterator()];case 2:return[2,o.apply(i,[s.sent()])]}})})},a)},r.prototype.filter=function(e){var t=this,n=this,a;return this.size===1/0?a=1/0:a=null,sa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().filter(function(o){return vr.tidy(function(){return e(o)})})]}})})},a)},r.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},r.prototype.map=function(e){var t=this,n=this;return sa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().map(function(i){return vr.tidy(function(){return e(i)})})]}})})},this.size)},r.prototype.mapAsync=function(e){var t=this,n=this;return sa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().mapAsync(e)]}})})},this.size)},r.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return sa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().prefetch(e)]}})})},this.size)},r.prototype.repeat=function(e){var t=this,n=this,a;return this.size!=null&&e>0?a=this.size*e:e===0?a=0:this.size!=null&&(e===void 0||e<0)?a=1/0:a=null,sa(function(){return Le(t,void 0,void 0,function(){var i,o=this;return ze(this,function(s){return i=bx(function(){return Le(o,void 0,void 0,function(){var u;return ze(this,function(c){switch(c.label){case 0:return u={},[4,n.iterator()];case 1:return[2,(u.value=c.sent(),u.done=!1,u)]}})})}),[2,aPe(i.take(e))]})})},a)},r.prototype.skip=function(e){var t=this,n=this,a;return this.size!=null&&e>=0&&this.size>=e?a=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?a=0:a=null,sa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().skip(e)]}})})},a)},r.prototype.shuffle=function(e,t,n){var a=this;if(n===void 0&&(n=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var i=this,o=zz.alea(t||vr.util.now().toString());return sa(function(){return Le(a,void 0,void 0,function(){var s;return ze(this,function(u){switch(u.label){case 0:return s=o.int32(),n&&(s+=o.int32()),[4,i.iterator()];case 1:return[2,u.sent().shuffle(e,s.toString())]}})})},this.size)},r.prototype.take=function(e){var t=this,n=this,a;return this.size!=null&&this.size>e?a=e:this.size!=null&&this.size<=e?a=this.size:a=null,sa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().take(e)]}})})},a)},r.prototype.toArray=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},r.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},r}();Lc.MAX_BUFFER_SIZE=1e4;function sa(r,e){return e===void 0&&(e=null),new(function(t){Rt(n,t);function n(){var a=t.apply(this,OOe([],ROe(arguments),!1))||this;return a.size=e,a}return n.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(a){return[2,r()]})})},n}(Lc))}function yPe(r){var e=this;return sa(function(){return Le(e,void 0,void 0,function(){return ze(this,function(t){return[2,Gz(r)]})})},r.length)}function bPe(r){var e=this;if(!Bc(r))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(r))for(var n=0;n<r.length;n++)t=t==null?r[n].size:Math.min(t,r[n].size);else if(r instanceof Object)for(var a in r)t=t==null?r[a].size:Math.min(t,r[a].size);return sa(function(){return Le(e,void 0,void 0,function(){var i;return ze(this,function(o){switch(o.label){case 0:return[4,qz(r,function(s){if(s instanceof Lc)return{value:s.iterator(),recurse:!1};if(Bc(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return i=o.sent(),[2,iPe(i,ss.SHORTEST)]}})})},t)}function wPe(r){if(r===null)return null;var e=r[0];if(ePe(e)){var t=xPe(r);return{value:t,recurse:!1}}return{value:null,recurse:!0}}function xPe(r){if(r.length===0)throw new Error("Can't make a batch of zero elements.");return r[0]instanceof vr.Tensor?vr.stack(r):vr.tensor(r)}var jz=function(r){Rt(e,r);function e(t){var n=r.call(this)||this;return n.input=t,n}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,n,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),n=t.decodeUTF8(),a=n.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o}),[2,a]}})})},e}(Lc),em='"',fh=Symbol("out"),Dz=Symbol("field"),tm=Symbol("quote"),gx=Symbol("quoteafterquote"),_z=Symbol("quoteinquote"),Xz=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.input=t,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new jz(t),n||(n={}),a.hasHeader=n.hasHeader!==!1,a.fullColumnNames=n.columnNames,a.columnConfigs=n.columnConfigs,a.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(xr.util.assert(n.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=n.delimiter?n.delimiter:",",a}return e.prototype.columnNames=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f=this;return ze(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&xr.util.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+f.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce(function(p,d){return p[d]=p[d]+1||1,p},{}),a=Object.keys(n).filter(function(p){return n[p]>1}),xr.util.assert(a.length===0,function(){return"Duplicate column names found: "+a.toString()}),this.columnConfigs)try{for(i=hu(Object.keys(this.columnConfigs)),o=i.next();!o.done;o=i.next())if(s=o.value,u=this.fullColumnNames.indexOf(s),u===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}catch(p){c={error:p}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return Le(this,void 0,void 0,function(){var t,n,a,i;return ze(this,function(o){switch(o.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return t=o.sent(),[4,t.next()];case 2:if(n=o.sent(),n.done)throw new Error("No data was found for CSV parsing.");return a=n.value,i=this.parseRow(a,!1),[2,i];case 3:return[2,null]}})})},e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,n=this;return ze(this,function(a){switch(a.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:a.sent(),a.label=2;case 2:return[4,this.base.iterator()];case 3:return t=a.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(i){return n.makeDataElement(i)})]}})})},e.prototype.makeDataElement=function(t){for(var n=this.parseRow(t),a={},i={},o=0;o<this.fullColumnNames.length;o++){var s=this.fullColumnNames[o],u=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!u)){var c=n[o],l=null;if(c==="")if(u&&u.default!==void 0)l=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column ".concat(s," is empty in this line: ").concat(t));l=void 0}else{var f=Number(c);if(isNaN(f))u&&u.dtype==="bool"?l=this.getBoolean(c):l=c;else if(!u||!u.dtype)l=f;else switch(u.dtype){case"float32":l=f;break;case"int32":l=Math.floor(f);break;case"bool":l=this.getBoolean(c);break;default:l=f}}u&&u.isLabel?i[s]=l:a[s]=l}}return Object.keys(i).length===0?a:{xs:a,ys:i}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,n){n===void 0&&(n=!0);for(var a=[],i=0,o=t.length,s=fh,u=0;u<o;u++)switch(s){case fh:switch(t.charAt(u)){case em:i=u+1,s=tm;break;case this.delimiter:if(i=u+1,this.delimiter===" "&&this.delimWhitespace)break;a.push(""),s=fh;break;default:s=Dz,i=u;break}break;case Dz:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u)),s=fh,i=u+1;break}break;case tm:switch(t.charAt(u)){case em:s=gx;break}break;case gx:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u-1)),s=fh,i=u+1;break;case em:s=tm;break;default:s=_z;break}break;case _z:switch(t.charAt(u)){case em:s=tm;break}break}if(s===gx?a.push(t.substring(i,o-1)):a.push(t.substring(i)),n&&a.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(a));return a},e}(Lc),kPe=function(r){Rt(e,r);function e(t){var n=r.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var a=Math.log2(n.fftSize);if(n.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+"2 to 4 and 2 to 14, but got ".concat(n.fftSize));if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=t.includeSpectrogram!==!1,n.includeWaveform=t.includeWaveform===!0,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),Le(this,void 0,void 0,function(){var n;return ze(this,function(a){switch(a.label){case 0:if(!xr.env().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");return n=new e(t),[4,n.start()];case 1:return a.sent(),[2,n]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,n,a,i;return ze(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw n=o.sent(),new Error("Error thrown while initializing video stream: ".concat(n.message));case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: "+"Expected: ".concat(this.sampleRateHz,"; ")+"Actual: ".concat(this.audioContext.sampleRate));return i=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,i.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o;return ze(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return a=s.sent(),this.includeSpectrogram&&(i=this.flattenQueue(a.freqDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(a.timeDataQueue),n=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:n},done:!1}]}})})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return Le(this,void 0,void 0,function(){var t,n,a,i=this;return ze(this,function(o){return t=[],n=[],a=0,[2,new Promise(function(s){var u=setInterval(function(){i.includeSpectrogram&&(i.analyser.getFloatFrequencyData(i.freqData),i.freqData[0]===-1/0&&s({freqDataQueue:t,timeDataQueue:n}),t.push(i.freqData.slice(0,i.columnTruncateLength))),i.includeWaveform&&(i.analyser.getFloatTimeDomainData(i.timeData),n.push(i.timeData.slice())),++a===i.numFrames&&(clearInterval(u),s({freqDataQueue:t,timeDataQueue:n}))},i.fftSize/i.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var n=t[0].length,a=new Float32Array(t.length*n);return t.forEach(function(i,o){return a.set(i,o*n)}),a},e.prototype.getTensorFromAudioDataArray=function(t,n){var a=new Float32Array(xr.util.sizeFromShape(n));return a.set(t,a.length-t.length),xr.tensor(a,n)},e}(en),SPe=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;if(a.webcamVideoElement=t,a.webcamConfig=n,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=xr.tensor1d([0],"int32"),a.webcamConfig.centerCrop){var i=a.webcamConfig.resizeWidth*1/a.webcamVideoElement.width,o=a.webcamConfig.resizeHeight*1/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=xr.tensor2d([u,s,l,c],[1,4])}else a.cropBox=xr.tensor2d([0,0,1,1],[1,4]);return a}return e.prototype.summary=function(){return"webcam"},e.create=function(t,n){return n===void 0&&(n={}),Le(this,void 0,void 0,function(){var a;return ze(this,function(i){switch(i.label){case 0:if(!xr.env().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}return a=new e(t,n),[4,a.start()];case 1:return i.sent(),[2,a]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,n,a=this;return ze(this,function(i){switch(i.label){case 0:this.webcamConfig.facingMode&&xr.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: ".concat(a.webcamConfig.facingMode,". ")+"Please provide 'user' or 'environment'"}),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=i.sent(),[3,4];case 3:throw n=i.sent(),n.message="Error thrown while initializing video stream: ".concat(n.message),n;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){a.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){if(this.isClosed)return[2,{value:null,done:!0}];try{t=xr.browser.fromPixels(this.webcamVideoElement)}catch(a){throw new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(a)))}if(this.resize)try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(a){throw new Error("Error thrown cropping the video: ".concat(a.message))}finally{t.dispose()}else return[2,{value:t,done:!1}];return[2]})})},e.prototype.needToResize=function(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))},e.prototype.cropAndResizeFrame=function(t){var n=this;return xr.tidy(function(){var a=xr.expandDims(xr.cast(t,"float32"),0),i;i=xr.image.cropAndResize(a,n.cropBox,n.cropBoxInd,n.cropSize,"bilinear");var o=i.shape;return xr.reshape(i,o.slice(1))})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){var t=this.stream.getTracks();t.forEach(function(n){return n.stop()});try{this.webcamVideoElement.srcObject=null}catch(n){console.log(n),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e}(en);var Yz=function(){function r(){}return r}(),Zz=function(r){Rt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.split=function(t){return new NPe(this,t)},e}(en),NPe=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.impl=new TPe(t,n),a}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(Zz),TPe=function(r){Rt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.separator=n,a.carryover="",a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return ze(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:if(t=c.sent(),t.done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);n=t.value.split(this.separator),n[0]=this.carryover+n[0];try{for(a=hu(n.slice(0,-1)),i=a.next();!i.done;i=a.next())o=i.value,this.outputQueue.push(o)}catch(l){s={error:l}}finally{try{i&&!i.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}return this.carryover=n[n.length-1],[2,!0]}})})},e}(wx),EPe=function(r){Rt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.decodeUTF8=function(){return new IPe(this)},e}(en),IPe=function(r){Rt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.impl=new CPe(t),n}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(Zz),CPe=function(r){Rt(e,r);function e(t){var n=r.call(this)||this;if(n.upstream=t,xr.env().get("IS_BROWSER"))n.decoder=new TextDecoder("utf-8");else{var a=mx().StringDecoder;n.decoder=new a("utf8")}return n}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Utf8")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:return t=i.sent(),t.done?[2,!1]:(n=t.value,xr.env().get("IS_BROWSER")?a=this.decoder.decode(n,{stream:!0}):a=this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(a),[2,!0])}})})},e}(wx),Jz=function(r){Rt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.file=t,a.options=n,xr.util.assert(t instanceof Uint8Array||(xr.env().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),a.offset=n.offset||0,a.chunkSize=n.chunkSize||1024*1024,a}return e.prototype.summary=function(){return"FileChunks ".concat(this.file)},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a=this;return ze(this,function(i){switch(i.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,s){var u=a.offset+a.chunkSize;if(a.file instanceof Uint8Array)o(new Uint8Array(a.file.slice(a.offset,u)));else{var c=new FileReader;c.onload=function(f){var h=c.result;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),!(h instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));o(h)},c.onabort=function(f){return s(new Error("Aborted"))},c.onerror=function(f){return s(new Error(f.type))};var l=a.file.slice(a.offset,u);c.readAsArrayBuffer(l)}a.offset=u}),n={},[4,t]);case 1:return[2,(n.value=i.sent(),n.done=!1,n)]}})})},e}(EPe);function APe(r,e,t){return e===void 0&&(e={}),Le(this,void 0,void 0,function(){var n,a,i,o,s;return ze(this,function(u){switch(u.label){case 0:return typeof r=="string"?n=r:(n=r.url,a=DPe(r)),[4,(t||xr.util.fetch)(n,a)];case 1:return i=u.sent(),i.ok?(s=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new Jz(o,e)];case 3:throw new Error(i.statusText)}})})}var DPe=function(r){var e={method:r.method,headers:r.headers,body:r.body,mode:r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,referrer:r.referrer,integrity:r.integrity};return e};function Qz(r){return typeof r=="string"&&r.slice(0,7)==="file://"}var e$=function(r){Rt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.input=t,a.options=n,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){return Qz(this.input)&&xr.env().get("IS_NODE")&&(t=Cz(),this.input=t.readFileSync(this.input.slice(7))),[2,new Jz(this.input,this.options)]})})},e}(Yz),t$=function(r){Rt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.url=t,a.fileOptions=n,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return Qz(this.url)?[2,new e$(this.url,this.fileOptions).iterator()]:[2,APe(this.url,this.fileOptions)]})})},e}(Yz);function _Pe(r,e){return e===void 0&&(e={}),new Xz(new t$(r),e)}function FPe(r){var e=this,t=bx(r);return sa(function(){return Le(e,void 0,void 0,function(){return ze(this,function(n){return[2,t]})})})}function RPe(r){var e=this;return sa(function(){return Le(e,void 0,void 0,function(){var t;return ze(this,function(n){switch(n.label){case 0:return[4,r()];case 1:return t=n.sent(),[2,bx(function(){return t.next()})]}})})})}function OPe(r,e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,SPe.create(r,e)]})})}function PPe(r){return Le(this,void 0,void 0,function(){return ze(this,function(e){return[2,kPe.create(r)]})})}var MPe="4.19.0";ua.CSVDataset=Xz;ua.Dataset=Lc;ua.FileDataSource=e$;ua.TextLineDataset=jz;ua.URLDataSource=t$;ua.array=yPe;ua.csv=_Pe;ua.func=FPe;ua.generator=RPe;ua.microphone=PPe;ua.version_data=MPe;ua.webcam=OPe;ua.zip=bPe});var a$=X((n$,xx)=>{(function(r,e,t){function n(s){var u=this,c=o();u.next=function(){var l=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=l-(u.c=l|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(s),u.s0<0&&(u.s0+=1),u.s1-=c(s),u.s1<0&&(u.s1+=1),u.s2-=c(s),u.s2<0&&(u.s2+=1),c=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var c=new n(s),l=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,l&&(typeof l=="object"&&a(l,c),f.state=function(){return a(c,{})}),f}function o(){var s=4022871197,u=function(c){c=String(c);for(var l=0;l<c.length;l++){s+=c.charCodeAt(l);var f=.02519603282416938*s;s=f>>>0,f-=s,f*=s,s=f>>>0,f-=s,s+=f*4294967296}return(s>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.alea=i})(n$,typeof xx=="object"&&xx,typeof define=="function"&&define)});var o$=X((i$,kx)=>{(function(r,e,t){function n(o){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var l=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^l^l>>>8},o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor128=i})(i$,typeof kx=="object"&&kx,typeof define=="function"&&define)});var u$=X((s$,Sx)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var l=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(l^l<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,c==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s.v=o.v,s.d=o.d,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorwow=i})(s$,typeof Sx=="object"&&Sx,typeof define=="function"&&define)});var l$=X((c$,Nx)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var c=s.x,l=s.i,f,h,p;return f=c[l],f^=f>>>7,h=f^f<<24,f=c[l+1&7],h^=f^f>>>10,f=c[l+3&7],h^=f^f>>>3,f=c[l+4&7],h^=f^f<<7,f=c[l+7&7],f=f^f<<13,h^=f^f<<9,c[l]=h,s.i=l+1&7,h};function u(c,l){var f,h,p=[];if(l===(l|0))h=p[0]=l;else for(l=""+l,f=0;f<l.length;++f)p[f&7]=p[f&7]<<15^l.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?h=p[7]=-1:h=p[f],c.x=p,c.i=0,f=256;f>0;--f)c.next()}u(s,o)}function a(o,s){return s.x=o.x.slice(),s.i=o.i,s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.x&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorshift7=i})(c$,typeof Nx=="object"&&Nx,typeof define=="function"&&define)});var h$=X((f$,Tx)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var c=s.w,l=s.X,f=s.i,h,p;return s.w=c=c+1640531527|0,p=l[f+34&127],h=l[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=l[f]=p^h,s.i=f,p+(c^c>>>16)|0};function u(c,l){var f,h,p,d,m,v=[],g=128;for(l===(l|0)?(h=l,l=null):(l=l+"\0",h=0,g=Math.max(g,l.length)),p=0,d=-32;d<g;++d)l&&(h^=l.charCodeAt((d+32)%l.length)),d===0&&(m=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,d>=0&&(m=m+1640531527|0,f=v[d&127]^=h+m,p=f==0?p+1:0);for(p>=128&&(v[(l&&l.length||0)&127]=-1),p=127,d=4*128;d>0;--d)h=v[p+34&127],f=v[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,v[p]=h^f;c.w=m,c.X=v,c.i=p}u(s,o)}function a(o,s){return s.i=o.i,s.w=o.w,s.X=o.X.slice(),s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.X&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor4096=i})(f$,typeof Tx=="object"&&Tx,typeof define=="function"&&define)});var d$=X((p$,Ex)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var l=s.b,f=s.c,h=s.d,p=s.a;return l=l<<25^l>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-l|0,s.b=l=l<<20^l>>>12^f,s.c=f=f-h|0,s.d=h<<16^f>>>16^p,s.a=p-l|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,o===Math.floor(o)?(s.a=o/4294967296|0,s.b=o|0):u+=o;for(var c=0;c<u.length+20;c++)s.b^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.a=o.a,s.b=o.b,s.c=o.c,s.d=o.d,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.tychei=i})(p$,typeof Ex=="object"&&Ex,typeof define=="function"&&define)});var m$=X((v$,nm)=>{(function(r,e,t){var n=256,a=6,i=52,o="random",s=t.pow(n,a),u=t.pow(2,i),c=u*2,l=n-1,f;function h(w,b,x){var S=[];b=b==!0?{entropy:!0}:b||{};var T=v(m(b.entropy?[w,y(e)]:w??g(),3),S),E=new p(S),C=function(){for(var R=E.g(a),_=s,P=0;R<u;)R=(R+P)*n,_*=n,P=E.g(1);for(;R>=c;)R/=2,_/=2,P>>>=1;return(R+P)/_};return C.int32=function(){return E.g(4)|0},C.quick=function(){return E.g(4)/4294967296},C.double=C,v(y(E.S),e),(b.pass||x||function(R,_,P,$){return $&&($.S&&d($,E),R.state=function(){return d(E,{})}),P?(t[o]=R,_):R})(C,T,"global"in b?b.global:this==t,b.state)}function p(w){var b,x=w.length,S=this,T=0,E=S.i=S.j=0,C=S.S=[];for(x||(w=[x++]);T<n;)C[T]=T++;for(T=0;T<n;T++)C[T]=C[E=l&E+w[T%x]+(b=C[T])],C[E]=b;(S.g=function(R){for(var _,P=0,$=S.i,z=S.j,L=S.S;R--;)_=L[$=l&$+1],P=P*n+L[l&(L[$]=L[z=l&z+_])+(L[z]=_)];return S.i=$,S.j=z,P})(n)}function d(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function m(w,b){var x=[],S=typeof w,T;if(b&&S=="object")for(T in w)try{x.push(m(w[T],b-1))}catch{}return x.length?x:S=="string"?w:w+"\0"}function v(w,b){for(var x=w+"",S,T=0;T<x.length;)b[l&T]=l&(S^=b[l&T]*19)+x.charCodeAt(T++);return y(b)}function g(){try{var w;return f&&(w=f.randomBytes)?w=w(n):(w=new Uint8Array(n),(r.crypto||r.msCrypto).getRandomValues(w)),y(w)}catch{var b=r.navigator,x=b&&b.plugins;return[+new Date,r,x,r.screen,y(e)]}}function y(w){return String.fromCharCode.apply(0,w)}if(v(t.random(),e),typeof nm=="object"&&nm.exports){nm.exports=h;try{f=Wp()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+o]=h})(typeof self<"u"?self:v$,[],Math)});var y$=X((Clt,g$)=>{var BPe=a$(),LPe=o$(),zPe=u$(),$Pe=l$(),WPe=h$(),qPe=d$(),vu=m$();vu.alea=BPe;vu.xor128=LPe;vu.xorwow=zPe;vu.xorshift7=$Pe;vu.xor4096=WPe;vu.tychei=qPe;g$.exports=vu});var zW=X(cm=>{"use strict";var N=Ls(),UPe=y$();function VPe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var GPe=VPe(UPe),Cx=function(r,e){return Cx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Cx(r,e)};function HPe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Cx(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function b$(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function w$(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function $c(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ve(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function xa(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}function He(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&N.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors in the CPU backend.")})})}var KPe=N.kernel_impls.whereImpl,_x=function(r){HPe(e,r);function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new N.DataStorage(t,N.engine()),t}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.write=function(t,n,a){this.firstUse&&(this.firstUse=!1,N.env().get("IS_NODE")&&N.backend_util.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));var i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:a,refCount:1}),i},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&N.util.isString(a[0])){var o=a.map(function(s){return N.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return{dataId:i,shape:t,dtype:n}},e.prototype.refCount=function(t){if(this.data.has(t)){var n=this.data.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.data.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.data.has(t)){var n=this.data.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){this.data.set(t,{values:n,dtype:i,refCount:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return b$(this,void 0,void 0,function(){return w$(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),a=n.dtype,i=n.complexTensorInfos;if(a==="complex64"){var o=this.readSync(i.real.dataId),s=this.readSync(i.imag.dataId);return N.backend_util.mergeRealAndImagArrays(o,s)}return N.util.convertBackendValuesAndArrayBuffer(this.data.get(t).values,a)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return N.util.decodeString(i)});return N.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return N.buffer(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,n,a){return N.engine().makeTensorFromTensorInfo(this.makeTensorInfo(n,a,t),this)},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;var a=this.data.get(t).complexTensorInfos;a!=null&&(this.disposeData(a.real.dataId,!0),this.disposeData(a.imag.dataId,!0)),this.data.delete(t)}return!0},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.time=function(t){return b$(this,void 0,void 0,function(){var n,a;return w$(this,function(i){return n=N.util.now(),t(),a=N.util.now()-n,[2,{kernelMs:a}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.where=function(t){He([t],"where");var n=this.readSync(t.dataId);return KPe(t.shape,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return r.prototype.epsilon.call(this)},e}(N.KernelBackend);_x.nextDataId=0;function A$(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}var jPe=function(r){var e=r.inputs.x,t=r.backend;He(e,"abs");var n=new Float32Array(N.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId).values;return n=A$(a),t.makeOutput(n,e.shape,e.dtype)},XPe={kernelName:N.Abs,backendName:"cpu",kernelFunc:jPe};function _r(r){return function(e,t,n,a,i){var o=N.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=N.util.computeStrides(o),c=N.util.sizeFromShape(o),l=N.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=N.util.computeStrides(e),d=N.util.computeStrides(t),m=N.backend_util.getBroadcastDims(e,o),v=N.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(w){var b=N.util.indexToLoc(w,s,u),x=b.slice(-f);m.forEach(function(C){return x[C]=0});var S=N.util.locToIndex(x,f,p),T=b.slice(-h);v.forEach(function(C){return T[C]=0});var E=N.util.locToIndex(T,h,d);l[w]=r(n[S],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function ca(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=t.makeTensorInfo(n.shape,"complex64"),u=t.data.get(s.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(n.shape,"float32",i),imag:t.makeTensorInfo(a.shape,"float32",o)},s}var YPe={kernelName:N.Complex,backendName:"cpu",kernelFunc:ca};function am(r,e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=am(r,e,"float32"),a=am(r,e,"float32");return ca({inputs:{real:n,imag:a},backend:r})}var i=N.util.makeZerosTypedArray(N.util.sizeFromShape(e),t);return r.makeTensorInfo(e,t,i)}function Li(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var ZPe={kernelName:N.Identity,backendName:"cpu",kernelFunc:Li};function gu(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.real,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var JPe={kernelName:N.Real,backendName:"cpu",kernelFunc:gu};function D$(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=N.util.toTypedArray([0],t),o=Ve(_r(function(c,l){return c!==l?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(n))}function us(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return Li({inputs:{x:a},backend:t});var o=am(t,a.shape,a.dtype),s=us({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=ca({inputs:{real:s,imag:o},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=gu({inputs:{input:a},backend:t}),u=us({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!N.util.hasEncodingLoss(a.dtype,i)){var u=Li({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}var l=t.data.get(a.dataId).values,f=Ve(D$(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}var QPe={kernelName:N.Cast,backendName:"cpu",kernelFunc:us};function Gr(r,e,t,n){return t==null?function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;He([s,u],r);var l=c.data.get(s.dataId).values,f=c.data.get(u.dataId).values,h=s.dtype==="string"?N.backend_util.fromUint8ToStringArray(l):l,p=s.dtype==="string"?N.backend_util.fromUint8ToStringArray(f):f,d=n||s.dtype,m=Ve(e(s.shape,u.shape,h,p,d),2),v=m[0],g=m[1];return c.makeTensorInfo(g,d,v)}:function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;if(s.dtype==="complex64"||u.dtype==="complex64"){var l=us({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),f=c.data.get(l.dataId),h=f.complexTensorInfos.real,p=f.complexTensorInfos.imag,d=c.data.get(h.dataId).values,m=c.data.get(p.dataId).values,v=us({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(v.dataId),y=g.complexTensorInfos.real,w=g.complexTensorInfos.imag,b=c.data.get(y.dataId).values,x=c.data.get(w.dataId).values,S=Ve(t(s.shape,u.shape,d,m,b,x),3),T=S[0],E=S[1],C=S[2],R=c.makeTensorInfo(C,"float32",T),_=c.makeTensorInfo(C,"float32",E),P=ca({inputs:{real:R,imag:_},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(R),c.disposeIntermediateTensorInfo(_),P}else{var $=c.data.get(s.dataId).values,z=c.data.get(u.dataId).values,L=n||s.dtype,B=Ve(e(s.shape,u.shape,$,z,L),2),q=B[0],C=B[1];return c.makeTensorInfo(C,L,q)}}}function Fx(r){return function(e,t,n,a,i,o){var s=N.backend_util.assertAndGetBroadcastShape(e,t),u=N.util.sizeFromShape(s),c=s.length,l=N.util.computeStrides(s),f=N.util.getTypedArrayFromDType("float32",u),h=N.util.getTypedArrayFromDType("float32",u),p=N.backend_util.getBroadcastDims(e,s),d=N.backend_util.getBroadcastDims(t,s),m=N.backend_util.mergeRealAndImagArrays(n,a),v=N.backend_util.mergeRealAndImagArrays(i,o),g=e.length,y=N.util.computeStrides(e),w=t.length,b=N.util.computeStrides(t);if(p.length+d.length===0)for(var x=0;x<f.length;x++){var S=x%m.length,T=x%v.length,E=r(m[S*2],m[S*2+1],v[T*2],v[T*2+1]);f[x]=E.real,h[x]=E.imag}else for(var C=function(R){var _=N.util.indexToLoc(R,c,l),P=_.slice(-g);p.forEach(function(q){return P[q]=0});var $=N.util.locToIndex(P,g,y),z=_.slice(-w);d.forEach(function(q){return z[q]=0});var L=N.util.locToIndex(z,w,b),B=r(m[$*2],m[$*2+1],v[L*2],v[L*2+1]);f[R]=B.real,h[R]=B.imag},x=0;x<f.length;x++)C(x);return[f,h,s]}}var _$=_r(function(r,e){return r+e}),eMe=Fx(function(r,e,t,n){return{real:r+t,imag:e+n}}),Wc=Gr(N.Add,_$,eMe),tMe={kernelName:N.Add,backendName:"cpu",kernelFunc:Wc};function Rx(r,e,t,n,a){for(var i=N.util.sizeFromShape(n),o=N.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function F$(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=N.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=r.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(n?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var R$=_r(function(r,e){return r&e}),rMe=Gr(N.BitwiseAnd,R$),nMe={kernelName:N.BitwiseAnd,backendName:"cpu",kernelFunc:rMe};function zi(r){return function(e,t,n){for(var a=N.util.getArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}function Bt(r,e,t){var n=zi(e);return cs(r,n,t)}function cs(r,e,t){return function(n){var a=n.inputs,i=n.attrs,o=n.backend,s=a.x;He(s,r);var u=o,c=u.data.get(s.dataId).values,l;if(s.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=N.backend_util.fromUint8ToStringArray(c)}else l=c;var f=t||s.dtype,h=e(l,f,i);return u.makeTensorInfo(s.shape,f,h)}}var O$=zi(function(r){return Math.ceil(r)}),aMe=cs(N.Ceil,O$),iMe={kernelName:N.Ceil,backendName:"cpu",kernelFunc:aMe};function P$(r,e,t,n){var a=N.util.getArrayFromDType(t,N.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=N.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?N.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var M$=_r(function(r,e){return r===e?1:0}),B$=Gr(N.Equal,M$,null,"bool"),oMe={kernelName:N.Equal,backendName:"cpu",kernelFunc:B$};var L$=zi(function(r){return Math.exp(r)}),z$=cs(N.Exp,L$,"float32"),sMe={kernelName:N.Exp,backendName:"cpu",kernelFunc:z$};var $$=zi(function(r){return Math.expm1(r)}),uMe=cs(N.Expm1,$$),cMe={kernelName:N.Expm1,backendName:"cpu",kernelFunc:uMe};var W$=zi(function(r){return Math.floor(r)}),lMe=cs(N.Floor,W$),fMe={kernelName:N.Floor,backendName:"cpu",kernelFunc:lMe};var q$=_r(function(r,e){return Math.floor(r/e)}),hMe=Gr(N.FloorDiv,q$,null,"int32"),pMe={kernelName:N.FloorDiv,backendName:"cpu",kernelFunc:hMe};function U$(r,e,t,n,a,i,o,s,u){for(var c=N.buffer([n,i],t),l=0;l<n;l++){for(var f=[],h=0,p=0;p<a;p++){var d=r[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=e.get.apply(e,xa([],Ve(e.indexToLoc(h*i+m)),!1))}return c}function V$(r,e,t){for(var n=N.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=r.locToIndex(o);0<=l&&l<r.values.length&&(n.values[a]=r.values[l])}return n}var G$=_r(function(r,e){return r>e?1:0}),dMe=Gr(N.Greater,G$,null,"bool"),vMe={kernelName:N.Greater,backendName:"cpu",kernelFunc:dMe};var H$=_r(function(r,e){return r>=e?1:0}),mMe=Gr(N.GreaterEqual,H$,null,"bool"),gMe={kernelName:N.GreaterEqual,backendName:"cpu",kernelFunc:mMe};var K$=_r(function(r,e){return r<e?1:0}),yMe=Gr(N.Less,K$,null,"bool"),bMe={kernelName:N.Less,backendName:"cpu",kernelFunc:yMe};var j$=_r(function(r,e){return r<=e?1:0}),wMe=Gr(N.LessEqual,j$,null,"bool"),xMe={kernelName:N.LessEqual,backendName:"cpu",kernelFunc:wMe};function X$(r,e,t){var n=(e-r)/(t-1),a=N.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var Y$=zi(function(r){return Math.log(r)}),kMe=cs(N.Log,Y$),SMe={kernelName:N.Log,backendName:"cpu",kernelFunc:kMe};function Z$(r,e,t,n){for(var a=N.util.getTypedArrayFromDType(n,N.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var c=r[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var J$=_r(function(r,e){return Math.max(r,e)}),NMe=Gr(N.Maximum,J$),TMe={kernelName:N.Maximum,backendName:"cpu",kernelFunc:NMe};var Q$=_r(function(r,e){return Math.min(r,e)}),EMe=Gr(N.Minimum,Q$),IMe={kernelName:N.Minimum,backendName:"cpu",kernelFunc:EMe};var Ox=_r(function(r,e){return r*e}),CMe=Fx(function(r,e,t,n){return{real:r*t-e*n,imag:r*n+e*t}}),um=Gr(N.Multiply,Ox,CMe),AMe={kernelName:N.Multiply,backendName:"cpu",kernelFunc:um};function eW(r,e,t){var n=N.util.createScalarValue(-1,t);return Ox([],e,n,r,t)}function DMe(r){var e=r.inputs,t=r.backend,n=e.x;He(n,"neg");var a=t.data.get(n.dataId).values,i=Ve(eW(a,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var _Me={kernelName:N.Neg,backendName:"cpu",kernelFunc:DMe};var tW=_r(function(r,e){return r!==e?1:0}),FMe=Gr(N.NotEqual,tW,null,"bool"),RMe={kernelName:N.NotEqual,backendName:"cpu",kernelFunc:FMe};function Px(r,e,t,n,a){for(var i=e.length,o=N.util.sizeFromShape(e),s=N.util.computeStrides(e),u=N.util.computeStrides(a),c=N.util.getTypedArrayFromDType(t,N.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=N.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=N.util.locToIndex(h,i,u);c[d]=r[l]}return c}function Mn(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.perm;He(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=n.data.get(a.dataId).values,l=Px(c,a.shape,a.dtype,i,s),f=n.write(l,s,a.dtype);return{dataId:f,shape:s,dtype:a.dtype}}var OMe={kernelName:N.Transpose,backendName:"cpu",kernelFunc:Mn};function rW(r,e,t,n){for(var a=Ve(N.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=N.upcastType(e,"int32"),u=N.util.makeZerosTypedArray(N.util.sizeFromShape(i),s),c=N.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function PMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"prod");var s=a.shape.length,u=N.util.parseAxisParam(i,a.shape),c=N.backend_util.getAxesPermutation(u,s),l=u,f=a,h=[];c!=null&&(f=Mn({inputs:{x:a},backend:t,attrs:{perm:c}}),h.push(f),l=N.backend_util.getInnerMostAxes(l.length,s));var p=t.data.get(f.dataId).values,d=rW(f.shape,f.dtype,p,l),m=d.outVals,v=d.outShape,g=d.outDtype,y=v;return o&&(y=N.backend_util.expandShapeToKeepDim(v,u)),h.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),t.makeTensorInfo(y,g,m)}var MMe={kernelName:N.Prod,backendName:"cpu",kernelFunc:PMe};function BMe(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=N.util.indexToLoc(a,e.length,N.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(n," is not in [0, ").concat(t,")"))}})}function LMe(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function zMe(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});LMe(t,n);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,c=0;c<t.length;++c){var d=t[c],m=c+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function $Me(r){for(var e=[],t=function(a){var i=r[a].length,o=N.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function x$(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function WMe(r,e,t,n,a,i){var o,s,u=x$(e,2)[1],c=x$(i,2)[1],l=0;try{for(var f=$c(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[l*c+m]=r[d*u+m];++l}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function qMe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=N.util.getArrayFromDType(t,N.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return WMe(r,e,n,u,o,i),[o,i]}function nW(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(BMe(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var c=n[0],l=zMe(i,o,r,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=$Me(f),m=qMe(t,n,a,h,p);return[d,m[0],m[1]]}var k$=2147483647;function aW(r,e,t,n,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=N.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var m=s?r[0]:r[d],v=u?n[0]:n[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if(y=Math.ceil(Math.abs((v-m)/g)),y>k$)throw new Error("Requires ((limit - start) / delta) <= ".concat(k$));p[d+1]=p[d]+y}for(var w=p[h],b=N.util.getArrayFromDType(t,w),x=0,d=0;d<h;++d)for(var S=p[d+1]-p[d],T=s?r[0]:r[d],g=c?i[0]:i[d],f=0;f<S;++f)b[x++]=T,T+=g;return[p,b]}var Qa=N.backend_util.RowPartitionType,UMe=function(){function r(e,t,n,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=N.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=N.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Qa.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Qa.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Qa.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case Qa.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Qa[this.getRowPartitionTypeByDimension(e-1)]))}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return N$(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;N.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=N.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return N.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=n;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=n:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Qa.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case Qa.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: ".concat(Qa[o]))}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Qa.FIRST_DIM_SIZE:return e[0];case Qa.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Qa.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Qa[t]))}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=N$(n,!1),s=N.util.getArrayFromDType(this.valuesDType,N.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],n[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=N.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;N.tidy(function(){var x=N.reshape(l,f),S=N.broadcastTo(x,s);l=S.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=c;++m){var v=m<c?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),w=(d-p)*u;S$(y,g,w)}if(m>=c){var b=n.length;v=Math.floor(b/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);S$(y,l,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r}();function S$(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function N$(r,e){var t,n,a=[];try{for(var i=$c(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function iW(r,e,t,n,a,i,o,s,u,c){return new UMe(r,e,t,n,a,i,o,s,u,c).compute()}function oW(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return N.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=N.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var sW=zi(function(r){return 1/Math.sqrt(r)}),VMe=cs(N.Rsqrt,sW),GMe={kernelName:N.Rsqrt,backendName:"cpu",kernelFunc:VMe};function mu(r,e,t,n,a,i,o,s,u,c){var l=[n/a,a],f=r.values,h=e.values;if(n===0)return N.buffer(t,e.dtype);var p=u instanceof N.TensorBuffer?u:N.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(t));for(var w=0;w<a;w++)c?p.values[v*a+w]+=h[d*a+w]:p.values[v*a+w]=e.rank===0?h[0]:h[d*a+w]}return p}var HMe=zi(function(r){return 1/(1+Math.exp(-r))}),uW=Bt(N.Sigmoid,function(r){return 1/(1+Math.exp(-r))}),KMe={kernelName:N.Sigmoid,backendName:"cpu",kernelFunc:uW};function cW(r,e,t,n,a){var i=N.slice_util.isSliceContinous(n,e,t),o=N.util.sizeFromShape(t),s=N.util.computeStrides(n);if(i){var u=N.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var c=a==="string"?N.backend_util.fromUint8ToStringArray(r):r,l=N.buffer(n,a,c),f=N.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,xa([l.get.apply(l,xa([],Ve(d),!1))],Ve(p),!1))}return a==="string"?N.backend_util.fromStringArrayToUint8(f.values):f.values}function yu(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size;He(a,"slice");var s=Ve(N.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];N.slice_util.assertParamsValid(a,u,c);var l=t.data.get(a.dataId).values,f=cW(l,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var jMe={kernelName:N.Slice,backendName:"cpu",kernelFunc:yu};function lW(r,e,t,n,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(N.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=N.util.getArrayFromDType(t,0),p=N.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(N.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(N.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var w=!0,y=0;y<u;++y){var b=v[y]===0;c[y]=b,w=w&&!b,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(w&&d){for(var h=r,p=n,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=v[u-1],h=N.util.getArrayFromDType(t,x*f),p=N.util.getArrayFromDType(a,x),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],T=S[y],E=(y===0?0:v[y-1])+T;S[y]++;for(var C=0;C<f;++C)h[E*f+C]=r[g*f+C];p[E]=n[g],l[g]=E}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:v[y-1];h[_*f+0]=y;for(var P=1;P<f;++P)h[_*f+P]=0;p[_]=o}}return[h,[x,f],p,c,l]}}function fW(r,e,t,n,a){for(var i=N.util.sizeFromShape(n),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(N.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(N.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(N.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(N.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[l]=p}var d=N.util.sizeFromShape(u);if(d!==i)throw new Error(N.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=N.util.getArrayFromDType(t,o*s),w=0;w<o;++w){for(var b=0,x=0;x<m;++x)b+=r[w*m+x]*v[x];for(var x=0;x<s;++x)y[w*s+x]=Math.trunc(b/g[x]),b%=g[x]}return[y,[o,s],u]}function Mx(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(N.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,E){return T*E},1),d=N.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(N.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var w=0;if(v<s){if(w=a[v],y===w){++v;continue}if(y>=w)throw new Error(N.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(N.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var b=m;b<v;++b){var x=n[b];if(x<0||x>=u[0])throw new Error(N.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,n[b],u[0]));for(var S=0;S<c;S++)d[y*c+S]+=r[x*c+S]}if(i)for(var S=0;S<c;S++)d[y*c+S]/=v-m;if(m=v,++v,g=y+1,y=w,v>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var XMe=zi(function(r){return Math.sqrt(r)}),YMe=Bt(N.Sqrt,function(r){return Math.sqrt(r)}),ZMe={kernelName:N.Sqrt,backendName:"cpu",kernelFunc:YMe};var hW=_r(function(r,e){var t=r-e;return t*t}),JMe=Gr(N.SquaredDifference,hW),QMe={kernelName:N.SquaredDifference,backendName:"cpu",kernelFunc:JMe};var pW=zi(function(r,e){var t=e.pattern,n=e.replaceGlobal,a=e.rewrite;return r.replace(new RegExp(t,n?"g":""),a)}),e4e=cs(N.StaticRegexReplace,pW),t4e={kernelName:N.StaticRegexReplace,backendName:"cpu",kernelFunc:e4e};function dW(r,e,t,n){for(var a=N.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,xa([e.get.apply(e,xa([],Ve(s),!1))],Ve(o),!1))}return a}var r4e=function(){function r(e,t,n,a,i,o){this.separator=N.util.encodeString(e),this.nGramWidths=t,this.leftPad=N.util.encodeString(n),this.rightPad=N.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),m=t+(h>0?0:l-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+l]=new Uint8Array(v);for(var w=n[a+l],b=0,x=function(S){return S.forEach(function(T){return w[b++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=N.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],w=0;p.nGramWidths.forEach(function(b){w+=n.getNumNGrams(y,b)}),p.preserveShort&&y>0&&w===0&&(w=1),l[g]=l[g-1]+w},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),m=function(g){var y=t[g],w=l[g];if(v.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=n.getNumNGrams(E,T);n.createNGrams(e,y,d,w,C,T),w+=C}),v.preserveShort&&w===l[g]){var b=t[g+1]-t[g];if(b===0)return"continue";var x=b+2*v.padWidth,S=1;v.createNGrams(e,y,d,w,S,x)}},v=this,s=0;s<c;++s)m(s);return[d,l]},r}();function vW(r,e,t,n,a,i,o,s){return new r4e(t,n,a,i,o,s).compute(r,e)}function n4e(r,e,t,n){if(!!r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function mW(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var c=a.length;n4e(r[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=N.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function gW(r,e){for(var t=N.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=N.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var yW=_r(function(r,e){return r-e}),a4e=Fx(function(r,e,t,n){return{real:r-t,imag:e-n}}),Bx=Gr(N.Sub,yW,a4e),i4e={kernelName:N.Sub,backendName:"cpu",kernelFunc:Bx};function bW(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=N.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var ph=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function wW(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(n,Math.floor(e+(a-i)*s/a+u));wW(r,e,c,l)}var f=r[e],h=t,p=n;for(N.util.swap(r,t,e),ph(r[n],f)>0&&N.util.swap(r,t,n);h<p;){for(N.util.swap(r,h,p),h++,p--;ph(r[h],f)<0;)h=h+1;for(;ph(r[p],f)>0;)p=p-1}ph(r[t],f)===0?N.util.swap(r,t,p):(p=p+1,N.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function xW(r,e,t,n,a){for(var i=e[e.length-1],o=Ve([r.length/i,i],2),s=o[0],u=o[1],c=N.util.getTypedArrayFromDType(t,s*n),l=N.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(S,T){return g[T]={value:S,index:T}}),n<g.length&&(wW(g,n),g=g.slice(0,n)),a&&g.sort(ph);for(var y=d*n,w=c.subarray(y,y+n),b=l.subarray(y,y+n),x=0;x<n;x++)w[x]=g[x].value,b[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[N.buffer(p,t,c),N.buffer(p,"int32",l)]}function kW(r,e,t,n){for(var a=N.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s=new Map,u=new Int32Array(t[a]),c=new N.TensorBuffer(i,n,r),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(c.get(d,o,m));h=p.join(",")}var v=s.get(h);if(v!=null)u[o]=v;else{var g=s.size;s.set(h,g),u[o]=g,l.push(o)}}var y=i.slice();y[1]=s.size;var w=new N.TensorBuffer(y,n);l.forEach(function(x,S){for(var T=0;T<i[0];T++)for(var E=0;E<i[2];E++)w.set(c.get(T,x,E),T,S,E)});var b=t.slice();return b[a]=y[1],{outputValues:w.values,outputShape:b,indices:u}}var o4e={__proto__:null,addImpl:_$,bincountImpl:Rx,bincountReduceImpl:F$,bitwiseAndImpl:R$,castImpl:D$,ceilImpl:O$,concatImpl:P$,equalImpl:M$,expImpl:L$,expm1Impl:$$,floorDivImpl:q$,floorImpl:W$,gatherNdImpl:U$,gatherV2Impl:V$,greaterEqualImpl:H$,greaterImpl:G$,lessEqualImpl:j$,lessImpl:K$,linSpaceImpl:X$,logImpl:Y$,maxImpl:Z$,maximumImpl:J$,minimumImpl:Q$,multiplyImpl:Ox,negImpl:eW,notEqualImpl:tW,prodImpl:rW,raggedGatherImpl:nW,raggedRangeImpl:aW,raggedTensorToTensorImpl:iW,rangeImpl:oW,rsqrtImpl:sW,scatterImpl:mu,sigmoidImpl:HMe,simpleAbsImpl:A$,sliceImpl:cW,sparseFillEmptyRowsImpl:lW,sparseReshapeImpl:fW,sparseSegmentReductionImpl:Mx,sqrtImpl:XMe,squaredDifferenceImpl:hW,staticRegexReplaceImpl:pW,stridedSliceImpl:dW,stringNGramsImpl:vW,stringSplitImpl:mW,stringToHashBucketFastImpl:gW,subImpl:yW,tileImpl:bW,topKImpl:xW,transposeImpl:Px,uniqueImpl:kW};var s4e="4.19.0";N.registerBackend("cpu",function(){return new _x},1);var SW=Bt(N.Elu,function(r){return r>=0?r:Math.exp(r)-1}),u4e={kernelName:N.Elu,backendName:"cpu",kernelFunc:SW};function NW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha;He([a],"leakyRelu");for(var o=N.util.sizeFromShape(a.shape),s=t.data.get(a.dataId).values,u=N.util.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return t.makeTensorInfo(a.shape,"float32",u)}var c4e={kernelName:N.LeakyRelu,backendName:"cpu",kernelFunc:NW},l4e=_r(function(r,e){return r<0?e*r:r});function TW(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha;He([n,a],"prelu");var i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=Ve(l4e(n.shape,a.shape,i,o,"float32"),2),u=s[0],c=s[1];return t.makeTensorInfo(c,"float32",u)}var f4e={kernelName:N.Prelu,backendName:"cpu",kernelFunc:TW};var EW=Bt(N.Relu,function(r){return Math.max(0,r)}),h4e={kernelName:N.Relu,backendName:"cpu",kernelFunc:EW};var IW=Bt(N.Relu6,function(r){return Math.min(Math.max(0,r),6)}),p4e={kernelName:N.Relu6,backendName:"cpu",kernelFunc:IW};function im(r,e,t,n,a){if(t==="linear")return Li({inputs:{x:e},backend:r});if(t==="relu")return EW({inputs:{x:e},backend:r});if(t==="elu")return SW({inputs:{x:e},backend:r});if(t==="relu6")return IW({inputs:{x:e},backend:r});if(t==="prelu")return TW({inputs:{x:e,alpha:n},backend:r});if(t==="leakyrelu")return NW({inputs:{x:e},backend:r,attrs:{alpha:a}});if(t==="sigmoid")return uW({inputs:{x:e},backend:r});throw new Error("Activation ".concat(t," has not been implemented for the CPU backend."))}function Gt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=N.util.sizeFromShape(a.shape),s=N.util.inferFromImplicitShape(i,o),u=N.util.sizeFromShape(s);N.util.assert(o===u,function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."}),t.incRef(a.dataId);var c=t.data.get(a.dataId);if(c.complexTensorInfos!=null){var l=c.complexTensorInfos.real,f=c.complexTensorInfos.imag;l.shape=s,f.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var d4e={kernelName:N.Reshape,backendName:"cpu",kernelFunc:Gt};function CW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;He([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],p=s?i.shape[c-2]:i.shape[c-1],d=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=N.util.sizeFromShape(d),g=N.util.sizeFromShape(m),y=N.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),w=y.concat([h,p]);N.util.assert(l===f,function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")});for(var b=o?[v,l,h]:[v,h,l],x=s?[g,p,f]:[g,f,p],S=Gt({inputs:{x:a},backend:t,attrs:{shape:b}}),T=Gt({inputs:{x:i},backend:t,attrs:{shape:x}}),E=o?S.shape[1]:S.shape[2],C=o?S.shape[2]:S.shape[1],R=s?T.shape[1]:T.shape[2],_=Math.max(v,g),P=t.data.get(S.dataId).values,$=t.data.get(T.dataId).values,z=N.util.computeStrides(S.shape),L=N.util.computeStrides(T.shape),B=Ve(o?[z[0],1,z[1]]:[z[0],z[1],1],3),q=B[0],Y=B[1],J=B[2],U=Ve(s?[1,L[1],L[0]]:[L[1],1,L[0]],3),j=U[0],ne=U[1],re=U[2],se=C*R,le=N.buffer([_,C,R],S.dtype),de=le.values,ke=t.blockSize,he=0;he<_;he++)for(var ye=he%v,xe=he%g,De=0;De<C;De+=ke)for(var Ye=Math.min(De+ke,C),ht=0;ht<R;ht+=ke)for(var at=Math.min(ht+ke,R),nt=0;nt<E;nt+=ke)for(var ft=Math.min(nt+ke,E),st=De;st<Ye;st++)for(var Ze=ht;Ze<at;Ze++){for(var tt=0,et=nt;et<ft;et++){var ir=P[ye*q+st*Y+et*J],Xe=$[et*j+Ze*ne+xe*re];tt+=ir*Xe}de[he*se+(st*R+Ze)]+=tt}return t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(w,le.dtype,le.values)}var v4e={kernelName:N.BatchMatMul,backendName:"cpu",kernelFunc:CW};function m4e(r){var e,t,n=r.inputs,a=r.backend,i=r.attrs,o=n.a,s=n.b,u=n.bias,c=n.preluActivationWeights,l=i.transposeA,f=i.transposeB,h=i.activation,p=i.leakyreluAlpha,d,m,v,g=[],y=CW({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:f},backend:a});d=y,u&&(m=Wc({inputs:{a:d,b:u},backend:a}),g.push(d),d=m),h&&(v=im(a,d,h,c,p),g.push(d),d=v);try{for(var w=$c(g),b=w.next();!b.done;b=w.next()){var x=b.value;a.disposeIntermediateTensorInfo(x)}}catch(S){e={error:S}}finally{try{b&&!b.done&&(t=w.return)&&t.call(w)}finally{if(e)throw e.error}}return d}var g4e={kernelName:N._FusedMatMul,backendName:"cpu",kernelFunc:m4e};var y4e=Bt(N.Acos,function(r){return Math.acos(r)}),b4e={kernelName:N.Acos,backendName:"cpu",kernelFunc:y4e};var w4e=Bt(N.Acosh,function(r){return Math.acosh(r)}),x4e={kernelName:N.Acosh,backendName:"cpu",kernelFunc:w4e};function k4e(r){var e=r.inputs,t=r.backend,n=e;He(e,"addN");for(var a=n.map(function(l){return t.data.get(l.dataId).values}),i=N.buffer(n[0].shape,n[0].dtype),o=i.values,s=0;s<n.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return t.makeTensorInfo(i.shape,i.dtype,i.values)}var S4e={kernelName:N.AddN,backendName:"cpu",kernelFunc:k4e};function N4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"all");var s=N.util.parseAxisParam(i,a.shape),u=s,c=N.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Mn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=N.backend_util.getInnerMostAxes(u.length,a.shape.length)),N.backend_util.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var f=Ve(N.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=N.util.sizeFromShape(p),m=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];w=w&&x}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=N.backend_util.expandShapeToKeepDim(h,s),E=Gt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),E}return S}var T4e={kernelName:N.All,backendName:"cpu",kernelFunc:N4e};function E4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"any");var s=N.util.parseAxisParam(i,a.shape),u=s,c=N.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Mn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=N.backend_util.getInnerMostAxes(u.length,a.shape.length)),N.backend_util.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var f=Ve(N.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=N.util.sizeFromShape(p),m=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];w=w||x}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=N.backend_util.expandShapeToKeepDim(h,s),E=Gt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),E}return S}var I4e={kernelName:N.Any,backendName:"cpu",kernelFunc:E4e};function C4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;He(a,"argMax");var o=N.util.parseAxisParam(i,a.shape),s=N.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Mn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=N.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],N.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=Ve(N.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=N.util.sizeFromShape(f),d=N.util.makeZerosTypedArray(p,"int32"),m=N.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,w=v[y],b=0,x=0;x<m;++x){var S=v[y+x];S>w&&(w=S,b=x)}d[g]=b}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var A4e={kernelName:N.ArgMax,backendName:"cpu",kernelFunc:C4e};function D4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;He(a,"argMin");var o=N.util.parseAxisParam(i,a.shape),s=N.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Mn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=N.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],N.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=Ve(N.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=N.util.sizeFromShape(f),d=N.util.makeZerosTypedArray(p,"int32"),m=N.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,w=v[y],b=0,x=0;x<m;++x){var S=v[y+x];S<w&&(w=S,b=x)}d[g]=b}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var _4e={kernelName:N.ArgMin,backendName:"cpu",kernelFunc:D4e};var F4e=Bt(N.Asin,function(r){return Math.asin(r)}),R4e={kernelName:N.Asin,backendName:"cpu",kernelFunc:F4e};var O4e=Bt(N.Asinh,function(r){return Math.asinh(r)}),P4e={kernelName:N.Asinh,backendName:"cpu",kernelFunc:O4e};var M4e=Bt(N.Atan,function(r){return Math.atan(r)}),B4e={kernelName:N.Atan,backendName:"cpu",kernelFunc:M4e};var L4e=_r(function(r,e){return Math.atan2(r,e)}),z4e=Gr(N.Atan2,L4e),$4e={kernelName:N.Atan2,backendName:"cpu",kernelFunc:z4e};var W4e=Bt(N.Atanh,function(r){return Math.atanh(r)}),q4e={kernelName:N.Atanh,backendName:"cpu",kernelFunc:W4e};function Lx(r,e,t,n,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,d=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=N.buffer(a.outShape,t),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],w=a.outShape[3],b=0;b<a.batchSize;++b)for(var x=b*g,S=b*n[0],T=0;T<a.inChannels;++T)for(var E=0;E<a.outHeight;++E)for(var C=E*o-h,R=Math.max(0,C),_=Math.min(a.inHeight,l+C),P=x+E*y,$=0;$<a.outWidth;++$){for(var z=$*s-p,L=Math.max(0,z),B=Math.min(a.inWidth,f+z),q=d,Y=0,J=0,U=R;U<_;U+=u){for(var j=S+U*n[1],ne=L;ne<B;ne+=c){var re=j+ne*n[2],se=r[re+T];i==="max"&&se>q?q=se:i==="avg"&&(Y+=se,J++)}if(isNaN(q))break}var le=P+$*w+T;v[le]=i==="avg"?Y/J:q}return m}function AW(r,e,t,n,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=N.buffer(n.outShape,"int32"),s=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,l=n.dilationWidth,f=n.effectiveFilterHeight,h=n.effectiveFilterWidth,p=n.padInfo.top,d=n.padInfo.left,m=N.buffer(e,t,r),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.outHeight;++y){for(var w=y*s-p,b=w;b<0;)b+=c;for(var x=Math.min(n.inHeight,f+w),S=0;S<n.outWidth;++S){for(var T=S*u-d,E=T;E<0;)E+=l;for(var C=Math.min(n.inWidth,h+T),R=Number.NEGATIVE_INFINITY,_=-1,P=b;P<x;P+=c)for(var $=P-w,z=E;z<C;z+=l){var L=z-T,B=m.get(v,P,z,g);B>R&&(R=B,a?_=i?((v*n.inHeight+P)*n.inWidth+z)*n.inChannels+g:(P*n.inWidth+z)*n.inChannels+g:_=$*h+L)}o.set(_,v,y,S,g)}}return o}function DW(r,e,t,n,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,p=a.effectiveFilterHeight,d=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=N.buffer(a.outShape,t),b=w.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[2]*a.outShape[3]*a.outShape[4],T=a.outShape[3]*a.outShape[4],E=a.outShape[4],C=0;C<a.batchSize;++C)for(var R=C*x,_=C*n[0],P=0;P<a.inChannels;++P)for(var $=0;$<a.outDepth;++$){for(var z=$*o-m,L=z;L<0;)L+=c;for(var B=Math.min(a.inDepth,h+z),q=R+$*S,Y=0;Y<a.outHeight;++Y){for(var J=Y*s-v,U=J;U<0;)U+=l;for(var j=Math.min(a.inHeight,p+J),ne=q+Y*T,re=0;re<a.outWidth;++re){for(var se=re*u-g,le=se;le<0;)le+=f;for(var de=Math.min(a.inWidth,d+se),ke=ne+re*E,he=y,ye=0,xe=0,De=L;De<B;De+=c){for(var Ye=_+De*n[1],ht=U;ht<j;ht+=l){for(var at=Ye+ht*n[2],nt=le;nt<de;nt+=f){var ft=at+nt*n[3],st=r[ft+P];if(i==="max"&&st>he?he=st:i==="avg"&&(ye+=st,xe++),isNaN(he))break}if(isNaN(he))break}if(isNaN(he))break}var Ze=ke+P;b[Ze]=i==="avg"?ye/Math.max(xe,1):he}}}return w}function U4e(r,e){for(var t=N.buffer(e.outShape,"int32"),n=e.strideDepth,a=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,d=e.padInfo.left,m=0;m<e.batchSize;++m)for(var v=0;v<e.inChannels;++v)for(var g=0;g<e.outDepth;++g){for(var y=g*n-h,w=y;w<0;)w+=o;for(var b=Math.min(e.inDepth,c+y),x=0;x<e.outHeight;++x){for(var S=x*a-p,T=S;T<0;)T+=s;for(var E=Math.min(e.inHeight,l+S),C=0;C<e.outWidth;++C){for(var R=C*i-d,_=R;_<0;)_+=u;for(var P=Math.min(e.inWidth,f+R),$=Number.NEGATIVE_INFINITY,z=-1,L=w;L<b;L+=o)for(var B=L-y,q=T;q<E;q+=s)for(var Y=q-S,J=_;J<P;J+=u){var U=J-R,j=r.get(m,L,q,J,v);j>=$&&($=j,z=B*l*f+Y*l+U)}t.set(z,m,g,x,C,v)}}}return t}function V4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;He(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;N.util.assert(N.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=N.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&N.util.arraysEqual(l.inShape,l.outShape))f=Li({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=N.util.computeStrides(a.shape),d=Lx(h,a.shape,a.dtype,p,l,"avg");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var G4e={kernelName:N.AvgPool,backendName:"cpu",kernelFunc:V4e};function H4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat;He(a,"avgPool3d");var l=N.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=DW(f,a.shape,a.dtype,N.util.computeStrides(a.shape),l,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}var K4e={kernelName:N.AvgPool3D,backendName:"cpu",kernelFunc:H4e};function j4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;He([a,i],"avgPool3DGrad");for(var l=N.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=l.strideDepth,h=l.strideHeight,p=l.strideWidth,d=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,w=l.dilationWidth,b=l.effectiveFilterDepth,x=l.effectiveFilterHeight,S=l.effectiveFilterWidth,T=b-1-l.padInfo.front,E=S-1-l.padInfo.left,C=x-1-l.padInfo.top,R=N.buffer(i.shape,"float32"),_=1/(d*m*v),P=t.bufferSync(a),$=0;$<l.batchSize;++$)for(var z=0;z<l.inChannels;++z)for(var L=0;L<l.inDepth;++L)for(var B=0;B<l.inHeight;++B)for(var q=0;q<l.inWidth;++q){for(var Y=L-T,J=B-C,U=q-E,j=0,ne=0;ne<b;ne+=g){var re=(Y+ne)/f;if(!(re<0||re>=l.outDepth||Math.floor(re)!==re))for(var se=0;se<x;se+=y){var le=(J+se)/h;if(!(le<0||le>=l.outHeight||Math.floor(le)!==le))for(var de=0;de<S;de+=w){var ke=(U+de)/p;if(!(ke<0||ke>=l.outWidth||Math.floor(ke)!==ke)){var he=P.get($,re,le,ke,z);j+=he}}}}R.set(j*_,$,L,B,q,z)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}var X4e={kernelName:N.AvgPool3DGrad,backendName:"cpu",kernelFunc:j4e};function Y4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;He([a,i],"avgPoolGrad");for(var s=n.filterSize,u=n.strides,c=n.pad,l=N.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=l.strideHeight,h=l.strideWidth,p=l.filterHeight,d=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,w=y-1-l.padInfo.left,b=g-1-l.padInfo.top,x=N.buffer(o.shape,"float32"),S=1/(p*d),T=t.data.get(a.dataId).values,E=N.buffer(a.shape,"float32",T),C=0;C<l.batchSize;++C)for(var R=0;R<l.inChannels;++R)for(var _=0;_<l.inHeight;++_)for(var P=0;P<l.inWidth;++P){for(var $=_-b,z=P-w,L=0,B=0;B<g;B+=m){var q=($+B)/f;if(!(q<0||q>=l.outHeight||Math.floor(q)!==q))for(var Y=0;Y<y;Y+=v){var J=(z+Y)/h;if(!(J<0||J>=l.outWidth||Math.floor(J)!==J)){var U=E.get(C,q,J,R);L+=U}}}x.set(L*S,C,_,P,R)}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var Z4e={kernelName:N.AvgPoolGrad,backendName:"cpu",kernelFunc:Y4e};function J4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.scale,o=e.offset,s=e.mean,u=e.variance;N.util.assert(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),N.util.assert(o==null||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),N.util.assert(i==null||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),He([a,s,u,i,o],"batchNorm");var c=n.varianceEpsilon;c==null&&(c=.001);for(var l=t.data.get(a.dataId).values,f=t.data.get(s.dataId).values,h=t.data.get(u.dataId).values,p=i?t.data.get(i.dataId).values:new Float32Array([1]),d=o?t.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=d.length,g=p.length,y=h.length,w=f.length,b=0,x=0,S=0,T=0,E=0;E<l.length;++E)m[E]=d[b++]+(l[E]-f[x++])*p[S++]/Math.sqrt(h[T++]+c),b>=v&&(b=0),x>=w&&(x=0),S>=g&&(S=0),T>=y&&(T=0);return t.makeTensorInfo(a.shape,a.dtype,m)}var Q4e={kernelName:N.FusedBatchNorm,backendName:"cpu",kernelFunc:J4e};function eBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;He([a],"batchToSpaceND");var s=i.reduce(function(g,y){return g*y}),u=N.backend_util.getReshaped(a.shape,i,s),c=N.backend_util.getPermuted(u.length,i.length),l=N.backend_util.getReshapedPermuted(a.shape,i,s),f=N.backend_util.getSliceBeginCoords(o,i.length),h=N.backend_util.getSliceSize(l,o,i.length),p=Gt({inputs:{x:a},backend:t,attrs:{shape:u}}),d=Mn({inputs:{x:p},backend:t,attrs:{perm:c}}),m=Gt({inputs:{x:d},backend:t,attrs:{shape:l}}),v=yu({inputs:{x:m},backend:t,attrs:{begin:f,size:h}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var tBe={kernelName:N.BatchToSpaceND,backendName:"cpu",kernelFunc:eBe};function rBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Rx(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var nBe={kernelName:N.Bincount,backendName:"cpu",kernelFunc:rBe};function aBe(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=N.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var iBe={kernelName:N.BroadcastArgs,backendName:"cpu",kernelFunc:aBe};var oBe=Bt(N.ClipByValue,function(r,e){var t=e;return r>t.clipValueMax?t.clipValueMax:r<t.clipValueMin?t.clipValueMin:r}),sBe={kernelName:N.ClipByValue,backendName:"cpu",kernelFunc:oBe};var uBe=function(r){for(var e=r.inputs.x,t=r.backend,n=new Float32Array(N.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],f=u[c];n[c]=Math.hypot(l,f)}return t.makeOutput(n,e.shape,"float32")},cBe={kernelName:N.ComplexAbs,backendName:"cpu",kernelFunc:uBe};function qc(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.imag,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var lBe={kernelName:N.Imag,backendName:"cpu",kernelFunc:qc};function Uc(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=N.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(b){return b.shape});N.backend_util.assertParamsConsistent(o,i);var s=N.backend_util.computeOutShape(e.map(function(b){return b.shape}),i);if(N.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(b){return N.util.sizeFromShape(b.shape)>0});if(u.length===1)return Li({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){var c=u.map(function(b){return gu({inputs:{input:b},backend:t})}),l=u.map(function(b){return qc({inputs:{input:b},backend:t})}),f=Uc({inputs:c,backend:t,attrs:{axis:i}}),h=Uc({inputs:l,backend:t,attrs:{axis:i}}),p=ca({inputs:{real:f,imag:h},backend:t});return c.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),l.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}var d=u.map(function(b){var x=N.util.sizeFromShape(b.shape.slice(i)),S=[-1,x];return Gt({inputs:{x:b},backend:t,attrs:{shape:S}})}),m=d.map(function(b){return{vals:t.data.get(b.dataId).values,shape:b.shape}});s=N.backend_util.computeOutShape(d.map(function(b){return b.shape}),1);var v=d[0].shape[0]===1,g=P$(m,s,e[0].dtype,v),y=N.backend_util.computeOutShape(u.map(function(b){return b.shape}),i),w=t.makeTensorInfo(y,e[0].dtype,g);return d.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),w}var fBe={kernelName:N.Concat,backendName:"cpu",kernelFunc:Uc};function _W(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dilations,l=n.dimRoundingMode;He([a,i],"conv2d");for(var f=N.backend_util.convertConv2DDataFormat(u),h=N.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p=h.filterHeight,d=h.filterWidth,m=h.dilationHeight,v=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,w=h.dataFormat==="channelsLast",b=new N.TensorBuffer(h.outShape,a.dtype),x=N.util.computeStrides(a.shape),S=N.util.computeStrides(i.shape),T=x[0],E=w?x[1]:x[2],C=w?x[2]:1,R=w?1:x[1],_=b.strides[0],P=w?b.strides[1]:b.strides[2],$=w?b.strides[2]:1,z=w?1:b.strides[1],L=t.data.get(a.dataId).values,B=t.data.get(i.dataId).values,q=b.values,Y=0;Y<h.batchSize;++Y)for(var J=Y*T,U=Y*_,j=0;j<h.outHeight;++j)for(var ne=U+j*P,re=j*h.strideHeight-y,se=0;se<p;++se){var le=re+se*m;if(!(le<0||le>=h.inHeight))for(var de=se*S[0],ke=J+le*E,he=0;he<h.outWidth;++he)for(var ye=ne+he*$,xe=he*h.strideWidth-g,De=0;De<d;++De){var Ye=xe+De*v;if(!(Ye<0||Ye>=h.inWidth))for(var ht=de+De*S[1],at=ke+Ye*C,nt=ht,ft=0;ft<h.inChannels;++ft){for(var st=L[at+ft*R],Ze=0;Ze<h.outChannels;++Ze)q[ye+Ze*z]+=st*B[nt+Ze];nt+=h.outChannels}}}return t.makeTensorInfo(b.shape,b.dtype,q)}var hBe={kernelName:N.Conv2D,backendName:"cpu",kernelFunc:_W};function pBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=n.filterShape;He([a,i],"conv2dBackpropFilter");for(var f=N.backend_util.convertConv2DDataFormat(u),h=N.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=h.strideHeight,d=h.strideWidth,m=h.filterHeight,v=h.filterWidth,g=h.dataFormat==="channelsLast",y=new N.TensorBuffer(h.filterShape,"float32"),w=h.padInfo.left,b=h.padInfo.top,x=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,T=new N.TensorBuffer(a.shape,a.dtype,x),E=new N.TensorBuffer(i.shape,i.dtype,S),C=0;C<m;++C)for(var R=Math.max(0,Math.ceil((b-C)/p)),_=Math.min(h.outHeight,(h.inHeight+b-C)/p),P=0;P<v;++P)for(var $=Math.max(0,Math.ceil((w-P)/d)),z=Math.min(h.outWidth,(h.inWidth+w-P)/d),L=0;L<h.inChannels;++L)for(var B=0;B<h.outChannels;++B){for(var q=0,Y=0;Y<h.batchSize;++Y)for(var J=R;J<_;++J)for(var U=C+J*p-b,j=$;j<z;++j){var ne=P+j*d-w;g?q+=T.get(Y,U,ne,L)*E.get(Y,J,j,B):q+=T.get(Y,L,U,ne)*E.get(Y,B,J,j)}y.set(q,C,P,L,B)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var dBe={kernelName:N.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:pBe};function vBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode;He([a,i],"conv2dBackpropInput");var f=N.util.computeStrides(i.shape),h=N.util.computeStrides(a.shape),p=N.backend_util.convertConv2DDataFormat(c),d=N.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,p),m=new N.TensorBuffer(d.inShape,"float32"),v=m.values,g=t.data.get(a.dataId).values,y=t.data.get(i.dataId).values,w=Ve(f,3),b=w[0],x=w[1],S=w[2],T=d.batchSize,E=d.filterHeight,C=d.filterWidth,R=d.inChannels,_=d.inHeight,P=d.inWidth,$=d.outChannels,z=d.outHeight,L=d.outWidth,B=d.strideHeight,q=d.strideWidth;p=d.dataFormat;for(var Y=E-1-d.padInfo.top,J=C-1-d.padInfo.left,U=p==="channelsLast",j=m.strides[0],ne=U?m.strides[1]:m.strides[2],re=U?m.strides[2]:1,se=U?1:m.strides[1],le=h[0],de=U?h[1]:h[2],ke=U?h[2]:1,he=U?1:h[1],ye=0;ye<T;++ye)for(var xe=0;xe<R;++xe)for(var De=0;De<_;++De)for(var Ye=De-Y,ht=Math.max(0,Math.ceil(Ye/B)),at=Math.min(z,(E+Ye)/B),nt=0;nt<P;++nt){for(var ft=nt-J,st=Math.max(0,Math.ceil(ft/q)),Ze=Math.min(L,(C+ft)/q),tt=0,et=ht;et<at;++et)for(var ir=et*B-Ye,Xe=st;Xe<Ze;++Xe)for(var kt=Xe*q-ft,Ir=le*ye+de*et+ke*Xe,gn=b*(E-1-ir)+x*(C-1-kt)+S*xe,Or=0;Or<$;++Or){var Cr=g[Ir+he*Or],or=y[gn+Or];tt+=Cr*or}var zn=j*ye+ne*De+re*nt+se*xe;v[zn]=tt}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var mBe={kernelName:N.Conv2DBackpropInput,backendName:"cpu",kernelFunc:vBe};function gBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations;He([a,i],"conv3d");for(var c=N.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,f=c.filterHeight,h=c.filterWidth,p=c.dilationDepth,d=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,w=v.top,b=new N.TensorBuffer(c.outShape,a.dtype),x=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,T=b.values,E=N.util.computeStrides(a.shape),C=N.util.computeStrides(i.shape),R=0;R<c.batchSize;++R)for(var _=R*E[0],P=R*b.strides[0],$=0;$<c.outDepth;++$)for(var z=P+$*b.strides[1],L=$*c.strideDepth-g,B=0;B<l;++B){var q=L+B*p;if(!(q<0||q>=c.inDepth))for(var Y=B*C[0],J=_+q*E[1],U=0;U<c.outHeight;++U)for(var j=z+U*b.strides[2],ne=U*c.strideHeight-w,re=0;re<f;++re){var se=ne+re*d;if(!(se<0||se>=c.inHeight))for(var le=Y+re*C[1],de=J+se*E[2],ke=0;ke<c.outWidth;++ke)for(var he=j+ke*c.outChannels,ye=ke*c.strideWidth-y,xe=0;xe<h;++xe){var De=ye+xe*m;if(!(De<0||De>=c.inWidth))for(var Ye=le+xe*C[2],ht=de+De*c.inChannels,at=Ye,nt=0;nt<c.inChannels;++nt){for(var ft=x[ht+nt],st=0;st<c.outChannels;++st)T[he+st]+=ft*S[at+st];at+=c.outChannels}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}var yBe={kernelName:N.Conv3D,backendName:"cpu",kernelFunc:gBe};function bBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape;He([a,i],"conv3dBackpropFilterV2");for(var c=N.util.computeStrides(a.shape),l=N.util.computeStrides(i.shape),f=N.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,p=f.strideHeight,d=f.strideWidth,m=f.filterDepth,v=f.filterHeight,g=f.filterWidth,y=new N.TensorBuffer(f.filterShape,"float32"),w=y.values,b=Ve(y.strides,4),x=b[0],S=b[1],T=b[2],E=b[3],C=t.data.get(i.dataId).values,R=Ve(l,4),_=R[0],P=R[1],$=R[2],z=R[3],L=t.data.get(a.dataId).values,B=Ve(c,4),q=B[0],Y=B[1],J=B[2],U=B[3],j=f.padInfo.front,ne=f.padInfo.left,re=f.padInfo.top,se=0;se<m;++se)for(var le=Math.max(0,Math.ceil((j-se)/h)),de=Math.min(f.outDepth,(f.inDepth+j-se)/h),ke=se*x,he=0;he<v;++he)for(var ye=Math.max(0,Math.ceil((re-he)/p)),xe=Math.min(f.outHeight,(f.inHeight+re-he)/p),De=he*S+ke,Ye=0;Ye<g;++Ye)for(var ht=Math.max(0,Math.ceil((ne-Ye)/d)),at=Math.min(f.outWidth,(f.inWidth+ne-Ye)/d),nt=Ye*T+De,ft=0;ft<f.inChannels;++ft)for(var st=ft*E+nt,Ze=0;Ze<f.outChannels;++Ze){for(var tt=0,et=0;et<f.batchSize;++et)for(var ir=et*q,Xe=et*_,kt=le;kt<de;++kt)for(var Ir=se+kt*h-j,gn=Ir*Y+ir,Or=kt*P+Xe,Cr=ye;Cr<xe;++Cr)for(var or=he+Cr*p-re,zn=or*J+gn,yn=Cr*$+Or,$n=ht;$n<at;++$n){var Sr=Ye+$n*d-ne,Hi=Sr*U+zn,Pu=$n*z+yn;tt+=L[Hi+ft]*C[Pu+Ze]}w[st+Ze]=tt}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var wBe={kernelName:N.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:bBe};function xBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape;He([a],"conv3dBackpropInputV2");for(var c=N.util.computeStrides(a.shape),l=N.util.computeStrides(i.shape),f=N.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new N.TensorBuffer(f.inShape,"float32"),p=h.values,d=Ve(h.strides,4),m=d[0],v=d[1],g=d[2],y=d[3],w=t.data.get(a.dataId).values,b=Ve(c,4),x=b[0],S=b[1],T=b[2],E=b[3],C=t.data.get(i.dataId).values,R=Ve(l,4),_=R[0],P=R[1],$=R[2],z=R[3],L=f.batchSize,B=f.filterDepth,q=f.filterHeight,Y=f.filterWidth,J=f.inChannels,U=f.inDepth,j=f.inHeight,ne=f.inWidth,re=f.outChannels,se=f.outDepth,le=f.outHeight,de=f.outWidth,ke=f.strideDepth,he=f.strideHeight,ye=f.strideWidth,xe=B-1-f.padInfo.front,De=q-1-f.padInfo.top,Ye=Y-1-f.padInfo.left,ht=0;ht<L;++ht)for(var at=0;at<J;++at)for(var nt=0;nt<U;++nt)for(var ft=nt-xe,st=Math.max(0,Math.ceil(ft/ke)),Ze=Math.min(se,(B+ft)/ke),tt=0;tt<j;++tt)for(var et=tt-De,ir=Math.max(0,Math.ceil(et/he)),Xe=Math.min(le,(q+et)/he),kt=0;kt<ne;++kt){for(var Ir=kt-Ye,gn=Math.max(0,Math.ceil(Ir/ye)),Or=Math.min(de,(Y+Ir)/ye),Cr=0,or=st;or<Ze;++or)for(var zn=or*ke-ft,yn=ir;yn<Xe;++yn)for(var $n=yn*he-et,Sr=gn;Sr<Or;++Sr)for(var Hi=Sr*ye-Ir,Pu=x*ht+S*or+T*yn+E*Sr,ep=_*(B-1-zn)+P*(q-1-$n)+$*(Y-1-Hi)+z*at,Ki=0;Ki<re;++Ki){var gs=w[Pu+Ki],Mu=C[ep+Ki];Cr+=gs*Mu}p[m*ht+v*nt+g*tt+y*kt+at]=Cr}return t.makeTensorInfo(h.shape,h.dtype,h.values)}var kBe={kernelName:N.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:xBe};var SBe=Bt(N.Cos,function(r){return Math.cos(r)}),NBe={kernelName:N.Cos,backendName:"cpu",kernelFunc:SBe};var TBe=Bt(N.Cosh,function(r){return Math.cosh(r)}),EBe={kernelName:N.Cosh,backendName:"cpu",kernelFunc:TBe};function IBe(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,c=n.extrapolationValue,l=Ve(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=i.shape[0],v=Ve(s,2),g=v[0],y=v[1],w=N.buffer([m,g,y,d],"float32"),b=t.data.get(i.dataId).values,x=t.data.get(o.dataId).values,S=t.data.get(a.dataId).values,T=N.util.computeStrides(a.shape),E=N.util.computeStrides(w.shape),C=0;C<m;C++){var R=C*4,_=b[R],P=b[R+1],$=b[R+2],z=b[R+3],L=x[C];if(!(L>=f))for(var B=g>1?($-_)*(h-1)/(g-1):0,q=y>1?(z-P)*(p-1)/(y-1):0,Y=0;Y<g;Y++){var J=g>1?_*(h-1)+Y*B:.5*(_+$)*(h-1);if(J<0||J>h-1){for(var U=0;U<y;U++)for(var j=0;j<d;j++){var ne=j+U*E[2]+Y*E[1]+C*E[0];w.values[ne]=c}continue}if(u==="bilinear")for(var re=Math.floor(J),se=Math.ceil(J),le=J-re,U=0;U<y;U++){var de=y>1?P*(p-1)+U*q:.5*(P+z)*(p-1);if(de<0||de>p-1){for(var j=0;j<d;j++){var ne=j+U*E[2]+Y*E[1]+C*E[0];w.values[ne]=c}continue}for(var ke=Math.floor(de),he=Math.ceil(de),ye=de-ke,j=0;j<d;j++){var ne=j+ke*T[2]+re*T[1]+L*T[0],xe=S[ne];ne=j+he*T[2]+re*T[1]+L*T[0];var De=S[ne];ne=j+ke*T[2]+se*T[1]+L*T[0];var Ye=S[ne];ne=j+he*T[2]+se*T[1]+L*T[0];var ht=S[ne],at=xe+(De-xe)*ye,nt=Ye+(ht-Ye)*ye;ne=j+U*E[2]+Y*E[1]+C*E[0],w.values[ne]=at+(nt-at)*le}}else for(var U=0;U<y;++U){var de=y>1?P*(p-1)+U*q:.5*(P+z)*(p-1);if(de<0||de>p-1){for(var j=0;j<d;j++){var ne=j+U*E[2]+Y*E[1]+C*E[0];w.values[ne]=c}continue}for(var ft=Math.round(de),st=Math.round(J),j=0;j<d;j++){var Ze=j+ft*T[2]+st*T[1]+L*T[0],tt=j+U*E[2]+Y*E[1]+C*E[0];w.values[tt]=S[Ze]}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var CBe={kernelName:N.CropAndResize,backendName:"cpu",kernelFunc:IBe};function ABe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;He(a,"cumprod");var u=N.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Mn({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=N.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=N.upcastType(c.dtype,"int32"),h=N.util.makeOnesTypedArray(N.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(T,E){return T+d-E-1}:function(T,E){return T+E},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?1:p[y];else{var w=m(v,g-1);h[y]=o?p[w]*h[w]:p[y]*h[w]}}var b=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=N.backend_util.getUndoAxesPermutation(u),S=Mn({inputs:{x:b},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(c),S}return b}var DBe={kernelName:N.Cumprod,backendName:"cpu",kernelFunc:ABe};function _Be(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;He(a,"cumsum");var u=N.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Mn({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=N.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=N.upcastType(c.dtype,"int32"),h=N.util.makeZerosTypedArray(N.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(T,E){return T+d-E-1}:function(T,E){return T+E},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?0:p[y];else{var w=m(v,g-1);h[y]=o?p[w]+h[w]:p[y]+h[w]}}var b=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=N.backend_util.getUndoAxesPermutation(u),S=Mn({inputs:{x:b},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(c),S}return b}var FBe={kernelName:N.Cumsum,backendName:"cpu",kernelFunc:_Be};function RBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=Rx(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=F$(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var OBe={kernelName:N.DenseBincount,backendName:"cpu",kernelFunc:RBe};function PBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat;N.util.assert(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)});for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],f=u*i,h=c*i,p=l/(i*i),d=t.data.get(a.dataId).values,m=new Float32Array(s*f*h*p),v=0,g=0;g<s;++g)for(var y=0;y<f;++y)for(var w=Math.floor(y/i),b=y%i,x=0;x<h;++x)for(var S=Math.floor(x/i),T=x%i,E=(b*i+T)*p,C=0;C<p;++C){var R=C+E,_=R+l*(S+c*(w+u*g));m[v++]=d[_]}return t.makeTensorInfo([s,f,h,p],a.dtype,m)}var MBe={kernelName:N.DepthToSpace,backendName:"cpu",kernelFunc:PBe};function FW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=n.dimRoundingMode;He([a,i],"depthwiseConv2DNative");var l=N.util.computeStrides(a.shape),f=N.util.computeStrides(i.shape),h=u;h==null&&(h=[1,1]),N.util.assert(N.backend_util.eitherStridesOrDilationsAreOne(o,h),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(h,"'")});for(var p=N.backend_util.computeConv2DInfo(a.shape,i.shape,o,h,s,c,!0),d=p.filterHeight,m=p.filterWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.padInfo,w=y.left,b=y.top,x=p.outChannels/p.inChannels,S=new N.TensorBuffer(p.outShape,a.dtype),T=t.data.get(a.dataId).values,E=t.data.get(i.dataId).values,C=S.values,R=0;R<p.batchSize;++R)for(var _=R*l[0],P=R*S.strides[0],$=0;$<p.outHeight;++$)for(var z=P+$*S.strides[1],L=$*p.strideHeight-b,B=0;B<d;++B){var q=L+B*v;if(!(q<0||q>=p.inHeight))for(var Y=B*f[0],J=_+q*l[1],U=0;U<p.outWidth;++U)for(var j=z+U*S.strides[2],ne=U*p.strideWidth-w,re=0;re<m;++re){var se=ne+re*g;if(!(se<0||se>=p.inWidth))for(var le=Y+re*f[1],de=J+se*p.inChannels,ke=j,he=le,ye=0;ye<p.inChannels;++ye){for(var xe=T[de+ye],De=0;De<x;++De)C[ke+De]+=xe*E[he+De];ke+=x,he+=x}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}var BBe={kernelName:N.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:FW};function LBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.filterShape;He([a,i],"depthwiseConv2dNativeBackpropFilter");for(var f=N.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=f.strideHeight,p=f.strideWidth,d=f.filterHeight,m=f.filterWidth,v=new N.TensorBuffer(f.filterShape,"float32"),g=f.padInfo.left,y=f.padInfo.top,w=f.outChannels/f.inChannels,b=t.data.get(a.dataId).values,x=new N.TensorBuffer(a.shape,a.dtype,b),S=t.data.get(i.dataId).values,T=new N.TensorBuffer(i.shape,i.dtype,S),E=0;E<d;++E)for(var C=Math.max(0,Math.ceil((y-E)/h)),R=Math.min(f.outHeight,(f.inHeight+y-E)/h),_=0;_<m;++_)for(var P=Math.max(0,Math.ceil((g-_)/p)),$=Math.min(f.outWidth,(f.inWidth+g-_)/p),z=0;z<f.outChannels;++z){for(var L=Math.trunc(z/w),B=z%w,q=0,Y=0;Y<f.batchSize;++Y)for(var J=C;J<R;++J)for(var U=E+J*h-y,j=P;j<$;++j){var ne=_+j*p-g;q+=x.get(Y,U,ne,L)*T.get(Y,J,j,z)}v.set(q,E,_,L,B)}return t.makeTensorInfo(v.shape,v.dtype,v.values)}var zBe={kernelName:N.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:LBe};function $Be(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.inputShape;He([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=N.util.computeStrides(a.shape),h=N.util.computeStrides(i.shape),p=N.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),d=new N.TensorBuffer(p.inShape,"float32"),m=d.values,v=Ve(d.strides,3),g=v[0],y=v[1],w=v[2],b=t.data.get(a.dataId).values,x=Ve(f,3),S=x[0],T=x[1],E=x[2],C=t.data.get(i.dataId).values,R=Ve(h,3),_=R[0],P=R[1],$=R[2],z=p.batchSize,L=p.filterHeight,B=p.filterWidth,q=p.inChannels,Y=p.inHeight,J=p.inWidth,U=p.outChannels,j=p.outHeight,ne=p.outWidth,re=p.strideHeight,se=p.strideWidth,le=L-1-p.padInfo.top,de=B-1-p.padInfo.left,ke=U/q,he=0;he<z;++he)for(var ye=0;ye<q;++ye)for(var xe=0;xe<Y;++xe)for(var De=xe-le,Ye=Math.max(0,Math.ceil(De/re)),ht=Math.min(j,(L+De)/re),at=0;at<J;++at){for(var nt=at-de,ft=Math.max(0,Math.ceil(nt/se)),st=Math.min(ne,(B+nt)/se),Ze=0,tt=Ye;tt<ht;++tt)for(var et=tt*re-De,ir=ft;ir<st;++ir)for(var Xe=ir*se-nt,kt=S*he+T*tt+E*ir,Ir=_*(L-1-et)+P*(B-1-Xe)+$*ye,gn=0;gn<ke;++gn){var Or=ye*ke+gn,Cr=b[kt+Or],or=C[Ir+gn];Ze+=Cr*or}m[g*he+y*xe+w*at+ye]=Ze}return t.makeTensorInfo(d.shape,d.dtype,d.values)}var WBe={kernelName:N.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:$Be};function qBe(r){for(var e=r.inputs,t=r.backend,n=e.x,a=N.util.sizeFromShape(n.shape),i=t.data.get(n.dataId).values,o=N.buffer([a,a],n.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=xa(xa([],Ve(n.shape),!1),Ve(n.shape),!1);return t.makeTensorInfo(c,o.dtype,o.values)}var UBe={kernelName:N.Diag,backendName:"cpu",kernelFunc:qBe};var VBe={kernelName:N.Dilation2D,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=t,l=c.data.get(a.dataId).values,f=a.shape.length,h=c.data.get(i.dataId).values,p=i.shape.length,d=N.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=d.batchSize,v=d.inHeight,g=d.inWidth,y=d.inChannels,w=d.outHeight,b=d.outWidth,x=d.padInfo,S=d.strideHeight,T=d.strideWidth,E=d.filterHeight,C=d.filterWidth,R=d.dilationHeight,_=d.dilationWidth,P=d.outShape,$=N.util.sizeFromShape(P),z=P.length,L=N.util.getArrayFromDType(a.dtype,$),B=0;B<m;++B)for(var q=0;q<w;++q)for(var Y=q*S-x.top,J=0;J<b;++J)for(var U=J*T-x.left,j=0;j<y;++j){for(var ne=Number.MIN_SAFE_INTEGER,re=0;re<E;++re){var se=Y+re*R;if(se>=0&&se<v)for(var le=0;le<C;++le){var de=U+le*_;if(de>=0&&de<g){var ke=N.util.locToIndex([B,se,de,j],f,N.util.computeStrides(a.shape)),he=N.util.locToIndex([re,le,j],p,N.util.computeStrides(i.shape)),ye=l[ke]+h[he];ye>ne&&(ne=ye)}}}var xe=N.util.locToIndex([B,q,J,j],z,N.util.computeStrides(P));L[xe]=ne}var De=c.write(N.util.toTypedArray(L,a.dtype),P,a.dtype);return{dataId:De,shape:P,dtype:a.dtype}}};var GBe={kernelName:N.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,c=n.dilations,l=t,f=N.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=N.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=N.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,w=p.outWidth,b=p.padInfo,x=p.strideHeight,S=p.strideWidth,T=p.filterHeight,E=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;N.util.assert(o.rank===_.length,function(){return"Error in ".concat(N.Dilation2DBackpropFilter,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var P=N.util.toNestedArray(_,l.data.get(o.dataId).values),$=N.util.makeZerosNestedTypedArray(i.shape,i.dtype),z=0;z<d;++z)for(var L=0;L<y;++L)for(var B=L*x-b.top,q=0;q<w;++q)for(var Y=q*S-b.left,J=0;J<g;++J){for(var U=Number.MIN_SAFE_INTEGER,j=0,ne=0,re=0;re<T;++re){var se=B+re*C;if(se>=0&&se<m)for(var le=0;le<E;++le){var de=Y+le*R;if(de>=0&&de<v){var ke=f[z][se][de][J]+h[re][le][J];ke>U&&(U=ke,j=re,ne=le)}}}$[j][ne][J]+=P[z][L][q][J]}var he=l.write(N.util.toTypedArray($,a.dtype),i.shape,i.dtype);return{dataId:he,shape:i.shape,dtype:i.dtype}}};var HBe={kernelName:N.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,c=n.dilations,l=t,f=N.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=N.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=N.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,w=p.outWidth,b=p.padInfo,x=p.strideHeight,S=p.strideWidth,T=p.filterHeight,E=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;N.util.assert(o.rank===_.length,function(){return"Error in ".concat(N.Dilation2DBackpropInput,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var P=N.util.toNestedArray(_,l.data.get(o.dataId).values),$=N.util.makeZerosNestedTypedArray(a.shape,a.dtype),z=0;z<d;++z)for(var L=0;L<y;++L)for(var B=L*x-b.top,q=0;q<w;++q)for(var Y=q*S-b.left,J=0;J<g;++J){for(var U=Number.MIN_SAFE_INTEGER,j=B<0?0:B,ne=Y<0?0:Y,re=0;re<T;++re){var se=B+re*C;if(se>=0&&se<m)for(var le=0;le<E;++le){var de=Y+le*R;if(de>=0&&de<v){var ke=f[z][se][de][J]+h[re][le][J];ke>U&&(U=ke,j=se,ne=de)}}}$[z][j][ne][J]+=P[z][L][q][J]}var he=l.write(N.util.toTypedArray($,a.dtype),a.shape,a.dtype);return{dataId:he,shape:a.shape,dtype:a.dtype}}};function KBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=n.canvas,o=n.options,s=o||{},u=s.contextOptions,c=s.imageOptions,l=c?.alpha||1,f=u?.contextType||"2d";if(f!=="2d")throw new Error("Context type ".concat(u.contextType," is not supported by the CPU backend."));var h=i.getContext(f,u?.contextAttributes||{});if(h==null)throw new Error("Could not get the context with ".concat(f," type."));for(var p=Ve(a.shape.slice(0,2),2),d=p[0],m=p[1],v=a.shape.length===2?1:a.shape[2],g=t.data.get(a.dataId).values,y=a.dtype==="float32"?255:1,w=new Uint8ClampedArray(m*d*4),b=0;b<d*m;++b){for(var x=[0,0,0,255*l],S=0;S<v;S++){var T=g[b*v+S];if(a.dtype==="float32"){if(T<0||T>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(T,"."))}else if(a.dtype==="int32"&&(T<0||T>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(T,"."));v===1?(x[0]=T*y,x[1]=T*y,x[2]=T*y):x[S]=T*y}var E=b*4;w[E+0]=Math.round(x[0]),w[E+1]=Math.round(x[1]),w[E+2]=Math.round(x[2]),w[E+3]=Math.round(x[3])}i.width=m,i.height=d;var C=new ImageData(w,m,d);return h.putImageData(C,0,0),a}var jBe={kernelName:N.Draw,backendName:"cpu",kernelFunc:KBe};function vh(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"sum");var s;a.dtype==="bool"?s=us({inputs:{x:a},backend:t,attrs:{dtype:"int32"}}):s=Li({inputs:{x:a},backend:t});var u=s.shape.length,c=N.util.parseAxisParam(i,s.shape),l=N.backend_util.getAxesPermutation(c,u),f=c,h=s;l!=null&&(h=Mn({inputs:{x:s},backend:t,attrs:{perm:l}}),f=N.backend_util.getInnerMostAxes(f.length,u)),N.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var p=Ve(N.backend_util.computeOutAndReduceShapes(h.shape,f),2),d=p[0],m=p[1],v=N.backend_util.upcastType(h.dtype,"int32"),g=am(t,d,v),y=N.util.sizeFromShape(m),w=t.data.get(g.dataId).values,b=t.data.get(h.dataId).values,x=0;x<w.length;++x){for(var S=x*y,T=0,E=0;E<y;++E)T+=b[S+E];w[x]=T}if(o){var C=N.backend_util.expandShapeToKeepDim(g.shape,c),R=g;g=Gt({inputs:{x:g},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(R)}return t.disposeIntermediateTensorInfo(s),l!=null&&t.disposeIntermediateTensorInfo(h),g}var XBe={kernelName:N.Sum,backendName:"cpu",kernelFunc:vh};function YBe(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,c=i,l=N.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;N.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=N.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,w=f.length,b=[],x=0;x<g;++x){try{for(var S=(e=void 0,$c(v[x])),T=S.next();!T.done;T=S.next()){var E=T.value,C=N.backend_util.getEinsumPermutation(w,p[E]),R=C.permutationIndices,_=C.expandDims,P=void 0;N.backend_util.isIdentityPermutation(R)?P=c[E]:(P=Mn({inputs:{x:c[E]},backend:o,attrs:{perm:R}}),b.push(P));for(var $=P.shape.slice(),z=0;z<_.length;++z)$.splice(_[z],0,1);N.util.arraysEqual(P.shape,$)||(P=Gt({inputs:{x:P},backend:o,attrs:{shape:$}}),b.push(P)),y===null?y=P:(y=um({inputs:{a:P,b:y},backend:o}),b.push(y))}}catch(Y){e={error:Y}}finally{try{T&&!T.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=vh({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-w),keepDims:!1}}),b.push(y)),w--)}try{for(var L=$c(b),B=L.next();!B.done;B=L.next()){var q=B.value;q!==y&&o.disposeIntermediateTensorInfo(q)}}catch(Y){n={error:Y}}finally{try{B&&!B.done&&(a=L.return)&&a.call(L)}finally{if(n)throw n.error}}return y}var ZBe={kernelName:N.Einsum,backendName:"cpu",kernelFunc:YBe};function JBe(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y;He([n,a],"eluGrad");for(var i=new Float32Array(N.util.sizeFromShape(a.shape)),o=t.data.get(a.dataId).values,s=t.data.get(n.dataId).values,u=0;u<o.length;++u){var c=o[u];c>=0?i[u]=s[u]:i[u]=s[u]*(c+1)}return t.makeTensorInfo(a.shape,"float32",i)}var QBe={kernelName:N.EluGrad,backendName:"cpu",kernelFunc:JBe};var eLe=N.backend_util.ERF_P,tLe=N.backend_util.ERF_A1,rLe=N.backend_util.ERF_A2,nLe=N.backend_util.ERF_A3,aLe=N.backend_util.ERF_A4,iLe=N.backend_util.ERF_A5,oLe=Bt(N.Erf,function(r){var e=Math.sign(r),t=Math.abs(r),n=1/(1+eLe*t);return e*(1-((((iLe*n+aLe)*n+nLe)*n+rLe)*n+tLe)*n*Math.exp(-t*t))}),sLe={kernelName:N.Erf,backendName:"cpu",kernelFunc:oLe};function om(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(N.util.assert(-(o+1)<=i,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+i+1),s.splice(u,0,1),Gt({inputs:{x:a},backend:t,attrs:{shape:s}})}var uLe={kernelName:N.ExpandDims,backendName:"cpu",kernelFunc:om};var cLe=_r(function(r,e){return r/e}),zx=Gr(N.RealDiv,cLe),Ax={kernelName:N.RealDiv,backendName:"cpu",kernelFunc:zx};function RW(r,e,t){for(var n=r.shape,a=n[0],i=n[1],o=t.data.get(r.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=N.util.sizeFromShape(c),f=N.util.getTypedArrayFromDType("float32",l),h=N.util.getTypedArrayFromDType("float32",l),p=0;p<a;p++){for(var d=yu({inputs:{x:s},backend:t,attrs:{begin:[p,0],size:[1,i]}}),m=yu({inputs:{x:u},backend:t,attrs:{begin:[p,0],size:[1,i]}}),v=ca({inputs:{real:d,imag:m},backend:t}),g=lLe(v,e,t),y=g.real,w=g.imag,b=N.backend_util.mergeRealAndImagArrays(y,w),x=0;x<i;x++){var S=N.backend_util.getComplexWithIndex(b,x);f[p*i+x]=S.real,h[p*i+x]=S.imag}t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v)}var T=t.makeTensorInfo(c,"float32",f),E=t.makeTensorInfo(c,"float32",h),C=ca({inputs:{real:T,imag:E},backend:t});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(E),C}function lLe(r,e,t){var n=N.util.sizeFromShape(r.shape),a=t.data.get(r.dataId),i=t.data.get(a.complexTensorInfos.real.dataId).values,o=t.data.get(a.complexTensorInfos.imag.dataId).values;if(fLe(n)){var s=Dx(i,o,n,e,t),u=[r.shape[0],r.shape[1]];if(e){var c=t.makeTensorInfo(u,"float32",s.real),l=t.makeTensorInfo(u,"float32",s.imag),f=t.makeTensorInfo([],"float32",N.util.createScalarValue(n,"float32")),h=Li({inputs:{x:f},backend:t}),p=Ax.kernelFunc({inputs:{a:c,b:f},backend:t}),d=Ax.kernelFunc({inputs:{a:l,b:h},backend:t}),m=t.data.get(p.dataId).values,v=t.data.get(d.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),{real:m,imag:v}}return s}else{var g=N.backend_util.mergeRealAndImagArrays(i,o),y=hLe(g,n,e);return N.backend_util.splitRealAndImagArrays(y)}}function fLe(r){return(r&r-1)===0}function Dx(r,e,t,n,a){if(t===1)return{real:r,imag:e};var i=N.backend_util.mergeRealAndImagArrays(r,e),o=t/2,s=N.backend_util.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],f=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),p=ca({inputs:{real:f,imag:h},backend:a}),d=N.backend_util.complexWithOddIndex(i),m=d.real,v=d.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),w=a.makeTensorInfo(g,"float32",v),b=ca({inputs:{real:y,imag:w},backend:a}),x=Dx(u,c,o,n,a),S=x.real,T=x.imag,E=[S.length],C=a.makeTensorInfo(E,"float32",S),R=a.makeTensorInfo(E,"float32",T),_=ca({inputs:{real:C,imag:R},backend:a}),P=Dx(m,v,o,n,a),$=P.real,z=P.imag,L=[$.length],B=a.makeTensorInfo(L,"float32",$),q=a.makeTensorInfo(L,"float32",z),Y=ca({inputs:{real:B,imag:q},backend:a}),J=N.backend_util.exponents(t,n),U=[J.real.length],j=a.makeTensorInfo(U,"float32",J.real),ne=a.makeTensorInfo(U,"float32",J.imag),re=ca({inputs:{real:j,imag:ne},backend:a}),se=um({inputs:{a:re,b:Y},backend:a}),le=Wc({inputs:{a:_,b:se},backend:a}),de=Bx({inputs:{a:_,b:se},backend:a}),ke=gu({inputs:{input:le},backend:a}),he=gu({inputs:{input:de},backend:a}),ye=qc({inputs:{input:le},backend:a}),xe=qc({inputs:{input:de},backend:a}),De=Uc({inputs:[ke,he],backend:a,attrs:{axis:0}}),Ye=Uc({inputs:[ye,xe],backend:a,attrs:{axis:0}}),ht=a.data.get(De.dataId).values,at=a.data.get(Ye.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(Y),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(ne),a.disposeIntermediateTensorInfo(re),a.disposeIntermediateTensorInfo(se),a.disposeIntermediateTensorInfo(le),a.disposeIntermediateTensorInfo(de),a.disposeIntermediateTensorInfo(ke),a.disposeIntermediateTensorInfo(ye),a.disposeIntermediateTensorInfo(he),a.disposeIntermediateTensorInfo(xe),a.disposeIntermediateTensorInfo(De),a.disposeIntermediateTensorInfo(Ye),{real:ht,imag:at}}function hLe(r,e,t){for(var n=new Float32Array(e*2),a=0;a<e;a++){for(var i=0,o=0,s=0;s<e;s++){var u=N.backend_util.exponent(a*s,e,t),c=N.backend_util.getComplexWithIndex(r,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}t&&(i/=e,o/=e),N.backend_util.assignToTypedArray(n,i,o,a)}return n}function pLe(r){var e=r.inputs,t=r.backend,n=e.input,a=N.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Gt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=RW(s,!1,t),c=Gt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var dLe={kernelName:N.FFT,backendName:"cpu",kernelFunc:pLe};function $x(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype,o=i||N.util.inferDtype(a),s=N.util.getArrayFromDType(o,N.util.sizeFromShape(n));return mLe(s,a,o),e.makeTensorInfo(n,o,s)}var vLe={kernelName:N.Fill,backendName:"cpu",kernelFunc:$x};function mLe(r,e,t){r.fill(e)}var gLe={kernelName:N.FlipLeftRight,backendName:"cpu",kernelFunc:function(r){var e=r.inputs;r.attrs;for(var t=r.backend,n=e.image,a=t,i=N.util.getTypedArrayFromDType(n.dtype,N.util.sizeFromShape(n.shape)),o=Ve(n.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],f=a.data.get(n.dataId).values,h=0;h<s;h++)for(var p=h*c*u*l,d=0;d<u;d++)for(var m=d*(c*l),v=0;v<c;v++)for(var g=v*l,y=0;y<l;y++){var w=Math.round(c-v-1),b=p+m+g+y,x=f[b];if(w>=0&&w<c){var S=w*l,T=p+m+S+y;x=f[T]}i[b]=x}var E=a.write(i,n.shape,n.dtype);return{dataId:E,shape:n.shape,dtype:n.dtype}}};function yLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=_W({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var v=m;if(l==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){var g=Gt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});m=Wc({inputs:{a:m,b:g},backend:t}),t.disposeIntermediateTensorInfo(g)}else m=Wc({inputs:{a:m,b:o},backend:t});t.disposeIntermediateTensorInfo(v)}if(p){var v=m;if(l==="NCHW"&&p==="prelu"&&s.shape.length===1&&s.shape[0]!==1){var y=Gt({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});m=im(t,m,p,y,d),t.disposeIntermediateTensorInfo(y)}else m=im(t,m,p,s,d);t.disposeIntermediateTensorInfo(v)}return m}var bLe={kernelName:N.FusedConv2D,backendName:"cpu",kernelFunc:yLe};function wLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=FW({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var v=m;m=Wc({inputs:{a:m,b:o},backend:t}),t.disposeIntermediateTensorInfo(v)}if(p){var v=m;m=im(t,m,p,s,d),t.disposeIntermediateTensorInfo(v)}return m}var xLe={kernelName:N.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:wLe};function kLe(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=N.util.sizeFromShape(n.shape),o=a.shape,s=o[o.length-1],u=Ve(N.backend_util.prepareAndValidate(n,a),4),c=u[0],l=u[1],f=u[2],h=u[3];if(l===0)return t.makeTensorInfo(c,n.dtype,[]);var p=t.data.get(a.dataId).values,d=t.bufferSync(n),m=U$(p,d,n.dtype,l,s,f,h,n.shape,i);return t.makeTensorInfo(c,n.dtype,m.values)}var SLe={kernelName:N.GatherNd,backendName:"cpu",kernelFunc:kLe};function NLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims;He([a,i],"gatherV2");for(var u=N.util.parseAxisParam(o,a.shape)[0],c=t.data.get(i.dataId).values,l=a.shape[u],f=function(S){var T=c[S];N.util.assert(T<=l-1&&T>=0,function(){return"GatherV2: the index value ".concat(T," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=s;s==null&&(p=0);var d=N.util.sizeFromShape(i.shape),m=N.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,p),v=Gt({inputs:{x:a},backend:t,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=Gt({inputs:{x:i},backend:t,attrs:{shape:[m.batchSize,d/m.batchSize]}}),y=[m.batchSize,m.outerSize,d/m.batchSize,m.sliceSize],w=t.bufferSync(g),b=t.bufferSync(v),x=V$(b,w,y);return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(m.outputShape,x.dtype,x.values)}var TLe={kernelName:N.GatherV2,backendName:"cpu",kernelFunc:NLe};function ELe(r){var e=r.inputs,t=r.backend,n=e.input,a=N.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Gt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=RW(s,!0,t),c=Gt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var ILe={kernelName:N.IFFT,backendName:"cpu",kernelFunc:ELe};var CLe=Bt(N.IsFinite,function(r){return Number.isFinite(r)?1:0},"bool"),ALe={kernelName:N.IsFinite,backendName:"cpu",kernelFunc:CLe};var DLe=Bt(N.IsInf,function(r){return Math.abs(r)===1/0?1:0},"bool"),_Le={kernelName:N.IsInf,backendName:"cpu",kernelFunc:DLe};var FLe=Bt(N.IsNan,function(r){return Number.isNaN(r)?1:0},"bool"),RLe={kernelName:N.IsNan,backendName:"cpu",kernelFunc:FLe};function OLe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=X$(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var PLe={kernelName:N.LinSpace,backendName:"cpu",kernelFunc:OLe};var MLe=Bt(N.Log1p,function(r){return Math.log1p(r)}),BLe={kernelName:N.Log1p,backendName:"cpu",kernelFunc:MLe};var LLe=_r(function(r,e){return r&&e}),zLe=Gr(N.LogicalAnd,LLe,null,"bool"),$Le={kernelName:N.LogicalAnd,backendName:"cpu",kernelFunc:zLe};var WLe=Bt(N.LogicalNot,function(r){return r?0:1},"bool"),qLe={kernelName:N.LogicalNot,backendName:"cpu",kernelFunc:WLe};var ULe=_r(function(r,e){return r||e}),VLe=Gr(N.LogicalOr,ULe,null,"bool"),GLe={kernelName:N.LogicalOr,backendName:"cpu",kernelFunc:VLe};function HLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta;He(a,"LRN");var c=a.shape[3],l=c-1,f=t.data.get(a.dataId).values,h=N.util.sizeFromShape(a.shape),p=new Float32Array(h);function d(y){for(var w=y%c,b=y-w+Math.max(0,w-i),x=y-w+Math.min(w+i,l),S=0;b<=x;b++){var T=f[b];S+=T*T}return S}for(var m=0;m<h;m++){var v=d(m),g=f[m]*Math.pow(o+s*v,-u);p[m]=g}return t.makeTensorInfo(a.shape,a.dtype,p)}var KLe={kernelName:N.LRN,backendName:"cpu",kernelFunc:HLe};function jLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta;He(o,"LRNGrad");for(var f=N.util.sizeFromShape(o.shape),h=o.shape[3],p=t.data.get(o.dataId).values,d=t.data.get(a.dataId).values,m=t.data.get(i.dataId).values,v=new Float32Array(f),g=f,y=0;y<g;y++){for(var w=y%h,b=y-w+Math.max(0,w-s),x=y-w+Math.min(h,w+s+1),S=0,T=b;T<x;T++)S+=Math.pow(d[T],2);S=c*S+u;for(var T=b;T<x;T++){var E=-2*c*l*d[T]*m[y]/S;y===T&&(E+=Math.pow(S,-l)),E*=p[y],v[T]+=E}}return t.makeTensorInfo(o.shape,a.dtype,v)}var XLe={kernelName:N.LRNGrad,backendName:"cpu",kernelFunc:jLe};function OW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=t,u=a.shape,c=u.length,l=N.util.parseAxisParam(i,u),f=l,h=N.backend_util.getAxesPermutation(f,c),p=s.data.get(a.dataId).values;if(h!=null){for(var d=new Array(c),m=0;m<d.length;m++)d[m]=u[h[m]];p=Px(p,u,a.dtype,h,d),f=N.backend_util.getInnerMostAxes(f.length,c),u=d}He(a,"max"),N.backend_util.assertAxesAreInnerMostDims("max",f,c);var v=Ve(N.backend_util.computeOutAndReduceShapes(u,f),2),g=v[0],y=v[1],w=N.util.sizeFromShape(y),b=Z$(p,w,g,a.dtype),x=s.write(b,g,a.dtype),S=g;if(o){var d=N.backend_util.expandShapeToKeepDim(g,l);S=d}return{dataId:x,shape:S,dtype:a.dtype}}var YLe={kernelName:N.Max,backendName:"cpu",kernelFunc:OW};function ZLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;He(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;N.util.assert(N.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=N.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&N.util.arraysEqual(l.inShape,l.outShape))f=Li({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=N.util.computeStrides(a.shape),d=Lx(h,a.shape,a.dtype,p,l,"max");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var JLe={kernelName:N.MaxPool,backendName:"cpu",kernelFunc:ZLe};function QLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat;He(a,"maxPool3d");var l=N.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=DW(f,a.shape,a.dtype,N.util.computeStrides(a.shape),l,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}var eze={kernelName:N.MaxPool3D,backendName:"cpu",kernelFunc:QLe};function tze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;He([a,i],"maxPool3DGrad");for(var l=N.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=t.bufferSync(i),h=U4e(f,l),p=l.strideDepth,d=l.strideHeight,m=l.strideWidth,v=l.dilationDepth,g=l.dilationHeight,y=l.dilationWidth,w=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,S=w-1-l.padInfo.front,T=x-1-l.padInfo.left,E=b-1-l.padInfo.top,C=N.buffer(i.shape,"float32"),R=t.bufferSync(a),_=0;_<l.batchSize;++_)for(var P=0;P<l.inChannels;++P)for(var $=0;$<l.inDepth;++$)for(var z=0;z<l.inHeight;++z)for(var L=0;L<l.inWidth;++L){for(var B=$-S,q=z-E,Y=L-T,J=0,U=0;U<w;U+=v){var j=(B+U)/p;if(!(j<0||j>=l.outDepth||Math.floor(j)!==j))for(var ne=0;ne<b;ne+=g){var re=(q+ne)/d;if(!(re<0||re>=l.outHeight||Math.floor(re)!==re))for(var se=0;se<x;se+=y){var le=(Y+se)/m;if(!(le<0||le>=l.outWidth||Math.floor(le)!==le)){var de=w*b*x-1-h.get(_,j,re,le,P),ke=U*b*x+ne*x+se,he=de===ke?1:0;if(he!==0){var ye=R.get(_,j,re,le,P);J+=ye*he}}}}}C.set(J,_,$,z,L,P)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}var rze={kernelName:N.MaxPool3DGrad,backendName:"cpu",kernelFunc:tze};function nze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;He([i,o],"maxPoolGrad");for(var u=n.filterSize,c=n.strides,l=n.pad,f=n.dimRoundingMode,h=N.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=t.data.get(s.dataId).values,d=N.buffer(h.outShape,s.dtype,AW(p,s.shape,s.dtype,h).values),m=h.strideHeight,v=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,w=h.effectiveFilterHeight,b=h.effectiveFilterWidth,x=b-1-h.padInfo.left,S=w-1-h.padInfo.top,T=N.buffer(s.shape,"float32"),E=t.data.get(a.dataId).values,C=N.buffer(a.shape,"float32",E),R=0;R<h.batchSize;++R)for(var _=0;_<h.inChannels;++_)for(var P=0;P<h.inHeight;++P)for(var $=0;$<h.inWidth;++$){for(var z=P-S,L=$-x,B=0,q=0;q<w;q+=g){var Y=(z+q)/m;if(!(Y<0||Y>=h.outHeight||Math.floor(Y)!==Y))for(var J=0;J<b;J+=y){var U=(L+J)/v;if(!(U<0||U>=h.outWidth||Math.floor(U)!==U)){var j=w*b-1-d.get(R,Y,U,_),ne=q*b+J,re=j===ne?1:0;if(re!==0){var se=C.get(R,Y,U,_);B+=se*re}}}}T.set(B,R,P,$,_)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}var aze={kernelName:N.MaxPoolGrad,backendName:"cpu",kernelFunc:nze};function ize(r,e,t,n,a){var i=N.util.computeStrides(e),o=Lx(r,e,t,i,a,"max"),s=AW(r,e,t,a,!0,n);return[o.values,s.values]}var oze={kernelName:N.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=n;He(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,f=N.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=Ve(ize(l,a.shape,a.dtype,u,f),2),p=h[0],d=h[1],m=c.write(p,f.outShape,a.dtype),v=c.write(d,f.outShape,a.dtype);return[{dataId:m,shape:f.outShape,dtype:a.dtype},{dataId:v,shape:f.outShape,dtype:"int32"}]}};function sze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=N.util.parseAxisParam(i,a.shape),u=N.backend_util.computeOutAndReduceShapes(a.shape,s),c=u[1],l=N.util.sizeFromShape(c),f=[],h=t.makeTensorInfo([],"float32",new Float32Array([l]));f.push(h);var p=us({inputs:{x:a},backend:t,attrs:{dtype:"float32"}});f.push(p);var d=zx({inputs:{a:p,b:h},backend:t});f.push(d);var m=vh({inputs:{x:d},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(function(v){return t.disposeIntermediateTensorInfo(v)}),m}var uze={kernelName:N.Mean,backendName:"cpu",kernelFunc:sze};function cze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;He(a,"min");var s=N.util.parseAxisParam(i,a.shape),u=s,c=N.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Mn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=N.backend_util.getInnerMostAxes(u.length,a.shape.length)),N.backend_util.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var f=Ve(N.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=N.util.sizeFromShape(p),m=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];(Number.isNaN(x)||x<w)&&(w=x)}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=N.backend_util.expandShapeToKeepDim(h,s),E=Gt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),E}return S}var lze={kernelName:N.Min,backendName:"cpu",kernelFunc:cze};function fze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode;He(a,"mirrorPad");for(var s=i.map(function(T,E){return T[0]+a.shape[E]+T[1]}),u=i.map(function(T){return T[0]}),c=i.map(function(T,E){return T[0]+a.shape[E]}),l=o==="reflect"?0:1,f=t.data.get(a.dataId).values,h=a.shape.length,p=N.util.computeStrides(a.shape),d=N.util.sizeFromShape(s),m=s.length,v=N.util.computeStrides(s),g=N.util.getTypedArrayFromDType(a.dtype,d),y=0;y<d;y++){for(var w=N.util.indexToLoc(y,m,v),b=0;b<m;b++)w[b]<u[b]?w[b]=u[b]*2-w[b]-l:w[b]>=c[b]&&(w[b]=(c[b]-1)*2-w[b]+l);w=w.map(function(T,E){return T-u[E]});var x=N.util.locToIndex(w,h,p);g[y]=f[x]}var S=t.write(g,s,a.dtype);return{dataId:S,shape:s,dtype:a.dtype}}var hze={kernelName:N.MirrorPad,backendName:"cpu",kernelFunc:fze};var pze=_r(function(r,e){var t=r%e;return r<0&&e<0||r>=0&&e>=0?t:(t+e)%e}),dze=Gr(N.Mod,pze),vze={kernelName:N.Mod,backendName:"cpu",kernelFunc:dze};function PW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=a.shape.length,s=i;if(s===-1&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=N.util.parseAxisParam([s],a.shape),c=OW({inputs:{x:a},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),l=N.backend_util.expandShapeToKeepDim(c.shape,u),f=Gt({inputs:{x:c},backend:t,attrs:{shape:l}}),h=Bx({inputs:{a,b:f},backend:t}),p=z$({inputs:{x:h},backend:t}),d=vh({inputs:{x:p},backend:t,attrs:{axis:u,keepDims:!1}}),m=Gt({inputs:{x:d},backend:t,attrs:{shape:l}}),v=zx({inputs:{a:p,b:m},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var mze={kernelName:N.Softmax,backendName:"cpu",kernelFunc:PW};function gze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized;He(a,"multinomial");for(var u=s?a:PW({inputs:{logits:a},backend:t,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],f=t.data.get(u.dataId).values,h=[c,i],p=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),"int32"),d=0;d<c;++d){var m=d*l,v=new Float32Array(l-1);v[0]=f[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+f[m+g];for(var y=GPe.alea(o.toString()),w=d*i,b=0;b<i;++b){var x=y();p[w+b]=v.length;for(var g=0;g<v.length;g++)if(x<v[g]){p[w+b]=g;break}}}return s||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(h,"int32",p)}var yze={kernelName:N.Multinomial,backendName:"cpu",kernelFunc:gze};var bze=N.kernel_impls.nonMaxSuppressionV3Impl;function wze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold;He(a,"NonMaxSuppression");var c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=bze(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var xze={kernelName:N.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:wze};var kze=N.kernel_impls.nonMaxSuppressionV4Impl;function Sze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.padToMaxOutputSize;He(a,"NonMaxSuppressionPadded");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=kze(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var Nze={kernelName:N.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:Sze};var Tze=N.kernel_impls.nonMaxSuppressionV5Impl;function Eze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.softNmsSigma;He(a,"NonMaxSuppressionWithScore");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=o,p=s,d=u,m=c,v=Tze(l,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var Ize={kernelName:N.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:Eze};function Cze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue;He(a,"oneHot");var c=N.util.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var f=t.data.get(a.dataId).values,h=0;h<c;++h)f[h]>=0&&f[h]<o&&(l[h*o+f[h]]=s);return t.makeTensorInfo(xa(xa([],Ve(a.shape),!1),[o],!1),i,l)}var Aze={kernelName:N.OneHot,backendName:"cpu",kernelFunc:Cze};function sm(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){var a=gu({inputs:{input:n},backend:t}),i=sm({inputs:{x:a},backend:t}),o=qc({inputs:{input:n},backend:t}),s=sm({inputs:{x:o},backend:t}),u=ca({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return $x({backend:t,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}var Dze={kernelName:N.ZerosLike,backendName:"cpu",kernelFunc:sm};function MW(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){var a=gu({inputs:{input:n},backend:t}),i=MW({inputs:{x:a},backend:t}),o=qc({inputs:{input:n},backend:t}),s=sm({inputs:{x:o},backend:t}),u=ca({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return $x({backend:t,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}var _ze={kernelName:N.OnesLike,backendName:"cpu",kernelFunc:MW};function BW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return om({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){N.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),N.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=om({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=Uc({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var Fze={kernelName:N.Pack,backendName:"cpu",kernelFunc:BW};function Rze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;He(a,"pad");var s=i.map(function(S,T){return S[0]+a.shape[T]+S[1]}),u=i.map(function(S){return S[0]}),c=t.data.get(a.dataId).values,l=N.util.sizeFromShape(a.shape),f=a.shape.length,h=N.util.computeStrides(a.shape),p=N.util.sizeFromShape(s),d=s.length,m=N.util.computeStrides(s),v=N.util.getTypedArrayFromDType(a.dtype,p);o!==0&&v.fill(o);for(var g=0;g<l;g++){var y=N.util.indexToLoc(g,f,h),w=y.map(function(S,T){return S+u[T]}),b=N.util.locToIndex(w,d,m);v[b]=c[g]}var x=t.write(v,s,a.dtype);return{dataId:x,shape:s,dtype:a.dtype}}var LW={kernelName:N.PadV2,backendName:"cpu",kernelFunc:Rze};var Oze=_r(function(r,e){return Math.pow(r,e)}),Pze=Gr(N.Pow,Oze),Mze={kernelName:N.Pow,backendName:"cpu",kernelFunc:Pze};function Bze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.data.get(g.dataId).values}),u=a.map(function(g){return g.shape}),c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values,f=Ve(nW(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var Lze={kernelName:N.RaggedGather,backendName:"cpu",kernelFunc:Bze};function zze(r){var e=r.inputs,t=r.backend,n=e.starts,a=e.limits,i=e.deltas,o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Ve(aW(o,n.shape,n.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],n.dtype,f);return[h,p]}var $ze={kernelName:N.RaggedRange,backendName:"cpu",kernelFunc:zze};function Wze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,h=s.map(function(g){return t.data.get(g.dataId).values}),p=s.map(function(g){return g.shape}),d=Ve(iW(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var qze={kernelName:N.RaggedTensorToTensor,backendName:"cpu",kernelFunc:Wze};function Uze(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.dtype,o=t.step,s=oW(n,a,o,i);return e.makeTensorInfo([s.length],i,s)}var Vze={kernelName:N.Range,backendName:"cpu",kernelFunc:Uze};var Gze=Bt(N.Reciprocal,function(r){return 1/r}),Hze={kernelName:N.Reciprocal,backendName:"cpu",kernelFunc:Gze};function Kze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;He(a,"resizeBilinear");for(var u=N.util.computeStrides(a.shape),c=Ve(s,2),l=c[0],f=c[1],h=Ve(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(N.util.sizeFromShape([p,l,f,v])),w=[i&&l>1?d-1:d,i&&f>1?m-1:m],b=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=0,S=w[0]/b[0],T=w[1]/b[1],E=0;E<p;E++)for(var C=0;C<l;C++){var R=void 0;o?R=S*(C+.5)-.5:R=S*C;for(var _=Math.max(0,Math.floor(R)),P=R-_,$=Math.min(d-1,Math.ceil(R)),z=E*u[0]+_*u[1],L=E*u[0]+$*u[1],B=0;B<f;B++){var q=void 0;o?q=T*(B+.5)-.5:q=T*B;for(var Y=Math.max(0,Math.floor(q)),J=q-Y,U=Math.min(m-1,Math.ceil(q)),j=z+Y*u[2],ne=L+Y*u[2],re=z+U*u[2],se=L+U*u[2],le=0;le<v;le++){var de=g[j+le],ke=g[ne+le],he=g[re+le],ye=g[se+le],xe=de+(he-de)*J,De=ke+(ye-ke)*J,Ye=xe+(De-xe)*P;y[x++]=Ye}}}return t.makeTensorInfo([p,l,f,v],"float32",y)}var jze={kernelName:N.ResizeBilinear,backendName:"cpu",kernelFunc:Kze};function Xze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;He([i,a],"resizeBilinearGrad");for(var s=N.util.computeStrides(a.shape),u=Ve(a.shape,4),c=u[0],l=u[1],f=u[2],h=u[3],p=Ve(i.shape,3),d=p[1],m=p[2],v=new Float32Array(c*l*f*h),g=[o&&d>1?l-1:l,o&&m>1?f-1:f],y=[o&&d>1?d-1:d,o&&m>1?m-1:m],w=g[0]/y[0],b=g[1]/y[1],x=t.data.get(i.dataId).values,S=0,T=0;T<c;T++)for(var E=T*s[0],C=0;C<d;C++)for(var R=C*w,_=Math.floor(R),P=Math.min(Math.ceil(R),l-1),$=E+_*s[1],z=E+P*s[1],L=R-_,B=1-L,q=0;q<m;q++)for(var Y=q*b,J=Math.floor(Y),U=Math.min(Math.ceil(Y),f-1),j=Y-J,ne=1-j,re=$+J*s[2],se=$+U*s[2],le=z+J*s[2],de=z+U*s[2],ke=B*ne,he=B*j,ye=L*ne,xe=L*j,De=0;De<h;De++){var Ye=x[S++];v[re+De]+=Ye*ke,v[se+De]+=Ye*he,v[le+De]+=Ye*ye,v[de+De]+=Ye*xe}return t.makeTensorInfo([c,f,l,h],"float32",v)}var Yze={kernelName:N.ResizeBilinearGrad,backendName:"cpu",kernelFunc:Xze};function Zze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;He(a,"resizeNearestNeighbor");for(var u=N.util.computeStrides(a.shape),c=Ve(s,2),l=c[0],f=c[1],h=Ve(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(p*l*f*v),w=[i&&l>1?d-1:d,i&&f>1?m-1:m],b=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=w[0]/b[0],S=w[1]/b[1],T=0,E=0;E<p;E++)for(var C=E*u[0],R=0;R<l;R++){var _=o?x*(R+.5):x*R,P=Math.min(d-1,i?Math.round(_):Math.floor(_));o&&(P=Math.max(0,P));for(var $=C+P*u[1],z=0;z<f;z++){var L=o?S*(z+.5):S*z,B=Math.min(m-1,i?Math.round(L):Math.floor(L));o&&(B=Math.max(0,B));for(var q=$+B*u[2],Y=0;Y<v;Y++){var J=g[q+Y];y[T++]=J}}}return t.makeTensorInfo([p,l,f,v],a.dtype,y)}var Jze={kernelName:N.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:Zze};function Qze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;He([i,a],"resizeNearestNeighborGrad");for(var s=N.util.computeStrides(a.shape),u=N.util.computeStrides(i.shape),c=Ve(a.shape,4),l=c[0],f=c[1],h=c[2],p=c[3],d=Ve(i.shape,3),m=d[1],v=d[2],g=new Float32Array(l*f*h*p),y=t.data.get(i.dataId).values,w=[o&&m>1?f-1:f,o&&v>1?h-1:h],b=[o&&m>1?m-1:m,o&&v>1?v-1:v],x=w[0]/b[0],S=w[1]/b[1],T=1/x,E=1/S,C=Math.ceil(T)*2+2,R=Math.ceil(E)*2+2,_=0;_<l;_++)for(var P=_*s[0],$=0;$<f;$++)for(var z=P+$*s[1],L=Math.floor($*T),B=Math.floor(L-C/2),q=0;q<h;q++)for(var Y=z+q*s[2],J=Math.floor(q*E),U=Math.floor(J-R/2),j=0;j<p;j++){for(var ne=0,re=0;re<C;re++){var se=re+B;if(!(se<0||se>=m)){var le=P+se*u[1],de=se*x,ke=Math.min(f-1,o?Math.round(de):Math.floor(de));if($===ke)for(var he=0;he<R;he++){var ye=he+U;if(!(ye<0||ye>=v)){var xe=le+ye*u[2],De=ye*S,Ye=Math.min(h-1,o?Math.round(De):Math.floor(De));q===Ye&&(ne+=y[xe+j])}}}}g[Y+j]=ne}return t.makeTensorInfo(a.shape,a.dtype,g)}var e$e={kernelName:N.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:Qze};function t$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims;He(a,"reverse");var o=a.shape.length,s=N.util.parseAxisParam(i,a.shape);if(o===0)return Li({inputs:{x:a},backend:t});for(var u=new N.TensorBuffer(a.shape,a.dtype),c=t.bufferSync(a),l=function(h){var p=u.indexToLoc(h),d=p.slice();s.forEach(function(m){return d[m]=a.shape[m]-1-d[m]}),u.set.apply(u,xa([c.get.apply(c,xa([],Ve(d),!1))],Ve(p),!1))},f=0;f<u.size;f++)l(f);return t.makeTensorInfo(u.shape,u.dtype,u.values)}var r$e={kernelName:N.Reverse,backendName:"cpu",kernelFunc:t$e},n$e={kernelName:N.RotateWithOffset,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,c=N.util.getTypedArrayFromDType(a.dtype,N.util.sizeFromShape(a.shape)),l=Ve(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Ve(N.backend_util.getImageCenter(s,h,p),2),v=m[0],g=m[1],y=255,w=Math.sin(i),b=Math.cos(i),x=u.data.get(a.dataId).values,S=0;S<f;S++)for(var T=S*p*h*d,E=0;E<h;E++)for(var C=E*(p*d),R=0;R<p;R++)for(var _=R*d,P=0;P<d;P++){var $=[f,E,R,P],z=$[2],L=$[1],B=(z-v)*b-(L-g)*w,q=(z-v)*w+(L-g)*b;B=Math.round(B+v),q=Math.round(q+g);var Y=o;if(typeof o!="number"&&(P===3?Y=y:Y=o[P]),B>=0&&B<p&&q>=0&&q<h){var J=q*(p*d),U=B*d,j=T+J+U+P;Y=x[j]}var ne=T+C+_+P;c[ne]=Y}var re=u.write(c,a.shape,a.dtype);return{dataId:re,shape:a.shape,dtype:a.dtype}}};var a$e=Bt(N.Round,function(r){var e=Math.floor(r);return r-e<.5?Math.floor(r):r-e>.5?Math.ceil(r):e%2===0?e:e+1}),i$e={kernelName:N.Round,backendName:"cpu",kernelFunc:a$e};function o$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=N.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=!0,d=t.bufferSync(a),m=t.bufferSync(i),v=mu(d,m,o,h,l,c,u,f,0,p);return t.makeTensorInfo(o,v.dtype,v.values)}var s$e={kernelName:N.ScatterNd,backendName:"cpu",kernelFunc:o$e};function u$e(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<e?t=a+1:n=a;return n}function c$e(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<=e?t=a+1:n=a;return n}function l$e(r,e,t,n,a,i){for(var o=N.util.getArrayFromDType("int32",t*a),s=0;s<t;++s)for(var u=r.slice(s*n,(s+1)*n),c=s*a,l=0;l<a;++l)o[c+l]=i==="left"?u$e(u,e[l+c]):c$e(u,e[l+c]);return o}function f$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=l$e(s,u,a.shape[0],a.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",c)}var h$e={kernelName:N.SearchSorted,backendName:"cpu",kernelFunc:f$e};function p$e(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e;He([n,a,i],"select");for(var o=n.shape.length,s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=N.upcastType(a.dtype,i.dtype),f=N.util.makeZerosTypedArray(N.util.sizeFromShape(a.shape),l),h=0,p=o===0||o>1||a.shape.length===1?1:N.util.sizeFromShape(a.shape.slice(1)),d=0;d<s.length;d++)for(var m=0;m<p;m++)s[d]===1?f[h++]=u[d]:f[h++]=c[d];return t.makeTensorInfo(a.shape,l,f)}var d$e={kernelName:N.Select,backendName:"cpu",kernelFunc:p$e};var v$e=N.backend_util.SELU_SCALEALPHA,m$e=N.backend_util.SELU_SCALE,g$e=Bt(N.Selu,function(r){return r>=0?m$e*r:v$e*(Math.exp(r)-1)}),y$e={kernelName:N.Selu,backendName:"cpu",kernelFunc:g$e};var b$e=Bt(N.Sign,function(r){return r<0?-1:r>0?1:0}),w$e={kernelName:N.Sign,backendName:"cpu",kernelFunc:b$e};var x$e=Bt(N.Sin,function(r){return Math.sin(r)}),k$e={kernelName:N.Sin,backendName:"cpu",kernelFunc:x$e};var S$e=Bt(N.Sinh,function(r){return Math.sinh(r)}),N$e={kernelName:N.Sinh,backendName:"cpu",kernelFunc:S$e};var T$e=11920928955078125e-23,T$=Math.log(T$e)+2,E$e=Bt(N.Softplus,function(r){var e=r>-T$,t=r<T$,n=Math.exp(r),a;return t?a=n:e?a=r:a=Math.log(1+n),a}),I$e={kernelName:N.Softplus,backendName:"cpu",kernelFunc:E$e};function C$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;He([a],"spaceToBatchND");var s=N.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,xa([],Ve(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=LW.kernelFunc({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),f=N.backend_util.getReshaped(l.shape,i,s,!1),h=N.backend_util.getPermuted(f.length,i.length,!1),p=N.backend_util.getReshapedPermuted(l.shape,i,s,!1),d={x:l},m={shape:f},v=Gt({inputs:d,backend:t,attrs:m}),g={x:v},y={perm:h},w=Mn({inputs:g,backend:t,attrs:y}),b={x:w},x={shape:p},S=Gt({inputs:b,backend:t,attrs:x});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),S}var A$e={kernelName:N.SpaceToBatchND,backendName:"cpu",kernelFunc:C$e};function D$e(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        `.concat(i.shape));if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],f=Ve(lW(s,n.shape,n.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var _$e={kernelName:N.SparseFillEmptyRows,backendName:"cpu",kernelFunc:D$e};function F$e(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        `.concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.data.get(a.dataId).values),s=t.data.get(n.dataId).values,u=Array.from(t.data.get(i.dataId).values),c=Ve(fW(s,n.shape,n.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,n.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var R$e={kernelName:N.SparseReshape,backendName:"cpu",kernelFunc:F$e};function O$e(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Ve(Mx(o,n.shape,n.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var P$e={kernelName:N.SparseSegmentMean,backendName:"cpu",kernelFunc:O$e};function M$e(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Ve(Mx(o,n.shape,n.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var B$e={kernelName:N.SparseSegmentSum,backendName:"cpu",kernelFunc:M$e};function L$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=N.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1,m=t.bufferSync(a),v;switch(i.dtype){case"bool":{var g=t.bufferSync(i),y=Boolean(t.data.get(o.dataId).values[0]);v=mu(m,g,s,p,f,l,c,h,y,d);break}case"float32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=mu(m,g,s,p,f,l,c,h,y,d);break}case"int32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=mu(m,g,s,p,f,l,c,h,y,d);break}case"string":{var g=t.bufferSync(i),y=N.util.decodeString(t.data.get(o.dataId).values[0]);v=mu(m,g,s,p,f,l,c,h,y,d);break}default:throw new Error("Unsupported type ".concat(i.dtype))}return t.makeTensorInfo(s,v.dtype,v.values)}var z$e={kernelName:N.SparseToDense,backendName:"cpu",kernelFunc:L$e};function $$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=N.util.parseAxisParam(o,a.shape)[0],u=N.backend_util.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map(function(f){var h=xa([],Ve(l),!1);h[s]=f;var p=yu({inputs:{x:a},backend:t,attrs:{begin:c,size:h}});return c[s]+=f,p})}var W$e={kernelName:N.SplitV,backendName:"cpu",kernelFunc:$$e};var q$e={kernelName:N.Square,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,a=t;He(n,"square");for(var i=a.data.get(n.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}var c=a.write(o,n.shape,n.dtype);return{dataId:c,shape:n.shape,dtype:n.dtype}}};var U$e=Bt(N.Step,function(r,e){var t=e;return isNaN(r)?NaN:r>0?1:t.alpha}),V$e={kernelName:N.Step,backendName:"cpu",kernelFunc:U$e};function G$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,c=n.endMask,l=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask;He(a,"stridedSlice");var p=N.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,w=p.begin,b=p.end,x=p.strides,S;if(v)S=Gt({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){N.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=N.slice_util.computeOutShape(w,b,x),E=yu({inputs:{x:a},backend:t,attrs:{begin:w,size:T}});S=Gt({inputs:{x:E},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.bufferSync(a),R=dW(d,C,x,w);S=t.makeTensorInfo(m,R.dtype,R.values)}return S}var H$e={kernelName:N.StridedSlice,backendName:"cpu",kernelFunc:G$e};function K$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,c=n.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.data.get(l.dataId).values,p=t.data.get(f.dataId).values,d=Ve(vW(h,p,a,i,o,s,u,c),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var j$e={kernelName:N.StringNGrams,backendName:"cpu",kernelFunc:K$e};function X$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],c=Ve(mW(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var Y$e={kernelName:N.StringSplit,backendName:"cpu",kernelFunc:X$e};function Z$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.data.get(i.dataId).values,s=gW(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var J$e={kernelName:N.StringToHashBucketFast,backendName:"cpu",kernelFunc:Z$e};var Q$e=Bt(N.Tan,function(r){return Math.tan(r)}),eWe={kernelName:N.Tan,backendName:"cpu",kernelFunc:Q$e};var tWe=Bt(N.Tanh,function(r){return Math.tanh(r)}),rWe={kernelName:N.Tanh,backendName:"cpu",kernelFunc:tWe};function nWe(r){var e=r.inputs,t=r.backend,n=e.tensor,a=e.indices,i=e.updates,o=N.backend_util.calculateShapes(i,a,n.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,f=o.outputSize,h=!1,p=t.bufferSync(a),d=t.bufferSync(i),m=t.bufferSync(n),v=mu(p,d,n.shape,f,c,u,s,l,m,h);return t.makeTensorInfo(n.shape,v.dtype,v.values)}var aWe={kernelName:N.TensorScatterUpdate,backendName:"cpu",kernelFunc:nWe};function iWe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;He(a,"tile");var o=bW(t.bufferSync(a),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}var oWe={kernelName:N.Tile,backendName:"cpu",kernelFunc:iWe};function sWe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted;He(a,"topk");var s=t.data.get(a.dataId).values,u=Ve(xW(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}var uWe={kernelName:N.TopK,backendName:"cpu",kernelFunc:sWe};function cWe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=e.transforms,o=t.interpolation,s=t.fillMode,u=t.fillValue,c=t.outputShape,l=Ve(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Ve(c??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],w=N.util.computeStrides(a.shape),b=w[0],x=w[1],S=w[2],T=N.util.computeStrides(y),E=T[0],C=T[1],R=T[2],_=N.util.getTypedArrayFromDType(a.dtype,N.util.sizeFromShape(y));_.fill(u);for(var P=n.data.get(a.dataId).values,$=n.data.get(i.dataId).values,z=0;z<f;++z){for(var L=i.shape[0]===1?$:$.subarray(z*8,z*8+8),B=0;B<v;++B)for(var q=0;q<g;++q)for(var Y=0;Y<d;++Y){var J=void 0,U=L[6]*q+L[7]*B+1;if(U!==0){var j=(L[0]*q+L[1]*B+L[2])/U,ne=(L[3]*q+L[4]*B+L[5])/U,re=E$(j,p,s),se=E$(ne,h,s);switch(o){case"nearest":J=vWe(P,h,p,b,x,S,z,se,re,Y,u);break;case"bilinear":J=mWe(P,h,p,b,x,S,z,se,re,Y,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}var le=z*E+B*C+q*R+Y;_[le]=J}}return n.makeTensorInfo(y,a.dtype,_)}var de=n.write(_,y,a.dtype);return{dataId:de,shape:a.shape,dtype:a.dtype}}var lWe={kernelName:N.Transform,backendName:"cpu",kernelFunc:cWe};function E$(r,e,t){switch(t){case"reflect":return fWe(r,e);case"wrap":return hWe(r,e);case"nearest":return dWe(r,e);case"constant":default:return pWe(r)}}function fWe(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=2*e;t<n&&(t=n*Math.trunc(-t/n)+t),t=t<-e?t+n:-t-1}else if(t>e-1)if(e<=1)t=0;else{var n=2*e;t-=n*Math.trunc(t/n),t>=e&&(t=n-t-1)}return N.util.clamp(0,t,e-1)}function hWe(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=e-1;t+=e*(Math.trunc(-t/n)+1)}else if(t>e-1)if(e<=1)t=0;else{var n=e-1;t-=e*Math.trunc(t/n)}return N.util.clamp(0,t,e-1)}function pWe(r,e){return r}function dWe(r,e){return N.util.clamp(0,r,e-1)}function dh(r,e,t,n,a,i,o,s,u,c,l){var f=o*n+s*a+u*i+c;return 0<=s&&s<e&&0<=u&&u<t?r[f]:l}function vWe(r,e,t,n,a,i,o,s,u,c,l){var f=Math.round(s),h=Math.round(u);return dh(r,e,t,n,a,i,o,f,h,c,l)}function mWe(r,e,t,n,a,i,o,s,u,c,l){var f=Math.floor(s),h=Math.floor(u),p=f+1,d=h+1,m=(d-u)*dh(r,e,t,n,a,i,o,f,h,c,l)+(u-h)*dh(r,e,t,n,a,i,o,f,d,c,l),v=(d-u)*dh(r,e,t,n,a,i,o,p,h,c,l)+(u-h)*dh(r,e,t,n,a,i,o,p,d,c,l);return(p-s)*m+(s-f)*v}function gWe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;He(i,"unique");var o=n.data.get(i.dataId).values,s=kW(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([l.length],"int32",l)]}var yWe={kernelName:N.Unique,backendName:"cpu",kernelFunc:gWe};function bWe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var f=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var p=new Array(s),l=0;l<p.length;l++){f[i]=l;var d=yu({inputs:{x:a},backend:t,attrs:{begin:f,size:h}});p[l]=Gt({inputs:{x:d},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(d)}return p}var wWe={kernelName:N.Unpack,backendName:"cpu",kernelFunc:bWe};function xWe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments;He(a,"unsortedSegmentSum");for(var s=a.shape.length,u=i.shape.length,c=[],l=[],f=s-u,h=i,p=0;p<f;++p){var d=om({inputs:{input:h},backend:t,attrs:{dim:p+1}});h=d,l.push(d)}for(var p=0;p<o;++p){var m=N.util.createScalarValue(p,"int32"),v=t.makeTensorInfo([],"int32",m),g=B$({inputs:{a:v,b:h},backend:t}),y=us({inputs:{x:g},backend:t,attrs:{dtype:"float32"}}),w=um({inputs:{a:y,b:a},backend:t}),b=vh({inputs:{x:w},backend:t,attrs:{axis:0,keepDims:!1}});c.push(b),l.push(v),l.push(g),l.push(y),l.push(w),l.push(b)}var x=BW({inputs:c,backend:t,attrs:{axis:0}});return l.forEach(function(S){return t.disposeIntermediateTensorInfo(S)}),x}var kWe={kernelName:N.UnsortedSegmentSum,backendName:"cpu",kernelFunc:xWe},Ix,I$,SWe=[g4e,XPe,b4e,x4e,tMe,S4e,T4e,I4e,A4e,_4e,R4e,P4e,B4e,$4e,q4e,G4e,K4e,X4e,Z4e,v4e,Q4e,tBe,nBe,nMe,iBe,QPe,iMe,sBe,YPe,cBe,fBe,hBe,dBe,mBe,yBe,wBe,kBe,NBe,EBe,CBe,DBe,FBe,OBe,MBe,BBe,zBe,WBe,UBe,VBe,GBe,HBe,jBe,ZBe,u4e,QBe,oMe,sLe,sMe,uLe,cMe,dLe,vLe,gLe,fMe,pMe,bLe,xLe,SLe,TLe,vMe,gMe,ZPe,ILe,lBe,ALe,_Le,RLe,c4e,bMe,xMe,PLe,SMe,BLe,$Le,qLe,GLe,KLe,XLe,YLe,TMe,JLe,eze,rze,aze,oze,uze,lze,IMe,hze,vze,yze,AMe,_Me,xze,Nze,Ize,RMe,Aze,_ze,Fze,LW,Mze,f4e,MMe,Lze,$ze,qze,Vze,JPe,Ax,Hze,h4e,p4e,d4e,jze,Yze,Jze,e$e,r$e,n$e,i$e,GMe,s$e,h$e,d$e,y$e,KMe,w$e,k$e,N$e,jMe,mze,I$e,A$e,_$e,R$e,P$e,B$e,z$e,W$e,ZMe,q$e,QMe,t4e,V$e,H$e,j$e,Y$e,J$e,i4e,XBe,eWe,rWe,aWe,oWe,uWe,lWe,OMe,yWe,wWe,kWe,Dze];try{for(hh=$c(SWe),zc=hh.next();!zc.done;zc=hh.next())C$=zc.value,N.registerKernel(C$)}catch(r){Ix={error:r}}finally{try{zc&&!zc.done&&(I$=hh.return)&&I$.call(hh)}finally{if(Ix)throw Ix.error}}var C$,hh,zc;cm.MathBackendCPU=_x;cm.shared=o4e;cm.version_cpu=s4e});var GU=X(vo=>{"use strict";var k=Ls();function NWe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var TWe=NWe(k),Ux=function(r,e){return Ux=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Ux(r,e)};function EWe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ux(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Hc(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Kc(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Nn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function mr(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var wu={},lm={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function mq(r,e){wu[r]=e}function Ti(r,e){if(!(r in wu)||e!=null){var t=CWe(r,e);if(t!==null)wu[r]=t;else return console.log("Could not get context for WebGL version",r),null}var n=wu[r];return n==null||n.isContextLost()?(delete wu[r],Ti(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),wu[r])}function IWe(r){if(!k.env().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function CWe(r,e){if(r!==1&&r!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=e??IWe(r);return t.addEventListener("webglcontextlost",function(n){n.preventDefault(),delete wu[r]},!1),k.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(lm.failIfMajorPerformanceCaveat=!1),r===1?t.getContext("webgl",lm)||t.getContext("experimental-webgl",lm):t.getContext("webgl2",lm)}var kh;(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(kh||(kh={}));var ka;(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(ka||(ka={}));var cn;(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(cn||(cn={}));function Ih(r,e){return[e,r]}function AWe(r,e){return r*e}function fm(r){var e=k.util.sizeFromShape(r),t=Math.ceil(e/4);return k.util.sizeToSquarishShape(t)}function jc(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function DWe(r,e){var t=Te(jc(r,e),2),n=t[0],a=t[1];return n*a*4}function Zx(r,e){var t=r,n,a,i,o,s,u,c,l,f,h;return k.env().getNumber("WEBGL_VERSION")===2?(n=t.R32F,a=t.R16F,i=t.RGBA16F,o=t.RGBA32F,s=t.RED,c=4,l=1,f=t.HALF_FLOAT,h=t.FLOAT,u=t.RGBA8):(n=r.RGBA,a=r.RGBA,i=r.RGBA,o=t.RGBA,s=r.RGBA,c=4,l=4,f=e!=null?e.HALF_FLOAT_OES:null,h=r.FLOAT,u=r.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:h}}function Pe(r,e){var t=e();return k.env().getBool("DEBUG")&&_We(r),t}function _We(r){var e=r.getError();if(e!==r.NO_ERROR)throw new Error("WebGL Error: "+yq(r,e))}var FWe=596e-10,RWe=65504;function gq(r){return!!(k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||FWe<Math.abs(r)&&Math.abs(r)<RWe)}function yq(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(e)}}function gh(r,e){return ho(r,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function bq(r,e){var t=ho(r,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Pe(r,function(){return r.shaderSource(t,e)}),Pe(r,function(){return r.compileShader(t)}),r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function wq(r,e){var t=ho(r,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Pe(r,function(){return r.shaderSource(t,e)}),Pe(r,function(){return r.compileShader(t)}),k.env().get("ENGINE_COMPILE_ONLY"))return t;if(r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw Jx(e,r.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var OWe=/ERROR: [0-9]+:([0-9]+):/g;function Jx(r,e){var t=OWe.exec(e);if(t==null){console.log("Couldn't parse line number in error: ".concat(e)),console.log(r);return}for(var n=+t[1],a=r.split(`
`),i=a.length.toString().length+2,o=a.map(function(h,p){return k.util.rightPad((p+1).toString(),i)+h}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,n-1),l=o.slice(n-1,n),f=o.slice(n);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c ".concat(k.util.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function xq(r){return ho(r,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function kq(r,e){if(Pe(r,function(){return r.linkProgram(e)}),!k.env().get("ENGINE_COMPILE_ONLY")&&r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function vm(r,e){if(Pe(r,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Sq(r,e){var t=ho(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Pe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),Pe(r,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function Nq(r,e){var t=ho(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Pe(r,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t)}),Pe(r,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function PWe(){return k.env().getNumber("WEBGL_VERSION")===2?1:4}function Tq(r){return ho(r,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function Eq(r,e){var t=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="[".concat(r,"x").concat(e,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t){var n="[".concat(r,"x").concat(e,"]"),a="[".concat(t,"x").concat(t,"]");throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+a+".")}}function Iq(r){return ho(r,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Vx(r,e,t,n,a,i,o){var s=r.getAttribLocation(e,t);return s===-1?!1:(Pe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Pe(r,function(){return r.vertexAttribPointer(s,a,r.FLOAT,!1,i,o)}),Pe(r,function(){return r.enableVertexAttribArray(s)}),!0)}function Cq(r,e,t){Rq(r,t),Pe(r,function(){return r.activeTexture(r.TEXTURE0+t)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function MWe(r,e){Rq(r,e),Pe(r,function(){return r.activeTexture(r.TEXTURE0+e)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function Aq(r,e,t){return ho(r,function(){return r.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function Dq(r,e,t){return r.getUniformLocation(e,t)}function _q(r,e,t,n){Pe(r,function(){return Cq(r,e,n)}),Pe(r,function(){return r.uniform1i(t,n)})}function BWe(r){Pe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),Pe(r,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),Pe(r,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})}function mm(r,e,t){Pe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),Pe(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function Gx(r,e){Pe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),Pe(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function yh(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Fq(r,e))}function Fq(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(e)}}function ho(r,e,t){var n=Pe(r,function(){return e()});if(n==null)throw new Error(t);return n}function Rq(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t){var a="[gl.TEXTURE0, gl.TEXTURE".concat(t,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function xu(r,e){return e===void 0&&(e=2),k.util.sizeFromShape(r.slice(0,r.length-e))}function ku(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function bh(r){var e=[1,1,1],t=r.length===0||r.length===1&&r[0]===1;return t||(e=mr([xu(r)],Te(ku(r)),!1)),e}function Oq(r,e){var t;e===void 0&&(e=!1);var n=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=k.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(a===1/0&&k.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=n/2),e&&(n=n*2,a=a*2,r=r.map(function(h,p){return p>=r.length-2?k.util.nearestLargerEven(r[p]):r[p]}),r.length===1&&(r=[2,r[0]])),r.length!==2){var i=k.util.squeezeShape(r);r=i.newShape}var o=k.util.sizeFromShape(r),s=null;r.length<=1&&o<=n?s=[1,o]:r.length===2&&r[0]<=n&&r[1]<=n?s=r:r.length===3&&r[0]*r[1]<=n&&r[2]<=n?s=[r[0]*r[1],r[2]]:r.length===3&&r[0]<=n&&r[1]*r[2]<=n?s=[r[0],r[1]*r[2]]:r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n?s=[r[0]*r[1]*r[2],r[3]]:r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n&&(s=[r[0],r[1]*r[2]*r[3]]);var u=s!=null&&Math.max.apply(Math,mr([],Te(s),!1))>a&&Math.min.apply(Math,mr([],Te(s),!1))<=(e?2:1)&&Math.min.apply(Math,mr([],Te(s),!1))>0;if(s==null||u)if(e){var c=xu(r),l=2,f=2;r.length&&(t=Te(ku(r),2),l=t[0],f=t[1]),o=c*(l/2)*(f/2),s=k.util.sizeToSquarishShape(o).map(function(h){return h*2})}else s=k.util.sizeToSquarishShape(o);return s}function hm(r){return r%2===0}function Sh(r,e){if(r=r.slice(-2),e=e.slice(-2),k.util.arraysEqual(r,e)||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r[r.length-1],n=e[e.length-1];if(t===n||hm(t)&&hm(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&hm(r[0])&&hm(e[0])}var gm,ym;function Pq(r){if(gm==null){var e=Ti(r);gm=e.getParameter(e.MAX_TEXTURE_SIZE)}return gm}function LWe(){gm=null}function zWe(){ym=null}function Mq(r){if(ym==null){var e=Ti(r);ym=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ym)}function Bq(r){if(r===0)return 0;var e,t=Ti(r);return Sa(t,"EXT_disjoint_timer_query_webgl2")&&r===2?e=2:Sa(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Sa(r,e){var t=r.getExtension(e);return t!=null}function Hx(r){try{var e=Ti(r);if(e!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function Lq(r){if(r===0)return!1;var e=Ti(r);if(r===1){if(!Sa(e,"OES_texture_float"))return!1}else if(!Sa(e,"EXT_color_buffer_float"))return!1;var t=Kx(e);return t}function zq(r){if(r===0)return!1;var e=Ti(r);if(r===1){if(!Sa(e,"OES_texture_float")||!Sa(e,"WEBGL_color_buffer_float"))return!1}else{if(Sa(e,"EXT_color_buffer_float"))return Kx(e);var t="EXT_color_buffer_half_float";if(Sa(e,t)){var n=e.getExtension(t);return $We(e,n)}return!1}var a=Kx(e);return a}function Kx(r){var e=Zx(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);var n=1,a=1;r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,n,a,0,e.textureFormatFloat,e.textureTypeFloat,null);var i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(i),o}function $We(r,e){var t=Zx(r,e),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);var a=1,i=1;r.texImage2D(r.TEXTURE_2D,0,t.internalFormatHalfFloat,a,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);var s=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(o),s}function $q(r){if(r!==2)return!1;var e=Ti(r),t=e.fenceSync!=null;return t}function Xc(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&k.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors ")+"in the WebGL backend."})})}var WWe={__proto__:null,assertNotComplex:Xc,bindCanvasToFramebuffer:BWe,bindColorTextureToFramebuffer:mm,bindTextureToProgramUniformSampler:_q,bindTextureUnit:Cq,bindVertexBufferToProgramAttribute:Vx,callAndCheck:Pe,canBeRepresented:gq,createFragmentShader:wq,createFramebuffer:Iq,createProgram:xq,createStaticIndexBuffer:Nq,createStaticVertexBuffer:Sq,createTexture:Tq,createVertexShader:bq,getBatchDim:xu,getExtensionOrThrow:gh,getFramebufferErrorMessage:Fq,getMaxTexturesInShader:Mq,getNumChannels:PWe,getProgramUniformLocation:Dq,getProgramUniformLocationOrThrow:Aq,getRowsCols:ku,getShapeAs3D:bh,getTextureShapeFromLogicalShape:Oq,getWebGLDisjointQueryTimerVersion:Bq,getWebGLErrorMessage:yq,getWebGLMaxTextureSize:Pq,hasExtension:Sa,isCapableOfRenderingToFloatTexture:Lq,isDownloadFloatTextureEnabled:zq,isReshapeFree:Sh,isWebGLFenceEnabled:$q,isWebGLVersionEnabled:Hx,linkProgram:kq,logShaderSourceAndInfoLog:Jx,resetMaxTextureSize:LWe,resetMaxTexturesInShader:zWe,unbindColorTextureFromFramebuffer:Gx,unbindTextureUnit:MWe,validateFramebuffer:yh,validateProgram:vm,validateTextureSize:Eq};var je=k.env();je.registerFlag("HAS_WEBGL",function(){return je.getNumber("WEBGL_VERSION")>0});je.registerFlag("WEBGL_VERSION",function(){return Hx(2)?2:Hx(1)?1:0});je.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1});je.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return je.get("WEBGL_VERSION")===2});je.registerFlag("WEBGL_CPU_FORWARD",function(){return!0});je.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1});je.registerFlag("WEBGL_PACK",function(){return je.getBool("HAS_WEBGL")});je.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_PACK_CLIP",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_PACK_REDUCE",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_LAZILY_UNPACK",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_CONV_IM2COL",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",function(){return je.getBool("WEBGL_PACK")});je.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Pq(je.getNumber("WEBGL_VERSION"))});je.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return Mq(je.getNumber("WEBGL_VERSION"))});je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=je.getNumber("WEBGL_VERSION");return r===0?0:Bq(r)});je.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return je.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!k.device_util.isMobile()});je.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return Lq(je.getNumber("WEBGL_VERSION"))});je.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return je.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:je.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")});je.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return zq(je.getNumber("WEBGL_VERSION"))});je.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return $q(je.getNumber("WEBGL_VERSION"))});je.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){var r=je.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return r?4:0});je.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(r){if(typeof r!="number")throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but "+"got ".concat(r,"."));if(r<0&&r!==-1)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(r,"."))});je.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return k.device_util.isMobile()?1:-1},function(r){if(typeof r!="number")throw new Error("WEBGL_FLUSH_THRESHOLD must be a number but got "+"".concat(r,"."));if(r<0&&r!==-1)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(r,"."))});je.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",function(){return 128});je.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",function(){return!1});je.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",function(){return 1e5});je.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",function(){return 128});je.registerFlag("WEBGL_EXP_CONV",function(){return!1});je.registerFlag("SOFTWARE_WEBGL_ENABLED",function(){return je.getBool("IS_TEST")});je.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",function(){return 1/0});je.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",function(){return!1});je.registerFlag("WEBGL2_ISNAN_CUSTOM",function(){return!1});je.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});function En(){var r,e,t,n,a,i,o,s,u,c;return k.env().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=k.env().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Nu(r,e,t){t===void 0&&(t="index");var n=k.util.computeStrides(e);return n.map(function(a,i){var o="int ".concat(r[i]," = ").concat(t," / ").concat(a),s=i===n.length-1?"int ".concat(r[i+1]," = ").concat(t," - ").concat(r[i]," * ").concat(a):"index -= ".concat(r[i]," * ").concat(a);return"".concat(o,"; ").concat(s,";")}).join("")}function Nm(r,e,t){t===void 0&&(t="index");var n=k.util.computeStrides(e);return n.map(function(a,i){var o="int ".concat(r[i]," = ").concat(t," / outShapeStrides[").concat(i,"]"),s=i===n.length-1?"int ".concat(r[i+1]," = ").concat(t," - ").concat(r[i]," * outShapeStrides[").concat(i,"]"):"index -= ".concat(r[i]," * outShapeStrides[").concat(i,"]");return"".concat(o,"; ").concat(s,";")}).join("")}function qWe(r,e){var t=r.length,n=r.map(function(o){return"".concat(e,"[").concat(o,"]")}),a=new Array(t-1);a[t-2]=n[t-1];for(var i=t-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(n[i+1],")");return a}function UWe(r,e,t){t===void 0&&(t="index");var n=r.map(function(i,o){return o}),a=qWe(n,e);return a.map(function(i,o){var s="int ".concat(r[o]," = ").concat(t," / ").concat(a[o]),u=o===a.length-1?"int ".concat(r[o+1]," = ").concat(t," - ").concat(r[o]," * ").concat(a[o]):"index -= ".concat(r[o]," * ").concat(a[o]);return"".concat(s,"; ").concat(u,";")}).join("")}function Qx(r){var e=k.util.computeStrides(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `.concat(e[0]," + coords.y * ").concat(e[1],` + coords.z;
  }
`)}function ek(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var Wq=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,qq=k.backend_util.getBroadcastDims;function VWe(r,e,t){var n=[];if(r.forEach(function(p){var d=k.util.sizeFromShape(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?n.push("uniform float ".concat(p.name).concat(d>1?"[".concat(d,"]"):"",";")):(n.push("uniform sampler2D ".concat(p.name,";")),n.push("uniform int offset".concat(p.name,";"))),t.enableShapeUniforms){var m=tk(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape).uniformShape;switch(m.length){case 1:n.push("uniform int ".concat(p.name,"Shape;"));break;case 2:n.push("uniform ivec2 ".concat(p.name,"Shape;"));break;case 3:n.push("uniform ivec3 ".concat(p.name,"Shape;"));break;case 4:n.push("uniform ivec4 ".concat(p.name,"Shape;"));break}n.push("uniform ivec2 ".concat(p.name,"TexShape;"))}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break}n.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(function(p){n.push("uniform ".concat(p.type," ").concat(p.name).concat(p.arrayIndex?"[".concat(p.arrayIndex,"]"):"",";"))});var a=n.join(`
`),i=r.map(function(p){return GWe(p,e,t.packedInputs,t.enableShapeUniforms)}).join(`
`),o=e.texShape,s=En(),u=jWe(s),c,l,f=ZWe(s);e.isPacked?(c=HWe(e.logicalShape,o,t.enableShapeUniforms),l=YWe(s)):(c=KWe(e.logicalShape,o,t.enableShapeUniforms),l=XWe(s)),t.packedInputs&&(f+=tqe);var h=[f,u,l,a,c,i,t.userCode].join(`
`);return h}function Yc(r,e){e===void 0&&(e=!1);var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return pqe(r,e);case 1:return vqe(r,e);case 2:return gqe(r,e);case 3:return bqe(r,e);case 4:return xqe(r,e);case 5:return kqe(r);case 6:return Sqe(r);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function Uq(r,e){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return hqe(r);case 1:return dqe(r,e);case 2:return mqe(r,e);case 3:return yqe(r,e);default:return wqe(r,e)}}function GWe(r,e,t,n){t===void 0&&(t=!1);var a="";t?a+=Uq(r,n):a+=Yc(r,n);var i=r.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?a+=Nqe(r,e):a+=Tqe(r,e)),a}function HWe(r,e,t){switch(r.length){case 0:return Vq();case 1:return rqe(r,e,t);case 2:return lqe(r,e,t);case 3:return aqe(r,e,t);default:return oqe(r,e,t)}}function KWe(r,e,t){switch(r.length){case 0:return Vq();case 1:return nqe(r,e,t);case 2:return fqe(r,e,t);case 3:return iqe(r,e,t);case 4:return sqe(r,e,t);case 5:return uqe(r,e);case 6:return cqe(r,e);default:throw new Error("".concat(r.length,"-D output sampling is not yet supported"))}}function jWe(r){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `.concat(r.texture2D,`(textureSampler, uv).r;
    }
  `)}function XWe(r){return`
    void setOutput(float val) {
      `.concat(r.output,` = vec4(val, 0, 0, 0);
    }
  `)}function YWe(r){return`
    void setOutput(vec4 val) {
      `.concat(r.output,` = val;
    }
  `)}function ZWe(r){var e="".concat(r.version,`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `).concat(r.varyingFs,` vec2 resultUV;
    `).concat(r.defineOutput,`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `).concat(r.defineSpecialNaN,`
    `).concat(r.defineSpecialInf,`
    `).concat(r.defineRound,`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `).concat(JWe,`
    `).concat(QWe,`
    `).concat(eqe,`
  `);return e}var JWe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,QWe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,eqe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,tqe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Vq(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function rqe(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `.concat(n[1],`.0);
      }
    `):n[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `.concat(n[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));
      return 2 * (resTexRC.x * `).concat(n[1],` + resTexRC.y);
    }
  `)}function nqe(r,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * `.concat(e[1],`.0);
      }
    `):e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * `.concat(e[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      return resTexRC.x * `).concat(e[1],` + resTexRC.y;
    }
  `)}function aqe(r,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[2]/2),i=a*Math.ceil(r[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));
      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec3(b, r, c);
    }
  `)}function iqe(r,e,t){if(t){var n=Nm(["r","c","d"],r);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    `.concat(n,`
    return ivec3(r, c, d);
  }
`)}var a=Nu(["r","c","d"],r);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec3(r, c, d);
    }
  `)}function oqe(r,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[r.length-1]/2),i=a*Math.ceil(r[r.length-2]/2),o=i,s="",u="b, r, c",c=2;c<r.length-1;c++)o*=r[r.length-c-1],s=`
      int b`.concat(c," = index / ").concat(o,`;
      index -= b`).concat(c," * ").concat(o,`;
    `)+s,u="b".concat(c,", ")+u;return`
    ivec`.concat(r.length,` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`).concat(n[0],", ").concat(n[1],`));
      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;

      `).concat(s,`

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec`).concat(r.length,"(").concat(u,`);
    }
  `)}function sqe(r,e,t){if(t){var n=Nm(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      `.concat(n,`
      return ivec4(r, c, d, d2);
    }
  `)}var a=Nu(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec4(r, c, d, d2);
    }
  `)}function uqe(r,e){var t=Nu(["r","c","d","d2","d3"],r);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`.concat(e[0],`,
                             `).concat(e[1],`));

      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `)}function cqe(r,e){var t=Nu(["r","c","d","d2","d3","d4"],r);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `)}function lqe(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(k.util.arraysEqual(r,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`.concat(n[0],", ").concat(n[1],`));
      }
    `);var a=Math.ceil(r[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));

      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;
      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec2(r, c);
    }
  `)}function fqe(r,e,t){return k.util.arraysEqual(r,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`.concat(e[0],", ").concat(e[1],`));
      }
    `):r[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(index, 0);
      }
    `):r[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(0, index);
      }
    `):t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      int r = index / `).concat(r[1],`;
      int c = index - r * `).concat(r[1],`;
      return ivec2(r, c);
    }
  `)}function Tu(r){return"offset".concat(r)}function hqe(r){var e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=En();return`
    vec4 `.concat(t,`() {
      return `).concat(n.texture2D,"(").concat(e,`, halfCR);
    }
  `)}function pqe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var a=Te(r.shapeInfo.texShape,2),i=a[0],o=a[1];if(i===1&&o===1)return`
      float `.concat(n,`() {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=Tu(t);if(e)return`
    float `.concat(n,`() {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `);var u=Te(r.shapeInfo.texShape,2),c=u[0],l=u[1];return`
    float `.concat(n,`() {
      vec2 uv = uvFromFlat(`).concat(c,", ").concat(l,", ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function dqe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=r.shapeInfo.texShape,i=En();if(e)return`
    vec4 `.concat(n,`(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `);var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `.concat(n,`(int index) {
      vec2 uv = packedUVfrom1D(
        `).concat(o[0],", ").concat(o[1],`, index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `)}function vqe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int index) {
        `).concat(Zc(r),`
      }
    `);var a=r.shapeInfo.texShape,i=a[0],o=a[1];if(o===1&&i===1)return`
      float `.concat(n,`(int index) {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=Tu(t);return o===1?e?`
      float `.concat(n,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[0]));
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(n,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / ").concat(i,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):i===1?e?`
      float `.concat(n,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(n,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / ").concat(o,`.0, 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):e?`
    float `.concat(n,`(int index) {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `):`
    float `.concat(n,`(int index) {
      vec2 uv = uvFromFlat(`).concat(i,", ").concat(o,", index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function mqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=i[0],s=i[1],u=En();if(i!=null&&k.util.arraysEqual(t,i))return e?`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);

        return `).concat(u.texture2D,"(").concat(n,`, uv);
      }
    `):`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);

        return `).concat(u.texture2D,"(").concat(n,`, uv);
      }
    `);if(e)return`
    vec4 `.concat(a,`(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(n,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return `).concat(u.texture2D,"(").concat(n,`, uv);
    }
  `);var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int row, int col) {
      vec2 uv = packedUVfrom2D(`).concat(l,", ").concat(c[0],", ").concat(c[1],`, row, col);
      return `).concat(u.texture2D,"(").concat(n,`, uv);
    }
  `)}function gqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape;if(i!=null&&k.util.arraysEqual(t,i)){if(e)return`
      float `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);var o=i[0],s=i[1];return`
    float `.concat(a,`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `)}var u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims,f=c;if(f.length<t.length){var h=Jc(r,f),p=["row","col"];return`
      `.concat(Yc(h,e),`
      float `).concat(a,`(int row, int col) {
        return `).concat(a,"(").concat(Qc(p,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`).concat(t[1],`, 1)));
        `).concat(Zc(r),`
      }
    `);var d=i[0],m=i[1],v=Tu(n);return m===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(n,`Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(`).concat(n,`TexShape[0]));
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `).concat(d,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):d===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(n,`Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(`).concat(n,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `).concat(m,`.0, 0.5);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):e?`
      float `.concat(a,`(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(n,"Shape[1] + col + ").concat(v,`;
        vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,`TexShape[1], index);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
  float `.concat(a,`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `).concat(t[1]," + col + ").concat(v,`;
    vec2 uv = uvFromFlat(`).concat(d,", ").concat(m,`, index);
    return sampleTexture(`).concat(n,`, uv);
  }
`)}function yqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){var s=t.slice(1),u=[1,2],c=Jc(r,s),l=["b","row","col"];return`
        `.concat(Uq(c,e),`
        vec4 `).concat(a,`(int b, int row, int col) {
          return `).concat(a,"(").concat(Qc(l,u),`);
        }
      `)}var f=En();if(e)return`
    vec4 `.concat(a,`(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(n,`Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(n,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return `).concat(f.texture2D,"(").concat(n,`, uv);
    }
  `);var h=o[0],p=o[1],d=Math.ceil(t[2]/2),m=d*Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `).concat(h,", ").concat(p,", ").concat(m,", ").concat(d,`, b, row, col);
      return `).concat(f.texture2D,"(").concat(n,`, uv);
    }
  `)}function bqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],o=t[2],s=k.util.squeezeShape(t),u=s.newShape,c=s.keptDims,l=u;if(l.length<t.length){var f=Jc(r,l),h=["row","col","depth"];return`
        `.concat(Yc(f,e),`
        float `).concat(a,`(int row, int col, int depth) {
          return `).concat(a,"(").concat(Qc(h,c),`);
        }
      `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`).concat(i,", ").concat(o,`, 1)));
        `).concat(Zc(r),`
      }
    `);var p=r.shapeInfo.texShape,d=p[0],m=p[1],v=r.shapeInfo.flatOffset;if(m===i&&v==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        int stride1 = `).concat(n,`Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
        float `.concat(a,`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`).concat(o,`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`).concat(m,".0, ").concat(d,`.0);
          return sampleTexture(`).concat(n,`, uv);
        }
      `);if(m===o&&v==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(`).concat(n,`Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`).concat(t[1],`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(m,".0, ").concat(d,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `);var g=Tu(n);return e?`
    float `.concat(a,`(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = `).concat(n,"Shape[1] * ").concat(n,`Shape[2];
      int stride1 = `).concat(n,`Shape[2];
      int index = row * stride0 + col * stride1 + depth + `).concat(g,`;
      vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,`TexShape[1], index);
      return sampleTexture(`).concat(n,`, uv);
    }
    `):`
      float `.concat(a,`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(i," + col * ").concat(o," + depth + ").concat(g,`;
        vec2 uv = uvFromFlat(`).concat(d,", ").concat(m,`, index);
        return sampleTexture(`).concat(n,`, uv);
      }
  `)}function wqe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=En();if(e)return`
    vec4 `.concat(n,`(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(`).concat(t,`Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(t,`Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= `).concat(t,`Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `);for(var i=r.shapeInfo.logicalShape,o=i.length,s=r.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],f=Math.ceil(i[o-1]/2),h=f*Math.ceil(i[o-2]/2),p="int b, int row, int col",d="b * ".concat(h," + (row / 2) * ").concat(f," + (col / 2)"),m=2;m<o-1;m++)p="int b".concat(m,", ")+p,h*=i[o-m-1],d="b".concat(m," * ").concat(h," + ")+d;return`
    vec4 `.concat(n,"(").concat(p,`) {
      int index = `).concat(d,`;
      int texR = index / `).concat(l,`;
      int texC = index - texR * `).concat(l,`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(l,", ").concat(c,`);
      return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `)}function xqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],o=t[2]*i,s=t[1]*o,u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var f=Jc(r,c),h=["row","col","depth","depth2"];return`
      `.concat(Yc(f,e),`
      float `).concat(a,`(int row, int col, int depth, int depth2) {
        return `).concat(a,"(").concat(Qc(h,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`).concat(s,", ").concat(o,", ").concat(i,`, 1)));
        `).concat(Zc(r),`
      }
    `);var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1],g="int stride2 = ".concat(n,"Shape[3];"),y="int stride1 = ".concat(n,"Shape[2] * stride2;"),w="int stride0 = ".concat(n,"Shape[1] * stride1;");if(v===s&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        `).concat(g,`
        `).concat(y,`
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`).concat(o,", ").concat(i,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);if(v===i&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(n,"Shape[1] * ").concat(n,"Shape[2], ").concat(n,`Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(t[1]*t[2],", ").concat(t[2],`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);var b=Tu(n);return e?`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      `).concat(g,`
      `).concat(y,`
      `).concat(w,`
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(b,`);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o,` +
          depth * `).concat(i,` + depth2;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(v,", index + ").concat(b,`);
      return sampleTexture(`).concat(n,`, uv);
    }
  `)}function kqe(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=e[4],i=e[3]*a,o=e[2]*i,s=e[1]*o,u=k.util.squeezeShape(e),c=u.newShape,l=u.keptDims;if(c.length<e.length){var f=Jc(r,c),h=["row","col","depth","depth2","depth3"];return`
      `.concat(Yc(f),`
      float `).concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        return `).concat(n,"(").concat(Qc(h,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(s,", ").concat(o,", ").concat(i,", ").concat(a,`)) +
          depth3;
        `).concat(Zc(r),`
      }
    `);var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1];if(v===s&&p==null)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`).concat(o,", ").concat(i,", ").concat(a,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(v===a&&p==null)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3],`,
               `).concat(e[2]*e[3],", ").concat(e[3],`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var g=Tu(t);return`
    float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o," + depth * ").concat(i,` +
          depth2 * `).concat(a," + depth3 + ").concat(g,`;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(v,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function Sqe(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=k.util.squeezeShape(e),i=a.newShape,o=a.keptDims;if(i.length<e.length){var s=Jc(r,i),u=["row","col","depth","depth2","depth3","depth4"];return`
      `.concat(Yc(s),`
      float `).concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `).concat(n,"(").concat(Qc(u,o),`);
      }
    `)}var c=e[5],l=e[4]*c,f=e[3]*l,h=e[2]*f,p=e[1]*h;if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(p,", ").concat(h,", ").concat(f,", ").concat(l,`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`).concat(c,`, 1)));
        `).concat(Zc(r),`
      }
    `);var d=r.shapeInfo.flatOffset,m=r.shapeInfo.texShape,v=m[0],g=m[1];if(g===p&&d==null)return`
      float `.concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`).concat(h,", ").concat(f,", ").concat(l,", ").concat(c,`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(g,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(g===c&&d==null)return`
      float `.concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3]*e[4],`,
               `).concat(e[2]*e[3]*e[4],`,
               `).concat(e[3]*e[4],`,
               `).concat(e[4],`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(g,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var y=Tu(t);return`
    float `.concat(n,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(p," + col * ").concat(h," + depth * ").concat(f,` +
          depth2 * `).concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,`;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(g,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function Zc(r){var e=r.name,t=k.util.sizeFromShape(r.shapeInfo.logicalShape);return t<2?"return ".concat(e,";"):`
    for (int i = 0; i < `.concat(t,`; i++) {
      if (i == index) {
        return `).concat(e,`[i];
      }
    }
  `)}function Nqe(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=r.shapeInfo.logicalShape.length,o=e.logicalShape.length,s=qq(r.shapeInfo.logicalShape,e.logicalShape),u=$t(o),c=o-i,l,f=["x","y","z","w","u","v"];i===0?l="":o<2&&s.length>=1?l="coords = 0;":l=s.map(function(b){return"coords.".concat(f[b+c]," = 0;")}).join(`
`);var h="";o<2&&i>0?h="coords":h=r.shapeInfo.logicalShape.map(function(b,x){return"coords.".concat(f[x+c])}).join(", ");var p="return outputValue;",d=k.util.sizeFromShape(r.shapeInfo.logicalShape),m=d===1,v=k.util.sizeFromShape(e.logicalShape),g=v===1;if(i===1&&!m&&!g)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!g)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(s.length){var y=i-2,w=i-1;s.indexOf(y)>-1&&s.indexOf(w)>-1?p="return vec4(outputValue.x);":s.indexOf(y)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(w)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `.concat(a,`() {
      `).concat(u,` coords = getOutputCoords();
      `).concat(l,`
      vec4 outputValue = get`).concat(n,"(").concat(h,`);
      `).concat(p,`
    }
  `)}function Tqe(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=e.texShape,o=r.shapeInfo.texShape,s=r.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!r.shapeInfo.isUniform&&s===u&&r.shapeInfo.flatOffset==null&&k.util.arraysEqual(o,i))return`
      float `.concat(a,`() {
        return sampleTexture(`).concat(t,`, resultUV);
      }
    `);var c=$t(u),l=qq(r.shapeInfo.logicalShape,e.logicalShape),f=u-s,h,p=["x","y","z","w","u","v"];s===0?h="":u<2&&l.length>=1?h="coords = 0;":h=l.map(function(m){return"coords.".concat(p[m+f]," = 0;")}).join(`
`);var d="";return u<2&&s>0?d="coords":d=r.shapeInfo.logicalShape.map(function(m,v){return"coords.".concat(p[v+f])}).join(", "),`
    float `.concat(a,`() {
      `).concat(c,` coords = getOutputCoords();
      `).concat(h,`
      return get`).concat(n,"(").concat(d,`);
    }
  `)}function $t(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank ".concat(r," is not yet supported"))}function tk(r,e,t){var n=k.util.squeezeShape(e),a=n.newShape,i=n.keptDims,o=e.length,s=r&&o===3&&e[0]===1,u=s?e.slice(1):a,c=!r&&o>1&&!k.util.arraysEqual(e,t)&&a.length<o||s,l=c?u:e;return{useSqueezeShape:c,uniformShape:l,keptDims:i}}function Jc(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function Qc(r,e){return e.map(function(t){return r[t]}).join(", ")}function Eqe(r,e,t,n){var a=t.map(function(l,f){var h={logicalShape:l.shape,texShape:l.isUniform?null:l.texData.texShape,isUniform:l.isUniform,isPacked:l.isUniform?!1:l.texData.isPacked,flatOffset:null};return l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0&&(h.flatOffset=l.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:h}}),i=a.map(function(l){return l.shapeInfo}),o={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},s=VWe(a,o,e),u=wq(r.gl,s),c=r.createProgram(u);return k.env().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(r.buildVao(c),Object.assign({program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},Gq(r,e,c)))}function Gq(r,e,t){var n,a,i,o,s=[],u=[],c,l,f,h=null,p=null;p=r.getUniformLocation(t,"NAN",!1),k.env().getNumber("WEBGL_VERSION")===1&&(h=r.getUniformLocation(t,"INFINITY",!1));var d=!1;try{for(var m=Nn(e.variableNames),v=m.next();!v.done;v=m.next()){var g=v.value,y={name:g,uniform:r.getUniformLocation(t,g,d),offset:r.getUniformLocation(t,"offset".concat(g),d)};e.enableShapeUniforms&&(y.shape=r.getUniformLocation(t,"".concat(g,"Shape"),d),y.texShape=r.getUniformLocation(t,"".concat(g,"TexShape"),d)),s.push(y)}}catch(S){n={error:S}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}if(e.enableShapeUniforms&&(c=r.getUniformLocation(t,"outShape",d),f=r.getUniformLocation(t,"outShapeStrides",d),l=r.getUniformLocation(t,"outTexShape",d)),e.customUniforms)try{for(var w=Nn(e.customUniforms),b=w.next();!b.done;b=w.next()){var x=b.value;u.push(r.getUniformLocation(t,x.name,d))}}catch(S){i={error:S}}finally{try{b&&!b.done&&(o=w.return)&&o.call(w)}finally{if(i)throw i.error}}return{variablesLocations:s,customUniformLocations:u,infLoc:h,nanLoc:p,outShapeLocation:c,outShapeStridesLocation:f,outTexShapeLocation:l}}function $W(r,e){if(r.length!==e.length)throw Error("Binary was compiled with ".concat(r.length," inputs, but ")+"was executed with ".concat(e.length," inputs"));r.forEach(function(t,n){var a=t.logicalShape,i=e[n],o=i.shape;if(!k.util.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!(t.isUniform&&i.isUniform)){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!k.util.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(u," must match"))}})}function Iqe(r,e,t,n,a){e.program.enableShapeUniforms||($W(e.inShapeInfos,t),$W([e.outShapeInfo],[n]));var i=n.texData.texture,o=n.texData.texShape;n.texData.isPacked?r.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):r.setOutputMatrixTexture(i.texture,o[0],o[1]),r.setProgram(e.webGLProgram),r.bindVertexArray(e.webGLProgram.vao),k.env().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&r.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&r.gl.uniform1f(e.nanLoc,NaN);for(var s=0;s<t.length;++s){var u=t[s],c=e.variablesLocations[s],l=c.uniform,f=c.offset,h=c.shape,p=c.texShape;if(h){var d=tk(e.program.packedInputs,u.shape,u.texData.texShape).uniformShape;switch(d.length){case 1:r.gl.uniform1iv(h,new Int32Array(d));break;case 2:r.gl.uniform2iv(h,new Int32Array(d));break;case 3:r.gl.uniform3iv(h,new Int32Array(d));break;case 4:r.gl.uniform4iv(h,new Int32Array(d));break}}if(p&&r.gl.uniform2i(p,u.texData.texShape[0],u.texData.texShape[1]),l!=null){if(u.isUniform){if(k.util.sizeFromShape(u.shape)<2)r.gl.uniform1f(l,u.uniformValues[0]);else{var m=u.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),r.gl.uniform1fv(l,m)}continue}u.texData.slice!=null&&f!=null&&r.gl.uniform1i(f,u.texData.slice.flatOffset),r.setInputMatrixTexture(u.texData.texture.texture,l,s)}}var v=e.outShapeLocation;if(v)switch(n.shape.length){case 1:r.gl.uniform1iv(v,new Int32Array(n.shape));break;case 2:r.gl.uniform2iv(v,new Int32Array(n.shape));break;case 3:r.gl.uniform3iv(v,new Int32Array(n.shape));break;case 4:r.gl.uniform4iv(v,new Int32Array(n.shape));break}if(e.outShapeStridesLocation){var g=k.util.computeStrides(n.shape);switch(n.shape.length){case 2:r.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(g));break;case 3:r.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(g));break;case 4:r.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(g));break}}if(e.outTexShapeLocation&&r.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&a)for(var s=0;s<e.program.customUniforms.length;++s){var y=e.program.customUniforms[s],w=e.customUniformLocations[s],b=a[s];if(y.type==="float")r.gl.uniform1fv(w,b);else if(y.type==="vec2")r.gl.uniform2fv(w,b);else if(y.type==="vec3")r.gl.uniform3fv(w,b);else if(y.type==="vec4")r.gl.uniform4fv(w,b);else if(y.type==="int")r.gl.uniform1iv(w,b);else if(y.type==="ivec2")r.gl.uniform2iv(w,b);else if(y.type==="ivec3")r.gl.uniform3iv(w,b);else if(y.type==="ivec4")r.gl.uniform4iv(w,b);else throw Error("uniform type ".concat(y.type," is not supported yet."))}r.executeProgram()}function Cqe(r,e,t){var n="";e.concat(t).forEach(function(o){var s=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(r.enableShapeUniforms&&!o.isUniform){var u=o.texData.texShape,c=tk(r.packedInputs,o.shape,u),l=c.useSqueezeShape,f=c.uniformShape,h=c.keptDims,p="",d="",m="";if(f.length===1&&r.packedInputs){var v=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p="".concat(v[0]>1,"_").concat(v[1]>1)}else if(f.length===2&&!r.packedInputs)d="".concat(f[0]>1,"_").concat(f[1]>1);else if(f.length>2&&!r.packedInputs){var g=k.util.computeStrides(f);m="".concat(g[0]===u[1],"_").concat(g[g.length-1]===u[1])}var y=o.shape.length,w=f.length===2&&k.util.arraysEqual(o.shape,u),b=k.util.sizeFromShape(o.shape)===1,x=k.backend_util.getBroadcastDims(o.shape,t.shape),S=!r.packedInputs&&y===t.shape.length&&k.util.arraysEqual(u,t.texData.texShape),T=r.packedInputs||f.length>2?"":"".concat(u[0]>1,"_").concat(u[1]>1);n+="".concat(y,"_").concat(S,"_").concat(l?h:"","_").concat(f.length,"_").concat(b,"_").concat(x,"_").concat(w,"_").concat(p,"_").concat(d,"_").concat(m,"_").concat(T,"_").concat(s)}else{var E=o.isUniform?"uniform":o.texData.texShape;n+="".concat(o.shape,"_").concat(E,"_").concat(s)}});var a=r.userCode,i=r.constructor.name;return i+="_"+n+"_"+a+"".concat(k.env().getNumber("WEBGL_VERSION")),i}function vn(r){return k.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&r<=4}var Aqe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=kh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=En();this.outputShape=e,this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?Nm(["r","c","d"],e):Nu(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `).concat(t.output,` = result;
      }
    `)}return r}();var Dqe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=kh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=En();this.outputShape=e,this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?Nm(["r","c","d"],e):Nu(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `).concat(t.output,` = result;
      }
    `)}return r}();var _qe=function(){function r(e){this.variableNames=["A"],this.outTexUsage=ka.DOWNLOAD;var t=En();this.outputShape=e,this.userCode=`
      `.concat(Wq,`

      void main() {
        float x = getAAtOutCoords();
        `).concat(t.output,` = encode_float(x);
      }
    `)}return r}();var Fqe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ka.DOWNLOAD;var t=En();this.outputShape=e,this.userCode=`
      `.concat(Wq,`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `).concat(t.output,` = encode_float(x);
      }
    `)}return r}();var Rqe={R:0,G:1,B:2,A:3},WW=function(){function r(e,t,n){t===void 0&&(t=!1),n===void 0&&(n="RGBA"),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=En();this.outputShape=e,this.enableShapeUniforms=vn(this.outputShape.length);var i="result";t&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<n.length;s++){var u=n[s];o+=`
          if(offset == `.concat(s,`) {
            result = values[`).concat(Rqe[u],`];
          }`)}this.userCode=`
      `.concat(this.enableShapeUniforms?ek():Qx(e),`

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, `).concat(n.length,`);

        flatIndex = idiv(flatIndex, `).concat(n.length,`, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = `).concat(a.texture2D,`(A, uv);
          `).concat(o,`
        }
        `).concat(a.output," = vec4(").concat(i,`, 0., 0., 0.);
      }
    `)}return r}();var Oqe=function(){function r(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=En();this.outputShape=e,this.enableShapeUniforms=vn(this.outputShape.length);var a="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=o*2+s;a+=`
          localCoords = coords;
          if(localCoords[2] + `.concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),`) {
          localCoords[2] += `).concat(s,`;
          if (localCoords[1] + `).concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),`) {
            localCoords[1] += `).concat(o,`;

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = `).concat(n.texture2D,`(A, uv);

            if (offset == 0) {
              result[`).concat(u,`] = values[0];
            } else if (offset == 1) {
              result[`).concat(u,`] = values[1];
            } else if (offset == 2) {
              result[`).concat(u,`] = values[2];
            } else {
              result[`).concat(u,`] = values[3];
            }
          }
        }
        `)}this.userCode=`
        `.concat(this.enableShapeUniforms?ek():Qx(e),`

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          `).concat(a,`

          `).concat(n.output," = ").concat(i,`;
        }
    `)}return r}();function Hq(r){var e=En(),t="".concat(e.version,`
    precision highp float;
    `).concat(e.attribute,` vec3 clipSpacePos;
    `).concat(e.attribute,` vec2 uv;
    `).concat(e.varyingVs,` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`);return bq(r,t)}function Kq(r){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Sq(r,e)}function jq(r){var e=new Uint16Array([0,1,2,2,1,3]);return Nq(r,e)}function Ch(r,e,t,n,a,i){Eq(e,t);var o=Tq(r),s=r.TEXTURE_2D;return Pe(r,function(){return r.bindTexture(s,o)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_MAG_FILTER,r.NEAREST)}),k.env().getNumber("WEBGL_VERSION")===1?Pe(r,function(){return r.texImage2D(s,0,n,e,t,0,a,i,null)}):Pe(r,function(){return r.texStorage2D(s,1,n,e,t)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)}),{texture:o,texShape:[t,e]}}function rk(r){return r.internalFormatFloat}function Xq(r,e,t,n){var a=Te(Ih(e,t),2),i=a[0],o=a[1];return Ch(r,i,o,rk(n),n.textureFormatFloat,r.FLOAT)}function nk(r){return r.internalFormatHalfFloat}function Yq(r,e,t,n){var a=Te(Ih(e,t),2),i=a[0],o=a[1];return Ch(r,i,o,nk(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function ak(r){return r.downloadTextureFormat}function Zq(r,e,t,n){var a=Te(Ih(e,t),2),i=a[0],o=a[1];return Ch(r,i,o,ak(n),r.RGBA,r.UNSIGNED_BYTE)}function ik(r){return r.internalFormatPackedFloat}function Jq(r,e,t,n){var a=Te(jc(e,t),2),i=a[0],o=a[1];return Ch(r,i,o,ik(n),r.RGBA,r.FLOAT)}function ok(r){return r.internalFormatPackedHalfFloat}function Qq(r,e,t,n){var a=Te(jc(e,t),2),i=a[0],o=a[1];return Ch(r,i,o,ok(n),r.RGBA,n.textureTypeHalfFloat)}function eU(r,e,t){var n=0,a=3*4,i=3*4+2*4;Pe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)});var o=Vx(r,e,"clipSpacePos",t,3,i,n);return o&&Vx(r,e,"uv",t,2,i,a)}function tU(r,e,t,n,a,i){Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)});var o,s,u;a instanceof Uint8Array?(o=new Uint8Array(t*n*4),s=r.UNSIGNED_BYTE,u=r.RGBA):(o=new Float32Array(t*n*4),s=r.FLOAT,u=i.internalFormatPackedFloat),o.set(a),k.env().getNumber("WEBGL_VERSION")===2?Pe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t,n,r.RGBA,s,o)}):Pe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,u,t,n,0,r.RGBA,s,o)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function rU(r,e,t){Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)}),t.data instanceof Uint8Array?k.env().getNumber("WEBGL_VERSION")===2?Pe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,t.data)}):Pe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t.data)}):k.env().getNumber("WEBGL_VERSION")===2?Pe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,t)}):Pe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function nU(r,e,t,n){var a=r.createBuffer();Pe(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var i=4,o=4,s=i*o*e*t;return Pe(r,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,s,r.STREAM_READ)}),Pe(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,0)}),Pe(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function aU(r,e,t){var n=r,a=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,a),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),a}function iU(r,e,t,n){var a=Te(Ih(e,t),2),i=a[0],o=a[1],s=4,u=new Uint8Array(AWe(e*t,s));return Pe(r,function(){return r.readPixels(0,0,i,o,n.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function oU(r,e,t,n,a,i,o,s){var u=r,c=new Float32Array(DWe(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function sU(r,e,t){var n=new Float32Array(e*t*4);return Pe(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,n)}),n}var Pqe={__proto__:null,bindVertexProgramAttributeStreams:eU,createBufferFromOutputTexture:nU,createFloat16MatrixTexture:Yq,createFloat16PackedMatrixTexture:Qq,createFloat32MatrixTexture:Xq,createIndexBuffer:jq,createPackedMatrixTexture:Jq,createUnsignedBytesMatrixTexture:Zq,createVertexBuffer:Kq,createVertexShader:Hq,downloadByteEncodedFloatMatrixFromOutputTexture:iU,downloadFloat32MatrixFromBuffer:aU,downloadMatrixFromPackedOutputTexture:sU,downloadPackedMatrixFromBuffer:oU,getInternalFormatForFloat16MatrixTexture:nk,getInternalFormatForFloat16PackedMatrixTexture:ok,getInternalFormatForFloat32MatrixTexture:rk,getInternalFormatForPackedMatrixTexture:ik,getInternalFormatForUnsignedBytesMatrixTexture:ak,uploadDenseMatrixToTexture:tU,uploadPixelDataToTexture:rU},bm=function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var t=k.env().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,mq(t,e)):this.gl=Ti(t),e=this.gl,k.env().getNumber("WEBGL_VERSION")===2){var n=e;this.createVertexArray=function(){return Pe(n,function(){return n.createVertexArray()})},this.bindVertexArray=function(c){return Pe(n,function(){return n.bindVertexArray(c)})},this.deleteVertexArray=function(c){return Pe(n,function(){return n.deleteVertexArray(c)})},this.getVertexArray=function(){return Pe(n,function(){return n.getParameter(n.VERTEX_ARRAY_BINDING)})}}else if(e!=null){var a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return Pe(e,function(){return a.createVertexArrayOES()})},this.bindVertexArray=function(c){return Pe(e,function(){return a.bindVertexArrayOES(c)})},this.deleteVertexArray=function(c){return Pe(e,function(){return a.deleteVertexArrayOES(c)})},this.getVertexArray=function(){return Pe(e,function(){return e.getParameter(a.VERTEX_ARRAY_BINDING_OES)})}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),k.env().getNumber("WEBGL_VERSION")===1){var s="OES_texture_float",u="OES_texture_half_float";if(this.textureFloatExtension=gh(this.gl,s),Sa(this.gl,u))this.textureHalfFloatExtension=gh(this.gl,u);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),Sa(this.gl,o))this.colorBufferHalfFloatExtension=gh(this.gl,o);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",Sa(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(Sa(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Kq(this.gl),this.indexBuffer=jq(this.gl),this.framebuffer=Iq(this.gl),this.textureConfig=Zx(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return k.env().getBool("DEBUG")},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Pe(t,function(){return t.finish()}),Pe(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Pe(t,function(){return t.deleteFramebuffer(e.framebuffer)}),Pe(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Pe(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Pe(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Xq(this.gl,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Yq(this.gl,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Zq(this.gl,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),rU(this.gl,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,a){this.throwIfDisposed(),tU(this.gl,e,t,n,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Qq(this.gl,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Jq(this.gl,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Gx(this.gl,this.framebuffer),this.outputTexture=null),Pe(this.gl,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return iU(a.gl,t,n,a.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,a,i,o){return oU(this.gl,e,t,n,a,i,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return aU(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var a=nU(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t=this,n,a;if(k.env().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=o}else k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),a=function(){return t.isQueryAvailable(n,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:n,isFencePassed:a}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return sU(a.gl,t,n)})},r.prototype.createProgram=function(e){var t=this;this.throwIfDisposed();var n=this.gl;this.vertexShader==null&&(this.vertexShader=Hq(n));var a=xq(n);Pe(n,function(){return n.attachShader(a,t.vertexShader)}),Pe(n,function(){return n.attachShader(a,e)}),kq(n,a);var i=Object.assign(a,{vao:this.createVertexArray()});return this.debug&&vm(n,i),i},r.prototype.buildVao=function(e){var t=this;this.setProgram(e),this.bindVertexArray(e.vao);var n=this.gl;Pe(n,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)}),eU(n,e,this.vertexBuffer)},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Pe(this.gl,function(){return t.gl.deleteProgram(e)}),this.deleteVertexArray(e.vao))},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&vm(this.gl,this.program),Pe(this.gl,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?Aq(this.gl,e,t):Dq(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Pe(this.gl,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),_q(this.gl,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var a=Te(jc(t,n),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,a){this.setOutputMatrixWriteRegionDriver(n,e,a,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&vm(this.gl,this.program),yh(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Pe(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Pe(this.gl,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=gh(this.gl,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)},r.prototype.waitForQueryAndGetTime=function(e){return Hc(this,void 0,void 0,function(){var t=this;return Kc(this,function(n){switch(n.label){case 0:return[4,k.util.repeatedTry(function(){return t.disposed||t.isQueryAvailable(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl,a=n.getQueryParameter(e,n.QUERY_RESULT);return a/1e6}else{var i=this.getQueryTimerExtensionWebGL1(),a=i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT);return a/1e6}},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{var a=this.getQueryTimerExtensionWebGL1(),i=a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=Mqe(this.itemsToPoll.map(function(a){return a.isDoneFn})),t=0;t<=e;++t){var n=this.itemsToPoll[t].resolveFn;n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var a=void 0;"setTimeoutCustom"in k.env().platform&&(a=k.env().platform.setTimeoutCustom.bind(k.env().platform)),k.util.repeatedTry(function(){return n.pollItems(),n.itemsToPoll.length===0},function(){return 0},null,a)}},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),mm(this.gl,e,this.framebuffer),this.debug&&yh(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(mm(this.gl,this.outputTexture,this.framebuffer),this.debug&&yh(this.gl)):Gx(this.gl,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var a=this.gl;mm(a,e,this.framebuffer),this.debug&&yh(a),this.outputTexture=e,Pe(a,function(){return a.viewport(0,0,t,n)}),Pe(a,function(){return a.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,a){var i=this;this.throwIfDisposed(),Pe(this.gl,function(){return i.gl.scissor(e,t,n,a)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function Mqe(r){for(var e=0;e<r.length;++e){var t=r[e]();if(!t)break}return e-1}function Bqe(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}function Na(r){return function(e,t,n,a,i){var o=k.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=k.util.computeStrides(o),c=k.util.sizeFromShape(o),l=k.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=k.util.computeStrides(e),d=k.util.computeStrides(t),m=k.backend_util.getBroadcastDims(e,o),v=k.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(w){var b=k.util.indexToLoc(w,s,u),x=b.slice(-f);m.forEach(function(C){return x[C]=0});var S=k.util.locToIndex(x,f,p),T=b.slice(-h);v.forEach(function(C){return T[C]=0});var E=k.util.locToIndex(T,h,d);l[w]=r(n[S],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function Lqe(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=k.util.toTypedArray([0],t),o=Te(Na(function(c,l){return c!==l?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(n))}var zqe=Na(function(r,e){return r+e});function $qe(r,e,t,n,a){for(var i=k.util.sizeFromShape(n),o=k.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function Wqe(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=k.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=r.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(n?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var qqe=Na(function(r,e){return r&e});function po(r){return function(e,t,n){for(var a=k.util.getArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}var Uqe=po(function(r){return Math.ceil(r)});function Vqe(r,e,t,n){var a=k.util.getArrayFromDType(t,k.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=k.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?k.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var Gqe=Na(function(r,e){return r===e?1:0});var Hqe=po(function(r){return Math.exp(r)});var Kqe=po(function(r){return Math.expm1(r)});var jqe=po(function(r){return Math.floor(r)});function Xqe(r,e,t,n,a,i,o,s,u){for(var c=k.buffer([n,i],t),l=0;l<n;l++){for(var f=[],h=0,p=0;p<a;p++){var d=r[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=e.get.apply(e,mr([],Te(e.indexToLoc(h*i+m)),!1))}return c}function Yqe(r,e,t){for(var n=k.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=r.locToIndex(o);0<=l&&l<r.values.length&&(n.values[a]=r.values[l])}return n}var Zqe=Na(function(r,e){return r>e?1:0});var Jqe=Na(function(r,e){return r>=e?1:0});var Qqe=Na(function(r,e){return r<e?1:0});var eUe=Na(function(r,e){return r<=e?1:0});function tUe(r,e,t){var n=(e-r)/(t-1),a=k.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var rUe=po(function(r){return Math.log(r)});function nUe(r,e,t,n){for(var a=k.util.getTypedArrayFromDType(n,k.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var c=r[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var aUe=Na(function(r,e){return Math.max(r,e)});var iUe=Na(function(r,e){return Math.min(r,e)});var uU=Na(function(r,e){return r*e});function oUe(r,e,t){var n=k.util.createScalarValue(-1,t);return uU([],e,n,r,t)}var sUe=Na(function(r,e){return r!==e?1:0});function uUe(r,e,t,n,a){for(var i=e.length,o=k.util.sizeFromShape(e),s=k.util.computeStrides(e),u=k.util.computeStrides(a),c=k.util.getTypedArrayFromDType(t,k.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=k.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=k.util.locToIndex(h,i,u);c[d]=r[l]}return c}function cUe(r,e,t,n){for(var a=Te(k.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=k.upcastType(e,"int32"),u=k.util.makeZerosTypedArray(k.util.sizeFromShape(i),s),c=k.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function lUe(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=k.util.indexToLoc(a,e.length,k.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(n," is not in [0, ").concat(t,")"))}})}function fUe(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function hUe(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});fUe(t,n);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,c=0;c<t.length;++c){var d=t[c],m=c+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function pUe(r){for(var e=[],t=function(a){var i=r[a].length,o=k.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function qW(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function dUe(r,e,t,n,a,i){var o,s,u=qW(e,2)[1],c=qW(i,2)[1],l=0;try{for(var f=Nn(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[l*c+m]=r[d*u+m];++l}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function vUe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=k.util.getArrayFromDType(t,k.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return dUe(r,e,n,u,o,i),[o,i]}function mUe(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(lUe(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var c=n[0],l=hUe(i,o,r,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=pUe(f),m=vUe(t,n,a,h,p);return[d,m[0],m[1]]}var UW=2147483647;function gUe(r,e,t,n,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=k.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var m=s?r[0]:r[d],v=u?n[0]:n[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if(y=Math.ceil(Math.abs((v-m)/g)),y>UW)throw new Error("Requires ((limit - start) / delta) <= ".concat(UW));p[d+1]=p[d]+y}for(var w=p[h],b=k.util.getArrayFromDType(t,w),x=0,d=0;d<h;++d)for(var S=p[d+1]-p[d],T=s?r[0]:r[d],g=c?i[0]:i[d],f=0;f<S;++f)b[x++]=T,T+=g;return[p,b]}var ei=k.backend_util.RowPartitionType,yUe=function(){function r(e,t,n,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=k.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=k.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===ei.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===ei.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ei.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case ei.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(ei[this.getRowPartitionTypeByDimension(e-1)]))}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return GW(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;k.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=k.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return k.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=n;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=n:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ei.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case ei.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: ".concat(ei[o]))}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case ei.FIRST_DIM_SIZE:return e[0];case ei.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ei.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(ei[t]))}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=GW(n,!1),s=k.util.getArrayFromDType(this.valuesDType,k.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],n[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=k.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;k.tidy(function(){var x=k.reshape(l,f),S=k.broadcastTo(x,s);l=S.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=c;++m){var v=m<c?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),w=(d-p)*u;VW(y,g,w)}if(m>=c){var b=n.length;v=Math.floor(b/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);VW(y,l,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r}();function VW(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function GW(r,e){var t,n,a=[];try{for(var i=Nn(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function bUe(r,e,t,n,a,i,o,s,u,c){return new yUe(r,e,t,n,a,i,o,s,u,c).compute()}function wUe(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return k.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=k.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var xUe=po(function(r){return 1/Math.sqrt(r)});function kUe(r,e,t,n,a,i,o,s,u,c){var l=[n/a,a],f=r.values,h=e.values;if(n===0)return k.buffer(t,e.dtype);var p=u instanceof k.TensorBuffer?u:k.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(t));for(var w=0;w<a;w++)c?p.values[v*a+w]+=h[d*a+w]:p.values[v*a+w]=e.rank===0?h[0]:h[d*a+w]}return p}var SUe=po(function(r){return 1/(1+Math.exp(-r))});function NUe(r,e,t,n,a){var i=k.slice_util.isSliceContinous(n,e,t),o=k.util.sizeFromShape(t),s=k.util.computeStrides(n);if(i){var u=k.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var c=a==="string"?k.backend_util.fromUint8ToStringArray(r):r,l=k.buffer(n,a,c),f=k.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,mr([l.get.apply(l,mr([],Te(d),!1))],Te(p),!1))}return a==="string"?k.backend_util.fromStringArrayToUint8(f.values):f.values}function TUe(r,e,t,n,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(k.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=k.util.getArrayFromDType(t,0),p=k.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(k.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(k.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var w=!0,y=0;y<u;++y){var b=v[y]===0;c[y]=b,w=w&&!b,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(w&&d){for(var h=r,p=n,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=v[u-1],h=k.util.getArrayFromDType(t,x*f),p=k.util.getArrayFromDType(a,x),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],T=S[y],E=(y===0?0:v[y-1])+T;S[y]++;for(var C=0;C<f;++C)h[E*f+C]=r[g*f+C];p[E]=n[g],l[g]=E}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:v[y-1];h[_*f+0]=y;for(var P=1;P<f;++P)h[_*f+P]=0;p[_]=o}}return[h,[x,f],p,c,l]}}function EUe(r,e,t,n,a){for(var i=k.util.sizeFromShape(n),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(k.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(k.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(k.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[l]=p}var d=k.util.sizeFromShape(u);if(d!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=k.util.getArrayFromDType(t,o*s),w=0;w<o;++w){for(var b=0,x=0;x<m;++x)b+=r[w*m+x]*v[x];for(var x=0;x<s;++x)y[w*s+x]=Math.trunc(b/g[x]),b%=g[x]}return[y,[o,s],u]}function IUe(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,E){return T*E},1),d=k.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var w=0;if(v<s){if(w=a[v],y===w){++v;continue}if(y>=w)throw new Error(k.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(k.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var b=m;b<v;++b){var x=n[b];if(x<0||x>=u[0])throw new Error(k.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,n[b],u[0]));for(var S=0;S<c;S++)d[y*c+S]+=r[x*c+S]}if(i)for(var S=0;S<c;S++)d[y*c+S]/=v-m;if(m=v,++v,g=y+1,y=w,v>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var CUe=po(function(r){return Math.sqrt(r)});var AUe=po(function(r,e){var t=e.pattern,n=e.replaceGlobal,a=e.rewrite;return r.replace(new RegExp(t,n?"g":""),a)});function DUe(r,e,t,n){for(var a=k.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,mr([e.get.apply(e,mr([],Te(s),!1))],Te(o),!1))}return a}var _Ue=function(){function r(e,t,n,a,i,o){this.separator=k.util.encodeString(e),this.nGramWidths=t,this.leftPad=k.util.encodeString(n),this.rightPad=k.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),m=t+(h>0?0:l-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+l]=new Uint8Array(v);for(var w=n[a+l],b=0,x=function(S){return S.forEach(function(T){return w[b++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=k.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],w=0;p.nGramWidths.forEach(function(b){w+=n.getNumNGrams(y,b)}),p.preserveShort&&y>0&&w===0&&(w=1),l[g]=l[g-1]+w},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),m=function(g){var y=t[g],w=l[g];if(v.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=n.getNumNGrams(E,T);n.createNGrams(e,y,d,w,C,T),w+=C}),v.preserveShort&&w===l[g]){var b=t[g+1]-t[g];if(b===0)return"continue";var x=b+2*v.padWidth,S=1;v.createNGrams(e,y,d,w,S,x)}},v=this,s=0;s<c;++s)m(s);return[d,l]},r}();function FUe(r,e,t,n,a,i,o,s){return new _Ue(t,n,a,i,o,s).compute(r,e)}function RUe(r,e,t,n){if(!!r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function OUe(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var c=a.length;RUe(r[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=k.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function PUe(r,e){for(var t=k.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=k.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var MUe=Na(function(r,e){return r-e});function BUe(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=k.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var wh=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function cU(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(n,Math.floor(e+(a-i)*s/a+u));cU(r,e,c,l)}var f=r[e],h=t,p=n;for(k.util.swap(r,t,e),wh(r[n],f)>0&&k.util.swap(r,t,n);h<p;){for(k.util.swap(r,h,p),h++,p--;wh(r[h],f)<0;)h=h+1;for(;wh(r[p],f)>0;)p=p-1}wh(r[t],f)===0?k.util.swap(r,t,p):(p=p+1,k.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function LUe(r,e,t,n,a){for(var i=e[e.length-1],o=Te([r.length/i,i],2),s=o[0],u=o[1],c=k.util.getTypedArrayFromDType(t,s*n),l=k.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(S,T){return g[T]={value:S,index:T}}),n<g.length&&(cU(g,n),g=g.slice(0,n)),a&&g.sort(wh);for(var y=d*n,w=c.subarray(y,y+n),b=l.subarray(y,y+n),x=0;x<n;x++)w[x]=g[x].value,b[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[k.buffer(p,t,c),k.buffer(p,"int32",l)]}function zUe(r,e,t,n){for(var a=k.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s=new Map,u=new Int32Array(t[a]),c=new k.TensorBuffer(i,n,r),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(c.get(d,o,m));h=p.join(",")}var v=s.get(h);if(v!=null)u[o]=v;else{var g=s.size;s.set(h,g),u[o]=g,l.push(o)}}var y=i.slice();y[1]=s.size;var w=new k.TensorBuffer(y,n);l.forEach(function(x,S){for(var T=0;T<i[0];T++)for(var E=0;E<i[2];E++)w.set(c.get(T,x,E),T,S,E)});var b=t.slice();return b[a]=y[1],{outputValues:w.values,outputShape:b,indices:u}}var $Ue=zqe,lU=$qe,WUe=Wqe,qUe=qqe,UUe=Lqe,VUe=Uqe,GUe=Vqe,HUe=Gqe,KUe=Hqe,jUe=Kqe,XUe=jqe,YUe=Xqe,ZUe=Yqe,JUe=Zqe,QUe=Jqe,eVe=Qqe,tVe=eUe,rVe=tUe,nVe=rUe,aVe=nUe,iVe=aUe,oVe=iUe,sVe=uU,uVe=oUe,cVe=sUe,lVe=cUe,fVe=mUe,hVe=gUe,pVe=bUe,dVe=wUe,vVe=xUe,mVe=kUe,gVe=SUe,fU=Bqe,yVe=NUe,bVe=TUe,wVe=EUe,hU=IUe,xVe=CUe,kVe=AUe,SVe=DUe,NVe=FUe,TVe=OUe,EVe=PUe,IVe=MUe,CVe=BUe,AVe=LUe,sk=uUe,DVe=zUe;function pU(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return"".concat(r,".").concat(t)})}function Sn(r,e){return e===1?[r]:pU(r,e)}function _Ve(r,e){if(r===1)return"rc";for(var t="",n=0;n<r;n++)t+=e[n],n<r-1&&(t+=",");return t}var FVe=function(){function r(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=vn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Sn("rc",this.rank),n=$t(this.rank),a=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          `.concat(n,` rc = getOutputCoords();

          if(`).concat(a,`) {
            setOutput(vec4(0));
          } else {
            `).concat(i,`

            setOutput(vec4(`).concat(o,`));
          }
        }
      `)}}return r.prototype.getSourceCoordsArr=function(e){for(var t=[],n=0;n<=1;n++)for(var a=0;a<=1;a++){for(var i="".concat(n===0?"r":"rp1",", ").concat(a===0?"c":"cp1"),o=2;o<this.rank;o++)i="".concat(e[e.length-1-o],",")+i;t.push(i)}return t},r.prototype.getOutOfBoundsCondition=function(e){if(this.rank===1)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t},r.prototype.getSetup=function(e){if(this.rank===1)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return`
      int r = `.concat(t[0],`;
      int c = `).concat(t[1],`;
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= `).concat(n,`;
      bool rEdge = rp1 >= `).concat(a,`;
    `)},r.prototype.getOutput=function(e){var t=this.getSourceCoordsArr(e);if(this.rank===1){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],`),
            cEdge ? 0. : getA(`).concat(t[1],`),
            rEdge ? 0. : getA(`).concat(t[2],`),
            rEdge || cEdge ? 0. : getA(`).concat(t[3],")")},r}();var dU=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=vn(this.outputShape.length);for(var n="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),n+=`
        `.concat(i,`
        `).concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"",`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`).concat(a,`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `).concat(a>0?"}":"",`
      `)}this.userCode=`
      `.concat(RVe(t,this.enableShapeUniforms),`
      `).concat(this.enableShapeUniforms?ek():Qx(e),`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `).concat(this.enableShapeUniforms?"outShape[1]":e[1],`;
        int cols = `).concat(this.enableShapeUniforms?"outShape[2]":e[2],`;

        `).concat(n,`

        setOutput(result);
      }
    `)}return r}();function RVe(r,e){var t=e?UWe(["r","c","d"],"inputShape"):Nu(["r","c","d"],r);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `.concat(t,`
      return ivec3(r, c, d);
    }
  `)}var OVe=function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}return r.prototype.acquireTexture=function(e,t,n){var a=KW(t,n),i=jW(e,a,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);var o=HW(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[i].pop();return this.usedTextures[i].push(s),s}var u;return a===cn.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===cn.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===cn.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===cn.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===cn.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),u},r.prototype.releaseTexture=function(e,t,n,a){if(this.freeTextures!=null){var i=KW(n,a),o=jW(t,i,a);o in this.freeTextures||(this.freeTextures[o]=[]);var s=HW(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,a),u=k.env().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var c=this.usedTextures[o],l=c&&c.indexOf(e);if(l==null||l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[l]=c[c.length-1],c.pop(),this.log()}},r.prototype.log=function(){if(!!this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}},Object.defineProperty(r.prototype,"numBytesAllocated",{get:function(){return this._numBytesAllocated},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"numBytesFree",{get:function(){return this._numBytesFree},enumerable:!1,configurable:!0}),r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n.texture)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){e.gpgpu.deleteMatrixTexture(a.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}},r}();function PVe(r,e){var t=r;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===r.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error("Unknown internal format ".concat(e))}function HW(r,e,t,n,a){var i=MVe(e,n),o;if(a){var s=Te(jc(r[0],r[1]),2),u=s[0],c=s[1];o=u*c}else{var l=Te(Ih(r[0],r[1]),2),f=l[0],h=l[1];o=f*h}var p=PVe(t,i);return o*p}function MVe(r,e){switch(r){case cn.PACKED_2X2_FLOAT32:return ik(e);case cn.PACKED_2X2_FLOAT16:return ok(e);case cn.UNPACKED_FLOAT32:return rk(e);case cn.UNPACKED_FLOAT16:return nk(e);case cn.PACKED_4X1_UNSIGNED_BYTE:return ak(e);default:throw new Error("Unknown physical texture type ".concat(r))}}function BVe(r){return k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?r?cn.PACKED_2X2_FLOAT32:cn.UNPACKED_FLOAT32:r?cn.PACKED_2X2_FLOAT16:cn.UNPACKED_FLOAT16}function KW(r,e){if(r===ka.UPLOAD)return cn.PACKED_2X2_FLOAT32;if(r===ka.RENDER||r==null)return BVe(e);if(r===ka.DOWNLOAD||r===ka.PIXELS)return cn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(r))}function jW(r,e,t){return"".concat(r[0],"_").concat(r[1],"_").concat(e,"_").concat(t)}var $i=function(){function r(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        `.concat(t,`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `)}return r}(),ti="if (isnan(x)) return x;",LVe="return x;",XW="return abs(x);",zVe="return (x >= 0.0) ? x : (exp(x) - 1.0);",$Ve=ti+`
  return (x < 0.0) ? 0.0 : x;
`,WVe=ti+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ls="return x;",qVe="return 1.0 / (1.0 + exp(-1.0 * x));";var UVe="return x;",VVe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,GVe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,HVe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,KVe="return 1.0 / (1.0 + exp(-1.0 * x));",fs=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `.concat(t,`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `)}return r}();var jVe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=vn(this.outputShape.length);var t=e.length,n=Sn("rc",t),a=$t(t),i=_Ve(t,n),o=n.slice(-2),s=t<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode=`
      void main() {
        `.concat(a,` rc = getOutputCoords();
        vec4 packedInput = getA(`).concat(i,`);

        setOutput(getChannel(packedInput, `).concat(s,`));
      }
    `)}return r}(),XVe=k.kernel_impls.whereImpl,YVe=1e-7,ZVe=1e-4,pm={};function JVe(r){return r in pm||(pm[r]={}),pm[r]}var QVe=k.env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),eGe=600;function tGe(){return k.env().global.screen==null?1024:k.env().global.screen.height*k.env().global.screen.width*window.devicePixelRatio*eGe/1024/1024}var uk=function(r){EWe(e,r);function e(t){var n=r.call(this)||this;if(n.pendingRead=new WeakMap,n.pendingDisposal=new WeakSet,n.dataRefCount=new WeakMap,n.numBytesInGPU=0,n.uploadWaitMs=0,n.downloadWaitMs=0,n.lastGlFlushTime=0,n.warnedAboutMemory=!1,n.pendingDeletes=0,n.disposed=!1,!k.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");var a;if(t!=null){if(t instanceof bm)a=t;else{var i=Ti(k.env().getNumber("WEBGL_VERSION"),t);a=new bm(i)}n.binaryCache={},n.gpgpuCreatedLocally=!1}else{var i=Ti(k.env().getNumber("WEBGL_VERSION"));a=new bm(i),n.binaryCache=JVe(k.env().getNumber("WEBGL_VERSION")),n.gpgpuCreatedLocally=!0}return n.gpgpu=a,n.canvas=n.gpgpu.gl.canvas,n.textureManager=new OVe(n.gpgpu),n.numMBBeforeWarning=tGe(),n.texData=new k.DataStorage(n,k.engine()),n}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.numDataIds=function(){return this.texData.numDataIds()-this.pendingDeletes},e.prototype.writeTexture=function(t,n,a,i,o,s){var u=this.makeTensorInfo(n,a),c=this.texData.get(u.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[i,o]},c.texShape=[i,o];var l=bh(n),f=new WW(l,!1,s),h=this.runWebGLProgram(f,[u],a,[[i,o]]);return h.shape=n,c.texture=null,this.disposeIntermediateTensorInfo(u),h.dataId},e.prototype.write=function(t,n,a){if((k.env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||k.env().getBool("DEBUG"))&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:a,values:t,usage:ka.UPLOAD,refCount:1}),i},e.prototype.refCount=function(t){if(this.texData.has(t)){var n=this.texData.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.texData.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){if(k.env().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:i,values:n,usage:ka.UPLOAD,refCount:o})},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.readSync=function(t){var n=this.texData.get(t),a=n.values,i=n.dtype,o=n.complexTensorInfos,s=n.slice,u=n.shape,c=n.isPacked;if(s!=null){var l=void 0;c?l=new fs(u,ls):l=new $i(u,ls);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),h}if(a!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return a;var p=this.activeTimers!=null,d;p&&(d=k.util.now());var m;if(i==="complex64"){var v=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);m=k.backend_util.mergeRealAndImagArrays(v,g)}else m=this.getValuesFromTexture(t);return p&&(this.downloadWaitMs+=k.util.now()-d),this.convertAndCacheOnCPU(t,m)},e.prototype.read=function(t){return Hc(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C;return Kc(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(_){return n.push(_)})];if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensorInfos,l=a.isPacked,s!=null)return f=void 0,l?f=new fs(o,ls):f=new $i(o,ls),h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),[2,p];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(k.env().getBool("DEBUG")&&!k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&k.env().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,u!=="complex64"&&k.env().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),v=this.texData.get(m.dataId),d=(C=this.gpgpu).createBufferFromTexture.apply(C,mr([v.texture.texture],Te(fm(o)),!1))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)])];case 3:return y=R.sent(),w=y[0],b=y[1],g=k.backend_util.mergeRealAndImagArrays(w,b),[3,5];case 4:d==null?g=this.getValuesFromTexture(t):(x=k.util.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x)),R.label=5;case 5:return m!=null&&this.disposeIntermediateTensorInfo(m),d!=null&&(S=this.gpgpu.gl,Pe(S,function(){return S.deleteBuffer(d)})),T=this.convertAndCacheOnCPU(t,g),E=this.pendingRead.get(t),this.pendingRead.delete(t),E.forEach(function(_){return _(T)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&k.engine().removeDataId(t,this),this.pendingDeletes--),[2,T]}})})},e.prototype.readToGPU=function(t,n){n===void 0&&(n={});var a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.isPacked,l=a.texture;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){var f=void 0;c?f=new fs(o,ls):f=new $i(o,ls);var h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.readToGPU(h,n);return this.disposeIntermediateTensorInfo(h),p}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(t,n.customTexShape),m=k.engine().makeTensorFromTensorInfo(d),v=this.texData.get(d.dataId);return Object.assign({tensorRef:m},v.texture)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return k.util.decodeString(i)});return k.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return k.buffer(t.shape,t.dtype,n)},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var a=t[n];if(!gq(a))throw k.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(a," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value ".concat(a," cannot be represented on this device."))}},e.prototype.getValuesFromTexture=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.isPacked,u=k.util.sizeFromShape(i);if(k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,mr([l.texture.texture],Te(fm(i)),!1)).subarray(0,u);return this.disposeIntermediateTensorInfo(c),f}var h=k.env().getBool("WEBGL_PACK")&&s===!0,p=h?bh(i):i,d=h?new Fqe(p):new _qe(p),m=this.runWebGLProgram(d,[{shape:p,dtype:o,dataId:t}],"float32"),v=this.texData.get(m.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeIntermediateTensorInfo(m),g},e.prototype.timerAvailable=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0},e.prototype.time=function(t){var n=this,a=this.activeTimers,i=[],o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();var s=k.util.flatten(this.activeTimers.map(function(l){return l.query})).filter(function(l){return l!=null}),u=k.util.flatten(this.activeTimers.map(function(l){return l.name})).filter(function(l){return l!=null});this.activeTimers=a,o&&(this.programTimersStack=null);var c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return function(){return Hc(n,void 0,void 0,function(){var l;return Kc(this,function(f){switch(f.label){case 0:return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=f.sent(),c.kernelMs=k.util.sum(l),c.getExtraProfileInfo=function(){return l.map(function(h,p){return{name:u[p],ms:h}}).map(function(h){return"".concat(h.name,": ").concat(h.ms)}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})}()},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}},e.prototype.startTimer=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:k.util.now(),endMs:null}},e.prototype.endTimer=function(t){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=k.util.now(),t)},e.prototype.getQueryTime=function(t){return Hc(this,void 0,void 0,function(){var n;return Kc(this,function(a){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(n=t,[2,n.endMs-n.startMs])})})},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);var a=this.texData.get(t).complexTensorInfos;return a!=null&&(this.disposeData(a.real.dataId,n),this.disposeData(a.imag.dataId,n)),this.texData.delete(t),!0},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),a=n.texture,i=n.dtype,o=n.texShape,s=n.usage,u=n.isPacked,c=n.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.shouldExecuteOnCPU=function(t,n){var a=this;return n===void 0&&(n=QVe),k.env().getBool("WEBGL_CPU_FORWARD")&&t.every(function(i){return a.texData.get(i.dataId).texture==null&&k.util.sizeFromShape(i.shape)<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.where=function(t){k.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return XVe(t.shape,n)},e.prototype.packedUnaryOp=function(t,n,a){var i=new fs(t.shape,n),o=this.compileAndRun(i,[t],a);return k.engine().makeTensorFromTensorInfo(o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){var n=fU(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,n)}if(k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,XW,t.dtype);var a=new $i(t.shape,XW),i=this.compileAndRun(a,[t]);return k.engine().makeTensorFromTensorInfo(i)},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&k.util.isString(a[0])){var o=a.map(function(s){return k.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n,a){return k.engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,a),this)},e.prototype.unpackTensor=function(t){var n=new jVe(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new FVe(t.shape),a=!0;return this.runWebGLProgram(n,[t],t.dtype,null,a)},e.prototype.packedReshape=function(t,n){var a=mr([xu(t.shape)],Te(ku(t.shape)),!1),i={dtype:t.dtype,shape:a,dataId:t.dataId},o=mr([xu(n)],Te(ku(n)),!1),s=new dU(o,a),u=!0,c=[a],l=this.runWebGLProgram(s,[i],t.dtype,c,u);return{dataId:l.dataId,shape:n,dtype:l.dtype}},e.prototype.decode=function(t,n){var a=this.texData.get(t),i=a.isPacked,o=a.shape,s=a.dtype;if(n!=null){var u=k.util.sizeFromShape(o),c=n[0]*n[1]*4;k.util.assert(u<=c,function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."})}var l=bh(o),f;i?f=new Dqe(l):f=new Aqe(l);var h=!0,p=[n??fm(l)],d=this.runWebGLProgram(f,[{shape:l,dtype:s,dataId:t}],s,p,h,n);return{dtype:s,shape:o,dataId:d.dataId}},e.prototype.runWebGLProgram=function(t,n,a,i,o,s){var u=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(t.outputShape,a),l=this.texData.get(c.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===kh.DENSE){var f=s??fm(t.outputShape);l.texShape=f.map(function(S){return S*2})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),k.util.sizeFromShape(c.shape)===0)return l.values=k.util.getTypedArrayFromDType(c.dtype,0),c;var h=[],p=n.map(function(S){if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var T=u.texData.get(S.dataId);if(T.texture==null){if(!t.packedInputs&&k.util.sizeFromShape(S.shape)<=k.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:T.values};t.packedInputs&&(T.isPacked=!0,T.shape=S.shape)}if(u.uploadToGPU(S.dataId),!!T.isPacked!=!!t.packedInputs)S=T.isPacked?u.unpackTensor(S):u.packTensor(S),h.push(S),T=u.texData.get(S.dataId);else if(T.isPacked&&!Sh(T.shape,S.shape)){var E=S,C=S.shape;S.shape=T.shape,S=u.packedReshape(S,C),h.push(S),T=u.texData.get(S.dataId),E.shape=C}return{shape:S.shape,texData:T,isUniform:!1}});this.uploadToGPU(c.dataId);var d={shape:c.shape,texData:l,isUniform:!1},m=Cqe(t,p,d),v=this.getAndSaveBinary(m,function(){return Eqe(u.gpgpu,t,p,d)}),g=this.activeTimers!=null,y;g&&(y=this.startTimer()),k.env().get("ENGINE_COMPILE_ONLY")||Iqe(this.gpgpu,v,p,d,i),h.forEach(function(S){return u.disposeIntermediateTensorInfo(S)}),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));var w=k.env().getNumber("WEBGL_FLUSH_THRESHOLD");if(w>0){var b=k.util.now();b-this.lastGlFlushTime>w&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!k.env().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){var x=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),x}return c},e.prototype.compileAndRun=function(t,n,a,i,o){o===void 0&&(o=!1),a=a||n[0].dtype;var s=this.runWebGLProgram(t,n,a,i,o);return s},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;if(!this.disposed){if(!k.env().getBool("IS_TEST")){var n=Object.keys(this.binaryCache);n.forEach(function(a){t.gpgpu.deleteProgram(t.binaryCache[a].webGLProgram),delete t.binaryCache[a]})}this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=k.tidy(function(){if(!k.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=k.env().getBool("DEBUG");k.env().set("DEBUG",!1);var a=t.abs(k.scalar(1e-8)).dataSync()[0];if(k.env().set("DEBUG",n),a>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?YVe:ZVe},e.prototype.uploadToGPU=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.values,u=a.texture,c=a.usage,l=a.isPacked;if(u==null){var f=this.activeTimers!=null,h;f&&(h=k.util.now());var p=a.texShape;if(p==null&&(p=Oq(i,l),a.texShape=p),s!=null){var d=bh(i),m=void 0,v=p[1],g=p[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!y)&&(n=Te(jc(p[0],p[1]),2),v=n[0],g=n[1]),l?m=new Oqe(d,y):m=new WW(d,y);var w=y?[g,v]:p,b=this.makeTensorInfo(w,o),x=this.texData.get(b.dataId);y?x.usage=ka.PIXELS:x.usage=ka.UPLOAD,x.texShape=w,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),v,g,s);var S=[[g,v]],T=!0,E=this.runWebGLProgram(m,[b],o,S,T),C=this.texData.get(E.dataId);a.texShape=C.texShape,a.isPacked=C.isPacked,a.usage=C.usage,k.env().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(a.texture=C.texture,a.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(b),f&&(this.uploadWaitMs+=k.util.now()-h)}else{var R=this.acquireTexture(p,c,o,l);a.texture=R}}},e.prototype.convertAndCacheOnCPU=function(t,n){var a=this.texData.get(t),i=a.dtype;return n!=null&&(a.values=rGe(n,i)),a.values},e.prototype.acquireTexture=function(t,n,a,i){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(o," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,i)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*k.util.bytesPerElement(n)},e.prototype.checkCompileCompletion=function(){var t,n;try{for(var a=Nn(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Te(i.value,2),s=o[1];this.checkCompletion_(s)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.checkCompileCompletionAsync=function(){return Hc(this,void 0,void 0,function(){var t,n,a,i,l,o,s,u,c,l,f,h,p,d,m=this;return Kc(this,function(v){if(t=[],this.gpgpu.parallelCompilationExtension){try{for(n=Nn(Object.entries(this.binaryCache)),a=n.next();!a.done;a=n.next())i=Te(a.value,2),l=i[1],t.push(this.checkCompletionAsync_(l))}catch(g){f={error:g}}finally{try{a&&!a.done&&(h=n.return)&&h.call(n)}finally{if(f)throw f.error}}return[2,Promise.all(t)]}else{o=function(g){var y=new Promise(function(w){try{m.checkCompletion_(g),w(!0)}catch(b){throw b}});t.push(y)};try{for(s=Nn(Object.entries(this.binaryCache)),u=s.next();!u.done;u=s.next())c=Te(u.value,2),l=c[1],o(l)}catch(g){p={error:g}}finally{try{u&&!u.done&&(d=s.return)&&d.call(s)}finally{if(p)throw p.error}}return[2,Promise.all(t)]}})})},e.prototype.checkCompletionAsync_=function(t){return Hc(this,void 0,void 0,function(){return Kc(this,function(n){switch(n.label){case 0:return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?[2,this.checkCompletion_(t)]:[3,1];case 1:return[4,k.nextFrame()];case 2:return n.sent(),[2,this.checkCompletionAsync_(t)]}})})},e.prototype.checkCompletion_=function(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Jx(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0},e.prototype.getUniformLocations=function(){var t,n;try{for(var a=Nn(Object.values(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=i.value;this.gpgpu.buildVao(o.webGLProgram);var s=Gq(this.gpgpu,o.program,o.webGLProgram),u=s.variablesLocations,c=s.customUniformLocations,l=s.infLoc,f=s.nanLoc,h=s.outShapeLocation,p=s.outShapeStridesLocation,d=s.outTexShapeLocation;o.variablesLocations=u,o.customUniformLocations=c,o.infLoc=l,o.nanLoc=f,o.outShapeLocation=h,o.outShapeStridesLocation=p,o.outTexShapeLocation=d}}catch(m){t={error:m}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.createTensorFromGPUData=function(t,n,a){t.channels=t.channels||"RGBA";var i=t.texture,o=t.height,s=t.width,u=t.channels,c=k.engine().backend;if(!c.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var l=c.writeTexture(i,n,a,o,s,u);return k.engine().makeTensorFromDataId(l,n,a,c)},e}(k.KernelBackend);uk.nextDataId=0;function rGe(r,e){if(e==="float32"||e==="complex64")return r;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(r.length):new Uint8Array(r.length),n=0;n<t.length;++n)t[n]=Math.round(r[n]);return t}else throw new Error("Unknown dtype ".concat(e))}var nGe="4.19.0";function vU(){k.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}k.device_util.isBrowser()&&k.registerBackend("webgl",function(){return new uk},2);var aGe={forceHalfFloat:vU};var ck=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,Su=function(){function r(e,t,n){this.variableNames=["A","B"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=vn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        `.concat(e,`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `)}return r}();var Eu=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,el=function(){function r(e,t,n,a){a===void 0&&(a=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n);var i=this.outputShape.length;this.enableShapeUniforms=vn(i);var o="";if(a)if(i===0||k.util.sizeFromShape(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{var s=$t(i);if(o=`
          `.concat(s,` coords = getOutputCoords();
        `),i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= `.concat(this.outputShape[0],` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `);else{var u=Sn("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= outShape[").concat(i,` - 2];
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= outShape[").concat(i,` - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `):o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],`;
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `)}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `.concat(e,`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `).concat(o,`

        setOutput(result);
      }
    `)}return r}();function la(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var iGe={kernelName:k.Identity,backendName:"webgl",kernelFunc:la};function hs(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.makeTensorInfo(n.shape,"complex64"),o=t.texData.get(i.dataId),s=la({inputs:{x:n},backend:t}),u=la({inputs:{x:a},backend:t});return o.complexTensorInfos={real:s,imag:u},i}var oGe={kernelName:k.Complex,backendName:"webgl",kernelFunc:hs};var mU="return (a < 0.) ? b * a : a;",gU=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function sGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha,o=t.makeTensorInfo([],"float32",k.util.createScalarValue(i,"float32")),s=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new el(gU,a.shape,o.shape):new Su(mU,a.shape,o.shape),u=t.runWebGLProgram(s,[a,o],"float32");return t.disposeIntermediateTensorInfo(o),u}var uGe={kernelName:k.LeakyRelu,backendName:"webgl",kernelFunc:sGe};var yU="return (a < 0.) ? b * a : a;",bU=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function cGe(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new el(bU,n.shape,a.shape):new Su(yU,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],"float32")}var lGe={kernelName:k.Prelu,backendName:"webgl",kernelFunc:cGe},tl="if (isnan(x)) return x;";function It(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.cpuKernelImpl,a=r.dtype;return function(i){var o=i.inputs,s=i.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&n!=null){var f=c.texData.get(u.dataId),h=n(f.values,l);return c.makeTensorInfo(u.shape,l,h)}var p=k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,d;return p?d=new fs(u.shape,t):d=new $i(u.shape,e),c.runWebGLProgram(d,[u],l)}}function ln(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.checkOutOfBounds,a=n===void 0?!1:n,i=r.supportsComplex,o=i===void 0?!1:i,s=r.cpuKernelImpl,u=r.dtype;return function(c){var l=c.inputs,f=c.backend,h=l.a,p=l.b,d=f;if(o&&h.dtype==="complex64"){var m=d.texData.get(h.dataId),v=d.texData.get(p.dataId),g=Te([[m.complexTensorInfos.real,v.complexTensorInfos.real],[m.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(function(q){var Y=Te(q,2),J=Y[0],U=Y[1],j={dataId:J.dataId,dtype:J.dtype,shape:h.shape},ne={dataId:U.dataId,dtype:U.dtype,shape:p.shape},re=new Su(e,h.shape,p.shape);return d.runWebGLProgram(re,[j,ne],k.upcastType(J.dtype,U.dtype))}),2),y=g[0],w=g[1],b=hs({inputs:{real:y,imag:w},backend:d});return d.disposeIntermediateTensorInfo(y),d.disposeIntermediateTensorInfo(w),b}var x=u||k.upcastType(h.dtype,p.dtype);if((h.dtype==="string"||p.dtype==="string"||d.shouldExecuteOnCPU([h,p]))&&s!=null){var S=d.texData.get(h.dataId).values,T=d.texData.get(p.dataId).values,E=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(S):S,C=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(T):T,R=Te(s(h.shape,p.shape,E,C,x),2),_=R[0],P=R[1],$=d.makeTensorInfo(P,x),z=d.texData.get($.dataId);return z.values=_,$}var L=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,B;return L?B=new el(t,h.shape,p.shape,a):B=new Su(e,h.shape,p.shape),d.runWebGLProgram(B,[h,p],x)}}function Nh(r,e){if(e===void 0&&(e=!1),r==="linear")return e?UVe:LVe;if(r==="relu")return e?GVe:$Ve;if(r==="elu")return e?VVe:zVe;if(r==="relu6")return e?HVe:WVe;if(r==="prelu")return e?bU:yU;if(r==="leakyrelu")return e?gU:mU;if(r==="sigmoid")return e?KVe:qVe;throw new Error("Activation ".concat(r," has not been implemented for the WebGL backend."))}var wU=function(){function r(e,t,n,a,i,o,s,u,c){a===void 0&&(a=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),s===void 0&&(s=null),u===void 0&&(u=!1),c===void 0&&(c=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=vn(this.outputShape.length);var l=a?e[1]:e[2],f=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",d=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(u?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(s,`
        }`):c?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(s,`
        }`):v=`vec4 activation(vec4 x) {
          `.concat(s,`
        }`),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var w="rc.x",b="rc.x";e[0]<t[0]?w="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(b="imod(rc.x, ".concat(t[0],")")),this.userCode=`
      `.concat(v,`
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = `).concat(f,`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = `).concat(w,`;
        int batchB = `).concat(b,`;
        for (int i = 0; i < `).concat(f,`; i++) {
          vec4 a = getMatrixA(batchA, `).concat(h,`);
          vec4 b = getMatrixB(batchB, `).concat(p,`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`).concat(d[0]," * ").concat(m[0],`);
          result += (`).concat(d[1]," * ").concat(m[1],`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `).concat(y,`

        `).concat(g,`

        setOutput(result);
      }
    `)}return r}();var YW={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},ZW=function(){function r(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `.concat(e,`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `)}return r}(),JW="return a * b;";function lk(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=k.backend_util.upcastType(n.dtype,a.dtype);if(n.dtype==="complex64"){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),u=new ZW(YW.REAL,n.shape,a.shape),c=new ZW(YW.IMAG,n.shape,a.shape),l=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:n.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape}],f=t.runWebGLProgram(u,l,"float32"),h=t.runWebGLProgram(c,l,"float32"),p=hs({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}if(t.shouldExecuteOnCPU([n,a])){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),d=Te(sVe(n.shape,a.shape,o.values,s.values,i),2),m=d[0],v=d[1],g=t.makeTensorInfo(v,i),y=t.texData.get(g.dataId);return y.values=m,g}var w;return k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?w=new el(JW,n.shape,a.shape):w=new Su(JW,n.shape,a.shape),t.runWebGLProgram(w,[n,a],i)}var fGe={kernelName:k.Multiply,backendName:"webgl",kernelFunc:lk};function hGe(r,e,t){var n=mr([xu(r.shape)],Te(ku(r.shape)),!1),a={dtype:r.dtype,shape:n,dataId:r.dataId},i=mr([xu(e)],Te(ku(e)),!1),o=new dU(i,n),s=!0,u=[n],c=t.runWebGLProgram(o,[a],r.dtype,u,s);return{dataId:c.dataId,shape:e,dtype:c.dtype}}function Ae(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=t,s=k.util.sizeFromShape(a.shape),u=k.util.inferFromImplicitShape(i,s),c=k.util.sizeFromShape(u);k.util.assert(s===c,function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."});var l=o.texData.get(a.dataId);return l.isPacked&&!Sh(a.shape,u)&&!(l.texture!==null&&Sh(l.shape,u))?hGe(a,u,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var pGe={kernelName:k.Reshape,backendName:"webgl",kernelFunc:Ae};var QW=function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s=Math.floor(n/4)*4,u=n%4,c="sumValue += dot(values, ones);";if(t!=null){var l=1/t;c="sumValue += dot(values * ".concat(k.util.isInt(l)?l.toPrecision(2):l,", ones);")}var f="";i%n>0&&(f=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return 0.0;
        }
      `)),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `.concat(f,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(n,`;

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(s,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(c,`
        }

        int inIdx = inOffset + `).concat(s,`;
        if (`).concat(u===1,`) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          `).concat(c,`
        }
        setOutput(sumValue);
      }
    `)}return r}();var dGe=function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var l=Math.floor(n/4)*4,f=n%4,h=`
      if (`.concat(t==="sum",`) {
        sumValue += dot(values, ones);
      } else if (`).concat(t==="prod",`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `).concat(u,`(values, minMaxValue);
        if (`).concat(t==="min"," || ").concat(t==="max",`) {
          minMaxValue = `).concat(u,`(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `),p="vec4";t==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(s,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `).concat(d,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(n,`;

        vec4 minMaxValue = vec4(`).concat(s,`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return r}();function vGe(r){for(var e=[];e.length===0||e[e.length-1].outSize!==1;){var t=e.length?e[e.length-1].outSize:r[1],n=k.backend_util.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:n,outSize:Math.ceil(t/n)})}return e}function Iu(r,e,t,n){for(var a=vGe(r.shape),i=r,o=0;o<a.length;o++){var s=a[o],u=s.inSize,c=s.windowSize,l=s.outSize,f=void 0,h=void 0;t==="mean"?f=o===0?new QW({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l},u):new QW({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l}):f=new dGe({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l},t),h=i,i=n.runWebGLProgram(f,[i],e),h.dataId!==r.dataId&&n.disposeIntermediateTensorInfo(h)}return i}var mGe=function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;var i=$t(this.rank),o=gGe(t);this.userCode=`
    void main() {
      `.concat(i,` resRC = getOutputCoords();
      setOutput(getA(`).concat(o,`));
    }
    `)}return r}();function gGe(r){var e=r.length;if(e>6)throw Error("Transpose for rank ".concat(e," is not yet supported"));for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e),a=0;a<r.length;a++)n[r[a]]=t[a];return n.join()}var yGe=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=$t(this.rank),o=pU("rc",this.rank),s=new Array(this.rank),a=0;a<t.length;a++)s[t[a]]=o[a];var u="vec2(".concat(s.slice(-2).join(),")"),c="++".concat(o[this.rank-1]," < ").concat(n[this.rank-1]),l="getChannel(getA(".concat(s.join(),"), ").concat(u,")");this.userCode=`
    void main() {
      `.concat(i,` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `).concat(l,`;
      if(`).concat(c,`) {
        result[1] = `).concat(l,`;
      }
      --`).concat(o[this.rank-1],`;
      if(++`).concat(o[this.rank-2]," < ").concat(n[this.rank-2],`) {
        result[2] = `).concat(l,`;
        if(`).concat(c,`) {
          result[3] = `).concat(l,`;
        }
      }
      setOutput(result);
    }
    `)}return r}();function Tm(r,e,t){var n=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yGe(r.shape,e):new mGe(r.shape,e);return t.runWebGLProgram(n,[r],r.dtype)}function bGe(r,e,t,n){var a=e,i=r.shape.length,o=k.util.parseAxisParam(a,r.shape),s=o,u=k.backend_util.getAxesPermutation(s,i),c=u!=null,l=r;c&&(l=Tm(r,u,n),s=k.backend_util.getInnerMostAxes(s.length,i)),k.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=Te(k.backend_util.computeOutAndReduceShapes(l.shape,s),2),h=f[0],p=f[1],d=h;t&&(d=k.backend_util.expandShapeToKeepDim(h,o));var m=k.util.sizeFromShape(p),v=k.util.sizeFromShape(r.shape),g=v/m,y=Ae({inputs:{x:l},attrs:{shape:[g,m]},backend:n}),w=k.sumOutType(r.dtype),b=Iu(y,w,"sum",n),x=Ae({inputs:{x:b},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),c&&n.disposeIntermediateTensorInfo(l),x}function Em(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;return bGe(a,i,o,t)}var wGe={kernelName:k.Sum,backendName:"webgl",kernelFunc:Em};function Tn(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.perm,o=t,s=a.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=a.shape[i[c]];var l;if(o.shouldExecuteOnCPU([a])){var f=o.texData.get(a.dataId),h=f.values,p=sk(h,a.shape,a.dtype,i,u);l=o.makeTensorInfo(u,a.dtype);var d=o.texData.get(l.dataId);d.values=p}else l=Tm(a,i,o);return l}var xGe={kernelName:k.Transpose,backendName:"webgl",kernelFunc:Tn},xU=1e3;function xm(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=r.transposeB,s=r.backend,u=r.bias,c=u===void 0?null:u,l=r.preluActivationWeights,f=l===void 0?null:l,h=r.leakyreluAlpha,p=h===void 0?0:h,d=r.activation,m=d===void 0?null:d,v=n.shape.length,g=a.shape.length,y=i?n.shape[v-2]:n.shape[v-1],w=o?a.shape[g-1]:a.shape[g-2],b=i?n.shape[v-1]:n.shape[v-2],x=o?a.shape[g-2]:a.shape[g-1],S=n.shape.slice(0,-2),T=a.shape.slice(0,-2),E=k.util.sizeFromShape(S),C=k.util.sizeFromShape(T),R=k.broadcast_util.assertAndGetBroadcastShape(n.shape.slice(0,-2),a.shape.slice(0,-2)),_=R.concat([b,x]);k.util.assert(y===w,function(){return"Error in matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(n.shape," and ")+"".concat(a.shape," and transposeA=").concat(i)+" and transposeB=".concat(o," must match.")});var P=i?[E,y,b]:[E,b,y],$=o?[C,x,w]:[C,w,x],z=Ae({inputs:{x:n},backend:s,attrs:{shape:P}}),L=Ae({inputs:{x:a},backend:s,attrs:{shape:$}}),B=[z,L],q=Math.max(E,C),Y=i?z.shape[1]:z.shape[2],J=c!=null,U=f!=null,j=m==="leakyrelu",ne=m!=null?Nh(m,!0):null,re=J||U||j||ne!=null,se;if((b===1||x===1)&&Y>xU&&re===!1){var le=z,de=L;i&&(le=Tn({inputs:{x:z},backend:s,attrs:{perm:[0,2,1]}}),B.push(le)),o&&(de=Tn({inputs:{x:L},backend:s,attrs:{perm:[0,2,1]}}),B.push(de));var ke=x!==1,he=x===1,ye=le;ke&&(ye=Ae({inputs:{x:le},backend:s,attrs:{shape:[q,Y,1]}}),B.push(ye));var xe=x===1?2:1,De=de;he&&(De=Ae({inputs:{x:de},backend:s,attrs:{shape:[q,1,Y]}}),B.push(De));var Ye=lk({inputs:{a:ye,b:De},backend:s});se=Em({inputs:{x:Ye},backend:s,attrs:{axis:xe,keepDims:!0}}),B.push(Ye)}else{var ht=k.upcastType(n.dtype,a.dtype),at=new wU(P,$,[q,b,x],i,o,J,ne,U,j),nt=[z,L];if(c!=null&&nt.push(c),U&&nt.push(f),j){var ft=s.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));nt.push(ft),B.push(ft)}se=s.runWebGLProgram(at,nt,ht)}var st=Ae({inputs:{x:se},backend:s,attrs:{shape:_}});B.push(se);try{for(var Ze=Nn(B),tt=Ze.next();!tt.done;tt=Ze.next()){var et=tt.value;s.disposeIntermediateTensorInfo(et)}}catch(ir){e={error:ir}}finally{try{tt&&!tt.done&&(t=Ze.return)&&t.call(Ze)}finally{if(e)throw e.error}}return st}function kGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=e.bias,s=e.preluActivationWeights,u=n.transposeA,c=n.transposeB,l=n.activation,f=n.leakyreluAlpha;return xm({a,b:i,transposeA:u,transposeB:c,backend:t,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:l})}var SGe={kernelName:k._FusedMatMul,backendName:"webgl",kernelFunc:kGe};var eq="return abs(x);";function NGe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){var a=t.texData.get(n.dataId),i=fU(a.values);return t.makeTensorInfo(n.shape,n.dtype,i)}var o;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new fs(n.shape,eq):o=new $i(n.shape,eq),t.runWebGLProgram(o,[n],n.dtype)}var TGe={kernelName:k.Abs,backendName:"webgl",kernelFunc:NGe};var EGe=ti+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,IGe=It({opSnippet:EGe}),CGe={kernelName:k.Acos,backendName:"webgl",kernelFunc:IGe};var AGe=ti+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,DGe=It({opSnippet:AGe}),_Ge={kernelName:k.Acosh,backendName:"webgl",kernelFunc:DGe};var tq="return a + b;",FGe=ln({opSnippet:tq,packedOpSnippet:tq,supportsComplex:!0,cpuKernelImpl:$Ue}),RGe={kernelName:k.Add,backendName:"webgl",kernelFunc:FGe};var OGe=function(){function r(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var n=[];this.variableNames.forEach(function(i){n.push("float v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(n.join(`
        `),`

        float result = `).concat(a,`;
        setOutput(result);
      }
    `)}return r}();var PGe=function(){function r(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var n=[];this.variableNames.forEach(function(i){n.push("vec4 v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(n.join(`
        `),`

        vec4 result = `).concat(a,`;
        setOutput(result);
      }
    `)}return r}();function wm(r){var e=r.inputs,t=r.backend,n=e;if(n.length===1)return la({inputs:{x:n[0]},backend:t});if(n.length>k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),i=wm({inputs:n.slice(0,a),backend:t}),o=wm({inputs:n.slice(a),backend:t});return wm({inputs:[i,o],backend:t})}var s=n.map(function(f){return f.dtype}).reduce(function(f,h){return k.upcastType(f,h)}),u=n.map(function(f){return f.shape}),c=k.env().getBool("WEBGL_PACK"),l=c?new PGe(n[0].shape,u):new OGe(n[0].shape,u);return t.runWebGLProgram(l,n,s)}var MGe={kernelName:k.AddN,backendName:"webgl",kernelFunc:wm};function BGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=Tn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("all",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=Iu(v,v.dtype,"all",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ae({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ae({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var LGe={kernelName:k.All,backendName:"webgl",kernelFunc:BGe};function zGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=Tn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("any",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=Iu(v,v.dtype,"any",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ae({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ae({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var $Ge={kernelName:k.Any,backendName:"webgl",kernelFunc:zGe};var WGe=function(){function r(e,t,n){this.variableNames=["A"];var a=e.windowSize,i=e.batchSize,o=e.outSize;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `.concat(a,`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `).concat(a,`; i++) {
          int inIdx = `).concat(u,`;
          float candidate = getA(batch, inIdx);
          if (candidate `).concat(s,` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `)}return r}();var qGe=function(){function r(e,t,n,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,k.util.assert(e.length>2,function(){return"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2.")});var i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s=this.outputShape,u=s.length,c=$t(u),l=Sn("coords",u),f,h;if(o===1){h=u+1;var p=$t(h);f=`
        `.concat(p," sourceLocR = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-1],`;
        `).concat(p," sourceLocG = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-2],`;
        `).concat(p," sourceLocA = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-1],`;
        `).concat(p," sourceLocB = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-2],";")}else h=u,f=`
        `.concat(c,` sourceLocR = coords;
        ++`).concat(l[u-1],`;
        `).concat(c,` sourceLocG = coords;
        ++`).concat(l[u-2],`;
        `).concat(c,` sourceLocA = coords;
        --`).concat(l[u-1],`;
        `).concat(c,` sourceLocB = coords;
        --`).concat(l[u-2],";");var d=["x","y","z","w","u","v"].slice(0,h),m="."+d[h-1],v=d.map(function(C){return"int "+C}),g=Sn("sourceLocR",h-1).concat("inIdx.r"),y=Sn("sourceLocG",h-1).concat("inIdx.g"),w=Sn("sourceLocB",h-1).concat("inIdx.b"),b=Sn("sourceLocA",h-1).concat("inIdx.a"),x=n==="max"?"greaterThan":"lessThan",S=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`.concat(g.join(),`),
                             getBestIndicesAChannel(`).concat(y.join(),`),
                             getBestIndicesAChannel(`).concat(w.join(),`),
                             getBestIndicesAChannel(`).concat(b.join(),")));"),T=`vec4(
            getAChannel(`.concat(g.join(),`),
            hasNextCol ? getAChannel(`).concat(y.join(),`) : 0.,
            hasNextRow ? getAChannel(`).concat(w.join(),`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`).concat(b.join(),") : 0.)"),E=a?"":`
      float getBestIndicesAChannel(`.concat(v.join(),`) {
        return getChannel(getBestIndicesA(`).concat(d.join(),`),
                                          vec2(`).concat(d.slice(-2).join(),`));
      }`);this.userCode=`
      float getAChannel(`.concat(v.join(),`) {
        return getChannel(getA(`).concat(d.join(),`),
                               vec2(`).concat(d.slice(-2).join(),`));
      }
      `).concat(E,`
      void main() {
        `).concat(c,` coords = getOutputCoords();
        bool hasNextCol = `).concat(l[u-1]," < ").concat(s[u-1]-1,`;
        bool hasNextRow = `).concat(l[u-2]," < ").concat(s[u-2]-1,`;
        `).concat(f,`
        ivec4 srcIdx = ivec4(sourceLocR`).concat(m,", sourceLocG").concat(m,`,
          sourceLocB`).concat(m,", sourceLocA").concat(m,") * ").concat(t,`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `).concat(T,`;

        for (int i = 0; i < `).concat(t,`; i++) {
          inIdx = srcIdx;
          `).concat(S,`
          vec4 candidate = `).concat(T,`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`).concat(x,`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `)}return r}();function kU(r,e,t,n){n===void 0&&(n=null);var a=e.shape[0],i=e.shape[1];n!=null&&(a=n.shape[0],i=n.shape[1]);var o=k.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new WGe(s,t,n==null),c=[e];n!=null&&c.push(n);var l=r.runWebGLProgram(u,c,"int32");if(l.shape[1]===1)return l;var f=kU(r,e,t,l);return r.disposeIntermediateTensorInfo(l),f}function SU(r,e,t,n){n===void 0&&(n=null);var a=n!=null?n.shape:e.shape,i=a[a.length-1],o=k.backend_util.computeOptimalWindowSize(i),s=new qGe(a,o,t,n==null),u=n==null?[e]:[e,n],c=r.runWebGLProgram(s,u,"int32");if(c.shape.length===e.shape.length){var l=SU(r,e,t,c);return r.disposeIntermediateTensorInfo(c),l}return c}function NU(r,e,t,n){var a=[t];if(k.backend_util.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),a,e.shape.length),!k.env().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){var i=[],o=r.texData.get(e.dataId),s=o!==null&&o.isPacked,u=e;s&&(u=r.unpackTensor(e),i.push(u));var c=Te(k.backend_util.computeOutAndReduceShapes(u.shape,a),2),l=c[0],f=c[1],h=k.util.sizeFromShape(f),p=Ae({inputs:{x:u},backend:r,attrs:{shape:[-1,h]}});i.push(p);var d=kU(r,p,n);i.push(d);var m=Ae({inputs:{x:d},backend:r,attrs:{shape:l}});return i.forEach(function(v){return r.disposeIntermediateTensorInfo(v)}),m}return SU(r,e,n)}function UGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Tn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=NU(t,u,o[0],"max");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var VGe={kernelName:k.ArgMax,backendName:"webgl",kernelFunc:UGe};function GGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Tn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=NU(t,u,o[0],"min");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var HGe={kernelName:k.ArgMin,backendName:"webgl",kernelFunc:GGe};var KGe=ti+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,jGe=It({opSnippet:KGe}),XGe={kernelName:k.Asin,backendName:"webgl",kernelFunc:jGe};var YGe=ti+"return log(x + sqrt(x * x + 1.0));",ZGe=It({opSnippet:YGe}),JGe={kernelName:k.Asinh,backendName:"webgl",kernelFunc:ZGe};var QGe=ti+`
  return atan(x);
`,e6e=It({opSnippet:QGe}),t6e={kernelName:k.Atan,backendName:"webgl",kernelFunc:e6e};var r6e=ck+`
  return atan(a, b);
`,n6e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Eu+`
  return result;
`,a6e=ln({opSnippet:r6e,packedOpSnippet:n6e}),i6e={kernelName:k.Atan2,backendName:"webgl",kernelFunc:a6e};var o6e=ti+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,s6e=It({opSnippet:o6e}),u6e={kernelName:k.Atanh,backendName:"webgl",kernelFunc:s6e};var Th=function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var m=t==="avg",v="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),n){var w=">=";this.userCode=`
        const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
        const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `).concat(f,`;
              wR += `).concat(c,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(h,`;
                wC += `).concat(l,`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value `).concat(w,` currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `).concat(a?i?v:g:"wR * ".concat(h," + wC"),`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var b="max",x="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / max(count, 1.0)");var S=Math.floor(o/4)*4,T=o%4,E=`
      if (`.concat(m,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(b,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
      const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);
      const float initializationValue = `).concat(y,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(y,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `).concat(f,`;
            wR += `).concat(c,`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(S,`; wC += 4) {
            int xC = xCCorner + wC * `).concat(l,`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              getValue(batch, xR, xC + 3 * `).concat(l,`, d)
            );

            `).concat(E,`
          }

          int xC = xCCorner + `).concat(S,`;
          if (`).concat(T===1,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===2,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===3,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              initializationValue
            );

            `).concat(E,`
          }
        }
        setOutput(`).concat(x,`);
      }
    `)}return r}(),fk=function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,u=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,f=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,d=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var w=t==="avg",b="0.0";if(w||(b="-1.0 / 1e-20"),n){var x=">=";this.userCode=`
        const ivec3 strides =
            ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
        const ivec3 pads = ivec3(`).concat(v,", ").concat(g,", ").concat(y,`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `).concat(p,`;
              wD += `).concat(l,`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int wR = 0; wR < `).concat(d,`;
                wR += `).concat(f,`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int wC = 0; wC < `).concat(m,`;
                  wC += `).concat(h,`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value `).concat(x,` currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `).concat(a?i?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(d," * ").concat(m,` +
                      wR * `).concat(m," + wC"),`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var S="max",T="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(T="avgValue / max(count, 1.0)");var E=Math.floor(o/4)*4,C=o%4,R=`
      if (`.concat(w,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(S,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec3 strides =
        ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
      const ivec3 pads = ivec3(`).concat(v,", ").concat(g,", ").concat(y,`);
      const float initializationValue = `).concat(b,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(b,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `).concat(p,`;
            wD += `).concat(l,`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(d,`;
            wR += `).concat(f,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(E,`; wC += 4) {
              int xC = xCCorner + wC * `).concat(h,`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 3 * `).concat(h,`, ch)
              );

              `).concat(R,`
            }

            int xC = xCCorner + `).concat(E,`;
            if (`).concat(C===1,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `).concat(R,`
            } else if (`).concat(C===2,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                initializationValue,
                initializationValue
              );

              `).concat(R,`
            } else if (`).concat(C===3,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                initializationValue
              );

              `).concat(R,`
            }
          }
        }
        setOutput(`).concat(T,`);
      }
    `)}return r}();function c6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Xc(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return la({inputs:{x:a},backend:t});var f=new Th(l,"avg",!1);return t.runWebGLProgram(f,[a],"float32")}var l6e={kernelName:k.AvgPool,backendName:"webgl",kernelFunc:c6e};function f6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,u,c),h=new fk(f,"avg",!1);return t.runWebGLProgram(h,[a],"float32")}var h6e={kernelName:k.AvgPool3D,backendName:"webgl",kernelFunc:f6e};var p6e=function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=u-1-e.padInfo.top,f=c-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`.concat(l,", ").concat(f,`);
      const float avgMultiplier = float(`).concat(h,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(u,`;
            wR += `).concat(o,`) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(c,`;
            wC+= `).concat(s,`) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),d6e=function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=f-1-e.padInfo.front,m=h-1-e.padInfo.top,v=p-1-e.padInfo.left,g=1/(t*n*a);this.userCode=`
      const ivec3 pads = ivec3(`.concat(d,", ").concat(m,", ").concat(v,`);
      const float avgMultiplier = float(`).concat(g,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(f,`;
            wD += `).concat(u,`) {
          float dyD = float(dyDCorner + wD) / `).concat(i,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(h,`;
              wR += `).concat(c,`) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(p,`;
                wC += `).concat(l,`) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function v6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new d6e(h);return t.runWebGLProgram(p,[a],o.dtype)}var m6e={kernelName:k.AvgPool3DGrad,backendName:"webgl",kernelFunc:v6e};function g6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;Xc([a,i],"avgPoolGrad");var s=n.filterSize,u=n.strides,c=n.pad,l=k.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=new p6e(l);return t.runWebGLProgram(f,[a],o.dtype)}var y6e={kernelName:k.AvgPoolGrad,backendName:"webgl",kernelFunc:g6e};function b6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;return xm({a,b:i,transposeA:o,transposeB:s,backend:t})}var w6e={kernelName:k.BatchMatMul,backendName:"webgl",kernelFunc:b6e};var x6e=function(){function r(e,t,n,a,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,n);var s="0.0";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `.concat(s,`;
        float scale = `).concat(u,`;
        float inv = scale * inversesqrt(variance + float(`).concat(o,`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `)}return r}();var k6e=function(){function r(e,t,n,a,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,n);var s="vec4(0.0)";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `.concat(s,`;
        vec4 scale = `).concat(u,`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`).concat(o,`));

        setOutput((x - mean) * inv + offset);
      }
    `)}return r}();var S6e=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.mean,o=e.variance,s=e.offset,u=e.scale;k.util.assert(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),k.util.assert(s==null||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),k.util.assert(u==null||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var c=n.varianceEpsilon;c==null&&(c=.001);var l=[a,i,o],f=null;s!=null&&(f=s.shape,l.push(s));var h=null;u!=null&&(h=u.shape,l.push(u));var p=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new k6e(a.shape,i.shape,o.shape,f,h,c):new x6e(a.shape,i.shape,o.shape,f,h,c),d=t.runWebGLProgram(p,l,l[0].dtype);return d},N6e={kernelName:k.FusedBatchNorm,backendName:"webgl",kernelFunc:S6e};var T6e=function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=$t(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=E6e(this.rank),a,i=e.map(function(o,s){return"sourceLoc.".concat(jx[s]," = start[").concat(s,"] + coords.").concat(jx[s],";")});a=`
        `.concat(t,` sourceLoc;
        `).concat(t,` coords = getOutputCoords();
        `).concat(i.join(`
`),`
      `),this.userCode=`
      void main() {
        `.concat(a,`
        setOutput(getSource(`).concat(n,`));
      }
    `)}return r}(),jx=["x","y","z","w","u","v"];function E6e(r){if(r===1)return"sourceLoc";if(r<=6)return jx.slice(0,r).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank ".concat(r," is not yet supported"))}var I6e=function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var t=$t(this.rank),n=Sn("coords",this.rank),a=Sn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s=`
      result.x = `.concat(o,`;
      if (++`).concat(n[this.rank-1]," < ").concat(e[this.rank-1],`) {
        ++`).concat(a[this.rank-1],`;
        result.y = `).concat(o,`;
        --`).concat(a[this.rank-1],`;
      }
    `),u=this.rank===1?"":`
      --`.concat(n[this.rank-1],`;
      if (++`).concat(n[this.rank-2]," < ").concat(e[this.rank-2],`) {
        ++`).concat(a[this.rank-2],`;
        result.z = `).concat(o,`;
        if (++`).concat(n[this.rank-1]," < ").concat(e[this.rank-1],`) {
          ++`).concat(a[this.rank-1],`;
          result.w = `).concat(o,`;
        }
      }
    `),c=this.rank<=4?`sourceLoc = coords +
            `.concat(t,"(").concat(e.map(function(l,f){return"start[".concat(f,"]")}).join(),");"):e.map(function(l,f){return"".concat(a[f]," = ").concat(n[f]," + start[").concat(f,"];")}).join(`
`);this.userCode=`
      void main() {
        `.concat(t,` coords = getOutputCoords();
        `).concat(t,` sourceLoc;
        `).concat(c,`
        vec4 result = vec4(0.);
        `).concat(s,`
        `).concat(u,`
        setOutput(result);
      }
    `)}return r}();function C6e(r,e,t,n){var a=n.texData.get(r.dataId),i=n.makeTensorInfo(t,r.dtype),o=n.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=t,o.dtype=r.dtype;var s=k.slice_util.computeFlatOffset(e,k.util.computeStrides(r.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||r.dataId};var u=n.dataRefCount.get(o.slice.origDataId)||1;return n.dataRefCount.set(o.slice.origDataId,u+1),i}function rl(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size,s=Te(k.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];if(k.slice_util.assertParamsValid(a,u,c),k.util.sizeFromShape(c)===0)return t.makeTensorInfo(c,a.dtype,[]);if(t.shouldExecuteOnCPU([a])||a.dtype==="string"){var l=t.texData.get(a.dataId),f=yVe(l.values,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var h=t.texData.get(a.dataId).isPacked,p=k.slice_util.isSliceContinous(a.shape,u,c);if(h||!p){var d=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new I6e(c):new T6e(c),m=[u];return t.runWebGLProgram(d,[a],a.dtype,m)}return t.uploadToGPU(a.dataId),C6e(a,u,c,t)}var A6e={kernelName:k.Slice,backendName:"webgl",kernelFunc:rl};var D6e=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;k.util.assert(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,w){return y*w}),u=k.backend_util.getReshaped(a.shape,i,s),c=k.backend_util.getPermuted(u.length,i.length),l=k.backend_util.getReshapedPermuted(a.shape,i,s),f=k.backend_util.getSliceBeginCoords(o,i.length),h=k.backend_util.getSliceSize(l,o,i.length),p=[],d=Ae({inputs:{x:a},backend:t,attrs:{shape:u}}),m=Tn({inputs:{x:d},backend:t,attrs:{perm:c}}),v=Ae({inputs:{x:m},backend:t,attrs:{shape:l}}),g=rl({inputs:{x:v},backend:t,attrs:{begin:f,size:h}});return p.push(d),p.push(m),p.push(v),p.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},_6e={kernelName:k.BatchToSpaceND,backendName:"webgl",kernelFunc:D6e};function F6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=lU(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var R6e={kernelName:k.Bincount,backendName:"webgl",kernelFunc:F6e},O6e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,P6e=`
  return float(int(a.r) & int(b.r));
`;function M6e(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=k.env().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([n,a])||o===1){var s=t.texData.get(n.dataId).values,u=t.texData.get(a.dataId).values,c=Te(qUe(n.shape,a.shape,s,u,n.dtype),2),l=c[0],f=c[1],h=t.makeTensorInfo(f,n.dtype),p=t.texData.get(h.dataId);return p.values=l,h}var d;return i?d=new el(O6e,n.shape,a.shape,!1):d=new Su(P6e,n.shape,a.shape),t.runWebGLProgram(d,[n,a],n.dtype)}var B6e={kernelName:k.BitwiseAnd,backendName:"webgl",kernelFunc:M6e};function L6e(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.readSync(n.dataId),o=t.readSync(a.dataId),s=k.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var z6e={kernelName:k.BroadcastArgs,backendName:"webgl",kernelFunc:L6e};var $6e="return float(a != b);",TU=ln({opSnippet:$6e,cpuKernelImpl:cVe,dtype:"bool"}),W6e={kernelName:k.NotEqual,backendName:"webgl",kernelFunc:TU};function Ah(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return la({inputs:{x:a.complexTensorInfos.real},backend:t})}var q6e={kernelName:k.Real,backendName:"webgl",kernelFunc:Ah};var U6e="return float(int(x));";function V6e(r,e){var t=new $i(r.shape,U6e),n=e.runWebGLProgram(t,[r],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function Xx(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return la({inputs:{x:a},backend:t});var o=TWe.zeros(a.shape),s=Xx({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=hs({inputs:{real:s,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=Ah({inputs:{input:a},backend:t}),u=Xx({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!k.util.hasEncodingLoss(a.dtype,i)){var u=la({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}if(t.shouldExecuteOnCPU([a])){var l=t.texData.get(a.dataId).values,f=Te(UUe(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}if(i==="int32")return V6e(a,t);if(i==="bool"){var m=t.makeTensorInfo([],"bool",k.util.getTypedArrayFromDType("bool",1)),v={a,b:m},u=TU({inputs:v,backend:t});return t.disposeIntermediateTensorInfo(m),u}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var G6e={kernelName:k.Cast,backendName:"webgl",kernelFunc:Xx};var rq="return ceil(x);",H6e=It({opSnippet:rq,packedOpSnippet:rq,cpuKernelImpl:VUe}),K6e={kernelName:k.Ceil,backendName:"webgl",kernelFunc:H6e};var j6e=function(){function r(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r}();var X6e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r}();function Y6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.clipValueMin,o=n.clipValueMax,s;k.env().getBool("WEBGL_PACK_CLIP")?s=new X6e(a.shape):s=new j6e(a.shape);var u=[[i],[o]];return t.runWebGLProgram(s,[a],a.dtype,u)}var Z6e={kernelName:k.ClipByValue,backendName:"webgl",kernelFunc:Y6e};var J6e=function(){function r(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}return r}();function nq(r,e){return{dataId:e.dataId,dtype:e.dtype,shape:r.shape}}function Q6e(r){var e=r.inputs,t=r.backend,n=e.x,a=t.texData.get(n.dataId),i=new J6e(n.shape),o=[nq(n,a.complexTensorInfos.real),nq(n,a.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}var eHe={kernelName:k.ComplexAbs,backendName:"webgl",kernelFunc:Q6e};var tHe=function(){function r(e){this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,1),this.variableNames=e.map(function(u,c){return"T".concat(c)});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];for(var a=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")],n=1;n<t.length;n++){var i=t[n-1];a.push("else if (yC < ".concat(t[n],") ")+"setOutput(getT".concat(n,"(yR, yC-").concat(i,"));"))}var o=t.length,s=t[t.length-1];a.push("else setOutput(getT".concat(o,"(yR, yC-").concat(s,"));")),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `.concat(a.join(`
        `),`
      }
    `)}return r}();var rHe=function(){function r(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,t);var n=this.outputShape,a=n.length,i=$t(a),o=Sn("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(function(g,y){return"T".concat(y)});var u=new Array(e.length-1);u[0]=e[0][t];for(var c=1;c<u.length;c++)u[c]=u[c-1]+e[c][t];for(var l=s[t],f=s.slice(-2),h=s.join(),p="if (".concat(l," < ").concat(u[0],`) {
        return getChannel(
            getT0(`).concat(h,"), vec2(").concat(f.join(),`));
        }`),c=1;c<u.length;c++){var d=u[c-1];p+=`
        if (`.concat(l," < ").concat(u[c],"  && ").concat(l," >= ").concat(u[c-1],`) {
          return getChannel(
            getT`).concat(c,"(").concat(dm(s,l,d),`),
            vec2(`).concat(dm(f,l,d),`));
        }`)}var m=u.length,v=u[u.length-1];p+=`
        return getChannel(
          getT`.concat(m,"(").concat(dm(s,l,v),`),
          vec2(`).concat(dm(f,l,v),"));"),this.userCode=`
      float getValue(`.concat(s.map(function(g){return"int "+g}),`) {
        `).concat(p,`
      }

      void main() {
        `).concat(i,` coords = getOutputCoords();
        vec4 result = vec4(getValue(`).concat(o,`), 0., 0., 0.);

        `).concat(o[a-1]," = ").concat(o[a-1],` + 1;
        if (`).concat(o[a-1]," < ").concat(n[a-1],`) {
          result.g = getValue(`).concat(o,`);
        }

        `).concat(o[a-2]," = ").concat(o[a-2],` + 1;
        if (`).concat(o[a-2]," < ").concat(n[a-2],`) {
          result.a = getValue(`).concat(o,`);
        }

        `).concat(o[a-1]," = ").concat(o[a-1],` - 1;
        if (`).concat(o[a-2]," < ").concat(n[a-2],` &&
            `).concat(o[a-1]," < ").concat(n[a-1],`) {
          result.b = getValue(`).concat(o,`);
        }
        setOutput(result);
      }
    `)}return r}();function dm(r,e,t){var n=r.indexOf(e),a=r.map(function(i,o){return o===n?"".concat(i," - ").concat(t):i});return a.join()}function Im(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return la({inputs:{x:a.complexTensorInfos.imag},backend:t})}var nHe={kernelName:k.Imag,backendName:"webgl",kernelFunc:Im};function xh(r,e,t){var n,a,i=r[0].dtype;if(i==="complex64"){var o=r.map(function(U){return Ah({inputs:{input:U},backend:t})}),s=r.map(function(U){return Im({inputs:{input:U},backend:t})}),u=xh(o,e,t),c=xh(s,e,t),l=hs({inputs:{real:u,imag:c},backend:t});return o.forEach(function(U){return t.disposeIntermediateTensorInfo(U)}),s.forEach(function(U){return t.disposeIntermediateTensorInfo(U)}),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),l}var f=t.shouldExecuteOnCPU(r);if(i==="string"&&(f=!0),f){var h=r.map(function(U){var j=k.util.sizeFromShape(U.shape.slice(e)),ne=[-1,j];return Ae({inputs:{x:U},backend:t,attrs:{shape:ne}})}),p=h.map(function(U){return{vals:t.readSync(U.dataId),shape:U.shape}}),d=k.backend_util.computeOutShape(h.map(function(U){return U.shape}),1),m=h[0].shape[0]===1,v=GUe(p,d,i,m),g=k.backend_util.computeOutShape(r.map(function(U){return U.shape}),e),y=t.makeTensorInfo(g,i,v);return h.forEach(function(U){return t.disposeIntermediateTensorInfo(U)}),y}var w=r.filter(function(U){return k.util.sizeFromShape(U.shape)>0}),b=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&w[0].shape.length>1;if(w.length===1){var x=b?new $i(r[0].shape,ls):new fs(r[0].shape,ls);return t.runWebGLProgram(x,r,i)}var S=k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(w.length>S){for(var T=[],E=0;E<w.length;E+=S){var C=w.slice(E,E+S);T.push(xh(C,e,t))}var R=xh(T,e,t);try{for(var _=Nn(T),P=_.next();!P.done;P=_.next()){var E=P.value;t.disposeIntermediateTensorInfo(E)}}catch(U){n={error:U}}finally{try{P&&!P.done&&(a=_.return)&&a.call(_)}finally{if(n)throw n.error}}return R}if(b){var $=new rHe(w.map(function(U){return U.shape}),e);return t.runWebGLProgram($,w,i)}var z=aHe(w,e,t),L=z.tensors2D,B=z.outShape,q=new tHe(L.map(function(U){return U.shape})),Y=t.runWebGLProgram(q,L,i);L.forEach(function(U){return t.disposeIntermediateTensorInfo(U)});var J=Ae({inputs:{x:Y},attrs:{shape:B},backend:t});return t.disposeIntermediateTensorInfo(Y),J}function aHe(r,e,t){var n=k.backend_util.computeOutShape(r.map(function(i){return i.shape}),e),a=r.map(function(i){return Ae({inputs:{x:i},attrs:{shape:[-1,k.util.sizeFromShape(i.shape.slice(e))]},backend:t})});return{tensors2D:a,outShape:n}}function EU(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=k.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(c){return c.shape});k.backend_util.assertParamsConsistent(o,i);var s=k.backend_util.computeOutShape(e.map(function(c){return c.shape}),i);if(k.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(c){return k.util.sizeFromShape(c.shape)>0});return u.length===1?la({inputs:{x:u[0]},backend:t}):xh(u,i,t)}var iHe={kernelName:k.Concat,backendName:"webgl",kernelFunc:EU};var IU=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,v=e.dataFormat==="channelsLast",g=v?1:2,y=v?2:3,w=v?3:1,b="",x="";n&&(a?b=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?b=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):b=`
          float activation(float x) {
            `.concat(n,`
          }
        `),x="result = activation(result);");var S=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(b,`

      const ivec2 strides = ivec2(`).concat(u,", ").concat(c,`);
      const ivec2 pads = ivec2(`).concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`).concat(w,`];

        ivec2 xRCCorner =
            ivec2(coords[`).concat(g,"], coords[").concat(y,`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(h,`; wR++) {
          int xR = xRCorner + wR * `).concat(l,`;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(p,`; wC++) {
            int xC = xCCorner + wC * `).concat(f,`;

            if (xC < 0 || xC >= `).concat(e.inWidth,`) {
              continue;
            }

            for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`).concat(v,`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`).concat(m===1,`) {

              if (`).concat(v,`) {
                dotProd +=
                    getX(batch, xR, xC, `).concat(d,`) *
                    getW(wR, wC, `).concat(d,`, d2);
              } else {
                dotProd +=
                    getX(batch, `).concat(d,`, xR, xC) *
                    getW(wR, wC, `).concat(d,`, d2);
              }

            } else if (`).concat(m===2,`) {
              vec2 wValues = vec2(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2)
              );

              if (`).concat(v,`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`).concat(m===3,`) {
              vec3 wValues = vec3(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2),
                getW(wR, wC, `).concat(d,` + 2, d2)
              );

              if (`).concat(v,`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1),
                  getX(batch, xR, xC, `).concat(d,` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC),
                  getX(batch, `).concat(d,` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `).concat(S,`
        `).concat(x,`
        setOutput(result);
      }
    `)}return r}(),oHe=function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,a=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.filterDepth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`.concat(i,", ").concat(o,", ").concat(s,`);
      const ivec3 pads = ivec3(`).concat(t,", ").concat(n,", ").concat(a,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(f,`; wF++) {
          int xF = xFCorner + wF * `).concat(u,`;

          if (xF < 0 || xF >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(h,`; wR++) {
            int xR = xRCorner + wR * `).concat(c,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(p,`; wC++) {
              int xC = xCCorner + wC * `).concat(l,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`).concat(m===1,`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `).concat(d,`) *
                  getW(wF, wR, wC, `).concat(d,`, d2);
              } else if (`).concat(m===2,`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`).concat(m===3,`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1),
                  getX(batch, xF, xR, xC, `).concat(d,` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2),
                  getW(wF, wR, wC, `).concat(d,` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();var CU=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=vn(this.outputShape.length);for(var o=e.padInfo.left,s=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,l=e.filterWidth,f=l,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`,p=0;p<l;p++)h+=`
           vec4 xTexelC`.concat(p*2,`;
           int xTexelC`).concat(p*2,`Ready;
           vec4 xTexelC`).concat(p*2+1,`;
           int xTexelC`).concat(p*2+1,`Ready;
           vec4 xC`).concat(p,";");h+=`
     for (int r = 0; r < `.concat(c,`; r++) {
      for (int d1 = 0; d1 < `).concat(e.inChannels,`; d1 += 2) {
       `);for(var p=0;p<l;p++)h+=`
           xTexelC`.concat(p*2,` = vec4(0.0);
           xTexelC`).concat(p*2,`Ready = 0;
           xTexelC`).concat(p*2+1,` = vec4(0.0);
           xTexelC`).concat(p*2+1,`Ready = 0;
           xC`).concat(p," = vec4(0.0);");h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(var d=0;d<(f+1)/2;d++){var m=d*2;if(h+=`
           xC = xCCorner + `.concat(m*u,`;
           `),s===1){if(m<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }
               `),u===1&&m>0?h+=`
                 xC`.concat(m," = vec4(xTexelC").concat(m-2,".zw, xTexelC").concat(m,`.xy);
                 `):h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC`.concat(m," = vec4(previous.zw, xTexelC").concat(m,`.xy);
                   } else {
                     xC`).concat(m," = vec4(0.0, 0.0, xTexelC").concat(m,`.xy);
                   }
                   `)):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 xC`).concat(m," = xTexelC").concat(m,`;
                 `),m+1<l)){var v=o%2===0?k.util.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + `.concat(v,`;

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                     xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC`).concat(m+1,`.zw = vec2(0.0);
                     }
                     xTexelC`).concat(m+1,`Ready = 1;
                   }
                   `),u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC`.concat(m+1," = vec4(previous.zw, xTexelC").concat(m+1,`.xy);
                     } else {
                      xC`).concat(m+1," = vec4(0.0, 0.0, xTexelC").concat(m+1,`.xy);
                     }
                     `):h+=`
                     xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.xy);
                     `)):v===1?h+=`
                     xC`.concat(m+1," = xTexelC").concat(m,`;
                     `):h+=`
                     xCOffset = xC + `.concat(v,`;

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                       xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC`).concat(m+1,`.zw = vec2(0.0);
                       }
                       xTexelC`).concat(m+1,`Ready = 1;
                     }

                     xC`).concat(m+1," = xTexelC").concat(m+1,`;
                     `)}}else m<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                   xTexelC`).concat(m+1,` = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC`).concat(m+1,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m+1,`Ready = 1;
                 }

                 xC`).concat(m," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
               `),m+1<l&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC`.concat(m+1," = vec4(xTexelC").concat(m+1,`.xy, final.xy);
                 `))):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                   xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m+1,`.zw = vec2(0.);
                   }
                   xTexelC`).concat(m+1,`Ready = 1;
                 }

                 xC`).concat(m,` = vec4(
                   xTexelC`).concat(m,".xy, xTexelC").concat(m+1,`.xy);
               `),m+1<l&&(h+=`
                   xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
                 `))));m<l&&(h+=`
             wTexel = getW(r, `.concat(m,`, d1, d2);
             dotProd += xC`).concat(m,`.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < `).concat(e.inChannels,`) {
               dotProd += xC`).concat(m,`.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `),m+1<l&&(h+=`
               wTexel = getW(r, `.concat(m+1,`, d1, d2);
               dotProd += xC`).concat(m+1,`.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < `).concat(e.inChannels,`) {
                 dotProd += xC`).concat(m+1,`.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `)))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;var g="",y="";n&&(a?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           `.concat(n,`
         }`):i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           `.concat(n,`
         }`):g=`vec4 activation(vec4 x) {
           `.concat(n,`
         }`),y="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       `.concat(g,`

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         `).concat(h,`

         vec4 result = dotProd - vec4(0.000000000000001);
         `).concat(w,`
         `).concat(y,`
         setOutput(result);
       }
     `)}return r}();var sHe=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=vn(this.outputShape.length);for(var n=t.dataFormat,a=En(),i=n==="channelsLast",o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {"),c="",l=0;l<=1;l++)for(var f=0;f<=1;f++)c+=`
          blockIndex = rc.z + `.concat(f,`;
          pos = rc.y + `).concat(l,`;

          `).concat(u,`
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[`).concat(o,`] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[`).concat(s,`] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (`).concat(i,`) {
                  innerDims = vec2(d1, ch);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `);this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `.concat(c,`

        `).concat(a.output,` = result;
      }
    `)}return r}();function km(r,e){var t=r.length;return t>=3?e?mr(mr([],Te(r.slice(0,-3)),!1),[r[t-3]*r[t-2],r[t-1]],!1):mr(mr([],Te(r.slice(0,-3)),!1),[r[t-3],r[t-2]*r[t-1]],!1):!e&&t===1&&r[0]>1?[r[0],1]:null}function AU(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,c=r.preluActivationWeights,l=c===void 0?null:c,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=n.shape,v=o.texData.get(n.dataId),g=i.inChannels,y=m[0]*m[1]*m[2],w=i.outChannels,b=i.dataFormat==="channelsLast",x=!1,S=!1,T,E=[];if(l!=null){var C=km(l.shape,b);C!=null&&(l=Ae({inputs:{x:l},backend:o,attrs:{shape:C}}),E.push(l))}if(u!=null){var C=km(u.shape,b);C!=null&&(u=Ae({inputs:{x:u},backend:o,attrs:{shape:C}}),E.push(u))}var R=(y===1||w===1)&&g>xU,_=!R&&v.isPacked&&b&&v.texture!=null&&m[2]%2!==0&&k.util.arraysEqual(v.shape.slice(-3),m.slice(-3));if(_){var C=m[0]*m[1]*(m[2]+1),P={dataId:n.dataId,shape:[1,C,i.inChannels],dtype:n.dtype},$=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,k.util.assert(Sh(v.shape,P.shape),function(){return"packed reshape ".concat(v.shape," to ").concat(P.shape," isn't free")});var z=Ae({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});E.push(z);var L=xm({a:P,b:z,backend:o,transposeA:x,transposeB:S,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h}),B=o.texData.get(L.dataId);k.util.assert(B.isPacked,function(){return"batchMatMul result is expected to be packed"}),v.shape=$,B.shape=i.outShape,T=la({inputs:{x:L},backend:o}),T.shape=i.outShape,E.push(L)}else{var q=i.outHeight*i.outWidth,Y=Ae({inputs:{x:n},backend:o,attrs:{shape:b?[i.batchSize,q,i.inChannels]:[i.batchSize,i.inChannels,q]}}),z=Ae({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),J=xm({a:b?Y:z,b:b?z:Y,transposeA:!b,transposeB:S,backend:o,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h});T=Ae({inputs:{x:J},backend:o,attrs:{shape:i.outShape}}),E.push(Y),E.push(z),E.push(J)}try{for(var U=Nn(E),j=U.next();!j.done;j=U.next()){var ne=j.value;o.disposeIntermediateTensorInfo(ne)}}catch(re){e={error:re}}finally{try{j&&!j.done&&(t=U.return)&&t.call(U)}finally{if(e)throw e.error}}return T}function DU(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,c=r.preluActivationWeights,l=c===void 0?null:c,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=i.filterWidth,v=i.filterHeight,g=i.inChannels,y=i.outWidth,w=i.outHeight,b=i.dataFormat,x=b==="channelsLast",S=m*v*g,T=w*y,E=[i.batchSize,S,T],C=!0,R=!1,_=[];if(l!=null){var P=km(l.shape,x);P!=null&&(l=Ae({inputs:{x:l},backend:o,attrs:{shape:P}}),_.push(l))}if(u!=null){var P=km(u.shape,x);P!=null&&(u=Ae({inputs:{x:u},backend:o,attrs:{shape:P}}),_.push(u))}var $=Ae({inputs:{x:a},backend:o,attrs:{shape:[1,S,k.util.sizeFromShape(a.shape)/S]}});_.push($);var z=new sHe(E,i),L=[n.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],B=o.runWebGLProgram(z,[n],"float32",L),q=Ae({inputs:{x:B},backend:o,attrs:{shape:E}});_.push(B),_.push(q);var Y=u!=null,J=l!=null,U=d==="leakyrelu",j=d?Nh(d,!0):null,ne=new wU(x?q.shape:$.shape,x?$.shape:q.shape,x?[i.batchSize,T,i.outChannels]:[i.batchSize,i.outChannels,T],C,R,Y,j,J,U),re=x?[q,$]:[$,q];if(u&&re.push(u),J&&re.push(l),U){var se=o.makeTensorInfo([],"float32",k.util.createScalarValue(h,"float32"));re.push(se),_.push(se)}var le=o.runWebGLProgram(ne,re,"float32"),de=Ae({inputs:{x:le},backend:o,attrs:{shape:i.outShape}});_.push(le);try{for(var ke=Nn(_),he=ke.next();!he.done;he=ke.next()){var ye=he.value;o.disposeIntermediateTensorInfo(ye)}}catch(xe){e={error:xe}}finally{try{he&&!he.done&&(t=ke.return)&&t.call(ke)}finally{if(e)throw e.error}}return de}function uHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dilations,l=n.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=AU({x:a,filter:i,convInfo:h,backend:t});else if(h.strideWidth<=2&&f==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var d=new CU(h),m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=t.runWebGLProgram(d,[a,i],"float32",m)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))p=DU({x:a,filter:i,convInfo:h,backend:t});else{var d=new IU(h);p=t.runWebGLProgram(d,[a,i],"float32")}var v=Ae({inputs:{x:p},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(p),v}var cHe={kernelName:k.Conv2D,backendName:"webgl",kernelFunc:uHe};var lHe=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(n," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              `).concat(o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`,`
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),fHe=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",s=t-1-e.padInfo.top,u=n-1-e.padInfo.left,c=o?1:2,l=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`).concat(f,`];

        ivec2 dyCorner = ivec2(coords[`).concat(c,"], coords[").concat(l,`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(n,` - 1 - wC;

            for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {

              if (`).concat(o,`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),hHe=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yF = 0; yF < `).concat(e.outDepth,`; yF++) {
            int xF = wF + yF * `).concat(t," - ").concat(i,`;

            if (xF < 0 || xF >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
              int xR = wR + yR * `).concat(n," - ").concat(o,`;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
                int xC = wC + yC * `).concat(a," - ").concat(s,`;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),pHe=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=t-1-e.padInfo.front,c=n-1-e.padInfo.top,l=a-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`.concat(u,", ").concat(c,", ").concat(l,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(t,`; wF++) {
          float dyF = float(dyFCorner + wF) / `).concat(i,`.0;

          if (dyF < 0.0 || dyF >= `).concat(e.outDepth,`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `).concat(t,` - 1 - wF;

          for (int wR = 0; wR < `).concat(n,`; wR++) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `).concat(n,` - 1 - wR;

            for (int wC = 0; wC < `).concat(a,`; wC++) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `).concat(a,` - 1 - wC;

              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function dHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=n.filterShape,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=new lHe(h);return t.runWebGLProgram(p,[a,i],"float32")}var vHe={kernelName:k.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:dHe};var mHe=function(){function r(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=vn(this.outputShape.length);var t=e.filterHeight,n=e.filterWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`.concat(a,", ").concat(i,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            int wCPerm = `).concat(n,` - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < `).concat(e.outWidth,`.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < `).concat(e.outWidth,`.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `)}return r}();function gHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(c),h=k.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f);if(k.env().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){var p=[[h.strideHeight,h.strideWidth]],d=new mHe(h);return t.runWebGLProgram(d,[a,i],"float32",p)}else{var d=new fHe(h);return t.runWebGLProgram(d,[a,i],"float32")}}var yHe={kernelName:k.Conv2DBackpropInput,backendName:"webgl",kernelFunc:gHe};function bHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=k.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new oHe(c);return t.runWebGLProgram(l,[a,i],"float32")}var wHe={kernelName:k.Conv3D,backendName:"webgl",kernelFunc:bHe};function xHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape,c=k.backend_util.computeConv3DInfo(a.shape,u,o,1,s),l=new hHe(c);return t.runWebGLProgram(l,[a,i],"float32")}var kHe={kernelName:k.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:xHe};function SHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape,c=k.backend_util.computeConv3DInfo(u,i.shape,s,1,o),l=new pHe(c);return t.runWebGLProgram(l,[a,i],"float32")}var NHe={kernelName:k.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:SHe};var THe=tl+`
  return cos(x);
`,EHe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  `.concat(Eu,`
  return result;
`),IHe=It({opSnippet:THe,packedOpSnippet:EHe}),CHe={kernelName:k.Cos,backendName:"webgl",kernelFunc:IHe};var AHe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,DHe=It({opSnippet:AHe}),_He={kernelName:k.Cosh,backendName:"webgl",kernelFunc:DHe};var FHe=function(){function r(e,t,n,a,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3],f=Te(t,1),h=f[0],p=Te(n,2),d=p[0],m=p[1];this.outputShape=[h,d,m,l];var v=a==="bilinear"?1:0,g=Te(["".concat(u-1,".0"),"".concat(c-1,".0")],2),y=g[0],w=g[1],b=Te(d>1?["".concat((u-1)/(d-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],3),x=b[0],S=b[1],T=b[2],E=Te(m>1?["".concat((c-1)/(m-1)),"(x2-x1) * width_ratio","x1*".concat(w," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(w)],3),C=E[0],R=E[1],_=E[2];this.userCode=`
      const float height_ratio = float(`.concat(x,`);
      const float width_ratio = float(`).concat(C,`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `).concat(s,`) {
          return;
        }

        float height_scale = `).concat(S,`;
        float width_scale = `).concat(R,`;

        float in_y = `).concat(T,`;
        if( in_y < 0.0 || in_y > `).concat(y,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }
        float in_x = `).concat(_,`;
        if( in_x < 0.0 || in_x > `).concat(w,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`).concat(v,` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `)}return r}();var RHe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,c=n.extrapolationValue,l=new FHe(a.shape,i.shape,s,u,c);return t.runWebGLProgram(l,[a,i,o],"float32")},OHe={kernelName:k.CropAndResize,backendName:"webgl",kernelFunc:RHe},Eh;(function(r){r.Prod="*",r.Sum="+"})(Eh||(Eh={}));var aq=function(){function r(e,t,n,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===Eh.Prod?"1.0":"0.0",s=n?o:"getX(".concat(iq(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";n?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        `.concat($t(i),` coords = getOutputCoords();
        int end = `).concat(oq(i,"coords",this.op),`;
        float val = `).concat(s,`;
        int pow2 = int(pow(2.0, index));
        if (`).concat(c,`) {
          int idx = `).concat(l,`;
          `).concat(oq(i,"coords",this.op),` = idx;
          val `).concat(this.op,"= getX(").concat(iq(i,"coords",this.op),`);
        }
        setOutput(val);
      }
    `)}return r}();function iq(r,e,t){if(r===1)return"".concat(e);if(r===2)return"".concat(e,".x, ").concat(e,".y");if(r===3)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z");if(r===4)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z, ").concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(r," is not yet supported"))}function oq(r,e,t){if(r===1)return"".concat(e);if(r===2)return"".concat(e,".y");if(r===3)return"".concat(e,".z");if(r===4)return"".concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(r," is not yet supported"))}function _U(r,e,t,n,a,i){var o=e.shape.length,s=k.backend_util.getAxesPermutation([n],o),u=e;s!=null&&(u=Tn({inputs:{x:e},backend:t,attrs:{perm:s}}));var c=k.backend_util.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(e.shape.length-1," ")+"but got axis=".concat(n));for(var l=u.shape[c],f=la({inputs:{x:u},backend:t}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var p=new aq(r,u.shape,!1,i),d=[[h]],m=f;f=t.runWebGLProgram(p,[f],f.dtype,d),t.disposeIntermediateTensorInfo(m)}if(a){var p=new aq(r,u.shape,a,i),m=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(m)}if(s!=null){var v=k.backend_util.getUndoAxesPermutation(s),g=Tn({inputs:{x:f},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}function PHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return _U(Eh.Prod,a,t,i,o,s)}var MHe={kernelName:k.Cumprod,backendName:"webgl",kernelFunc:PHe};function BHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return _U(Eh.Sum,a,t,i,o,s)}var LHe={kernelName:k.Cumsum,backendName:"webgl",kernelFunc:BHe};function zHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=lU(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=WUe(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var $He={kernelName:k.DenseBincount,backendName:"webgl",kernelFunc:zHe};var WHe=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `.concat(this.getHeightCoordString(),`;
      int w = `).concat(this.getWidthCoordString(),`;
      int d = `).concat(this.getDepthCoordString(),`;

      int in_h = h / `).concat(t,`;
      int offset_h = imod(h, `).concat(t,`);
      int in_w = w / `).concat(t,`;
      int offset_w = imod(w, `).concat(t,`);
      int offset_d = (offset_h * `).concat(t,` + offset_w) *
        `).concat(this.getOutputDepthSize(),`;
      int in_d = d + offset_d;

      float result = `).concat(this.getInputSamplingString(),`;
      setOutput(result);
    }
  `)}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}();function qHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat,s=a.shape[0],u=o==="NHWC"?a.shape[1]:a.shape[2],c=o==="NHWC"?a.shape[2]:a.shape[3],l=o==="NHWC"?a.shape[3]:a.shape[1],f=u*i,h=c*i,p=l/(i*i),d=o==="NHWC"?[s,f,h,p]:[s,p,f,h],m=new WHe(d,i,o);return t.runWebGLProgram(m,[a],a.dtype)}var UHe={kernelName:k.DepthToSpace,backendName:"webgl",kernelFunc:qHe};var FU=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=vn(this.outputShape.length);var o=e.filterHeight,s=e.filterWidth,u=e.outChannels/e.inChannels,c="",l="";n&&(a?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):c=`
          float activation(float x) {
            `.concat(n,`
          }
        `),l="result = activation(result);");var f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(c,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(u,`;
        int q = d2 - d1 * `).concat(u,`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `).concat(o,`; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < `).concat(s,`; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `).concat(f,`
        `).concat(l,`
        setOutput(result);
      }
    `)}return r}();var RU=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=vn(this.outputShape.length);for(var o=e.outChannels/e.inChannels,s=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,h=f,p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`,d=0;d<f;d++)p+=`
          vec4 xTexelC`.concat(d*2,`;
          int xTexelC`).concat(d*2,`Ready;
          vec4 xTexelC`).concat(d*2+1,`;
          int xTexelC`).concat(d*2+1,`Ready;
          vec4 xC`).concat(d,";");p+=`
    for (int r = 0; r < `.concat(l,`; r++) {
      `);for(var d=0;d<f;d++)p+=`
          xTexelC`.concat(d*2,` = vec4(0.0);
          xTexelC`).concat(d*2,`Ready = 0;
          xTexelC`).concat(d*2+1,` = vec4(0.0);
          xTexelC`).concat(d*2+1,`Ready = 0;
          xC`).concat(d," = vec4(0.0);");p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(var m=0;m<(h+1)/2;m++){var v=m*2;if(p+=`
          xC = xCCorner + `.concat(v*c,`;
          `),u===1){if(v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }
              `),c===1&&v>0?p+=`
                xC`.concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,`.xy);
                `):p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC`.concat(v," = vec4(previous.zw, xTexelC").concat(v,`.xy);
                  } else {
                    xC`).concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,`.xy);
                  }
                  `)):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                xC`).concat(v," = xTexelC").concat(v,`;
                `),v+1<f)){var g=s%2===0?k.util.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + `.concat(g,`;

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                    xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC`).concat(v+1,`.zw = vec2(0.0);
                    }
                    xTexelC`).concat(v+1,`Ready = 1;
                  }
                  `),c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC`.concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,`.xy);
                    } else {
                     xC`).concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,`.xy);
                    }
                    `):p+=`
                    xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.xy);
                    `)):g===1?p+=`
                    xC`.concat(v+1," = xTexelC").concat(v,`;
                    `):p+=`
                    xCOffset = xC + `.concat(g,`;

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                      xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC`).concat(v+1,`.zw = vec2(0.0);
                      }
                      xTexelC`).concat(v+1,`Ready = 1;
                    }

                    xC`).concat(v+1," = xTexelC").concat(v+1,`;
                    `)}}else v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                  xTexelC`).concat(v+1,` = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC`).concat(v+1,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v+1,`Ready = 1;
                }

                xC`).concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
              `),v+1<f&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC`.concat(v+1," = vec4(xTexelC").concat(v+1,`.xy, final.xy);
                `))):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                  xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v+1,`.zw = vec2(0.);
                  }
                  xTexelC`).concat(v+1,`Ready = 1;
                }

                xC`).concat(v,` = vec4(
                  xTexelC`).concat(v,".xy, xTexelC").concat(v+1,`.xy);
              `),v+1<f&&(p+=`
                  xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
                `))));v<f&&(p+=`
            wTexel = getW(r, `.concat(v,`, d1, q);
            dotProd += xC`).concat(v,` * vec4(wTexel.xz, wTexel.xz);
          `),v+1<f&&(p+=`
              wTexel = getW(r, `.concat(v+1,`, d1, q);
              dotProd += xC`).concat(v+1,` * vec4(wTexel.xz, wTexel.xz);
            `)))}p+=`
    }
  `,p+=`
      }
    `;var y="",w="";n&&(a?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):y=`vec4 activation(vec4 x) {
          `.concat(n,`
        }`),w="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(y,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(o,`;
        int q = d2 - d1 * `).concat(o,`;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        `).concat(p,`

        vec4 result = dotProd - vec4(0.000000000000001);
        `).concat(b,`
        `).concat(w,`
        setOutput(result);
      }
    `)}return r}();function VHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=n.dimRoundingMode,l=u;l==null&&(l=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0),h;k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new RU(f):h=new FU(f);var p=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(h,[a,i],"float32",p)}var GHe={kernelName:k.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:VHe};var HHe=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `.concat(o,` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `).concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(n," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),KHe=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`.concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(n,` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `).concat(u,`; dm++) {
              int d2 = d1 * `).concat(u,` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function jHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.filterShape,f=k.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=new HHe(f);return t.runWebGLProgram(h,[a,i],"float32")}var XHe={kernelName:k.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:jHe};function YHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.inputShape,f=k.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new KHe(f);return t.runWebGLProgram(h,[a,i],"float32")}var ZHe={kernelName:k.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:YHe};var JHe=function(){function r(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}return r}();function QHe(r){var e=r.inputs,t=r.backend,n=e.x,a=mr(mr([],Te(n.shape),!1),Te(n.shape),!1),i=k.util.sizeFromShape(n.shape),o=Ae({inputs:{x:n},backend:t,attrs:{shape:[i]}}),s=new JHe(i),u=t.runWebGLProgram(s,[o],o.dtype),c=Ae({inputs:{x:u},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),c}var e5e={kernelName:k.Diag,backendName:"webgl",kernelFunc:QHe};var t5e=function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,a=e.padInfo,i=e.strideHeight,o=e.strideWidth,s=e.filterHeight,u=e.filterWidth,c=e.dilationHeight,l=e.dilationWidth,f=a.top,h=a.left;this.userCode=`
      const ivec2 strides = ivec2(`.concat(i,", ").concat(o,`);
      const ivec2 pads = ivec2(`).concat(f,", ").concat(h,`);
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < `).concat(s,`; h++) {
          int hIn = hBeg + h * `).concat(c,`;

          if (hIn >= 0 && hIn < `).concat(t,`) {
            for (int w = 0; w < `).concat(u,`; w++) {
              int wIn = wBeg + w * `).concat(l,`;

              if (wIn >= 0 && wIn < `).concat(n,`) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `)}return r}();function r5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=k.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),l,f=new t5e(c);l=t.runWebGLProgram(f,[a,i],"float32");var h=Ae({inputs:{x:l},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(l),h}var n5e={kernelName:k.Dilation2D,backendName:"webgl",kernelFunc:r5e};function a5e(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,c=i,l=k.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;k.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=k.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,w=f.length,b=[],x=0;x<g;++x){try{for(var S=(e=void 0,Nn(v[x])),T=S.next();!T.done;T=S.next()){var E=T.value,C=k.backend_util.getEinsumPermutation(w,p[E]),R=C.permutationIndices,_=C.expandDims,P=void 0;k.backend_util.isIdentityPermutation(R)?P=c[E]:(P=Tn({inputs:{x:c[E]},backend:o,attrs:{perm:R}}),b.push(P));for(var $=P.shape.slice(),z=0;z<_.length;++z)$.splice(_[z],0,1);k.util.arraysEqual(P.shape,$)||(P=Ae({inputs:{x:P},backend:o,attrs:{shape:$}}),b.push(P)),y===null?y=P:(y=lk({inputs:{a:P,b:y},backend:o}),b.push(y))}}catch(Y){e={error:Y}}finally{try{T&&!T.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=Em({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-w),keepDims:!1}}),b.push(y)),w--)}try{for(var L=Nn(b),B=L.next();!B.done;B=L.next()){var q=B.value;q!==y&&o.disposeIntermediateTensorInfo(q)}}catch(Y){n={error:Y}}finally{try{B&&!B.done&&(a=L.return)&&a.call(L)}finally{if(n)throw n.error}}return y}var i5e={kernelName:k.Einsum,backendName:"webgl",kernelFunc:a5e};var o5e="return (x >= 0.0) ? x : (exp(x) - 1.0);",s5e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,u5e=It({opSnippet:o5e,packedOpSnippet:s5e}),c5e={kernelName:k.Elu,backendName:"webgl",kernelFunc:u5e};var l5e="return (b >= 0.0) ? a : a * (b + 1.0);",f5e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,h5e=function(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new el(f5e,n.shape,a.shape):new Su(l5e,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],n.dtype)},p5e={kernelName:k.EluGrad,backendName:"webgl",kernelFunc:h5e};var d5e=`
  return vec4(equal(a, b));
`,v5e="return float(a == b);",m5e=ln({opSnippet:v5e,packedOpSnippet:d5e,dtype:"bool",cpuKernelImpl:HUe}),g5e={kernelName:k.Equal,backendName:"webgl",kernelFunc:m5e};var y5e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `.concat(k.backend_util.ERF_P,`;
  float a1 = `).concat(k.backend_util.ERF_A1,`;
  float a2 = `).concat(k.backend_util.ERF_A2,`;
  float a3 = `).concat(k.backend_util.ERF_A3,`;
  float a4 = `).concat(k.backend_util.ERF_A4,`;
  float a5 = `).concat(k.backend_util.ERF_A5,`;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`),b5e=It({opSnippet:y5e}),w5e={kernelName:k.Erf,backendName:"webgl",kernelFunc:b5e};var x5e=tl+`
  return exp(x);
`,k5e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,OU=It({opSnippet:x5e,packedOpSnippet:k5e,cpuKernelImpl:KUe,dtype:"float32"}),S5e={kernelName:k.Exp,backendName:"webgl",kernelFunc:OU};function Yx(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.dim,i=e.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(k.util.assert(-(o+1)<=a,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+a+1),s.splice(u,0,1),Ae({inputs:{x:i},backend:n,attrs:{shape:s}})}var N5e={kernelName:k.ExpandDims,backendName:"webgl",kernelFunc:Yx};var sq="return exp(x) - 1.0;",T5e=It({opSnippet:sq,packedOpSnippet:sq,cpuKernelImpl:jUe}),E5e={kernelName:k.Expm1,backendName:"webgl",kernelFunc:T5e};var uq=function(){function r(e,t,n){this.variableNames=["real","imag"];var a=t[1];this.outputShape=t;var i=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),o=n?"".concat(a,".0"):"1.0",s;if(e==="real")s="return real * expR - imag * expI;";else if(e==="imag")s="return real * expI + imag * expR;";else throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));this.userCode=`
      const float exponentMultiplier = `.concat(i,`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `).concat(s,`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`).concat(a,`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `).concat(a,`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `).concat(o,`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `)}return r}();function PU(r,e,t){var n=t.texData.get(r.dataId),a=k.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=Ae({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=s.shape,c=new uq("real",u,e),l=new uq("imag",u,e),f=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:u},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:u}],h=t.runWebGLProgram(c,f,"float32"),p=t.runWebGLProgram(l,f,"float32"),d=hs({inputs:{real:h,imag:p},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p);var m=Ae({inputs:{x:d},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(d),m}function I5e(r){var e=r.inputs,t=r.backend,n=e.input;return PU(n,!1,t)}var C5e={kernelName:k.FFT,backendName:"webgl",kernelFunc:I5e};var A5e=function(){function r(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r}();function Dh(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype;if(i=i||k.util.inferDtype(a),i==="string"){var o=k.util.getArrayFromDType(i,k.util.sizeFromShape(n));return o.fill(a),e.makeTensorInfo(n,i,o)}else{var s=new A5e(n,a),u=[[a]];return e.runWebGLProgram(s,[],i,u)}}var D5e={kernelName:k.Fill,backendName:"webgl",kernelFunc:Dh};var _5e=function(){function r(e){this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = `.concat(t,` - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < `).concat(t,`) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return r}();var F5e={kernelName:k.FlipLeftRight,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.image,a=t,i=new _5e(n.shape),o=a.runWebGLProgram(i,[n],n.dtype);return o}};var cq="return floor(x);",R5e=It({opSnippet:cq,packedOpSnippet:cq,cpuKernelImpl:XUe}),O5e={kernelName:k.Floor,backendName:"webgl",kernelFunc:R5e};var P5e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,M5e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,B5e=ln({opSnippet:P5e,packedOpSnippet:M5e,dtype:"int32"}),L5e={kernelName:k.FloorDiv,backendName:"webgl",kernelFunc:B5e},z5e=function(){function r(e){this.variableNames=["A"];var t=En(),n=Te(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`.concat(i,".0, ").concat(a,`.0);

        vec4 values = `).concat(t.texture2D,`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `)}return r}(),$5e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=En(),n=Te(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`.concat(i,".0, ").concat(a,`.0);
            vec4 values = `).concat(t.texture2D,`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `).concat(t.output,` = result;
      }
    `)}return r}(),W5e={kernelName:k.FromPixels,backendName:"webgl",kernelFunc:q5e},Vc,Wx=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function q5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.pixels,i=n.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=Te(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],f=[l,c],h=[l,c,i];if(s||o){var p=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Vc==null||p!==Wx)&&(Wx=p,Vc=document.createElement("canvas").getContext("2d",{willReadFrequently:Wx})),Vc.canvas.width=c,Vc.canvas.height=l,Vc.drawImage(a,0,0,c,l),a=Vc.canvas}var d=t.makeTensorInfo(f,"int32");t.texData.get(d.dataId).usage=ka.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),a);var m=k.env().getBool("WEBGL_PACK")?new $5e(h):new z5e(h),v=t.runWebGLProgram(m,[d],"int32");return t.disposeData(d.dataId),v}function U5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=k.backend_util.convertConv2DDataFormat(l),v=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,f,c,h,!1,m),g,y=[],w=o!=null,b=s!=null,x=p==="leakyrelu",S=function(){var $=[a,i],z=function(B,q){if(q==="NCHW"&&B.shape.length===1&&B.shape[0]!==1){var Y=Ae({inputs:{x:B},backend:t,attrs:{shape:[B.shape[0],1,1]}});return y.push(Y),Y}return B};if(w&&$.push(z(o,l)),b&&$.push(z(s,l)),x){var L=t.makeTensorInfo([],"float32",k.util.createScalarValue(d,"float32"));$.push(L),y.push(L)}return $};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))g=AU({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else if(v.strideWidth<=2&&m==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var T=p?Nh(p,!0):null,E=new CU(v,w,T,b,x),C=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],R=S();g=t.runWebGLProgram(E,R,"float32",C)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))g=DU({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else{var T=p?Nh(p,!1):null,E=new IU(v,w,T,b,x),_=S();g=t.runWebGLProgram(E,_,"float32")}var P=Ae({inputs:{x:g},backend:t,attrs:{shape:v.outShape}});return y.push(g),y.forEach(function($){return t.disposeIntermediateTensorInfo($)}),P}var V5e={kernelName:k.FusedConv2D,backendName:"webgl",kernelFunc:U5e};function G5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,f=n.dimRoundingMode,h=n.activation,p=n.leakyreluAlpha,d=[],m=l;m==null&&(m=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(u,m),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(m,"'")});var v=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,m,c,f,!0),g=k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,y=h?Nh(h,g):null,w=[a,i],b=o!=null,x=s!=null,S=h==="leakyrelu";if(b&&w.push(o),x&&w.push(s),S){var T=t.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));w.push(T),d.push(T)}var E;g?E=new RU(v,b,y,x,S):E=new FU(v,b,y,x,S);var C=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],R=t.runWebGLProgram(E,w,"float32",C);return d.forEach(function(_){return t.disposeIntermediateTensorInfo(_)}),R}var H5e={kernelName:k.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:G5e},K5e=function(){function r(e,t,n,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=n;for(var i=$t(n.length),o=`
    int index;`,s=0;s<this.sliceDim;s++)o+=`
          index = round(getIndices(coords[0], `.concat(s,`));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= `).concat(this.paramsShape[s],`;
          flattenIndex += index * `).concat(this.strides[s],";");this.userCode=`
         void main() {
          `.concat(i,` coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          `).concat(o,`

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `)}return r}();function j5e(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=a.shape,o=i[i.length-1],s=k.util.sizeFromShape(n.shape),u=Te(k.backend_util.prepareAndValidate(n,a),4),c=u[0],l=u[1],f=u[2],h=u[3],p=Ae({inputs:{x:a},backend:t,attrs:{shape:[l,o]}}),d=Ae({inputs:{x:n},backend:t,attrs:{shape:[k.util.sizeFromShape(n.shape)/f,f]}});if(t.shouldExecuteOnCPU([n,a])||n.dtype==="string"){var m=t.readSync(a.dataId),v=t.bufferSync(n),g=YUe(m,v,n.dtype,l,o,f,h,n.shape,s);return t.makeTensorInfo(c,n.dtype,g.values)}var y=new K5e(o,h,[l,f],n.shape),w=t.runWebGLProgram(y,[d,p],d.dtype),b=Ae({inputs:{x:w},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(w),b}var X5e={kernelName:k.GatherNd,backendName:"webgl",kernelFunc:j5e};var Y5e=function(){function r(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var n=$t(this.rank),a=Z5e(e);this.userCode=`
      void main() {
        `.concat(n,` resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < `).concat(e[2],`) ? 1.0 : 0.0;
        setOutput(inBounds * getA(`).concat(a,`));
      }
    `)}return r}();function Z5e(r,e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],a=0;a<r.length;a++)a===2?n.push("index"):n.push("".concat(t[a]));return n.join()}function MU(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims,u=k.util.parseAxisParam(o,a.shape)[0];if(k.env().get("DEBUG"))for(var c=t.readSync(i.dataId),l=a.shape[u],f=function(C){var R=c[C];k.util.assert(R<=l-1&&R>=0,function(){return"GatherV2: the index value ".concat(R," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=k.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),d=k.util.sizeFromShape(i.shape),m=[],v=Ae({inputs:{x:a},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=Ae({inputs:{x:i},backend:t,attrs:{shape:[p.batchSize,d/p.batchSize]}});m.push(v),m.push(g);var y=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize];if(t.shouldExecuteOnCPU([a,i])||a.dtype==="string"){var w=t.bufferSync(g),b=t.bufferSync(v),x=ZUe(b,w,y);return m.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),t.makeTensorInfo(p.outputShape,x.dtype,x.values)}var S=new Y5e(v.shape,y),T=t.runWebGLProgram(S,[v,g],v.dtype);m.push(T);var E=Ae({inputs:{x:T},backend:t,attrs:{shape:p.outputShape}});return m.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),E}var J5e={kernelName:k.GatherV2,backendName:"webgl",kernelFunc:MU};var Q5e="return float(a > b);",eKe=`
  return vec4(greaterThan(a, b));
`,tKe=ln({opSnippet:Q5e,packedOpSnippet:eKe,cpuKernelImpl:JUe,dtype:"bool"}),rKe={kernelName:k.Greater,backendName:"webgl",kernelFunc:tKe};var nKe="return float(a >= b);",aKe=`
  return vec4(greaterThanEqual(a, b));
`,iKe=ln({opSnippet:nKe,packedOpSnippet:aKe,dtype:"bool",cpuKernelImpl:QUe}),oKe={kernelName:k.GreaterEqual,backendName:"webgl",kernelFunc:iKe};function sKe(r){var e=r.inputs,t=r.backend,n=e.input;return PU(n,!0,t)}var uKe={kernelName:k.IFFT,backendName:"webgl",kernelFunc:sKe};var cKe="return float(!isnan(x) && !isinf(x));",lKe=It({opSnippet:cKe,dtype:"bool"}),fKe={kernelName:k.IsFinite,backendName:"webgl",kernelFunc:lKe};var hKe="return float(isinf(x));",pKe=It({opSnippet:hKe,dtype:"bool"}),dKe={kernelName:k.IsInf,backendName:"webgl",kernelFunc:pKe};var vKe="return float(isnan(x));",mKe=It({opSnippet:vKe,dtype:"bool"}),gKe={kernelName:k.IsNan,backendName:"webgl",kernelFunc:mKe};var yKe="return float(a < b);",bKe=`
  return vec4(lessThan(a, b));
`,wKe=ln({opSnippet:yKe,packedOpSnippet:bKe,cpuKernelImpl:eVe,dtype:"bool"}),xKe={kernelName:k.Less,backendName:"webgl",kernelFunc:wKe};var kKe="return float(a <= b);",SKe=`
  return vec4(lessThanEqual(a, b));
`,NKe=ln({opSnippet:kKe,packedOpSnippet:SKe,cpuKernelImpl:tVe,dtype:"bool"}),TKe={kernelName:k.LessEqual,backendName:"webgl",kernelFunc:NKe};function EKe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=rVe(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var IKe={kernelName:k.LinSpace,backendName:"webgl",kernelFunc:EKe};var CKe=tl+`
  return x < 0.0 ? 0./0. : log(x);
`,AKe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,DKe=It({opSnippet:CKe,packedOpSnippet:AKe,cpuKernelImpl:nVe}),_Ke={kernelName:k.Log,backendName:"webgl",kernelFunc:DKe};var FKe=tl+`
  return log(1.0 + x);
`,RKe=It({opSnippet:FKe}),OKe={kernelName:k.Log1p,backendName:"webgl",kernelFunc:RKe};var PKe="return float(a >= 1.0 && b >= 1.0);",MKe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,BKe=ln({opSnippet:PKe,packedOpSnippet:MKe,dtype:"bool"}),LKe={kernelName:k.LogicalAnd,backendName:"webgl",kernelFunc:BKe};var zKe="return float(!(x >= 1.0));",$Ke=It({opSnippet:zKe}),WKe={kernelName:k.LogicalNot,backendName:"webgl",kernelFunc:$Ke};var qKe="return float(a >= 1.0 || b >= 1.0);",UKe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,VKe=ln({opSnippet:qKe,packedOpSnippet:UKe,dtype:"bool"}),GKe={kernelName:k.LogicalOr,backendName:"webgl",kernelFunc:VKe};var HKe=function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[];var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(n,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`.concat(o,"; j <= ").concat(o,`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `).concat(s,`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `).concat(u,`;
        setOutput(val);
      }
    `)}return r}();var KKe=function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(n,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `.concat(this.outputShape[3],`;
        bool hasNextRow = c < `).concat(this.outputShape[2],`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `).concat(o,`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `).concat(o,"; j <= ").concat(o,`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`).concat(s,`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `).concat(u,`;
        setOutput(result);
      }
    `)}return r}();var jKe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta,c=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new KKe(a.shape,i,o,s,u):new HKe(a.shape,i,o,s,u);return t.runWebGLProgram(c,[a],a.dtype)},XKe={kernelName:k.LRN,backendName:"webgl",kernelFunc:jKe};var YKe=function(){function r(e,t,n,a,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=a,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `.concat(this.depth,`; ++d) {
          int depthBegin = int(max(0.0, float(d - `).concat(t,`)));
          int depthEnd = int(min(float(`).concat(this.depth,`),
              float(d + `).concat(t,` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `).concat(this.depth,`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`).concat(a,") * norm + float(").concat(n,`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`).concat(a,`)
                * float(`).concat(i,`)
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `).concat(i,`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `)}return r}();var ZKe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta,f=new YKe(a.shape,s,u,c,l);return t.runWebGLProgram(f,[a,i,o],a.dtype)},JKe={kernelName:k.LRNGrad,backendName:"webgl",kernelFunc:ZKe};function QKe(r,e,t,n){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(r.shape),o=i/a,s=Ae({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=Iu(s,r.dtype,"max",n),c=Ae({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}function BU(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=l!=null,h=t.shouldExecuteOnCPU([a]),p=a;if(f){if(h){for(var d=t.texData.get(p.dataId),m=d.values,v=new Array(s),g=0;g<v.length;g++)v[g]=a.shape[l[g]];var y=sk(m,a.shape,a.dtype,l,v);p=t.makeTensorInfo(v,a.dtype);var w=t.texData.get(p.dataId);w.values=y}else p=Tm(a,l,t);c=k.backend_util.getInnerMostAxes(c.length,s)}k.backend_util.assertAxesAreInnerMostDims("max",c,s);var b=Te(k.backend_util.computeOutAndReduceShapes(p.shape,c),2),x=b[0],S=b[1],T=x;o&&(T=k.backend_util.expandShapeToKeepDim(x,u));var E;if(h){var d=t.texData.get(p.dataId),m=d.values,C=aVe(m,k.util.sizeFromShape(S),T,a.dtype);E=t.makeTensorInfo(T,a.dtype);var R=t.texData.get(E.dataId);R.values=C}else E=QKe(p,S,T,t);return f&&t.disposeIntermediateTensorInfo(p),E}var eje={kernelName:k.Max,backendName:"webgl",kernelFunc:BU};var tje=ck+`
  return max(a, b);
`,rje=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Eu+`
  return result;
`,nje=ln({opSnippet:tje,packedOpSnippet:rje,cpuKernelImpl:iVe}),aje={kernelName:k.Maximum,backendName:"webgl",kernelFunc:nje};function ije(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Xc(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return la({inputs:{x:a},backend:t});var f=new Th(l,"max",!1);return t.runWebGLProgram(f,[a],a.dtype)}var oje={kernelName:k.MaxPool,backendName:"webgl",kernelFunc:ije};function sje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,c,u),h=new fk(f,"max",!1);return t.runWebGLProgram(h,[a],a.dtype)}var uje={kernelName:k.MaxPool3D,backendName:"webgl",kernelFunc:sje};var cje=function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,a=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=i-1-e.padInfo.top,u=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(i,`;
          wR += `).concat(a,`) {
          float dyR = float(dyRCorner + wR) / `).concat(t,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(o,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(n,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `).concat(c,` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `).concat(o,` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),lje=function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,f=u-1-e.padInfo.front,h=c-1-e.padInfo.top,p=l-1-e.padInfo.left,d=u*c*l-1;this.userCode=`
      const ivec3 pads = ivec3(`.concat(f,", ").concat(h,", ").concat(p,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(u,`;
           wD += `).concat(i,`) {
          float dyD = float(dyDCorner + wD) / `).concat(t,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(c,`;
              wR += `).concat(o,`) {
            float dyR = float(dyRCorner + wR) / `).concat(n,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(l,`;
                wC += `).concat(s,`) {
              float dyC = float(dyCCorner + wC) / `).concat(a,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `).concat(d,` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `).concat(c," * ").concat(l,` +
                  wR * `).concat(l,` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function fje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new fk(h,"max",!0),d=t.runWebGLProgram(p,[o],o.dtype),m=new lje(h),v=t.runWebGLProgram(m,[a,d],o.dtype);return t.disposeIntermediateTensorInfo(d),v}var hje={kernelName:k.MaxPool3DGrad,backendName:"webgl",kernelFunc:fje};function pje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;Xc([i,o],"maxPoolGrad");var u=n.filterSize,c=n.strides,l=n.pad,f=n.dimRoundingMode,h=k.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=!0,d=new Th(h,"max",p),m=t.runWebGLProgram(d,[s],s.dtype),v=new cje(h),g=t.runWebGLProgram(v,[a,m],s.dtype);return t.disposeIntermediateTensorInfo(m),g}var dje={kernelName:k.MaxPoolGrad,backendName:"webgl",kernelFunc:pje};function vje(r,e,t,n){var a=new Th(t,"max",!1),i=n.runWebGLProgram(a,[r],"float32");a=new Th(t,"max",!0,!0,e);var o=n.runWebGLProgram(a,[r],"float32");return[i,o]}var mje={kernelName:k.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=n;k.util.assert(a.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")});var l=[1,1];k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computePool2DInfo(a.shape,i,o,l,s),h=Te(vje(a,u,f,c),2),p=h[0],d=h[1];return[p,d]}};function gje(r,e,t,n){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(r.shape),o=i/a,s=Ae({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=Iu(s,"float32","mean",n),c=Ae({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}var yje={kernelName:k.Mean,backendName:"webgl",kernelFunc:function(r){var e,t,n=r.inputs,a=r.attrs,i=r.backend,o=n.x,s=a.keepDims,u=a.axis,c=i,l=o.shape.length,f=k.util.parseAxisParam(u,o.shape),h=f,p=k.backend_util.getAxesPermutation(h,l),d=p!=null,m=c.shouldExecuteOnCPU([o]),v=[],g=o;if(d){if(m){for(var y=c.texData.get(g.dataId),w=y.values,b=new Array(l),x=0;x<b.length;x++)b[x]=o.shape[p[x]];var S=sk(w,o.shape,o.dtype,p,b);g=c.makeTensorInfo(b,o.dtype);var T=c.texData.get(g.dataId);T.values=S}else g=Tm(o,p,c);v.push(g),h=k.backend_util.getInnerMostAxes(h.length,l)}k.backend_util.assertAxesAreInnerMostDims("sum",h,l);var E=Te(k.backend_util.computeOutAndReduceShapes(g.shape,h),2),C=E[0],R=E[1],_=C;s&&(_=k.backend_util.expandShapeToKeepDim(C,f));var P=gje(g,R,_,c);try{for(var $=Nn(v),z=$.next();!z.done;z=$.next()){var x=z.value;c.disposeIntermediateTensorInfo(x)}}catch(L){e={error:L}}finally{try{z&&!z.done&&(t=$.return)&&t.call($)}finally{if(e)throw e.error}}return P}};function bje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=Tn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,a.shape.length)),k.backend_util.assertAxesAreInnerMostDims("min",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=Iu(v,v.dtype,"min",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ae({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ae({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var wje={kernelName:k.Min,backendName:"webgl",kernelFunc:bje};var xje=ck+`
  return min(a, b);
`,kje=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Eu+`
  return result;
`,Sje=ln({opSnippet:xje,packedOpSnippet:kje,cpuKernelImpl:oVe}),Nje={kernelName:k.Minimum,backendName:"webgl",kernelFunc:Sje};var Tje=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(l,f){return l[0]+e[f]+l[1]});var a=e.length,i=$t(a),o=t.map(function(l){return l[0]}).join(","),s=t.map(function(l,f){return l[0]+e[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c=n==="reflect"?0:1;if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - `).concat(c,`;
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + `).concat(c,`;
          }
          setOutput(getX(outC - start));
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        for (int i = 0; i < `).concat(a,`; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - `).concat(c,`;
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + `).concat(c,`;
          }
        }
        `).concat(i,` coords = outC - start;
        setOutput(getX(`).concat(u,`));
      }
    `)}return r}();var Eje=function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(m,v){return m[0]+e[v]+m[1]});var a=e.length,i=$t(a),o=t.map(function(m){return m[0]}).join(","),s=t.map(function(m,v){return m[0]+e[v]}).join(","),u=Sn("rc",a),c=Sn("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=n==="reflect"?0:1,p="";if(a===1){var d=`
        `.concat(i,` source = rc;
        if (source < start) {
          source = start * 2 - source - `).concat(h,`;
        } else if (source >= end) {
          source = (end - 1) * 2 - source + `).concat(h,`;
        }
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
      `)}else{var d=`
        `.concat(i,` source = rc;
        `).concat(i," lt = ").concat(i,`(lessThan(source, start));
        `).concat(i," gte = ").concat(i,`(greaterThanEqual(source, end));
        `).concat(i,` orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - `).concat(h,`) +
                gte * ((end - 1) * 2 - source + `).concat(h,`);
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
        rc = outputLoc;
        `).concat(u[a-2],` += 1;
        if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],`) {
          `).concat(d,`
          result[2] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          `).concat(u[a-1],` += 1;
          if(`).concat(l,`) {
            `).concat(d,`
            result[3] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          }
        }
      `)}this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(p,`
        setOutput(result);
      }
    `)}return r}();var Ije=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode,s=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Eje(a.shape,i,o):new Tje(a.shape,i,o),u=t.runWebGLProgram(s,[a],a.dtype);return u},Cje={kernelName:k.MirrorPad,backendName:"webgl",kernelFunc:Ije};var Aje=`if (b == 0.0) return NAN;
  return mod(a, b);`,Dje=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Eu+`
  return result;
`,_je=ln({opSnippet:Aje,packedOpSnippet:Dje}),Fje={kernelName:k.Mod,backendName:"webgl",kernelFunc:_je};var Rje=function(){function r(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `.concat(t-1,`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`).concat(t-1,`));
      }
    `)}return r}();var Oje=`
if (a == b) {
  return 1.0;
};
return a / b;`,Pje=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,LU=ln({opSnippet:Oje,packedOpSnippet:Pje,checkOutOfBounds:!0}),Mje={kernelName:k.RealDiv,backendName:"webgl",kernelFunc:LU};var lq="return a - b;",zU=ln({opSnippet:lq,packedOpSnippet:lq,supportsComplex:!0,cpuKernelImpl:IVe}),Bje={kernelName:k.Sub,backendName:"webgl",kernelFunc:zU};function $U(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=k.util.parseAxisParam([i],a.shape),s=BU({inputs:{x:a},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=k.backend_util.expandShapeToKeepDim(s.shape,o),c=Ae({inputs:{x:s},backend:t,attrs:{shape:u}}),l=zU({inputs:{a,b:c},backend:t}),f=OU({inputs:{x:l},backend:t}),h=Em({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),p=Ae({inputs:{x:h},backend:t,attrs:{shape:u}}),d=LU({inputs:{a:f,b:p},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),d}var Lje={kernelName:k.Softmax,backendName:"webgl",kernelFunc:$U};function zje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized,u=s?a:$U({inputs:{logits:a},backend:t,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],f=new Rje(c,l,i),h=[[o]],p=t.runWebGLProgram(f,[u],"int32",h);return s||t.disposeIntermediateTensorInfo(u),p}var $je={kernelName:k.Multinomial,backendName:"webgl",kernelFunc:zje},Wje=ti+`
  return -x;
`,qje=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Uje(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])){var a=t.texData.get(n.dataId),i=Te(uVe(a.values,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var u;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?u=new fs(n.shape,qje):u=new $i(n.shape,Wje),t.runWebGLProgram(u,[n],n.dtype)}var Vje={kernelName:k.Neg,backendName:"webgl",kernelFunc:Uje};var Gje=k.kernel_impls.nonMaxSuppressionV3Impl;function Hje(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=Gje(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var Kje={kernelName:k.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:Hje};var jje=k.kernel_impls.nonMaxSuppressionV4Impl;function Xje(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.padToMaxOutputSize,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=jje(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var Yje={kernelName:k.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:Xje};var Zje=k.kernel_impls.nonMaxSuppressionV5Impl;function Jje(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.softNmsSigma,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=o,p=s,d=u,m=c,v=Zje(l,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var Qje={kernelName:k.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:Jje};var e8e=function(){function r(e,t,n,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`.concat(a,"), float(").concat(n,`),
                      float(index == coords.y)));
      }
    `)}return r}(),t8e=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue,c=k.util.sizeFromShape(a.shape),l=new e8e(c,o,s,u),f=Ae({inputs:{x:a},backend:t,attrs:{shape:[c]}}),h=t.runWebGLProgram(l,[f],i);t.disposeIntermediateTensorInfo(f);var p=mr(mr([],Te(a.shape),!1),[o],!1),d=Ae({inputs:{x:h},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(h),d},r8e={kernelName:k.OneHot,backendName:"webgl",kernelFunc:t8e};function Sm(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="complex64"){var a=Ah({inputs:{input:n},backend:t}),i=Sm({inputs:{x:a},backend:t}),o=Im({inputs:{input:n},backend:t}),s=Sm({inputs:{x:o},backend:t}),u=hs({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Dh({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:t})}var n8e={kernelName:k.ZerosLike,backendName:"webgl",kernelFunc:Sm};function WU(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){var a=Ah({inputs:{input:n},backend:t}),i=WU({inputs:{x:a},backend:t}),o=Im({inputs:{input:n},backend:t}),s=Sm({inputs:{x:o},backend:t}),u=hs({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Dh({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:t})}var a8e={kernelName:k.OnesLike,backendName:"webgl",kernelFunc:WU};function i8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return Yx({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){k.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),k.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=Yx({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=EU({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var o8e={kernelName:k.Pack,backendName:"webgl",kernelFunc:i8e};var s8e=function(){function r(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(c,l){return c[0]+e[l]+c[1]});var a=e.length,i=$t(a),o=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,l){return c[0]+e[l]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          `).concat(i,` coords = outC - start;
          setOutput(getX(`).concat(u,`));
        }
      }
    `)}return r}();var u8e=function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(g,y){return g[0]+e[y]+g[1]});for(var a=e.length,i=$t(a),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,y){return g[0]+e[y]}).join(","),u=Sn("rc",a),c=Sn("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1],` += 1;
       if(`).concat(l,`) {
      `),a===1?"":`}
       rc = outputLoc;
       `.concat(u[a-2],` += 1;
       if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),a===1?"":"  ".concat(u[a-1],` += 1;
         if(`).concat(l,") {")],p=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",m=0,v=a===1?2:4;m<v;m++)d+=`
        `.concat(h[m],`
        if (`).concat(p,`) {
          result[`).concat(m,`] = float(value);
        } else {
          `).concat(i,` source = rc - start;
          result[`).concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(f,`);
        }
      `);d+=a===1?"} ":"}}",this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(d,`
        setOutput(result);
      }
    `)}return r}();var qU=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;if(k.util.sizeFromShape(a.shape)===0){var s=i.map(function(l,f){return l[0]+a.shape[f]+l[1]});return Dh({backend:t,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new u8e(a.shape,i,o):new s8e(a.shape,i,o),c=[[o]];return t.runWebGLProgram(u,[a],a.dtype,c)},c8e={kernelName:k.PadV2,backendName:"webgl",kernelFunc:qU};var l8e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,f8e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Eu+`
  return result;
`,h8e=ln({opSnippet:l8e,packedOpSnippet:f8e}),p8e={kernelName:k.Pow,backendName:"webgl",kernelFunc:h8e};function d8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=[],c=k.util.parseAxisParam(i,a.shape),l=c,f=k.backend_util.getAxesPermutation(l,s),h=a;f!=null&&(h=Tn({inputs:{x:a},backend:t,attrs:{perm:f}}),l=k.backend_util.getInnerMostAxes(l.length,s),u.push(h)),k.backend_util.assertAxesAreInnerMostDims("prod",l,s);var p;if(t.shouldExecuteOnCPU([h])){var d=t.texData.get(h.dataId).values,m=lVe(h.shape,h.dtype,d,l),v=m.outVals,g=m.outShape,y=m.outDtype;p=t.makeTensorInfo(g,y,v)}else{var w=Te(k.backend_util.computeOutAndReduceShapes(h.shape,l),2),g=w[0],b=w[1],x=k.util.sizeFromShape(b),S=Ae({inputs:{x:h},backend:t,attrs:{shape:[-1,x]}}),T=k.sumOutType(a.dtype),E=Iu(S,T,"prod",t);p=Ae({inputs:{x:E},backend:t,attrs:{shape:g}}),u.push(S),u.push(E)}if(o){u.push(p);var C=k.backend_util.expandShapeToKeepDim(p.shape,c);p=Ae({inputs:{x:p},backend:t,attrs:{shape:C}})}return u.forEach(function(R){return t.disposeIntermediateTensorInfo(R)}),p}var v8e={kernelName:k.Prod,backendName:"webgl",kernelFunc:d8e};function m8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.readSync(g.dataId)}),u=a.map(function(g){return g.shape}),c=t.readSync(i.dataId),l=t.readSync(o.dataId),f=Te(fVe(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var g8e={kernelName:k.RaggedGather,backendName:"webgl",kernelFunc:m8e};function y8e(r){var e=r.inputs,t=r.backend,n=e.starts,a=e.limits,i=e.deltas,o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(hVe(o,n.shape,n.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],n.dtype,f);return[h,p]}var b8e={kernelName:k.RaggedRange,backendName:"webgl",kernelFunc:y8e};function w8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=t.readSync(o.dataId),h=s.map(function(g){return t.readSync(g.dataId)}),p=s.map(function(g){return g.shape}),d=Te(pVe(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var x8e={kernelName:k.RaggedTensorToTensor,backendName:"webgl",kernelFunc:w8e};var UU=function(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.step,o=t.dtype,s=dVe(n,a,i,o);return e.makeTensorInfo([s.length],o,s)},k8e={kernelName:k.Range,backendName:"webgl",kernelFunc:UU};var S8e="return 1.0 / x;",N8e=It({opSnippet:S8e}),T8e={kernelName:k.Reciprocal,backendName:"webgl",kernelFunc:N8e};var E8e=ti+`
  return (x < 0.0) ? 0.0 : x;
`,I8e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,C8e=It({opSnippet:E8e,packedOpSnippet:I8e}),A8e={kernelName:k.Relu,backendName:"webgl",kernelFunc:C8e};var D8e=ti+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,_8e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,F8e=It({opSnippet:D8e,packedOpSnippet:_8e}),R8e={kernelName:k.Relu6,backendName:"webgl",kernelFunc:F8e};var O8e=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `)}return r}();var P8e=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(n-1,`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `)}return r}();function M8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new P8e(a.shape,c,l,i,o):new O8e(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],"float32")}var B8e={kernelName:k.ResizeBilinear,backendName:"webgl",kernelFunc:M8e};var L8e=function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[n&&u>1?i-1:i,n&&c>1?o-1:o],f=[n&&u>1?u-1:u,n&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(m,`);

        const int winHeight = int(`).concat(v,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `).concat(i-1,`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `).concat(o-1,`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return r}();function z8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new L8e(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var $8e={kernelName:k.ResizeBilinearGrad,backendName:"webgl",kernelFunc:z8e};var W8e=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `)}return r}();var q8e=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(n-1,`;

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `)}return r}();function U8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new q8e(a.shape,c,l,i,o):new W8e(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],a.dtype)}var V8e={kernelName:k.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:U8e};var G8e=function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[n&&u>1?i-1:i,n&&c>1?o-1:o],f=[n&&u>1?u-1:u,n&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(m,`);

        const int winHeight = int(`).concat(v,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float sourceFracRow =
              float(`).concat(l[0],`) *
                (float(dyR) / float(`).concat(f[0],`));

            float sourceFracCol =
                float(`).concat(l[1],`) *
                  (float(dyC) / float(`).concat(f[1],`));

            int sourceNearestRow = int(min(
                float(int(`).concat(i,`) - 1),
                `).concat(n,` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`).concat(o,`) - 1),
                `).concat(n,` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return r}();function H8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new G8e(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var K8e={kernelName:k.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:H8e};var j8e=function(){function r(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`.concat(e[0],` - coord - 1));
        }
      `);return}var a=function(s){return t.indexOf(s)!==-1&&e[s]!==1?"".concat(e[s]," - coords[").concat(s,"] - 1"):"coords[".concat(s,"]")},i=e.map(function(s,u){return a(u)}).join(","),o=$t(n);this.userCode=`
      void main() {
        `.concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(i,`));
      }
    `)}return r}();var X8e=function(){function r(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;var a=Sn("rc",n),i="".concat(a[n-1]," + 1 < ").concat(this.outputShape[n-1]),o="".concat(a[n-2]," + 1 < ").concat(this.outputShape[n-2]),s=$t(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`.concat(e[0],` - rc - 1),
            `).concat(e[0],` - rc - 1);
          if(`).concat(i,`){
              result.g = getChannel(getX(`).concat(e[0],` - (rc  + 1) - 1),
                `).concat(e[0],` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `):this.userCode=`
        void main() {
          `.concat(s,` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `).concat(u(a.slice()),`;
          if(`).concat(i,`){
            result.g = `).concat(c(a.slice()),`;
          }
          if(`).concat(o,`) {
            result.b = `).concat(l(a.slice()),`;
            if(`).concat(i,`) {
              result.a = `).concat(f(a.slice()),`;
            }
          }
          setOutput(result);
        }
    `);function u(d){return h(d)}function c(d){return d[n-1]="("+d[n-1]+" + 1)",h(d)}function l(d){return d[n-2]="("+d[n-2]+" + 1)",h(d)}function f(d){return d[n-1]="("+d[n-1]+" + 1)",d[n-2]="("+d[n-2]+" + 1)",h(d)}function h(d){var m=e.map(function(y,w){return p(w,d)}),v=m.join(","),g=m.slice(-2).join(",");return"getChannel(getX(".concat(v,"), vec2(").concat(g,"))")}function p(d,m){return t.indexOf(d)!==-1&&e[d]!==1?"".concat(e[d]," - ").concat(m[d]," - 1"):"".concat(m[d])}}return r}();function Y8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims,o=a.shape.length,s=k.util.parseAxisParam(i,a.shape);if(o===0)return la({inputs:{x:a},backend:t});var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new X8e(a.shape,s):new j8e(a.shape,s);return t.runWebGLProgram(u,[a],a.dtype)}var Z8e={kernelName:k.Reverse,backendName:"webgl",kernelFunc:Y8e};var J8e=function(){function r(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var n=e[1],a=e[2];this.outputShape=e;var i="";typeof t=="number"?i="float outputValue = ".concat(t.toFixed(2),";"):i=`
        vec3 fill = vec3(`.concat(t.join(","),`);
        float outputValue = fill[coords[3]];`),this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          `.concat(i,`
          if(coordX >= 0 && coordX < `).concat(a," && coordY >= 0 && coordY < ").concat(n,`) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return r}(),Q8e={kernelName:k.RotateWithOffset,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,c=new J8e(a.shape,o),l=Te(k.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),2),f=l[0],h=l[1],p=[[f,h,Math.sin(i),Math.cos(i)]],d=u.runWebGLProgram(c,[a],a.dtype,p);return d}};var e7e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,t7e=It({opSnippet:e7e}),r7e={kernelName:k.Round,backendName:"webgl",kernelFunc:t7e};var n7e="return inversesqrt(x);",a7e=It({opSnippet:n7e,cpuKernelImpl:vVe}),i7e={kernelName:k.Rsqrt,backendName:"webgl",kernelFunc:a7e};var hk=function(){function r(e,t,n,a,i,o,s,u){u===void 0&&(u=!1),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var c=$t(i.length),l=$t(o.length),f="";n===1?f="i":n===2&&(f="i, j");var h="getIndices(".concat(f,")"),p="";a===1?p="i":a===2&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),m="";u&&(m="coords[0], coords[1]");var v="getDefaultValue(".concat(m,")"),g=t>1?"strides[j]":"strides";this.userCode=`
        `.concat(c," strides = ").concat(c,"(").concat(i,`);

        void main() {
          `).concat(l,` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `).concat(e,`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `).concat(t,`; j++) {
              int index = round(`).concat(h,`);
              flattenedIndex += index * `).concat(g,`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `).concat(d,`;
              found = true;
            }
          }
          setOutput(mix(`).concat(v,`, sum, float(found)));
        }
      `)}return r}();var o7e=function(){function r(e,t,n,a,i,o,s,u){u===void 0&&(u=!1),this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;var c=$t(i.length),l=$t(o.length),f="";n===1?f="i":n===2&&(f="i, j");var h="getIndices(".concat(f,")"),p="";a===1?p="i":a===2&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),m="";u&&(m="coords[0], coords[1]");var v="getDefaultValue(".concat(m,")"),g=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`
        `.concat(c," strides = ").concat(c,"(").concat(i,`);

        void main() {
          `).concat(l,` coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < `).concat(e,`; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < `).concat(t,`; j+=2) {
              ivec4 index = round(`).concat(h,`);
              flattenedIndex += index.xz * `).concat(g,`;
              if (j + 1 < `).concat(t,`) {
                flattenedIndex += index.yw * `).concat(y,`;
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = `).concat(d,`;
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(`).concat(v,`, sum, found));
        }
      `)}return r}();function s7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=k.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=[h/l,l];if(h===0)return t.makeTensorInfo(o,a.dtype);var d=Ae({inputs:{x:a},backend:t,attrs:{shape:[c,u]}}),m=Ae({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),v=t.makeTensorInfo([],"float32",new Float32Array([0])),g;k.env().getBool("WEBGL_PACK")?g=new o7e(c,u,d.shape.length,m.shape.length,f,p):g=new hk(c,u,d.shape.length,m.shape.length,f,p);var y=t.runWebGLProgram(g,[m,d,v],m.dtype),w=Ae({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),w}var u7e={kernelName:k.ScatterNd,backendName:"webgl",kernelFunc:s7e};var c7e=function(){function r(e,t,n,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];var i="while (left < right) {",o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),s=k.env().getNumber("WEBGL_VERSION")===2?i:o,u=a==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         `.concat(s,`
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) `).concat(u,` value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `)}return r}();function l7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=new c7e(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return t.runWebGLProgram(s,[a,i],"int32",u)}var f7e={kernelName:k.SearchSorted,backendName:"webgl",kernelFunc:l7e};var h7e=function(){function r(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;var a,i;if(n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(n===1)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<t.length;c++)u.push("".concat(o[c])),c<e&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=$t(n);this.userCode=`
      void main() {
        `.concat(l,` resRC = getOutputCoords();
        float cVal = getC(`).concat(a,`);
        if (cVal >= 1.0) {
          setOutput(getA(`).concat(i,`));
        } else {
          setOutput(getB(`).concat(i,`));
        }
      }
    `)}return r}();function p7e(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e,o=new h7e(n.shape.length,a.shape,a.shape.length);return t.runWebGLProgram(o,[n,a,i],k.upcastType(a.dtype,i.dtype))}var d7e={kernelName:k.Select,backendName:"webgl",kernelFunc:p7e};var v7e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `.concat(k.backend_util.SELU_SCALEALPHA,`;
  float scale = `).concat(k.backend_util.SELU_SCALE,`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`),m7e=It({opSnippet:v7e}),g7e={kernelName:k.Selu,backendName:"webgl",kernelFunc:m7e};var y7e=tl+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,b7e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,w7e=It({opSnippet:y7e,packedOpSnippet:b7e,cpuKernelImpl:gVe}),x7e={kernelName:k.Sigmoid,backendName:"webgl",kernelFunc:w7e};var k7e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,S7e=It({opSnippet:k7e}),N7e={kernelName:k.Sign,backendName:"webgl",kernelFunc:S7e};var T7e=tl+`
  return sin(x);
`,E7e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  `.concat(Eu,`
  return result;
`),I7e=It({opSnippet:T7e,packedOpSnippet:E7e}),C7e={kernelName:k.Sin,backendName:"webgl",kernelFunc:I7e};var A7e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,D7e=It({opSnippet:A7e}),_7e={kernelName:k.Sinh,backendName:"webgl",kernelFunc:D7e};var F7e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,R7e=It({opSnippet:F7e}),O7e={kernelName:k.Softplus,backendName:"webgl",kernelFunc:R7e},P7e=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;k.util.assert(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,w){return y*w}),u=[[0,0]];u.push.apply(u,mr([],Te(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],f=qU({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),h=k.backend_util.getReshaped(f.shape,i,s,!1),p=k.backend_util.getPermuted(h.length,i.length,!1),d=k.backend_util.getReshapedPermuted(f.shape,i,s,!1),m=Ae({inputs:{x:f},backend:t,attrs:{shape:h}}),v=Tn({inputs:{x:m},backend:t,attrs:{perm:p}}),g=Ae({inputs:{x:v},backend:t,attrs:{shape:d}});return l.push(f),l.push(m),l.push(v),l.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},M7e={kernelName:k.SpaceToBatchND,backendName:"webgl",kernelFunc:P7e};function B7e(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         `.concat(i.shape));if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.readSync(n.dataId),u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],f=Te(bVe(s,n.shape,n.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var L7e={kernelName:k.SparseFillEmptyRows,backendName:"webgl",kernelFunc:B7e};function z7e(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error("Input indices should be a matrix but received shape ".concat(n.shape));if(a.shape.length!==1)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.readSync(a.dataId)),s=t.readSync(n.dataId),u=Array.from(t.readSync(i.dataId)),c=Te(wVe(s,n.shape,n.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,n.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var $7e={kernelName:k.SparseReshape,backendName:"webgl",kernelFunc:z7e};function W7e(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              `.concat(i.shape));var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(hU(o,n.shape,n.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var q7e={kernelName:k.SparseSegmentMean,backendName:"webgl",kernelFunc:W7e};function U7e(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             `.concat(i.shape));var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(hU(o,n.shape,n.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var V7e={kernelName:k.SparseSegmentSum,backendName:"webgl",kernelFunc:U7e};function G7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=k.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1;if(i.dtype==="string"){var m=t.bufferSync(a),v=t.bufferSync(i),g=k.util.decodeString(t.readSync(o.dataId)[0]),y=mVe(m,v,s,p,f,l,c,h,g,d);return t.makeTensorInfo(s,y.dtype,y.values)}var w=new hk(l,c,a.shape.length,i.shape.length,h,[p,1],d),b=t.runWebGLProgram(w,[i,a,o],i.dtype),x=Ae({inputs:{x:b},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(b),x}var H7e={kernelName:k.SparseToDense,backendName:"webgl",kernelFunc:G7e};function K7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=k.util.parseAxisParam(o,a.shape)[0],u=k.backend_util.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),f=a.shape.slice();return u.map(function(h){var p=mr([],Te(f),!1);p[s]=h;var d=rl({inputs:{x:a},backend:t,attrs:{begin:l,size:p}});return l[s]+=h,d})}var j7e={kernelName:k.SplitV,backendName:"webgl",kernelFunc:K7e};var fq="return sqrt(x);",X7e=It({opSnippet:fq,packedOpSnippet:fq,cpuKernelImpl:xVe}),Y7e={kernelName:k.Sqrt,backendName:"webgl",kernelFunc:X7e};var Z7e="return x * x;",J7e=It({opSnippet:Z7e}),Q7e={kernelName:k.Square,backendName:"webgl",kernelFunc:J7e};var hq="return (a - b) * (a - b);",eXe=ln({opSnippet:hq,packedOpSnippet:hq}),tXe={kernelName:k.SquaredDifference,backendName:"webgl",kernelFunc:eXe};function rXe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;if(a.dtype!=="string")throw new Error("Input must be of datatype string");var i=t.readSync(a.dataId),o=k.backend_util.fromUint8ToStringArray(i),s=kVe(o,"string",n);return t.makeTensorInfo(a.shape,"string",s)}var nXe={kernelName:k.StaticRegexReplace,backendName:"webgl",kernelFunc:rXe};function aXe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=ti+`
    return x > 0.0 ? 1.0 : float(`.concat(t.alpha,`);
  `),o=new $i(a.shape,i);return n.runWebGLProgram(o,[a],a.dtype)}var iXe={kernelName:k.Step,backendName:"webgl",kernelFunc:aXe};var oXe=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=n;var a=n.length,i=$t(n.length),o=$t(n.length),s="";if(a===1)s="coords * strides + begin";else{var u=0;s=n.map(function(c,l){return u++,n.length===1?"coords * strides[".concat(l,"] + begin[").concat(l,"]"):"coords[".concat(u-1,"] * strides[").concat(l,"] + begin[").concat(l,"]")}).join(",")}this.userCode=`
      `.concat(i," begin = ").concat(i,"(").concat(e,`);
      `).concat(i," strides = ").concat(i,"(").concat(t,`);

      void main() {
        `).concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(s,`));
      }
    `)}return r}();function sXe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,c=n.endMask,l=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask,p=k.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,w=p.begin,b=p.end,x=p.strides,S;if(v)S=Ae({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){k.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=k.slice_util.computeOutShape(w,b,x),E=rl({inputs:{x:a},backend:t,attrs:{begin:w,size:T}});S=Ae({inputs:{x:E},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.shouldExecuteOnCPU([a]);if(C){var R=t.readSync(a.dataId),_=k.buffer(a.shape,a.dtype,R),P=SVe(d,_,x,w);S=t.makeTensorInfo(m,a.dtype,P.values)}else{var $=new oXe(w,x,d);S=t.runWebGLProgram($,[a],a.dtype)}}var z=Ae({inputs:{x:S},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(S),z}var uXe={kernelName:k.StridedSlice,backendName:"webgl",kernelFunc:sXe};function cXe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,c=n.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.readSync(l.dataId),p=t.readSync(f.dataId),d=Te(NVe(h,p,a,i,o,s,u,c),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var lXe={kernelName:k.StringNGrams,backendName:"webgl",kernelFunc:cXe};function fXe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],c=Te(TVe(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var hXe={kernelName:k.StringSplit,backendName:"webgl",kernelFunc:fXe};function pXe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.readSync(i.dataId),s=EVe(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var dXe={kernelName:k.StringToHashBucketFast,backendName:"webgl",kernelFunc:pXe};var vXe="return tan(x);",mXe=It({opSnippet:vXe}),gXe={kernelName:k.Tan,backendName:"webgl",kernelFunc:mXe};var yXe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,bXe=It({opSnippet:yXe}),wXe={kernelName:k.Tanh,backendName:"webgl",kernelFunc:bXe};function xXe(r){var e=r.inputs,t=r.backend;r.attrs;var n=e.tensor,a=e.indices,i=e.updates,o=k.backend_util.calculateShapes(i,a,n.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,f=o.outputSize,h=[f/c,c];if(f===0)return t.makeTensorInfo(n.shape,a.dtype);var p=Ae({inputs:{x:a},backend:t,attrs:{shape:[u,s]}}),d=Ae({inputs:{x:i},backend:t,attrs:{shape:[u,c]}}),m=Ae({inputs:{x:n},backend:t,attrs:{shape:h}}),v=new hk(u,s,p.shape.length,d.shape.length,l,h,!1,!0),g=t.runWebGLProgram(v,[d,p,m],m.dtype),y=Ae({inputs:{x:g},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),y}var kXe={kernelName:k.TensorScatterUpdate,backendName:"webgl",kernelFunc:xXe};var SXe=function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;var i=$t(this.rank),o=NXe(e);this.userCode=`
      void main() {
        `.concat(i,` resRC = getOutputCoords();
        setOutput(getA(`).concat(o,`));
      }
    `)}return r}();function NXe(r){var e=r.length;if(e>5)throw Error("Tile for rank ".concat(e," is not yet supported"));if(e===1)return"imod(resRC, ".concat(r[0],")");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],a=0;a<r.length;a++)n.push("imod(".concat(t[a],", ").concat(r[a],")"));return n.join()}function VU(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;if(a.dtype==="string"||a.shape.length>5){var o=t.readSync(a.dataId),s=a.dtype==="string"?o.map(function(h){return k.util.decodeString(h)}):o,u=k.buffer(a.shape,a.dtype,s),c=CVe(u,i);return t.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new SXe(a.shape,i),f=t.runWebGLProgram(l,[a],a.dtype);return f}var TXe={kernelName:k.Tile,backendName:"webgl",kernelFunc:VU},EXe=function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}return r}(),IXe=function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}return r}();function bu(r,e){e!==null&&r.disposeIntermediateTensorInfo(e)}function pq(r){for(var e=1;e<r;)e*=2;return e}function CXe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted,s=k.env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=k.env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(t.shouldExecuteOnCPU([a])||l<s||i>u){var f=t.readSync(a.dataId),h=Te(AVe(f,c,a.dtype,i,o),2),p=h[0],d=h[1];return[t.makeTensorInfo(p.shape,p.dtype,p.values),t.makeTensorInfo(d.shape,d.dtype,d.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,a.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(l===1)return[a,Dh({attrs:{shape:c,dtype:"int32",value:0},backend:t})];var m=t.texData.get(a.dataId),v=m!==null&&m.isPacked,g=v?t.unpackTensor(a):a,y=k.util.sizeFromShape(c),w=y/l,b=Ae({inputs:{x:g},attrs:{shape:[w,l]},backend:t});v&&bu(t,g);for(var x=pq(i),S=pq(l),T=null,E=function(){return T===null?[b,b]:[b,T]},C=function(re,se,le){var de=E(),ke=new EXe(le),he=T===null?1:0,ye=[[l],[he],[Number.NEGATIVE_INFINITY],[re],[se]],xe=T;T=t.runWebGLProgram(ke,de,"int32",ye),bu(t,xe)},R=1;R<x;R*=2)for(var _=R*2,P=R;P>=1;P/=2)C(_,P,[w,S]);for(var $=S;$>x;$/=2){var z=E(),L=new IXe([w,$/2]),B=T===null?1:0,q=[[l],[B],[x]],Y=T;T=t.runWebGLProgram(L,z,"int32",q),bu(t,Y);for(var R=x/2,_=R*2,P=R;P>=1;P/=2)C(_,P,T.shape)}var J=T;T=rl({inputs:{x:T},backend:t,attrs:{begin:0,size:[w,i]}}),bu(t,J);var U=MU({inputs:{x:b,indices:T},backend:t,attrs:{axis:1,batchDims:1}});bu(t,b);var j=c.slice(0,-1);j.push(i),J=T,T=Ae({inputs:{x:T},attrs:{shape:j},backend:t}),bu(t,J);var ne=U;return U=Ae({inputs:{x:U},attrs:{shape:j},backend:t}),bu(t,ne),[U,T]}var AXe={kernelName:k.TopK,backendName:"webgl",kernelFunc:CXe};var DXe=function(){function r(e,t,n,a,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;var s=n==="nearest"?1:2,u;switch(a){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(`.concat(u,` == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < `).concat(e," && 0 <= coordX && coordX < ").concat(t,`) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(`).concat(i,`);
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(`).concat(i,`);
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(`).concat(t,`));
                float mapY = mapCoord(inY, float(`).concat(e,`));

                if (`).concat(s,` == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `)}return r}();function _Xe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=Te(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Te(c??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],w=new DXe(h,p,o,s,u,y);return t.runWebGLProgram(w,[a,i],"float32")}var FXe={kernelName:k.Transform,backendName:"webgl",kernelFunc:_Xe};function RXe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;Xc(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=n.readSync(i.dataId),s=DVe(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([l.length],"int32",l)]}var OXe={kernelName:k.Unique,backendName:"webgl",kernelFunc:RXe};function PXe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,f=0;f<s;f++)f!==i&&(c[l++]=o.shape[f]);var h=[],p=new Array(s).fill(0),d=o.shape.slice();d[i]=1;for(var m=new Array(u),f=0;f<m.length;f++){p[i]=f;var v=rl({inputs:{x:o},backend:t,attrs:{begin:p,size:d}}),g=Ae({inputs:{x:v},backend:t,attrs:{shape:c}});m[f]=g,h.push(v)}return h.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),m}var MXe={kernelName:k.Unpack,backendName:"webgl",kernelFunc:PXe};var BXe=function(){function r(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.numSegments,s=o*Math.ceil(i/n);this.outputShape=[a,s];var u="0.0",c="sumValue",l=Math.floor(n/4)*4,f=n%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";i%n>0&&(p=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `));var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return -1.0;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(u,`;

      float getValue(int batch, int inIdx) {
        `).concat(p,`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `).concat(d,`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `).concat(o,")) * float(").concat(n,`));
        int currentSeg = int(mod(float(outIdx), float(`).concat(o,`)));

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return r}();function LXe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments,s=a.shape.length,u=[],c=0,l=k.backend_util.getAxesPermutation([c],s),f=a;l!=null&&(f=Tn({inputs:{x:a},backend:t,attrs:{perm:l}}),u.push(f),c=k.backend_util.getInnerMostAxes(1,s)[0]);var h=k.backend_util.segment_util.computeOutShape(f.shape,c,o),p=k.util.sizeFromShape([f.shape[c]]),d=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,p]}});u.push(d);var m=k.sumOutType(a.dtype),v=function(x,S,T,E,C){var R=x.shape[0],_=x.shape[1],P=k.backend_util.segment_util.segOpComputeOptimalWindowSize(_,C),$={windowSize:P,inSize:_,batchSize:R,numSegments:C},z=new BXe($,S),L=t.compileAndRun(z,[x,T],E);if(u.push(L),L.shape[1]===C)return L;var B=UU({backend:t,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),q=VU({inputs:{x:B},backend:t,attrs:{reps:[_/P]}});u.push(B),u.push(q);var Y=v(L,S,q,E,C);return Y},g=v(d,"unsortedSegmentSum",i,m,o),y=Ae({inputs:{x:g},backend:t,attrs:{shape:h}}),w=y;if(l!=null){u.push(y);var b=k.backend_util.getUndoAxesPermutation(l);w=Tn({inputs:{x:w},backend:t,attrs:{perm:b}})}return u.forEach(function(x){return t.disposeIntermediateTensorInfo(x)}),w}var zXe={kernelName:k.UnsortedSegmentSum,backendName:"webgl",kernelFunc:LXe},qx,dq,$Xe=[SGe,TGe,CGe,_Ge,RGe,MGe,LGe,$Ge,VGe,HGe,XGe,JGe,t6e,i6e,u6e,l6e,h6e,m6e,y6e,w6e,N6e,_6e,R6e,B6e,z6e,G6e,K6e,Z6e,oGe,eHe,iHe,cHe,vHe,yHe,wHe,kHe,NHe,CHe,_He,OHe,MHe,LHe,$He,UHe,GHe,XHe,ZHe,e5e,n5e,i5e,c5e,p5e,g5e,w5e,S5e,N5e,E5e,C5e,D5e,F5e,O5e,L5e,W5e,V5e,H5e,X5e,J5e,rKe,oKe,iGe,uKe,nHe,fKe,dKe,gKe,uGe,xKe,TKe,IKe,_Ke,OKe,LKe,WKe,GKe,XKe,JKe,eje,aje,oje,uje,hje,dje,mje,yje,wje,Nje,Cje,Fje,$je,fGe,Vje,Kje,Yje,Qje,W6e,r8e,a8e,o8e,c8e,p8e,lGe,v8e,g8e,b8e,x8e,k8e,q6e,Mje,T8e,A8e,R8e,pGe,B8e,$8e,V8e,K8e,Z8e,Q8e,r7e,i7e,u7e,f7e,d7e,g7e,x7e,N7e,C7e,_7e,A6e,Lje,O7e,M7e,L7e,$7e,q7e,V7e,H7e,j7e,Y7e,Q7e,tXe,nXe,iXe,uXe,lXe,hXe,dXe,Bje,wGe,gXe,wXe,kXe,TXe,AXe,FXe,xGe,OXe,MXe,zXe,n8e];try{for(mh=Nn($Xe),Gc=mh.next();!Gc.done;Gc=mh.next())vq=Gc.value,k.registerKernel(vq)}catch(r){qx={error:r}}finally{try{Gc&&!Gc.done&&(dq=mh.return)&&dq.call(mh)}finally{if(qx)throw qx.error}}var vq,mh,Gc;vo.GPGPUContext=bm;vo.MathBackendWebGL=uk;vo.forceHalfFloat=vU;vo.gpgpu_util=Pqe;vo.setWebGLContext=mq;vo.version_webgl=nGe;vo.webgl=aGe;vo.webgl_util=WWe});var Kh=X(Ea=>{"use strict";var mk=Ls(),WXe=$O(),gk=FB(),yk=Iz(),mV=r$(),bk=zW(),wk=GU();function gV(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var HU=gV(WXe),qXe=gV(mV),yV="Abs",bV="Acos",wV="Acosh",Lk="Add",UXe="AddN",VXe="All",GXe="Any",xV="ArgMax",kV="ArgMin",SV="Asin",NV="Asinh",TV="Atan",EV="Atanh",IV="Atan2",CV="AvgPool",HXe="AvgPoolGrad",KXe="AvgPool3D",jXe="AvgPool3DGrad",AV="BatchMatMul",DV="BatchToSpaceND",XXe="BroadcastTo",zk="Cast",_V="Ceil",FV="ClipByValue",YXe="Complex",RV="ComplexAbs",OV="Concat",PV="Conv2D",ZXe="Conv2DBackpropFilter",MV="Conv2DBackpropInput",JXe="Conv3D",QXe="Conv3DBackpropFilterV2",e9e="Conv3DBackpropInputV2",BV="Cos",LV="Cosh",t9e="Cumprod",zV="Cumsum",r9e="DepthToSpace",$V="DepthwiseConv2dNative",n9e="DepthwiseConv2dNativeBackpropFilter",a9e="DepthwiseConv2dNativeBackpropInput",WV="Dilation2D",i9e="Dilation2DBackpropInput",o9e="Dilation2DBackpropFilter",qV="RealDiv",UV="Elu",s9e="EluGrad",VV="Erf",u9e="Equal",GV="Exp",HV="ExpandDims",KV="Expm1",c9e="FFT",l9e="Fill",jV="Floor",XV="FloorDiv",YV="FusedBatchNorm",ZV="GatherV2",f9e="Greater",JV="GreaterEqual",$k="Identity",h9e="IFFT",p9e="Imag",QV="IsFinite",eG="IsInf",tG="IsNan",rG="LeakyRelu",d9e="Less",v9e="LessEqual",nG="Log",aG="Log1p",m9e="LogicalAnd",g9e="LogicalNot",y9e="LogicalOr",b9e="LogSoftmax",iG="LRN",w9e="LRNGrad",oG="Max",sG="Maximum",uG="MaxPool",x9e="MaxPoolGrad",k9e="MaxPool3D",S9e="MaxPool3DGrad",cG="Mean",lG="Min",fG="Minimum",hG="MirrorPad",pG="Mod",dG="Multiply",vG="Neg",N9e="NotEqual",mG="OnesLike",gG="OneHot",yG="Pack",bG="PadV2",wG="Pow",xG="Prelu",kG="Prod",T9e="Real",SG="Reciprocal",NG="Relu",TG="Reshape",EG="ResizeNearestNeighbor",E9e="ResizeNearestNeighborGrad",IG="ResizeBilinear",I9e="ResizeBilinearGrad",CG="Relu6",AG="Reverse",DG="Round",_G="Rsqrt",C9e="TensorScatterUpdate",FG="Select",RG="Selu",OG="Slice",PG="Sin",MG="Sinh",BG="Sign",LG="Sigmoid",zG="Softplus",$G="Sqrt",WG="Sum",qG="SpaceToBatchND",UG="SplitV",VG="Softmax",GG="SquaredDifference",A9e="Square",D9e="StridedSlice",HG="Sub",KG="Tan",jG="Tanh",Wk="Tile",_9e="TopK",Cm="Transpose",F9e="Unique",XG="Unpack",YG="UnsortedSegmentSum",ZG="ZerosLike",JG="Step";var R9e=1e-7,O9e=1e-4,xk=class{refCount(e){return fa("refCount")}incRef(e){return fa("incRef")}timerAvailable(){return!0}time(e){return fa("time")}read(e){return fa("read")}readSync(e){return fa("readSync")}readToGPU(e,t){return fa("readToGPU")}numDataIds(){return fa("numDataIds")}disposeData(e,t){return fa("disposeData")}write(e,t,n){return fa("write")}move(e,t,n,a,i){return fa("move")}createTensorFromGPUData(e,t,n){return fa("createTensorFromGPUData")}memory(){return fa("memory")}floatPrecision(){return fa("floatPrecision")}epsilon(){return this.floatPrecision()===32?R9e:O9e}dispose(){return fa("dispose")}};function fa(r){throw new Error(`'${r}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function ie(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function P9e(r,e,t=""){ie(qk(r,e),()=>t+` Shapes ${r} and ${e} must match`)}function go(r){if(r.length===0)return 1;let e=r[0];for(let t=1;t<r.length;t++)e*=r[t];return e}function qk(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Lh(r){return r%1===0}function Am(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Ui(r,e){let t=e.length;return r=r==null?e.map((n,a)=>a):[].concat(r),ie(r.every(n=>n>=-t&&n<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${r}`),ie(r.every(n=>Lh(n)),()=>`All values in axis param must be integers but got axis ${r}`),r.map(n=>n<0?t+n:n)}function M9e(r,e){let t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Ui(e,r).sort(),o=0;for(let s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${r[s]}' is not 1`);(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function B9e(r,e){for(let t=0;t<r.length;t++){let n=r[t];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function L9e(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function kk(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error(`Unknown dtype ${r}`)}function z9e(r){if(r==null)return 0;let e=0;return r.forEach(t=>e+=t.length),e}function Uk(r){return typeof r=="string"||r instanceof String}function $9e(r){return typeof r=="boolean"}function W9e(r){return typeof r=="number"}function Wm(r){return Array.isArray(r)?Wm(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":W9e(r)?"float32":Uk(r)?"string":$9e(r)?"bool":"float32"}function Sk(r){return!!(r&&r.constructor&&r.call&&r.apply)}function QG(r){let e=r.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=r[e-1];for(let n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function e6(r,e,t,n=!1){let a=new Array;if(e.length===1){let i=e[0]*(n?2:1);for(let o=0;o<i;o++)a[o]=t[r+o]}else{let i=e[0],o=e.slice(1),s=o.reduce((u,c)=>u*c)*(n?2:1);for(let u=0;u<i;u++)a[u]=e6(r+u*s,o,t,n)}return a}function KU(r,e,t=!1){if(r.length===0)return e[0];let n=r.reduce((a,i)=>a*i)*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${r}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return e6(0,r,e,t)}function t6(r,e){let t=Vk(r,e);for(let n=0;n<t.length;n++)t[n]=1;return t}function Vk(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error(`Unknown data type ${e}`)}function Hh(r){r.forEach(e=>{ie(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${r}].`)})}function Gk(r){return r&&r.then&&typeof r.then=="function"}var jU="tfjsflags",Nk=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=q9e,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(ar().getBool("IS_TEST")||ar().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let a=this.urlFlags[e];ar().getBool("IS_TEST")||ar().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${a}.`),this.set(e,a)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(Gk(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);jU in e&&e[jU].split(",").forEach(n=>{let[a,i]=n.split(":");this.urlFlags[a]=V9e(a,i)})}};function q9e(r){let e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...n)=>(U9e(e,n[0],n[1]),n.join("="))),e}function U9e(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function V9e(r,e){let t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function ar(){return r6}var r6=null;function G9e(r){r6=r}var pk;function n6(){if(pk==null){let r;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");pk=r}return pk}function H9e(){let r=n6();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Hk(r,e){let t=H9e();if(t.has(r))return t.get(r);{let n=e();return t.set(r,n),t.get(r)}}function nl(...r){ar().getBool("IS_TEST")||ar().getBool("PROD")||console.warn(...r)}var a6=Hk("kernelRegistry",()=>new Map),Tk=Hk("gradRegistry",()=>new Map);function XU(r,e){let t=j9e(r,e);return a6.get(t)}function YU(r){return Tk.get(r)}function ZU(r){let e=a6.entries(),t=[];for(;;){let{done:n,value:a}=e.next();if(n)break;let[i,o]=a,[s]=i.split("_");s===r&&t.push(o)}return t}function K9e(r){let{kernelName:e}=r;Tk.has(e)&&ar().getBool("DEBUG")&&nl(`Overriding the gradient for '${e}'`),Tk.set(e,r)}function j9e(r,e){return`${e}_${r}`}function X9e(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var Y9e=HU.default||HU;function Kk(r){return Y9e.fromString(r,!0,16)}var _lt=Kk("c3a5c85c97cb3127"),Flt=Kk("b492b66fbe98f273"),Rlt=Kk("9ae16a3b2f90404f");function Z9e(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function i6(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=zh(r)),ar().getBool("DEBUG")&&B9e(r,e),Z9e(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){let t=new Uint8Array(r.length);for(let n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Rm(){return ar().platform.now()}function J9e(r,e="utf-8"){return e=e||"utf-8",ar().platform.encode(r,e)}function JU(r,e="utf-8"){return e=e||"utf-8",ar().platform.decode(r,e)}function ni(r){return ar().platform.isTypedArray!=null?ar().platform.isTypedArray(r):X9e(r)}function zh(r,e=[],t=!1){if(e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||Gk(r)||r==null||ni(r)&&t)e.push(r);else if(Array.isArray(r)||ni(r))for(let n=0;n<r.length;++n)zh(r[n],e,t);else{let n=-1;for(let a of Object.keys(r))/^([1-9]+[0-9]*|0)$/.test(a)&&(n=Math.max(n,Number(a)));for(let a=0;a<=n;a++)zh(r[a],e,t)}return e}var Ek=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Ik)}profileKernel(e,t,n){let a,i=()=>{a=n()},o,s=Rm();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(let c of a)c.dataSync();o=Promise.resolve({kernelMs:Rm()-s})}if(ar().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<a.length;c++){let l=a[c];l.data().then(f=>{Q9e(f,l.dtype,e)})}return{kernelName:e,outputs:a,inputs:t,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:a,inputs:i,extraInfo:o}=e;n.forEach(s=>{Promise.all([s.data(),a,o]).then(u=>{this.logger.logKernelProfile(t,s,u[0],u[1],i,u[2])})})}};function Q9e(r,e,t){if(e!=="float32")return!1;for(let n=0;n<r.length;n++){let a=r[n];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${t}'`),!0}return!1}var Ik=class{logKernelProfile(e,t,n,a,i,o){let s=typeof a=="number"?Am(`${a}ms`,9):a.error,u=Am(e,25),c=t.rank,l=t.size,f=Am(t.shape.toString(),14),h="";for(let p in i){let d=i[p];if(d!=null){let m=d.shape||t.shape,v=m.length;h+=`${p}: ${v}D ${v>0?m:""} `}}console.log(`%c${u}	%c${s}	%c${c}D ${f}	%c${l}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function eYe(r,e,t){let n={},a={};for(let u=0;u<e.length;u++)n[e[u].id]=!0;for(let u=0;u<r.length;u++){let c=r[u],l=c.inputs;for(let f in l){let h=l[f],p=!1;for(let d=0;d<e.length;d++)if(n[h.id]){c.outputs.forEach(m=>n[m.id]=!0),p=!0,a[c.id]=!0;break}if(p)break}}let i={};i[t.id]=!0;let o={};for(let u=r.length-1;u>=0;u--){let c=r[u],l=c.inputs;for(let f=0;f<c.outputs.length;f++)if(i[c.outputs[f].id]){for(let h in l)i[l[h].id]=!0,o[c.id]=!0;break}}let s=[];for(let u=0;u<r.length;u++){let c=r[u];if(a[c.id]&&o[c.id]){let l={};for(let h in c.inputs){let p=c.inputs[h];n[p.id]&&(l[h]=p)}let f=Object.assign({},c);f.inputs=l,f.outputs=c.outputs,s.push(f)}}return s}function tYe(r,e,t,n){for(let a=e.length-1;a>=0;a--){let i=e[a],o=[];if(i.outputs.forEach(u=>{let c=r[u.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let s=i.gradient(o);for(let u in i.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);let c=t(()=>s[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);let l=i.inputs[u];if(!qk(c.shape,l.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${l.shape}'`);if(r[l.id]==null)r[l.id]=c;else{let f=r[l.id];r[l.id]=n(f,c),f.dispose()}}}}var QU=20,_h=3,dk=7;function rYe(r,e,t,n){let a=QG(e),i=nYe(r,e,t,a),o=e.length,s=Dm(r,e,t,a,i),u=["Tensor"];return n&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(s.map(c=>"    "+c).join(`
`)),u.join(`
`)}function nYe(r,e,t,n){let a=go(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Mh(r):r;if(s>1)for(let c=0;c<a/i;c++){let l=c*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Ph(u[l+f],0,t).length)}return o}function Ph(r,e,t){let n;return Array.isArray(r)?n=`${parseFloat(r[0].toFixed(dk))} + ${parseFloat(r[1].toFixed(dk))}j`:Uk(r)?n=`'${r}'`:t==="bool"?n=o6(r):n=parseFloat(r.toFixed(dk)).toString(),Am(n,e)}function o6(r){return r===0?"false":"true"}function Dm(r,e,t,n,a,i=!0){let o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){let m=Mh(r);return[Ph(m[0],0,t)]}return t==="bool"?[o6(r[0])]:[r[0].toString()]}if(u===1){if(s>QU){let v=_h*o,g=Array.from(r.slice(0,v)),y=Array.from(r.slice((s-_h)*o,s*o));return t==="complex64"&&(g=Mh(g),y=Mh(y)),["["+g.map((w,b)=>Ph(w,a[b],t)).join(", ")+", ..., "+y.map((w,b)=>Ph(w,a[s-_h+b],t)).join(", ")+"]"]}return["["+(t==="complex64"?Mh(r):Array.from(r)).map((v,g)=>Ph(v,a[g],t)).join(", ")+"]"]}let c=e.slice(1),l=n.slice(1),f=n[0]*o,h=[];if(s>QU){for(let m=0;m<_h;m++){let v=m*f,g=v+f;h.push(...Dm(r.slice(v,g),c,t,l,a,!1))}h.push("...");for(let m=s-_h;m<s;m++){let v=m*f,g=v+f;h.push(...Dm(r.slice(v,g),c,t,l,a,m===s-1))}}else for(let m=0;m<s;m++){let v=m*f,g=v+f;h.push(...Dm(r.slice(v,g),c,t,l,a,m===s-1))}let p=u===2?",":"";h[0]="["+(s>0?h[0]+p:"");for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+p;let d=`,
`;for(let m=2;m<u;m++)d+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":d),h}function Mh(r){let e=[];for(let t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Wi=null,Fh=null,aYe=null;function iYe(r){Wi=r}function oYe(r){aYe=r}var Bn=class{constructor(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=go(e),this.strides=QG(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return Fh.buffer(this.shape,this.dtype,e)}bufferSync(){return Fh.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return KU(this.shape,e,this.dtype==="complex64")}arraySync(){return KU(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=Wi().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(n=>JU(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Wi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=Wi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>JU(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await Wi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Wi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Fh.print(this,e)}clone(){return this.throwIfDisposed(),Fh.clone(this)}toString(e=!1){let t=this.dataSync();return rYe(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Fh.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),Wi().makeVariable(this,e,t,n)}};Object.defineProperty(Bn,Symbol.hasInstance,{value:r=>!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null});function ce(){return Hk("Tensor",()=>Bn)}ce();var il=class extends Bn{constructor(e,t,n,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!qk(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Wi().disposeTensor(this),this.dataId=e.dataId,Wi().incRef(this,null)}dispose(){Wi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(il,Symbol.hasInstance,{value:r=>r instanceof Bn&&r.assign!=null&&r.assign instanceof Function});var eV;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(eV||(eV={}));var Ck;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(Ck||(Ck={}));var Ak;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(Ak||(Ak={}));var Dk;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(Dk||(Dk={}));var _k;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(_k||(_k={}));var sYe={float32:Dk,int32:Ck,bool:Ak,complex64:_k};function uYe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${r} with ${e}`)}return sYe[r][e]}function s6(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function u6(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function rn(r,e){if(r.dtype===e.dtype)return[r,e];let t=uYe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function c6(r){let e=[];return l6(r,e,new Set),e}function l6(r,e,t){if(r==null)return;if(r instanceof Bn){e.push(r);return}if(!cYe(r))return;let n=r;for(let a in n){let i=n[a];t.has(i)||(t.add(i),l6(i,e,t))}}function cYe(r){return Array.isArray(r)||typeof r=="object"}function vk(r){return r.kernelName!=null}var Om=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},ps=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Om}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(nl(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Ek(this.backendInstance),!0}setupRegisteredKernels(){ZU(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){ZU(e).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=t.factory();if(n&&!(n instanceof xk)&&typeof n.then=="function"){let a=++this.pendingBackendInitId,i=n.then(o=>a<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,nl(`Initialization of backend ${e} failed`),nl(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(n){return nl(`Initialization of backend ${e} failed`),nl(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t],{success:a,asyncInit:i}=this.initializeBackend(n);if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");n=e}let a;return this.scopedRun(()=>this.startScope(n),()=>this.endScope(a),()=>(a=t(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(e,t,n){e();try{let a=n();return t(),a}catch(a){throw t(),a}}nextTensorId(){return ps.nextTensorId++}nextVariableId(){return ps.nextVariableId++}clone(e){let t=ae.runKernel($k,{x:e}),n={x:e},a=o=>({x:()=>{let s="float32",u={x:o},c={dtype:s};return ae.runKernel(zk,u,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t}runKernel(e,t,n){if(this.backendName==null&&this.backend,!(XU(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){let a=this.backend.numDataIds(),i=0;n.forEach(u=>{i+=u.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[],a=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u,c=vk(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(vk(e)){let{kernelName:d,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;let g=XU(d,this.backendName);ie(g!=null,()=>`Cannot find registered kernel '${d}' for backend '${this.backendName}'`),s=()=>{let y=this.backend.numDataIds();u=g.kernelFunc({inputs:m,attrs:v,backend:this.backend});let w=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,y,w);let b=w.map(x=>x.rank!=null?x:this.makeTensorFromTensorInfo(x));if(a){let x=this.getTensorsForGradient(d,m,b);n=this.saveTensorsForBackwardMode(x)}return b}}else{let{forwardFunc:d}=e,m=v=>{!a||(n=v.map(g=>this.keep(this.clone(g))))};s=()=>{let v=this.backend.numDataIds();u=this.tidy(()=>d(this.backend,m));let g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,v,g),g}}let{inputs:l,attrs:f}=e,h=vk(e)?null:e.backwardsFunc,p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=s():(p=this.profiler.profileKernel(c,l,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),a&&this.addTapeNode(c,l,t,h,n,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(d=>l[d]!=null?l[d].shape:null),outputShapes:t.map(d=>d.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(e,t,n){let a=YU(e);if(a!=null){let i=a.inputsToSave||[],o=a.outputsToSave||[],s;a.saveAllInputs?(ie(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(c=>t[c])):s=i.map(c=>t[c]);let u=n.filter((c,l)=>o[l]);return s.concat(u)}return[]}makeTensor(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;let i=e;n==="string"&&Uk(e[0])&&(i=e.map(u=>J9e(u)));let o=a.write(i,t,n),s=new Bn(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){let u=this.state.tensorInfo.get(o),c=z9e(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s}makeTensorFromDataId(e,t,n,a){n=n||"float32";let i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)}makeTensorFromTensorInfo(e,t){let{dataId:n,shape:a,dtype:i}=e,o=new Bn(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,n,a){n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));let i=new il(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*kk(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof il||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let n=e.size*kk(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,n,a,i,o){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=YU(e);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=c=>(c=c.map((l,f)=>{if(l==null){let h=n[f],p=Vk(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return l}),a(c.length>1?c:c[0],i,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=c6(e),n=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let o=this.state.activeScope.track[i];!o.kept&&!n.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===a.id&&this.track(i)})}gradients(e,t,n,a=!1){if(ie(t.length>0,()=>"gradients() received an empty list of xs."),n!=null&&n.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));ie(i instanceof Bn,()=>"The result y returned by f() must be a tensor.");let o=eYe(this.state.activeTape,t,i);if(!a&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let s={};s[i.id]=n??lYe(i.shape),tYe(s,o,c=>this.tidy(c),hYe);let u=t.map(c=>s[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(let l of c.saved)l.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(e){return ie(Sk(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{ie(t.every(s=>s instanceof Bn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let n,a={};t.forEach((s,u)=>{a[u]=s});let i=(s,u)=>(n=e(...t,u),ie(n.value instanceof Bn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ie(Sk(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),o=(s,u)=>{let c=n.gradFunc(s,u),l=Array.isArray(c)?c:[c];ie(l.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ie(l.every(h=>h instanceof Bn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return l.forEach((h,p)=>{f[p]=()=>h}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=Rm(),n=await this.backend.time(e);return n.wallMs=Rm()-t,n}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Om;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};ps.nextTensorId=0;ps.nextVariableId=0;function lYe(r){let e=t6(go(r),"float32");return ae.makeTensor(e,r,"float32")}function fYe(){let r=n6();if(r._tfengine==null){let e=new Nk(r);r._tfengine=new ps(e)}return G9e(r._tfengine.ENV),iYe(()=>r._tfengine),r._tfengine}var ae=fYe();function hYe(r,e){let t={a:r,b:e};return ae.runKernel(Lk,t)}function pYe(r,e){let t=r;if(ni(r))return e==="string"?[]:[r.length];if(s6(r)){let a=r.channels||"RGBA";return[r.height,r.width*a.length]}else if(u6(r))return[r.buffer.size/(e==null?4:kk(e))];if(!Array.isArray(r))return[];let n=[];for(;Array.isArray(t)||ni(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&ar().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&f6(r,n,[]),n}function f6(r,e,t){if(t=t||[],!Array.isArray(r)&&!ni(r)){ie(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}ie(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${r.length} elements`),ie(r.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${r.length} elements`);let n=e.slice(1);for(let a=0;a<r.length;++a)f6(r[a],n,t.concat(a))}function tV(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${n}' must be ${r} tensor, but got ${e} tensor`)}}function ee(r,e,t,n="numeric"){if(r instanceof ce())return tV(n,r.dtype,e,t),r;let a=Wm(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),tV(n,a,e,t),r==null||!ni(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){let u=r==null?"null":r.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}let i=pYe(r,a);!ni(r)&&!Array.isArray(r)&&(r=[r]);let s=a!=="string"?i6(r,a):zh(r,[],!0);return ae.makeTensor(s,i,a)}function h6(r,e,t,n="numeric"){if(!Array.isArray(r))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return r.map((i,o)=>ee(i,`${e}[${o}]`,t,n))}var dYe="__op";function ue(r){let e=Object.keys(r);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+dYe;let a=(...i)=>{ae.startScope(t);try{let o=n(...i);return Gk(o)&&console.error("Cannot return a Promise inside of tidy."),ae.endScope(o),o}catch(o){throw ae.endScope(null),o}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function vYe(r,e){let t=ee(r,"x","cast");if(!L9e(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:t},a={dtype:e};return ae.runKernel(zk,n,a)}var ot=ue({cast_:vYe});function mYe(r,e){let t=ee(r,"a","mul"),n=ee(e,"b","mul");[t,n]=rn(t,n);let a={a:t,b:n};return ae.runKernel(dG,a)}var $e=ue({mul_:mYe});function gYe(r,e=0){let n={x:ee(r,"x","step")},a={alpha:e};return ae.runKernel(JG,n,a)}var qm=ue({step_:gYe});var p6={kernelName:yV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,qm(ot(t,"float32"),-1))}}};function yYe(r,e){let t=ee(r,"a","floorDiv"),n=ee(e,"b","floorDiv");[t,n]=rn(t,n);let a={a:t,b:n};return ae.runKernel(XV,a)}var d6=ue({floorDiv_:yYe});function bYe(r,e){let t=ee(r,"a","div"),n=ee(e,"b","div");if([t,n]=rn(t,n),t.dtype==="int32"&&n.dtype==="int32")return d6(t,n);let a={a:t,b:n},i={};return ae.runKernel(qV,a,i)}var Fr=ue({div_:bYe});function wYe(r){let t={x:ee(r,"x","neg")};return ae.runKernel(vG,t)}var In=ue({neg_:wYe});function xYe(r,e,t,n){if(n==null)n=Wm(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(u6(r)||s6(r)){if(n!=="float32"&&n!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${n}.`);return ae.backend.createTensorFromGPUData(r,e||t,n)}if(!ni(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Hh(e);let a=go(e),i=go(t);ie(a===i,()=>`Based on the provided shape, [${e}], the tensor should have ${a} values but has ${i}`);for(let o=0;o<t.length;++o){let s=t[o],u=o===t.length-1?s!==go(e.slice(o)):!0;ie(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!ni(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?i6(r,n):zh(r,[],!0),ae.makeTensor(r,e,n)}function tn(r,e){if((ni(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ni(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return xYe(r,[],[],e)}function kYe(r){let t={x:ee(r,"x","sqrt","float32")};return ae.runKernel($G,t)}var ds=ue({sqrt_:kYe});function SYe(r){let e=ee(r,"x","square"),t={};return ae.runKernel("Square",{x:e},t)}var fn=ue({square_:SYe});function NYe(r,e){let t=ee(r,"a","sub"),n=ee(e,"b","sub");[t,n]=rn(t,n);let a={a:t,b:n};return ae.runKernel(HG,a)}var mn=ue({sub_:NYe});var TYe={kernelName:bV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=fn(ot(t,"float32")),a=ds(mn(tn(1),n));return In(Fr(r,a))}}}};var EYe={kernelName:wV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=ds(mn(fn(ot(t,"float32")),1));return Fr(r,n)}}}};function hn(r,e){let t=[];for(let n=0;n<e.length;n++){let a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Rr(r,e){let t=Math.max(r.length,e.length),n=new Array(t);for(let a=0;a<t;a++){let i=r[r.length-a-1];i==null&&(i=1);let o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){let s=`Operands could not be broadcast together with shapes ${r} and ${e}.`;throw Error(s)}else n[t-a-1]=i}return n}function IYe(r,e){let n={x:ee(r,"x","reshape","string_or_numeric")},a={shape:e};return ae.runKernel(TG,n,a)}var pe=ue({reshape_:IYe});function CYe(r,e=null,t=!1){let n=ee(r,"x","sum");n.dtype==="bool"&&(n=ot(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ae.runKernel(WG,a,i)}var At=ue({sum_:CYe});var AYe={kernelName:Lk,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Rr(t.shape,n.shape);return{a:()=>{let s=r,u=hn(t.shape,a);return u.length>0&&(s=At(s,u)),pe(s,t.shape)},b:()=>{let s=r,u=hn(n.shape,a);return u.length>0&&(s=At(s,u)),pe(s,n.shape)}}}};var DYe={kernelName:UXe,saveAllInputs:!0,gradFunc:(r,e)=>{let t={};return e.forEach((n,a)=>{t[a]=()=>r.clone()}),t}};function _Ye(r){let t={x:ee(r,"x","zerosLike")};return ae.runKernel(ZG,t)}var kr=ue({zerosLike_:_Ye});var FYe={kernelName:xV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>kr(t)}}};var RYe={kernelName:kV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>kr(t)}}};var OYe={kernelName:SV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Fr(r,ds(mn(tn(1),fn(ot(t,"float32")))))}}};function PYe(r,e){let t=ee(r,"a","add"),n=ee(e,"b","add");[t,n]=rn(t,n);let a={a:t,b:n};return ae.runKernel(Lk,a)}var ri=ue({add_:PYe});var MYe={kernelName:NV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=ds(ri(tn(1),fn(ot(t,"float32"))));return Fr(r,n)}}}};var BYe={kernelName:IV,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Rr(t.shape,n.shape);return{a:()=>{let s=ri(fn(t),fn(n)),u=$e(r,Fr(n,s)),c=hn(t.shape,a);return c.length>0&&(u=At(u,c)),pe(u,t.shape)},b:()=>{let s=ri(fn(t),fn(n)),u=In($e(r,Fr(t,s))),c=hn(n.shape,a);return c.length>0&&(u=At(u,c)),pe(u,n.shape)}}}};var LYe={kernelName:TV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Fr(r,ri(fn(ot(t,"float32")),1))}}};var zYe={kernelName:EV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Fr(r,mn(tn(1),fn(ot(t,"float32"))))}}};function $Ye(r,e,t,n,a,i,o="channelsLast"){let[s,u]=$h(e),c;if(o==="channelsLast")c=[s,u,r[3],r[3]];else if(o==="channelsFirst")c=[s,u,r[1],r[1]];else throw new Error(`Unknown dataFormat ${o}`);return WYe(r,c,t,n,a,i,!1,o)}function WYe(r,e,t,n,a,i,o=!1,s="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if(s==="channelsLast")[u,c,l,f]=r;else if(s==="channelsFirst")[u,f,c,l]=r;else throw new Error(`Unknown dataFormat ${s}`);let[h,p,,d]=e,[m,v]=$h(t),[g,y]=$h(n),w=Fk(h,g),b=Fk(p,y),{padInfo:x,outHeight:S,outWidth:T}=VYe(a,c,l,m,v,w,b,i,s),E=o?d*f:d,C;return s==="channelsFirst"?C=[u,E,S,T]:s==="channelsLast"&&(C=[u,S,T,E]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:f,outHeight:S,outWidth:T,outChannels:E,padInfo:x,strideHeight:m,strideWidth:v,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:b,dilationHeight:g,dilationWidth:y,inShape:r,outShape:C,filterShape:e}}function qYe(r,e,t,n,a){n==null&&(n=UYe(r,e,t));let i=r[0],o=r[1],s=Pm((i-e+2*n)/t+1,a),u=Pm((o-e+2*n)/t+1,a);return[s,u]}function UYe(r,e,t,n=1){let a=Fk(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function $h(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Fk(r,e){return e<=1?r:r+(r-1)*(e-1)}function VYe(r,e,t,n,a,i,o,s,u){let c,l,f;if(typeof r=="number"){c={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};let p=qYe([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);let h=Math.max(0,(l-1)*n+i-e),p=Math.max(0,(f-1)*a+o-t),d=Math.floor(h/2),m=h-d,v=Math.floor(p/2),g=p-v;c={top:d,bottom:m,left:v,right:g,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){let h=u==="channelsLast"?r[1][0]:r[2][0],p=u==="channelsLast"?r[1][1]:r[2][1],d=u==="channelsLast"?r[2][0]:r[3][0],m=u==="channelsLast"?r[2][1]:r[3][1];c={top:h,bottom:p,left:d,right:m,type:h===0&&p===0&&d===0&&m===0?"VALID":"EXPLICIT"},l=Pm((e-i+h+p)/n+1,s),f=Pm((t-o+d+m)/a+1,s)}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:c,outHeight:l,outWidth:f}}function Pm(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error(`Unknown roundingMode ${e}`)}}function Wh(r){let[e,t,n]=$h(r);return e===1&&t===1&&n===1}function cl(r,e){return Wh(r)||Wh(e)}function Mm(r){return $h(r).every(e=>e>0)}function Ei(r,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")ie(Lh(e),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(a=>{ie(Lh(a),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${a}.`)})});else throw Error(`Error in ${r}: Unknown padding parameter: ${e}`)}}function GYe(r,e,t,n,a,i){let o=ee(r,"dy","avgPool3dGrad"),s=ee(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=pe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),ie(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),ie(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Ei("avgPool3dGrad",a,i);let f={dy:u,input:c},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ae.runKernel(jXe,f,h);return l?pe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var HYe=ue({avgPool3dGrad_:GYe});var KYe={kernelName:KXe,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=t;return{x:()=>HYe(r,n,a,i,o,s)}}};function jYe(r,e,t,n,a){let i=ee(r,"dy","avgPoolGrad"),o=ee(e,"input","avgPoolGrad");ie(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let s=o,u=i,c=!1;o.rank===3&&(c=!0,s=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),ie(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);let l={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ae.runKernel(HXe,l,f);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var XYe=ue({avgPoolGrad_:jYe});var YYe={kernelName:CV,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o}=t;return{x:()=>XYe(r,n,a,i,o)}}};function ZYe(r,e,t=!1,n=!1){let a=ee(r,"a","matMul"),i=ee(e,"b","matMul");[a,i]=rn(a,i);let o={a,b:i},s={transposeA:t,transposeB:n};return ae.runKernel(AV,o,s)}var Ta=ue({matMul_:ZYe});var JYe={kernelName:AV,inputsToSave:["a","b"],gradFunc:(r,e,t)=>{let[n,a]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Ta(r,a,!1,!0),b:()=>Ta(n,r,!0,!1)}:!i&&o?{a:()=>Ta(r,a,!1,!1),b:()=>Ta(r,n,!0,!1)}:i&&!o?{a:()=>Ta(a,r,!1,!0),b:()=>Ta(n,r,!1,!1)}:{a:()=>Ta(a,r,!0,!0),b:()=>Ta(r,n,!0,!0)}}};function QYe(r,e,t){let n=ee(r,"x","spaceToBatchND");ie(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),ie(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),ie(n.shape.reduce((o,s,u)=>u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let a={x:n},i={blockShape:e,paddings:t};return ae.runKernel(qG,a,i)}var jk=ue({spaceToBatchND_:QYe});var eZe={kernelName:DV,gradFunc:(r,e,t)=>{let{blockShape:n,crops:a}=t;return{x:()=>jk(r,n,a)}}};var tZe={kernelName:XXe,gradFunc:(r,e,t)=>{let n=t,a=n.inputShape,i=n.shape,o=Array.from(i);for(let u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);let s=[];for(let u=0;u<o.length;u++)o[u]>1&&s.push(u);return{x:()=>At(r,s,!0)}}};var rZe={kernelName:zk,gradFunc:r=>({x:()=>r.clone()})};var nZe={kernelName:_V,gradFunc:r=>({x:()=>kr(r)})};function aZe(r,e){let t=ee(r,"a","greaterEqual","string_or_numeric"),n=ee(e,"b","greaterEqual","string_or_numeric");[t,n]=rn(t,n),Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(JV,a)}var Um=ue({greaterEqual_:aZe});function iZe(r,e){let t=ee(r,"a","lessEqual","string_or_numeric"),n=ee(e,"b","lessEqual","string_or_numeric");[t,n]=rn(t,n),Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(v9e,a)}var Vm=ue({lessEqual_:iZe});function oZe(r,e){let t=ee(r,"a","logicalAnd","bool"),n=ee(e,"b","logicalAnd","bool");Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(m9e,a)}var qh=ue({logicalAnd_:oZe});function sZe(r){let t={x:ee(r,"x","clone","string_or_numeric")};return ae.runKernel($k,t)}var v6=ue({clone_:sZe});function uZe(r,e){let t=ee(r,"broadcastTo","x"),n=t.shape;if(Hh(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=pe(t,c)}let a=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(a[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(i.map((c,l)=>c>1?l:-1).filter(c=>c>=0).length===0)return v6(t);let s={x:t},u={reps:i};return ae.runKernel(Wk,s,u)}var _m=ue({broadcastTo_:uZe});function cZe(r,e,t){let n=ee(e,"a","where"),a=ee(t,"b","where"),i=ee(r,"condition","where","bool"),o=Rr(Rr(i.shape,n.shape),a.shape),s=_m(i,o),u=_m(n,o),c=_m(a,o),l={condition:s,t:u,e:c};return ae.runKernel(FG,l)}var yo=ue({where_:cZe});var lZe={kernelName:FV,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{clipValueMin:a,clipValueMax:i}=t;return{x:()=>yo(qh(Um(n,a),Vm(n,i)),r,kr(r))}}};var fZe={kernelName:RV,inputsToSave:["x"],gradFunc:p6.gradFunc};function hZe(r,e,t=0){let a={x:ee(r,"x","split")},i={numOrSizeSplits:e,axis:t};return ae.runKernel(UG,a,i)}var Bm=ue({split_:hZe});var pZe={kernelName:OV,saveAllInputs:!0,gradFunc:(r,e,t)=>{let n=e.map(u=>u.shape),{axis:a}=t,i=Ui(a,e[0].shape)[0],o=n.map(u=>u[i]);return Bm(r,o,i).map(u=>()=>u)}};function dZe(r,e,t,n,a,i="NHWC",o){let s=r;r.rank===3&&(s=pe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),ie(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),ie(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),ie(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];ie(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),ie(l===t[3],()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${t[3]}).`),Ei("conv2dDerFilter",a,o);let f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ae.runKernel(ZXe,f,h)}var m6=ue({conv2DBackpropFilter_:dZe});function vZe(r,e,t,n,a,i="NHWC",o){ie(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let s=r,u=e,c=!1;e.rank===3&&(c=!0,u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),ie(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),ie(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),ie(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];ie(l===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[2]}.`),ie(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Ei("conv2dDerInput",a,o);let h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ae.runKernel(MV,h,p);return c?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var g6=ue({conv2DBackpropInput_:vZe});var mZe={kernelName:PV,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{dilations:i,strides:o,pad:s,dataFormat:u}=t;return ie(Wh(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>g6(n.shape,r,a,o,s,u),filter:()=>m6(n,r,a.shape,o,s,u)}}};function gZe(r,e,t,n,a="NHWC",i=[1,1],o){let s=ee(r,"x","conv2d","float32"),u=ee(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Ei("conv2d",n,o);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),ie(cl(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ie(Mm(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),ie(Mm(t),()=>"Error in conv2D: Strides should be larger than 0.");let h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel(PV,h,p);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Gm=ue({conv2d_:gZe});var yZe={kernelName:MV,inputsToSave:["dy","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{strides:i,pad:o,dataFormat:s,dimRoundingMode:u}=t;return{dy:()=>Gm(r,a,i,o,s,1,u),filter:()=>m6(r,n,a.shape,i,o,s,u)}}};function bZe(r,e,t,n,a){let i=r;r.rank===4&&(i=pe(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));let o=e;o.rank===4&&(o=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),ie(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),ie(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),ie(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),ie(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),ie(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);let s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ae.runKernel(QXe,s,u)}var wZe=ue({conv3DBackpropFilter_:bZe});function xZe(r,e,t,n,a){ie(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let i=r,o=e,s=!1;e.rank===4&&(s=!0,o=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);let u=i[4],c=o.shape[4];ie(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),ie(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),ie(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),ie(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),ie(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);let l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ae.runKernel(e9e,l,f);return s?pe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var kZe=ue({conv3DBackpropInput_:xZe});var SZe={kernelName:JXe,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i}=t;ie(Wh(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);let[o,s]=e;return{x:()=>kZe(o.shape,r,s,a,i),filter:()=>wZe(o,r,s.shape,a,i)}}};function NZe(r){let t={x:ee(r,"x","sin","float32")};return ae.runKernel(PG,t)}var y6=ue({sin_:NZe});var TZe={kernelName:BV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(In(y6(ot(t,"float32"))),r)}}};function EZe(r){let t={x:ee(r,"x","sinh")};return ae.runKernel(MG,t)}var b6=ue({sinh_:EZe});var IZe={kernelName:LV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(b6(ot(t,"float32")),r)}}};function CZe(r,e){for(let t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function AZe(r,e,t){let n=r.length+e.length,a=[],i=0,o=0;for(let s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function DZe(r,e){let t=[],n=r.length;for(let i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);let a=e.map(i=>r[i]);return[t,a]}function Lm(r,e){let t=e.map(n=>1);return AZe(r,t,e)}function w6(r,e){if(CZe(r,e))return null;let t=[];for(let n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(n=>t.push(n)),t}function Xk(r){return r.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function _Ze(r,e=0,t=!1,n=!1){let i={x:ee(r,"x","cumsum")},o={axis:e,exclusive:t,reverse:n};return ae.runKernel(zV,i,o)}var x6=ue({cumsum_:_Ze});function FZe(r){ar().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}oYe(FZe);function RZe(r,e){return ae.tidy(r,e)}function rV(r){c6(r).forEach(t=>t.dispose())}function OZe(r,e){let t=ee(r,"real","complex"),n=ee(e,"imag","complex");P9e(t.shape,n.shape,`real and imag shapes, ${t.shape} and ${n.shape}, must match in call to tf.complex().`);let a={real:t,imag:n};return ae.runKernel(YXe,a)}var ol=ue({complex_:OZe});function PZe(r){let t={input:ee(r,"input","imag")};return ae.runKernel(p9e,t)}var Yk=ue({imag_:PZe});function MZe(r){let t={input:ee(r,"input","real")};return ae.runKernel(T9e,t)}var zm=ue({real_:MZe});function BZe(r,e,t){let n=ee(r,"x","transpose");if(e==null&&(e=n.shape.map((o,s)=>s).reverse()),ie(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(o=>{ie(o>=0&&o<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();let a={x:n},i={perm:e};return n.dtype==="complex64"?RZe(()=>{let o=zm(n),s=Yk(n);return o=ae.runKernel(Cm,{x:o},i),s=ae.runKernel(Cm,{x:s},i),t&&(s=In(s)),ol(o,s)}):ae.runKernel(Cm,a,i)}var Cu=ue({transpose_:BZe});var LZe={kernelName:zV,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a,exclusive:i,reverse:o}=t;return{x:()=>{let s=w6([a],n.rank),u=x6(r,a,i,!o);return s!=null&&(u=Cu(u,s)),u}}}};function zZe(r,e,t,n,a,i=[1,1],o){let s=r;r.rank===3&&(s=pe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ae.runKernel(n9e,c,l)}var $Ze=ue({depthwiseConv2dNativeBackpropFilter_:zZe});function WZe(r,e,t,n,a,i=[1,1],o){let s=e,u=!1;e.rank===3&&(u=!0,s=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ae.runKernel(a9e,c,l);return u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var qZe=ue({depthwiseConv2dNativeBackpropInput_:WZe});var UZe={kernelName:$V,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i,dimRoundingMode:o}=t,s=n??[1,1];ie(Wh(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[u,c]=e;return ie(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),ie(u.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),ie(cl(a,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${s}'.`),Ei("depthwiseConv2d",i,o),{x:()=>qZe(u.shape,r,c,a,i,s,o),filter:()=>$Ze(u,r,c.shape,a,i,s,o)}}};var VZe={kernelName:WV,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,i={x:n,filter:a,dy:r},o={x:n,filter:a,dy:r};return{x:()=>ae.runKernel(i9e,i,t),filter:()=>ae.runKernel(o9e,o,t)}}};var GZe={kernelName:UV,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e,n={dy:r,y:t};return{x:()=>ae.runKernel(s9e,n)}}};function HZe(r){let t={x:ee(r,"x","exp")};return ae.runKernel(GV,t)}var vs=ue({exp_:HZe});var KZe={kernelName:VV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=$e(vs(In(fn(t))),2/Math.sqrt(Math.PI));return{x:()=>$e(r,n)}}};var jZe={kernelName:GV,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,t)}}};var XZe={kernelName:HV,inputsToSave:["input"],gradFunc:(r,e)=>{let[t]=e;return{input:()=>pe(r,t.shape)}}};var YZe={kernelName:KV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,vs(t))}}};var ZZe={kernelName:jV,gradFunc:r=>({x:()=>kr(r)})};var JZe={kernelName:XV,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Rr(t.shape,n.shape);return{a:()=>{let s=Fr(r,ot(n,"float32")),u=hn(t.shape,a);return u.length>0?pe(At(s,u),t.shape):s},b:()=>{let s=$e(r,ot(t,"float32")),u=hn(n.shape,a);u.length>0&&(s=pe(At(s,u),n.shape));let c=fn(n);return In(Fr(s,ot(c,"float32")))}}}};function QZe(r){let t={x:ee(r,"x","rsqrt","float32")};return ae.runKernel(_G,t)}var k6=ue({rsqrt_:QZe});function eJe(r,e){let t=ee(r,"x","tile","string_or_numeric");ie(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let n={x:t},a={reps:e};return ae.runKernel(Wk,n,a)}var S6=ue({tile_:eJe});var tJe={kernelName:YV,inputsToSave:["x","mean","variance","scale"],gradFunc:(r,e,t)=>{let{varianceEpsilon:n}=t,[a,i,o,s]=e,u=s??tn(1),c=hn(i.shape,a.shape),l=[];if(i.rank===1){for(let b=0;b<a.shape.length-1;++b)l.push(a.shape[b]);l.push(1)}let f=mn(a,i),h=$e(r,u),p=k6(ri(o,tn(n))),d=$e($e($e(p,p),p),tn(-.5));return{x:()=>i.rank===1?pe($e($e(r,S6(pe(p,[1,1,1,i.shape[0]]),l)),u),a.shape):pe($e($e(r,p),u),a.shape),mean:()=>{let b=$e($e(p,tn(-1)),h);return i.rank===1&&(b=At(b,c)),pe(b,i.shape)},variance:()=>{let b=$e($e(d,f),h);return i.rank===1&&(b=At(b,c)),pe(b,i.shape)},scale:()=>{let b=$e(f,p),x=$e(r,b);return i.rank===1&&(x=At(x,c)),pe(x,i.shape)},offset:()=>{let b=r;return i.rank===1&&(b=At(b,c)),pe(b,i.shape)}}}};function rJe(r,e=0){let t=h6(r,"tensors","stack","string_or_numeric");ie(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&ie(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let n=t,a={axis:e};return ae.runKernel(yG,n,a)}var Zk=ue({stack_:rJe});function nJe(r,e,t){let n=ee(r,"x","unsortedSegmentSum"),a=ee(e,"segmentIds","unsortedSegmentSum","int32");ie(Lh(t),()=>"numSegments must be of dtype int");let i={x:n,segmentIds:a},o={numSegments:t};return ae.runKernel(YG,i,o)}var N6=ue({unsortedSegmentSum_:nJe});var aJe={kernelName:ZV,inputsToSave:["x","indices"],gradFunc:(r,e,t)=>{let[n,a]=e,{axis:i,batchDims:o}=t,s=Ui(i,n.shape)[0],u=(c,l,f)=>()=>{let h=c.shape,p=l.size,d=h.slice(0,s),m=d.length,v=h.slice(i,h.length).slice(1),g=v.length,y=nV(0,m),w=nV(m+1,m+1+g),b=aV([d,[p],v]),x=pe(f,b),S=pe(l,[p]),T=aV([[m],y,w]),E=Cu(x,T),C=N6(E,S,c.shape[s]),R=Xk(T);return C=Cu(C,R),C};if(o===1){let c=n.shape[0],l=n.split(c,0);return{x:()=>Zk(l.map((p,d)=>u(p,a.slice(d,1),r.slice(d,1))())).reshape(n.shape),indices:()=>a}}else return{x:u(n,a,r),indices:()=>a}}};function nV(r,e){let t=[];for(let n=r;n<e;++n)t.push(n);return t}function aV(r){let e=[];for(let t=0;t<r.length;++t)for(let n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var iJe={kernelName:JV,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>kr(t),b:()=>kr(n)}}};var oJe={kernelName:$k,gradFunc:r=>({x:()=>ot(r,"float32")})};var sJe={kernelName:QV,gradFunc:r=>({x:()=>kr(r)})};var uJe={kernelName:eG,gradFunc:r=>({x:()=>kr(r)})};var cJe={kernelName:tG,gradFunc:r=>({x:()=>kr(r)})};function lJe(r,e){let t=ee(r,"a","greater","string_or_numeric"),n=ee(e,"b","greater","string_or_numeric");[t,n]=rn(t,n),Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(f9e,a)}var ll=ue({greater_:lJe});var fJe={kernelName:rG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{alpha:a}=t,i=ll(n,0);return{x:()=>yo(i,r,$e(r,a))}}};var hJe={kernelName:aG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Fr(r,ri(t,1))}}};var pJe={kernelName:nG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Fr(r,ot(t,"float32"))}}};var dJe={kernelName:b9e,inputsToSave:[],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t;return{logits:()=>{let o=vs(n);return mn(r,$e(At(r,a,!0),o))}}}};function vJe(r,e,t,n=5,a=1,i=1,o=.5){let s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ae.runKernel(w9e,s,u)}var mJe=ue({localResponseNormalizationBackprop_:vJe});var gJe={kernelName:iG,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{depthRadius:i,bias:o,alpha:s,beta:u}=t;return{x:()=>mJe(n,a,r,i,o,s,u)}}};function yJe(r,e){let t=ee(r,"a","equal","string_or_numeric"),n=ee(e,"b","equal","string_or_numeric");[t,n]=rn(t,n),Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(u9e,a)}var Jk=ue({equal_:yJe});function T6(r,e,t,n){return e.rank<t.rank&&(e=pe(e,Lm(e.shape,n))),r.rank<t.rank&&(r=pe(r,Lm(r.shape,n))),{x:()=>$e(r,ot(Jk(t,e),r.dtype))}}var iV={kernelName:oG,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{reductionIndices:a}=n,i=e[0],o=e[1],s=Ui(a,i.shape),u=T6(r,o,i,s);return{x:()=>u.x()}}};function bJe(r,e){let t=ee(r,"a","less","string_or_numeric"),n=ee(e,"b","less","string_or_numeric");[t,n]=rn(t,n),Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(d9e,a)}var E6=ue({less_:bJe});var wJe={kernelName:sG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>$e(r,ot(Um(t,n),"float32")),b:()=>$e(r,ot(E6(t,n),"float32"))}}};function xJe(r,e,t,n,a,i,o){let s=ee(r,"dy","maxPool3dGrad"),u=ee(e,"input","maxPool3dGrad"),c=ee(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=pe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=pe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=pe(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),ie(l.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),ie(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),ie(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Ei("maxPool3dGrad",i,o);let d={dy:l,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=ae.runKernel(S9e,d,m);return p?pe(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var kJe=ue({maxPool3dGrad_:xJe});var SJe={kernelName:k9e,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s,dimRoundingMode:u}=t;return{x:()=>kJe(r,n,a,i,o,s,u)}}};function NJe(r,e,t,n,a,i,o){let s=ee(r,"dy","maxPoolGrad"),u=ee(e,"input","maxPoolGrad"),c=ee(t,"output","maxPoolGrad");ie(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),ie(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),ie(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Ei("maxPoolGrad",i,o);let l={dy:s,input:u,output:c},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ae.runKernel(x9e,l,f)}var TJe=ue({maxPoolGrad_:NJe});var EJe={kernelName:uG,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s}=t;return{x:()=>TJe(r,n,a,i,o,s)}}};function Uh(r,e="float32"){if(Hh(r),e==="complex64"){let n=Uh(r,"float32"),a=Uh(r,"float32");return ol(n,a)}let t=Vk(go(r),e);return ae.makeTensor(t,r,e)}function Hm(r,e="float32"){if(Hh(r),e==="complex64"){let n=Hm(r,"float32"),a=Uh(r,"float32");return ol(n,a)}let t=t6(go(r),e);return ae.makeTensor(t,r,e)}var IJe={kernelName:cG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=Ui(a,n.shape),s=DZe(n.shape,i)[1],u=go(s);return{x:()=>{let l=n.shape.slice();i.forEach(p=>{l[p]=1});let f=pe(r,l);return Fr($e(f,Hm(n.shape,"float32")),u)}}}};var CJe={kernelName:lG,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{axis:a}=n,[i,o]=e,s=Ui(a,i.shape),u=T6(r,o,i,s);return{x:()=>u.x()}}};var AJe={kernelName:fG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>$e(r,ot(Vm(t,n),"float32")),b:()=>$e(r,ot(ll(t,n),"float32"))}}};function DJe(r,e,t){let n=ee(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let a={x:n},i={begin:e,size:t};return ae.runKernel(OG,a,i)}var qi=ue({slice_:DJe});var _Je={kernelName:hG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>qi(r,i,n.shape)}}};function FJe(r){let t={x:ee(r,"x","floor","float32")};return ae.runKernel(jV,t)}var I6=ue({floor_:FJe});var RJe={kernelName:pG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Rr(t.shape,n.shape);return{a:()=>{let s=hn(t.shape,a);return s.length>0?pe(At(r,s),t.shape):r},b:()=>{let s=$e(r,In(I6(Fr(t,n)))),u=hn(n.shape,a);return u.length>0?pe(At(s,u),n.shape):s}}}};var OJe={kernelName:dG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Rr(t.shape,n.shape);return{a:()=>{let s=$e(r,ot(n,"float32")),u=hn(t.shape,a);return u.length>0?pe(At(s,u),t.shape):s},b:()=>{let s=$e(r,ot(t,"float32")),u=hn(n.shape,a);return u.length>0?pe(At(s,u),n.shape):s}}}};var PJe={kernelName:vG,gradFunc:r=>({x:()=>In(r)})};var MJe={kernelName:gG,inputsToSave:["indices"],gradFunc:(r,e)=>{let t=e[0];return{indices:()=>Uh(t.shape,"float32")}}};var BJe={kernelName:mG,gradFunc:r=>({x:()=>kr(r)})};function LJe(r,e=0){let t=ee(r,"x","unstack","string_or_numeric");ie(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let n={value:t},a={axis:e};return ae.runKernel(XG,n,a)}var C6=ue({unstack_:LJe});var zJe={kernelName:yG,saveAllInputs:!0,gradFunc:(r,e,t)=>{let{axis:n}=t;return C6(r,n).map(i=>()=>i)}};var oV={kernelName:bG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>qi(r,i,n.shape)}}};function $Je(r){let t={x:ee(r,"x","log","float32")};return ae.runKernel(nG,t)}var Km=ue({log_:$Je});function WJe(r,e){let t=ee(r,"base","pow"),n=ee(e,"exp","pow");[t,n]=rn(t,n);let a={a:t,b:n};return ae.runKernel(wG,a)}var jm=ue({pow_:WJe});var qJe={kernelName:wG,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(r,e)=>{let[t,n,a]=e,i=t,o=n,s=Rr(i.shape,o.shape);return{a:()=>{let l=ot(o,"float32"),f=$e(r,$e(l,jm(i,mn(l,tn(1))))),h=hn(i.shape,s);return h.length>0&&(f=At(f,h)),pe(f,i.shape)},b:()=>{let l=ll(i,0),f=yo(l,Km(i),kr(i)),h=$e(r,$e(a,f)),p=hn(o.shape,s);return p.length>0&&(h=At(h,p)),pe(h,o.shape)}}}};var UJe={kernelName:xG,inputsToSave:["x","alpha"],gradFunc:(r,e)=>{let[t,n]=e,a=ll(t,0);return{x:()=>yo(a,r,$e(r,n)),alpha:()=>{let i=yo(a,kr(r),$e(r,t)),o=hn(n.shape,r.shape);return o.length>0&&(i=At(i,o)),pe(i,n.shape)}}}};function VJe(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ln=ar();Ln.registerFlag("DEBUG",()=>!1,r=>{r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ln.registerFlag("IS_BROWSER",()=>VJe());Ln.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ln.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ln.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ln.registerFlag("PROD",()=>!1);Ln.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ln.getBool("DEBUG"));Ln.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ln.registerFlag("IS_TEST",()=>!1);Ln.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ln.getBool("DEBUG"));Ln.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ln.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ln.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);var bo=class{static join(e){return new bo(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(n=>ni(n)?n.buffer:n),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){let a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);let n=this.findShardForByte(e);if(n===-1)throw new Error(`Could not find start shard for byte ${e}`);let a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0;for(let u=n;u<this.shards.length;u++){let c=this.shards[u],f=e+s-c.start,h=s,d=Math.min(t,c.end)-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let n=GJe(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)}};function GJe(r,e){let t=0,n=r.length;for(;t<=n;){let a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}var Qk=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function sV(r){return Qk?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function HJe(r){if(Qk)return Buffer.from(r).toString("base64");let e=new Uint8Array(r),t="";for(let n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function KJe(r){if(Qk){let n=Buffer.from(r,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t.set([e.charCodeAt(n)],n);return t.buffer}function A6(r,e){let t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function jJe(r,e,t){let n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}async function XJe(r,e){let t,n;return r.weightsManifest!=null&&([t,n]=await e(r.weightsManifest)),jJe(r,t,n)}function Xm(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:sV(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:sV(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new bo(r.weightData).byteLength}}function uV(r){let e=[];for(let t of r)e.push(...t.weights);return e}var Hr=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Hr.instance==null&&(Hr.instance=new Hr),Hr.instance}static registerSaveRouter(e){Hr.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Hr.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Hr.getHandlers(e,"save")}static getLoadHandlers(e,t){return Hr.getHandlers(e,"load",t)}static getHandlers(e,t,n){let a=[];return(t==="load"?Hr.getInstance().loadRouters:Hr.getInstance().saveRouters).forEach(o=>{let s=o(e,n);s!==null&&a.push(s)}),a}};var YJe="tensorflowjs",ZJe=1,Bh="models_store",Fm="model_info_store";function JJe(){if(!ar().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function QJe(r){let e=r.result;e.createObjectStore(Bh,{keyPath:"modelPath"}),e.createObjectStore(Fm,{keyPath:"modelPath"})}var sl=class{constructor(e){if(this.indexedDB=JJe(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((n,a)=>{let i=this.indexedDB.open(YJe,ZJe);i.onupgradeneeded=()=>QJe(i),i.onsuccess=()=>{let o=i.result;if(t==null){let s=o.transaction(Bh,"readonly"),c=s.objectStore(Bh).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(c.result.modelArtifacts)},c.onerror=l=>(o.close(),a(c.error)),s.oncomplete=()=>o.close()}else{t.weightData=bo.join(t.weightData);let s=Xm(t),u=o.transaction(Fm,"readwrite"),c=u.objectStore(Fm),l;try{l=c.put({modelPath:this.modelPath,modelArtifactsInfo:s})}catch(h){return a(h)}let f;l.onsuccess=()=>{f=o.transaction(Bh,"readwrite");let h=f.objectStore(Bh),p;try{p=h.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s})}catch(d){return a(d)}p.onsuccess=()=>n({modelArtifactsInfo:s}),p.onerror=d=>{c=u.objectStore(Fm);let m=c.delete(this.modelPath);m.onsuccess=()=>(o.close(),a(p.error)),m.onerror=v=>(o.close(),a(p.error))}},l.onerror=h=>(o.close(),a(l.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>a(i.error)})}};sl.URL_SCHEME="indexeddb://";var D6=r=>ar().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(sl.URL_SCHEME)?eQe(r.slice(sl.URL_SCHEME.length)):null;Hr.registerSaveRouter(D6);Hr.registerLoadRouter(D6);function eQe(r){return new sl(r)}var Rh="/",Oh="tensorflowjs_models",tQe="info",rQe="model_topology",nQe="weight_specs",aQe="weight_data",iQe="model_metadata";function oQe(r){return{info:[Oh,r,tQe].join(Rh),topology:[Oh,r,rQe].join(Rh),weightSpecs:[Oh,r,nQe].join(Rh),weightData:[Oh,r,aQe].join(Rh),modelMetadata:[Oh,r,iQe].join(Rh)}}function sQe(r){for(let e of Object.values(r))window.localStorage.removeItem(e)}var ul=class{constructor(e){if(!ar().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=oQe(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=Xm(e),i=bo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,HJe(i));let o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:a}}catch{throw sQe(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=a;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let s=JSON.parse(i);t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,s.signature!=null&&(t.signature=s.signature),s.userDefinedMetadata!=null&&(t.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(t.modelInitializer=s.modelInitializer),s.initializerSignature!=null&&(t.initializerSignature=s.initializerSignature),s.trainingConfig!=null&&(t.trainingConfig=s.trainingConfig)}let o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=KJe(o),t}};ul.URL_SCHEME="localstorage://";var _6=r=>ar().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ul.URL_SCHEME)?uQe(r.slice(ul.URL_SCHEME.length)):null;Hr.registerSaveRouter(_6);Hr.registerLoadRouter(_6);function uQe(r){return new ul(r)}var cQe="model",lQe=".json",fQe=".weights.bin";function cV(r){return new Promise(e=>setTimeout(e)).then(r)}var wo=class{constructor(e){if(!ar().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(wo.URL_SCHEME)&&(e=e.slice(wo.URL_SCHEME.length)),(e==null||e.length===0)&&(e=cQe),this.modelJsonFileName=e+lQe,this.weightDataFileName=e+fQe}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=bo.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=A6(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=o,await cV(()=>s.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=n,await cV(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Xm(e)}}}};wo.URL_SCHEME="downloads://";var hQe=r=>ar().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(wo.URL_SCHEME)?pQe(r.slice(wo.URL_SCHEME.length)):null;Hr.registerSaveRouter(hQe);function pQe(r="model"){return new wo(r)}function lV(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);let a=0,i=u=>(u.then(c=>{let l=t+ ++a/r.length*(n-t);return e(l),c}),u);function o(u){ie(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function s(u,c){ie(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),ie(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),ie(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(r.map(i))}async function dQe(r,e){e==null&&(e={});let t=e.fetchFunc==null?ar().platform.fetch:e.fetchFunc,n=r.map(f=>t(f,e.requestInit,{isBinary:!0})),a=0,i=.5,s=(e.onProgress==null?await Promise.all(n):await lV(n,e.onProgress,a,i)).map(f=>f.arrayBuffer()),u=.5,c=1;return e.onProgress==null?await Promise.all(s):await lV(s,e.onProgress,u,c)}function vQe(r,e){var t;let n=e.fetchFunc==null?ar().platform.fetch:e.fetchFunc,a=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var s;a<r.length;){i||(i=(await n(r[a],e.requestInit,{isBinary:!0})).body.getReader());let{done:u,value:c}=await i.read();if(u){a++,i=void 0,(s=e.onProgress)===null||s===void 0||s.call(e,a/r.length);continue}o.enqueue(c);return}o.close()}})}var mQe="application/octet-stream",gQe="application/json",Vh=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(ie(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=ar().platform.fetch,ie(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&ie(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=A6(e,n);if(t.body.append("model.json",new Blob([JSON.stringify(a)],{type:gQe}),"model.json"),e.weightData!=null){let o=bo.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:mQe}),"model.weights.bin")}let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:Xm(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}let n=t.modelTopology,a=t.weightsManifest;if(n==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();let e=await this.loadModelJSON();return XJe(e,t=>this.loadWeights(t))}async loadStream(){let e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=uV(e.weightsManifest),a=()=>vQe(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:a})}async getWeightUrls(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,a]=yQe(t),i=this.weightPathPrefix||n,o=[],s=[];for(let u of e)for(let c of u.paths)this.weightUrlConverter!=null?s.push(this.weightUrlConverter(c)):o.push(i+c+a);return this.weightUrlConverter&&o.push(...await Promise.all(s)),o}async loadWeights(e){let t=await this.getWeightUrls(e),n=uV(e),a=await dQe(t,this.loadOptions);return[n,a]}};Vh.URL_SCHEME_REGEX=/^https?:\/\//;function yQe(r){let e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function fV(r){return r.match(Vh.URL_SCHEME_REGEX)!=null}var F6=(r,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(r)?t=r.every(n=>fV(n)):t=fV(r),t)return bQe(r,e)}return null};Hr.registerSaveRouter(F6);Hr.registerLoadRouter(F6);function bQe(r,e){return new Vh(r,e)}function wQe(r,e,t=1,n=0,a="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let o={indices:ee(r,"indices","oneHot","int32")},s={dtype:a,depth:e,onValue:t,offValue:n};return ae.runKernel(gG,o,s)}var xQe=ue({oneHot_:wQe});function kQe(r,e,t){let n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${r}, sliceDim: ${n}, and batchDim: ${a}.`;if(t.rank<a)throw new Error(i+` update.rank < ${a}. `);if(r.length<n+(t.rank-a))throw new Error(i+` Output shape length < ${n+(t.rank-a)}`);if(t.rank!==a+r.length-n)throw new Error(i+` update.rank != ${a+r.length-n}`);for(let o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+` updates.shape[${o+a}] (${t.shape[o+a]}) != shape[${o+a}] (${r[o+a]})`)}function SQe(r,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(r.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${r.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(r.size===0)throw new Error(`Updates specified for empty output. updates shape: ${r.shape}`)}kQe(t,e,r)}function NQe(r,e,t){let n,a=r.shape.length;typeof e=="number"?n=[e,...new Array(a-1).fill(0)]:e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(o=>{ie(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=[t,...new Array(a-1).fill(-1)]:t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map((o,s)=>o>=0?o:(ie(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${s}.`),r.shape[s]-n[s])),[n,i]}var Rk=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}};function TQe(r){let e=ee(r,"x","abs");if(e.dtype==="complex64"){let t={x:e};return ae.runKernel(RV,t)}else{let t={x:e};return ae.runKernel(yV,t)}}var mo=ue({abs_:TQe});function EQe(r){let t={x:ee(r,"x","acos")};return ae.runKernel(bV,t)}var IQe=ue({acos_:EQe});function CQe(r){let t={x:ee(r,"x","acosh")};return ae.runKernel(wV,t)}var AQe=ue({acosh_:CQe});function DQe(r,e=null,t=!1){let a={x:ee(r,"x","all","bool")},i={axis:e,keepDims:t};return ae.runKernel(VXe,a,i)}var _Qe=ue({all_:DQe});function FQe(r,e=null,t=!1){let a={x:ee(r,"x","any","bool")},i={axis:e,keepDims:t};return ae.runKernel(GXe,a,i)}var RQe=ue({any_:FQe});function OQe(r,e=0){let n={x:ee(r,"x","argMax")},a={axis:e};return ae.runKernel(xV,n,a)}var PQe=ue({argMax_:OQe});function MQe(r,e=0){let n={x:ee(r,"x","argMin")},a={axis:e};return ae.runKernel(kV,n,a)}var BQe=ue({argMin_:MQe});function LQe(r){let t={x:ee(r,"x","asin")};return ae.runKernel(SV,t)}var zQe=ue({asin_:LQe});function $Qe(r){let t={x:ee(r,"x","asinh")};return ae.runKernel(NV,t)}var WQe=ue({asinh_:$Qe});function qQe(r){let t={x:ee(r,"x","atan")};return ae.runKernel(TV,t)}var UQe=ue({atan_:qQe});function VQe(r,e){let t=ee(r,"a","atan2"),n=ee(e,"b","atan2");[t,n]=rn(t,n);let a={a:t,b:n};return ae.runKernel(IV,a)}var GQe=ue({atan2_:VQe});function HQe(r){let t={x:ee(r,"x","atanh")};return ae.runKernel(EV,t)}var KQe=ue({atanh_:HQe});function jQe(r,e,t,n,a){let i=ee(r,"x","avgPool","float32"),o=1;ie(cl(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let s=i,u=!1;i.rank===3&&(u=!0,s=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),Ei("avgPool",n,a);let c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ae.runKernel(CV,c,l);return f=ot(f,i.dtype),u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var R6=ue({avgPool_:jQe});function XQe(r,e=0){ie(r.length>=1,()=>"Pass at least one tensor to concat");let t=h6(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return v6(t[0]);let n=t,a={axis:e};return ae.runKernel(OV,n,a)}var Gh=ue({concat_:XQe});function YQe(r){let t={x:ee(r,"x","sigmoid","float32")};return ae.runKernel(LG,t)}var e2=ue({sigmoid_:YQe});function ZQe(r){let t={x:ee(r,"x","tanh","float32")};return ae.runKernel(jG,t)}var JQe=ue({tanh_:ZQe});function QQe(r,e,t){let n=ee(r,"x","batchToSpaceND"),a=e.reduce((s,u)=>s*u);ie(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),ie(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),ie(n.shape[0]%a===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${a}`);let i={x:n},o={blockShape:e,crops:t};return ae.runKernel(DV,i,o)}var t2=ue({batchToSpaceND_:QQe});function eet(r){let e;return r.rank===0||r.rank===1?e=pe(r,[1,1,1,r.size]):r.rank===2?e=pe(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=pe(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function tet(r,e,t,n,a,i){i==null&&(i=.001);let o=ee(r,"x","batchNorm"),s=ee(e,"mean","batchNorm"),u=ee(t,"variance","batchNorm"),c;a!=null&&(c=ee(a,"scale","batchNorm"));let l;n!=null&&(l=ee(n,"offset","batchNorm")),ie(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ie(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ie(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:eet(o),scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=ae.runKernel(YV,h,p);return pe(d,o.shape)}var ret=ue({batchNorm_:tet});function net(r){let t={x:ee(r,"x","ceil","float32")};return ae.runKernel(_V,t)}var aet=ue({ceil_:net});function iet(r,e,t){Hh(r),t=t||Wm(e);let n={shape:r,value:e,dtype:t};return ae.runKernel(l9e,{},n)}function oet(r,e,t){let n=ee(r,"x","clipByValue");if(ie(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return iet(n.shape,e,n.dtype);let a={x:n},i={clipValueMin:e,clipValueMax:t};return ae.runKernel(FV,a,i)}var set=ue({clipByValue_:oet});function uet(r,e,t,n,a="NWC",i=1,o){let s=ee(r,"x","conv1d"),u=ee(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1]])),ie(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),ie(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Ei("conv1d",n,o),ie(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),ie(cl(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),ie(Mm(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),ie(Mm(t),()=>"Error in conv1D: Stride should be larger than 0."),ie(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let f=pe(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=pe(c,[c.shape[0],1,c.shape[1],c.shape[2]]),v=Gm(h,f,[1,t],n,"NHWC",[1,i],o);return l?pe(v,[v.shape[2],v.shape[3]]):pe(v,[v.shape[0],v.shape[2],v.shape[3]])}var cet=ue({conv1d_:uet});function fet(r,e,t,n,a,i){let o=ee(r,"x","conv2dTranspose"),s=ee(e,"filter","conv2dTranspose");return g6(t,o,s,n,a,"NHWC",i)}var het=ue({conv2dTranspose_:fet});function pet(r){let t={x:ee(r,"x","cos","float32")};return ae.runKernel(BV,t)}var r2=ue({cos_:pet});function det(r){let t={x:ee(r,"x","cosh","float32")};return ae.runKernel(LV,t)}var O6=ue({cosh_:det});function vet(r,e=0,t=!1,n=!1){let i={x:ee(r,"x","cumprod")},o={axis:e,exclusive:t,reverse:n};return ae.runKernel(t9e,i,o)}var Ok=ue({cumprod_:vet});function met(r,e,t="NHWC"){let n=ee(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];ie(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),ie(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e}  for depthToSpace with input shape
    ${n.shape}`),ie(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${n.shape}`),ie(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${n.shape}`);let s={x:n},u={blockSize:e,dataFormat:t};return ae.runKernel(r9e,s,u)}var get=ue({depthToSpace_:met});function yet(r,e,t,n,a="NHWC",i=[1,1],o){let s=ee(r,"x","depthwiseConv2d","float32"),u=ee(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Ei("depthwiseConv2d",n,o);let h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel($V,h,p);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var P6=ue({depthwiseConv2d_:yet});function bet(r,e,t,n,a=[1,1],i="NHWC"){let o=ee(r,"x","dilation2d"),s=ee(e,"filter","dilation2d");ie(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),ie(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),ie(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,c=!1;o.rank===3&&(u=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),ie(u.shape[3]===s.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${s.shape[2]}`);let l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=ae.runKernel(WV,l,f);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var wet=ue({dilation2d_:bet});function xet(r,e){let t=ee(r,"a","div"),n=ee(e,"b","div");[t,n]=rn(t,n);let a=Fr(t,n),i=kr(a),o=Jk(n,i);return yo(o,i,a)}var ket=ue({divNoNan_:xet});function Net(r,e){let t=ee(r,"t1","dot"),n=ee(e,"t2","dot");ie((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${n.rank}.`);let a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(ie(a===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`),t.rank===1&&n.rank===1){let o=pe(t,[1,-1]),s=pe(n,[-1,1]),u=Ta(o,s);return pe(u,[])}else if(t.rank===1&&n.rank===2){let o=pe(t,[1,-1]),s=pe(n,[n.shape[0],n.shape[1]]),u=Ta(o,s);return pe(u,[u.size])}else if(t.rank===2&&n.rank===1){let o=pe(n,[-1,1]),s=Ta(t,o);return pe(s,[s.size])}else{let o=pe(n,[n.shape[0],n.shape[1]]);return Ta(t,o)}}var Tet=ue({dot_:Net});function Eet(r){let t={x:ee(r,"x","elu","float32")};return ae.runKernel(UV,t)}var Iet=ue({elu_:Eet});function Cet(r){let e=ee(r,"x","erf");ie(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ot(e,"float32"));let t={x:e};return ae.runKernel(VV,t)}var Aet=ue({erf_:Cet});function Det(r,e=null,t=!1){let a={x:ee(r,"x","max")},i={reductionIndices:e,keepDims:t};return ae.runKernel(oG,a,i)}var al=ue({max_:Det});function _et(r,e=null,t=!1){let a={x:ee(r,"x","min")},i={axis:e,keepDims:t};return ae.runKernel(lG,a,i)}var Pk=ue({min_:_et});function Fet(r,e="euclidean",t=null,n=!1){r=ee(r,"x","norm");let a=M6(r,e,t),i=a.shape;if(n){let o=Ui(t,r.shape);i=Lm(a.shape,o)}return pe(a,i)}function M6(r,e,t=null){if(r.rank===0)return mo(r);if(r.rank!==1&&t===null)return M6(pe(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return At(mo(r),t);if(e===1/0)return al(mo(r),t);if(e===-1/0)return Pk(mo(r),t);if(e==="euclidean"||e===2)return ds(At(jm(mo(r),tn(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return al(At(mo(r),t[0]),t[1]-1);if(e===1/0)return al(At(mo(r),t[1]),t[0]);if(e===-1/0)return Pk(At(mo(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return ds(At(fn(r),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var B6=ue({norm_:Fet});function Ret(r,e=null,t=!1){return B6(r,"euclidean",e,t)}var Oet=ue({euclideanNorm_:Ret});function Pet(r,e=0){let t=ee(r,"x","expandDims","string_or_numeric");ie(e<=t.rank,()=>"Axis must be <= rank of the tensor");let n={input:t},a={dim:e};return ae.runKernel(HV,n,a)}var L6=ue({expandDims_:Pet});function Met(r){let t={x:ee(r,"x","expm1")};return ae.runKernel(KV,t)}var Bet=ue({expm1_:Met});function Let(r,e,t=0,n=0){let a=ee(r,"x","gather"),i=ee(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ae.runKernel(ZV,o,s)}var z6=ue({gather_:Let});function zet(r){let t={x:ee(r,"x","isFinite")};return ae.runKernel(QV,t)}var $et=ue({isFinite_:zet});function Wet(r){let t={x:ee(r,"x","isInf")};return ae.runKernel(eG,t)}var qet=ue({isInf_:Wet});function Uet(r){let t={x:ee(r,"x","isNaN")};return ae.runKernel(tG,t)}var Vet=ue({isNaN_:Uet});function Get(r,e=.2){let n={x:ee(r,"x","leakyRelu")},a={alpha:e};return ae.runKernel(rG,n,a)}var Het=ue({leakyRelu_:Get});function Ket(r,e=5,t=1,n=1,a=.5){let i=ee(r,"x","localResponseNormalization");ie(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),ie(Lh(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,s=!1;i.rank===3&&(s=!0,o=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=ae.runKernel(iG,u,c);return s?pe(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var jet=ue({localResponseNormalization_:Ket});function Xet(r){let t={x:ee(r,"x","log1p")};return ae.runKernel(aG,t)}var Yet=ue({log1p_:Xet});function Zet(r,e){ie(Sk(r),()=>"The f passed in variableGrads(f) must be a function"),ie(e==null||Array.isArray(e)&&e.every(c=>c instanceof il),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let c in ae.registeredVariables)e.push(ae.registeredVariables[c])}let n=t?e.filter(c=>!c.trainable):null,a=e.length;e=e.filter(c=>c.trainable),ie(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let i=!0,{value:o,grads:s}=ae.gradients(r,e,null,i);ie(s.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ie(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let u={};return e.forEach((c,l)=>{s[l]!=null&&(u[c.name]=s[l])}),n?.forEach(c=>u[c.name]=null),{value:o,grads:u}}function $6(r){return ae.customGrad(r)}function Jet(r){let t={x:ee(r,"x","softplus")};return ae.runKernel(zG,t)}var W6=ue({softplus_:Jet});function Qet(r){let e=ee(r,"x","logSigmoid");return $6(n=>({value:In(W6(In(n))),gradFunc:o=>$e(o,e2(In(n)))}))(e)}var ett=ue({logSigmoid_:Qet});function ttt(r,e=-1){let t=ee(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return $6((a,i)=>{let s=al(a,e,!0),u=mn(a,s),c=mn(ot(u,"float32"),Km(At(vs(u),e,!0)));return i([c]),{value:c,gradFunc:(f,h)=>{let[p]=h,d=!0,m=vs(p);return mn(f,$e(At(f,e,d),m))}}})(t)}var rtt=ue({logSoftmax_:ttt});function ntt(r,e=null,t=!1){let n=ee(r,"x","logSumExp"),a=Ui(e,n.shape),i=al(n,a,!0),o=mn(n,i),s=vs(o),u=At(s,a),c=Km(u),l=ri(pe(i,c.shape),c);if(t){let f=Lm(l.shape,a);return pe(l,f)}return l}var att=ue({logSumExp_:ntt});function itt(r){let t={x:ee(r,"x","logicalNot","bool")};return ae.runKernel(g9e,t)}var n2=ue({logicalNot_:itt});function ott(r,e){let t=ee(r,"a","logicalOr","bool"),n=ee(e,"b","logicalOr","bool");Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(y9e,a)}var q6=ue({logicalOr_:ott});function stt(r,e){let t=ee(r,"a","logicalXor","bool"),n=ee(e,"b","logicalXor","bool");return Rr(t.shape,n.shape),qh(q6(r,e),n2(qh(r,e)))}var utt=ue({logicalXor_:stt});function ctt(r,e,t,n,a){let i=ee(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),ie(cl(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Ei("maxPool",n,a);let c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ae.runKernel(uG,c,l);return u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var U6=ue({maxPool_:ctt});function ltt(r,e){let t=ee(r,"a","maximum"),n=ee(e,"b","maximum");[t,n]=rn(t,n),t.dtype==="bool"&&(t=ot(t,"int32"),n=ot(n,"int32")),Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(sG,a)}var V6=ue({maximum_:ltt});function ftt(r,e=null,t=!1){let a={x:ee(r,"x","mean")},i={axis:e,keepDims:t};return ae.runKernel(cG,a,i)}var htt=ue({mean_:ftt});function ptt(r,e){let t=ee(r,"a","minimum"),n=ee(e,"b","minimum");[t,n]=rn(t,n),t.dtype==="bool"&&(t=ot(t,"int32"),n=ot(n,"int32")),Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(fG,a)}var dtt=ue({minimum_:ptt});function vtt(r,e,t){ie(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let n=ee(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ie(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);let a=t==="reflect"?1:0;for(let s=0;s<n.rank;s++)ie(e[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ie(e[s][0]>=0&&e[s][0]<=n.shape[s]-a&&e[s][1]>=0&&e[s][1]<=n.shape[s]-a,()=>`Padding in dimension ${s} cannot be greater than or equal to ${n.shape[s]-a} or less than 0 for input of shape ${n.shape}`);let i={paddings:e,mode:t},o={x:n};return ae.runKernel(hG,o,i)}var mtt=ue({mirrorPad_:vtt});function gtt(r,e){let t=ee(r,"a","mod"),n=ee(e,"b","mod");[t,n]=rn(t,n);let a={a:t,b:n};return ae.runKernel(pG,a)}var ytt=ue({mod_:gtt});function btt(r,e){let t=ee(r,"a","notEqual","string_or_numeric"),n=ee(e,"b","notEqual","string_or_numeric");[t,n]=rn(t,n),Rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(N9e,a)}var wtt=ue({notEqual_:btt});function xtt(r){let t={x:ee(r,"x","onesLike")};return ae.runKernel(mG,t)}var ktt=ue({onesLike_:xtt});function Stt(r,e,t=0){let n=ee(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:e,constantValue:t},i={x:n};return ae.runKernel(bG,i,a)}var G6=ue({pad_:Stt});function Ntt(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");let s=ee(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(cl(i,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`);let l=$Ye(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=Ett([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];let p=f[0]===1&&f[1]===1,[d,m]=Ttt([l.inHeight,l.inWidth],f,h),v=p?n:"valid",g=p?u:jk(u,f,d),w=(t==="avg"?()=>R6(g,e,i,v,o):()=>U6(g,e,i,v,o))(),b=p?w:t2(w,f,m);return c?pe(b,[b.shape[1],b.shape[2],b.shape[3]]):b}function Ttt(r,e,t){let n=t.map(l=>l[0]),a=t.map(l=>l[1]),i=r.concat(n,a),o=e.map((l,f)=>(l-i[f]%l)%l),s=a.map((l,f)=>l+o[f]),u=e.map((l,f)=>[n[f],s[f]]),c=e.map((l,f)=>[0,o[f]]);return[u,c]}function Ett(r,e){let n=r.map((o,s)=>o+(o-1)*(e[s]-1)).map(o=>o-1),a=n.map(o=>Math.floor(o/2)),i=n.map((o,s)=>o-a[s]);return n.map((o,s)=>[a[s],i[s]])}var Itt=ue({pool_:Ntt});function Ctt(r,e){let t=ee(r,"x","prelu"),n=ee(e,"alpha","prelu"),a={x:t,alpha:n};return ae.runKernel(xG,a)}var Att=ue({prelu_:Ctt});function Dtt(r,e=null,t=!1){let n=ee(r,"x","prod");n.dtype==="bool"&&(n=ot(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ae.runKernel(kG,a,i)}var _tt=ue({prod_:Dtt});var Au=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a2={exports:{}},Olt=a2.exports;(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Au,r,!1)})(a2);var Ftt=a2.exports,i2={exports:{}},Plt=i2.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Au,r,!1)})(i2);var Rtt=i2.exports,o2={exports:{}},Mlt=o2.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Au,r,!1)})(o2);var Ott=o2.exports,s2={exports:{}},Blt=s2.exports;(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p,d;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p,d=[];if(f===(f|0))p=d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?p=d[7]=-1:p=d[h],l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Au,r,!1)})(s2);var Ptt=s2.exports,u2={exports:{}},Llt=u2.exports;(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Au,r,!1)})(u2);var Mtt=u2.exports,c2={exports:{}},zlt=c2.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Au,r,!1)})(c2);var Btt=c2.exports,l2={exports:{}},$lt=l2.exports;(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=Wp()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Au,[],Math)})(l2);var Ltt=l2.exports,ztt=Ftt,$tt=Rtt,Wtt=Ott,qtt=Ptt,Utt=Mtt,Vtt=Btt,fl=Ltt;fl.alea=ztt;fl.xor128=$tt;fl.xorwow=Wtt;fl.xorshift7=qtt;fl.xor4096=Utt;fl.tychei=Vtt;function Gtt(r){let t={x:ee(r,"x","reciprocal")};return ae.runKernel(SG,t)}var Htt=ue({reciprocal_:Gtt});function Ktt(r){let t={x:ee(r,"x","relu")};return ae.runKernel(NG,t)}var jtt=ue({relu_:Ktt});function Xtt(r){let t={x:ee(r,"x","relu6")};return ae.runKernel(CG,t)}var Ytt=ue({relu6_:Xtt});function Ztt(r,e){let n={x:ee(r,"x","reverse")},a={dims:e};return ae.runKernel(AG,n,a)}var $m=ue({reverse_:Ztt});function Jtt(r){let t={x:ee(r,"x","round")};return ae.runKernel(DG,t)}var Qtt=ue({round_:Jtt});function ert(r){let t={x:ee(r,"x","selu")};return ae.runKernel(RG,t)}var trt=ue({selu_:ert});function rrt(r,e,t,n,a,i=[1,1],o="NHWC"){let s=ee(r,"x","separableConv2d"),u=ee(e,"depthwiseFilter","separableConv2d"),c=ee(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ie(l.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`),ie(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),ie(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let h=u.shape[2],p=u.shape[3];ie(c.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`);let d=P6(l,u,n,a,o,i),v=Gm(d,c,1,"valid",o);return f?pe(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var nrt=ue({separableConv2d_:rrt});function art(r){let t={x:ee(r,"x","sign")};return ae.runKernel(BG,t)}var irt=ue({sign_:art});function ort(r,e=-1){let t=ee(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let n={logits:t},a={dim:e};return ae.runKernel(VG,n,a)}var srt=ue({softmax_:ort});function urt(r){ie(r.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ae.runKernel(c9e,e)}var H6=ue({fft_:urt});function crt(r){ie(r.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ae.runKernel(h9e,e)}var Mk=ue({ifft_:crt});function lrt(r){let e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){let a=pe(r,[t,e]);n=Mk(a)}else{let a=[t,2*(e-1)],i=pe(zm(r),[t,e]),o=pe(Yk(r),[t,e]),s=$m(qi(i,[0,1],[t,e-2]),1),u=$e($m(qi(o,[0,1],[t,e-2]),1),tn(-1)),c=Gh([i,s],1),l=Gh([o,u],1),f=pe(ol(c,l),[a[0],a[1]]);n=Mk(f)}if(n=zm(n),r.rank===3&&r.shape[0]!==0){let a=n,i=r.shape[0];n=pe(n,[i,n.shape[0]/i,n.shape[1]]),a.dispose()}return n}var frt=ue({irfft_:lrt});function hrt(r,e){ie(r.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${r.dtype}`);let t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){let d=r.shape.map(v=>0),m=r.shape.map(v=>v);m[r.shape.length-1]=e,a=qi(r,d,m),t=e}else if(e!=null&&e>t){let d=r.shape.map(m=>m);d[r.shape.length-1]=e-t,a=Gh([r,Uh(d)],r.shape.length-1),t=e}else a=r;let i=kr(a),o=pe(ol(a,i),[n,t]),s=H6(o),u=Math.floor(t/2)+1,c=zm(s),l=Yk(s),f=Bm(c,[u,t-u],c.shape.length-1),h=Bm(l,[u,t-u],l.shape.length-1),p=a.shape.slice();return p[a.shape.length-1]=u,pe(ol(f[0],h[0]),p)}var prt=ue({rfft_:hrt});function drt(r,e){let t=ee(r,"a","squaredDifference"),n=ee(e,"b","squaredDifference");[t,n]=rn(t,n),Rr(t.shape,n.shape);let a={a:t,b:n},i={};return ae.runKernel(GG,a,i)}var vrt=ue({squaredDifference_:drt});function mrt(r,e){let t=ee(r,"x","squeeze","string_or_numeric");return pe(t,M9e(t.shape,e).newShape)}var grt=ue({squeeze_:mrt});function yrt(r,e,t,n,a=0,i=0,o=0,s=0,u=0){let l={x:ee(r,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ae.runKernel(D9e,l,f)}var brt=ue({stridedSlice_:yrt});function wrt(r){let t={x:ee(r,"x","tan","float32")};return ae.runKernel(KG,t)}var xrt=ue({tan_:wrt});function krt(r,e,t){let n=ee(r,"tensor","tensorScatterupdate"),a=ee(e,"indices","tensorScatterupdate","int32"),i=ee(t,"updates","tensorScatterupdate");if(SQe(i,a,n.shape),n.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${n.dtype} and ${i.dtype}.`);let o={tensor:n,indices:a,updates:i},s={};return ae.runKernel(C9e,o,s)}var Wlt=ue({tensorScatterUpdate_:krt});function Srt(r,e=1,t=!0){let n=ee(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${e}`);let i={x:n},o={k:e,sorted:t},[s,u]=ae.runKernel(_9e,i,o);return{values:s,indices:u}}var Nrt=ue({topk_:Srt});function Trt(r,e=0){let t=ee(r,"x","unique","string_or_numeric");ie(t.rank>0,()=>"The input tensor must be at least 1D");let n={x:t},a={axis:e},[i,o]=ae.runKernel(F9e,n,a);return{values:i,indices:o}}var Ert=ue({unique_:Trt});function Irt(r,e,t=!1,n=!1){let a=ee(r,"images","resizeBilinear");ie(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),ie(n===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=ae.runKernel(IG,s,u);return o?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var Crt=ue({resizeBilinear_:Irt});function Art(r,e,t=!1,n=!1){let a=ee(r,"images","resizeNearestNeighbor");ie(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),ie(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ie(n===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=ae.runKernel(EG,s,u);return o?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var Drt=ue({resizeNearestNeighbor_:Art});var hV;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(hV||(hV={}));var Bk=class extends Rk{minimize(e,t=!1,n){let{value:a,grads:i}=this.computeGradients(e,n);if(n!=null){let o=n.map(s=>({name:s.name,tensor:i[s.name]}));this.applyGradients(o)}else this.applyGradients(i);return rV(i),t?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return Zet(e,t)}dispose(){this.iterations_!=null&&rV(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:tn(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(Bk,Symbol.hasInstance,{value:r=>r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null});var qlt=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:r=>r())();var pV;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(pV||(pV={}));var _rt=1.7580993408473768,Frt=1.0507009873554805;function Rrt(r,e,t){let n=r.shape.slice();n[t]=1;let a=pe(e,n),i=Ok(r,t,!0,!1),o=Ok(r,t,!0,!0),s=$e(i,o);return $e(a,s)}function Ort(r,e,t){let n=r.shape.length,a=n-t.length,i=w6(t,n),o=r;i!=null&&(o=Cu(r,i));let s=o.shape.slice(),c=s.splice(n-t.length,t.length).reduce((h,p)=>h*p,1);s.push(c);let l=o.reshape(s),f=Rrt(l,e,a);if(f=f.reshape(o.shape),i!=null){let h=Xk(i);f=Cu(f,h)}return f}var Prt={kernelName:kG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=[];return a==null?i=n.shape.map((o,s)=>s):typeof a=="number"?i=[a]:i=a,{x:()=>Ort(n,r,i)}}};var Mrt={kernelName:qV,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Rr(t.shape,n.shape);return{a:()=>{let s=Fr(r,ot(n,"float32")),u=hn(t.shape,a);return u.length>0?pe(At(s,u),t.shape):s},b:()=>{let s=$e(r,ot(t,"float32")),u=hn(n.shape,a);u.length>0&&(s=pe(At(s,u),n.shape));let c=fn(n);return In(Fr(s,ot(c,"float32")))}}}};var Brt={kernelName:SG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Fr(r,In(fn(t)))}}};var Lrt={kernelName:CG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=$e(Vm(t,6),qm(t));return{x:()=>$e(r,ot(n,"float32"))}}};var zrt={kernelName:NG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,ot(qm(t),"float32"))}}};var $rt={kernelName:TG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,t.shape)}}};var Wrt={kernelName:IG,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ae.runKernel(I9e,a,t)}}};var qrt={kernelName:EG,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ae.runKernel(E9e,a,t)}}};var Urt={kernelName:AG,gradFunc:(r,e,t)=>{let{dims:n}=t,a=Ui(n,r.shape);return{x:()=>$m(r,a)}}};var Vrt={kernelName:DG,gradFunc:r=>({x:()=>kr(r)})};var Grt={kernelName:_G,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>In(Fr(r,$e(jm(t,1.5),2)))}}};var Hrt={kernelName:FG,inputsToSave:["condition"],gradFunc:(r,e)=>{let[t]=e;return{condition:()=>ot(kr(t),"float32"),t:()=>$e(r,ot(t,r.dtype)),e:()=>$e(r,ot(n2(t),r.dtype))}}};var Krt={kernelName:RG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=ll(t,tn(0)),a=tn(_rt),i=tn(Frt),o=$e(r,i),s=$e($e(r,a),vs(ot(t,"float32")));return yo(n,o,s)}}}};var jrt={kernelName:LG,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,$e(t,mn(tn(1),t)))}}};var Xrt={kernelName:BG,gradFunc:r=>({x:()=>kr(r)})};var Yrt={kernelName:PG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r2(ot(t,"float32")),r)}}};var Zrt={kernelName:MG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(O6(ot(t,"float32")),r)}}};var Jrt={kernelName:OG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{begin:a,size:i}=t,o=n.shape,[s,u]=NQe(n,a,i),c=[];for(let l=0;l<r.rank;l++)c.push([s[l],o[l]-s[l]-u[l]]);return{x:()=>G6(r,c)}}};var Qrt={kernelName:VG,outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{dim:a}=t,i=!0,o=$e(r,n);return{logits:()=>mn(o,$e(At(o,[a],i),n))}}};var ent={kernelName:zG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,e2(t))}}};var dV={kernelName:qG,gradFunc:(r,e,t)=>{let{blockShape:n,paddings:a}=t;return{x:()=>t2(r,n,a)}}};var vV={kernelName:UG,gradFunc:(r,e,t)=>{let{axis:n}=t;return{x:()=>Gh(r,n)}}};var tnt={kernelName:$G,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Fr(r,$e(ds(ot(t,"float32")),2))}}};var rnt={kernelName:A9e,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,$e(ot(t,"float32"),2))}}};var nnt={kernelName:GG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=tn(2);return{a:()=>$e(r,$e(a,mn(t,n))),b:()=>$e(r,$e(a,mn(n,t)))}}};var ant={kernelName:JG,gradFunc:r=>({x:()=>kr(r)})};var int={kernelName:HG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Rr(t.shape,n.shape);return{a:()=>{let s=r,u=hn(t.shape,a);return u.length>0&&(s=At(s,u)),pe(s,t.shape)},b:()=>{let s=r,u=hn(n.shape,a);return u.length>0&&(s=At(s,u)),pe(In(s),n.shape)}}}};var ont={kernelName:WG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,a=n.shape.slice(),{axis:i}=t;Ui(i,n.shape).forEach(c=>{a[c]=1});let s=pe(r,a),u=$e(s,Hm(n.shape,"float32"));return{x:()=>u}}};var snt={kernelName:KG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Fr(r,fn(r2(t)))}}};var unt={kernelName:jG,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(mn(tn(1),fn(t)),r)}}};var cnt={kernelName:Wk,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{reps:a}=t;return{x:()=>{let o=kr(n);if(n.rank===1)for(let s=0;s<a[0];++s)o=ri(o,qi(r,[s*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)o=ri(o,qi(r,[s*n.shape[0],u*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)o=ri(o,qi(r,[s*n.shape[0],u*n.shape[1],c*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)for(let l=0;l<a[3];++l)o=ri(o,qi(r,[s*n.shape[0],u*n.shape[1],c*n.shape[2],l*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return o}}}};var lnt={kernelName:Cm,gradFunc:(r,e,t)=>{let n=t,{perm:a}=n,i=Xk(a);return{x:()=>Cu(r,i)}}};var fnt={kernelName:XG,gradFunc:(r,e,t)=>{let n=t,{axis:a}=n;return{value:()=>Zk(r,a)}}};var hnt={kernelName:YG,inputsToSave:["segmentIds"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pnt(r,t)}}};function pnt(r,e){let t=V6(e,kr(e)),n=z6(r,t),a=Um(e,tn(0,"int32")),i=n.rank-a.rank;for(let s=0;s<i;++s)a=L6(a,s+1);a=qh(a,Hm(n.shape,"bool"));let o=kr(n);return yo(a,n,o)}var dnt={kernelName:ZG,gradFunc:r=>({x:()=>kr(r)})};var vnt=[p6,TYe,EYe,AYe,DYe,FYe,RYe,OYe,MYe,BYe,LYe,zYe,KYe,YYe,JYe,eZe,tZe,rZe,nZe,lZe,fZe,pZe,yZe,mZe,SZe,TZe,IZe,LZe,UZe,VZe,Mrt,GZe,KZe,jZe,XZe,YZe,JZe,ZZe,tJe,aJe,iJe,oJe,sJe,uJe,cJe,fJe,hJe,pJe,dJe,gJe,iV,iV,wJe,SJe,EJe,IJe,CJe,AJe,_Je,RJe,OJe,PJe,MJe,BJe,zJe,oV,oV,qJe,UJe,Prt,Brt,Lrt,zrt,$rt,Wrt,qrt,Urt,Vrt,Grt,Hrt,Krt,jrt,Xrt,Yrt,Zrt,Jrt,Qrt,ent,dV,dV,vV,vV,tnt,nnt,rnt,ant,int,ont,snt,unt,cnt,lnt,fnt,hnt,dnt];for(let r of vnt)K9e(r);ce().prototype.abs=function(){return this.throwIfDisposed(),mo(this)};ce().prototype.acos=function(){return this.throwIfDisposed(),IQe(this)};ce().prototype.acosh=function(){return this.throwIfDisposed(),AQe(this)};ce().prototype.add=function(r){return this.throwIfDisposed(),ri(this,r)};ce().prototype.all=function(r,e){return this.throwIfDisposed(),_Qe(this,r,e)};ce().prototype.any=function(r,e){return this.throwIfDisposed(),RQe(this,r,e)};ce().prototype.argMax=function(r){return this.throwIfDisposed(),PQe(this,r)};ce().prototype.argMin=function(r){return this.throwIfDisposed(),BQe(this,r)};ce().prototype.asScalar=function(){return this.throwIfDisposed(),ie(this.size===1,()=>"The array must have only 1 element."),pe(this,[])};ce().prototype.asType=function(r){return this.throwIfDisposed(),ot(this,r)};ce().prototype.as1D=function(){return this.throwIfDisposed(),pe(this,[this.size])};ce().prototype.as2D=function(r,e){return this.throwIfDisposed(),pe(this,[r,e])};ce().prototype.as3D=function(r,e,t){return this.throwIfDisposed(),pe(this,[r,e,t])};ce().prototype.as4D=function(r,e,t,n){return this.throwIfDisposed(),pe(this,[r,e,t,n])};ce().prototype.as5D=function(r,e,t,n,a){return this.throwIfDisposed(),pe(this,[r,e,t,n,a])};ce().prototype.asin=function(){return this.throwIfDisposed(),zQe(this)};ce().prototype.asinh=function(){return this.throwIfDisposed(),WQe(this)};ce().prototype.atan=function(){return this.throwIfDisposed(),UQe(this)};ce().prototype.atan2=function(r){return this.throwIfDisposed(),GQe(this,r)};ce().prototype.atanh=function(){return this.throwIfDisposed(),KQe(this)};ce().prototype.avgPool=function(r,e,t,n){return this.throwIfDisposed(),R6(this,r,e,t,n)};ce().prototype.batchToSpaceND=function(r,e){return this.throwIfDisposed(),t2(this,r,e)};ce().prototype.batchNorm=function(r,e,t,n,a){return this.throwIfDisposed(),ret(this,r,e,t,n,a)};ce().prototype.broadcastTo=function(r){return this.throwIfDisposed(),_m(this,r)};ce().prototype.cast=function(r){return this.throwIfDisposed(),ot(this,r)};ce().prototype.ceil=function(){return this.throwIfDisposed(),aet(this)};ce().prototype.clipByValue=function(r,e){return this.throwIfDisposed(),set(this,r,e)};ce().prototype.concat=function(r,e){return this.throwIfDisposed(),r instanceof Bn&&(r=[r]),Gh([this,...r],e)};ce().prototype.conv1d=function(r,e,t,n,a,i){return this.throwIfDisposed(),cet(this,r,e,t,n,a,i)};ce().prototype.conv2dTranspose=function(r,e,t,n,a){return this.throwIfDisposed(),het(this,r,e,t,n,a)};ce().prototype.conv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),Gm(this,r,e,t,n,a,i)};ce().prototype.cos=function(){return this.throwIfDisposed(),r2(this)};ce().prototype.cosh=function(){return this.throwIfDisposed(),O6(this)};ce().prototype.cumprod=function(r,e,t){return this.throwIfDisposed(),Ok(this,r,e,t)};ce().prototype.cumsum=function(r,e,t){return this.throwIfDisposed(),x6(this,r,e,t)};ce().prototype.depthToSpace=function(r,e){return this.throwIfDisposed(),get(this,r,e)};ce().prototype.depthwiseConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),P6(this,r,e,t,n,a,i)};ce().prototype.dilation2d=function(r,e,t,n,a){return this.throwIfDisposed(),wet(this,r,e,t,n,a)};ce().prototype.divNoNan=function(r){return this.throwIfDisposed(),ket(this,r)};ce().prototype.div=function(r){return this.throwIfDisposed(),Fr(this,r)};ce().prototype.dot=function(r){return this.throwIfDisposed(),Tet(this,r)};ce().prototype.elu=function(){return this.throwIfDisposed(),Iet(this)};ce().prototype.equal=function(r){return this.throwIfDisposed(),Jk(this,r)};ce().prototype.erf=function(){return this.throwIfDisposed(),Aet(this)};ce().prototype.euclideanNorm=function(r,e){return this.throwIfDisposed(),Oet(this,r,e)};ce().prototype.exp=function(){return this.throwIfDisposed(),vs(this)};ce().prototype.expandDims=function(r){return this.throwIfDisposed(),L6(this,r)};ce().prototype.expm1=function(){return this.throwIfDisposed(),Bet(this)};ce().prototype.fft=function(){return this.throwIfDisposed(),H6(this)};ce().prototype.flatten=function(){return this.throwIfDisposed(),pe(this,[this.size])};ce().prototype.floor=function(){return this.throwIfDisposed(),I6(this)};ce().prototype.floorDiv=function(r){return this.throwIfDisposed(),d6(this,r)};ce().prototype.gather=function(r,e,t){return this.throwIfDisposed(),z6(this,r,e,t)};ce().prototype.greaterEqual=function(r){return this.throwIfDisposed(),Um(this,r)};ce().prototype.greater=function(r){return this.throwIfDisposed(),ll(this,r)};ce().prototype.ifft=function(){return this.throwIfDisposed(),Mk(this)};ce().prototype.irfft=function(){return this.throwIfDisposed(),frt(this)};ce().prototype.isFinite=function(){return this.throwIfDisposed(),$et(this)};ce().prototype.isInf=function(){return this.throwIfDisposed(),qet(this)};ce().prototype.isNaN=function(){return this.throwIfDisposed(),Vet(this)};ce().prototype.leakyRelu=function(r){return this.throwIfDisposed(),Het(this,r)};ce().prototype.lessEqual=function(r){return this.throwIfDisposed(),Vm(this,r)};ce().prototype.less=function(r){return this.throwIfDisposed(),E6(this,r)};ce().prototype.localResponseNormalization=function(r,e,t,n){return this.throwIfDisposed(),jet(this,r,e,t,n)};ce().prototype.logSigmoid=function(){return this.throwIfDisposed(),ett(this)};ce().prototype.logSoftmax=function(r){return this.throwIfDisposed(),rtt(this,r)};ce().prototype.logSumExp=function(r,e){return this.throwIfDisposed(),att(this,r,e)};ce().prototype.log=function(){return this.throwIfDisposed(),Km(this)};ce().prototype.log1p=function(){return this.throwIfDisposed(),Yet(this)};ce().prototype.logicalAnd=function(r){return this.throwIfDisposed(),qh(this,r)};ce().prototype.logicalNot=function(){return this.throwIfDisposed(),n2(this)};ce().prototype.logicalOr=function(r){return this.throwIfDisposed(),q6(this,r)};ce().prototype.logicalXor=function(r){return this.throwIfDisposed(),utt(this,r)};ce().prototype.matMul=function(r,e,t){return this.throwIfDisposed(),Ta(this,r,e,t)};ce().prototype.maxPool=function(r,e,t,n){return this.throwIfDisposed(),U6(this,r,e,t,n)};ce().prototype.max=function(r,e){return this.throwIfDisposed(),al(this,r,e)};ce().prototype.maximum=function(r){return this.throwIfDisposed(),V6(this,r)};ce().prototype.mean=function(r,e){return this.throwIfDisposed(),htt(this,r,e)};ce().prototype.min=function(r,e){return this.throwIfDisposed(),Pk(this,r,e)};ce().prototype.minimum=function(r){return this.throwIfDisposed(),dtt(this,r)};ce().prototype.mirrorPad=function(r,e){return this.throwIfDisposed(),mtt(this,r,e)};ce().prototype.mod=function(r){return this.throwIfDisposed(),ytt(this,r)};ce().prototype.mul=function(r){return this.throwIfDisposed(),$e(this,r)};ce().prototype.neg=function(){return this.throwIfDisposed(),In(this)};ce().prototype.norm=function(r,e,t){return this.throwIfDisposed(),B6(this,r,e,t)};ce().prototype.notEqual=function(r){return this.throwIfDisposed(),wtt(this,r)};ce().prototype.oneHot=function(r,e=1,t=0){return this.throwIfDisposed(),xQe(this,r,e,t)};ce().prototype.onesLike=function(){return this.throwIfDisposed(),ktt(this)};ce().prototype.pad=function(r,e){return this.throwIfDisposed(),G6(this,r,e)};ce().prototype.pool=function(r,e,t,n,a,i){return this.throwIfDisposed(),Itt(this,r,e,t,n,a,i)};ce().prototype.pow=function(r){return this.throwIfDisposed(),jm(this,r)};ce().prototype.prelu=function(r){return this.throwIfDisposed(),Att(this,r)};ce().prototype.prod=function(r,e){return this.throwIfDisposed(),_tt(this,r,e)};ce().prototype.reciprocal=function(){return this.throwIfDisposed(),Htt(this)};ce().prototype.relu=function(){return this.throwIfDisposed(),jtt(this)};ce().prototype.relu6=function(){return this.throwIfDisposed(),Ytt(this)};ce().prototype.reshapeAs=function(r){return this.throwIfDisposed(),pe(this,r.shape)};ce().prototype.reshape=function(r){return this.throwIfDisposed(),pe(this,r)};ce().prototype.resizeBilinear=function(r,e,t){return this.throwIfDisposed(),Crt(this,r,e,t)};ce().prototype.resizeNearestNeighbor=function(r,e,t){return this.throwIfDisposed(),Drt(this,r,e,t)};ce().prototype.reverse=function(r){return this.throwIfDisposed(),$m(this,r)};ce().prototype.rfft=function(){return this.throwIfDisposed(),prt(this)};ce().prototype.round=function(){return this.throwIfDisposed(),Qtt(this)};ce().prototype.rsqrt=function(){return this.throwIfDisposed(),k6(this)};ce().prototype.selu=function(){return this.throwIfDisposed(),trt(this)};ce().prototype.separableConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),nrt(this,r,e,t,n,a,i)};ce().prototype.sigmoid=function(){return this.throwIfDisposed(),e2(this)};ce().prototype.sign=function(){return this.throwIfDisposed(),irt(this)};ce().prototype.sin=function(){return this.throwIfDisposed(),y6(this)};ce().prototype.sinh=function(){return this.throwIfDisposed(),b6(this)};ce().prototype.slice=function(r,e){return this.throwIfDisposed(),qi(this,r,e)};ce().prototype.softmax=function(r){return this.throwIfDisposed(),srt(this,r)};ce().prototype.softplus=function(){return this.throwIfDisposed(),W6(this)};ce().prototype.spaceToBatchND=function(r,e){return this.throwIfDisposed(),jk(this,r,e)};ce().prototype.split=function(r,e){return this.throwIfDisposed(),Bm(this,r,e)};ce().prototype.sqrt=function(){return this.throwIfDisposed(),ds(this)};ce().prototype.square=function(){return this.throwIfDisposed(),fn(this)};ce().prototype.squaredDifference=function(r){return this.throwIfDisposed(),vrt(this,r)};ce().prototype.squeeze=function(r){return this.throwIfDisposed(),grt(this,r)};ce().prototype.stack=function(r,e){this.throwIfDisposed();let t=r instanceof Bn?[this,r]:[this,...r];return Zk(t,e)};ce().prototype.step=function(r){return this.throwIfDisposed(),qm(this,r)};ce().prototype.stridedSlice=function(r,e,t,n,a,i,o,s){return this.throwIfDisposed(),brt(this,r,e,t,n,a,i,o,s)};ce().prototype.sub=function(r){return this.throwIfDisposed(),mn(this,r)};ce().prototype.sum=function(r,e){return this.throwIfDisposed(),At(this,r,e)};ce().prototype.tan=function(){return this.throwIfDisposed(),xrt(this)};ce().prototype.tanh=function(){return this.throwIfDisposed(),JQe(this)};ce().prototype.tile=function(r){return this.throwIfDisposed(),S6(this,r)};ce().prototype.toBool=function(){return this.throwIfDisposed(),ot(this,"bool")};ce().prototype.toFloat=function(){return this.throwIfDisposed(),ot(this,"float32")};ce().prototype.toInt=function(){return this.throwIfDisposed(),ot(this,"int32")};ce().prototype.topk=function(r,e){return this.throwIfDisposed(),Nrt(this,r,e)};ce().prototype.transpose=function(r){return this.throwIfDisposed(),Cu(this,r)};ce().prototype.unique=function(r){return this.throwIfDisposed(),Ert(this,r)};ce().prototype.unsortedSegmentSum=function(r,e){return this.throwIfDisposed(),N6(this,r,e)};ce().prototype.unstack=function(r){return this.throwIfDisposed(),C6(this,r)};ce().prototype.where=function(r,e){return this.throwIfDisposed(),yo(r,this,e)};ce().prototype.zerosLike=function(){return this.throwIfDisposed(),kr(this)};var mnt="4.19.0";var gnt={"tfjs-core":mk.version_core,"tfjs-backend-cpu":bk.version_cpu,"tfjs-backend-webgl":wk.version_webgl,"tfjs-data":mV.version_data,"tfjs-layers":gk.version_layers,"tfjs-converter":yk.version_converter,tfjs:mnt};Ea.data=qXe;Ea.version=gnt;Object.keys(mk).forEach(function(r){r!=="default"&&!Ea.hasOwnProperty(r)&&Object.defineProperty(Ea,r,{enumerable:!0,get:function(){return mk[r]}})});Object.keys(gk).forEach(function(r){r!=="default"&&!Ea.hasOwnProperty(r)&&Object.defineProperty(Ea,r,{enumerable:!0,get:function(){return gk[r]}})});Object.keys(yk).forEach(function(r){r!=="default"&&!Ea.hasOwnProperty(r)&&Object.defineProperty(Ea,r,{enumerable:!0,get:function(){return yk[r]}})});Object.keys(bk).forEach(function(r){r!=="default"&&!Ea.hasOwnProperty(r)&&Object.defineProperty(Ea,r,{enumerable:!0,get:function(){return bk[r]}})});Object.keys(wk).forEach(function(r){r!=="default"&&!Ea.hasOwnProperty(r)&&Object.defineProperty(Ea,r,{enumerable:!0,get:function(){return wk[r]}})})});var hl=X((Vlt,j6)=>{var{argmin:ynt,distance:bnt,isArray:wnt,isDataFrame:K6,isNumber:xnt,isSeries:knt,shape:Snt}=Tt(),Ym=Kh(),Nnt=new Function("try { return this === window } catch(e) { return false }");function Tnt(r){return jh(r)?r.shape.length===2:K6(r)?!0:wnt(r)&&Snt(r).length===2}function jh(r){return r instanceof Ym.Tensor}function Ent(r){return xnt(r)&&parseInt(r)===r&&r>=0}function Int(r,e){return Ym.tidy(()=>{jh(r)&&(r=r.arraySync()),jh(e)&&(e=e.arraySync());let t=[],n=e.slice();return r.forEach(a=>{let i=ynt(n.map(o=>bnt(a,o)));t.push(n[i]),n.splice(i,1)}),t.concat(n)})}function Cnt(r){return Ym.tidy(()=>((K6(r)||knt(r))&&(r=r.values),jh(r)||(r=Ym.tensor(r)),r.div(r.abs())))}j6.exports={isBrowser:Nnt,isMatrix:Tnt,isTFTensor:jh,isWholeNumber:Ent,orderCentroids:Int,sign:Cnt}});var p2=X((Glt,Z6)=>{var{assert:f2,flatten:X6,isDataFrame:Du,isEqual:h2,isSeries:_u,isUndefined:Ant,shape:pl}=Tt(),{isTFTensor:Fu,sign:Dnt}=hl(),Vi=Kh();function _nt(r,e){return Fu(r)&&(r=r.arraySync()),(Du(r)||_u(r))&&(r=r.values),Fu(e)&&(e=e.arraySync()),(Du(e)||_u(e))&&(e=e.values),f2(h2(pl(r),pl(e)),"`yPred` and `yTrue` must have the same shape!"),Vi.tidy(()=>Vi.tensor(r).sub(Vi.tensor(e)).pow(2).sum().arraySync())}function Fnt(r,e){Fu(r)&&(r=r.arraySync()),(Du(r)||_u(r))&&(r=r.values),Fu(e)&&(e=e.arraySync()),(Du(e)||_u(e))&&(e=e.values),f2(h2(pl(r),pl(e)),"`yPred` and `yTrue` must have the same shape!");let t=X6(r),n=X6(e),a=0;return t.forEach((i,o)=>{i===n[o]&&a++}),a/t.length}function Y6(r,e,t){return Vi.tidy(()=>{Fu(r)&&(r=r.arraySync()),(Du(r)||_u(r))&&(r=r.values),Fu(e)&&(e=e.arraySync()),(Du(e)||_u(e))&&(e=e.values),Ant(t)&&(t=r),Fu(t)&&(t=t.arraySync()),(Du(t)||_u(t))&&(t=t.values),typeof t=="number"&&(t=[t]),f2(h2(pl(r),pl(e)),"`yTrue` and `yPred` must have the same shape!"),r=Vi.tensor(r),e=Vi.tensor(e),t=Vi.tensor(t);let n=r.sub(e).pow(2).sum(),a=r.sub(t.mean()).pow(2).sum();return Vi.scalar(1).sub(n.div(a)).arraySync()})}function Rnt(r,e,t){return Vi.tidy(()=>{let n=Vi.scalar(Y6(r,e,t));return Dnt(n).mul(n.abs().sqrt()).arraySync()})}Z6.exports={sse:_nt,accuracy:Fnt,rSquared:Y6,rScore:Rnt}});var Gi=X((Hlt,J6)=>{J6.exports={shouldIgnoreNaNValues:!0}});var dl=X((Klt,eH)=>{var{assert:Ont,flatten:Pnt,isArray:Mnt,isDataFrame:Bnt,isNumber:Lnt,isSeries:znt}=Tt();function Q6(r){if(Bnt(r)||znt(r))return Q6(r.values);Ont(Mnt(r),"The `containsOnlyNumbers` function only works on arrays, Series, and DataFrames!");let e=Pnt(r);for(let t=0;t<e.length;t++)if(!Lnt(e[t]))return!1;return!0}eH.exports=Q6});var v2=X((jlt,tH)=>{var{dropMissing:$nt,flatten:Wnt,isArray:qnt,isDataFrame:Unt,isSeries:Vnt}=Tt();function d2(r){return typeof r=="number"?r===0||r===1:Unt(r)||Vnt(r)?d2(r.values):qnt(r)?r.length===0?!1:$nt(Wnt(r)).every(t=>d2(t)):!1}tH.exports=d2});var fH=X((Xlt,lH)=>{var{abs:rH,apply:nH,assert:aH,clamp:Gnt,copy:Hnt,divide:Knt,dropNaN:jnt,flatten:Xnt,isArray:Ynt,isDataFrame:Znt,isNumber:iH,isSeries:Jnt,max:oH,median:sH,min:Qnt,sort:eat,subtract:uH}=Tt(),tat=Gi(),rat=dl(),nat=v2();function cH(r,e){if(Znt(r)||Jnt(r)){let u=r.copy();return u._values=cH(u._values,e),u}if(aH(Ynt(r),"The `clipOutliers` function only works on arrays, Series, and DataFrames!"),e=e||5,aH(iH(e),"Any `maxScore` value passed into the `clipOutliers` function must be a number!"),!tat.shouldIgnoreNaNValues&&!rat(r))return nH(r,()=>NaN);let t=Xnt(r),n=jnt(t);if(nat(n)||n.length===0)return r;let a=sH(n),i=sH(rH(uH(n,a))),o=!1;if(i===0){let u=eat(Hnt(n)),c=u.filter(p=>p<a),l=u.filter(p=>p>a),f=a,h=a;if(c.length>0&&(f=oH(c)),l.length>0&&(h=Qnt(l)),i=(h-f)/2,i===0)return r;o=(a-f)/i>e||(h-a)/i>e}return oH(Knt(rH(uH(n,a)),i))>e||o?nH(r,u=>iH(u)?Gnt(u,a-e*i,a+e*i):u):r}lH.exports=cH});var g2=X((Ylt,bH)=>{var{assert:hH,dropNaN:pH,isArray:dH,isSeries:vH,mean:mH,shape:gH,variance:yH}=Tt(),aat=Gi();function m2(r,e){if(vH(r))return m2(r.values,e);if(vH(e))return m2(r,e.values);hH(dH(r)&&dH(e)&&gH(r).length===1&&gH(e).length===1,"The `cohensd` function only works on 1-dimensional arrays and Series!"),hH(r.length===e.length,"Two arrays or Series passed into the `cohensd` function must have the same length!"),aat.shouldIgnoreNaNValues&&(r=pH(r),e=pH(e));try{let t=mH(r),n=mH(e),a=Math.sqrt((yH(r)+yH(e))/2);return(t-n)/a}catch{return NaN}}bH.exports=m2});var SH=X((Zlt,kH)=>{var{assert:wH,DataFrame:iat,isArray:oat,isSeries:sat,shape:uat,zeros:cat}=Tt();function xH(r){if(sat(r)){let n=new iat(xH(r.values));return n.index=r.index.slice(),n.columns=r.index.slice(),n}wH(oat(r),"The `diagonalize` function only works on 1-dimensional arrays and Series!");let e=uat(r);wH(e.length===1,"The `diagonalize` function only works on 1-dimensional arrays and Series!");let t=cat([e[0],e[0]]);return r.forEach((n,a)=>t[a][a]=n),t}kH.exports=xH});var x2=X((Jlt,IH)=>{var{assert:y2,clamp:lat,correl:NH,DataFrame:Zm,dropNaNPairwise:fat,isArray:TH,isDataFrame:Jm,isJagged:EH,isUndefined:hat,ndarray:pat}=Tt(),dat=Gi();function b2(r){let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return Object.defineProperty(r,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),r}function w2(r,e){if(hat(e)&&(e=r),Jm(r)){let n=new Zm(w2(r.values,e));return n.index=r.columns.slice(),n.columns=Jm(e)?e.columns.slice():new Zm(e).columns.slice(),b2(n)}if(Jm(e)){let n=new Zm(w2(r,e.values));return n.index=Jm(r)?r.columns.slice():new Zm(r).columns.slice(),n.columns=e.columns.slice(),b2(n)}y2(TH(r)&&TH(e),"The `getCorrelationMatrix` function only works on 2-dimensional arrays and DataFrames!"),y2(!EH(r)&&!EH(e),"The `getCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),y2(r.length===e.length,'The dimensions of the matrices you passed into the `getCorrelationMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=pat([r[0].length,e[0].length]);for(let n=0;n<r[0].length;n++){let a=r.map(i=>i[n]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);dat.shouldIgnoreNaNValues?t[n][i]=NH(...fat(a,o)):t[n][i]=NH(a,o)}}return b2(lat(t,-1,1))}IH.exports=w2});var k2=X((Qlt,CH)=>{function vat(r){try{let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return r[e]===Symbol.for(e)}catch{return!1}}CH.exports=vat});var FH=X((eft,_H)=>{var{DataFrame:S2,isArray:mat,isDataFrame:Qm,isNumber:AH,MathError:gat,sort:yat}=Tt(),DH=x2(),bat=k2();function wat(r,e,t){t=Object.values(arguments).find(i=>AH(i))||1-1e-5;let n=(()=>{let i=Object.values(arguments).filter(o=>mat(o)||Qm(o));if(i.length===1){let o=i[0];if(bat(o))return Qm(o)?o:new S2(o);{let s=DH(o,null);return Qm(s)?s:new S2(s)}}if(i.length===2){let o=DH(i[0],i[1]);return Qm(o)?o:new S2(o)}throw new gat("You must pass 1 or 2 2-dimensional arrays or DataFrames into the `getHighlyCorrelatedColumns` function!")})(),a={};return n.values.forEach((i,o)=>{i.forEach((s,u)=>{if(AH(s)&&s>t){let c=n.index[o],l=n.columns[u];a[c]||(a[c]=[]),a[c].indexOf(l)<0&&a[c].push(l),a[l]||(a[l]=[]),a[l].indexOf(c)<0&&a[l].push(c)}})}),Object.keys(a).forEach(i=>{a[i]=yat(a[i])}),a}_H.exports=wat});var N2=X((tft,OH)=>{var{dropNaN:xat,isArray:kat,isDataFrame:Sat,isNumber:Nat,isSeries:Tat,pow:Eat,sqrt:Iat,sum:Cat}=Tt(),Aat=Gi();function RH(r){return Sat(r)||Tat(r)?RH(r.values):Nat(r)?Math.abs(r):kat(r)?(Aat.shouldIgnoreNaNValues&&(r=xat(r)),Iat(Cat(Eat(r,2)))):NaN}OH.exports=RH});var T2=X((rft,LH)=>{var{assert:PH,DataFrame:Dat,isArray:_at,isSeries:Fat,isString:Rat,isUndefined:MH,set:Oat,shape:Pat,sort:Mat}=Tt();function BH(){if(arguments.length===1&&Fat(arguments[0])){let{name:a,values:i}=arguments[0],o=BH(a,i),s=new Dat(o);return s.index=arguments[0].index.slice(),s}let[r,e]=arguments;PH(Rat(r),"When passing two arguments into the `getOneHotEncodings` function, the first argument must be a string representing the name of the variable being encoded!"),PH(_at(e)&&Pat(e).length===1,"When passing two arguments into the `getOneHotEncodings` function, the second argument must be a 1-dimensional array!");let t={};return Mat(Oat(e)).filter(a=>typeof a!="number"||a.toString()!=="NaN").filter(a=>!MH(a)).map(a=>r+"_"+a).slice(0,-1).forEach(a=>{t[a]=e.map(i=>a===r+"_"+i?1:typeof i=="number"&&i.toString()==="NaN"?NaN:MH(i)?NaN:0)}),t}LH.exports=BH});var $H=X((nft,zH)=>{var{count:Bat}=Tt();function Lat(r){return Bat(r).map(t=>(t.percentage=t.count/r.length,t))}zH.exports=Lat});var WH=X((aft,zat)=>{zat.exports=[.5,.49601,.49202,.48803,.48405,.48006,.47608,.4721,.46812,.46414,.46017,.4562,.45224,.44828,.44433,.44038,.4364,.43251,.42858,.42465,.42074,.41683,.41294,.40905,.40517,.40129,.39743,.39358,.38974,.38591,.38209,.37828,.37448,.3707,.36693,.36317,.35942,.35569,.35197,.34827,.34458,.3409,.33724,.3336,.32997,.32636,.32276,.31918,.31561,.31207,.30854,.30503,.30153,.29806,.2946,.29116,.28774,.28434,.28096,.2776,.27425,.27093,.26763,.26435,.26109,.25785,.25463,.25143,.24825,.2451,.24196,.23885,.23576,.2327,.22965,.22663,.22363,.22065,.2177,.21476,.21186,.20897,.20611,.20327,.20045,.19766,.19489,.19215,.18943,.18673,.18406,.18141,.17879,.17619,.17361,.17106,.16853,.16602,.16354,.16109,.15866,.15625,.15386,.15151,.14917,.14686,.14457,.14231,.14007,.13786,.13567,.1335,.13136,.12924,.12714,.12507,.12302,.121,.119,.11702,.11507,.11314,.11123,.10935,.10749,.10565,.10383,.10204,.10027,.09853,.0968,.0951,.09342,.09176,.09012,.08851,.08692,.08534,.08379,.08226,.08076,.07927,.0778,.07636,.07493,.07353,.07215,.07078,.06944,.06811,.06681,.06552,.06426,.06301,.06178,.06057,.05938,.05821,.05705,.05592,.0548,.0537,.05262,.05155,.0505,.04947,.04846,.04746,.04648,.04551,.04457,.04363,.04272,.04182,.04093,.04006,.0392,.03836,.03754,.03673,.03593,.03515,.03438,.03362,.03288,.03216,.03144,.03074,.03005,.02938,.02872,.02807,.02743,.0268,.02619,.02559,.025,.02442,.02385,.0233,.02275,.02222,.02169,.02118,.02068,.02018,.0197,.01923,.01876,.01831,.01786,.01743,.017,.01659,.01618,.01578,.01539,.015,.01463,.01426,.0139,.01355,.01321,.01287,.01255,.01222,.01191,.0116,.0113,.01101,.01072,.01044,.01017,.0099,.00964,.00939,.00914,.00889,.00866,.00842,.0082,.00798,.00776,.00755,.00734,.00714,.00695,.00676,.00657,.00639,.00621,.00604,.00587,.0057,.00554,.00539,.00523,.00508,.00494,.0048,.00466,.00453,.0044,.00427,.00415,.00402,.00391,.00379,.00368,.00357,.00347,.00336,.00326,.00317,.00307,.00298,.00289,.0028,.00272,.00264,.00256,.00248,.0024,.00233,.00226,.00219,.00212,.00205,.00199,.00193,.00187,.00181,.00175,.00169,.00164,.00159,.00154,.00149,.00144,.00139,.00135,.00131,.00126,.00122,.00118,.00114,.00111,.00107,.00104,.001,97e-5,94e-5,9e-4,87e-5,84e-5,82e-5,79e-5,76e-5,74e-5,71e-5,69e-5,66e-5,64e-5,62e-5,6e-4,58e-5,56e-5,54e-5,52e-5,5e-4,48e-5,47e-5,45e-5,43e-5,42e-5,4e-4,39e-5,38e-5,36e-5,35e-5,34e-5,32e-5,31e-5,3e-4,29e-5,28e-5,27e-5,26e-5,25e-5,24e-5,23e-5,22e-5,22e-5,21e-5,2e-4,19e-5,19e-5,18e-5,17e-5,17e-5,16e-5,15e-5,15e-5,14e-5,14e-5,13e-5,13e-5,12e-5,12e-5,11e-5,11e-5,1e-4,1e-4,1e-4,9e-5,9e-5,8e-5,8e-5,8e-5,8e-5,7e-5,7e-5,7e-5,6e-5,6e-5,6e-5,6e-5,5e-5,5e-5,5e-5,5e-5,5e-5,4e-5,4e-5,4e-5,4e-5,4e-5,4e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,2e-5,2e-5,2e-5,2e-5]});var I2=X((ift,YH)=>{var{abs:qH,assert:$at,dropNaNPairwise:Wat,flatten:eg,isArray:UH,isDataFrame:VH,isEqual:qat,isSeries:GH,mean:HH,remap:Uat,round:Vat,shape:KH,sqrt:Gat,std:jH}=Tt(),Hat=Gi(),XH=WH();function Kat(r){return qH(r)>4.1?0:XH[Vat(Uat(qH(r),0,4.1,0,XH.length))]}function E2(r,e){if(VH(r)||GH(r))return E2(r.values,e);if(VH(e)||GH(e))return E2(r,e.values);$at(UH(r)&&UH(e)&&qat(KH(r),KH(e)),"You must pass two identically-shaped arrays, Series, or DataFrames into the `pValue` function!");let[t,n]=Hat.shouldIgnoreNaNValues?Wat(eg(r),eg(e)):[eg(r),eg(e)];if(t.length===0||n.length===0)return NaN;let a=HH(t),i=HH(n),o=jH(t),s=jH(n),u=t.length,c=n.length,l=(a-i)/Gat(o*o/u+s*s/c);return 2*Kat(l)}YH.exports=E2});var t5=X((oft,e5)=>{var{assert:C2,clamp:jat,DataFrame:tg,dropNaNPairwise:Xat,isArray:ZH,isDataFrame:rg,isJagged:JH,isUndefined:Yat,ndarray:Zat}=Tt(),Jat=Gi(),QH=I2();function A2(r){let e="@jrc03c/js-data-science-helpers/get-p-value-matrix";return Object.defineProperty(r,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),r}function D2(r,e){if(Yat(e)&&(e=r),rg(r)){let n=new tg(D2(r.values,e));return n.index=r.columns.slice(),n.columns=rg(e)?e.columns.slice():new tg(e).columns.slice(),A2(n)}if(rg(e)){let n=new tg(D2(r,e.values));return n.index=rg(r)?r.columns.slice():new tg(r).columns.slice(),n.columns=e.columns.slice(),A2(n)}C2(ZH(r)&&ZH(e),"The `getPValueMatrix` function only works on 2-dimensional arrays and DataFrames!"),C2(!JH(r)&&!JH(e),"The `getPValueMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),C2(r.length===e.length,'The dimensions of the matrices you passed into the `getPValueMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=Zat([r[0].length,e[0].length]);for(let n=0;n<r[0].length;n++){let a=r.map(i=>i[n]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);Jat.shouldIgnoreNaNValues?t[n][i]=QH(...Xat(a,o)):t[n][i]=QH(a,o)}}return A2(jat(t,0,1))}e5.exports=D2});var o5=X((sft,i5)=>{var{assert:ng,intersect:Qat,isDataFrame:r5,isSeries:n5,isUndefined:a5}=Tt(),vl=class{constructor(e){let t=this;ng(a5(e)||e===vl.DROP_NAN_MODE||e===vl.DROP_MISSING_MODE,"The `mode` value passed into the `IndexMatcher` constructor must be undefined or one of [IndexMatcher.DROP_NAN_MODE, IndexMatcher.DROP_MISSING_MODE]! (By default, the mode is `Indexer.DROP_MISSING_MODE`.)"),t.mode=a5(e)?vl.DROP_MISSING_MODE:e,t.index=null}fit(){let e=this,t=[];return Object.values(arguments).forEach(n=>{ng(r5(n)||n5(n),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),e.mode===vl.DROP_MISSING_MODE?t.push(n.dropMissing().index):t.push(n.dropNaN().index)}),e.index=Qat(...t),e}transform(){let e=this;ng(!!e.index,"The IndexMatcher hasn't been fitted yet! Please call the `fit` method before calling the `transform` method.");let t=Object.values(arguments).map(n=>(ng(r5(n)||n5(n),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),n.get(e.index,null)));return t.length===1?t[0]:t}fitAndTransform(){return this.fit(...arguments).transform(...arguments)}},Xh=vl;hg(Xh,"DROP_NAN_MODE","DROP_NAN_MODE"),hg(Xh,"DROP_MISSING_MODE","DROP_MISSING_MODE");i5.exports=Xh});var F2=X((cft,f5)=>{var{assert:_2,isArray:eit,isBoolean:tit,isDataFrame:s5,isSeries:u5,int:rit,isNumber:nit,isUndefined:c5,range:l5,set:ait,shape:iit,shuffle:oit}=Tt();f5.exports=function(){let e=Array.from(arguments),t=e.find(p=>tit(p)),n=c5(t)?!0:t,a=e.find(p=>nit(p)),i=c5(a)?.1:a;_2(i>0&&i<1,"`testSize` must be a number between 0 and 1 (exclusive on both ends)!");let o=e.filter(p=>eit(p)||s5(p)||u5(p));_2(o.length>0,"You must pass at least one dataset into the `trainTestSplit` function!");let s=o.map(p=>iit(p)[0]);_2(ait(s).length===1,`All datasets passed into the \`trainTestSplit\` function must be the same length at their shallowest dimension! The lengths of your datasets, though, are: ${s.join(", ")}`);let u=[],c=n?oit(l5(0,s[0])):l5(0,s[0]),l=rit((1-i)*c.length),f=c.slice(0,l),h=c.slice(l);return o.forEach(p=>{if(s5(p))u.push(p.get(f,null)),u.push(p.get(h,null));else if(u5(p))u.push(p.get(f)),u.push(p.get(h));else{let d=[],m=[];p.forEach((v,g)=>{f.indexOf(g)>-1?d.push(v):m.push(v)}),u.push(d),u.push(m)}}),u}});var ig=X((lft,g5)=>{var{add:sit,argmin:uit,assert:cit,flatten:h5,isArray:lit,isDataFrame:p5,isEqual:fit,int:hit,isNumber:pit,isSeries:d5,normal:R2,pow:dit,random:vit,range:mit,scale:git,shape:ag,subtract:yit,sum:bit}=Tt(),wit=F2();function O2(r,e){(p5(r)||d5(r))&&(r=r.values),(p5(e)||d5(e))&&(e=e.values),cit(fit(ag(r),ag(e)),"`yPred` and `yTrue` must have the same shape!");let t=h5(r),n=h5(e),a=0;return t.forEach((i,o)=>{i===n[o]&&a++}),a/t.length}function xit(r){test(`tests that the \`${r.name}\` model works correctly`,()=>{let e=R2([5,10]).map(f=>f.map(h=>h*100+R2()*100)),t=[],n=mit(0,500).map(()=>{let f=hit(vit()*e.length),h=e[f];return t.push(f),sit(h,git(5,R2(ag(h))))}),[a,i,o,s]=wit(n,t),u=new r({k:e.length});u.fit(a),u.centroids=v5(e,u.centroids);let c=u.predict(a),l=u.predict(i);expect(O2(o,c)).toBeGreaterThan(.95),expect(O2(s,l)).toBeGreaterThan(.95)})}function kit(r){return lit(r)&&ag(r).length===2}function Sit(r){return pit(r)&&parseInt(r)===r&&r>=0}function v5(r,e){return r.map(t=>e[uit(e.map(n=>m5(t,n)))])}function m5(r,e){return bit(dit(yit(r,e),2))}g5.exports={accuracy:O2,createGenericTest:xit,isMatrix:kit,isWholeNumber:Sit,orderCentroids:v5,sse:m5}});var B2=X((fft,x5)=>{var{add:y5,argmin:Nit,assert:Ru,copy:Tit,distance:b5,divide:Eit,isDataFrame:Iit,isFunction:Cit,isUndefined:og,normal:Ait,random:Dit,range:_it,scale:Fit,shuffle:Rit,zeros:w5}=Tt(),{isMatrix:Oit,isWholeNumber:P2,sse:Pit}=ig(),M2=class{constructor(e){Ru(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),Ru(P2(e.k),"`k` must be a whole number!"),Ru(P2(e.maxIterations)||og(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),Ru(P2(e.maxRestarts)||og(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),Ru(typeof e.tolerance=="number"||og(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.k=e.k,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.centroids=null}initializeCentroids(e){let t=this;return Rit(e).slice(0,t.k)}getFitStepFunction(e,t){let n=this;Ru(Oit(e),"`x` must be a matrix!"),Iit(e)&&(e=e.values),og(t)||Ru(Cit(t),"If defined, `progress` must be a function!");let a=n.initializeCentroids(e),i={currentRestart:0,currentIteration:0,currentCentroids:a,bestCentroids:a,bestScore:-1/0,isFinished:!1};return function(){let s=n.predict(e,i.currentCentroids),u=[],c=w5(n.k);e.forEach((f,h)=>{let p=s[h];u[p]||(u[p]=w5(f.length)),u[p]=y5(u[p],f),c[p]++});let l=_it(0,n.k).map(f=>c[f]===0?y5(i.currentCentroids[parseInt(Dit()*i.currentCentroids.length)],Fit(.001,Ait(i.currentCentroids[0].length))):Eit(u[f],c[f]));if(b5(i.currentCentroids,l)<n.tolerance?i.currentIteration=n.maxIterations-1:i.currentCentroids=l,t&&t((i.currentRestart+i.currentIteration/n.maxIterations)/n.maxRestarts,n),i.currentIteration++,i.currentIteration>=n.maxIterations){let f=n.score(e,i.currentCentroids);if(f>i.bestScore&&(i.bestScore=f,i.bestCentroids=Tit(i.currentCentroids)),i.currentIteration=0,i.currentRestart++,i.currentRestart>=n.maxRestarts)i.isFinished=!0,n.centroids=i.bestCentroids,t&&t(1,n);else{let h=n.initializeCentroids(e);i.currentCentroids=h}}return i}}fit(e,t){let n=this,a=n.getFitStepFunction(e,t),i;for(;!i||!i.isFinished;)i=a();return n}predict(e,t){if(t=t||this.centroids,!t)throw new Error("No centroids were provided to the `predict` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `predict` method or run the `fit` method first!");return e.map(a=>Nit(t.map(i=>b5(a,i))))}score(e,t){let n=this;if(t=t||n.centroids,!t)throw new Error("No centroids were provided to the `score` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `score` method or run the `fit` method first!");let i=n.predict(e,t).map(o=>t[o]);return-Pit(e,i)}};x5.exports=M2});var z2=X((hft,N5)=>{var{argmin:Mit,distance:k5,divide:Bit,max:Lit,random:S5}=Tt(),zit=B2(),L2=class extends zit{initializeCentroids(e){let t=this,n=[e[parseInt(S5()*e.length)]];for(;n.length<t.k;){let a=e.map(o=>k5(o,n[Mit(n.map(s=>k5(o,s)))])),i=Bit(a,Lit(a));n.push(e[i.findIndex(o=>S5()<o)])}return n}};N5.exports=L2});var I5=X((pft,E5)=>{var{assert:xo,isArray:$it,isDataFrame:Wit,isEqual:qit,isFunction:Uit,isUndefined:ml,range:Vit,shape:T5}=Tt(),{isMatrix:Git,isWholeNumber:$2}=ig(),Hit=z2(),W2=class{constructor(e){ml(e)&&(e={}),xo(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),ml(e.ks)&&(e.ks=Vit(1,16)),xo($it(e.ks),"`ks` must be an array of whole numbers!"),e.ks.forEach(n=>{xo($2(n),"`ks` must be an array of whole numbers!")}),xo($2(e.maxIterations)||ml(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),xo($2(e.maxRestarts)||ml(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),xo(typeof e.tolerance=="number"||ml(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.ks=e.ks,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.scoreStopRatio=e.scoreStopRatio||.85,t.modelClass=e.modelClass||Hit,t.fittedModel=null}getFitStepFunction(e,t){let n=this;xo(Git(e),"`x` must be a matrix!"),Wit(e)&&(e=e.values),ml(t)||xo(Uit(t),"If defined, `progress` must be a function!");let a={isFinished:!1,lastScore:-1/0,currentIndex:0};return function(){let o=n.ks[a.currentIndex],s=new n.modelClass({k:o,maxRestarts:10,maxIterations:20});s.fit(e,c=>t?t((a.currentIndex+c)/(n.ks.length+1)):null);let u=s.score(e);return u/a.lastScore>n.scoreStopRatio?(a.isFinished=!0,a.currentIndex--):(a.lastScore=u,a.currentIndex+1>=n.ks.length?a.isFinished=!0:a.currentIndex++),a.isFinished&&(n.fittedModel=new n.modelClass({k:n.ks[a.currentIndex],maxRestarts:n.maxRestarts,maxIterations:n.maxIterations}),n.fittedModel.fit(e,c=>t?t((n.ks.length+c)/(n.ks.length+1)):null),t&&t(1)),a}}fit(e,t){let n=this,a=n.getFitStepFunction(e,t),i;for(;!i||!i.isFinished;)i=a();return n}predict(e,t){return this.fittedModel.predict(e,t)}score(e,t){return this.fittedModel.score(e,t)}get k(){return this.fittedModel.k}set k(e){throw new Error("You can't set the k-value manually! It has to be set automatically via the `fit` method.")}get centroids(){return this.fittedModel.centroids}set centroids(e){let t=this;xo(qit(T5(e),T5(t.fittedModel.centroids)),"When assigning a new value to the `centroids` property, the new centroids must have the same shape as the old centroids!"),t.fittedModel.centroids=e}};E5.exports=W2});var A5=X((dft,C5)=>{C5.exports={KMeansMeta:I5(),KMeansNaive:B2(),KMeansPlusPlus:z2(),helpers:ig()}});var q2=X((vft,P5)=>{var{apply:Kit,assert:jit,dropNaN:D5,isArray:Xit,isDataFrame:Yit,isSeries:Zit,mean:_5,std:F5}=Tt(),R5=Gi();function O5(r){if(Yit(r)||Zit(r)){let n=r.copy();return n.values=O5(n.values),n}jit(Xit(r),"The `normalize` function only works on arrays, Series, and DataFrames!");let e=(()=>R5.shouldIgnoreNaNValues?_5(D5(r)):_5(r))(),t=(()=>R5.shouldIgnoreNaNValues?F5(D5(r)):F5(r))();return t===0?r:Kit(r,n=>(n-e)/t)}P5.exports=O5});var V2=X((mft,$5)=>{var{assert:gl,dot:M5,isArray:B5,isSeries:U2,scale:Jit,Series:Qit,shape:L5}=Tt(),z5=dl();function sg(r,e){if(U2(r)){if(U2(e))return new Qit(sg(r.values,e.values));{let t=r.copy();return t.values=sg(r.values,e),t}}if(U2(e)){let t=e.copy();return t.values=sg(r,e.values),t}return gl(B5(r),"`project` only works on vectors!"),gl(B5(e),"`project` only works on vectors!"),gl(z5(r),"`project` only works on vectors of numbers!"),gl(z5(e),"`project` only works on vectors of numbers!"),gl(L5(r).length===1,"`project` only works on vectors!"),gl(L5(e).length===1,"`project` only works on vectors!"),Jit(M5(e,r)/M5(e,e),e)}$5.exports=sg});var G5=X((gft,V5)=>{var{assert:W5,copy:eot,DataFrame:tot,divide:rot,isArray:not,isDataFrame:aot,isJagged:iot,shape:oot,subtract:sot,transpose:q5}=Tt(),uot=dl(),cot=N2(),lot=V2();function U5(r){if(aot(r)){let a=new tot(U5(r.values));return a.index=r.index.slice(),a.columns=r.columns.slice(),a}W5(not(r)&&!iot(r)&&oot(r).length===2,"`orthonormalize` only works on matrices!"),W5(uot(r),"`orthonormalize` only works on matrices of numbers!");let e=q5(r),t=[];e.forEach(a=>{let i=eot(a);t.forEach(o=>{i=sot(i,lot(i,o))}),t.push(i)});let n=t.map(a=>rot(a,cot(a)));return q5(n)}V5.exports=U5});var G2=X((yft,H5)=>{function fot(r){if(typeof r!="string")throw new Error("`text` must be a string!");r=r.trim();let e="",t=!1;for(let n=0;n<r.length;n++){let a=r[n];a.match(/[A-Za-z0-9]/g)?(e.length===0?e+=a.toLowerCase():t?e+=a.toUpperCase():e+=a,t=!1):!a.includes("'")&&!a.includes("\u2019")&&!a.includes("\u275C")&&(t=!0)}return e}H5.exports=fot});var j5=X((bft,K5)=>{function hot(r,e){return e=e||"",r.split(`
`).map(t=>t.trim().length>0?e+t:t).join(`
`)}K5.exports=hot});var Y5=X((wft,X5)=>{X5.exports="!\"#%&'()*+,-./:;<=>?@[]^_`{|}~\xA0\xA1\xA4\xA7\xA9\xAA\xAB\xAE\xB0\xB1\xB6\xB7\xBA\xBB\xBF\xD7\xF7\u0254\u0300\u0301\u0302\u0303\u037E\u0387\u055A\u055B\u055C\u055D\u055E\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A\u066B\u066C\u066D\u06D4\u0700\u0701\u0702\u0703\u0704\u0705\u0706\u0707\u0708\u0709\u070A\u070B\u070C\u070D\u07F7\u07F8\u07F9\u0830\u0831\u0832\u0833\u0834\u0835\u0836\u0837\u0838\u0839\u083A\u083B\u083C\u083D\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04\u0F05\u0F06\u0F07\u0F08\u0F09\u0F0A\u0F0B\u0F0C\u0F0D\u0F0E\u0F0F\u0F10\u0F11\u0F12\u0F14\u0F3A\u0F3B\u0F3C\u0F3D\u0F85\u0FD0\u0FD1\u0FD2\u0FD3\u0FD4\u0FD9\u0FDA\u104A\u104B\u104C\u104D\u104E\u104F\u10FB\u1360\u1361\u1362\u1363\u1364\u1365\u1366\u1367\u1368\u1400\u166E\u169B\u169C\u16EB\u16EC\u16ED\u1735\u1736\u17D4\u17D5\u17D6\u17D8\u17D9\u17DA\u1800\u1801\u1802\u1803\u1804\u1805\u1806\u1807\u1808\u1809\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0\u1AA1\u1AA2\u1AA3\u1AA4\u1AA5\u1AA6\u1AA8\u1AA9\u1AAA\u1AAB\u1AAC\u1AAD\u1B5A\u1B5B\u1B5C\u1B5D\u1B5E\u1B5F\u1B60\u1BFC\u1BFD\u1BFE\u1BFF\u1C3B\u1C3C\u1C3D\u1C3E\u1C3F\u1C7E\u1C7F\u1CC0\u1CC1\u1CC2\u1CC3\u1CC4\u1CC5\u1CC6\u1CC7\u1CD3\u2010\u2011\u2012\u2013\u2014\u2015\u2016\u2017\u2018\u2019\u201A\u201B\u201C\u201D\u201E\u201F\u2020\u2021\u2022\u2023\u2024\u2025\u2026\u2027\u2030\u2031\u2032\u2033\u2034\u2035\u2036\u2037\u2038\u2039\u203A\u203B\u203C\u203D\u203E\u203F\u2040\u2041\u2042\u2043\u2045\u2046\u2047\u2048\u2049\u204A\u204B\u204C\u204D\u204E\u204F\u2050\u2051\u2052\u2053\u2054\u2055\u2056\u2057\u2058\u2059\u205A\u205B\u205C\u205D\u205E\u207D\u207E\u208D\u208E\u2116\u2117\u2120\u2122\u212E\u2212\u2234\u2235\u2248\u2300\u2308\u2309\u230A\u230B\u2311\u2329\u232A\u2380\u25CA\u25CC\u261E\u2640\u2642\u26A5\u2766\u2767\u2768\u2769\u276A\u276B\u276C\u276D\u276E\u276F\u2770\u2771\u2772\u2773\u2774\u2775\u27C5\u27C6\u27E6\u27E7\u27E8\u27E9\u27EA\u27EB\u27EC\u27ED\u27EE\u27EF\u2983\u2984\u2985\u2986\u2987\u2988\u2989\u298A\u298B\u298C\u298D\u298E\u298F\u2990\u2991\u2992\u2993\u2994\u2995\u2996\u2997\u2998\u29D8\u29D9\u29DA\u29DB\u29FC\u29FD\u2CF9\u2CFA\u2CFB\u2CFC\u2CFE\u2CFF\u2D70\u2E00\u2E01\u2E02\u2E03\u2E04\u2E05\u2E06\u2E07\u2E08\u2E09\u2E0A\u2E0B\u2E0C\u2E0D\u2E0E\u2E0F\u2E10\u2E11\u2E12\u2E13\u2E14\u2E15\u2E16\u2E17\u2E18\u2E19\u2E1A\u2E1B\u2E1C\u2E1D\u2E1E\u2E1F\u2E20\u2E21\u2E22\u2E23\u2E24\u2E25\u2E26\u2E27\u2E28\u2E29\u2E2A\u2E2B\u2E2C\u2E2D\u2E2E\u2E30\u2E31\u2E32\u2E33\u2E34\u2E35\u2E36\u2E37\u2E38\u2E39\u2E3A\u2E3B\u2E3C\u2E3D\u2E3E\u2E3F\u2E40\u2E41\u2E42\u2E43\u2E44\u2E45\u2E46\u2E47\u2E48\u2E49\u2E4A\u2E4B\u2E4C\u2E4D\u2E4E\u2E4F\u2E52\u3001\u3002\u3003\u3008\u3009\u300A\u300B\u300C\u300D\u300E\u300F\u3010\u3011\u3014\u3015\u3016\u3017\u3018\u3019\u301A\u301B\u301C\u301D\u301E\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D\uA60E\uA60F\uA673\uA67E\uA6F2\uA6F3\uA6F4\uA6F5\uA6F6\uA6F7\uA874\uA875\uA876\uA877\uA8CE\uA8CF\uA8F8\uA8F9\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1\uA9C2\uA9C3\uA9C4\uA9C5\uA9C6\uA9C7\uA9C8\uA9C9\uA9CA\uA9CB\uA9CC\uA9CD\uA9DE\uA9DF\uAA5C\uAA5D\uAA5E\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uD800\uD801\uD802\uD803\uD804\uD805\uD806\uD807\uD809\uD81A\uD81B\uD82F\uD836\uD83A\u{1F03B}\uDC41\uDC42\uDC43\uDC44\uDC45\uDC47\uDC48\uDC49\uDC4A\uDC4B\uDC4C\uDC4D\uDC4E\uDC4F\uDC57\uDC5A\uDC5B\uDC5D\uDC70\uDC71\uDC72\uDC73\uDC74\uDC9F\uDCBB\uDCBC\uDCBE\uDCBF\uDCC0\uDCC1\uDCC6\uDD00\uDD01\uDD02\uDD1F\uDD2F\uDD3F\uDD40\uDD41\uDD42\uDD43\uDD44\uDD45\uDD46\uDD5E\uDD5F\uDD6F\uDD74\uDD75\uDDC1\uDDC2\uDDC3\uDDC4\uDDC5\uDDC6\uDDC7\uDDC8\uDDC9\uDDCA\uDDCB\uDDCC\uDDCD\uDDCE\uDDCF\uDDD0\uDDD1\uDDD2\uDDD3\uDDD4\uDDD5\uDDD6\uDDD7\uDDDB\uDDDD\uDDDE\uDDDF\uDDE2\uDE38\uDE39\uDE3A\uDE3B\uDE3C\uDE3D\uDE3F\uDE40\uDE41\uDE42\uDE43\uDE44\uDE45\uDE46\uDE50\uDE51\uDE52\uDE53\uDE54\uDE55\uDE56\uDE57\uDE58\uDE60\uDE61\uDE62\uDE63\uDE64\uDE65\uDE66\uDE67\uDE68\uDE69\uDE6A\uDE6B\uDE6C\uDE6E\uDE6F\uDE7F\uDE87\uDE88\uDE89\uDE8A\uDE8B\uDE97\uDE98\uDE99\uDE9A\uDE9B\uDE9C\uDE9E\uDE9F\uDEA0\uDEA1\uDEA2\uDEA9\uDEAD\uDEF0\uDEF1\uDEF2\uDEF3\uDEF4\uDEF5\uDEF6\uDEF7\uDEF8\uDF37\uDF38\uDF39\uDF3A\uDF3B\uDF3C\uDF3D\uDF3E\uDF3F\uDF44\uDF55\uDF56\uDF57\uDF58\uDF59\uDF99\uDF9A\uDF9B\uDF9C\uDF9F\uDFD0\uDFE2\uDFFF\uFD3F\uFE10\uFE11\uFE12\uFE13\uFE14\uFE15\uFE16\uFE17\uFE18\uFE19\uFE30\uFE31\uFE32\uFE33\uFE34\uFE35\uFE36\uFE37\uFE38\uFE39\uFE3A\uFE3B\uFE3C\uFE3D\uFE3E\uFE3F\uFE40\uFE41\uFE42\uFE43\uFE44\uFE45\uFE46\uFE47\uFE48\uFE49\uFE4A\uFE4B\uFE4C\uFE4D\uFE4E\uFE4F\uFE50\uFE51\uFE52\uFE54\uFE55\uFE56\uFE57\uFE58\uFE59\uFE5A\uFE5B\uFE5C\uFE5D\uFE5E\uFE5F\uFE60\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01\uFF02\uFF03\uFF05\uFF06\uFF07\uFF08\uFF09\uFF0A\uFF0C\uFF0D\uFF0E\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B\uFF3C\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F\uFF60\uFF61\uFF62\uFF63\uFF64\uFF65"});var J5=X((xft,Z5)=>{function pot(r,e,t){if(typeof r!="string")throw new Error("`text` must be a string!");if(typeof e!="string")throw new Error("`a` must be a string!");if(typeof t!="string")throw new Error("`b` must be a string!");return r.split(e).join(t)}Z5.exports=pot});var H2=X((kft,tK)=>{var dot=Y5(),vot=J5(),Q5="  ",eK=" ";function mot(r){if(typeof r!="string")throw new Error("`text` must be a string!");let e="";for(let t=0;t<r.length;t++){let n=r[t].toLowerCase();dot.includes(n)?e+=eK:e+=n}for(;e.includes(Q5);)e=vot(e,Q5,eK);return e.trim()}tK.exports=mot});var nK=X((Sft,rK)=>{var got=H2();function yot(r){if(typeof r!="string")throw new Error("`text` must be a string!");let e=got(r).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("-")}rK.exports=yot});var iK=X((Nft,aK)=>{var{isArray:bot}=Tt(),wot=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:void 0;function xot(r){let e=Symbol.for("@TypedArrayConstructor"),t="Symbol(@TypedArrayConstructor)",n=e in r?e:t in r?t:void 0;if(n){if(!("values"in r))throw new Error("The value passed into the `convertObjectToTypedArray` must have a 'values' property!");return r[n]==="ArrayBuffer"?new Uint8Array(r.values).buffer:new wot[r[n]](r.values)}if(bot(r)&&r.constructor.name==="Array")return r;throw new Error("The value passed into the `convertObjectToTypedArray` must be an object that can be converted into a typed array!")}aK.exports=xot});var cK=X((Tft,uK)=>{var oK=iK(),sK={"@Infinity":1/0,"@NegativeInfinity":-1/0,"@NaN":NaN,"@undefined":void 0};function kot(r){function e(t){if(typeof t=="string"){if(t.trim().match(/^("|')?Symbol\(@String\).*?("|')?$/g))return t.trim().replace(/^("|')?Symbol\(@String\):/g,"").replace(/("|')?$/g,"");if(t.match(/^'?"?Symbol\(.*?\)"?'?$/g)){let a=t.replace(/^.*?Symbol\(/g,"").replace(/\).*?$/g,"");return a in sK?sK[a]:Symbol.for(a)}let n=t.trim();if(n.match(/^\/.*?\/(d|g|i|m|s|u|v|y)*?$/g))try{let a=n.replace(/^\//g,"").replace(/\/(d|g|i|m|s|u|v|y)*?$/g,""),i=n.match(/\/(d|g|i|m|s|u|v|y)*?$/g).at(-1).split("/").at(-1);return new RegExp(a,i)}catch{}if(t.trim().match(/^".*?"$/g))try{return JSON.parse(t)}catch{}try{let a=parseFloat(t);if(!isNaN(a)&&a.toString()===t)return a}catch{}try{let a=new Date(Date.parse(t));if(a.toString()!=="Invalid Date")return a}catch{}try{return JSON.parse(t,function(a,i){try{let o=e(i);return typeof o=="string"&&typeof e(o)!="string"?JSON.stringify(o):o}catch{return i}})}catch{return t}}if(typeof t=="object"){if(t===null)return null;try{return oK(t)}catch{Object.keys(t).concat(Object.getOwnPropertySymbols(t)).forEach(a=>{try{let i=a;try{a=e(a)}catch{}t[a]=e(t[i]),a!==i&&delete t[i]}catch{}});try{return oK(t)}catch{return t}}}return t}return e(r)}uK.exports=kot});var fK=X((Eft,lK)=>{var Sot=G2();function Not(r){let e=Sot(r);return e[0].toUpperCase()+e.slice(1)}lK.exports=Not});var pK=X((Ift,hK)=>{var Tot=H2();function Eot(r){if(typeof r!="string")throw new Error("`text` must be a string!");let e=Tot(r).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("_")}hK.exports=Eot});var vK=X((Cft,dK)=>{var{isArray:Iot,isDate:Cot}=Tt();function K2(r){if(r instanceof ArrayBuffer||r instanceof BigInt64Array||r instanceof BigUint64Array||r instanceof Float32Array||r instanceof Float64Array||r instanceof Int16Array||r instanceof Int32Array||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Uint32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray)return{[Symbol.for("@TypedArrayConstructor")]:r.constructor.name,values:r instanceof ArrayBuffer?Array.from(new Uint8Array(r)):Array.from(r)};if(Iot(r))return r.map(e=>{try{return K2(e)}catch{return e}});if(typeof r=="object"&r!==null){if(Cot(r))return new Date(r.getTime());let e={};return Object.keys(r).forEach(t=>{try{e[t]=K2(r[t])}catch{e[t]=r[t]}}),e}throw new Error("The value passed into the `convertTypedArrayToObject` function must be a typed array! Valid types include: ArrayBuffer, Float32Array, Float64Array, Int16Array, Int32Array, Int8Array, Uint16Array, Uint32Array, Uint8Array, and Uint8ClampedArray.")}dK.exports=K2});var gK=X((Aft,mK)=>{var{assert:Aot,decycle:Dot,isArray:_ot,isDate:Fot,isString:j2,isUndefined:Rot,range:Oot}=Tt(),X2=vK();function ms(r,e){return!r||e<=0?"":Oot(0,e).map(()=>r).join("")}function Pot(r,e){Aot(j2(e)||Rot(e),"The second parameter to the `stringify` function must be undefined or a string!");let t=e?`
`:"";function n(a,i,o){return o=o||0,typeof a=="number"||typeof a=="bigint"?a===1/0?'"Symbol(@Infinity)"':a===-1/0?'"Symbol(@NegativeInfinity)"':isNaN(a)?'"Symbol(@NaN)"':a.toString():typeof a=="string"?JSON.stringify("Symbol(@String):"+a):typeof a=="boolean"?a.toString():typeof a>"u"?'"Symbol(@undefined)"':typeof a=="symbol"||typeof a=="function"?JSON.stringify(a.toString()):a instanceof RegExp?a.toString():typeof a=="object"?a===null?"null":Fot(a)?JSON.stringify(a.toJSON()):_ot(a)?a.length===0?ms(i,o-1)+"[]":a instanceof Array?ms(i,o-1)+"["+t+a.map(s=>{let u=(()=>{try{return n(X2(s),i,o+1)}catch{return n(s,i,o+1)}})();return j2(u)&&(u=u.trim()),ms(i,o+1)+u}).join(","+t)+t+ms(i,o)+"]":n(X2(a),null,i):Object.keys(a).length+Object.getOwnPropertySymbols(a).length===0?ms(i,o-1)+"{}":ms(i,o-1)+"{"+t+Object.keys(a).concat(Object.getOwnPropertySymbols(a)).map(s=>{let u=(()=>{try{return n(X2(a[s]),i,o+1)}catch{return n(a[s],i,o+1)}})();j2(u)&&(u=u.trim());let c=typeof s=="symbol"?n(s):JSON.stringify(s);return ms(i,o+1)+c+":"+(i?" ":"")+u}).join(","+t)+t+ms(i,o)+"}":"undefined"}return n(Dot(r),e)}mK.exports=Pot});var bK=X((Dft,yK)=>{function Mot(r){let e=r.split(`
`),t=e.filter(a=>a.trim().length>0).map(a=>a.split("").findIndex(i=>!i.match(/\s/g))),n=Math.min(...t);return e.map(a=>a.substring(n)).join(`
`)}yK.exports=Mot});var xK=X((_ft,wK)=>{function Bot(r,e){if(typeof r!="string")throw new Error("The first argument to the `wrap` function must be a string!");if((typeof e>"u"||e===null)&&(typeof process<"u"&&typeof process.stdout<"u"&&typeof process.stdout.columns=="number"?e=process.stdout.columns>80?80:process.stdout.columns:e=80),isNaN(e)||typeof e!="number")throw new Error("The second argument to the `wrap` function must be undefined, null, or an integer!");let t=[];return r.split(`
`).forEach(n=>{if(n.trim().length===0)return t.push("");let a=n.split(/[^\s]/g)[0],i=n.replace(a,"").split(" "),o=a;i.forEach(s=>{let u=o+(o.trim().length>0?" ":"")+s;u.length>e?(t.push(o),o=a+s):o=u}),o.length>0&&t.push(o)}),t.join(`
`)}wK.exports=Bot});var kK=X((Fft,Y2)=>{var Yh={camelify:G2(),indent:j5(),kebabify:nK(),parse:cK(),pascalify:fK(),snakeify:pK(),stringify:gK(),unindent:bK(),wrap:xK(),dump(){Object.keys(Yh).forEach(r=>{typeof global<"u"&&(global[r]=Yh[r]),typeof window<"u"&&(window[r]=Yh[r])})}};typeof Y2<"u"&&(Y2.exports=Yh);typeof window<"u"&&(window.JSTextTools=Yh)});var AK=X((Rft,CK)=>{var{assert:yl,correl:SK,count:Lot,DataFrame:NK,inferType:zot,isArray:$ot,isDataFrame:Wot,isFunction:qot,isJagged:Uot,isNumber:Zh,isUndefined:TK,shape:Vot,sort:Got,sum:Hot}=Tt(),{stringify:Kot}=kK(),jot=T2(),EK=r=>Zh(r)&&(parseInt(r)===r||r===1/0);function IK(r,e){e=e||{};let t=Zh(e.maxUniqueValues)?e.maxUniqueValues:7,n=Zh(e.minNonMissingValues)?e.minNonMissingValues:15,a=Zh(e.maxCorrelationThreshold)?e.maxCorrelationThreshold:1-1e-5,i=e.progress||null;if($ot(r))return yl(Vot(r).length===2&&!Uot(r),"The `convertToNumerical` function only works on non-jagged 2-dimensional arrays and DataFrames!"),IK(new NK(r));yl(Wot(r),"You must pass a DataFrame into the `convertToNumerical` function!"),yl(EK(t),"`maxUniqueValues` must be a whole number!"),yl(EK(n),"`minNonMissingValues` must be a whole number!"),yl(Zh(a),"`maxCorrelationThreshold` must be a number!"),TK(i)||yl(qot(i),"If defined, `progress` must be a function!");let o={};return r.apply((s,u)=>{i&&i(u/r.columns.length);let c=zot(s.values);if(c.type==="boolean"&&(c.values=c.values.map(f=>f?1:0)),c.type==="date"&&(c.values=c.values.map(f=>{try{return f.getTime()}catch{return NaN}})),c.type==="null")return;c.type,c.type==="object"&&(c.values=c.values.map(f=>Kot(f))),c.type;let l=c.values.filter(f=>!TK(f));if(!(c.values.length-l.length>n)){if(c.type!=="boolean"){let f=Got(Lot(l),(p,d)=>d.count-p.count);if(Hot(f.slice(0,t).map(p=>p.count))/l.length>=.9){if(f.length<2)return;let p=jot(s.name,c.values);for(;Object.keys(p).length>0;){let d=Object.keys(p)[0],m=p[d];delete p[d];let v=Object.keys(o);for(let g=0;g<v.length;g++){let y=o[v[g]];if(SK(m,y)>a)return}o[d]=m}return}if(c.type==="object"||c.type==="string")return}if(c.type==="boolean"||c.type==="date"||c.type==="number"){let f=Object.keys(o);for(let h=0;h<f.length;h++){let p=o[f[h]];if(SK(c.values,p)>a)return}o[s.name]=c.values}}}),new NK(o)}CK.exports=IK});var zK=X((Oft,LK)=>{var{abs:Xot,add:Yot,assert:Jh,isArray:DK,isDataFrame:_K,isEqual:Zot,isSeries:FK,mean:Jot,pow:RK,scale:Qot,shape:OK,sign:est,sqrt:tst,sum:PK}=Tt(),MK=dl(),BK=(r,e)=>Yot(r,Qot(e,-1));function Z2(r,e){if(_K(r)||FK(r))return Z2(r.values,e);if(_K(e)||FK(e))return Z2(r,e.values);Jh(DK(r),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Jh(DK(e),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Jh(Zot(OK(r),OK(e)),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Jh(MK(r),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Jh(MK(e),"You must pass two same-shaped numerical arrays into the `rScore` function!");let t=PK(RK(BK(r,e),2)),n=PK(RK(BK(r,Jot(r)),2));if(n===0)return NaN;let a=1-t/n;return est(a)*tst(Xot(a))}LK.exports=Z2});var VK=X((Pft,UK)=>{var{argmax:$K,assert:Qh,copy:rst,DataFrame:nst,dot:ast,isArray:ist,isDataFrame:ost,isEqual:WK,isJagged:sst,isNumber:ust,reverse:cst,shape:lst,transpose:fst}=Tt();function qK(r){if(ist(r)){Qh(lst(r).length===2&&!sst(r),"The `sortCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!");let s=new nst(r);return s.index=s.columns.slice(),qK(s).values}Qh(ost(r),"You must pass a 2-dimensional array or DataFrame into the `sortCorrelationMatrix` function!");let e=r.copy(),t=[];e.values.forEach((s,u)=>{s.forEach((c,l)=>{ust(c)?Qh(c>=-1&&c<=1,"The correlation matrix passed into the `sortCorrelationMatrix` function must not contain values less than -1 or greater than 1!"):(t.push({row:e.index[u],col:e.columns[l],value:c}),e.values[u][l]=-1/0)})}),Qh(WK(e.values,fst(e.values)),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical!"),Qh(WK(e.index,e.columns),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical! (In this case, although the values themselves are symmetrical, the row and column names differ.)");let n=rst(e.index),a=[];for(;n.length>0;)if(a.length===0){let s=$K(e.values.map(u=>ast(u,u)));a.push(n[s]),n.splice(s,1)}else{let s=e.index.indexOf(a.at(-1)),u=$K(n.map(l=>e.values[e.index.indexOf(l)][s])),c=n[u];a.push(c),n.splice(u,1)}let i=cst(a),o=e.get(i,i);return t.forEach(s=>{let u=o.index.indexOf(s.row),c=o.columns.indexOf(s.col);o.values[u][c]=s.value,o.values[c][u]=s.value}),o}UK.exports=qK});var HK=X((Mft,GK)=>{var hst=q2();function pst(){return hst(...arguments)}GK.exports=pst});var tj=X((Bft,ej)=>{var{assert:ug,DataFrame:KK,dropNaN:dst,flatten:jK,isArray:vst,isDataFrame:J2,isSeries:Q2,mean:XK,range:mst,Series:YK,shape:ZK,stdev:JK,transpose:QK}=Tt(),gst=Gi(),eS=class{constructor(){let e=this;e.means=[],e.stdevs=[],e.wasFittedOnAVector=!1,e.hasBeenFitted=!1}_getDataArrayAndShape(e){if(J2(e))return[e.values,e.shape];if(Q2(e)){let n=QK([e.values]);return[n,ZK(n)]}ug(vst(e),"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!");let t=ZK(e);return ug(t.length<3,"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!"),t.length===1&&(t.push(1),e=QK([e])),[e,t]}fit(e){let t=this,n=t._getDataArrayAndShape(e);e=n[0];let a=n[1];return t.wasFittedOnAVector=a.indexOf(1)>-1,t.means=[],t.stdevs=[],mst(0,a[1]).forEach(i=>{let o=e.map(s=>s[i]);if(gst.shouldIgnoreNaNValues){let s=dst(o);t.means.push(XK(s)),t.stdevs.push(JK(s))}else t.means.push(XK(o)),t.stdevs.push(JK(o))}),t.hasBeenFitted=!0,t}transform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(J2(e)){let o=new KK(t.transform(e.values));return o.columns=e.columns,o.index=e.index,o}if(Q2(e)){let o=new YK(t.transform(e.values));return o.name=e.name,o.index=e.index,o}let n=t._getDataArrayAndShape(e);e=n[0];let a=n[1];ug(a[1]===t.means.length,"The data you passed into the `transform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>(s-t.means[u])/t.stdevs[u]));return t.wasFittedOnAVector?jK(i):i}untransform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(J2(e)){let o=new KK(t.untransform(e.values));return o.columns=e.columns,o.index=e.index,o}if(Q2(e)){let o=new YK(t.untransform(e.values));return o.name=e.name,o.index=e.index,o}let n=t._getDataArrayAndShape(e);e=n[0];let a=n[1];ug(a[1]===t.means.length,"The data you passed into the `untransform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>s*t.stdevs[u]+t.means[u]));return t.wasFittedOnAVector?jK(i):i}};ej.exports=eS});var tS=X((Lft,nj)=>{var{MathError:yst}=Tt(),rj={clipOutliers:fH(),cohensD:g2(),cohensd:g2(),common:Gi(),containsOnlyNumbers:dl(),diagonalize:SH(),getCorrelationMatrix:x2(),getHighlyCorrelatedColumns:FH(),getMagnitude:N2(),getOneHotEncodings:T2(),getPercentages:$H(),getPValueMatrix:t5(),IndexMatcher:o5(),isBinary:v2(),isCorrelationMatrix:k2(),KMeans:A5(),normalize:q2(),orthonormalize:G5(),convertToNumerical:AK(),project:V2(),pValue:I2(),rScore:zK(),sortCorrelationMatrix:VK(),standardize:HK(),StandardScaler:tj(),trainTestSplit:F2(),dump(){let r=this,e=typeof global<"u"?global:typeof window<"u"?window:null;if(!e)throw new yst("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(r).forEach(t=>{try{Object.defineProperty(e,t,{configurable:!1,enumerable:!0,writable:!1,value:r[t]})}catch{e[t]=r[t]}})}};try{window.JSDataScienceHelpers=rj}catch{}try{nj.exports=rj}catch{}});var nS=X((zft,sj)=>{var{add:bst,assert:Ou,isDataFrame:cg,isFunction:wst,isUndefined:aj,normal:xst,random:kst,scale:Sst,shape:ij}=Tt(),{isMatrix:lg,isTFTensor:bl}=hl(),{KMeansNaive:Nst}=tS().KMeans,{sse:oj}=p2(),ko=Kh(),rS=class extends Nst{initializeCentroids(e){return cg(e)&&(e=e.values),bl(e)&&(e=e.arraySync()),ko.tensor(super.initializeCentroids(e))}getFitStepFunction(e,t){let n=this;cg(e)&&(e=e.values),bl(e)&&(e=e.arraySync()),Ou(lg(e),"`x` must be a matrix!"),aj(t)||Ou(wst(t),"If defined, `progress` must be a function!");let a=[],i=c=>(a.push(c),c),o=i(ko.tensor(e)),s=i(n.initializeCentroids(e)),u={currentRestart:0,currentIteration:0,currentCentroids:s,bestCentroids:s,bestScore:-1/0,isFinished:!1};return function(){try{let l=n.predict(o,u.currentCentroids),f=u.currentCentroids.arraySync(),h=[];for(let d=0;d<n.k;d++){let m=[];if(l.forEach((v,g)=>{v===d&&m.push(g)}),m.length===0)h.push(bst(f[parseInt(kst()*f.length)],Sst(.01,xst(e[0].length))));else{let v=i(o.gather(m));h.push(i(v.mean(0)))}}if(h=i(ko.stack(h)),oj(u.currentCentroids,h)<n.tolerance&&(u.currentIteration=n.maxIterations-1),u.currentIteration++,u.currentIteration>=n.maxIterations){u.currentRestart++;let d=n.score(o,h);d>u.bestScore&&(u.bestScore=d,u.bestCentroids=i(h.clone())),u.currentIteration=0,u.currentRestart>=n.maxRestarts?u.isFinished=!0:u.currentCentroids=i(n.initializeCentroids(e))}else u.currentCentroids=i(h.clone());return u.isFinished?(n.centroids=u.bestCentroids.arraySync(),u={isFinished:!0},a.forEach(d=>{try{d.dispose()}catch{}}),t&&t(1,n)):t&&t((u.currentRestart+u.currentIteration/n.maxIterations)/n.maxRestarts,n),u}catch(l){throw a.forEach(f=>{try{f.dispose()}catch{}}),l}}}fit(e,t){let n=this,a=n.getFitStepFunction(e,t),i;for(;!i||!i.isFinished;)i=a();return n}predict(e,t){let n=this;return ko.tidy(()=>{bl(e)&&(e=e.arraySync()),cg(e)&&(e=e.values),Ou(lg(e),"`x` must be a matrix!"),t=t||n.centroids,bl(t)||(t=ko.tensor(t)),Ou(ij(e)[1]===t.shape[1],"`x` and `centroids` must have the same number of columns!");let a=ko.tensor(e).expandDims(1),i=t.expandDims(0);return a.sub(i).pow(2).sum(2).argMin(1).arraySync()})}score(e,t){let n=this;return ko.tidy(()=>{bl(e)&&(e=e.arraySync()),cg(e)&&(e=e.values),Ou(lg(e),"`x` must be a matrix!"),t=t||n.centroids,bl(t)||(t=ko.tensor(t)),Ou(lg(t)||aj(t),"`centroids` must be a matrix or undefined!"),Ou(ij(e)[1]===t.shape[1],"`x` and `centroids` must have the same number of columns!");let a=ko.tensor(e),i=n.predict(a,t),o=t.gather(i).arraySync();return-oj(a,o)})}};sj.exports=rS});var oS=X(($ft,cj)=>{var{assert:Tst,int:uj,random:aS}=Tt(),{isMatrix:Est}=hl(),wl=Kh(),Ist=nS(),iS=class extends Ist{initializeCentroids(e){Tst(Est(e),"`x` must be a matrix!");let t=this;return wl.tidy(()=>{let n=wl.tensor(e),a=[uj(aS()*e.length)];for(;a.length<t.k;){let i=a.map(l=>e[l]),o=wl.tensor(t.predict(e,i),null,"int32"),s=wl.tidy(()=>wl.tensor(i).gather(o).sub(n).pow(2).sum(1)),u=s.div(s.max()).arraySync(),c=0;for(let l=0;l<1e4;l++){c=uj(aS()*u.length);let f=u[c];if(aS()<f)break}a.push(c)}return wl.tensor(a.map(i=>e[i]))})}};cj.exports=iS});var hj=X((Wft,fj)=>{var{assert:Cst,isEqual:Ast,shape:lj}=Tt(),{KMeansMeta:Dst}=tS().KMeans,{isTFTensor:_st}=hl(),Fst=oS(),sS=class extends Dst{constructor(e){super(e);let t=this;e=e||{},t.modelClass=e.modelClass||Fst}get centroids(){let e=this;return e.fittedModel?e.fittedModel.centroids:e._fitState.bestCentroids}set centroids(e){let t=this;_st(e)&&(e=e.arraySync());let n=lj(e);if(t.centroids){let a=t.centroids,i=lj(a);Cst(Ast(n,i),`The new centroids must have the same shape as the old centroids! (expected: [${i.join(", ")}], received: [${n.join(", ")}])`)}t.fittedModel||(t.fittedModel=new t.modelClass({k:n[0],maxIterations:t.maxIterations,maxRestarts:t.maxRestarts,tolerance:t.tolerance})),t.fittedModel.centroids=e}};fj.exports=sS});var dj=X((qft,pj)=>{pj.exports={TFKMeansMeta:hj(),TFKMeansNaive:nS(),TFKMeansPlusPlus:oS()}});var Rst=X((Uft,uS)=>{var vj={helpers:hl(),metrics:p2(),models:dj()};typeof uS<"u"&&(uS.exports=vj);typeof window<"u"&&(window.TFKMeans=vj)});Rst();})();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2024 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/** @license See the LICENSE file. */
