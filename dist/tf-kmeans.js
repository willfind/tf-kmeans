(()=>{var y5=Object.defineProperty;var b5=(n,e,t)=>e in n?y5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var F2=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});var Y=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Ym=(n,e,t)=>(b5(n,typeof e!="symbol"?e+"":e,t),t);var _u=Y((lrt,R2)=>{var w5=new Function(`
  try {
    return this === window
  } catch(e) {}

  try {
    return typeof importScripts !== "undefined"
  } catch(e) {}

  return false
`),Zm=class extends Error{constructor(e){w5()?super(e):super(`

\x1B[31m`+e+`
\x1B[0m`)}};R2.exports=Zm});var qe=Y((frt,O2)=>{var x5=_u();O2.exports=function(n,e){if(!n)throw new x5(e)}});var Ue=Y((hrt,P2)=>{function k5(n){try{return n instanceof Array||typeof n.constructor<"u"&&n.constructor.name==="Array"}catch{return!1}}P2.exports=k5});var lt=Y((drt,M2)=>{function S5(n){try{return!!n._symbol&&n._symbol===Symbol.for("@jrc03c/js-math-tools/dataframe")}catch{return!1}}M2.exports=S5});var Tr=Y((prt,B2)=>{function N5(n){return typeof n=="function"}B2.exports=N5});var nt=Y((vrt,L2)=>{function T5(n){return typeof n=="number"&&!isNaN(n)}L2.exports=T5});var yt=Y((mrt,z2)=>{function E5(n){return n===null||typeof n>"u"}z2.exports=E5});var mo=Y((grt,$2)=>{var I5=Ue(),C5=yt();function A5(n){return typeof n=="object"&&!C5(n)&&!I5(n)}$2.exports=A5});var ut=Y((yrt,q2)=>{function _5(n){try{return!!n._symbol&&n._symbol===Symbol.for("@jrc03c/js-math-tools/series")}catch{return!1}}q2.exports=_5});var bl=Y((brt,G2)=>{var D5=qe(),W2=Ue(),F5=lt(),R5=Tr(),Jm=nt(),V2=mo(),O5=ut();function Qm(n,e){if(F5(n)){let i=Qm(n.values,e);return i.length>0&&Jm(i[0])&&i[0]>=0&&i[0]<n.index.length&&(i[0]=n.index[i[0]]),i.length>1&&Jm(i[1])&&i[1]>=0&&i[1]<n.columns.length&&(i[1]=n.columns[i[1]]),i}if(O5(n)){let i=Qm(n.values,e);return i.length>0&&Jm(i[0])&&i[0]>=0&&i[0]<n.index.length&&(i[0]=n.index[i[0]]),i}if(D5(V2(n)||W2(n),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `indexOf` function!"),!R5(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(V2(i)){s.push(i);let u=Object.keys(i);for(let c=0;c<u.length;c++){let l=u[c],f=i[l];if(o(f))return[l];let h=t(f,o,s);if(h&&h.length>0)return[l].concat(h)}}else if(W2(i)){s.push(i);for(let u=0;u<i.length;u++){let c=i[u];if(o(c))return[u];let l=t(c,o,s);if(l&&l.length>0)return[u].concat(l)}}else if(o(i))return[];return null}function r(i){try{return e(i)}catch{return!1}}let a=t(n,r);return a&&a.length>0?a:null}G2.exports=Qm});var Ti=Y((wrt,X2)=>{var P5=bl(),U2=Ue(),H2=lt(),K2=ut();function Du(n){try{return structuredClone(n)}catch{if(typeof n=="object"){if(n===null)return null;if(U2(n))return n.map(r=>Du(r));if(K2(n)){let r=n.copy();return r.values=Du(r.values),r}if(H2(n)){let r=n.copy();return r.values=Du(n.values),r}n=j2(n);let t={};return Object.keys(n).forEach(r=>{t[r]=Du(n[r])}),t}else return n}}function j2(n){function e(a,i,o){if(i=i||[],o=o||"",i.indexOf(a)>-1){let s=o.split("/").slice(o.startsWith("/")?1:0);if(s.some((c,l)=>{let f=s.slice(0,s.length-l-1),h=t;return f.forEach(d=>{h=h[d]}),h===a}))return`<reference to "${t===a?"/":"/"+P5(t,a).join("/")}">`}return typeof a=="object"?a===null?null:(i.push(a),U2(a)?a.map((s,u)=>e(s,i,o+"/"+u)):(Object.keys(a).forEach(s=>{a[s]=e(a[s],i,o+"/"+s)}),a)):a}let t=Du(n),r=e(t);if(H2(n)){let a=n.copy();a._values=r.values,a._columns=r.columns,a._index=r.index,r=a}if(K2(n)){let a=n.copy();a.name=r.name,a._values=r.values,a._index=r.index,r=a}return r}X2.exports={copy:Du,decycle:j2}});var pn=Y((xrt,J2)=>{var{copy:M5}=Ti(),B5=qe(),Y2=Ue(),L5=lt(),z5=ut();function Z2(n){if(L5(n)||z5(n))return Z2(n.values);B5(Y2(n),"The `flatten` function only works on arrays, Series, and DataFrames!");function e(t){let r=[];return M5(t).forEach(a=>{Y2(a)?r=r.concat(e(a)):r.push(a)}),r}return e(n)}J2.exports=Z2});var Qa=Y((krt,eS)=>{var{decycle:Q2}=Ti();function $5(n,e){function t(r,a){let i=typeof r;if(i!==typeof a)return!1;if(i==="undefined")return!0;if(i==="boolean"||i==="symbol")return r===a;if(i==="number"||i==="bigint")return r.toString()==="NaN"&&a.toString()==="NaN"?!0:r===a;if(i==="string"||i==="function")return r===a;if(i==="object"){if(r===null||a===null)return r===null&&a===null;{let s=Object.keys(r),u=Object.keys(a);if(s.length!==u.length)return!1;for(let c=0;c<s.length;c++){let l=s[c];if(!t(r[l],a[l]))return!1}return!0}}}try{return n instanceof Date&&e instanceof Date?n.getTime()===e.getTime():t(n,e)}catch{return t(Q2(n),Q2(e))}}eS.exports=$5});var ei=Y((Srt,aS)=>{var q5=qe(),W5=pn(),V5=Ue(),tS=lt(),G5=Tr(),nS=ut(),U5=yt();function wl(n){let e="abcdefg1234567890",t="";for(;t.length<n;)t+=e[parseInt(Math.random()*e.length)];return t}var H5=wl(256),K5=wl(256),j5=wl(256),X5=wl(256),Y5=wl(256);function rS(n){if(tS(n)||nS(n))return rS(n.values);q5(V5(n),"The `set` function only works on arrays, Series, and DataFrames!");let e=[],t={};return W5(n).forEach(r=>{let a=typeof r=="object"&&r===null?H5:U5(r)?K5:G5(r)?r.toString():typeof r=="symbol"?r.toString()+" - "+Y5:r===1/0?j5:r===-1/0?X5:tS(r)?r.toJSONString():nS(r)?JSON.stringify(r.toObject()):JSON.stringify(r);t[a]||e.push(r),t[a]=!0}),e}aS.exports=rS});var xl=Y((Nrt,sS)=>{var Z5=qe(),eg=pn(),iS=Ue(),J5=lt(),oS=Qa(),Q5=Tr(),eK=ut(),tK=ei();function Jh(n,e){if(J5(n)||eK(n))return arguments.length>1?Jh(n.values,e):Jh(n.values,n.values);if(Z5(iS(n),"The first argument to the `count` function must be an array, Series, or DataFrame!"),Q5(e))return eg(n).filter(t=>e(t)).length;if(iS(e)){let t=eg(n);return tK(e).map(r=>({item:r,count:t.filter(a=>oS(a,r)).length}))}else return arguments.length>1?eg(n).filter(t=>oS(t,e)).length:Jh(n,n)}sS.exports=Jh});var kl=Y((Trt,cS)=>{var nK=qe(),uS=Ue(),rK=lt(),aK=ut();function tg(n){if(rK(n)||aK(n))return tg(n.values);nK(uS(n),"The `isJagged` function only works on arrays, Series, and DataFrames!");let e=0,t=null;for(let r=0;r<n.length;r++)if(uS(n[r])){if(e++,tg(n[r]))return!0;if(t===null)t=n[r].length;else if(n[r].length!==t)return!0}return e>0&&e<n.length}cS.exports=tg});var Qh=Y((Ert,hS)=>{var iK=qe(),lS=Ue(),oK=lt(),sK=ut();function fS(n){if(oK(n)||sK(n))return fS(n.values);iK(lS(n),"The `isNested` function only works on arrays, Series, and DataFrames!");for(let e=0;e<n.length;e++)if(lS(n[e]))return!0;return!1}hS.exports=fS});var go=Y((Irt,pS)=>{var cs=qe(),uK=Ue(),cK=Qh(),lK=nt(),fK=yt(),Fu="You must pass a natural number or a one-dimensional array of natural numbers into the `ndarray` function!";function dS(n){cs(!fK(n),Fu),uK(n)||(n=[n]),cs(!cK(n),Fu),cs(n.length>0,Fu);let e=n[0];if(cs(lK(e),Fu),cs(parseInt(e)===e,Fu),cs(e>=0,Fu),cs(e!==1/0,"We can't create an array containing an infinite number of values!"),n.length===1){let t=[];for(let r=0;r<e;r++)t.push(void 0);return t}else{let t=[];for(let r=0;r<e;r++)t.push(dS(n.slice(1)));return t}}pS.exports=dS});var Sl=Y((Crt,vS)=>{var hK=qe(),dK=Ue(),pK=lt(),vK=ut();function ng(n){if(pK(n)||vK(n)){let t=n.copy();return t.values=ng(t.values),t.index=ng(t.index),t}hK(dK(n),"The `reverse` function only works on arrays, Series, and DataFrames!");let e=[];for(let t=n.length-1;t>=0;t--)e.push(n[t]);return e}vS.exports=ng});var sa=Y((Art,mS)=>{var rg=qe(),ag=nt(),ig=yt(),mK=Sl();function gK(n,e,t=1){rg(!ig(n)&&!ig(e)&&!ig(t),"You must pass two numbers and optionally a step value to the `range` function!"),rg(ag(n)&&ag(e)&&ag(t),"You must pass two numbers and optionally a step value to the `range` function!"),rg(t>0,"The step value must be greater than 0! (NOTE: The step value is a magnitude; it does not indicate direction.)");let r=!1;if(n>e){r=!0;let i=n;n=e+t,e=i+t}let a=[];for(let i=n;i<e;i+=t)a.push(i);return r&&(a=mK(a)),a}mS.exports=gK});var on=Y((_rt,wS)=>{var yK=qe(),gS=Ue(),bK=lt(),wK=Qa(),xK=ut(),kK=yt();function yS(n){if(!gS(n))return;let e=[n.length],t=0,r=n.map(a=>{let i=yS(a);return kK(i)?i:(t++,i.length===1?i[0]:i)});return t>0?t===n.length&&r.slice(0,-1).every((i,o)=>wK(i,r[o+1]))?e.concat(r[0]):(e.push(r),e):e}function bS(n){return bK(n)||xK(n)?bS(n.values):(yK(gS(n),"The `shape` function only works on arrays, Series, and DataFrames!"),yS(n))}wS.exports=bS});var ES=Y((Drt,TS)=>{var xS=qe(),SK=Ue(),NK=lt(),TK=kl(),EK=ut(),IK=yt(),kS=_u(),ed=go(),SS=sa(),CK=ei(),AK=on();function NS(n,e,t){if(IK(t)&&(t=0),xS(t===0||t===1||t==="vertical"||t==="horizontal",'The only valid axis values for use when appending data to a DataFrame are 0, 1, "vertical", and "horizontal". Note that 0 == "horizontal" and 1 == "vertical".'),SK(e)){xS(!TK(e),"The array of data you're trying to append to this DataFrame is jagged!");let r=AK(e);if(r.length===1)if(t===0){let a=n.copy();a._values.push(e);let i=Math.max(n.shape[1],r[0]);for(a._values.forEach(o=>{for(;o.length<i;)o.push(void 0)});a._index.length<a._values.length;)a._index.push("row"+a._index.length);for(;a._columns.length<i;)a._columns.push("col"+a._columns.length);return a}else{let a=Math.max(n.shape[0],r[0]),i=n.copy();for(SS(0,a).forEach(o=>{o>=i._values.length&&i._values.push(ed(n.shape[1])),i._values[o].push(e[o])});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<i._values[0].length;)i._columns.push("col"+i._columns.length);return i}else if(r.length===2)if(t===0){let a=Math.max(...e.map(o=>o.length).concat([n.shape[1]])),i=n.copy();for(i._values=i._values.concat(e).map(o=>{for(;o.length<a;)o.push(void 0);return o});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<a;)i._columns.push("col"+i._columns.length);return i}else{let a=Math.max(...e.map(s=>s.length))+n.shape[1],i=Math.max(n.shape[0],r[0]),o=n.copy();for(SS(0,i).forEach(s=>{for(s>=o._values.length&&o._values.push(ed(n.shape[1])),o._values[s]=o._values[s].concat(e[s]);o._values[s].length<a;)o._values[s].push(void 0)});o._index.length<o._values.length;)o._index.push("row"+o._index.length);for(;o._columns.length<a;)o._columns.push("col"+o._columns.length);return o}else throw new kS("Only 1- and 2-dimensional arrays can be appended to a DataFrame!")}else if(EK(e)){let r=NS(n,e.values,t);return t===0?r.index[r.index.length-1]=r.index.indexOf(e.name)>-1?e.name+" (2)":e.name:r.columns[r.columns.length-1]=r.columns.indexOf(e.name)>-1?e.name+" (2)":e.name,r}else if(NK(e))if(t===0){let r=n.copy(),a=CK(r._columns.concat(e._columns)).length;for(r._values.forEach(i=>{for(;i.length<a;)i.push(void 0)}),e.apply(i=>{let o=i.copy(),s=[];r._columns.forEach(u=>{let c=o._index.indexOf(u);c>-1?(s.push(o._values[c]),o._values.splice(c,1),o._index.splice(c,1)):s.push(void 0)}),r._values.push(s.concat(o._values))},1),r._columns=r._columns.concat(e._columns.filter(i=>r._columns.indexOf(i)<0));r._index.length<r._values.length;){let i="row"+r._index.length;r._index.push(i+(n._index.indexOf(i)>-1?" (2)":""))}return r}else{let r=n.copy();return r._index.forEach((a,i)=>{let o=e._index.indexOf(a);o>-1?r._values[i]=r._values[i].concat(e._values[o]):r._values[i]=r._values[i].concat(ed(e.shape[1]))}),e._index.forEach((a,i)=>{r._index.indexOf(a)<0&&(r._index.push(a),r._values.push(ed(r._columns.length).concat(e._values[i])))}),r._columns=r._columns.concat(e._columns.map(a=>a+(r._columns.indexOf(a)>-1?" (2)":""))),r}else throw new kS("Only 1- or 2-dimensional arrays, Series, and DataFrames can be appended to a DataFrame!")}TS.exports=NS});var DS=Y((Frt,_S)=>{var IS=qe(),CS=Ue(),_K=Tr(),AS=yt();function DK(n,e,t,r,a){if(a=a||0,IS(_K(r),"The first parameter to the `apply` method must be a function."),IS(a===0||a===1,"The second parameter to the `apply` method (the `axis`) must be 0 or 1."),a===0){let i={},o;if(t.columns.forEach((s,u)=>{let c=new e(t.values.map(f=>f[u]));c.name=s,c.index=t.index;let l=r(c,u,t);l instanceof e?i[s]=l.values:i[s]=l,AS(o)&&(o=l instanceof e||CS(l))}),o){let s=new n(i);return s.index=t.index,s}else{let s=new e(t.columns.map(u=>i[u]));return s.index=t.columns,s}}else if(a===1){let i,o=t.values.map((s,u)=>{let c=new e(s);c.name=t.index[u],c.index=t.columns;let l=r(c,u,t);return AS(i)&&(i=l instanceof e||CS(l)),l instanceof e?l.values:l});if(i){let s=new n(o);return s.index=t.index,s.columns=t.columns,s}else{let s=new e(o);return s.index=t.index,s}}}_S.exports=DK});var Lr=Y((Rrt,FS)=>{function FK(n){return typeof n=="string"}FS.exports=FK});var PS=Y((Ort,OS)=>{var RS=qe(),RK=Ue(),OK=kl(),PK=mo(),MK=Lr(),BK=yt(),LK=_u(),zK=on();function $K(n,e,t,r,a){let i=s=>s instanceof n,o=s=>s instanceof e;if(BK(a)){if(i(r))return t.append(r,1);if(o(r))return t.append(r,1);if(PK(r)){let s=Math.max(...Object.keys(r).map(u=>r[u].length));return Object.keys(r).forEach(u=>{for(;r[u].length<s;)r[u].push(void 0)}),t.append(new n(r),1)}else throw new LK("You must pass a DataFrame, Series, or object into the `assign` method!")}else{RS(MK(r),"If passing two arguments into the `assign` method, then the first argument must be a string name!"),RS(RK(a)&&!OK(a)&&zK(a).length===1,"If passing two arguments into the `assign` method, then the second argument must be a 1-dimensional array!");let s=t.append(a,1);return s.columns[s.columns.length-1]=r,s}}OS.exports=$K});var BS=Y((Prt,MS)=>{var{copy:qK}=Ti();function WK(n,e){if(e.isEmpty)return new n;let t=new n(qK(e.values));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}MS.exports=WK});var GS=Y((Mrt,VS)=>{var td=qe(),LS=Ue(),zS=nt(),$S=Lr(),qS=yt(),WS=on();function VK(n,e,t,r,a){qS(r)&&(r=[]),qS(a)&&(a=[]),($S(r)||zS(r))&&(r=[r]),($S(a)||zS(a))&&(a=[a]),td(LS(r),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),td(LS(a),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),td(WS(r).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),td(WS(a).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings.");let i,o;t.index.forEach((u,c)=>{r.indexOf(u)<0&&r.indexOf(c)<0&&(i||(i=[]),i.push(u))}),t.columns.forEach((u,c)=>{a.indexOf(u)<0&&a.indexOf(c)<0&&(o||(o=[]),o.push(u))});let s=t.get(i,o);if(s instanceof e){let u=new n;u=u.assign(s),t.index.indexOf(s.name)>-1&&(u=u.transpose()),s=u}return s}VS.exports=VK});var Nl=Y((Brt,US)=>{var GK=nt();function UK(n){return GK(n)&&parseInt(n)===n}function HK(n){return UK(n)&&n>=0}US.exports=HK});var KS=Y((Lrt,HS)=>{var og=qe(),KK=Lr(),nd=yt(),jK=Nl(),XK=on();function YK(n,e,t,r,a,i){r=r||0,og(r===0||r===1,"The first parameter of the `dropMissing` method (the `axis`) must be 0 or 1."),i=i||0,og(jK(i),"The third parameter of the `dropMissing` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` null values)."),a=i>0?"none":a||"any",og(a==="any"||a==="all"||a==="none","The second parameter of the `dropMissing` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains null values, then it should be dropped; or that if 'all' of the data contains null values, then it should be dropped).");function o(c){if(i>0){let l=0;for(let f=0;f<c.length;f++){let h=c[f];if(nd(h)&&l++,l>=i)return[]}}else if(a==="any")for(let l=0;l<c.length;l++){let f=c[l];if(nd(f))return[]}else if(a==="all"){for(let l=0;l<c.length;l++){let f=c[l];if(!nd(f))return c}return[]}return c}let s=t.copy(),u=Math.random().toString();if(r===0){s=s.assign(u,s.index);let c=s.values.map(o).filter(f=>f.length>0);if(XK(c).length<2)return new n;s.values=c;let l=s.get(null,u);if(nd(l))return new n;KK(l)&&(l=[l]),l instanceof e&&(l=l.values),s.index=l,s=s.drop(null,u)}else if(r===1){let c={};if(s.columns.forEach((f,h)=>{let d=s.values.map(v=>v[h]),p=o(d);p.length>0&&(c[f]=p)}),Object.keys(c).length===0)return new n;let l=new n(c);return l.index=s.index,l}return s}HS.exports=YK});var sg=Y((zrt,XS)=>{var ZK=qe(),JK=Ue(),QK=lt(),ej=nt(),tj=ut();function jS(n){if(QK(n)||tj(n))return n.dropNaN(...Object.values(arguments).slice(1));ZK(JK(n),"The `dropNaN` function only works on arrays, Series, and DataFrames!");let e=[];return n.forEach(t=>{try{return e.push(jS(t))}catch{if(ej(t))return e.push(t)}}),e}XS.exports=jS});var ZS=Y(($rt,YS)=>{var ug=qe(),nj=sg(),rj=Nl();function aj(n,e,t,r,a){t=t||0,ug(t===0||t===1,"The first parameter of the `dropNaN` method (the `axis`) must be 0 or 1."),a=a||0,ug(rj(a),"The third parameter of the `dropNaN` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` NaN values)."),r=a>0?"none":r||"any",ug(r==="any"||r==="all"||r==="none","The second parameter of the `dropNaN` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains NaN values, then it should be dropped; or that if 'all' of the data contains NaN values, then it should be dropped).");function i(s){let u=nj(s);return a>0?s.length-u.length<a:r==="any"?u.length===s.length:r==="all"?u.length>0:!0}let o=e.copy();if(t===0){let s=o.index.filter(u=>{let c=o.get(u,null).values;return i(c)});return s.length>0?o.get(s,null):new n}else if(t===1){let s=o.columns.filter(u=>{let c=o.get(null,u).values;return i(c)});return s.length>0?o.get(null,s):new n}return o}YS.exports=aj});var tN=Y((qrt,eN)=>{var JS=qe(),Tl=pn(),ij=Tr(),oj=yt();function QS(n){let e={};return Tl(n).forEach((t,r)=>{e[t]=r}),e}function Ru(n){return Object.keys(n).sort((e,t)=>n[e]-n[t])}function sj(n,e,t,r,a){JS(ij(r),"The `filter` method takes a single parameter: a function that is used to filter the values."),oj(a)&&(a=0),JS(a===0||a===1,"The `axis` parameter to the `filter` method must be 0 or 1.");let i=t.copy();if(i.isEmpty)return i;let o=QS(i.index),s=QS(i.columns);if(a===0){let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.index[l],f.index=t.columns;let h=r(f,l,t);return h||delete o[i.index[l]],h});if(Tl(u).length===0)return new n;if(u.length===1){let c=new e(Tl(u));return c.name=Ru(o)[0],c.index=Ru(s),c}i.values=u,i.index=Ru(o)}else if(a===1){i=i.transpose();let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.columns[l],f.index=t.index;let h=r(f,l,t);return h||delete s[i.index[l]],h});if(Tl(u).length===0)return new n;if(u.length===1){let c=new e(Tl(u));return c.name=Ru(s)[0],c.index=Ru(o),c}i.values=u,i.index=Ru(s),i=i.transpose()}return i}eN.exports=sj});var aN=Y((Wrt,rN)=>{var Na=qe(),rd=nt(),ad=Lr(),nN=yt(),uj=ei();function cj(n,e,t){(ad(e)||rd(e))&&(e=[e]),(ad(t)||rd(t))&&(t=[t]);let r=uj((e||[]).concat(t||[]).map(a=>typeof a));return Na(r.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),r.length===1&&Na(r[0]==="string"||r[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),r.length===2&&(Na(r.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Na(r.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),nN(e)||(e=e.map(a=>{if(ad(a))return Na(n.index.indexOf(a)>-1,`Row "${a}" does not exist!`),a;if(rd(a))return Na(a>=0,`Index ${a} is out of bounds!`),Na(parseInt(a)===a,"Row numbers must be integers!"),Na(a<n.index.length,`Index ${a} is out of bounds!`),n.index[a]})),nN(t)||(t=t.map(a=>{if(ad(a))return Na(n.columns.indexOf(a)>-1,`Column "${a}" does not exist!`),a;if(rd(a))return Na(a>=0,`Column ${a} is out of bounds!`),Na(parseInt(a)===a,"Column numbers must be integers!"),Na(a<n.columns.length,`Column ${a} is out of bounds!`),n.columns[a]})),n.getSubsetByNames(e,t)}rN.exports=cj});var yo=Y((Vrt,oN)=>{var iN=qe(),lj=Ue(),fj=lt(),hj=Tr(),dj=ut(),pj=yt();function vj(n,e){try{return n<e?-1:n>e?1:0}catch{return n=typeof n=="object"&&n!==null?JSON.stringify(n):n.toString(),e=typeof e=="object"&&e!==null?JSON.stringify(e):e.toString(),n<e?-1:n>e?1:0}}function mj(n,e){if(pj(e)&&(e=vj),fj(n)||dj(n))return n.sort(...Object.values(arguments).slice(1));iN(lj(n),"The `sort` function only works on arrays, Series, and DataFrames!"),iN(hj(e),"The second parameter of the `sort` function must be a comparison function!");let t=n.slice();return t.sort(e),t}oN.exports=mj});var lN=Y((Grt,cN)=>{var sN=qe(),uN=Lr(),gj=yt(),yj=ei(),bj=yo();function wj(n){let e=n.toLowerCase(),t="";for(let a=0;a<e.length;a++){let i=e[a];i.match(/[a-z0-9]/g)?t+=i:t+=" "}let r=t.split(" ").filter(a=>a.length>0);return r[0]+r.slice(1).map(a=>a[0].toUpperCase()+a.substring(1)).join("")}function xj(n,e,t){gj(t)?t=e.columns:uN(t)&&(t=[t]);let r={};t.forEach(i=>{sN(uN(i),"You must pass either a string or a one-dimensional array of strings into the `getDummies` (AKA `oneHotEncode`) method!");let o=e.columns.indexOf(i);sN(o>-1,`The given DataFrame does not have a column called "${i}"!`);let s=e.values.map(c=>c[o]),u=bj(yj(s));s.forEach(c=>{u.forEach(l=>{let f=i+"_"+wj(l.toString());r[f]||(r[f]=[]),c===l?r[f].push(1):r[f].push(0)})})});let a=new n(r);return a.index=e.index,a}cN.exports=xj});var yN=Y((Urt,gN)=>{var bo=qe(),fN=Ue(),hN=nt(),dN=yt(),pN=Nl(),vN=sa(),mN=on();function kj(n,e,t){let r=n.shape;dN(e)&&(e=vN(0,r[0])),dN(t)&&(t=vN(0,r[1])),hN(e)&&(e=[e]),hN(t)&&(t=[t]),bo(fN(e)&&fN(t),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),bo(mN(e).length===1&&mN(t).length===1,"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),bo(e.length>0,"The `rowIndices` array must contain at least one index."),bo(t.length>0,"The `colIndices` array must contain at least one index."),e.forEach(o=>{bo(pN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),bo(o<n.index.length,`The row index ${o} is out of bounds.`)}),t.forEach(o=>{bo(pN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),bo(o<n.columns.length,`The column index ${o} is out of bounds.`)});let a=e.map(o=>n.index[o]),i=t.map(o=>n.columns[o]);return n.getSubsetByNames(a,i)}gN.exports=kj});var SN=Y((Hrt,kN)=>{var wo=qe(),cg=pn(),bN=Ue(),id=Lr(),wN=yt(),xN=on();function Sj(n,e,t,r,a){wN(r)&&(r=t.index),wN(a)&&(a=t.columns),id(r)&&(r=[r]),id(a)&&(a=[a]),wo(bN(r)&&bN(a),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),wo(xN(r).length===1&&xN(a).length===1,"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),wo(r.length>0,"The `rows` array must contain at least one row name."),wo(a.length>0,"The `cols` array must contain at least one column name."),r.forEach(s=>{wo(id(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),wo(t.index.indexOf(s)>-1,`The row name "${s}" does not exist in the list of rows.`)}),a.forEach(s=>{wo(id(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),wo(t.columns.indexOf(s)>-1,`The column name "${s}" does not exist in the list of columns.`)});let i=r.map(s=>a.map(u=>t.values[t.index.indexOf(s)][t.columns.indexOf(u)]));if(r.length===1&&a.length===1)return cg(i)[0];if(r.length===1){let s=new e(cg(i));return s.name=r[0],s.index=a,s}if(a.length===1){let s=new e(cg(i));return s.name=a[0],s.index=r,s}let o=new n(i);return o.columns=a,o.index=r,o}kN.exports=Sj});var TN=Y((Krt,NN)=>{var Nj=Lr(),El=sa();function Tj(n,e,t){function r(h,d){return Nj(h)&&h.length>d?h.substring(0,d-3)+"...":h}if(t.isEmpty)return console.table({}),console.log("Shape:",[0,0],`
`),t;let a=typeof window>"u"?20:10,i=parseInt(a/2),o=typeof process>"u"?10:Math.floor(process.stdout.columns/24)-1,s=parseInt(o/2),u=a>t.index.length?null:El(0,i).concat(El(t.index.length-i,t.index.length)),c=o>t.columns.length?null:El(0,s).concat(El(t.columns.length-s,t.columns.length)),l=t.get(u,c);l instanceof e&&(t.shape[0]===1?(l=new n([l.values]),l.index=t.index,l.columns=new e(t.columns).get(c).values):t.shape[1]===1&&(l=new n([l.values]).transpose(),l.index=new e(t.index).get(u).values,l.columns=t.columns)),a<=t.index.length&&(l._index.splice(i,0,"..."),l._values.splice(i,0,El(0,l.columns.length).map(()=>"..."))),o<=t.columns.length&&(l._columns.splice(s,0,"..."),l._values=l._values.map(h=>(h.splice(s,0,"..."),h)));let f=28;return l instanceof e?(l.values=l.values.map(h=>r(h,f)),l.name=r(l.name,f),l.index=l.index.map(h=>r(h,f))):(l.values=l.values.map(h=>h.map(d=>r(d,f))),l.columns=l.columns.map(h=>r(h,f)),l.index=l.index.map(h=>r(h,f))),console.table(l.toObject()),console.log("Shape:",t.shape,`
`),t}NN.exports=Tj});var od=Y((jrt,EN)=>{var Ej=qe(),Ij=nt();function Cj(n,e){Ej(Ij(n),"The `leftPad` function only works on numbers!");let t=n.toString();for(;t.length<e;)t="0"+t;return t}EN.exports=Cj});var CN=Y((Xrt,IN)=>{var Aj=od(),_j=sa();function Dj(n,e){let t=e?n:n.copy();return t.index=_j(0,n.shape[0]).map(r=>"row"+Aj(r,(t.index.length-1).toString().length)),t}IN.exports=Dj});var Il=Y((Yrt,_N)=>{var Fj=qe(),Rj=pn(),Oj=Ue(),Pj=lt(),Mj=ut();function AN(n){if(Pj(n)||Mj(n))return AN(n.values);Fj(Oj(n),"The `product` function only works on arrays, Series, and DataFrames!");try{return n.length===0?NaN:Rj(n).reduce((e,t)=>e*t,1)}catch{return NaN}}_N.exports=AN});var sd=Y((Zrt,ON)=>{var Cl=qe(),DN=pn(),FN=Ue(),Bj=lt(),RN=nt(),Lj=ut(),zj=Il(),$j=on();function lg(n,e){if(Bj(n)||Lj(n))return lg(n.values,e);if(Cl(FN(n),"The first argument passed into the `reshape` function must be an array!"),RN(e)&&(e=[e]),Cl(FN(e),"The second argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),Cl($j(e).length===1,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),e.forEach(i=>{Cl(RN(i)&&parseInt(i)===i&&i>0,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!")}),e.length===0)return DN(n);let t=DN(n);if(e.length===1&&e[0]===t.length)return t;Cl(zj(e)===t.length,"The new shape doesn't match the number of values available in `x` (the first argument passed into the `reshape` function)!");let r=[],a=parseInt(t.length/e[0]);for(let i=0;i<e[0];i++){let o=t.slice(i*a,(i+1)*a);r.push(lg(o,e.slice(1)))}return r}ON.exports=lg});var Ou=Y((Jrt,qN)=>{var{copy:BN}=Ti(),qj=qe(),Wj=Ue(),Vj=nt(),LN=yt(),Gj=go(),Uj=Il(),Hj=sd(),zN=Math.pow(2,64),sn=[];$N(parseInt(Math.random()*zN));function Kj(n,e){n=pr(n);function t(){n+=pr("0x9e3779b97f4a7c15");let a=BN(n);return a=(a^a>>30n)*pr("0xbf58476d1ce4e5b9"),a=(a^a>>27n)*pr("0x94d049bb133111eb"),a^a>>31n}let r=[];for(let a=0;a<e;a++)r.push(t());return r}function pr(n){return BigInt.asUintN(64,BigInt(n))}function PN(n,e){return n=pr(n),e=BigInt(e),pr(pr(n<<e)|pr(n>>pr(64n-e)))}function $N(n){if(LN(n))return BN(sn);{qj(Vj(n),"If passing a value into the `seed` function, then that value must be an integer!");let e=Kj(parseInt(n),4);sn[0]=e[0],sn[1]=e[1],sn[2]=e[2],sn[3]=e[3]}}function MN(){let n=pr(PN(sn[0]+sn[3],23)+sn[0]),e=pr(sn[1]<<17n);return sn[2]=pr(sn[2]^sn[0]),sn[3]=pr(sn[3]^sn[1]),sn[1]=pr(sn[1]^sn[2]),sn[0]=pr(sn[0]^sn[3]),sn[2]=pr(sn[2]^e),sn[3]=PN(sn[3],45),parseInt(n)/zN}function jj(n){return LN(n)?MN():(Wj(n)||(n=[n]),Hj(Gj(Uj(n)).map(MN),n))}qN.exports={random:jj,seed:$N}});var ud=Y((Qrt,WN)=>{var{random:Xj}=Ou(),Yj=qe(),Zj=Ue(),Jj=lt(),Qj=ut();function e8(n){if(Jj(n)||Qj(n))return n.shuffle(...Object.values(arguments).slice(1));Yj(Zj(n),"The `shuffle` function only works on arrays, Series, and DataFrames!");let e=[],t=n.slice();for(let r=0;r<n.length;r++){let a=parseInt(Xj()*t.length);e.push(t.splice(a,1)[0])}return e}WN.exports=e8});var UN=Y((eat,GN)=>{var t8=qe(),n8=yt(),VN=ud();function r8(n,e){return n8(e)&&(e=0),t8(e===0||e===1,"The `axis` parameter to the `shuffle` must be 0, 1, or undefined."),n.get(e===0?VN(n.index):null,e===1?VN(n.columns):null)}GN.exports=r8});var cd=Y((tat,HN)=>{function a8(n){return typeof n=="boolean"}HN.exports=a8});var ZN=Y((nat,YN)=>{var{random:i8}=Ou(),zr=qe(),o8=pn(),KN=Ue(),fg=cd(),XN=Tr(),ld=nt(),Pu=Lr(),hg=yt(),s8=sa(),jN=on(),dg=yo();function u8(n,e,t){return XN(e)?c8(n,e,t):l8(n,e,t)}function c8(n,e,t){if(t=hg(t)?0:t,zr(XN(e),"When sorting a DataFrame using a function, the first argument to the `sort` method must be a function!"),zr(ld(t),"When sorting a DataFrame using a function, the second argument to the `sort` method must be null, undefined, 0, or 1 to indicate the axis along which the data should be sorted! An axis of 0 means that the rows will be sorted relative to each other, whereas an axis of 1 means that the columns will be sorted relative to each other."),t===0){let r=dg(n.index,(a,i)=>e(n.get(a,null),n.get(i,null)));return n.get(r,null)}else{let r=dg(n.columns,(a,i)=>e(n.get(null,a),n.get(null,i)));return n.get(null,r)}}function l8(n,e,t){let r=n.copy(),a=i8().toString();return r=r.assign(a,r.index),hg(e)&&(e=[a],t=[!0]),(ld(e)||Pu(e))&&(e=[e],(fg(t)||Pu(t))&&(t=[t])),zr(KN(e),"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),zr(jN(e).length===1,"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),hg(t)&&(t=s8(0,e.length).map(()=>!0)),zr(KN(t),"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),zr(jN(t).length===1,"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),zr(e.length===t.length,"The arrays passed into the `sort` method must be equal in length."),e=e.map(i=>{if(zr(Pu(i)||ld(i),"Column references can either be column names (as strings) or column indices (as whole numbers)."),Pu(i)){let o=r.columns.indexOf(i);return zr(o>-1,`The column "${i}" does not exist!`),o}if(ld(i))return zr(parseInt(i)===i,"Column indices must be whole numbers!"),zr(i>=0,`The column index ${i} is out of bounds!`),zr(i<r.columns.length,`The index ${i} is out of bounds!`),i}),t=t.map(i=>{if(zr(Pu(i)||fg(i),"Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),Pu(i)){let o=i.trim().toLowerCase();return zr(o==="ascending"||o==="descending","Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),o==="ascending"}if(fg(i))return i}),r.values=dg(r.values,(i,o)=>{let s=0;for(;i[e[s]]===o[e[s]]&&s<e.length;)s++;let u=t[s];if(i[e[s]]===o[e[s]])return 0;if(i[e[s]]<o[e[s]])return u?-1:1;if(i[e[s]]>o[e[s]])return u?1:-1}),r.index=o8(r.get(null,a).values),r=r.dropColumns(a),r}YN.exports=u8});var pg=Y((rat,JN)=>{function f8(n,e){return JSON.stringify(n.toObject(e))}JN.exports=f8});var QN=Y((aat,mg)=>{var vg=_u(),h8=pg();function d8(n,e,t){let r=h8(n,t),a=!1,i=!1,o,s;try{let u=e;if(e.includes("/")){let l=e.split("/");u=l[l.length-1]}let c=document.createElement("a");c.href=`data:application/json;charset=utf-8,${encodeURIComponent(r)}`,c.download=u,c.dispatchEvent(new MouseEvent("click")),a=!0}catch(u){o=u}try{let u=F2("fs"),c=F2("path");u.writeFileSync(c.resolve(e),r,"utf8"),i=!0}catch(u){s=u}if(!a&&!i)throw typeof window<"u"?new vg(o):typeof mg<"u"?new vg(s):new vg("I don't know what's going wrong, but it doesn't seem like you're in Node or the browser, and we couldn't download and/or write the file to disk!");return n}mg.exports=d8});var tT=Y((iat,eT)=>{var p8=qe(),v8=yt();function m8(n,e){v8(e)?e=0:p8(e===0||e===1,"The axis parameter of the `toObject` method must be undefined, 0, or 1. An axis of 0 indicates that the returned object should be organized first by rows and then by columns. An axis of 1 indicates that the returned object should be organized first by columns and then by rows.");let t={};return e===0?n.index.forEach((r,a)=>{let i={};n.columns.forEach((o,s)=>{i[o]=n.values[a][s]}),t[r]=i}):n.columns.forEach((r,a)=>{let i={};n.index.forEach((o,s)=>{i[o]=n.values[s][a]}),t[r]=i}),t}eT.exports=m8});var ls=Y((oat,aT)=>{var nT=qe(),g8=Ue(),y8=lt(),b8=ut(),w8=go(),rT=Sl(),x8=on();function k8(n){if(y8(n)||b8(n))return n.transpose();nT(g8(n),"The `transpose` function only works on arrays, Series, and DataFrames!");let e=x8(n);if(nT(e.length<=2,"I'm not smart enough to know how to transpose arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `transpose` function!"),e.length===1)return rT(n);if(e.length===2){let t=w8(rT(e));for(let r=0;r<e[0];r++)for(let a=0;a<e[1];a++)t[a][r]=n[r][a];return t}}aT.exports=k8});var uT=Y((sat,sT)=>{var iT=qe(),S8=Ue(),N8=lt(),T8=Qh(),E8=ut(),I8=on();function oT(n,e,t){if(E8(t))return new n(e.values.concat(t.values));if(S8(t)){let r=I8(t);iT(r.length===1&&!T8(r),"Only vectors can be appended to Series!");let a=e.copy();return t.forEach((i,o)=>{a._values.push(i),a._index.push("item"+(e.values.length+o))}),a}return iT(!N8(t),"DataFrames cannot be appended to Series!"),oT(e,[t])}sT.exports=oT});var lT=Y((uat,cT)=>{var C8=qe(),A8=Tr();function _8(n,e){C8(A8(e),"The parameter to the `apply` method must be a function.");let t=n.copy();return t._values=t._values.map((r,a)=>e(r,a)),t}cT.exports=_8});var hT=Y((cat,fT)=>{var D8=yt();function F8(n){let e=n.copy(),t=[];return e._values=e.values.filter((r,a)=>D8(r)?!1:(t.push(e.index[a]),!0)),e._index=t,e}fT.exports=F8});var pT=Y((lat,dT)=>{var R8=nt();function O8(n,e){let t=[],r=[];e.values.forEach((i,o)=>{R8(i)&&(r.push(i),t.push(e.index[o]))});let a=new n(r);return a.name=e.name,a.index=t,a}dT.exports=O8});var mT=Y((fat,vT)=>{var{copy:P8}=Ti();function M8(n,e,t){let r=e.copy(),a=P8(r.index),i=[],o=r.values.filter((s,u)=>{let c=t(s,u,r.values);return c||i.push(r.index[u]),c});return i.forEach(s=>{a.splice(a.indexOf(s),1)}),o.length===0?(r=new n,r.name=e.name,r):(r.values=o,r.index=a,r)}vT.exports=M8});var yT=Y((hat,gT)=>{var xo=qe(),B8=nt(),L8=Lr(),z8=yt(),$8=ei();function q8(n,e){(L8(e)||B8(e))&&(e=[e]);let t=$8((e||[]).map(r=>typeof r));return xo(t.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===1&&xo(t[0]==="string"||t[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===2&&(xo(t.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),xo(t.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),z8(e)||(e=e.map(r=>{if(typeof r=="string")return xo(n.index.indexOf(r)>-1,`Index "${r}" does not exist!`),r;if(typeof r=="number")return xo(r>=0,`Index ${r} is out of bounds!`),xo(parseInt(r)===r,"Indices must be integers!"),xo(r<n.index.length,`Index ${r} is out of bounds!`),n.index[r]})),n.getSubsetByNames(e)}gT.exports=q8});var wT=Y((dat,bT)=>{var Al=qe(),W8=Ue(),V8=yt(),G8=Nl(),U8=sa(),H8=on();function K8(n,e){let t=n.shape;V8(e)&&(e=U8(0,t[0])),Al(W8(e),"The `indices` array must be 1-dimensional array of whole numbers."),Al(H8(e).length===1,"The `indices` array must be a 1-dimensional array of whole numbers."),Al(e.length>0,"The `indices` array must contain at least one index."),e.forEach(a=>{Al(G8(a),"The `indices` array must be a 1-dimensional array of whole numbers."),Al(a<n.index.length,`The row index ${a} is out of bounds.`)});let r=e.map(a=>n.index[a]);return n.getSubsetByNames(r)}bT.exports=K8});var kT=Y((pat,xT)=>{var _l=qe(),j8=Ue(),X8=Lr(),Y8=yt(),Z8=on();function J8(n,e,t){Y8(t)&&(t=e.index),_l(j8(t),"The `indices` array must be a 1-dimensional array of strings."),_l(Z8(t).length===1,"The `indices` array must be a 1-dimensional array of strings."),_l(t.length>0,"The `indices` array must contain at least one index name."),t.forEach(i=>{_l(X8(i),"The `indices` array must contain only strings."),_l(e.index.indexOf(i)>-1,`The name "${i}" does not exist in the index.`)});let r=t.map(i=>e.values[e.index.indexOf(i)]);if(r.length===1)return r[0];let a=new n(r);return a.index=t,a.name=e.name,a}xT.exports=J8});var TT=Y((vat,NT)=>{var{copy:Q8}=Ti(),ST=sa();function e7(n){let e=n.copy(),t=typeof window>"u"?20:10;if(e.index.length>t){e=e.get(ST(0,t/2).concat(ST(e.index.length-t/2,e.index.length)));let a=Q8(e.index);a.splice(parseInt(a.length/2),0,"..."),e.values.push("..."),e.index.push("..."),e=e.get(a)}let r={};return e.values.forEach((a,i)=>{let o={};o[e.name]=a,r[e.index[i]]=o}),console.table(r),console.log("Shape:",n.shape,`
`),n}NT.exports=e7});var IT=Y((mat,ET)=>{var t7=ud();function n7(n){let e=n.copy();return e.get(t7(e.index))}ET.exports=n7});var AT=Y((gat,CT)=>{var r7=qe(),a7=Tr(),i7=yt(),o7=yo(),s7=ls();function u7(n,e,t){t=t||((u,c)=>u<c?-1:1),r7(i7(t)||a7(t),"You must pass undefined, null, or a comparison function as the second argument to the `sort` method!");let r=s7([e.values,e.index]),a=o7(r,(u,c)=>t(u[0],c[0])),i=[],o=[];a.forEach(u=>{i.push(u[0]),o.push(u[1])});let s=new n;return s._values=i,s._index=o,s.name=e.name,s}CT.exports=u7});var FT=Y((yat,DT)=>{var c7=yo(),_T=ls();function l7(n,e){let t=_T([e.values,e.index]);t=_T(c7(t,(a,i)=>{if(a[1]===i[1])return 0;if(a[1]<i[1])return-1;if(a[1]>i[1])return 1}));let r=new n(t[0]);return r.index=t[1],r.name=e.name,r}DT.exports=l7});var OT=Y((bat,RT)=>{function f7(n){let e={};return e[n.name]={},n.index.forEach((t,r)=>{e[n.name][t]=n.values[r]}),e}RT.exports=f7});var zT=Y((wat,LT)=>{var{copy:fd}=Ti(),Hi=qe(),gg=Ue(),h7=Lr(),d7=yt(),PT=od(),MT=sa(),hd=Sl(),p7=uT(),v7=lT(),m7=hT(),g7=pT(),y7=mT(),b7=yT(),w7=wT(),x7=kT(),k7=TT(),S7=IT(),N7=AT(),T7=FT(),E7=OT(),Dl=on(),I7=ls(),BT=Symbol.for("@jrc03c/js-math-tools/series");LT.exports=function(n){class e{static[Symbol.hasInstance](r){try{return!!r._symbol&&r._symbol===BT}catch{return!1}}constructor(r){let a=this;if(a.name="data",Object.defineProperty(a,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:BT}),Object.defineProperty(a,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"values",{configurable:!0,enumerable:!0,get(){return a._values},set(i){Hi(gg(i),"The new values must be a 1-dimensional array!");let o=Dl(i);Hi(o.length===1,"The new array of values must be 1-dimensional!"),o[0]<a._index.length?a._index=a._index.slice(0,o[0]):o[0]>a._index.length&&(a._index=a._index.concat(MT(a._index.length,o[0]).map(s=>"item"+PT(s,(i.length-1).toString().length)))),a._values=i}}),Object.defineProperty(a,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"index",{configurable:!0,enumerable:!0,get(){return a._index},set(i){Hi(gg(i),"The new index must be a 1-dimensional array of strings!"),Hi(i.length===a.shape[0],"The new index must be the same length as the old index!"),Hi(Dl(i).length===1,"The new index must be a 1-dimensional array of strings!"),i.forEach(o=>{Hi(h7(o),"All of the row names must be strings!")}),a._index=i}}),r){if(r instanceof e)a.name=r.name,a.values=fd(r.values),a.index=fd(r.index);else if(gg(r)){let i=Dl(r);Hi(i.length===1,"When passing an array into the constructor of a Series, the array must be 1-dimensional!"),a.values=r}else if(r instanceof Object){let i=Object.keys(r);Hi(i.length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!");let o=i[0],s=r[o];Hi(Dl(s).length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!"),a.name=o,a.values=s.slice()}}}get shape(){return Dl(this.values)}get length(){return this.shape[0]}get isEmpty(){return this.values.filter(a=>!d7(a)).length===0}clear(){let a=this.copy();return a.values.forEach((i,o)=>{a.values[o]=void 0}),a}get(r){return b7(this,r)}getSubsetByNames(r){return x7(e,this,r)}getSubsetByIndices(r){return w7(this,r)}loc(r){return this.getSubsetByNames(r)}iloc(r){return this.getSubsetByIndices(r)}reverse(){let r=this,a=new e(hd(r.values));return a.index=hd(r.index),a.name=r.name,a}resetIndex(){let r=this,a=r.copy();return a.index=MT(0,r.shape[0]).map(i=>"item"+PT(i,(a.index.length-1).toString().length)),a}copy(){let r=this,a=new e;return a._values=fd(r.values),a._index=fd(r.index),a.name=r.name,a}append(r){return p7(e,this,r)}apply(r){return v7(this,r)}concat(r){return this.append(r)}dropMissing(r,a){return m7(this,r,a)}dropNaN(){return g7(e,this)}toObject(){return E7(this)}print(){return k7(this)}shuffle(){return S7(this)}sort(r){return N7(e,this,r)}sortByIndex(){return T7(e,this)}filter(r){return y7(e,this,r)}toDataFrame(){let r=this,a=new n(I7([r.values]));return a.columns=[r.name],a.index=r.index,a}transpose(){let a=this.copy();return a.values=hd(a.values),a.index=hd(a.index),a}getDummies(){return this.toDataFrame().getDummies()}oneHotEncode(){return this.getDummies()}}return e}});var Rl=Y((xat,UT)=>{var{copy:yg}=Ti(),Ei=qe(),$T=xl(),C7=ES(),A7=DS(),_7=PS(),D7=BS(),F7=GS(),R7=KS(),O7=ZS(),P7=tN(),M7=aN(),qT=lN(),B7=yN(),L7=SN(),z7=TN(),$7=CN(),q7=UN(),W7=ZN(),V7=QN(),G7=pg(),U7=tT(),H7=pn(),Fl=Ue(),K7=mo(),WT=yt(),bg=od(),j7=go(),wg=sa(),Mu=on(),VT=ls(),GT=Symbol.for("@jrc03c/js-math-tools/dataframe");function dd(n){let e="abcdefghijklmnopqrstuvwxyz1234567890",t="";for(let r=0;r<n;r++)t+=e[parseInt(Math.random()*e.length)];return t}var Un=class{static[Symbol.hasInstance](e){try{return!!e._symbol&&e._symbol===GT}catch{return!1}}constructor(e){let t=this;if(Object.defineProperty(t,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:GT}),Object.defineProperty(t,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"values",{configurable:!0,enumerable:!0,get(){return t._values.length===0||!WT(t._values[0])&&t._values[0].length===0?[[]]:t._values},set(r){Ei(Fl(r),"The new values must be a 2-dimensional array!");let a=Mu(r);Ei(a.length===2,"The new array of values must be 2-dimensional!"),a[0]<t._index.length?t._index=t._index.slice(0,a[0]):a[0]>t._index.length&&(t._index=t._index.concat(wg(t._index.length,a[0]).map(i=>"row"+bg(i,(a[0]-1).toString().length)))),a[1]<t._columns.length?t._columns=t._columns.slice(0,a[1]):a[1]>t._columns.length&&(t._columns=t._columns.concat(wg(t._columns.length,a[1]).map(i=>"col"+bg(i,(a[1]-1).toString().length)))),t._values=r}}),Object.defineProperty(t,"_columns",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"columns",{configurable:!0,enumerable:!0,get(){return t._columns},set(r){Ei(Fl(r),"The new columns list must be a 1-dimensional array of strings!"),Ei(t.isEmpty||r.length===t.shape[1],"The new columns list must be the same length as the old columns list!"),Ei(Mu(r).length===1,"The new columns list must be a 1-dimensional array of strings!"),r=r.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+dd(8):i.trim()));let a=(()=>{let i=$T(r),o={};return i.forEach(s=>{o[s.item]=s.count}),o})();r=r.map(i=>a[i]>1?i+"_"+dd(8):i),t._columns=r}}),Object.defineProperty(t,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"index",{configurable:!0,enumerable:!0,get(){return t._index},set(r){Ei(Fl(r),"The new index must be a 1-dimensional array of strings!"),Ei(t.isEmpty||r.length===t.shape[0],"The new index must be the same length as the old index!"),Ei(Mu(r).length===1,"The new index must be a 1-dimensional array of strings!"),r=r.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+dd(8):i.trim()));let a=(()=>{let i=$T(r),o={};return i.forEach(s=>{o[s.item]=s.count}),o})();r=r.map(i=>a[i]>1?i+"_"+dd(8):i),t._index=r}}),Ei(WT(e)||K7(e)||Fl(e),"The `data` passed into the constructor of a DataFrame must be either (1) an object where the key-value pairs are (respectively) column names and 1-dimensional arrays of values, or (2) a 2-dimensional array of values."),e)if(e instanceof Un)t.values=yg(e.values),t.columns=yg(e.columns),t.index=yg(e.index);else if(Fl(e)){let r=Mu(e);Ei(r.length===2,"The `data` array passed into the constructor of a DataFrame must be 2-dimensional!"),t.values=e}else{t._columns=Object.keys(e);let r=[];t._columns.forEach(i=>{let o=e[i];r.push(o)}),t._values=VT(r);let a=Mu(t.values);t._index=wg(0,a[0]).map(i=>"row"+bg(i,(a[0]-1).toString().length))}}get shape(){return Mu(this.values)}get length(){return this.shape[0]}get width(){return this.shape[1]}get rows(){return this.index}set rows(e){let t=this;t.index=e}get isEmpty(){return H7(this.values).length===0}clear(){let e=this,t=new Un(j7(e.shape));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}get(e,t){let r=this;if(arguments.length===0)return r;if(arguments.length===1)try{return r.get(null,e)}catch{return r.get(e,null)}return M7(r,e,t)}getSubsetByNames(e,t){return L7(Un,ko,this,e,t)}getSubsetByIndices(e,t){return B7(this,e,t)}getDummies(e){return qT(Un,this,e)}oneHotEncode(e){return qT(Un,this,e)}transpose(){let e=this,t=new Un(VT(e.values));return t.columns=e.index.slice(),t.index=e.columns.slice(),t}get T(){return this.transpose()}resetIndex(e){return $7(this,e)}copy(){return D7(Un,this)}assign(e,t){return _7(Un,ko,this,e,t)}apply(e,t){return A7(Un,ko,this,e,t)}dropMissing(e,t,r){return R7(Un,ko,this,e,t,r)}dropNaN(e,t,r){return O7(Un,this,e,t,r)}drop(e,t){return F7(Un,ko,this,e,t)}dropColumns(e){return this.drop(null,e)}dropRows(e){return this.drop(e,null)}toObject(e){return U7(this,e)}toJSONString(e){return G7(this,e)}saveAsJSON(e,t){return V7(this,e,t)}print(){return z7(Un,ko,this)}sort(e,t){return W7(this,e,t)}sortByIndex(){return this.sort()}filter(e,t){return P7(Un,ko,this,e,t)}shuffle(e){return q7(this,e)}append(e,t){return C7(this,e,t)}concat(e,t){return this.append(e,t)}join(e,t){return this.append(e,t)}toString(){let e=this;return JSON.stringify(e)}},ko=zT()(Un);UT.exports={DataFrame:Un,Series:ko}});var Bu=Y((kat,KT)=>{var X7=qe(),Y7=pn(),Z7=Ue(),J7=lt(),Q7=ut();function HT(n){if(J7(n)||Q7(n))return HT(n.values);X7(Z7(n),"The `max` function only works on arrays, Series, and DataFrames!");try{return Math.max(...Y7(n))}catch{return NaN}}KT.exports=HT});var Lt=Y((Sat,JT)=>{var{DataFrame:jT,Series:XT}=Rl(),YT=qe(),Ol=Ue(),xg=lt(),ZT=Qa(),eX=Tr(),kg=ut(),tX=Bu(),nX=sa(),pd=on();function rX(n){return Ol(n)||kg(n)||xg(n)}function aX(n){return YT(eX(n),"You must pass a function into the `vectorize` function!"),function e(){let t,r,a=[],i=[],o=Object.keys(arguments).filter(s=>{let u=arguments[s];return Ol(u)?!0:kg(u)?(t=!0,a.push(u),!0):xg(u)?(r=!0,i.push(u),!0):!1}).map(s=>arguments[s]);if(o.slice(0,-1).forEach((s,u)=>{YT(ZT(Ol(s)?pd(s):s.shape,Ol(o[u+1])?pd(o[u+1]):o[u+1].shape),`When passing multiple arrays into the \`${n.name}\` function, all of the arrays must have the same shape!`)}),o.length>0){let s=tX(o.map(c=>c.length?c.length:c.values.length)),u=nX(0,s).map(c=>{let l=Object.keys(arguments).map(f=>{if(rX(arguments[f])){if(Ol(arguments[f]))return arguments[f][c];if(kg(arguments[f]))return arguments[f].values[c];if(xg(arguments[f]))return arguments[f].values[c]}else return arguments[f]});return e(...l)});if(r)try{if(i.length===1&&ZT(pd(i[0]),pd(u))){let c=new jT(u);return c.index=i[0].index.slice(),c.columns=i[0].columns.slice(),c}else return new jT(u)}catch{return u}if(t)try{if(a.length===1&&a[0].length===u.length){let c=new XT(u);return c.name=a[0].name,c.index=a[0].index.slice(),c}else return new XT(u)}catch{return u}return u}else return n(...arguments)}}JT.exports=aX});var vd=Y((Nat,QT)=>{var iX=nt(),oX=Lt();function sX(n){try{return iX(n)?Math.abs(n):NaN}catch{return NaN}}QT.exports=oX(sX)});var md=Y((Tat,eE)=>{var uX=nt(),cX=Lt();function lX(){try{let n=0,e=Object.values(arguments);for(let t=0;t<e.length;t++){if(!uX(e[t]))return NaN;n+=e[t]}return n}catch{return NaN}}eE.exports=cX(lX)});var Pl=Y((Eat,tE)=>{var fX=Lt();function hX(n,e){try{return e(n)}catch{return NaN}}tE.exports=fX(hX)});var rE=Y((Iat,nE)=>{var dX=nt(),pX=Lt();function vX(n){try{return dX(n)?Math.acos(n):NaN}catch{return NaN}}nE.exports=pX(vX)});var iE=Y((Cat,aE)=>{var mX=nt(),gX=Lt();function yX(n){try{return mX(n)?Math.asin(n):NaN}catch{return NaN}}aE.exports=gX(yX)});var sE=Y((Aat,oE)=>{var bX=nt(),wX=Lt();function xX(n){try{return bX(n)?Math.atan(n):NaN}catch{return NaN}}oE.exports=wX(xX)});var cE=Y((_at,uE)=>{var kX=qe(),SX=bl(),NX=Ue(),TX=lt(),EX=ut(),IX=Bu();function Sg(n){if(TX(n)){let e=Sg(n.values);return[n.index[e[0]],n.columns[e[1]]]}if(EX(n)){let e=Sg(n.values);return[n.index[e]]}kX(NX(n),"The `argmax` function only works on arrays, Series, and DataFrames!");try{let e=SX(n,IX(n));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}uE.exports=Sg});var gd=Y((Dat,fE)=>{var CX=qe(),AX=pn(),_X=Ue(),DX=lt(),FX=ut();function lE(n){if(DX(n)||FX(n))return lE(n.values);CX(_X(n),"The `min` function only works on arrays, Series, and DataFrames!");try{return Math.min(...AX(n))}catch{return NaN}}fE.exports=lE});var dE=Y((Fat,hE)=>{var RX=qe(),OX=bl(),PX=Ue(),MX=lt(),BX=ut(),LX=gd();function Ng(n){if(MX(n)){let e=Ng(n.values);return[n.index[e[0]],n.columns[e[1]]]}if(BX(n)){let e=Ng(n.values);return[n.index[e]]}RX(PX(n),"The `argmin` function only works on arrays, Series, and DataFrames!");try{let e=OX(n,LX(n));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}hE.exports=Ng});var Ig=Y((Rat,mE)=>{var pE=Ue(),Tg=cd(),zX=lt(),$X=Qa(),vE=nt(),qX=mo(),WX=ut(),Eg=yt();function Ki(n,e){if(zX(n)||WX(n))return n.apply(t=>Ki(t,e));if(pE(n))return n.map(t=>Ki(t,e));if(e==="null")return null;if(e==="number"){if(Eg(n))return NaN;let t=Ki(n,"boolean");if(Tg(t))return t?1:0;try{JSON.parse(n)}catch{let i=Ki(n,"date");if(i instanceof Date)return i.getTime()}let r=parseFloat(n);return isNaN(r)?NaN:r}if(e==="boolean"){if(Tg(n))return n;if(vE(n))return n===0?!1:n===1?!0:null;try{let t=(typeof n=="object"?n.toString()==="null"?"false":JSON.stringify(n):n.toString()).trim().toLowerCase();return t==="true"||t==="yes"||t==="y"?!0:t==="false"||t==="no"||t==="n"?!1:null}catch{return null}}if(e==="date"){if(n instanceof Date)return n;if(Eg(n))return null;let t=parseFloat(n);if(!isNaN(t)){let r=new Date(n);return r.toString()==="Invalid Date"?null:r}return null}if(e==="object"){if(qX(n))return n;let t=Ki(n,"boolean");if(Tg(t))return null;try{let a=Ki(n,"number");if(vE(a))return JSON.parse(n),null}catch{}let r=Ki(n,"date");if(r)return r;try{let a=JSON.parse(n);return pE(a)?a.map(i=>Ki(i,e)):a}catch{return null}}if(e==="string")return Eg(n)?$X(n,void 0)?"undefined":"null":n instanceof Date?n.toJSON():(()=>typeof n=="object"?n===null?"null":JSON.stringify(n):n.toString())()}mE.exports=Ki});var yE=Y((Oat,gE)=>{var VX=nt(),GX=Lt();function UX(n){try{return VX(n)?Math.ceil(n):NaN}catch{return NaN}}gE.exports=GX(UX)});var xE=Y((Pat,wE)=>{var HX=vd(),bE=nt(),KX=yt(),jX=Lt();function XX(n,e){try{if(!bE(n))return NaN;if(KX(e))e=1e-10;else if(!bE(e))return NaN;return HX(n)<e?0:n}catch{return NaN}}wE.exports=jX(XX)});var SE=Y((Mat,kE)=>{var Cg=nt(),YX=Lt();function ZX(n,e,t){try{return Cg(n)?Cg(e)?Cg(t)?n<e?e:n>t?t:n:NaN:NaN:NaN}catch{return NaN}}kE.exports=YX(ZX)});var TE=Y((Bat,NE)=>{var Ag=qe(),JX=pn(),QX=Ue(),e9=lt(),t9=nt(),n9=ut();function _g(n,e){if(e9(n)||n9(n))return _g(n.values,e);if(Ag(QX(n),"The `combinations` function only works on arrays, Series, and DataFrames!"),Ag(t9(e),"`r` must be a whole number!"),n=JX(n),e>n.length)return[n];if(e<=0)return[[]];if(Ag(e===parseInt(e),"`r` must be a whole number!"),n.length<2)return n;let t=[];return n.forEach((r,a)=>{let i=n.slice(a+1);if(i.length<e-1)return;_g(i,e-1).forEach(s=>{t.push([r].concat(s))})}),t}NE.exports=_g});var yd=Y((Lat,IE)=>{var r9=qe(),a9=pn(),i9=Ue(),o9=lt(),s9=ut();function EE(n){if(o9(n)||s9(n))return EE(n.values);r9(i9(n),"The `mean` function only works on arrays, Series, and DataFrames!");try{let e=a9(n),t=0;return e.forEach(r=>{t+=r}),t/e.length}catch{return NaN}}IE.exports=EE});var Fg=Y((zat,RE)=>{var CE=qe(),AE=Ue(),bd=nt(),_E=ut(),DE=yd(),FE=on();function Dg(n,e){if(_E(n))return Dg(n.values,e);if(_E(e))return Dg(n,e.values);CE(AE(n)&&AE(e)&&FE(n).length===1&&FE(e).length===1,"The `covariance` function only works on 1-dimensional arrays and Series!"),CE(n.length===e.length,"The two arrays or Series passed into the `covariance` function must have the same length!");try{let t=DE(n),r=DE(e);if(!bd(t)||!bd(r))return NaN;let a=Math.max(n.length,e.length),i=0;for(let o=0;o<a;o++){if(!bd(n[o]))return NaN;if(!bd(e[o]))return NaN;i+=(n[o]-t)*(e[o]-r)}return i/n.length}catch{return NaN}}RE.exports=Dg});var wd=Y(($at,OE)=>{var u9=nt(),c9=Lt();function l9(n){try{return u9(n)?Math.sqrt(n):NaN}catch{return NaN}}OE.exports=c9(l9)});var Rg=Y((qat,ME)=>{var f9=qe(),h9=pn(),d9=Ue(),p9=lt(),v9=nt(),m9=ut(),g9=yd();function PE(n){if(p9(n)||m9(n))return PE(n.values);f9(d9(n),"The `variance` function only works on arrays, Series, and DataFrames!");try{let e=h9(n),t=g9(e),r=0;for(let a=0;a<e.length;a++){if(!v9(e[a]))return NaN;r+=(e[a]-t)*(e[a]-t)}return r/e.length}catch{return NaN}}ME.exports=PE});var xd=Y((Wat,LE)=>{var y9=qe(),b9=Ue(),w9=lt(),x9=ut(),k9=wd(),S9=Rg();function BE(n){if(w9(n)||x9(n))return BE(n.values);y9(b9(n),"The `std` function only works on arrays, Series, and DataFrames!");try{return k9(S9(n))}catch{return NaN}}LE.exports=BE});var UE=Y((Vat,GE)=>{var zE=qe(),N9=Fg(),$E=Ue(),qE=ut(),WE=on(),VE=xd();function Og(n,e){if(qE(n))return Og(n.values,e);if(qE(e))return Og(n,e.values);zE($E(n)&&$E(e)&&WE(n).length===1&&WE(e).length===1,"The `correl` function only works on 1-dimensional arrays and Series!"),zE(n.length===e.length,"The two arrays or Series passed into the `correl` function must have the same length!");try{return N9(n,e)/(VE(n)*VE(e))}catch{return NaN}}GE.exports=Og});var KE=Y((Gat,HE)=>{var T9=nt(),E9=Lt();function I9(n){try{return T9(n)?Math.cos(n):NaN}catch{return NaN}}HE.exports=E9(I9)});var XE=Y((Uat,jE)=>{jE.exports=Object.freeze({boolean:"boolean",date:"date",null:"null",number:"number",object:"object",string:"string"})});var tI=Y((Hat,eI)=>{var C9=qe(),YE=Ue(),ZE=lt(),A9=Qa(),JE=ut(),QE=ei();function Pg(n,e){if(ZE(n)||JE(n))return Pg(n.values,e);if(ZE(e)||JE(e))return Pg(n,e.values);C9(YE(n)&&YE(e),"The `diff` function only works on arrays, Series, and DataFrames!");let t=QE(n),r=QE(e),a=[];return t.forEach(i=>{r.findIndex(o=>A9(o,i))<0&&a.push(i)}),a}eI.exports=Pg});var kd=Y((Kat,rI)=>{var nI=nt(),_9=Lt();function D9(n,e){try{return nI(n)?nI(e)?Math.pow(n,e):NaN:NaN}catch{return NaN}}rI.exports=_9(D9)});var Mg=Y((jat,aI)=>{var F9=nt(),R9=Lt();function O9(){try{let n=Object.values(arguments);if(n.length===0)return NaN;let e=1;for(let t=0;t<n.length;t++){if(!F9(n[t]))return NaN;e*=n[t]}return e}catch{return NaN}}aI.exports=R9(O9)});var Lu=Y((Xat,iI)=>{var P9=Mg();function M9(){return P9(...arguments)}iI.exports=M9});var Bg=Y((Yat,oI)=>{var B9=md(),L9=Lu();function z9(n,e){return B9(n,L9(e,-1))}oI.exports=z9});var Sd=Y((Zat,uI)=>{var $9=qe(),q9=pn(),W9=Ue(),V9=lt(),G9=ut();function sI(n){if(V9(n)||G9(n))return sI(n.values);$9(W9(n),"The `sum` function only works on arrays, Series, and DataFrames!");try{return n.length===0?NaN:q9(n).reduce((e,t)=>e+t,0)}catch{return NaN}}uI.exports=sI});var vI=Y((Jat,pI)=>{var U9=vd(),H9=qe(),cI=Ue(),lI=lt(),K9=Qa(),fI=nt(),hI=ut(),j9=kd(),dI=on(),X9=wd(),Y9=Bg(),Z9=Sd();function Lg(n,e){if(fI(n)&&fI(e))return U9(n-e);if(lI(n)||hI(n))return Lg(n.values,e);if(lI(e)||hI(e))return Lg(n,e.values);cI(n)&&cI(e)&&H9(K9(dI(n),dI(e)),"If passing two arrays, Series, or DataFrames into the `distance` function, then those objects must have the same shape!");try{return X9(Z9(j9(Y9(n,e),2)))}catch{return NaN}}pI.exports=Lg});var gI=Y((Qat,mI)=>{var J9=kd(),Q9=Lu();function eY(n,e){return Q9(n,J9(e,-1))}mI.exports=eY});var $g=Y((eit,SI)=>{var{DataFrame:yI,Series:bI}=Rl(),Nd=qe(),wI=pn(),xI=Ue(),zg=lt(),tY=nt(),Td=ut(),nY=Lu(),Ed=on(),rY=Sd(),kI=ls();function So(n,e){if(zg(n)){let a=So(n.values,e);if(Ed(a).length===1){let i=new bI(a);return i.name=Td(e)?e.name:i.name,i.index=n.index.slice(),i}else{let i=new yI(a);return i.index=n.index.slice(),zg(e)&&(i.columns=e.columns.slice()),i}}if(zg(e)){let a=So(n,e.values);if(Ed(a).length===1){let i=new bI(a);return i.name=Td(n)?n.name:i.name,i.index=e.columns.slice(),i}else{let i=new yI(a);return i.columns=e.columns.slice(),i}}if(Td(n))return So(n.values,e);if(Td(e))return So(n,e.values);Nd(xI(n)&&xI(e),"The `dot` function only works on arrays, Series, and DataFrames!"),wI(n).concat(wI(e)).forEach(a=>{Nd(tY(a),"One of the arrays you passed into the `dot` function contains non-numerical values!")});let t=Ed(n),r=Ed(e);if(Nd(t.length<=2&&r.length<=2,"I'm not smart enough to know how to get the dot-product of arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `dot` function!"),Nd(t[t.length-1]===r[0],`There's a dimension misalignment in the two arrays you passed into the \`dot\` function. (${t[t.length-1]} !== ${r[0]})`),t.length===1&&r.length===1)return rY(nY(n,e));if(t.length===1&&r.length===2)return kI(e).map(a=>So(n,a));if(t.length===2&&r.length===1)return n.map(a=>So(a,e));if(t.length===2&&r.length===2){let a=kI(e),i=[];for(let o=0;o<n.length;o++){let s=[];for(let u=0;u<a.length;u++)s.push(So(n[o],a[u]));i.push(s)}return i}}SI.exports=So});var qg=Y((tit,TI)=>{var aY=qe(),iY=Ue(),oY=lt(),sY=ut(),uY=yt();function NI(n){if(oY(n)||sY(n))return n.dropMissing(...Object.values(arguments).slice(1));aY(iY(n),"The `dropMissing` function only works on arrays, Series, and DataFrames!");let e=[];return n.forEach(t=>{try{return e.push(NI(t))}catch{uY(t)||e.push(t)}}),e}TI.exports=NI});var RI=Y((nit,FI)=>{var EI=qe(),II=Ue(),CI=lt(),cY=Qa(),AI=ut(),_I=yt(),DI=on();function Id(n,e){if(CI(n)||AI(n))return Id(n.values,e);if(CI(e)||AI(e))return Id(n,e.values);EI(II(n)&&II(e),"The `dropMissingPairwise` function only works on arrays, Series, and DataFrames!"),EI(cY(DI(n),DI(e)),"The two arrays, Series, and/or DataFrames passed into the `dropMissingPairwise` function must have the same shape!");let t=[],r=[];for(let a=0;a<n.length;a++)try{let[i,o]=Id(n[a],e[a]);t.push(i),r.push(o)}catch{!_I(n[a])&&!_I(e[a])&&(t.push(n[a]),r.push(e[a]))}return[t,r]}FI.exports=Id});var qI=Y((rit,$I)=>{var OI=qe(),PI=Ue(),MI=lt(),lY=Qa(),BI=nt(),LI=ut(),zI=on();function Cd(n,e){if(MI(n)||LI(n))return Cd(n.values,e);if(MI(e)||LI(e))return Cd(n,e.values);OI(PI(n)&&PI(e),"The `dropNaNPairwise` only works on arrays, Series, and DataFrames!"),OI(lY(zI(n),zI(e)),"The two arrays, Series, and/or DataFrames passed into the `dropNaNPairwise` must have the same shape!");let t=[],r=[];for(let a=0;a<n.length;a++)try{let[i,o]=Cd(n[a],e[a]);t.push(i),r.push(o)}catch{BI(n[a])&&BI(e[a])&&(t.push(n[a]),r.push(e[a]))}return[t,r]}$I.exports=Cd});var VI=Y((ait,WI)=>{var fY=qg();function hY(n){return fY(n)}WI.exports=hY});var UI=Y((iit,GI)=>{var dY=nt(),pY=Lt();function vY(n){try{return dY(n)?Math.exp(n):NaN}catch{return NaN}}GI.exports=pY(vY)});var jI=Y((oit,KI)=>{var mY=Lt();function HI(n){try{return n!==parseInt(n)?NaN:n<=1?1:n*HI(n-1)}catch{return NaN}}KI.exports=mY(HI)});var JI=Y((sit,ZI)=>{var gY=qe(),yY=pn(),XI=Ue(),bY=lt(),wY=Tr(),YI=mo(),xY=ut();function Wg(n,e){if(bY(n))return Wg(yY(n.values),e);if(xY(n))return Wg(n.values,e);if(gY(YI(n)||XI(n),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `find` function!"),!wY(e)){let a=e;e=i=>i===a}function t(a,i,o){if(o=o||[],o.indexOf(a)>-1)return null;if(YI(a)){o.push(a);let s=Object.keys(a);for(let u=0;u<s.length;u++){let c=s[u],l=a[c];if(i(l))return l;let f=t(l,i,o);if(f)return f}}else if(XI(a)){o.push(a);for(let s=0;s<a.length;s++){let u=a[s];if(i(u))return u;let c=t(u,i,o);if(c)return c}}else if(i(a))return a;return null}function r(a){try{return e(a)}catch{return!1}}return t(n,r)}ZI.exports=Wg});var nC=Y((uit,tC)=>{var kY=qe(),SY=pn(),QI=Ue(),NY=lt(),TY=Tr(),eC=mo(),EY=ut();function Vg(n,e){if(NY(n))return Vg(SY(n.values),e);if(EY(n))return Vg(n.values,e);if(kY(eC(n)||QI(n),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `findAll` function!"),!TY(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(eC(i)){s.push(i);let u=Object.keys(i),c=[];for(let l=0;l<u.length;l++){let f=u[l],h=i[f],d=!1;o(h)&&(c.push(h),d=!0);let p=t(h,o,s);p&&p.length>0&&p.slice(d?1:0).forEach(v=>c.push(v))}return c}else if(QI(i)){s.push(i);let u=[];for(let c=0;c<i.length;c++){let l=i[c],f=!1;o(l)&&(u.push(l),f=!0);let h=t(l,o,s);h&&h.length>0&&h.slice(f?1:0).forEach(d=>u.push(d))}return u}else if(o(i))return[i];return null}function r(i){try{return e(i)}catch{return!1}}let a=t(n,r);return a&&a.length>0?a:null}tC.exports=Vg});var aC=Y((cit,rC)=>{var IY=nt(),CY=Lt();function AY(n){try{if(n==="Infinity")return 1/0;if(n==="-Infinity")return-1/0;let e=JSON.parse(n);return IY(e)?e:NaN}catch{return NaN}}rC.exports=CY(AY)});var oC=Y((lit,iC)=>{var _Y=nt(),DY=Lt();function FY(n){try{return _Y(n)?Math.floor(n):NaN}catch{return NaN}}iC.exports=DY(FY)});var Gg=Y((fit,sC)=>{var RY=nt(),OY=Il(),PY=sd();function MY(n){RY(n)&&(n=[n]);let e=[],t=OY(n);for(let r=0;r<t;r++)e.push(0);return PY(e,n)}sC.exports=MY});var cC=Y((hit,uC)=>{var Ad=qe(),BY=nt(),LY=yt(),zY=Gg();function $Y(n){Ad(!LY(n),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ad(BY(n),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ad(parseInt(n)===n,"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ad(n>0,"You must pass an integer greater than 0 (representing the size) into the `identity` function!");let e=zY([n,n]);for(let t=0;t<n;t++)e[t][t]=1;return e}uC.exports=$Y});var fC=Y((dit,lC)=>{lC.exports=["true","false","yes","no"]});var dC=Y((pit,hC)=>{hC.exports=["null","none","nan","na","n/a","","undefined"]});var vC=Y((vit,pC)=>{var qY=Pl(),WY=qe(),VY=fC(),GY=Ig(),UY=xl(),HY=pn(),Ug=Ue(),KY=lt(),jY=nt(),XY=ut(),YY=Lr(),ZY=dC();function _d(n){if(KY(n)){let a=n.copy(),i=_d(n.values);return a.values=i.values,{type:i.type,values:a}}if(XY(n)){let a=n.copy(),i=_d(n.values);return a.values=i.values,{type:i.type,values:a}}if(n instanceof Date)return{type:"date",value:n};if(!Ug(n)){let a=_d([n]);return a.value=a.values[0],delete a.values,a}WY(Ug(n),"The `inferType` function only works on arrays, Series, and DataFrames!");let e=HY(n).map(a=>{if(a===void 0)return"null";if(a instanceof Date)return"date";YY(a)||(a=JSON.stringify(a));let o=a.toLowerCase().trim();if(ZY.indexOf(o)>-1)return"null";if(VY.indexOf(o)>-1)return"boolean";try{let s=JSON.parse(a);return jY(s)?"number":typeof s=="object"?Ug(s)?"string":"object":"string"}catch{return new Date(a).toString()!=="Invalid Date"?"date":"string"}}),r=UY(e).sort((a,i)=>i.count-a.count)[0].item;return{type:r,values:qY(n,a=>GY(a,r))}}pC.exports=_d});var gC=Y((mit,mC)=>{var JY=nt(),QY=Lt();function eZ(n){try{let e=JSON.parse(n);return JY(e)?parseInt(e):NaN}catch{return NaN}}mC.exports=QY(eZ)});var bC=Y((git,yC)=>{var tZ=qe(),nZ=Ue(),rZ=lt(),aZ=Qa(),iZ=ut(),Hg=ei();function oZ(){let n=Object.values(arguments).map(t=>rZ(t)||iZ(t)?Hg(t.values):(tZ(nZ(t),"The `intersect` function only works on arrays, Series, and DataFrames!"),Hg(t)));return Hg(n).filter(t=>n.every(r=>r.findIndex(a=>aZ(a,t))>-1))}yC.exports=oZ});var SC=Y((yit,kC)=>{var wC=md(),No=qe(),sZ=$g(),uZ=pn(),cZ=Ue(),lZ=lt(),Kg=nt(),xC=Lu(),fZ=on();function Dd(n){if(lZ(n)){let t=n.copy();return t.values=Dd(t.values),t}No(cZ(n),"The `inverse` function only works on square 2-dimensional arrays or DataFrames!"),uZ(n).forEach(t=>No(Kg(t),"The array passed into the `inverse` function must contain only numbers!"));let e=fZ(n);if(No(e.length===2,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),No(e[0]===e[1],"The array passed into the `inverse` function must be exactly two-dimensional and square!"),No(e[0]>=0,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),e[0]===0)return n;if(e[0]===1)return No(n[0][0]!==0,"This matrix cannot be inverted!"),1/n[0][0];if(e[0]===2){let t=n[0][0],r=n[0][1],a=n[1][0],i=n[1][1],o=t*i-r*a;No(o!==0,"This matrix cannot be inverted!");let s=[[i,-r],[-a,t]];return xC(s,1/o)}else if(e[0]>1){let t=(r,a)=>Kg(r)||Kg(a)?xC(r,a):sZ(r,a);for(let r=1;r<e[0]-1;r++)try{let a=n.slice(0,r).map(v=>v.slice(0,r)),i=n.slice(0,r).map(v=>v.slice(r,e[0])),o=n.slice(r,e[0]).map(v=>v.slice(0,r)),s=n.slice(r,e[0]).map(v=>v.slice(r,e[0])),u=Dd(a),c=Dd(wC(s,t(-1,t(t(o,u),i)))),l=wC(u,t(t(t(t(u,i),c),o),u)),f=t(-1,t(t(u,i),c)),h=t(-1,t(t(c,o),u)),d=c;return l.map((v,m)=>v.concat(f[m])).concat(h.map((v,m)=>v.concat(d[m])))}catch{}No(!1,"This matrix cannot be inverted!")}}kC.exports=Dd});var TC=Y((bit,NC)=>{var hZ=new Function(`
    try {
      return this === window
    } catch(e) {}

    try {
      return !!importScripts
    } catch(e){}

    return false
  `);NC.exports=hZ});var IC=Y((wit,EC)=>{var jg=nt(),dZ=Lt();function pZ(n,e,t){try{return jg(n)?jg(e)?jg(t)?t*(e-n)+n:NaN:NaN:NaN}catch{return NaN}}EC.exports=dZ(pZ)});var _C=Y((xit,AC)=>{var CC=nt(),vZ=yt(),mZ=Lt();function gZ(n,e){try{return e=vZ(e)?Math.E:e,CC(n)?CC(e)?Math.log(n)/Math.log(e):NaN:NaN}catch{return NaN}}AC.exports=mZ(gZ)});var RC=Y((kit,FC)=>{var yZ=qe(),bZ=pn(),wZ=Ue(),xZ=lt(),kZ=ut(),SZ=yo();function DC(n){if(xZ(n)||kZ(n))return DC(n.values);yZ(wZ(n),"The `median` function only works on arrays, Series, and DataFrames!");try{let e=SZ(bZ(n));return e.length===0?NaN:e.length%2===0?(e[e.length/2-1]+e[e.length/2])/2:e[parseInt(e.length/2)]}catch{return NaN}}FC.exports=DC});var MC=Y((Sit,PC)=>{var OC=nt(),NZ=Lt();function TZ(n,e){try{return OC(n)?OC(e)?n%e:NaN:NaN}catch{return NaN}}PC.exports=NZ(TZ)});var $C=Y((Nit,zC)=>{var EZ=qe(),IZ=xl(),CZ=pn(),AZ=Ue(),_Z=lt(),DZ=ut(),FZ=ei(),BC=yo();function LC(n){if(_Z(n)||DZ(n))return LC(n.values);EZ(AZ(n),"The `mode` function only works on arrays, Series, and DataFrames!");try{if(n.length===0)return NaN;let e=CZ(n);if(e.length===0)return NaN;let t={},r=FZ(e);r.forEach(s=>{t[s]=IZ(e,s)});let a=BC(r,(s,u)=>t[u]-t[s]),i=a[0];return BC(a.filter(s=>t[s]===t[i]))}catch{return NaN}}zC.exports=LC});var GC=Y((Tit,VC)=>{var{random:qC}=Ou(),RZ=Pl(),OZ=yt(),PZ=go();function WC(){let n=qC(),e=qC();return Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*e)}function MZ(n){return OZ(n)?WC():RZ(PZ(n),WC)}VC.exports=MZ});var HC=Y((Eit,UC)=>{var BZ=Pl(),LZ=go();function zZ(n){return BZ(LZ(n),()=>1)}UC.exports=zZ});var jC=Y((Iit,KC)=>{var Xg=qe(),$Z=pn(),qZ=Ue(),WZ=lt(),VZ=nt(),GZ=ut(),UZ=yt();function Fd(n,e){if(WZ(n)||GZ(n))return Fd(n.values,e);if(Xg(qZ(n),"The `permutations` function only works on arrays, Series, and DataFrames!"),UZ(e)&&(e=n.length),Xg(VZ(e),"`r` must be a whole number!"),n=$Z(n),e>n.length)return Fd(n);if(e<=0)return[[]];if(Xg(e===parseInt(e),"`r` must be a whole number!"),n.length<2)return n;let t=[];return n.forEach((r,a)=>{let i=n.slice(0,a),o=n.slice(a+1),s=i.concat(o);Fd(s,e-1).forEach(c=>{t.push([r].concat(c))})}),t}KC.exports=Fd});var YC=Y((Cit,XC)=>{var{DataFrame:HZ,Series:KZ}=Rl(),jZ=Ue(),XZ=lt(),YZ=kl(),ZZ=ut(),JZ=on();function QZ(){Object.keys(arguments).forEach(n=>{let e=arguments[n];if(jZ(e))if(YZ(e))console.log(e);else{let t=JZ(e);t.length===1?new KZ(e).print():t.length==2?new HZ(e).print():console.log(e)}else XZ(e)||ZZ(e)?e.print():console.log(e)})}XC.exports=QZ});var QC=Y((Ait,JC)=>{var eJ=Ue(),tJ=nt(),ZC=yt(),nJ=Bu(),rJ=gd(),aJ=Lt(),iJ=aJ(function(n,e,t,r,a){try{return[n,e,t,r,a].every(i=>tJ(i))?t-e===0?NaN:(a-r)*(n-e)/(t-e)+r:NaN}catch{return NaN}});function oJ(n,e,t,r,a){return eJ(n)&&ZC(r)&&ZC(a)&&(r=e,a=t,e=rJ(n),t=nJ(n)),iJ(n,e,t,r,a)}JC.exports=oJ});var tA=Y((_it,eA)=>{var sJ=nt(),uJ=Lt();function cJ(n){try{return sJ(n)?Math.round(n):NaN}catch{return NaN}}eA.exports=uJ(cJ)});var rA=Y((Dit,nA)=>{var lJ=nt(),fJ=Lt();function hJ(n){try{return lJ(n)?n<0?-1:n>0?1:0:NaN}catch{return NaN}}nA.exports=fJ(hJ)});var iA=Y((Fit,aA)=>{var dJ=nt(),pJ=Lt();function vJ(n){try{return dJ(n)?Math.sin(n):NaN}catch{return NaN}}aA.exports=pJ(vJ)});var sA=Y((Rit,oA)=>{var mJ=xd();function gJ(n){return mJ(n)}oA.exports=gJ});var cA=Y((Oit,uA)=>{var yJ=nt(),bJ=Lt();function wJ(n){try{return yJ(n)?Math.tan(n):NaN}catch{return NaN}}uA.exports=bJ(wJ)});var Rd=Y((Pit,hA)=>{var lA=qe(),fA=Tr();function xJ(n,e){lA(fA(n),"`fn` must be a function!");let t=new Date;return e?n(...e):n(),new Date-t}async function kJ(n,e){lA(fA(n),"`fn` must be a function!");let t=new Date;return e?await n(...e):await n(),new Date-t}hA.exports={timeSync:xJ,timeAsync:kJ}});var pA=Y((Mit,dA)=>{var SJ=Ue(),NJ=lt(),TJ=ut(),EJ=ei();function IJ(){return EJ([...arguments].map(n=>SJ(n)?n:NJ(n)||TJ(n)?n.values:[n]))}dA.exports=IJ});var mA=Y((Bit,vA)=>{var CJ=qe(),AJ=Ue(),_J=lt(),DJ=ut(),FJ=yt(),RJ=Bu(),OJ=sa();function PJ(){let n=[],e=Object.values(arguments).map(t=>((_J(t)||DJ(t))&&(t=t.values),CJ(AJ(t),"The `zip` function only works on arrays, Series, and DataFrames!"),t));return OJ(0,RJ(e.map(t=>t.length))).forEach(t=>{let r=[];e.forEach(a=>{let i=a[t];r.push(FJ(i)?void 0:i)}),n.push(r)}),n}vA.exports=PJ});var Et=Y((Lit,Yg)=>{var{copy:MJ,decycle:BJ}=Ti(),{DataFrame:LJ,Series:zJ}=Rl(),zu={abs:vd(),add:md(),apply:Pl(),arccos:rE(),arcsin:iE(),arctan:sE(),argmax:cE(),argmin:dE(),assert:qe(),cast:Ig(),ceil:yE(),chop:xE(),clamp:SE(),combinations:TE(),copy:MJ,correl:UE(),cos:KE(),count:xl(),covariance:Fg(),DataFrame:LJ,dataTypes:XE(),decycle:BJ,diff:tI(),distance:vI(),divide:gI(),dot:$g(),dropMissing:qg(),dropMissingPairwise:RI(),dropNaN:sg(),dropNaNPairwise:qI(),dropUndefined:VI(),exp:UI(),factorial:jI(),find:JI(),findAll:nC(),flatten:pn(),float:aC(),floor:oC(),identity:cC(),indexOf:bl(),inferType:vC(),int:gC(),intersect:bC(),inverse:SC(),isArray:Ue(),isBoolean:cd(),isBrowser:TC(),isDataFrame:lt(),isEqual:Qa(),isFunction:Tr(),isJagged:kl(),isNested:Qh(),isNumber:nt(),isObject:mo(),isSeries:ut(),isString:Lr(),isUndefined:yt(),lerp:IC(),log:_C(),MathError:_u(),max:Bu(),mean:yd(),median:RC(),min:gd(),mod:MC(),mode:$C(),multiply:Mg(),ndarray:go(),normal:GC(),ones:HC(),permutations:jC(),pow:kd(),print:YC(),product:Il(),random:Ou().random,range:sa(),remap:QC(),reshape:sd(),reverse:Sl(),round:tA(),scale:Lu(),seed:Ou().seed,Series:zJ,set:ei(),shape:on(),shuffle:ud(),sign:rA(),sin:iA(),sort:yo(),sqrt:wd(),std:xd(),stdev:sA(),subtract:Bg(),sum:Sd(),tan:cA(),time:Rd().timeSync,timeSync:Rd().timeSync,timeAsync:Rd().timeAsync,transpose:ls(),union:pA(),variance:Rg(),vectorize:Lt(),zeros:Gg(),zip:mA(),dump:function(){let n=typeof global<"u"?global:window;if(!n)throw new zu.MathError("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(zu).forEach(e=>{try{Object.defineProperty(n,e,{configurable:!1,enumerable:!0,writable:!1,value:zu[e]})}catch{n[e]=zu[e]}})}};typeof Yg<"u"&&(Yg.exports=zu);typeof window<"u"&&(window.JSMathTools=zu)});var gA=Y(()=>{});var yA=Y(()=>{});var Od=Y(()=>{});var As=Y(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});function $J(n,e){return e.forEach(function(t){Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})}),n}var r0=function(n,e){return r0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},r0(n,e)};function Ji(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r0(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function je(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Xe(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function cr(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ke(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function wt(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var qJ=1e-7,WJ=1e-4,VJ=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),LA=function(){function n(){}return n.prototype.refCount=function(e){return $r("refCount")},n.prototype.incRef=function(e){return $r("incRef")},n.prototype.timerAvailable=function(){return!0},n.prototype.time=function(e){return $r("time")},n.prototype.read=function(e){return $r("read")},n.prototype.readSync=function(e){return $r("readSync")},n.prototype.readToGPU=function(e,t){return $r("readToGPU")},n.prototype.numDataIds=function(){return $r("numDataIds")},n.prototype.disposeData=function(e,t){return $r("disposeData")},n.prototype.write=function(e,t,r){return $r("write")},n.prototype.move=function(e,t,r,a,i){return $r("move")},n.prototype.createTensorFromGPUData=function(e,t,r){return $r("createTensorFromGPUData")},n.prototype.memory=function(){return $r("memory")},n.prototype.floatPrecision=function(){return $r("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?qJ:WJ},n.prototype.dispose=function(){return $r("dispose")},n}();function $r(n){throw new Error("'".concat(n,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function zA(n){for(var e=n.length,t=0;e>0;)t=Math.random()*e|0,e--,qd(n,e,t)}function GJ(n,e){if(n.length!==e.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(n.length)+"Second array length was ".concat(e.length));for(var t=n.length,r=0;t>0;)r=Math.random()*t|0,t--,qd(n,t,r),qd(e,t,r)}function Wl(n,e,t){return Math.max(n,Math.min(e,t))}function UJ(n){return n%2===0?n:n+1}function qd(n,e,t){var r=n[e];n[e]=n[t],n[t]=r}function HJ(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function KJ(n,e){var t=Math.random();return e*t+(1-t)*n}function jJ(n,e){for(var t=0,r=0;r<n.length;r++){var a=Number(n[r])-Number(e[r]);t+=a*a}return t}function q(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function mr(n,e,t){t===void 0&&(t=""),q(Ro(n,e),function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}function Ns(n){q(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ut(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function XJ(n){return n.length===0}function Ro(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Xu(n){return n%1===0}function YJ(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function ZJ(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function JJ(n){for(var e=new Uint32Array(n),t=0;t<n;++t)e[t]=t;return zA(e),e}function zl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function QJ(n,e,t,r){return e===void 0&&(e=function(a){return 0}),new Promise(function(a,i){var o=0,s=function(){if(n()){a();return}o++;var u=e(o);if(t!=null&&o>=t){i();return}r!=null?r(s,u):setTimeout(s,u)};s()})}function eQ(n,e){for(var t=1,r=-1,a=0;a<n.length;++a)if(n[a]>=0)t*=n[a];else if(n[a]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(n[a]<0)throw Error("Shapes can not be < 0. Found ".concat(n[a]," at dim ").concat(a));if(r===-1){if(e>0&&e!==t)throw Error("Size(".concat(e,") must match the product of shape ").concat(n));return n}if(t===0)throw Error("Cannot infer the missing size in [".concat(n,"] when ")+"there are 0 elements");if(e%t!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(e," / ").concat(t));var i=n.slice();return i[r]=e/t,i}function nf(n,e){var t=e.length;return n=n==null?e.map(function(r,a){return a}):[].concat(n),q(n.every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(n)}),q(n.every(function(r){return Xu(r)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(n)}),n.map(function(r){return r<0?t+r:r})}function $A(n,e){for(var t=[],r=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:nf(e,n).sort(),o=0,s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(n[s],"' is not 1"));(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function qA(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type ".concat(n));return t}function WA(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(n));return t}function VA(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(r,"."))}}function GA(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function tQ(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Wd(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype ".concat(n))}function UA(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function Eo(n){return typeof n=="string"||n instanceof String}function HA(n){return typeof n=="boolean"}function KA(n){return typeof n=="number"}function tp(n){return Array.isArray(n)?tp(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":KA(n)?"float32":Eo(n)?"string":HA(n)?"bool":"float32"}function Ao(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Vd(n,e){for(var t=e;t<n;++t)if(n%t===0)return t;return n}function ec(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function jA(n,e,t,r){r===void 0&&(r=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(r?2:1),o=0;o<i;o++)a[o]=t[n+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(r?2:1),o=0;o<i;o++)a[o]=jA(n+o*u,s,t,r);return a}function Vu(n,e,t){if(t===void 0&&(t=!1),n.length===0)return e[0];var r=n.reduce(function(a,i){return a*i})*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error("[".concat(n,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return jA(0,n,e,t)}function nQ(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error("Unknown dtype ".concat(e))}function C0(n,e){for(var t=np(n,e),r=0;r<t.length;r++)t[r]=1;return t}function np(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type ".concat(e))}function rQ(n,e){var t=n.reduce(function(r,a){return r*a},1);if(e==null||e==="float32")return Vu(n,new Float32Array(t));if(e==="int32")return Vu(n,new Int32Array(t));if(e==="bool")return Vu(n,new Uint8Array(t));throw new Error("Unknown data type ".concat(e))}function Vr(n){n.forEach(function(e){q(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(n,"].")})})}function aQ(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],a=0;a<n.length-1;++a)r+=t[a]*n[a];return r}function iQ(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),a=0;a<r.length-1;++a)r[a]=Math.floor(n/t[a]),n-=r[a]*t[a];return r[r.length-1]=n,r}function rp(n){return n&&n.then&&typeof n.then=="function"}var bA="tfjsflags",XA=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=oQ,this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&(vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var a=this.urlFlags[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},n.prototype.getAsync=function(e){return je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=a.sent(),[2,this.flags[e]]}})})},n.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(rp(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(bA in t){var r=t[bA].split(",");r.forEach(function(a){var i=ke(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=uQ(o,s)})}}},n}();function oQ(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return sQ(e,r[0],r[1]),r.join("=")}),e}function sQ(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function uQ(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if("".concat(+e)===e)return+e;throw new Error("Could not parse value flag value ".concat(e," for flag ").concat(n,"."))}function vt(){return A.ENV}A.ENV=null;function cQ(n){A.ENV=n}var Zg;function YA(){if(Zg==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Zg=n}return Zg}function lQ(){var n=YA();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function A0(n,e){var t=lQ();if(t.has(n))return t.get(n);var r=e();return t.set(n,r),t.get(n)}var ZA="Abs",JA="Acos",QA="Acosh",_0="Add",e_="AddN",t_="All",n_="Any",r_="ArgMax",a_="ArgMin",i_="Asin",o_="Asinh",s_="Atan",u_="Atanh",c_="Atan2",l_="AvgPool",fQ="AvgPoolGrad",f_="AvgPool3D",hQ="AvgPool3DGrad",h_="BatchMatMul",d_="BatchToSpaceND",p_="Bincount",dQ="BroadcastTo",v_="BroadcastArgs",D0="Cast",m_="Ceil",g_="ClipByValue",y_="Complex",b_="ComplexAbs",w_="Concat",x_="Conv2D",k_="Conv2DBackpropFilter",S_="Conv2DBackpropInput",N_="Conv3D",pQ="Conv3DBackpropFilterV2",T_="Conv3DBackpropInputV2",E_="Cos",I_="Cosh",C_="Cumprod",A_="Cumsum",__="CropAndResize",D_="DenseBincount",F_="DepthToSpace",R_="DepthwiseConv2dNative",O_="DepthwiseConv2dNativeBackpropFilter",P_="DepthwiseConv2dNativeBackpropInput",M_="Diag",B_="Dilation2D",vQ="Dilation2DBackpropInput",mQ="Dilation2DBackpropFilter",L_="RealDiv",z_="Einsum",$_="Elu",gQ="EluGrad",q_="Erf",W_="Equal",V_="Exp",G_="ExpandDims",U_="Expm1",H_="FFT",K_="Fill",j_="FlipLeftRight",X_="Floor",Y_="FloorDiv",Z_="FusedBatchNorm",J_="GatherV2",Q_="GatherNd",eD="Greater",tD="GreaterEqual",F0="Identity",nD="IFFT",rD="Imag",aD="IsFinite",iD="IsInf",oD="IsNan",sD="LeakyRelu",uD="Less",cD="LessEqual",lD="LinSpace",fD="Log",hD="Log1p",dD="LogicalAnd",pD="LogicalNot",vD="LogicalOr",yQ="LogicalXor",bQ="LogSoftmax",wQ="LowerBound",mD="LRN",xQ="LRNGrad",gD="Max",yD="Maximum",bD="MaxPool",kQ="MaxPoolGrad",wD="MaxPool3D",SQ="MaxPool3DGrad",xD="MaxPoolWithArgmax",kD="Mean",SD="Min",ND="Minimum",TD="MirrorPad",ED="Mod",ID="Multinomial",CD="Multiply",AD="Neg",_D="NotEqual",DD="NonMaxSuppressionV3",FD="NonMaxSuppressionV4",RD="NonMaxSuppressionV5",OD="OnesLike",PD="OneHot",MD="Pack",BD="PadV2",NQ="Pool",LD="Pow",zD="Prelu",$D="Prod",qD="RaggedGather",WD="RaggedRange",VD="RaggedTensorToTensor",GD="Range",UD="Real",HD="Reciprocal",KD="Relu",jD="Reshape",XD="ResizeNearestNeighbor",TQ="ResizeNearestNeighborGrad",YD="ResizeBilinear",EQ="ResizeBilinearGrad",ZD="Relu6",JD="Reverse",QD="Round",e3="Rsqrt",t3="ScatterNd",n3="SearchSorted",r3="Select",a3="Selu",i3="Slice",o3="Sin",s3="Sinh",u3="Sign",c3="Sigmoid",l3="Softplus",f3="Sqrt",h3="Sum",d3="SpaceToBatchND",p3="SplitV",v3="Softmax",m3="SparseFillEmptyRows",g3="SparseReshape",y3="SparseSegmentMean",b3="SparseSegmentSum",w3="SparseToDense",x3="SquaredDifference",IQ="Square",k3="StridedSlice",S3="StringNGrams",N3="StringSplit",T3="StringToHashBucketFast",E3="Sub",I3="Tan",C3="Tanh",R0="Tile",A3="TopK",_3="Transform",Bd="Transpose",D3="Unique",F3="Unpack",R3="UnsortedSegmentSum",CQ="UpperBound",O3="ZerosLike",P3="Step",a0="FromPixels",M3="RotateWithOffset",i0="_FusedMatMul",o0="FusedConv2D",s0="FusedDepthwiseConv2D";function To(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn.apply(console,wt([],ke(n),!1))}function AQ(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.log.apply(console,wt([],ke(n),!1))}var Yu=A0("kernelRegistry",function(){return new Map}),Vl=A0("gradRegistry",function(){return new Map});function Gd(n,e){var t=O0(n,e);return Yu.get(t)}function u0(n){return Vl.get(n)}function Ud(n){for(var e=Yu.entries(),t=[];;){var r=e.next(),a=r.done,i=r.value;if(a)break;var o=ke(i,2),s=o[0],u=o[1],c=ke(s.split("_"),1),l=c[0];l===n&&t.push(u)}return t}function B3(n){var e=n.kernelName,t=n.backendName,r=O0(e,t);Yu.has(r)&&To("The kernel '".concat(e,"' for backend ")+"'".concat(t,"' is already registered")),Yu.set(r,n)}function _Q(n){var e=n.kernelName;Vl.has(e)&&vt().getBool("DEBUG")&&To("Overriding the gradient for '".concat(e,"'")),Vl.set(e,n)}function DQ(n,e){var t=O0(n,e);if(!Yu.has(t))throw new Error("The kernel '".concat(n,"' for backend ")+"'".concat(e,"' is not registered"));Yu.delete(t)}function FQ(n){if(!Vl.has(n))throw new Error("The gradient '".concat(n,"' for backend is not registered"));Vl.delete(n)}function RQ(n,e){var t=Ud(n);t.forEach(function(r){var a=Object.assign({},r,{backendName:e});B3(a)})}function O0(n,e){return"".concat(e,"_").concat(n)}var c0=Ht,Ta=null;try{Ta=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ht(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Ht.prototype.__isLong__;Object.defineProperty(Ht.prototype,"__isLong__",{value:!0});function Gr(n){return(n&&n.__isLong__)===!0}Ht.isLong=Gr;var wA={},xA={};function Ts(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=xA[n],r)?r:(t=Kt(n,(n|0)<0?-1:0,!0),a&&(xA[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=wA[n],r)?r:(t=Kt(n,n<0?-1:0,!1),a&&(wA[n]=t),t))}Ht.fromInt=Ts;function Ea(n,e){if(isNaN(n))return e?vs:Ia;if(e){if(n<0)return vs;if(n>=L3)return q3}else{if(n<=-SA)return qr;if(n+1>=SA)return $3}return n<0?Ea(-n,e).neg():Kt(n%Zu|0,n/Zu|0,e)}Ht.fromNumber=Ea;function Kt(n,e,t){return new Ht(n,e,t)}Ht.fromBits=Kt;var Hd=Math.pow;function P0(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ia;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return P0(n.substring(1),e,t).neg();for(var a=Ea(Hd(t,8)),i=Ia,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Ea(Hd(t,s));i=i.mul(c).add(Ea(u))}else i=i.mul(a),i=i.add(Ea(u))}return i.unsigned=e,i}Ht.fromString=P0;function ai(n,e){return typeof n=="number"?Ea(n,e):typeof n=="string"?P0(n,e):Kt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Ht.fromValue=ai;var kA=1<<16,OQ=1<<24,Zu=kA*kA,L3=Zu*Zu,SA=L3/2,NA=Ts(OQ),Ia=Ts(0);Ht.ZERO=Ia;var vs=Ts(0,!0);Ht.UZERO=vs;var Wu=Ts(1);Ht.ONE=Wu;var z3=Ts(1,!0);Ht.UONE=z3;var l0=Ts(-1);Ht.NEG_ONE=l0;var $3=Kt(-1,2147483647,!1);Ht.MAX_VALUE=$3;var q3=Kt(-1,-1,!0);Ht.MAX_UNSIGNED_VALUE=q3;var qr=Kt(0,-2147483648,!1);Ht.MIN_VALUE=qr;var _e=Ht.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*Zu+(this.low>>>0):this.high*Zu+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(qr)){var t=Ea(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ea(Hd(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(qr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return Gr(e)||(e=ai(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(Gr(e)||(e=ai(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(qr)?qr:this.not().add(Wu)};_e.neg=_e.negate;_e.add=function(e){Gr(e)||(e=ai(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,d=0;return d+=i+c,h+=d>>>16,d&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Kt(h<<16|d,l<<16|f,this.unsigned)};_e.subtract=function(e){return Gr(e)||(e=ai(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return Ia;if(Gr(e)||(e=ai(e)),Ta){var t=Ta.mul(this.low,this.high,e.low,e.high);return Kt(t,Ta.get_high(),this.unsigned)}if(e.isZero())return Ia;if(this.eq(qr))return e.isOdd()?qr:Ia;if(e.eq(qr))return this.isOdd()?qr:Ia;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(NA)&&e.lt(NA))return Ea(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,d=0,p=0;return p+=o*l,d+=p>>>16,p&=65535,d+=i*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,Kt(d<<16|p,f<<16|h,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(Gr(e)||(e=ai(e)),e.isZero())throw Error("division by zero");if(Ta){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ta.div_u:Ta.div_s)(this.low,this.high,e.low,e.high);return Kt(t,Ta.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?vs:Ia;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return vs;if(e.gt(this.shru(1)))return z3;i=vs}else{if(this.eq(qr)){if(e.eq(Wu)||e.eq(l0))return qr;if(e.eq(qr))return Wu;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ia)?e.isNegative()?Wu:l0:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(qr))return this.unsigned?vs:Ia;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ia}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:Hd(2,s-48),c=Ea(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Ea(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=Wu),i=i.add(c),a=a.sub(l)}return i};_e.div=_e.divide;_e.modulo=function(e){if(Gr(e)||(e=ai(e)),Ta){var t=(this.unsigned?Ta.rem_u:Ta.rem_s)(this.low,this.high,e.low,e.high);return Kt(t,Ta.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return Kt(~this.low,~this.high,this.unsigned)};_e.and=function(e){return Gr(e)||(e=ai(e)),Kt(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return Gr(e)||(e=ai(e)),Kt(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return Gr(e)||(e=ai(e)),Kt(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return Gr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Kt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Kt(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return Gr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Kt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Kt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(Gr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return Kt(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Kt(t,0,this.unsigned):Kt(t>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?Kt(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:Kt(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Ht.fromBytes=function(e,t,r){return r?Ht.fromBytesLE(e,t):Ht.fromBytesBE(e,t)};Ht.fromBytesLE=function(e,t){return new Ht(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Ht.fromBytesBE=function(e,t){return new Ht(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var PQ=$J({__proto__:null,default:c0},[c0]),ps=c0||PQ;function rf(n){return ps.fromString(n,!0,16)}var W3=rf("c3a5c85c97cb3127"),hs=rf("b492b66fbe98f273"),vr=rf("9ae16a3b2f90404f");function f0(n){return n.xor(n.shru(47))}function V3(n,e,t){var r=n.slice(e,e+t);return ps.fromBytes(Array.from(r),!0,!0)}function $t(n,e){return V3(n,e,8)}function TA(n,e){return V3(n,e,4)}function Hn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Co(n,e,t){t===void 0&&(t=rf("9ddfea08eb382d69"));var r=n.xor(e).mul(t);r=r.xor(r.shru(47));var a=e.xor(r).mul(t);return a=a.xor(a.shru(47)),a=a.mul(t),a}function MQ(n,e,t,r,a,i){a=a.add(n),i=Hn(i.add(a).add(r),21);var o=a;return a=a.add(e),a=a.add(t),i=i.add(Hn(a,44)),[a.add(r),i.add(o)]}function Pd(n,e,t,r){return MQ($t(n,e),$t(n,e+8),$t(n,e+16),$t(n,e+24),t,r)}function BQ(n,e){if(e===void 0&&(e=n.length),e>=8){var t=vr.add(e*2),r=$t(n,0).add(vr),a=$t(n,e-8),i=Hn(a,37).mul(t).add(r),o=Hn(r,25).add(a).mul(t);return Co(i,o,t)}if(e>=4){var t=vr.add(e*2),r=TA(n,0);return Co(r.shl(3).add(e),TA(n,e-4),t)}if(e>0){var r=n[0],a=n[e>>1],i=n[e-1],s=r+(a<<8),u=e+(i<<2);return f0(vr.mul(s).xor(W3.mul(u))).mul(vr)}return vr}function LQ(n,e){e===void 0&&(e=n.length);var t=vr.add(e*2),r=$t(n,0).mul(hs),a=$t(n,8),i=$t(n,e-8).mul(t),o=$t(n,e-16).mul(vr);return Co(Hn(r.add(a),43).add(Hn(i,30)).add(o),r.add(Hn(a.add(vr),18)).add(i),t)}function zQ(n,e){e===void 0&&(e=n.length);var t=vr.add(e*2),r=$t(n,0).mul(vr),a=$t(n,8),i=$t(n,e-8).mul(t),o=$t(n,e-16).mul(vr),s=Hn(r.add(a),43).add(Hn(i,30)).add(o),u=Co(s,r.add(Hn(a.add(vr),18)).add(i),t),c=$t(n,16).mul(t),l=$t(n,24),f=s.add($t(n,e-32)).mul(t),h=u.add($t(n,e-24)).mul(t);return Co(Hn(c.add(l),43).add(Hn(f,30)).add(h),c.add(Hn(l.add(r),18)).add(f),t)}function $Q(n,e){var t,r;e===void 0&&(e=n.length);var a=ps.fromNumber(81,!0);if(e<=32)return e<=16?BQ(n,e):LQ(n,e);if(e<=64)return zQ(n,e);var i=a,o=a.mul(hs).add(113),s=f0(o.mul(vr).add(113)).mul(vr),u=[ps.UZERO,ps.UZERO],c=[ps.UZERO,ps.UZERO];i=i.mul(vr).add($t(n,0));var l=0,f=(e-1>>6)*64,h=f+(e-1&63)-63;do i=Hn(i.add(o).add(u[0]).add($t(n,l+8)),37).mul(hs),o=Hn(o.add(u[1]).add($t(n,l+48)),42).mul(hs),i=i.xor(c[1]),o=o.add(u[0]).add($t(n,l+40)),s=Hn(s.add(c[0]),33).mul(hs),u=Pd(n,l,u[1].mul(hs),i.add(c[0])),c=Pd(n,l+32,s.add(c[1]),o.add($t(n,l+16))),t=ke([i,s],2),s=t[0],i=t[1],l+=64;while(l!==f);var d=hs.add(s.and(255).shl(1));return l=h,c[0]=c[0].add(e-1&63),u[0]=u[0].add(c[0]),c[0]=c[0].add(u[0]),i=Hn(i.add(o).add(u[0]).add($t(n,l+8)),37).mul(d),o=Hn(o.add(u[1]).add($t(n,l+48)),42).mul(d),i=i.xor(c[1].mul(9)),o=o.add(u[0].mul(9).add($t(n,l+40))),s=Hn(s.add(c[0]),33).mul(d),u=Pd(n,l,u[1].mul(d),i.add(c[0])),c=Pd(n,l+32,s.add(c[1]),o.add($t(n,l+16))),r=ke([i,s],2),s=r[0],i=r[1],Co(Co(u[0],c[0],d).add(f0(o).mul(W3)).add(s),Co(u[1],c[1],d).add(i),d)}function qQ(n,e){return e==="string"?af(n):ap([n],e)}function WQ(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function ap(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=_o(n)),vt().getBool("DEBUG")&&VA(n,e),WQ(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var t=new Uint8Array(n.length),r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Gl(){return vt().platform.now()}function VQ(n,e){return vt().platform.fetch(n,e)}function af(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",vt().platform.encode(n,e)}function Kd(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",vt().platform.decode(n,e)}function er(n){return vt().platform.isTypedArray(n)}function _o(n,e,t){var r,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||rp(n)||n==null||er(n)&&t)e.push(n);else if(Array.isArray(n)||er(n))for(var i=0;i<n.length;++i)_o(n[i],e,t);else{var o=-1;try{for(var s=cr(Object.keys(n)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){r={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}for(var i=0;i<=o;i++)_o(n[i],e,t)}return e}var GQ={__proto__:null,createScalarValue:qQ,toTypedArray:ap,now:Gl,fetch:VQ,encodeString:af,decodeString:Kd,isTypedArray:er,flatten:_o,shuffle:zA,shuffleCombo:GJ,clamp:Wl,nearestLargerEven:UJ,swap:qd,sum:HJ,randUniform:KJ,distSquared:jJ,assert:q,assertShapesMatch:mr,assertNonNull:Ns,sizeFromShape:Ut,isScalarShape:XJ,arraysEqual:Ro,isInt:Xu,tanh:YJ,sizeToSquarishShape:ZJ,createShuffledIndices:JJ,rightPad:zl,repeatedTry:QJ,inferFromImplicitShape:eQ,parseAxisParam:nf,squeezeShape:$A,getTypedArrayFromDType:qA,getArrayFromDType:WA,checkConversionForErrors:VA,isValidDtype:GA,hasEncodingLoss:tQ,bytesPerElement:Wd,bytesFromStringArray:UA,isString:Eo,isBoolean:HA,isNumber:KA,inferDtype:tp,isFunction:Ao,nearestDivisor:Vd,computeStrides:ec,toNestedArray:Vu,convertBackendValuesAndArrayBuffer:nQ,makeOnesTypedArray:C0,makeZerosTypedArray:np,makeZerosNestedTypedArray:rQ,assertNonNegativeIntegerDimensions:Vr,locToIndex:aQ,indexToLoc:iQ,isPromise:rp,hexToLong:rf,fingerPrint64:$Q},UQ=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new KQ)}return n.prototype.profileKernel=function(e,t,r){var a,i,o,s=function(){o=r()},u,c=Gl();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=cr(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Gl()-c})}if(vt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var d=function(m){var g=o[m];g.data().then(function(y){HQ(y,g.dtype,e)})},p=0;p<o.length;p++)d(p);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},n.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(r,u,c[0],c[1],o,c[2])})})},n}();function HQ(n,e,t){if(e!=="float32")return!1;for(var r=0;r<n.length;r++){var a=n[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var KQ=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,a,i,o){var s=typeof a=="number"?zl("".concat(a,"ms"),9):a.error,u=zl(e,25),c=t.rank,l=t.size,f=zl(t.shape.toString(),14),h="";for(var d in i){var p=i[d];if(p!=null){var v=p.shape||t.shape,m=v.length;h+="".concat(d,": ").concat(m,"D ").concat(m>0?v:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function jQ(n,e,t){for(var r={},a={},i=0;i<e.length;i++)r[e[i].id]=!0;for(var i=0;i<n.length;i++){var o=n[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(r[c.id]){o.outputs.forEach(function(b){return r[b.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var d={},i=n.length-1;i>=0;i--)for(var o=n[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,d[o.id]=!0;break}for(var p=[],i=0;i<n.length;i++){var o=n[i];if(a[o.id]&&d[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,p.push(g)}}return p}function XQ(n,e,t,r){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var d=n[h.id];d!=null?u.push(d):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var d=t(function(){return c[h]()});if(d.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(d.dtype,"'"));var p=s.inputs[h];if(!Ro(d.shape,p.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(d.shape,"', which does not match ")+"the shape of the input '".concat(p.shape,"'"));if(n[p.id]==null)n[p.id]=d;else{var v=n[p.id];n[p.id]=r(v,d),v.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var EA=20,Ml=3,Jg=7;function YQ(n,e,t,r){var a=ec(e),i=ZQ(n,e,t,a),o=e.length,s=Ld(n,e,t,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function ZQ(n,e,t,r){var a=Ut(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Ll(n):n;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Bl(u[l+f],0,t).length);return o}function Bl(n,e,t){var r;return Array.isArray(n)?r="".concat(parseFloat(n[0].toFixed(Jg))," + ")+"".concat(parseFloat(n[1].toFixed(Jg)),"j"):Eo(n)?r="'".concat(n,"'"):t==="bool"?r=G3(n):r=parseFloat(n.toFixed(Jg)).toString(),zl(r,e)}function G3(n){return n===0?"false":"true"}function Ld(n,e,t,r,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Ll(n);return[Bl(c[0],0,t)]}return t==="bool"?[G3(n[0])]:[n[0].toString()]}if(u===1){if(s>EA){var l=Ml*o,f=Array.from(n.slice(0,l)),h=Array.from(n.slice((s-Ml)*o,s*o));return t==="complex64"&&(f=Ll(f),h=Ll(h)),["["+f.map(function(T,E){return Bl(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Bl(T,a[s-Ml+E],t)}).join(", ")+"]"]}var d=t==="complex64"?Ll(n):Array.from(n);return["["+d.map(function(T,E){return Bl(T,a[E],t)}).join(", ")+"]"]}var p=e.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>EA){for(var y=0;y<Ml;y++){var b=y*m,w=b+m;g.push.apply(g,wt([],ke(Ld(n.slice(b,w),p,t,v,a,!1)),!1))}g.push("...");for(var y=s-Ml;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,wt([],ke(Ld(n.slice(b,w),p,t,v,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,wt([],ke(Ld(n.slice(b,w),p,t,v,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var N=`,
`,y=2;y<u;y++)N+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function Ll(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var jd=function(){function n(e,t,r){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Ut(e),r!=null){var i=r.length;q(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||WA(t,this.size),this.strides=ec(e)}return n.prototype.set=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),q(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e,t,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r.length===0&&(r=[0]);var i=0;try{for(var o=cr(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(r,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=r[r.length-1],f=0;f<r.length-1;++f)l+=this.strides[f]*r[f];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.toTensor=function(){return ti().makeTensor(this.values,this.shape,this.dtype)},n}(),ti=null,$u=null;function JQ(n){ti=n}function QQ(n){$u=n}var Pn=function(){function n(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ut(e),this.strides=ec(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.buffer=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,$u.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return $u.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Vu(this.shape,e,this.dtype==="complex64")]}})})},n.prototype.arraySync=function(){return Vu(this.shape,this.dataSync(),this.dtype==="complex64")},n.prototype.data=function(){return je(this,void 0,void 0,function(){var e,t;return Xe(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=ti().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(a){return Kd(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataToGPU=function(e){return this.throwIfDisposed(),ti().readToGPU(this.dataId,e)},n.prototype.dataSync=function(){this.throwIfDisposed();var e=ti().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Kd(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ti().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(ti().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.print=function(e){return e===void 0&&(e=!1),$u.print(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),$u.clone(this)},n.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return YQ(t,this.shape,this.dtype,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),$u.cast(this,e)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),ti().makeVariable(this,e,t,r)},n}();Object.defineProperty(Pn,Symbol.hasInstance,{value:function(n){return!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null}});function eee(){return A0("Tensor",function(){return Pn})}eee();var Ul=function(n){Ji(e,n);function e(t,r,a,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Ro(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));ti().disposeTensor(this),this.dataId=t.dataId,ti().incRef(this,null)},e.prototype.dispose=function(){ti().disposeVariable(this),this.isDisposedInternal=!0},e}(Pn);Object.defineProperty(Ul,Symbol.hasInstance,{value:function(n){return n instanceof Pn&&n.assign!=null&&n.assign instanceof Function}});A.Rank=void 0;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(A.Rank||(A.Rank={}));var h0;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(h0||(h0={}));var d0;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(d0||(d0={}));var p0;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(p0||(p0={}));var v0;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(v0||(v0={}));var tee={float32:p0,int32:h0,bool:d0,complex64:v0};function ip(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(n," with ").concat(e))}return tee[n][e]}function nee(n){return ip(n,"int32")}function vn(n,e){if(n.dtype===e.dtype)return[n,e];var t=ip(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function U3(n,e){q(n.dtype===e.dtype,function(){return"The dtypes of the first(".concat(n.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function ree(n,e){return e.some(function(t){return t.id===n.id})}function M0(n){var e=[],t=new Set;return H3(n,e,t),e}function H3(n,e,t){if(n!=null){if(n instanceof Pn){e.push(n);return}if(!!aee(n)){var r=n;for(var a in r){var i=r[a];t.has(i)||(t.add(i),H3(i,e,t))}}}}function aee(n){return Array.isArray(n)||typeof n=="object"}var iee={__proto__:null,makeTypesMatch:vn,assertTypesMatch:U3,isTensorInList:ree,getTensorsInContainer:M0};function Qg(n){return n.kernelName!=null}var IA=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),B0=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new IA}return n.prototype.ready=function(){return je(this,void 0,void 0,function(){var e,t,r,a;return Xe(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,r=e.asyncInit;if(r)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(To("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o;return Xe(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,a=t.asyncInit,a?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new UQ(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this,t=Ud(this.backendName);t.forEach(function(r){r.setupFunc!=null&&r.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this,r=Ud(e);r.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=r.factory();if(a&&!(a instanceof LA)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,To("Initialization of backend ".concat(e," failed")),To(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return To("Initialization of backend ".concat(e," failed")),To(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],a=this.initializeBackend(r),i=a.success,o=a.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},n.prototype.scopedRun=function(e,t,r){e();try{var a=r();return t(),a}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=U.runKernel(F0,{x:e}),r={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return U.runKernel(D0,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t},n.prototype.runKernel=function(e,t,r){this.backendName==null&&this.backend;var a=Gd(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var a=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},n.prototype.runKernelFunc=function(e){var t=this,r,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=Qg(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Qg(e)){var f=e.kernelName,h=e.inputs,d=e.attrs;this.backendName==null&&this.backend;var p=Gd(f,this.backendName);q(p!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=p.kernelFunc({inputs:h,attrs:d,backend:t.backend});var N=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,N);var T=N.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var v=e.forwardFunc,m=function(x){!i||(a=x.map(function(N){return t.keep(t.clone(N))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return v(t.backend,m)});var N=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,N),N}}var g=e.inputs,y=e.attrs,b=Qg(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?r=u():(w=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),r=w.outputs)}),i&&this.addTapeNode(l,g,r,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:r.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(c)?r:r[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this,r=e.map(function(a){return t.keep(t.clone(a))});return r},n.prototype.getTensorsForGradient=function(e,t,r){var a=u0(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(q(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return o[l]});return s.concat(u)}return[]},n.prototype.makeTensor=function(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var i=e;r==="string"&&Eo(e[0])&&(i=e.map(function(l){return af(l)}));var o=a.write(i,t,r),s=new Pn(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){var u=this.state.tensorInfo.get(o),c=UA(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,a){r=r||"float32";var i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)},n.prototype.makeTensorFromTensorInfo=function(e,t){var r=e.dataId,a=e.shape,i=e.dtype,o=new Pn(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o},n.prototype.makeVariable=function(e,t,r,a){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Ul(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Wd(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Ul||this.track(e)},n.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},n.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},n.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var r=e.size*Wd(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Xe(this,function(d){switch(d.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=d.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,wt([],ke(this.state.activeProfile.kernels.map(function(p){return p.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,d.label=2;case 2:d.trys.push([2,8,9,10]),i=cr(this.state.activeProfile.kernels),o=i.next(),d.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=d.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=d.sent(),d.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=d.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=u0(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var d=r[h],p=np(d.size,d.dtype);return s.makeTensor(p,d.shape,d.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=M0(e),a=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},n.prototype.gradients=function(e,t,r,a){var i=this;if(a===void 0&&(a=!1),q(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(r.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});q(o instanceof Pn,function(){return"The result y returned by f() must be a tensor."});var s=jQ(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=r??oee(o.shape),XQ(u,s,function(l){return i.tidy(l)},see);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var d=cr(l.saved),p=d.next();!p.done;p=d.next()){var v=p.value;v.dispose()}}catch(m){f={error:m}}finally{try{p&&!p.done&&(h=d.return)&&h.call(d)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},n.prototype.customGrad=function(e){var t=this;return q(Ao(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];q(r.every(function(c){return c instanceof Pn}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};r.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,wt([],ke(wt(wt([],ke(r),!1),[l],!1)),!1)),q(i.value instanceof Pn,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),q(Ao(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];q(h.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),q(h.every(function(p){return p instanceof Pn}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return h.forEach(function(p,v){d[v]=function(){return p}}),d};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},n.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},n.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},n.prototype.readToGPU=function(e,t){var r=this.state.tensorInfo.get(e);return r.backend.readToGPU(e,t)},n.prototype.time=function(e){return je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){switch(a.label){case 0:return t=Gl(),[4,this.backend.time(e)];case 1:return r=a.sent(),r.wallMs=Gl()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new IA;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n}();B0.nextTensorId=0;B0.nextVariableId=0;function oee(n){var e=C0(Ut(n),"float32");return U.makeTensor(e,n,"float32")}function K3(){var n=YA();if(n._tfengine==null){var e=new XA(n);n._tfengine=new B0(e)}return cQ(n._tfengine.ENV),JQ(function(){return n._tfengine}),n._tfengine}var U=K3();function see(n,e){var t={a:n,b:e};return U.runKernel(_0,t)}function uee(){return typeof navigator<"u"&&navigator!=null}var m0;function cee(n){m0=n}function lee(n){if(m0!==void 0)return m0;if(n||uee()){if(n||(n=navigator),n.product==="ReactNative")return!0;var e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){var t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function j3(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var fee={__proto__:null,mockIsMobile:cee,isMobile:lee,isBrowser:j3};var la=vt();la.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});la.registerFlag("IS_BROWSER",function(){return j3()});la.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});la.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});la.registerFlag("PROD",function(){return!1});la.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return la.getBool("DEBUG")});la.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});la.registerFlag("IS_TEST",function(){return!1});la.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});la.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});la.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});la.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function Ci(n,e){var t=n;if(er(n))return e==="string"?[]:[n.length];var r=typeof n=="object";if(r){if("texture"in n){var a=n.channels||"RGBA";return[n.height,n.width*a.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:Wd(e))]}if(!Array.isArray(n))return[];for(var i=[];Array.isArray(t)||er(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&vt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&X3(n,i,[]),i}function X3(n,e,t){if(t=t||[],!Array.isArray(n)&&!er(n)){q(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}q(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(n.length," elements")}),q(n.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(n.length," elements")});for(var r=e.slice(1),a=0;a<n.length;++a)X3(n[a],r,t.concat(a))}function CA(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(r,"' must ")+"be ".concat(n," tensor, but got ").concat(e," tensor"))}}function P(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Pn)return CA(r,n.dtype,e,t),n;var a=tp(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),CA(r,a,e,t),n==null||!er(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Ci(n,a);!er(n)&&!Array.isArray(n)&&(n=[n]);var s=!0,u=a!=="string"?ap(n,a):_o(n,[],s);return U.makeTensor(u,o,a)}function Hl(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=n;return a.map(function(i,o){return P(i,"".concat(e,"[").concat(o,"]"),t,r)})}var Y3="__op";function H(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Y3;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];U.startScope(t);try{var s=r.apply(void 0,wt([],ke(i),!1));return rp(s)&&console.error("Cannot return a Promise inside of tidy."),U.endScope(s),s}catch(u){throw U.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function hee(n,e){var t=P(n,"real","complex"),r=P(e,"imag","complex");mr(t.shape,r.shape,"real and imag shapes, ".concat(t.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:r};return U.runKernel(y_,a)}var Do=H({complex_:hee});function Oo(n,e,t,r){if(r==null)r=tp(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return U.backend.createTensorFromGPUData(n,e||t,r)}if(!er(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Vr(e);var a=Ut(e),i=Ut(t);q(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Ut(e.slice(o)):!0;q(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!er(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?ap(n,r):_o(n,[],!0),U.makeTensor(n,e,r)}function Gu(n,e,t){var r=Ci(n,t);return Oo(n,e,r,t)}var g0={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Xd=4;function dee(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u=this;return Xe(this,function(c){switch(c.label){case 0:for(t=[],r=[],a=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),i=function(l){var f=a[l],h=Array.isArray(n)?n[l].tensor:n[f];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h.dtype));var d={name:f,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var p=new Promise(function(v){return je(u,void 0,void 0,function(){var m,g,y,b,w,x,N;return Xe(this,function(T){switch(T.label){case 0:return[4,h.bytes()];case 1:for(m=T.sent(),g=m.reduce(function(E,C){return E+C.length},0)+Xd*m.length,y=new Uint8Array(g),b=0,w=0;w<m.length;w++)x=m[w],N=new Uint8Array(new Uint32Array([x.length]).buffer),y.set(N,b),b+=Xd,y.set(x,b),b+=x.length;return v(y),[2]}})})});r.push(p)}else r.push(h.data());e!=null&&(d.group=e),t.push(d)},o=0;o<a.length;++o)i(o);return[4,Promise.all(r)];case 1:return s=c.sent(),[2,{data:pee(s),specs:t}]}})})}function Z3(n,e){var t,r,a={},i,o=0;try{for(var s=cr(e),u=s.next();!u.done;u=s.next()){var c=u.value,l=c.name,f=c.dtype,h=c.shape,d=Ut(h),p=void 0;if("quantization"in c){var v=c.quantization;if(v.dtype==="uint8"||v.dtype==="uint16"){if(!("min"in v&&"scale"in v))throw new Error("Weight ".concat(c.name," with quantization ").concat(v.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(v.dtype==="float16"){if(f!=="float32")throw new Error("Weight ".concat(c.name," is quantized with ").concat(v.dtype," ")+"which only supports weights of type float32 not ".concat(f,"."))}else throw new Error("Weight ".concat(c.name," has unknown ")+"quantization dtype ".concat(v.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var m=g0[v.dtype],g=n.slice(o,o+d*m),y=v.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(f==="float32")if(v.dtype==="uint8"||v.dtype==="uint16"){p=new Float32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];p[b]=w*v.scale+v.min}}else if(v.dtype==="float16")i===void 0&&(i=wee()),p=i(y);else throw new Error("Unsupported quantization type ".concat(v.dtype," ")+"for weight type float32.");else if(f==="int32"){if(v.dtype!=="uint8"&&v.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(v.dtype," ")+"for weight type int32.");p=new Int32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];p[b]=Math.round(w*v.scale+v.min)}}else throw new Error("Unsupported dtype in weight '".concat(l,"': ").concat(f));o+=d*m}else if(f==="string"){var x=Ut(c.shape);p=[];for(var b=0;b<x;b++){var N=new Uint32Array(n.slice(o,o+Xd))[0];o+=Xd;var T=new Uint8Array(n.slice(o,o+N));p.push(T),o+=N}}else{var E=g0[f],g=n.slice(o,o+d*E);if(f==="float32")p=new Float32Array(g);else if(f==="int32")p=new Int32Array(g);else if(f==="bool")p=new Uint8Array(g);else if(f==="complex64"){p=new Float32Array(g);for(var C=new Float32Array(p.length/2),F=new Float32Array(p.length/2),b=0;b<C.length;b++)C[b]=p[b*2],F[b]=p[b*2+1];var D=Gu(C,h,"float32"),O=Gu(F,h,"float32");a[l]=Do(D,O),D.dispose(),O.dispose()}else throw new Error("Unsupported dtype in weight '".concat(l,"': ").concat(f));o+=d*E}f!=="complex64"&&(a[l]=Gu(p,h,f))}}catch(L){t={error:L}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return a}function pee(n){if(n===null)throw new Error("Invalid input value: ".concat(JSON.stringify(n)));var e=0,t=[];n.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(i.constructor.name))});var r=new Uint8Array(e),a=0;return t.forEach(function(i){r.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),r.buffer}var L0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function AA(n){return L0?Buffer.byteLength(n):new Blob([n]).size}function vee(n){if(L0)return Buffer.from(n).toString("base64");for(var e=new Uint8Array(n),t="",r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function mee(n){if(L0){var e=Buffer.from(n,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(n),r=new Uint8Array(t.length),a=0;a<t.length;++a)r.set([t.charCodeAt(a)],a);return r.buffer}function z0(n){if(n.length===1)return n[0];var e=0;n.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(a){t.set(new Uint8Array(a),r),r+=a.byteLength}),t.buffer}function _A(n){var e="/";for(n=n.trim();n.endsWith(e);)n=n.slice(0,n.length-1);var t=n.split(e);return t[t.length-1]}function J3(n,e){var t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function Q3(n,e,t){var r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}function $0(n,e){return je(this,void 0,void 0,function(){var t,r,a;return Xe(this,function(i){switch(i.label){case 0:return n.weightsManifest==null?[3,2]:[4,e(n.weightsManifest)];case 1:a=ke.apply(void 0,[i.sent(),2]),t=a[0],r=a[1],i.label=2;case 2:return[2,Q3(n,t,r)]}})})}function of(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:AA(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:AA(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function eF(n){var e,t,r=[];try{for(var a=cr(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.push.apply(r,wt([],ke(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}function gee(){var n=function(r){for(var a=r<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=n(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function yee(){var n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(var e=1;e<31;e++)n[e]=e<<23;for(var e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function bee(){for(var n=new Uint32Array(64),e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function wee(){var n=gee(),e=yee(),t=bee();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=n[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var fa=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var a=[],i=t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,r);s!==null&&a.push(s)}),a},n}(),xee=function(n){return fa.registerSaveRouter(n)},kee=function(n){return fa.registerLoadRouter(n)},See=function(n){return fa.getSaveHandlers(n)},Nee=function(n,e){return fa.getLoadHandlers(n,e)},y0="tensorflowjs",b0=1,ms="models_store",Io="model_info_store";function tF(){if(!vt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function w0(n){var e=n.result;e.createObjectStore(ms,{keyPath:"modelPath"}),e.createObjectStore(Io,{keyPath:"modelPath"})}var bs=function(){function n(e){if(this.indexedDB=tF(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){return Xe(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return je(this,void 0,void 0,function(){return Xe(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(a,i){var o=r.indexedDB.open(y0,b0);o.onupgradeneeded=function(){return w0(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(ms,"readonly"),c=u.objectStore(ms),l=c.get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(r.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var f=of(t),h=s.transaction(Io,"readwrite"),d=h.objectStore(Io),p=d.put({modelPath:r.modelPath,modelArtifactsInfo:f}),v;p.onsuccess=function(){v=s.transaction(ms,"readwrite");var m=v.objectStore(ms),g=m.put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){d=h.objectStore(Io);var b=d.delete(r.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},p.onerror=function(m){return s.close(),i(p.error)},h.oncomplete=function(){v==null?s.close():v.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},n}();bs.URL_SCHEME="indexeddb://";var nF=function(n){return vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(bs.URL_SCHEME)?Tee(n.slice(bs.URL_SCHEME.length)):null};fa.registerSaveRouter(nF);fa.registerLoadRouter(nF);function Tee(n){return new bs(n)}function Eee(n){return n.startsWith(bs.URL_SCHEME)?n.slice(bs.URL_SCHEME.length):n}var Iee=function(){function n(){this.indexedDB=tF()}return n.prototype.listModels=function(){return je(this,void 0,void 0,function(){var e=this;return Xe(this,function(t){return[2,new Promise(function(r,a){var i=e.indexedDB.open(y0,b0);i.onupgradeneeded=function(){return w0(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(Io,"readonly"),u=s.objectStore(Io),c=u.getAll();c.onsuccess=function(){var l,f,h={};try{for(var d=cr(c.result),p=d.next();!p.done;p=d.next()){var v=p.value;h[v.modelPath]=v.modelArtifactsInfo}}catch(m){l={error:m}}finally{try{p&&!p.done&&(f=d.return)&&f.call(d)}finally{if(l)throw l.error}}r(h)},c.onerror=function(l){return o.close(),a(c.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},n.prototype.removeModel=function(e){return je(this,void 0,void 0,function(){var t=this;return Xe(this,function(r){return e=Eee(e),[2,new Promise(function(a,i){var o=t.indexedDB.open(y0,b0);o.onupgradeneeded=function(){return w0(o)},o.onsuccess=function(){var s=o.result,u=s.transaction(Io,"readwrite"),c=u.objectStore(Io),l=c.get(e),f;l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));var h=c.delete(e),d=function(){f=s.transaction(ms,"readwrite");var p=f.objectStore(ms),v=p.delete(e);v.onsuccess=function(){return a(l.result.modelArtifactsInfo)},v.onerror=function(m){return i(l.error)}};h.onsuccess=d,h.onerror=function(p){return d(),s.close(),i(l.error)}},l.onerror=function(h){return s.close(),i(l.error)},u.oncomplete=function(){f==null?s.close():f.oncomplete=function(){return s.close()}}},o.onerror=function(s){return i(o.error)}})]})})},n}(),ji="/",qu="tensorflowjs_models",rF="info",Cee="model_topology",Aee="weight_specs",_ee="weight_data",Dee="model_metadata";function aF(n){return{info:[qu,n,rF].join(ji),topology:[qu,n,Cee].join(ji),weightSpecs:[qu,n,Aee].join(ji),weightData:[qu,n,_ee].join(ji),modelMetadata:[qu,n,Dee].join(ji)}}function iF(n){var e,t;try{for(var r=cr(Object.values(n)),a=r.next();!a.done;a=r.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}function Fee(n){var e=n.split(ji);if(e.length<3)throw new Error("Invalid key format: ".concat(n));return e.slice(1,e.length-1).join(ji)}function Ree(n){return n.startsWith(ws.URL_SCHEME)?n.slice(ws.URL_SCHEME.length):n}var ws=function(){function n(e){if(!vt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=aF(this.modelPath)}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,r,a,i;return Xe(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=of(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,vee(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw iF(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},n.prototype.load=function(){return je(this,void 0,void 0,function(){var e,t,r,a,i,o,s;return Xe(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},r=JSON.parse(this.LS.getItem(this.keys.topology)),r==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=r,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=mee(s),[2,t]})})},n}();ws.URL_SCHEME="localstorage://";var oF=function(n){return vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ws.URL_SCHEME)?Oee(n.slice(ws.URL_SCHEME.length)):null};fa.registerSaveRouter(oF);fa.registerLoadRouter(oF);function Oee(n){return new ws(n)}var Pee=function(){function n(){q(vt().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),q(typeof window>"u"||typeof window.localStorage<"u",function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return je(this,void 0,void 0,function(){var e,t,r,a,i,o;return Xe(this,function(s){for(e={},t=qu+ji,r=ji+rF,a=0;a<this.LS.length;++a)i=this.LS.key(a),i.startsWith(t)&&i.endsWith(r)&&(o=Fee(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},n.prototype.removeModel=function(e){return je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){if(e=Ree(e),t=aF(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '".concat(e,"'"));return r=JSON.parse(this.LS.getItem(t.info)),iF(t),[2,r]})})},n}(),Uu="://",Fo=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){q(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Uu)&&(e=e.slice(0,e.indexOf(Uu))),q(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();q(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '".concat(e,"'.")}),r.managers[e]=t},n.getManager=function(e){var t=n.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t},n.getSchemes=function(){return Object.keys(n.getInstance().managers)},n}();function zd(n){if(n.indexOf(Uu)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(Fo.getSchemes().join(",")));return{scheme:n.split(Uu)[0],path:n.split(Uu)[1]}}function sF(n,e,t){return t===void 0&&(t=!1),je(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return q(n!==e,function(){return"Old path and new path are the same: '".concat(n,"'")}),r=fa.getLoadHandlers(n),q(r.length>0,function(){return"Copying failed because no load handler is found for source URL ".concat(n,".")}),q(r.length<2,function(){return"Copying failed because more than one (".concat(r.length,") ")+"load handlers for source URL ".concat(n,".")}),a=r[0],i=fa.getSaveHandlers(e),q(i.length>0,function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(e,".")}),q(i.length<2,function(){return"Copying failed because more than one (".concat(r.length,") ")+"save handlers for destination URL ".concat(e,".")}),o=i[0],s=zd(n).scheme,u=zd(n).path,c=s===zd(n).scheme,[4,a.load()];case 1:return l=h.sent(),t&&c?[4,Fo.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(l)];case 4:return f=h.sent(),t&&!c?[4,Fo.getManager(s).removeModel(u)]:[3,6];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}function Mee(){return je(this,void 0,void 0,function(){var n,e,t,r,a,i,o,s,u,c,l;return Xe(this,function(f){switch(f.label){case 0:n=Fo.getSchemes(),e={},f.label=1;case 1:f.trys.push([1,6,7,8]),t=cr(n),r=t.next(),f.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,Fo.getManager(a).listModels()]);case 3:i=f.sent();for(o in i)s=a+Uu+o,e[s]=i[o];f.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),c={error:u},[3,8];case 7:try{r&&!r.done&&(l=t.return)&&l.call(t)}finally{if(c)throw c.error}return[7];case 8:return[2,e]}})})}function Bee(n){return je(this,void 0,void 0,function(){var e,t;return Xe(this,function(r){return e=zd(n),t=Fo.getManager(e.scheme),[2,t.removeModel(e.path)]})})}function Lee(n,e){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){return t=!1,[2,sF(n,e,t)]})})}function zee(n,e){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){return t=!0,[2,sF(n,e,t)]})})}var $ee=function(){function n(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n.prototype.setTimeoutCustom=function(e,t){var r=this;if(typeof window>"u"||!vt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(function(){window.postMessage({name:r.messageName,index:r.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",function(a){if(a.source===window&&a.data.name===r.messageName){a.stopPropagation();var i=r.functionRefs[a.data.index];i(),r.handledMessageCount++,r.handledMessageCount===r.functionRefs.length&&(r.functionRefs=[],r.handledMessageCount=0)}},!0))},n.prototype.isTypedArray=function(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray},n}();if(vt().get("IS_BROWSER")){vt().setPlatform("browser",new $ee);try{Fo.registerManager(ws.URL_SCHEME,new Pee)}catch{}try{Fo.registerManager(bs.URL_SCHEME,new Iee)}catch{}}var qee={importFetch:function(){return gA()}},e0,Wee=function(){function n(){this.util=yA(),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return vt().global.fetch!=null?vt().global.fetch(e,t):(e0==null&&(e0=qee.importFetch()),e0(e,t))},n.prototype.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n.prototype.isTypedArray=function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)},n}();vt().get("IS_NODE")&&!vt().get("IS_BROWSER")&&vt().setPlatform("node",new Wee);function Yi(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",Vr(n),new jd(n,e,t)}function Vee(n,e){var t=P(n,"x","cast");if(!GA(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={x:t},a={dtype:e};return U.runKernel(D0,r,a)}var Nn=H({cast_:Vee});function Gee(n){var e=P(n,"x","clone","string_or_numeric"),t={x:e};return U.runKernel(F0,t)}var ys=H({clone_:Gee});function uF(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}K3();var Uee={buffer:Yi,cast:Nn,clone:ys,print:uF};QQ(Uee);function Hee(){vt().set("PROD",!0)}function Kee(){vt().set("DEBUG",!0)}function jee(){vt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Xee(n){vt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Yee(){U.disposeVariables()}function Zee(){return U}function Jee(){return U.memory()}function Qee(n){return U.profile(n)}function Mn(n,e){return U.tidy(n,e)}function Er(n){var e=M0(n);e.forEach(function(t){return t.dispose()})}function cF(n){return U.keep(n)}function ete(n){return U.time(n)}function tte(n){return U.setBackend(n)}function nte(){return U.ready()}function rte(){return U.backendName}function ate(n){U.removeBackend(n)}function ite(n){return U.findBackend(n)}function ote(n){return U.findBackendFactory(n)}function ste(n,e,t){return t===void 0&&(t=1),U.registerBackend(n,e,t)}function ute(){return U.backend}function cte(n,e){vt().setPlatform(n,e)}function lte(n,e){var t,r=P(n,"a","add"),a=P(e,"b","add");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(_0,i)}var ct=H({add_:lte});function fte(n,e){var t,r=P(n,"a","floorDiv"),a=P(e,"b","floorDiv");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(Y_,i)}var lF=H({floorDiv_:fte});function hte(n,e){var t,r=P(n,"a","div"),a=P(e,"b","div");if(t=ke(vn(r,a),2),r=t[0],a=t[1],r.dtype==="int32"&&a.dtype==="int32")return lF(r,a);var i={a:r,b:a},o={};return U.runKernel(L_,i,o)}var Gt=H({div_:hte});function dte(n,e){var t,r=P(n,"a","mul"),a=P(e,"b","mul");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(CD,i)}var Me=H({mul_:dte});function pte(n){var e=P(n,"x","abs");if(e.dtype==="complex64"){var t={x:e};return U.runKernel(b_,t)}else{var t={x:e};return U.runKernel(ZA,t)}}var ua=H({abs_:pte});function vte(n){var e=P(n,"x","acos"),t={x:e};return U.runKernel(JA,t)}var mte=H({acos_:vte});function gte(n){var e=P(n,"x","acosh"),t={x:e};return U.runKernel(QA,t)}var yte=H({acosh_:gte});function bte(n){q(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),q(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(n.length)});var e=n.map(function(a,i){return P(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!Ro(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return U.runKernel(e_,r)}var wte=H({addN_:bte});function xte(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","all","bool"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(t_,a,i)}var kte=H({all_:xte});function Ste(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","any","bool"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(n_,a,i)}var Nte=H({any_:Ste});function Tte(n,e){e===void 0&&(e=0);var t=P(n,"x","argMax"),r={x:t},a={axis:e};return U.runKernel(r_,r,a)}var Ete=H({argMax_:Tte});function Ite(n,e){e===void 0&&(e=0);var t=P(n,"x","argMin"),r={x:t},a={axis:e};return U.runKernel(a_,r,a)}var Cte=H({argMin_:Ite});function Ate(n){var e=P(n,"x","asin"),t={x:e};return U.runKernel(i_,t)}var _te=H({asin_:Ate});function Dte(n){var e=P(n,"x","asinh"),t={x:e};return U.runKernel(o_,t)}var Fte=H({asinh_:Dte});function Rte(n){var e=P(n,"x","atan"),t={x:e};return U.runKernel(s_,t)}var Ote=H({atan_:Rte});function Pte(n,e){var t,r=P(n,"a","atan2"),a=P(e,"b","atan2");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(c_,i)}var Mte=H({atan2_:Pte});function Bte(n){var e=P(n,"x","atanh"),t={x:e};return U.runKernel(u_,t)}var Lte=H({atanh_:Bte});function zte(n,e,t,r,a,i){a===void 0&&(a="NHWC");var o=n[3],s=wt(wt([],ke(e),!1),[o],!1),u=dF(a);return sf(n,s,t,i,r,null,null,u)}function fF(n,e,t,r,a,i,o){o===void 0&&(o="channelsLast");var s=ke(Kl(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,n[3],n[3]];else if(o==="channelsFirst")l=[u,c,n[1],n[1]];else throw new Error("Unknown dataFormat ".concat(o));return sf(n,l,t,r,a,i,!1,o)}function $te(n,e,t,r,a,i,o){o===void 0&&(o="NDHWC");var s=ke(x0(e),3),u=s[0],c=s[1],l=s[2],f,h;if(o==="NDHWC")h="channelsLast",f=[u,c,l,n[4],n[4]];else if(o==="NCDHW")h="channelsFirst",f=[u,c,l,n[1],n[1]];else throw new Error("Unknown dataFormat ".concat(o));return hF(n,f,t,r,a,!1,h,i)}function sf(n,e,t,r,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=ke([-1,-1,-1,-1],4),f=l[0],h=l[1],d=l[2],p=l[3];if(s==="channelsLast")u=ke(n,4),f=u[0],h=u[1],d=u[2],p=u[3];else if(s==="channelsFirst")c=ke(n,4),f=c[0],p=c[1],h=c[2],d=c[3];else throw new Error("Unknown dataFormat ".concat(s));var v=ke(e,4),m=v[0],g=v[1],y=v[3],b=ke(Kl(t),2),w=b[0],x=b[1],N=ke(Kl(r),2),T=N[0],E=N[1],C=Hu(m,T),F=Hu(g,E),D=Vte(a,h,d,w,x,C,F,i,s),O=D.padInfo,L=D.outHeight,z=D.outWidth,$=o?y*p:y,B;return s==="channelsFirst"?B=[f,$,L,z]:s==="channelsLast"&&(B=[f,L,z,$]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:d,inChannels:p,outHeight:L,outWidth:z,outChannels:$,padInfo:O,strideHeight:w,strideWidth:x,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:F,dilationHeight:T,dilationWidth:E,inShape:n,outShape:B,filterShape:e}}function hF(n,e,t,r,a,i,o,s){var u,c;i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var l=ke([-1,-1,-1,-1,-1],5),f=l[0],h=l[1],d=l[2],p=l[3],v=l[4];if(o==="channelsLast")u=ke(n,5),f=u[0],h=u[1],d=u[2],p=u[3],v=u[4];else if(o==="channelsFirst")c=ke(n,5),f=c[0],v=c[1],h=c[2],d=c[3],p=c[4];else throw new Error("Unknown dataFormat ".concat(o));var m=ke(e,5),g=m[0],y=m[1],b=m[2],w=m[4],x=ke(x0(t),3),N=x[0],T=x[1],E=x[2],C=ke(x0(r),3),F=C[0],D=C[1],O=C[2],L=Hu(g,F),z=Hu(y,D),$=Hu(b,O),B=Gte(a,h,d,p,N,T,E,L,z,$,s),W=B.padInfo,X=B.outDepth,Z=B.outHeight,V=B.outWidth,j=i?w*v:w,re;return o==="channelsFirst"?re=[f,j,X,Z,V]:o==="channelsLast"&&(re=[f,X,Z,V,j]),{batchSize:f,dataFormat:o,inDepth:h,inHeight:d,inWidth:p,inChannels:v,outDepth:X,outHeight:Z,outWidth:V,outChannels:j,padInfo:W,strideDepth:N,strideHeight:T,strideWidth:E,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:L,effectiveFilterHeight:z,effectiveFilterWidth:$,dilationDepth:F,dilationHeight:D,dilationWidth:O,inShape:n,outShape:re,filterShape:e}}function qte(n,e,t,r,a){r==null&&(r=q0(n,e,t));var i=n[0],o=n[1],s=jl((i-e+2*r)/t+1,a),u=jl((o-e+2*r)/t+1,a);return[s,u]}function Wte(n,e,t,r,a,i){a==null&&(a=q0(n,e[0],r[0]));for(var o=[0,0,0,t],s=0;s<3;s++)n[s]+2*a>=e[s]&&(o[s]=jl((n[s]-e[s]+2*a)/r[s]+1,i));return o}function q0(n,e,t,r){r===void 0&&(r=1);var a=Hu(e,r);return Math.floor((n[0]*(t-1)-t+a)/2)}function Kl(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function x0(n){return typeof n=="number"?[n,n,n]:n}function Hu(n,e){return e<=1?n:n+(n-1)*(e-1)}function Vte(n,e,t,r,a,i,o,s,u){var c,l,f;if(typeof n=="number"){var h=n===0?"VALID":"NUMBER";c={top:n,bottom:n,left:n,right:n,type:h};var d=qte([e,t],i,r,n,s);l=d[0],f=d[1]}else if(n==="same"){l=Math.ceil(e/r),f=Math.ceil(t/a);var p=Math.max(0,(l-1)*r+i-e),v=Math.max(0,(f-1)*a+o-t),m=Math.floor(p/2),g=p-m,y=Math.floor(v/2),b=v-y;c={top:m,bottom:g,left:y,right:b,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/a);else if(typeof n=="object"){var m=u==="channelsLast"?n[1][0]:n[2][0],g=u==="channelsLast"?n[1][1]:n[2][1],y=u==="channelsLast"?n[2][0]:n[3][0],b=u==="channelsLast"?n[2][1]:n[3][1],h=m===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";c={top:m,bottom:g,left:y,right:b,type:h},l=jl((e-i+m+g)/r+1,s),f=jl((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(n));return{padInfo:c,outHeight:l,outWidth:f}}function Gte(n,e,t,r,a,i,o,s,u,c,l){var f,h,d,p;if(n==="valid"&&(n=0),typeof n=="number"){var v=n===0?"VALID":"NUMBER";f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:v};var m=Wte([e,t,r,1],[s,u,c],1,[a,i,o],n,l);h=m[0],d=m[1],p=m[2]}else if(n==="same"){h=Math.ceil(e/a),d=Math.ceil(t/i),p=Math.ceil(r/o);var g=(h-1)*a+s-e,y=(d-1)*i+u-t,b=(p-1)*o+c-r,w=Math.floor(g/2),x=g-w,N=Math.floor(y/2),T=y-N,E=Math.floor(b/2),C=b-E;f={top:N,bottom:T,left:E,right:C,front:w,back:x,type:"SAME"}}else throw Error("Unknown padding parameter: ".concat(n));return{padInfo:f,outDepth:h,outHeight:d,outWidth:p}}function jl(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode ".concat(e))}}function Xl(n){var e=ke(Kl(n),3),t=e[0],r=e[1],a=e[2];return t===1&&r===1&&a===1}function Qi(n,e){return Xl(n)||Xl(e)}function xs(n){return Kl(n).every(function(e){return e>0})}function dF(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat ".concat(n))}function Ca(n,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")q(Xu(e),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(r){r.forEach(function(a){q(Xu(a),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(n,": Unknown padding parameter: ").concat(e))}}function Ute(n,e){var t=P(n,"x","reshape","string_or_numeric"),r={x:t},a={shape:e};return U.runKernel(jD,r,a)}var ve=H({reshape_:Ute});function Hte(n,e,t,r,a){var i=P(n,"x","avgPool","float32"),o=1;q(Qi(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),Ca("avgPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=U.runKernel(l_,c,l);return f=Nn(f,i.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var pF=H({avgPool_:Hte});function Kte(n,e,t,r,a,i){i===void 0&&(i="NDHWC");var o=P(n,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),q(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),q(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),Ca("avgPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=U.runKernel(f_,c,l);return f=Nn(f,s.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var jte=H({avgPool3d_:Kte});function Xte(n,e){e===void 0&&(e=0),q(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Hl(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return ys(t[0]);var r=t,a={axis:e};return U.runKernel(w_,r,a)}var Wr=H({concat_:Xte});function Yte(n,e,t,r){var a;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=P(n,"a","matMul"),o=P(e,"b","matMul");a=ke(vn(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:r};return U.runKernel(h_,s,u)}var Ft=H({matMul_:Yte});function Zte(n){var e=P(n,"x","sigmoid","float32"),t={x:e};return U.runKernel(c3,t)}var Ku=H({sigmoid_:Zte});function Jte(n,e,t){var r=P(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:e,size:t};return U.runKernel(i3,a,i)}var un=H({slice_:Jte});function Qte(n){var e=P(n,"x","tanh","float32"),t={x:e};return U.runKernel(C3,t)}var k0=H({tanh_:Qte});function ene(n,e,t,r,a,i){var o=P(n,"forgetBias","basicLSTMCell"),s=P(e,"lstmKernel","basicLSTMCell"),u=P(t,"lstmBias","basicLSTMCell"),c=P(r,"data","basicLSTMCell"),l=P(a,"c","basicLSTMCell"),f=P(i,"h","basicLSTMCell"),h=Wr([c,f],1),d=Ft(h,s),p=ct(d,u),v=p.shape[0],m=p.shape[1]/4,g=[v,m],y=un(p,[0,0],g),b=un(p,[0,m],g),w=un(p,[0,m*2],g),x=un(p,[0,m*3],g),N=ct(Me(Ku(y),k0(b)),Me(l,Ku(ct(o,w)))),T=Me(k0(N),Ku(x));return[N,T]}var tne=H({basicLSTMCell_:ene});function nne(n,e,t){var r=P(n,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});q(r.rank>=1+e.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(e.length)}),q(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),q(r.shape[0]%a===0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:r},o={blockShape:e,crops:t};return U.runKernel(d_,i,o)}var vF=H({batchToSpaceND_:nne});function rne(n){var e;return n.rank===0||n.rank===1?e=ve(n,[1,1,1,n.size]):n.rank===2?e=ve(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ve(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function ane(n,e,t,r,a,i){i==null&&(i=.001);var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;r!=null&&(l=P(r,"offset","batchNorm")),q(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),q(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),q(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=rne(o),h={x:f,scale:c,offset:l,mean:s,variance:u},d={varianceEpsilon:i},p=U.runKernel(Z_,h,d);return ve(p,o.shape)}var op=H({batchNorm_:ane});function ine(n,e,t,r,a,i){var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return r!=null&&(l=P(r,"offset","batchNorm")),q(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),q(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),op(o,s,u,l,c,i)}var one=H({batchNorm2d_:ine});function sne(n,e,t,r,a,i){var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return r!=null&&(l=P(r,"offset","batchNorm")),q(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),q(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),op(o,s,u,l,c,i)}var une=H({batchNorm3d_:sne});function cne(n,e,t,r,a,i){var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return r!=null&&(l=P(r,"offset","batchNorm")),q(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),q(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),op(o,s,u,l,c,i)}var lne=H({batchNorm4d_:cne});function fne(n,e,t){var r=P(n,"x","bincount"),a=P(e,"weights","bincount");q(r.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)}),q(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),q(a.size===r.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:r,weights:a},o={size:t};return U.runKernel(p_,i,o)}var mF=H({bincount_:fne});function hne(n,e){var t=P(n,"s0","broadcastArgs","int32"),r=P(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(r.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:t,s1:r};return U.runKernel(v_,a)}var dne=H({broadcastArgs_:hne});function pne(n,e){var t=P(n,"broadcastTo","x"),r=t.shape;if(Vr(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ve(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return ys(t);var c={x:t},l={reps:o};return U.runKernel(R0,c,l)}var $d=H({broadcastTo_:pne});function vne(n){var e=P(n,"x","ceil","float32"),t={x:e};return U.runKernel(m_,t)}var mne=H({ceil_:vne});function uf(n,e,t){Vr(n);var r={shape:n,value:e,dtype:t};return U.runKernel(K_,{},r)}function gne(n,e,t){var r=P(n,"x","clipByValue");if(q(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return uf(r.shape,e,r.dtype);var a={x:r},i={clipValueMin:e,clipValueMax:t};return U.runKernel(g_,a,i)}var yne=H({clipByValue_:gne});function bne(n){return Wr(n,0)}var wne=H({concat1d_:bne});function xne(n,e){return Wr(n,e)}var kne=H({concat2d_:xne});function Sne(n,e){return Wr(n,e)}var Nne=H({concat3d_:Sne});function Tne(n,e){return Wr(n,e)}var Ene=H({concat4d_:Tne});function Ine(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(n,"x","conv2d","float32"),u=P(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),q(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Ca("conv2d",r,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];q(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),q(Qi(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),q(xs(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),q(xs(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=U.runKernel(x_,h,d);return l?ve(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var sp=H({conv2d_:Ine});function Cne(n,e,t,r,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=P(n,"x","conv1d"),u=P(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1]])),q(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),q(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),Ca("conv1d",r,o),q(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),q(Qi(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),q(xs(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),q(xs(t),function(){return"Error in conv1D: Stride should be larger than 0."}),q(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ve(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ve(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=[1,t],p=[1,i],v="NHWC",m=sp(h,f,d,r,v,p,o);return l?ve(m,[m.shape[2],m.shape[3]]):ve(m,[m.shape[0],m.shape[2],m.shape[3]])}var Ane=H({conv1d_:Cne});function _ne(n,e,t,r,a,i,o){i===void 0&&(i="NHWC"),q(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var s=n,u=e,c=!1;e.rank===3&&(c=!0,u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),q(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),q(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),q(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];q(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),q(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Ca("conv2dDerInput",a,o);var h={dy:u,filter:t},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=U.runKernel(S_,h,d);return c?ve(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var gF=H({conv2DBackpropInput_:_ne});function Dne(n,e,t,r,a,i){var o=P(n,"x","conv2dTranspose"),s=P(e,"filter","conv2dTranspose");return gF(t,o,s,r,a,"NHWC",i)}var Fne=H({conv2dTranspose_:Dne});function Rne(n,e,t,r,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=P(n,"x","conv3d"),s=P(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),q(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),q(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),q(Qi(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),q(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),q(xs(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),q(xs(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:r,dataFormat:a,dilations:i},h=U.runKernel(N_,l,f);return c?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var One=H({conv3d_:Rne});function Pne(n,e,t,r,a){q(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var i=n,o=e,s=!1;e.rank===4&&(s=!0,o=ve(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=o.shape[4];q(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),q(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),q(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),q(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),q(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=U.runKernel(T_,l,f);return s?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Mne=H({conv3DBackpropInput_:Pne});function Bne(n,e,t,r,a){var i=P(n,"x","conv3dTranspose"),o=P(e,"filter","conv3dTranspose");return Mne(t,i,o,r,a)}var Lne=H({conv3dTranspose_:Bne});function zne(n){var e=P(n,"x","cos","float32"),t={x:e};return U.runKernel(E_,t)}var $ne=H({cos_:zne});function qne(n){var e=P(n,"x","cosh","float32"),t={x:e};return U.runKernel(I_,t)}var Wne=H({cosh_:qne});function Vne(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:r};return U.runKernel(C_,i,o)}var Gne=H({cumprod_:Vne});function Une(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:r};return U.runKernel(A_,i,o)}var Hne=H({cumsum_:Une});function Kne(n,e,t,r){r===void 0&&(r=!1);var a=P(n,"x","denseBincount"),i=P(e,"weights","denseBincount");q(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),q(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),q(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),q(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:r};return U.runKernel(D_,o,s)}var jne=H({denseBincount_:Kne});function Xne(n,e,t){t===void 0&&(t="NHWC");var r=P(n,"x","depthToSpace","float32"),a=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];q(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),q(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(r.shape)}),q(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(r.shape)}),q(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)});var s={x:r},u={blockSize:e,dataFormat:t};return U.runKernel(F_,s,u)}var Yne=H({depthToSpace_:Xne});function Zne(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(n,"x","depthwiseConv2d","float32"),u=P(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),q(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];q(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),Ca("depthwiseConv2d",r,o);var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=U.runKernel(R_,h,d);return l?ve(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var W0=H({depthwiseConv2d_:Zne});function Jne(n){var e=P(n,"x","diag"),t={x:e};return U.runKernel(M_,t)}var Qne=H({diag_:Jne});function ere(n,e,t,r,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=P(n,"x","dilation2d"),s=P(e,"filter","dilation2d");q(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),q(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),q(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),q(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:r,dilations:a},h=U.runKernel(B_,l,f);return c?ve(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var tre=H({dilation2d_:ere});function yF(n,e){for(var t=n.length,r=[],a=0;a<t;a++){var i=t-1-a,o=n[i]||1,s=e[e.length-1-a]||1;s>1&&o===1&&r.unshift(i)}return r}function V0(n,e){for(var t=[],r=0;r<e.length;r++){var a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Bn(n,e){for(var t=[],r=Math.max(n.length,e.length),a=0;a<r;a++){var i=n[n.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(n," and ").concat(e,".");throw Error(s)}else t.unshift(i)}return t}var nre={__proto__:null,getBroadcastDims:yF,getReductionAxes:V0,assertAndGetBroadcastShape:Bn};function rre(n,e){var t,r=P(n,"a","equal","string_or_numeric"),a=P(e,"b","equal","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(W_,i)}var bF=H({equal_:rre});function are(n,e,t){var r=P(e,"a","where"),a=P(t,"b","where"),i=P(n,"condition","where","bool"),o=Bn(Bn(i.shape,r.shape),a.shape),s=$d(i,o),u=$d(r,o),c=$d(a,o),l={condition:s,t:u,e:c};return U.runKernel(r3,l)}var Ju=H({where_:are});function ire(n){var e=P(n,"x","zerosLike"),t={x:e};return U.runKernel(O3,t)}var ca=H({zerosLike_:ire});function ore(n,e){var t,r=P(n,"a","div"),a=P(e,"b","div");t=ke(vn(r,a),2),r=t[0],a=t[1];var i=Gt(r,a),o=ca(i),s=bF(a,o);return Ju(s,o,i)}var sre=H({divNoNan_:ore});function ure(n,e){var t=P(n,"t1","dot"),r=P(e,"t2","dot");q((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(q(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&r.rank===1){var o=ve(t,[1,-1]),s=ve(r,[-1,1]),u=Ft(o,s);return ve(u,[])}else if(t.rank===1&&r.rank===2){var o=ve(t,[1,-1]),s=ve(r,[r.shape[0],r.shape[1]]),u=Ft(o,s);return ve(u,[u.size])}else if(t.rank===2&&r.rank===1){var s=ve(r,[-1,1]),u=Ft(t,s);return ve(u,[u.size])}else{var s=ve(r,[r.shape[0],r.shape[1]]),u=Ft(t,s);return u}}var cre=H({dot_:ure});function lre(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=e.map(function(i,o){return P(i,"tensors".concat(o),"einsum")}),a={equation:n};return U.runKernel(z_,r,a)}var fre=H({einsum_:lre});function hre(n){var e=P(n,"x","elu","float32"),t={x:e};return U.runKernel($_,t)}var wF=H({elu_:hre});function dre(n){var e=P(n,"x","erf");q(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=Nn(e,"float32"));var t={x:e};return U.runKernel(q_,t)}var pre=H({erf_:dre});function G0(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function xF(n,e,t){for(var r=n.length+e.length,a=[],i=0,o=0,s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function vre(n,e){for(var t=[],r=n.length,a=0;a<r;a++)e.indexOf(a)===-1&&t.push(n[a]);var i=e.map(function(o){return n[o]});return[t,i]}function cf(n,e){var t=e.map(function(r){return 1});return xF(n,t,e)}function mre(n,e,t){q(G0(e,t),function(){return"".concat(n," supports only inner-most axes for now. ")+"Got axes ".concat(e," and rank-").concat(t," input.")})}function gre(n,e){if(G0(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(a){return t.push(a)}),t}function yre(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function bre(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function wre(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","max"),a={x:r},i={reductionIndices:e,keepDims:t};return U.runKernel(gD,a,i)}var ju=H({max_:wre});function xre(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","min"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(SD,a,i)}var S0=H({min_:xre});function kre(n,e){var t,r=P(n,"base","pow"),a=P(e,"exp","pow");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(LD,i)}var Yl=H({pow_:kre});function Rt(n,e){if((er(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&er(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],r=[];return Oo(n,t,r,e)}function Sre(n){var e=P(n,"x","sqrt","float32"),t={x:e};return U.runKernel(f3,t)}var Zi=H({sqrt_:Sre});function Nre(n){var e=P(n,"x","square"),t={};return U.runKernel("Square",{x:e},t)}var ri=H({square_:Nre});function Tre(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","sum");r.dtype==="bool"&&(r=Nn(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return U.runKernel(h3,a,i)}var Vt=H({sum_:Tre});function Ere(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),n=P(n,"x","norm");var a=kF(n,e,t),i=a.shape;if(r){var o=nf(t,n.shape);i=cf(a.shape,o)}return ve(a,i)}function kF(n,e,t){if(t===void 0&&(t=null),n.rank===0)return ua(n);if(n.rank!==1&&t===null)return kF(ve(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Vt(ua(n),t);if(e===1/0)return ju(ua(n),t);if(e===-1/0)return S0(ua(n),t);if(e==="euclidean"||e===2)return Zi(Vt(Yl(ua(n),Rt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return ju(Vt(ua(n),t[0]),t[1]-1);if(e===1/0)return ju(Vt(ua(n),t[1]),t[0]);if(e===-1/0)return S0(Vt(ua(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Zi(Vt(ri(n),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var up=H({norm_:Ere});function Ire(n,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),up(n,"euclidean",e,t)}var Cre=H({euclideanNorm_:Ire});function Are(n){var e=P(n,"x","exp"),t={x:e};return U.runKernel(V_,t)}var ks=H({exp_:Are});function _re(n,e){e===void 0&&(e=0);var t=P(n,"x","expandDims","string_or_numeric");q(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r={input:t},a={dim:e};return U.runKernel(G_,r,a)}var ds=H({expandDims_:_re});function Dre(n){var e=P(n,"x","expm1"),t={x:e};return U.runKernel(U_,t)}var Fre=H({expm1_:Dre});function Rre(n,e){var t=P(n,"x","tile","string_or_numeric");q(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var r={x:t},a={reps:e};return U.runKernel(R0,r,a)}var $l=H({tile_:Rre});function Ore(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var a=Yi([n,e],r),i=n<=e?n:e,o=0;o<i;++o)a.set(1,o,o);var s=ve(a.toTensor(),[n,e]);if(t==null)return s;if(t.length===1)return $l(ds(s,0),[t[0],1,1]);if(t.length===2)return $l(ds(ds(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return $l(ds(ds(ds(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var SF=H({eye_:Ore});function Pre(n){var e=P(n,"x","floor","float32"),t={x:e};return U.runKernel(X_,t)}var NF=H({floor_:Pre});function Mre(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=P(n,"x","gather"),i=P(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return U.runKernel(J_,o,s)}var TF=H({gather_:Mre});function Bre(n,e){var t,r=P(n,"a","greater","string_or_numeric"),a=P(e,"b","greater","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(eD,i)}var cp=H({greater_:Bre});function Lre(n,e){var t,r=P(n,"a","greaterEqual","string_or_numeric"),a=P(e,"b","greaterEqual","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(tD,i)}var EF=H({greaterEqual_:Lre});function zre(n){var e=P(n,"input","imag"),t={input:e};return U.runKernel(rD,t)}var lp=H({imag_:zre});function $re(n){var e=P(n,"x","isFinite"),t={x:e};return U.runKernel(aD,t)}var qre=H({isFinite_:$re});function Wre(n){var e=P(n,"x","isInf"),t={x:e};return U.runKernel(iD,t)}var Vre=H({isInf_:Wre});function Gre(n){var e=P(n,"x","isNaN"),t={x:e};return U.runKernel(oD,t)}var Ure=H({isNaN_:Gre});function Hre(n,e){e===void 0&&(e=.2);var t=P(n,"x","leakyRelu"),r={x:t},a={alpha:e};return U.runKernel(sD,r,a)}var IF=H({leakyRelu_:Hre});function Kre(n,e){var t,r=P(n,"a","less","string_or_numeric"),a=P(e,"b","less","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(uD,i)}var jre=H({less_:Kre});function Xre(n,e){var t,r=P(n,"a","lessEqual","string_or_numeric"),a=P(e,"b","lessEqual","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(cD,i)}var U0=H({lessEqual_:Xre});function Yre(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");var r={start:n,stop:e,num:t};return U.runKernel(lD,{},r)}function Zre(n,e,t,r,a){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),a===void 0&&(a=.5);var i=P(n,"x","localResponseNormalization");q(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),q(Xu(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:r,beta:a},l=U.runKernel(mD,u,c);return s?ve(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var Jre=H({localResponseNormalization_:Zre});function Qre(n){var e=P(n,"x","log","float32"),t={x:e};return U.runKernel(fD,t)}var Zl=H({log_:Qre});function eae(n){var e=P(n,"x","log1p"),t={x:e};return U.runKernel(hD,t)}var CF=H({log1p_:eae});function tae(n){return q(Ao(n),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var r=P(e,"x","tf.grad","string_or_numeric"),a=t!=null?P(t,"dy","tf.grad"):null;return U.tidy(function(){var i=U.gradients(function(){return n(r)},[r],a),o=i.value,s=i.grads;return a!=null&&mr(o.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),fp(s),s[0]})}}function nae(n){return q(Ao(n),function(){return"The f passed in grads(f) must be a function"}),function(e,t){q(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var r=Hl(e,"args","tf.grads","string_or_numeric"),a=t!=null?P(t,"dy","tf.grads"):null;return U.tidy(function(){var i=U.gradients(function(){return n.apply(void 0,wt([],ke(r),!1))},r,a),o=i.value,s=i.grads;return a!=null&&mr(o.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),fp(s),s})}}function rae(n){return q(Ao(n),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){q(e instanceof Pn,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),q(t==null||t instanceof Pn,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var r=U.gradients(function(){return n(e)},[e],t),a=r.grads,i=r.value;return fp(a),{grad:a[0],value:i}}}function aae(n){return q(Ao(n),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){q(Array.isArray(e)&&e.every(function(a){return a instanceof Pn}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),q(t==null||t instanceof Pn,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var r=U.gradients(function(){return n.apply(void 0,wt([],ke(e),!1))},e,t);return t!=null&&mr(r.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),fp(r.grads),r}}function AF(n,e){q(Ao(n),function(){return"The f passed in variableGrads(f) must be a function"}),q(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Ul}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var r in U.registeredVariables)e.push(U.registeredVariables[r])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),q(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=U.gradients(n,e,null,o),u=s.value,c=s.grads;q(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),q(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function Ai(n){return U.customGrad(n)}function fp(n){var e=n.filter(function(t){return t==null}).length;if(e>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function iae(n){var e=P(n,"x","neg"),t={x:e};return U.runKernel(AD,t)}var Xi=H({neg_:iae});function oae(n){var e=P(n,"x","softplus"),t={x:e};return U.runKernel(l3,t)}var _F=H({softplus_:oae});function sae(n){var e=P(n,"x","logSigmoid"),t=Ai(function(r){var a=Xi(_F(Xi(r))),i=function(o){var s=Me(o,Ku(Xi(r)));return s};return{value:a,gradFunc:i}});return t(e)}var uae=H({logSigmoid_:sae});function cae(n,e){var t,r=P(n,"a","sub"),a=P(e,"b","sub");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(E3,i)}var bt=H({sub_:cae});function lae(n,e){e===void 0&&(e=-1);var t=P(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var r=Ai(function(a,i){var o=!0,s=ju(a,e,!0),u=bt(a,s),c=bt(Nn(u,"float32"),Zl(Vt(ks(u),e,o)));i([c]);var l=function(f,h){var d=ke(h,1),p=d[0],v=!0,m=ks(p);return bt(f,Me(Vt(f,e,v),m))};return{value:c,gradFunc:l}});return r(t)}var fae=H({logSoftmax_:lae});function hae(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","logSumExp"),a=nf(e,r.shape),i=ju(r,a,!0),o=bt(r,i),s=ks(o),u=Vt(s,a),c=Zl(u),l=ct(ve(i,c.shape),c);if(t){var f=cf(l.shape,a);return ve(l,f)}return l}var DF=H({logSumExp_:hae});function dae(n,e){var t=P(n,"a","logicalAnd","bool"),r=P(e,"b","logicalAnd","bool");Bn(t.shape,r.shape);var a={a:t,b:r};return U.runKernel(dD,a)}var Yd=H({logicalAnd_:dae});function pae(n){var e=P(n,"x","logicalNot","bool"),t={x:e};return U.runKernel(pD,t)}var FF=H({logicalNot_:pae});function vae(n,e){var t=P(n,"a","logicalOr","bool"),r=P(e,"b","logicalOr","bool");Bn(t.shape,r.shape);var a={a:t,b:r};return U.runKernel(vD,a)}var RF=H({logicalOr_:vae});function mae(n,e){var t=P(n,"a","logicalXor","bool"),r=P(e,"b","logicalXor","bool");return Bn(t.shape,r.shape),Yd(RF(n,e),FF(Yd(n,e)))}var gae=H({logicalXor_:mae});var Md=2147483648;function yae(n,e,t){t===void 0&&(t="left");var r=P(n,"sortedSequence","searchSorted"),a=P(e,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=ve(r,[-1,i]),u=ve(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Ut(u.shape)>=Md)throw new Error("values tensor size must less than ".concat(Md));if(s.shape[1]>=Md)throw new Error("trailing dim_size must less than ".concat(Md," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return U.runKernel(n3,c,l)}var H0=H({searchSorted_:yae});function bae(n,e){return H0(n,e,"left")}function wae(n,e,t,r,a){var i=P(n,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),q(Qi(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),Ca("maxPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=U.runKernel(bD,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var OF=H({maxPool_:wae});function xae(n,e,t,r,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=P(n,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),q(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),Ca("maxPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=U.runKernel(wD,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var kae=H({maxPool3d_:xae});function Sae(n,e,t,r,a){a===void 0&&(a=!1);var i=P(n,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:r,includeBatchInIndex:a},u=U.runKernel(xD,o,s);return{result:u[0],indexes:u[1]}}var Nae=H({maxPoolWithArgmax_:Sae});function Tae(n,e){var t,r=P(n,"a","maximum"),a=P(e,"b","maximum");t=ke(vn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=Nn(r,"int32"),a=Nn(a,"int32")),Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(yD,i)}var PF=H({maximum_:Tae});function Eae(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","mean"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(kD,a,i)}var Zd=H({mean_:Eae});function Qu(n,e){if(e===void 0&&(e="float32"),Vr(n),e==="complex64"){var t=Qu(n,"float32"),r=Qu(n,"float32");return Do(t,r)}var a=np(Ut(n),e);return U.makeTensor(a,n,e)}function gs(n,e){if(e===void 0&&(e="float32"),Vr(n),e==="complex64"){var t=gs(n,"float32"),r=Qu(n,"float32");return Do(t,r)}var a=C0(Ut(n),e);return U.makeTensor(a,n,e)}function Iae(n,e,t){var r=t===void 0?{}:t,a=r.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(n===void 0)return[];var o=P(n,"x","meshgrid",n instanceof Pn?n.dtype:"float32");if(e===void 0)return[o];var s=P(e,"y","meshgrid",e instanceof Pn?e.dtype:"float32"),u=Ut(o.shape),c=Ut(s.shape);return i==="xy"?(o=ve(o,[1,-1]),s=ve(s,[-1,1]),[Ft(gs([c,1],o.dtype),o),Ft(s,gs([1,u],s.dtype))]):(o=ve(o,[-1,1]),s=ve(s,[1,-1]),[Ft(o,gs([1,c],o.dtype)),Ft(gs([u,1],s.dtype),s)])}function Cae(n,e){var t,r=P(n,"a","minimum"),a=P(e,"b","minimum");t=ke(vn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=Nn(r,"int32"),a=Nn(a,"int32")),Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(ND,i)}var MF=H({minimum_:Cae});function Aae(n,e,t){q(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var r=P(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");q(e.length===r.rank,function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){q(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),q(e[c][0]>=0&&e[c][0]<=r.shape[c]-a&&e[c][1]>=0&&e[c][1]<=r.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(r.shape[c]-a," or less than 0 for input of ")+"shape ".concat(r.shape)})},o=0;o<r.rank;o++)i(o);var s={paddings:e,mode:t},u={x:r};return U.runKernel(TD,u,s)}var _ae=H({mirrorPad_:Aae});function Dae(n,e){var t,r=P(n,"a","mod"),a=P(e,"b","mod");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(ED,i)}var Fae=H({mod_:Dae});function Rae(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),n=P(n,"x","moments");var r=nf(e,n.shape),a=Zd(n,r,t),i=a.shape;t||(i=cf(a.shape,r));var o=ri(bt(Nn(n,"float32"),ve(a,i))),s=Zd(o,r,t);return{mean:a,variance:s}}var Oae=H({moments_:Rae});function Pae(n,e,t,r){for(var a=P(e,"data","multiRNNCell"),i=Hl(t,"c","multiRNNCell"),o=Hl(r,"h","multiRNNCell"),s=a,u=[],c=0;c<n.length;c++){var l=n[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var Mae=H({multiRNNCell_:Pae});function Bae(n,e,t,r){r===void 0&&(r=!1);var a=P(n,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ve(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:r},l=U.runKernel(ID,u,c);return o===1?ve(l,[l.size]):l}var Lae=H({multinomial_:Bae});function zae(n,e){var t,r=P(n,"a","notEqual","string_or_numeric"),a=P(e,"b","notEqual","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(_D,i)}var BF=H({notEqual_:zae});function $ae(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=P(n,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:r};return U.runKernel(PD,o,s)}var N0=H({oneHot_:$ae});function qae(n){var e=P(n,"x","onesLike"),t={x:e};return U.runKernel(OD,t)}var Wae=H({onesLike_:qae});function Vae(n,e){var t=P(n,"v1","outerProduct"),r=P(e,"v2","outerProduct");q(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=ve(t,[-1,1]),i=ve(r,[1,-1]);return Ft(a,i)}var Gae=H({outerProduct_:Vae});function Uae(n,e,t){t===void 0&&(t=0);var r=P(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:r};return U.runKernel(BD,i,a)}var lf=H({pad_:Uae});function Hae(n,e,t){return t===void 0&&(t=0),q(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),lf(n,[e],t)}var Kae=H({pad1d_:Hae});function jae(n,e,t){return t===void 0&&(t=0),q(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),lf(n,e,t)}var Xae=H({pad2d_:jae});function Yae(n,e,t){return t===void 0&&(t=0),q(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),lf(n,e,t)}var Zae=H({pad3d_:Yae});function Jae(n,e,t){return t===void 0&&(t=0),q(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),lf(n,e,t)}var Qae=H({pad4d_:Jae});function eie(n,e,t){var r=P(n,"x","spaceToBatchND");q(r.rank>=1+e.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(e.length)}),q(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),q(r.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:r},i={blockShape:e,paddings:t};return U.runKernel(d3,a,i)}var LF=H({spaceToBatchND_:eie});function tie(n,e,t,r,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),r===0&&(r="valid");var s=P(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(Qi(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=fF(u.shape,e,i,a,r),f=[l.dilationHeight,l.dilationWidth],h;r==="same"?h=rie([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var d=f[0]===1&&f[1]===1,p=ke(nie([l.inHeight,l.inWidth],f,h),2),v=p[0],m=p[1],g=d?r:"valid",y=d?u:LF(u,f,v),b=t==="avg"?function(){return pF(y,e,i,g,o)}:function(){return OF(y,e,i,g,o)},w=b(),x=d?w:vF(w,f,m);return c?ve(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function nie(n,e,t){var r=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=n.concat(r,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[r[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function rie(n,e){var t=n.map(function(o,s){return o+(o-1)*(e[s]-1)}),r=t.map(function(o){return o-1}),a=r.map(function(o){return Math.floor(o/2)}),i=r.map(function(o,s){return o-a[s]});return r.map(function(o,s){return[a[s],i[s]]})}var aie=H({pool_:tie});function iie(n,e){var t=P(n,"x","prelu"),r=P(e,"alpha","prelu"),a={x:t,alpha:r};return U.runKernel(zD,a)}var zF=H({prelu_:iie});function oie(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","prod");r.dtype==="bool"&&(r=Nn(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return U.runKernel($D,a,i)}var sie=H({prod_:oie});function uie(n,e,t,r){var a=n.map(function(l,f){return P(l,"tensors".concat(f),"raggedGather","int32")}),i=P(e,"paramsDenseValues","raggedGather"),o=P(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:r},c=U.runKernel(qD,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var cie=H({raggedGather_:uie});function lie(n,e,t){var r=P(n,"starts","raggedRange"),a=P(e,"limits","raggedRange",r.dtype),i=P(t,"deltas","raggedRange",r.dtype),o={starts:r,limits:a,deltas:i},s=U.runKernel(WD,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var fie=H({raggedRange_:lie});function hie(n,e,t,r,a){var i=P(n,"shape","raggedTensorToTensor","int32"),o=P(e,"values","raggedTensorToTensor"),s=P(t,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map(function(f,h){return P(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return U.runKernel(VD,c,l)}var die=H({raggedTensorToTensor_:hie});function pie(n,e,t){Vr(n);var r=Ut(n),a=null;if(t==null||t==="float32")a=new Float32Array(r);else if(t==="int32")a=new Int32Array(r);else if(t==="bool")a=new Uint8Array(r);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<r;i++)a[i]=e();return U.makeTensor(a,n,t)}var vie=H({rand_:pie}),Es=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Is(n){var e={exports:{}};return n(e,e.exports),e.exports}var mie=Is(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(Es,n,!1)}),gie=Is(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(Es,n,!1)}),yie=Is(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(Es,n,!1)}),bie=Is(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8&&(d[7]=-1),l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(Es,n,!1)}),wie=Is(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(Es,n,!1)}),xie=Is(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(Es,n,!1)}),Cs=Is(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=Od()}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:Es,[],Math)});Cs.alea=mie;Cs.xor128=gie;Cs.xorwow=yie;Cs.xorshift7=bie;Cs.xor4096=wie;Cs.tychei=xie;var K0=Cs,kie=.001,$F=.1;function Sie(n,e,t){return t==null&&(t=j0()),T0(n,e,function(r,a){return X0(r,a,t)})}function j0(){return U.backend.floatPrecision()===32?kie:$F}function T0(n,e,t){var r=!0;if((er(n)||er(e))&&(r=!1),er(n)&&er(e)&&(r=!0),r){var a=n.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". ")+"Expected: ".concat(i))}if(Array.isArray(n)&&Array.isArray(e)){var o=Ci(n),s=Ci(e);if(!Ro(o,s))throw new Error("Arrays have different shapes. "+"Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=er(n)?n:_o(n),c=er(e)?e:_o(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs ")+"expected: ".concat(c.length,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."));for(var l=0;l<c.length;++l){var f=u[l],h=c[l];if(!t(f,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(f,", expected[").concat(l,"] = ").concat(h,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."))}typeof expect<"u"&&expect().nothing()}function Nie(n,e){n().then(function(){return e.fail()},function(){return e()}),typeof expect<"u"&&expect().nothing()}function Tie(n,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Eo(n)||Eo(n[0])||Eo(e)||Eo(e[0])?T0(n,t,function(r,a){return r==a}):T0(n,e,function(r,a){return X0(r,a,0)})}function Eie(n,e,t){if(t==null&&(t=j0()),!X0(n,e,t))throw new Error("Numbers differ: actual === ".concat(n,", expected === ").concat(e));typeof expect<"u"&&expect().nothing()}function X0(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function Iie(n,e,t){for(var r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error("Value out of range:".concat(n[r]," low: ").concat(e,", high: ").concat(t))}function Cie(n,e){var t=new Float32Array(n),r=new Float32Array(e);if(t.length!==r.length)throw new Error("Expected ArrayBuffer to be of length "+"".concat(r.length,", but it was ").concat(t.length));for(var a=0;a<r.length;a++)if(t[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ")+"".concat(r[a]," but got ").concat(t[a]," instead"))}function qF(n){for(var e=0;e<n.length;e++){var t=n[e];Array.isArray(t)?qF(t):n[e]=af(t)}return n}function Aie(n){var e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(function(t){e.addEventListener("loadeddata",function(r){return t(e)}),e.load()})}function _ie(n){return je(this,void 0,void 0,function(){return Xe(this,function(e){switch(e.label){case 0:return[4,n.play()];case 1:return e.sent(),"requestVideoFrameCallback"in n?[4,new Promise(function(t){n.requestVideoFrameCallback(t)})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}var Die={__proto__:null,TEST_EPSILON_FLOAT16:$F,expectArraysClose:Sie,testEpsilon:j0,expectPromiseToFail:Nie,expectArraysEqual:Tie,expectNumbersClose:Eie,expectValuesInRange:Iie,expectArrayBuffersEqual:Cie,encodeStrings:qF,createVideoElement:Aie,play:_ie};var Y0=function(){function n(e,t,r,a,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=K0.alea(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(r))&&(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),Fie=function(){function n(e,t,r,a){this.alpha=e,this.beta=1/t,this.dtype=r;var i=a||Math.random();this.randu=K0.alea(i.toString()),this.randn=new Y0(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,r=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),Rie=function(){function n(e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=K0.alea(a)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function Oie(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r="float32"),Vr(n),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type ".concat(r));for(var i=new Fie(e,t,r,a),o=Yi(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Pie=H({randomGamma_:Oie});function Mie(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Vr(n),r!=null&&r==="bool")throw new Error("Unsupported data type ".concat(r));for(var i=new Y0(e,t,r,!1,a),o=Yi(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var WF=H({randomNormal_:Mie});function Bie(n,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return WF(n,0,1,e,t)}var Lie=H({randomStandardNormal_:Bie});function zie(n,e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32"),Vr(n);for(var i=Yi(n,r),o=new Rie(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var VF=H({randomUniform_:zie});function Jl(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:n,stop:e,step:t,dtype:r};return U.runKernel(GD,{},a)}function $ie(n){var e=P(n,"input","real"),t={input:e};return U.runKernel(UD,t)}var Ql=H({real_:$ie});function qie(n){var e=P(n,"x","reciprocal"),t={x:e};return U.runKernel(HD,t)}var Wie=H({reciprocal_:qie});function Vie(n){var e=P(n,"x","relu"),t={x:e};return U.runKernel(KD,t)}var hp=H({relu_:Vie});function Gie(n){var e=P(n,"x","relu6"),t={x:e};return U.runKernel(ZD,t)}var GF=H({relu6_:Gie});function Uie(n,e){var t=P(n,"x","reverse"),r={x:t},a={dims:e};return U.runKernel(JD,r,a)}var Ss=H({reverse_:Uie});function Hie(n){var e=P(n,"x","reverse");return q(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),Ss(e,0)}var Kie=H({reverse1d_:Hie});function jie(n,e){var t=P(n,"x","reverse");return q(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),Ss(t,e)}var Xie=H({reverse2d_:jie});function Yie(n,e){var t=P(n,"x","reverse");return q(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),Ss(t,e)}var Zie=H({reverse3d_:Yie});function Jie(n,e){var t=P(n,"x","reverse");return q(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),Ss(t,e)}var Qie=H({reverse4d_:Jie});function eoe(n){var e=P(n,"x","round"),t={x:e};return U.runKernel(QD,t)}var UF=H({round_:eoe});function toe(n){var e=P(n,"x","rsqrt","float32"),t={x:e};return U.runKernel(e3,t)}var noe=H({rsqrt_:toe});function roe(n){var e=P(n,"x","selu"),t={x:e};return U.runKernel(a3,t)}var aoe=H({selu_:roe});function ioe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=P(n,"x","separableConv2d"),u=P(e,"depthwiseFilter","separableConv2d"),c=P(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");q(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),q(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),q(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),q(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),q(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],d=u.shape[3];q(c.shape[2]===h*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*d,", ")+"but got ".concat(c.shape[2],".")});var p=W0(l,u,r,a,o,i),v=1,m=sp(p,c,v,"valid",o);return f?ve(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var ooe=H({separableConv2d_:ioe});function soe(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,l,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return t=P(n,"x","setdiff1d"),r=P(e,"y","setdiff1d"),q(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(r.dtype,").")}),q(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),q(r.rank===1,function(){return"y should be 1D tensor, but got y (".concat(r.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,r.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new jd([s],t.dtype),c=new jd([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var uoe=soe;function coe(n){var e=P(n,"x","sign"),t={x:e};return U.runKernel(u3,t)}var loe=H({sign_:coe});function foe(n){var e=P(n,"x","sin","float32"),t={x:e};return U.runKernel(o3,t)}var hoe=H({sin_:foe});function doe(n){var e=P(n,"x","sinh"),t={x:e};return U.runKernel(s3,t)}var poe=H({sinh_:doe});function voe(n,e,t){var r=P(n,"x","slice1d");return q(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,[e],[t])}var moe=H({slice1d_:voe});function goe(n,e,t){var r=P(n,"x","slice2d");return q(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,e,t)}var yoe=H({slice2d_:goe});function boe(n,e,t){var r=P(n,"x","slice3d");return q(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,e,t)}var woe=H({slice3d_:boe});function xoe(n,e,t){var r=P(n,"x","slice4d");return q(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,e,t)}var koe=H({slice4d_:xoe});function Soe(n,e){e===void 0&&(e=-1);var t=P(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var r={logits:t},a={dim:e};return U.runKernel(v3,r,a)}var Noe=H({softmax_:Soe});function Toe(n){q(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return U.runKernel(H_,e)}var Z0=H({fft_:Toe});function Eoe(n){q(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return U.runKernel(nD,e)}var Jd=H({ifft_:Eoe});function Ioe(n){var e=n.shape[n.shape.length-1],t=n.size/e,r;if(e<=2){var a=ve(n,[t,e]);r=Jd(a)}else{var i=[t,2*(e-1)],o=ve(Ql(n),[t,e]),s=ve(lp(n),[t,e]),u=Ss(un(o,[0,1],[t,e-2]),1),c=Me(Ss(un(s,[0,1],[t,e-2]),1),Rt(-1)),l=Wr([o,u],1),f=Wr([s,c],1),a=ve(Do(l,f),[i[0],i[1]]);r=Jd(a)}if(r=Ql(r),n.rank===3&&n.shape[0]!==0){var h=r,d=n.shape[0];r=ve(r,[d,r.shape[0]/d,r.shape[1]]),h.dispose()}return r}var HF=H({irfft_:Ioe});function Coe(n,e,t){t===void 0&&(t=0);var r=P(n,"x","split"),a={x:r},i={numOrSizeSplits:e,axis:t};return U.runKernel(p3,a,i)}var ef=H({split_:Coe});function Aoe(n,e){q(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(n.dtype)});var t=n.shape[n.shape.length-1],r=n.size/t,a;if(e!=null&&e<t){var i=n.shape.map(function(g){return 0}),o=n.shape.map(function(g){return g});o[n.shape.length-1]=e,a=un(n,i,o),t=e}else if(e!=null&&e>t){var s=n.shape.map(function(g){return g});s[n.shape.length-1]=e-t,a=Wr([n,Qu(s)],n.shape.length-1),t=e}else a=n;var u=ca(a),c=ve(Do(a,u),[r,t]),l=Z0(c),f=Math.floor(t/2)+1,h=Ql(l),d=lp(l),p=ef(h,[f,t-f],h.shape.length-1),v=ef(d,[f,t-f],d.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=f,ve(Do(p[0],v[0]),m)}var J0=H({rfft_:Aoe});function _oe(n,e){var t,r=P(n,"a","squaredDifference"),a=P(e,"b","squaredDifference");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a},o={};return U.runKernel(x3,i,o)}var KF=H({squaredDifference_:_oe});function Doe(n,e){var t=P(n,"x","squeeze","string_or_numeric");return ve(t,$A(t.shape,e).newShape)}var Q0=H({squeeze_:Doe});function Foe(n,e){e===void 0&&(e=0);var t=Hl(n,"tensors","stack","string_or_numeric");q(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&q(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var r=t,a={axis:e};return U.runKernel(MD,r,a)}var tf=H({stack_:Foe});function Roe(n,e){e===void 0&&(e=0);var t=P(n,"x","step"),r={x:t},a={alpha:e};return U.runKernel(P3,r,a)}var jF=H({step_:Roe});function Ooe(n,e,t,r,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=P(n,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return U.runKernel(k3,l,f)}var Poe=H({stridedSlice_:Ooe});function Moe(n){var e=P(n,"x","tan","float32"),t={x:e};return U.runKernel(I3,t)}var Boe=H({tan_:Moe});function ni(n,e){Ns(n);var t=Ci(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var r=null;return Oo(n,r,t,e)}function ql(n,e,t){if(Ns(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Ci(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Oo(n,e,r,t)}function XF(n,e,t){if(Ns(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Ci(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Oo(n,e,r,t)}function Loe(n,e,t){if(Ns(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Ci(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Oo(n,e,r,t)}function zoe(n,e,t){if(Ns(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Ci(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Oo(n,e,r,t)}function $oe(n,e,t){if(Ns(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Ci(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,Oo(n,e,r,t)}function qoe(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=P(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:r},o={k:e,sorted:t},s=ke(U.runKernel(A3,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var Woe=H({topk_:qoe});function Voe(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Vr(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new Y0(e,t,r,!0,a),o=Yi(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Goe=H({truncatedNormal_:Voe});function Uoe(n,e){e===void 0&&(e=0);var t=P(n,"x","unique","string_or_numeric");q(t.rank>0,function(){return"The input tensor must be at least 1D"});var r={x:t},a={axis:e},i=ke(U.runKernel(D3,r,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var Hoe=H({unique_:Uoe});function Koe(n,e,t){var r=P(n,"x","unsortedSegmentSum"),a=P(e,"segmentIds","unsortedSegmentSum","int32");q(Xu(t),function(){return"numSegments must be of dtype int"});var i={x:r,segmentIds:a},o={numSegments:t};return U.runKernel(R3,i,o)}var joe=H({unsortedSegmentSum_:Koe});function Xoe(n,e){e===void 0&&(e=0);var t=P(n,"x","unstack","string_or_numeric");q(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var r={value:t},a={axis:e};return U.runKernel(F3,r,a)}var ey=H({unstack_:Xoe});function Yoe(n,e){return H0(n,e,"right")}function Zoe(n,e,t,r){return e===void 0&&(e=!0),U.makeVariable(n,e,t,r)}function YF(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);for(var a=Yi(n,"int32"),i=Yi([t.length,n.length],"int32"),r=0;r<t.length;r++){var o=a.indexToLoc(t[r]),s=r*n.length;i.values.set(o,s)}return i.toTensor()}function Joe(n){return je(this,void 0,void 0,function(){var e,t,r;return Xe(this,function(a){switch(a.label){case 0:return e=P(n,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),r=YF(e.shape,t),n!==e&&e.dispose(),[2,r]}})})}var ZF=Joe;function Qoe(n,e,t){return je(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v;return Xe(this,function(m){switch(m.label){case 0:for(r=P(n,"tensor","boolMask"),a=P(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=r.shape,q(o>0,function(){return"mask cannot be scalar"}),mr(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ve(r,l),h=ve(a,[-1]),[4,ZF(h)];case 1:return d=m.sent(),p=Q0(d,[1]),v=TF(f,p,i),n!==r&&r.dispose(),e!==a&&a.dispose(),p.dispose(),f.dispose(),h.dispose(),d.dispose(),[2,v]}})})}var ese=Qoe;function tse(n,e,t){var r=P(n,"x","transpose");if(e==null&&(e=r.shape.map(function(o,s){return s}).reverse()),q(r.rank===e.length,function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){q(o>=0&&o<r.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(e)})}),r.rank<=1)return r.clone();var a={x:r},i={perm:e};return r.dtype==="complex64"?Mn(function(){var o=Ql(r),s=lp(r);return o=U.runKernel(Bd,{x:o},i),s=U.runKernel(Bd,{x:s},i),t&&(s=Xi(s)),Do(o,s)}):U.runKernel(Bd,a,i)}var Qd=H({transpose_:tse});function nse(n,e,t,r,a){a===void 0&&(a=!0);var i=P(n,"v","movingAverage"),o=P(e,"x","movingAverage"),s=P(t,"decay","movingAverage");U3(i,o),q(Ro(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Rt(1),c=bt(u,s),l=Me(bt(o,i),c);if(a){q(r!=null,function(){return"When using zeroDebias: true, step is required."});var f=P(r,"step","movingAverage");l=Gt(l,bt(u,Yl(s,f)))}return ct(i,l)}var rse=H({movingAverage_:nse});function ty(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(n)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(n.length<r+(t.rank-a))throw new Error(i+" Output shape length < ".concat(r+(t.rank-a)));if(t.rank!==a+n.length-r)throw new Error(i+" update.rank != ".concat(a+n.length-r));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==n[o+r])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(n[o+a],")"))}function ny(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(n.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(n.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(n.shape))}ty(t,e,n)}function JF(n,e,t){for(var r=e.shape.length,a=r>1?e.shape[r-1]:1,i=t.length,o=1,s=a;s<i;++s)o*=t[s];var u=a<1?1:a,c=Ut(e.shape)/u,l=wt(wt([],ke(ec(t.slice(0,a))),!1),[1],!1),f=Ut(t);return{sliceRank:a,numUpdates:c,sliceSize:o,strides:l,outputSize:f}}var ase={__proto__:null,validateUpdateShape:ty,validateInput:ny,calculateShapes:JF};function ise(n,e,t){Vr(t);var r=P(n,"indices","scatterND","int32"),a=P(e,"updates","scatterND");ny(a,r,t);var i={indices:r,updates:a},o={shape:t};return U.runKernel(t3,i,o)}var ose=H({scatterND_:ise});function sse(n,e,t,r){if(n.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(n.dtype,"."));if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(n.shape,"."));var a=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function use(n,e,t,r){r===void 0&&(r=0),Vr(t);var a=P(n,"sparseIndices","sparseToDense","int32"),i=P(e,"sparseValues","sparseToDense","string_or_numeric"),o=P(r,"defaultValue","sparseToDense",i.dtype);sse(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return U.runKernel(w3,s,u)}var cse=H({sparseToDense_:use});function lse(n,e){var t=P(e,"indices","gatherND","int32"),r=P(n,"x","gatherND","string_or_numeric"),a={params:r,indices:t};return U.runKernel(Q_,a)}var fse=H({gatherND_:lse});function hse(n,e){if(e==null)return n.shape.slice();if(Ro(n.shape,e))return e;if(n.shape.length===e.length){for(var t=[],r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}function dse(n,e,t,r){var a=P(n,"x","dropout");if(q(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),q(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return n instanceof Pn?a.clone():a;var i=hse(a,t),o=1-e,s=Gt(NF(ct(VF(i,0,1,"float32",r),o)),o);return Me(a,s)}var pse=H({dropout_:dse});function QF(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function ry(n,e,t){for(var r=1-n%2,a=new Float32Array(n),i=0;i<n;++i){var o=2*Math.PI*i/(n+r-1);a[i]=e-t*Math.cos(o)}return ni(a,"float32")}function vse(n,e,t){return t===void 0&&(t=1),je(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,m;return Xe(this,function(g){switch(g.label){case 0:return r=P(n,"predictions","inTopK"),a=P(e,"targets","inTopK"),q(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(r.rank)}),q(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(r.rank," and targets rank ").concat(a.rank)}),mr(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],q(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,r.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=ke([o.length/i,i],2),c=u[0],l=u[1],f=qA("bool",c),h=0;h<c;h++){for(d=h*l,p=o.subarray(d,d+l),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort(function(y,b){return b.value-y.value}),f[h]=0,m=0;m<t;m++)if(v[m].index===s[h]){f[h]=1;break}}return n!==r&&r.dispose(),e!==a&&a.dispose(),[2,Gu(f,a.shape,"bool")]}})})}var mse=vse;function gse(n,e,t,r,a,i,o){i===void 0&&(i="NHWC");var s=n;n.rank===3&&(s=ve(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]])),q(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),q(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),q(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];q(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),q(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Ca("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return U.runKernel(k_,f,h)}var yse=H({conv2DBackpropFilter_:gse});function dp(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return Me(n,jF(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function pp(n,e){var t=e,r=V0(n.shape,e.shape);return r.length>0&&(t=Vt(t,r)),ve(t,n.shape)}function vp(n,e,t,r){if(e==="linear")return n;if(e==="relu")return hp(n);if(e==="elu")return wF(n);if(e==="relu6")return GF(n);if(e==="prelu")return zF(n,t);if(e==="leakyrelu")return IF(n,r);if(e==="sigmoid")return Ku(n);throw new Error("Unknown fused activation ".concat(e,"."))}var mp=function(n,e){var t=n>0;return!t||e==="linear"};function bse(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights,v=n.leakyreluAlpha;if(d=d||"linear",mp(U.state.gradientDepth,d)===!1){q(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var m=sp(t,r,a,i,s,c,l);return f!=null&&(m=ct(m,f)),vp(m,d,p,v)}var g=P(t,"x","conv2d","float32"),y=P(r,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),q(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(b.rank,".")}),q(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),Ca("fused conv2d",i,l);var x=s==="NHWC"?b.shape[3]:b.shape[1];q(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),q(Qi(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var N=sf(b.shape,y.shape,a,c,i,l),T;f!=null&&(T=P(f,"bias","fused conv2d"),e=ke(vn(T,g),1),T=e[0],s==="NHWC"?Bn(N.outShape,T.shape):(q(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),q(T.shape.length===0||T.shape[0]===N.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(N.outChannels,")")})));var E;if(p!=null){var C=p.shape;if(q(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)q(C[0]===1||C[0]===N.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(N.outChannels,").")});else if(C.length===3)try{Bn(C,N.outShape)}catch{var F="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(N.outShape,").");throw Error(F)}E=P(p,"prelu weights","fused conv2d")}var D=function(B,W){q(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=ke(W,4),Z=X[0],V=X[1],j=X[2],re=X[3],ne=dp(B,j,d);q(Xl(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=gF(V.shape,ne,Z,a,i),le=yse(V,ne,Z.shape,a,i),pe=[oe,le];if(re!=null){var xe=pp(re,ne);pe.push(xe)}return pe},O={x:b,filter:y,bias:T,preluActivationWeights:E},L={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:v};if(f==null){var z=Ai(function(B,W,X){var Z=U.runKernel(o0,O,L);return X([W,B,Z]),w&&(Z=ve(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:D}});return z(b,y)}else{var $=Ai(function(B,W,X,Z){var V=U.runKernel(o0,O,L);return Z([W,B,V,X]),w&&(V=ve(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:D}});return $(b,y,T)}}var wse=H({fusedConv2d_:bse});function xse(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=n;n.rank===3&&(s=ve(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return U.runKernel(O_,c,l)}var kse=H({depthwiseConv2dNativeBackpropFilter_:xse});function Sse(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=U.runKernel(P_,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Nse=H({depthwiseConv2dNativeBackpropInput_:Sse});function Tse(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights,v=n.leakyreluAlpha;if(mp(U.state.gradientDepth,d)===!1){var m=W0(t,r,a,i,s,c,l);return f!=null&&(m=ct(m,f)),vp(m,d,p,v)}var g=P(t,"x","depthwiseConv2d","float32"),y=P(r,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),q(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(b.rank,".")}),q(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),q(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(b.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),q(Qi(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),Ca("fused depthwiseConv2d",i,l);var x=sf(b.shape,y.shape,a,c,i,l,!0),N;f!=null&&(N=P(f,"bias","fused conv2d"),e=ke(vn(N,g),1),N=e[0],Bn(x.outShape,N.shape));var T;p!=null&&(T=P(p,"prelu weights","fused depthwiseConv2d"));var E=function(L,z){q(Xl(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var $=ke(z,4),B=$[0],W=$[1],X=$[2],Z=$[3],V=dp(L,X,d),j=Nse(W.shape,V,B,a,i,c,l),re=kse(W,V,B.shape,a,i,c,l);if(Z!=null){var ne=pp(N,V);return[j,re,ne]}return[j,re]},C={x:b,filter:y,bias:N,preluActivationWeights:T},F={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:v};if(f==null){var D=Ai(function(L,z,$){var B=U.runKernel(s0,C,F);return $([z,L,B]),w&&(B=ve(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return D(b,y)}else{var O=Ai(function(L,z,$,B){var W=U.runKernel(s0,C,F);return B([z,L,W,$]),w&&(W=ve(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:E}});return O(b,y,N)}}var Ese=H({fusedDepthwiseConv2d_:Tse});function Ise(n){var e,t,r=n.a,a=n.b,i=n.transposeA,o=i===void 0?!1:i,s=n.transposeB,u=s===void 0?!1:s,c=n.bias,l=n.activation,f=l===void 0?"linear":l,h=n.preluActivationWeights,d=n.leakyreluAlpha,p=d===void 0?.2:d;if(mp(U.state.gradientDepth,f)===!1){var v=Ft(r,a,o,u);return c!=null&&(v=ct(v,c)),vp(v,f,h,p)}var m=P(r,"a","fused matMul"),g=P(a,"b","fused matMul");e=ke(vn(m,g),2),m=e[0],g=e[1];var y=o?m.shape[m.rank-2]:m.shape[m.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?m.shape[m.rank-1]:m.shape[m.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],N=m.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Ut(N),C=Ut(T);q(y===b,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(m.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var F=Bn(m.shape.slice(0,-2),g.shape.slice(0,-2)),D=F.concat([w,x]),O=o?ve(m,[E,y,w]):ve(m,[E,w,y]),L=u?ve(g,[C,x,b]):ve(g,[C,b,x]),z;c!=null&&(z=P(c,"bias","fused matMul"),t=ke(vn(z,m),1),z=t[0],Bn(D,z.shape));var $;h!=null&&($=P(h,"prelu weights","fused matMul"));var B=function(j,re){var ne=ke(re,4),oe=ne[0],le=ne[1],pe=ne[2],xe=ne[3],he=dp(ve(j,pe.shape),pe,f),ye,we;if(!o&&!u?(ye=Ft(he,le,!1,!0),we=Ft(oe,he,!0,!1)):!o&&u?(ye=Ft(he,le,!1,!1),we=Ft(he,oe,!0,!1)):o&&!u?(ye=Ft(le,he,!1,!0),we=Ft(oe,he,!1,!1)):(ye=Ft(le,he,!0,!0),we=Ft(he,oe,!0,!0)),c!=null){var Ae=pp(xe,he);return[ye,we,Ae]}else return[ye,we]},W={a:O,b:L,bias:z,preluActivationWeights:$},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:p};if(c==null){var Z=Ai(function(j,re,ne){var oe=U.runKernel(i0,W,X);return ne([j,re,oe]),{value:ve(oe,D),gradFunc:B}});return Z(O,L)}else{var V=Ai(function(j,re,ne,oe){var le=U.runKernel(i0,W,X);return oe([j,re,le,ne]),{value:ve(le,D),gradFunc:B}});return V(O,L,z)}}var Cse=H({fusedMatMul_:Ise});var Ase={__proto__:null,conv2d:wse,depthwiseConv2d:Ese,matMul:Cse};function _se(n){return ry(n,.54,.46)}var Dse=H({hammingWindow_:_se});function Fse(n){return ry(n,.5,.5)}var eR=H({hannWindow_:Fse});function Rse(n,e,t,r,a){r===void 0&&(r=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=n.size;)o.push(un(n,i,e)),i+=t;if(r)for(;i<n.size;){var s=i+e-n.size,u=Wr([un(n,i,e-s),uf([s],a)]);o.push(u),i+=t}return o.length===0?ql([],[0,e]):ve(Wr(o),[o.length,e])}var tR=H({frame_:Rse});function Ose(n,e,t,r,a){a===void 0&&(a=eR),r==null&&(r=QF(e));var i=tR(n,e,t),o=Me(i,a(e));return J0(o,r)}var Pse=H({stft_:Ose});function Mse(n,e,t,r,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=P(n,"image","cropAndResize"),s=P(e,"boxes","cropAndResize","float32"),u=P(t,"boxInd","cropAndResize","int32"),c=s.shape[0];q(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),q(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),q(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),q(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")}),q(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(r)}),q(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:r},h=U.runKernel(__,l,f);return h}var Bse=H({cropAndResize_:Mse});function Lse(n){var e=P(n,"image","flipLeftRight","float32");q(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},r=U.runKernel(j_,t,{});return r}var zse=H({flipLeftRight_:Lse});function $se(n){var e=P(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];q(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),q(r===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,$l(e,a)}var qse=H({grayscaleToRGB_:$se});function Wse(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=.5);var a=P(n,"image","rotateWithOffset","float32");q(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:r},s=U.runKernel(M3,i,o);return s}var Vse=H({rotateWithOffset_:Wse});function tc(n,e,t,r,a,i){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=n.shape[0];return t=Math.min(t,o),q(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")}),q(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(n.rank,"'")}),q(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(n.shape[1])}),q(e.rank===1,function(){return"scores must be a 1D tensor"}),q(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),q(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}function Gse(n,e,t,r,a){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=P(n,"boxes","nonMaxSuppression","float32"),o=P(e,"scores","nonMaxSuppression","float32"),s=tc(i,o,t,r,a);t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:a};return U.runKernel(DD,{boxes:i,scores:o},u)}var Use=H({nonMaxSuppression_:Gse});function Hse(n,e,t){var r=Kse(n,e,t),a=r<0?-(r+1):r;n.splice(a,0,e)}function Kse(n,e,t){return Xse(n,e,t||jse)}function jse(n,e){return n>e?1:n<e?-1:0}function Xse(n,e,t){for(var r=0,a=n.length,i=0,o=!1;r<a;){i=r+(a-r>>>1);var s=t(e,n[i]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}function nR(n,e,t,r,a){return ay(n,e,t,r,a,0)}function rR(n,e,t,r,a,i){return ay(n,e,t,r,a,0,!1,i,!0)}function aR(n,e,t,r,a,i){return ay(n,e,t,r,a,i,!0)}function ay(n,e,t,r,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(DA);for(var f=i>0?-.5/i:0,h=[],d=[];h.length<t&&c.length>0;){var p=c.pop(),v=p.score,m=p.boxIndex,g=p.suppressBeginIndex;if(v<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=Yse(n,m,h[b]);if(w>=r){y=!0;break}if(p.score=p.score*Zse(r,f,w),p.score<=a)break}p.suppressBeginIndex=h.length,y||(p.score===v?(h.push(m),d.push(p.score)):p.score>a&&Hse(c,p,DA))}var x=h.length,N=t-x;s&&N>0&&(h.push.apply(h,wt([],ke(new Array(N).fill(0)),!1)),d.push.apply(d,wt([],ke(new Array(N).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=d),u&&(T.validOutputs=x),T}function Yse(n,e,t){var r=n.subarray(e*4,e*4+4),a=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(f-c)*(h-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function Zse(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function DA(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function Jse(n,e,t,r,a){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),je(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return i=P(n,"boxes","nonMaxSuppressionAsync"),o=P(e,"scores","nonMaxSuppressionAsync"),s=tc(i,o,t,r,a),t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=nR(c,l,t,r,a).selectedIndices,i!==n&&i.dispose(),o!==e&&o.dispose(),[2,ni(f,"int32")]}})})}var Qse=Jse;function eue(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=P(n,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=tc(o,s,t,r,a,i);t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i},f=U.runKernel(RD,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var tue=H({nonMaxSuppressionWithScore_:eue});function nue(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),je(this,void 0,void 0,function(){var o,s,u,c,l,f,h,d,p;return Xe(this,function(v){switch(v.label){case 0:return o=P(n,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=tc(o,s,t,r,a,i),t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=v.sent(),l=c[0],f=c[1],h=aR(l,f,t,r,a,i),d=h.selectedIndices,p=h.selectedScores,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:ni(d,"int32"),selectedScores:ni(p)}]}})})}var rue=nue;function aue(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=P(n,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=tc(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},d={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},p=U.runKernel(FD,h,d);return{selectedIndices:p[0],validOutputs:p[1]}}var iue=H({nonMaxSuppressionPadded_:aue});function oue(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),je(this,void 0,void 0,function(){var o,s,u,c,l,f,h,d,p,v,m,g;return Xe(this,function(y){switch(y.label){case 0:return o=P(n,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=tc(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=ke.apply(void 0,[y.sent(),2]),d=h[0],p=h[1],v=rR(d,p,c,l,f,i),m=v.selectedIndices,g=v.validOutputs,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:ni(m,"int32"),validOutputs:Rt(g,"int32")}]}})})}var sue=oue;function uue(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"images","resizeBilinear");q(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),q(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),q(r===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=U.runKernel(YD,s,u);return o?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var cue=H({resizeBilinear_:uue});function lue(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"images","resizeNearestNeighbor");q(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),q(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),q(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),q(r===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=U.runKernel(XD,s,u);return o?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var fue=H({resizeNearestNeighbor_:lue});function hue(n,e,t,r){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),r===void 0&&(r=.5);var i=P(n,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=Me(ni([r]),255),f,h,d,p;if(q(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),q(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),q(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),q(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=ke(ef(i,[1,1,1],-1),3),f=a[0],h=a[1],d=a[2];var v=Me(f,o),m=Me(h,s),g=Me(d,u);p=ct(ct(v,m),g)}else p=n;if(e==="otsu"){var y=mF(Nn(UF(p),"int32"),Gu([]),256);l=due(y,c)}var b=t?U0(p,l):cp(p,l),w=Nn(Me(b,255),"int32");return w}function due(n,e){for(var t=ni([-1]),r=ni([0]),a=ni([0]),i,o,s,u,c,l,f=0;f<n.size-1;f++){i=un(n,0,f+1),o=un(n,f+1),c=Gt(Vt(i),e),l=Gt(Vt(o),e);var h=Vt(Me(i,Jl(0,i.size)));s=Gt(h,Vt(i));var d=uf(o.shape,i.size),p=ct(Jl(0,o.size),d),v=Me(o,p);u=Gt(Vt(v),Vt(o));var m=bt(s,u),g=bt(s,u),y=Me(c,l);a=Me(Me(y,m),g);var b=cp(a,r);r=Ju(b,a,r),t=Ju(b,ni([f]),t)}return t}var pue=H({threshold_:hue});function vue(n,e,t,r,a,i){t===void 0&&(t="nearest"),r===void 0&&(r="constant"),a===void 0&&(a=0);var o=P(n,"image","transform","float32"),s=P(e,"transforms","transform","float32");q(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),q(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),q(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:r,fillValue:a,outputShape:i};return U.runKernel(_3,u,c)}var mue=H({transform_:vue});function gue(n,e,t){q(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),q(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")});var r=P(n,"a","bandPart");q(r.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")});var a=r.shape,i=ke(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(t<=s))throw new Error("bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,")."));e<0&&(e=o),t<0&&(t=s);var u=ve(Jl(0,o,1,"int32"),[-1,1]),c=Jl(0,s,1,"int32"),l=bt(u,c),f=Yd(U0(l,Rt(+e,"int32")),EF(l,Rt(-t,"int32"))),h=Qu([o,s],r.dtype);return ve(tf(ey(ve(r,[-1,o,s])).map(function(d){return Ju(f,d,h)})),a)}var yue=H({bandPart_:gue});function bue(n){var e;if(Array.isArray(n)){e=!1,q(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){q(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(n[u].shape[0]," vs. ").concat(t,")")})},a=1;a<n.length;++a)r(a)}else e=!0,n=ef(n,n.shape[0],0).map(function(u){return Q0(u,[0])});q(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(n.length,") exceeds ")+"number of dimensions (".concat(n[0].shape[0],").")});for(var i=[],o=n,s=function(u){i.push(U.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=Me(Vt(Me(i[l],c)),i[l]);c=bt(c,f)}return Gt(c,up(c,"euclidean"))}))},a=0;a<n.length;++a)s(a);return e?tf(i,0):i}var wue=H({gramSchmidt_:bue});function xue(n,e){if(e===void 0&&(e=!1),q(n.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(n.rank)}),n.rank===2)return FA(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(u,c){return u*c}),r=ey(ve(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),a=[],i=[];r.forEach(function(u){var c=ke(FA(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ve(tf(a,0),n.shape),s=ve(tf(i,0),n.shape);return[o,s]}function FA(n,e){return e===void 0&&(e=!1),U.tidy(function(){q(n.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(n.shape.length,"D Tensor.")});for(var t=n.shape[0],r=n.shape[1],a=SF(t),i=ys(n),o=ql([[1]],[1,1]),s=ys(o),u=t>=r?r:t,c=function(f){var h,d=i,p=s,v=a;h=ke(U.tidy(function(){var m=un(i,[f,f],[t-f,1]),g=up(m),y=un(i,[f,f],[1,1]),b=Ju(cp(y,0),ql([[-1]]),ql([[1]])),w=bt(y,Me(b,g)),x=Gt(m,w);x.shape[0]===1?s=ys(o):s=Wr([o,un(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var N=Xi(Gt(Ft(b,w),g)),T=un(i,[f,0],[t-f,r]),E=Me(N,s),C=Qd(s);if(f===0)i=bt(T,Ft(E,Ft(C,T)));else{var F=bt(T,Ft(E,Ft(C,T)));i=Wr([un(i,[0,0],[f,r]),F],0)}var D=Qd(E),O=un(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=bt(O,Ft(Ft(O,s),D));else{var L=bt(O,Ft(Ft(O,s),D));a=Wr([un(a,[0,0],[t,f]),L],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],Er([d,p,v])},l=0;l<u;++l)c(l);return!e&&t>r&&(a=un(a,[0,0],[t,r]),i=un(i,[0,0],[r,r])),[a,i]})}var kue=H({qr_:xue});A.Reduction=void 0;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(A.Reduction||(A.Reduction={}));function Sue(n,e,t){t===void 0&&(t=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var r=P(n,"losses","computeWeightedLoss"),a=null;e!=null&&(a=P(e,"weights","computeWeightedLoss"));var i=a==null?r:Me(r,a);if(t===A.Reduction.NONE)return i;if(t===A.Reduction.SUM)return Vt(i);if(t===A.Reduction.MEAN){if(a==null)return Zd(i);var o=r.size/a.size,s=Gt(Vt(i),Vt(a));return o>1?Gt(s,Rt(o)):s}if(t===A.Reduction.SUM_BY_NONZERO_WEIGHTS){if(a==null)return Gt(Vt(i),Rt(r.size));var u=Me(a,gs(r.shape)),c=Nn(Vt(BF(u,Rt(0))),"float32");return Gt(Vt(i),c)}throw Error("Unknown reduction: ".concat(t))}var eo=H({computeWeightedLoss_:Sue});function Nue(n,e,t,r){r===void 0&&(r=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(n,"labels","absoluteDifference"),i=P(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=P(t,"weights","absoluteDifference")),mr(a.shape,i.shape,"Error in absoluteDifference: ");var s=ua(bt(a,i));return eo(s,o,r)}var Tue=H({absoluteDifference_:Nue});function Eue(n,e,t,r,a){a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"labels","cosineDistance"),o=P(e,"predictions","cosineDistance"),s=null;r!=null&&(s=P(r,"weights","cosineDistance")),mr(i.shape,o.shape,"Error in cosineDistance: ");var u=Rt(1),c=bt(u,Vt(Me(i,o),t,!0));return eo(c,s,a)}var Iue=H({cosineDistance_:Eue});function Cue(n,e,t,r){r===void 0&&(r=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(n,"labels","hingeLoss"),i=P(e,"predictions","hingeLoss"),o=null;t!=null&&(o=P(t,"weights","hingeLoss")),mr(a.shape,i.shape,"Error in hingeLoss: ");var s=Rt(1);a=bt(Me(Rt(2),a),s);var u=hp(bt(s,Me(a,i)));return eo(u,o,r)}var Aue=H({hingeLoss_:Cue});function _ue(n,e,t,r,a){r===void 0&&(r=1),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"labels","huberLoss"),o=P(e,"predictions","huberLoss"),s=null;t!=null&&(s=P(t,"weights","huberLoss")),mr(i.shape,o.shape,"Error in huberLoss: ");var u=Rt(r),c=ua(bt(o,i)),l=MF(c,u),f=bt(c,l),h=ct(Me(Rt(.5),ri(l)),Me(u,f));return eo(h,s,a)}var Due=H({huberLoss_:_ue});function Fue(n,e,t,r,a){r===void 0&&(r=1e-7),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"labels","logLoss"),o=P(e,"predictions","logLoss"),s=null;t!=null&&(s=P(t,"weights","logLoss")),mr(i.shape,o.shape,"Error in logLoss: ");var u=Rt(1),c=Rt(r),l=Xi(Me(i,Zl(ct(o,c)))),f=Me(bt(u,i),Zl(ct(bt(u,o),c))),h=bt(l,f);return eo(h,s,a)}var Rue=H({logLoss_:Fue});function Oue(n,e,t,r){r===void 0&&(r=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(n,"labels","meanSquaredError"),i=P(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=P(t,"weights","meanSquaredError")),mr(a.shape,i.shape,"Error in meanSquaredError: ");var s=KF(a,i);return eo(s,o,r)}var Pue=H({meanSquaredError_:Oue});function Mue(n,e){var t=P(n,"labels","sigmoidCrossEntropyWithLogits"),r=P(e,"logits","sigmoidCrossEntropyWithLogits");mr(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=hp(r),i=Me(r,t),o=CF(ks(Xi(ua(r))));return ct(bt(a,i),o)}function Bue(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"multiClassLabels","sigmoidCrossEntropy"),o=P(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","sigmoidCrossEntropy")),mr(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Rt(r),c=Rt(1),l=Rt(.5);i=ct(Me(i,bt(c,u)),Me(l,u))}var f=Mue(i,o);return eo(f,s,a)}var Lue=H({sigmoidCrossEntropy_:Bue});function zue(n,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var r=Ai(function(a,i,o){var s=!0,u=DF(i,[t],s),c=bt(Nn(i,"float32"),u);o([a,c]);var l=Xi(Me(c,a)),f=Vt(l,[t]),h=function(d,p){var v=ke(p,2),m=v[0],g=v[1],y=cf(d.shape,[t]);return[Me(ve(d,y),bt(Nn(m,"float32"),ks(g))),Me(ve(d,y),bt(ks(g),Nn(m,"float32")))]};return{value:f,gradFunc:h}});return r(n,e)}function $ue(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"onehotLabels","softmaxCrossEntropy"),o=P(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","softmaxCrossEntropy")),mr(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Rt(r),c=Rt(1),l=Rt(i.shape[1]);i=ct(Me(i,bt(c,u)),Gt(u,l))}var f=zue(i,o);return eo(f,s,a)}var que=H({softmaxCrossEntropy_:$ue});function Wue(n,e,t,r){var a=P(n,"indices","sparseFillEmptyRows","int32"),i=P(e,"values","sparseFillEmptyRows"),o=P(t,"denseShape","sparseFillEmptyRows","int32"),s=P(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=U.runKernel(m3,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var Vue=H({sparseFillEmptyRows_:Wue});function Gue(n,e,t){var r=P(n,"inputIndices","sparseReshape","int32"),a=P(e,"inputShape","sparseReshape","int32"),i=P(t,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(r.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=U.runKernel(g3,o);return{outputIndices:s[0],outputShape:s[1]}}var Uue=H({sparseReshape_:Gue});function Hue(n,e,t){var r=P(n,"data","sparseSegmentMean"),a=P(e,"indices","sparseSegmentMean","int32"),i=P(t,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return U.runKernel(y3,o)}var Kue=H({sparseSegmentMean_:Hue});function jue(n,e,t){var r=P(n,"data","sparseSegmentSum"),a=P(e,"indices","sparseSegmentSum","int32"),i=P(t,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return U.runKernel(b3,o)}var Xue=H({sparseSegmentSum_:jue});function Yue(n,e,t,r,a,i,o,s){var u=P(n,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=P(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=U.runKernel(S3,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var Zue=H({stringNGrams_:Yue});function Jue(n,e,t){t===void 0&&(t=!0);var r=P(n,"input","stringSplit","string"),a=P(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:r,delimiter:a},s=U.runKernel(N3,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var Que=H({stringSplit_:Jue});function ece(n,e){var t=P(n,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return U.runKernel(T3,a,r)}var tce=H({stringToHashBucketFast_:ece});var nce={fft:Z0,ifft:Jd,rfft:J0,irfft:HF},rce={hammingWindow:Dse,hannWindow:eR,frame:tR,stft:Pse},ace={flipLeftRight:zse,grayscaleToRGB:qse,resizeNearestNeighbor:fue,resizeBilinear:cue,rotateWithOffset:Vse,cropAndResize:Bse,nonMaxSuppression:Use,nonMaxSuppressionAsync:Qse,nonMaxSuppressionWithScore:tue,nonMaxSuppressionWithScoreAsync:rue,nonMaxSuppressionPadded:iue,nonMaxSuppressionPaddedAsync:sue,threshold:pue,transform:mue},ice={bandPart:yue,gramSchmidt:wue,qr:kue},oce={absoluteDifference:Tue,computeWeightedLoss:eo,cosineDistance:Iue,hingeLoss:Aue,huberLoss:Due,logLoss:Rue,meanSquaredError:Pue,sigmoidCrossEntropy:Lue,softmaxCrossEntropy:que},sce={sparseFillEmptyRows:Vue,sparseReshape:Uue,sparseSegmentMean:Kue,sparseSegmentSum:Xue},uce={stringNGrams:Zue,stringSplit:Que,stringToHashBucketFast:tce};var iR=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),oR=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function sR(n){q(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),q(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),q(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),oR.register(n)}var cce={__proto__:null,Serializable:iR,SerializationMap:oR,registerClass:sR},Po=function(n){Ji(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.minimize=function(t,r,a){r===void 0&&(r=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Er(s),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return AF(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Er(this.iterations_)},e.prototype.saveIterations=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Rt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return je(this,void 0,void 0,function(){var r;return Xe(this,function(a){switch(a.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(iR);Object.defineProperty(Po,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var iy=function(n){Ji(e,n);function e(t,r,a){a===void 0&&(a=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=U.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i],u=!1;r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:Mn(function(){return ca(s).variable(u)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:Mn(function(){return ca(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable,f=r.accumulatedUpdates[o].variable;Mn(function(){var h=ct(Me(l,r.rho),Me(ri(c),1-r.rho)),d=Me(Gt(Zi(ct(f,r.epsilon)),Zi(ct(l,r.epsilon))),c),p=ct(Me(f,r.rho),Me(ri(d),1-r.rho));l.assign(h),f.assign(p);var v=ct(Me(d,-r.learningRate),s);s.assign(v)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Er(this.accumulatedGrads.map(function(t){return t.variable})),Er(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=wt(wt([],ke(this.accumulatedGrads),!1),ke(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r,a;return Xe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e}(Po),oy=function(n){Ji(e,n);function e(t,r){r===void 0&&(r=.1);var a=n.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=r,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i];if(r.accumulatedGrads[o]==null){var u=!1;r.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:Mn(function(){return uf(s.shape,r.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable;Mn(function(){var f=ct(l,ri(c));l.assign(f);var h=ct(Me(Gt(c,Zi(ct(f,U.backend.epsilon()))),-r.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Er(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r;return Xe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e}(Po),sy=function(n){Ji(e,n);function e(t,r,a,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Mn(function(){o.accBeta1=Rt(r).variable(),o.accBeta2=Rt(a).variable()}),i==null&&(o.epsilon=U.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mn(function(){var i=bt(1,r.accBeta1),o=bt(1,r.accBeta2);a.forEach(function(s,u){var c=U.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Mn(function(){return ca(c).variable(l)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:Mn(function(){return ca(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,p=ct(Me(h,r.beta1),Me(f,1-r.beta1)),v=ct(Me(d,r.beta2),Me(ri(f),1-r.beta2)),m=Gt(p,i),g=Gt(v,o);h.assign(p),d.assign(v);var y=ct(Me(Gt(m,ct(Zi(g),r.epsilon)),-r.learningRate),c);c.assign(y)}}),r.accBeta1.assign(Me(r.accBeta1,r.beta1)),r.accBeta2.assign(Me(r.accBeta2,r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Er(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Er(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=wt(wt([],ke(this.accumulatedFirstMoment),!1),ke(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r,a,i=this;return Xe(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Mn(function(){i.accBeta1.assign(Yl(i.beta1,i.iterations_+1)),i.accBeta2.assign(Yl(i.beta2,i.iterations_+1))}),r=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(r,r*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e}(Po),uy=function(n){Ji(e,n);function e(t,r,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Mn(function(){s.iteration=Rt(0).variable(),s.accBeta1=Rt(r).variable()}),i==null&&(s.epsilon=U.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mn(function(){var i=bt(1,r.accBeta1),o=Gt(-r.learningRate,ct(Me(r.iteration,r.decay),1));a.forEach(function(s,u){var c=U.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:ca(c).variable(l)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:ca(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,p=ct(Me(h,r.beta1),Me(f,1-r.beta1)),v=Me(d,r.beta2),m=ua(f),g=PF(v,m);h.assign(p),d.assign(g);var y=ct(Me(Gt(o,i),Gt(p,ct(g,r.epsilon))),c);c.assign(y)}}),r.iteration.assign(ct(r.iteration,1)),r.accBeta1.assign(Me(r.accBeta1,r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Er(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Er(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e}(Po),gp=function(n){Ji(e,n);function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=U.registeredVariables[i];Mn(function(){var c=ct(Me(r.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=cF(Rt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=r.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e}(Po),cy=function(n){Ji(e,n);function e(t,r,a){a===void 0&&(a=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=a,i.accumulations=[],i.m=Rt(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i];if(r.accumulations[o]==null){var u=!1;r.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:Mn(function(){return ca(s).variable(u)})}}var c=r.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&Mn(function(){var f,h=ct(Me(r.m,c),l);r.useNesterov?f=ct(Me(r.c,ct(l,Me(h,r.m))),s):f=ct(Me(r.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Er(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r;return Xe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e}(gp),ly=function(n){Ji(e,n);function e(t,r,a,i,o){r===void 0&&(r=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=U.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i],u=!1;r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:Mn(function(){return ca(s).variable(u)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:Mn(function(){return ca(s).variable(u)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:Mn(function(){return ca(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedMeanSquares[o].variable,f=r.accumulatedMoments[o].variable;Mn(function(){var h=ct(Me(l,r.decay),Me(ri(c),1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,p=ct(Me(d,r.decay),Me(c,1-r.decay)),v=Gt(Me(c,r.learningRate),Zi(bt(h,ct(ri(p),r.epsilon)))),m=ct(Me(f,r.momentum),v);l.assign(h),d.assign(p),f.assign(m);var g=bt(s,m);s.assign(g)}else{var y=ct(Me(l,r.decay),Me(ri(c),1-r.decay)),m=ct(Me(f,r.momentum),Gt(Me(c,r.learningRate),Zi(ct(y,r.epsilon))));l.assign(y),f.assign(m);var g=bt(s,m);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Er(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Er(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Er(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=wt(wt([],ke(this.accumulatedMeanSquares),!1),ke(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,wt([],ke(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r,a;return Xe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(r*2,r*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e}(Po),lce=[iy,oy,sy,uy,cy,ly,gp];function fce(){var n,e;try{for(var t=cr(lce),r=t.next();!r.done;r=t.next()){var a=r.value;sR(a)}}catch(i){n={error:i}}finally{try{r&&!r.done&&(e=t.return)&&e.call(t)}finally{if(n)throw n.error}}}var hce="model",dce=".json",pce=".weights.bin";function RA(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var ep=function(){function n(e){if(!vt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),(e==null||e.length===0)&&(e=hce),this.modelJsonFileName=e+dce,this.weightDataFileName=e+pce}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s;return Xe(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=J3(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,RA(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,RA(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:of(e)}]}})})},n}();ep.URL_SCHEME="downloads://";var vce=function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}return n.prototype.load=function(){return je(this,void 0,void 0,function(){var e=this;return Xe(this,function(t){return[2,new Promise(function(r,a){var i=new FileReader;i.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(u==null){a(new Error("modelTopology field is missing from file ".concat(e.jsonFile.name)));return}var c=s.weightsManifest;if(c==null){a(new Error("weightManifest field is missing from file ".concat(e.jsonFile.name)));return}if(e.weightsFiles.length===0){r({modelTopology:u});return}var l=$0(s,function(f){return e.loadWeights(f)});r(l)},i.onerror=function(o){return a("Failed to read model topology and weights manifest JSON "+"from file '".concat(e.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(e.jsonFile)})]})})},n.prototype.loadWeights=function(e){var t,r,a=this,i=[],o=[];try{for(var s=cr(e),u=s.next();!u.done;u=s.next()){var c=u.value;i.push.apply(i,wt([],ke(c.weights),!1)),o.push.apply(o,wt([],ke(c.paths),!1))}}catch(h){t={error:h}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var l=this.checkManifestAndWeightFiles(e),f=o.map(function(h){return a.loadWeightsFile(h,l[h])});return Promise.all(f).then(function(h){return[i,z0(h)]})},n.prototype.loadWeightsFile=function(e,t){return new Promise(function(r,a){var i=new FileReader;i.onload=function(o){var s=o.target.result;r(s)},i.onerror=function(o){return a("Failed to weights data from file of path '".concat(e,"'."))},i.readAsArrayBuffer(t)})},n.prototype.checkManifestAndWeightFiles=function(e){var t,r,a=this,i=[],o=this.weightsFiles.map(function(f){return _A(f.name)}),s={};try{for(var u=cr(e),c=u.next();!c.done;c=u.next()){var l=c.value;l.paths.forEach(function(f){var h=_A(f);if(i.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(h,"'"));if(i.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '".concat(h,"' is not provided."));s[f]=a.weightsFiles[o.indexOf(h)]})}}catch(f){t={error:f}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}if(i.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(i.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return s},n}(),mce=function(n){return vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ep.URL_SCHEME)?gce(n.slice(ep.URL_SCHEME.length)):null};fa.registerSaveRouter(mce);function gce(n){return n===void 0&&(n="model"),new ep(n)}function yce(n){return new vce(n)}function OA(n,e,t,r){o(n),t=t??0,r=r??1,s(t,r);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/n.length*(r-t);return e(l),c}),u};function o(u){q(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){q(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),q(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),q(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(n.map(i))}function uR(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Xe(this,function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?vt().platform.fetch:e.fetchFunc,r=n.map(function(p){return t(p,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=d.sent(),[3,4];case 2:return[4,OA(r,e.onProgress,a,i)];case 3:s=d.sent(),d.label=4;case 4:return o=s,u=o.map(function(p){return p.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=d.sent(),[3,8];case 6:return[4,OA(u,e.onProgress,c,l)];case 7:h=d.sent(),d.label=8;case 8:return f=h,[2,f]}})})}function bce(n,e,t,r){return e===void 0&&(e=""),je(this,void 0,void 0,function(){var a,i;return Xe(this,function(o){return a=function(s){return uR(s,{requestInit:r})},i=cR(a),[2,i(n,e,t)]})})}function cR(n){var e=this;return function(t,r,a){return r===void 0&&(r=""),je(e,void 0,void 0,function(){var i,o,s,u,c,l,f,h,d,p;return Xe(this,function(v){switch(v.label){case 0:if(i=t.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],t.forEach(function(m,g){var y=0;m.weights.forEach(function(b){var w="quantization"in b?b.quantization.dtype:b.dtype,x=g0[w]*Ut(b.shape),N=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:b,groupOffset:y,sizeBytes:x})};a!=null?a.forEach(function(T,E){T===b.name&&(N(),s[E]=!0)}):N(),u.push(b.name),y+=x})}),!s.every(function(m){return m}))throw c=a.filter(function(m,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),`. 
`)+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));return l=i.reduce(function(m,g,y){return g&&m.push(y),m},[]),f=[],l.forEach(function(m){t[m].paths.forEach(function(g){var y=r+(r.endsWith("/")?"":"/")+g;f.push(y)})}),[4,n(f)];case 1:return h=v.sent(),d={},p=0,l.forEach(function(m){for(var g=t[m].paths.length,y=0,b=0;b<g;b++)y+=h[p+b].byteLength;for(var w=new ArrayBuffer(y),x=new Uint8Array(w),N=0,T=0;T<g;T++){var E=new Uint8Array(h[p+T]);x.set(E,N),N+=E.byteLength}var C=o[m];C.forEach(function(F){var D=w.slice(F.groupOffset,F.groupOffset+F.sizeBytes),O=Z3(D,[F.manifestEntry]);for(var L in O)d[L]=O[L]}),p+=g}),[2,d]}})})}}var wce="application/octet-stream",xce="application/json",fy=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(q(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=vt().platform.fetch,q(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&q(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,r,a,i;return Xe(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=J3(e,r),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:xce}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:wce}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:of(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."))}})})},n.prototype.load=function(){return je(this,void 0,void 0,function(){var e,t,r,a,i,o=this;return Xe(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,$0(t,function(u){return o.loadWeights(u)})]}})})},n.prototype.loadWeights=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E;return Xe(this,function(C){switch(C.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,r=ke(kce(t),2),a=r[0],i=r[1],o=this.weightPathPrefix||a,s=eF(e),u=[],c=[];try{for(l=cr(e),f=l.next();!f.done;f=l.next()){h=f.value;try{for(d=(T=void 0,cr(h.paths)),p=d.next();!p.done;p=d.next())v=p.value,this.weightUrlConverter!=null?c.push(this.weightUrlConverter(v)):u.push(o+v+i)}catch(F){T={error:F}}finally{try{p&&!p.done&&(E=d.return)&&E.call(d)}finally{if(T)throw T.error}}}}catch(F){x={error:F}}finally{try{f&&!f.done&&(N=l.return)&&N.call(l)}finally{if(x)throw x.error}}return this.weightUrlConverter?(g=(m=u.push).apply,y=[u],b=[[]],[4,Promise.all(c)]):[3,2];case 1:g.apply(m,y.concat([wt.apply(void 0,b.concat([ke.apply(void 0,[C.sent()]),!1]))])),C.label=2;case 2:return[4,uR(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return w=C.sent(),[2,[s,z0(w)]]}})})},n}();fy.URL_SCHEME_REGEX=/^https?:\/\//;function kce(n){var e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),a=t>e?n.substring(t):"";return[r+"/",a]}function E0(n){return n.match(fy.URL_SCHEME_REGEX)!=null}var lR=function(n,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(n)?t=n.every(function(r){return E0(r)}):t=E0(n),t?hy(n,e):null};fa.registerSaveRouter(lR);fa.registerLoadRouter(lR);function hy(n,e){return new fy(n,e)}function Sce(n,e){return hy(n,e)}var t0=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return this.modelArtifacts},n}(),fR=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return this.saveHandler(e)},n}(),Nce=function(){function n(e){e.load&&(this.load=function(){return Promise.resolve(e.load())}),e.save&&(this.save=function(t){return Promise.resolve(e.save(t))})}return n}();function Tce(n,e,t,r){var a=arguments;return new Nce(hR.apply(void 0,wt([],ke(a),!1)))}function hR(n,e,t,r){if(arguments.length===1){var a=n.modelTopology!=null||n.weightSpecs!=null;return a?new t0(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new t0({modelTopology:n}))}else return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new t0({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r})}function Ece(n){return new fR(n)}function Ice(n){return new fR(n)}var Cce={__proto__:null,browserFiles:yce,browserHTTPRequest:Sce,concatenateArrayBuffers:z0,decodeWeights:Z3,encodeWeights:dee,fromMemory:Tce,fromMemorySync:hR,getLoadHandlers:Nee,getModelArtifactsForJSON:$0,getModelArtifactsForJSONSync:Q3,getModelArtifactsInfoForJSON:of,getSaveHandlers:See,getWeightSpecs:eF,http:hy,isHTTPScheme:E0,loadWeights:bce,registerLoadRouter:kee,registerSaveRouter:xee,weightsLoaderFactory:cR,withSaveHandler:Ece,withSaveHandlerSync:Ice,copyModel:Lee,listModels:Mee,moveModel:zee,removeModel:Bee};function Ace(n,e,t){var r=P(n,"labels","confusionMatrix"),a=P(e,"predictions","confusionMatrix");q(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(t)}),q(r.rank===1,function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)}),q(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)}),q(r.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+"".concat(r.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."}),q(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+"".concat(t)});var i=N0(Nn(r,"int32"),t),o=N0(Nn(a,"int32"),t),s=Qd(i),u=Ft(s,o);return Nn(u,"int32")}var _ce=H({confusionMatrix_:Ace});var Dce={__proto__:null,confusionMatrix:_ce},fs;function dR(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(n.constructor.name));var u=Gd(a0,U.backendName);if(u!=null){var c={pixels:n},l={numChannels:e};return U.runKernel(a0,c,l)}var f=ke(a?[n.videoWidth,n.videoHeight]:[n.width,n.height],2),h=f[0],d=f[1],p;if(o)p=n.getContext("2d").getImageData(0,0,h,d).data;else if(r||t)p=n.data;else if(i||a||s){if(fs==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")fs=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else fs=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});fs.canvas.width=h,fs.canvas.height=d,fs.drawImage(n,0,0,h,d),p=fs.getImageData(0,0,h,d).data}var v;if(e===4)v=new Int32Array(p);else{var m=h*d;v=new Int32Array(m*e);for(var g=0;g<m;g++)for(var y=0;y<e;++y)v[g*e+y]=p[g*4+y]}var b=[d,h,e];return XF(v,b,"int32")}function Fce(n){return n!=null&&n.data instanceof Uint8Array}function Rce(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function Oce(n){return n!=null&&n.width!==0&&n.height!==0}function Pce(n){return Rce()&&!(n instanceof ImageBitmap)&&Oce(n)&&!Fce(n)}function Mce(n,e){return e===void 0&&(e=3),je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){switch(a.label){case 0:if(t=null,!(vt().getBool("WRAP_TO_IMAGEBITMAP")&&Pce(n)))return[3,5];r=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,createImageBitmap(n,{premultiplyAlpha:"none"})];case 2:return r=a.sent(),[3,4];case 3:return a.sent(),r=null,[3,4];case 4:return r!=null&&r.width===n.width&&r.height===n.height?t=r:t=n,[3,6];case 5:t=n,a.label=6;case 6:return[2,dR(t,e)]}})})}function Bce(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h,d,p,v,m,g;return Xe(this,function(y){switch(y.label){case 0:if(t=P(n,"img","toPixels"),n instanceof Pn||(r=t,t=Nn(r,"int32"),r.dispose()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(t.rank,"."));if(a=ke(t.shape.slice(0,2),2),i=a[0],o=a[1],s=t.rank===2?1:t.shape[2],s>4||s===2)throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(s));if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error("Unsupported type for toPixels: ".concat(t.dtype,".")+" Please use float32 or int32 tensors.");return[4,t.data()];case 1:for(u=y.sent(),c=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*i*4),f=0;f<i*o;++f){for(h=[0,0,0,255],d=0;d<s;d++){if(p=u[f*s+d],t.dtype==="float32"){if(p<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(p,"."))}else if(t.dtype==="int32"&&(p<0||p>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(p,"."));s===1?(h[0]=p*c,h[1]=p*c,h[2]=p*c):h[d]=p*c}v=f*4,l[v+0]=Math.round(h[0]),l[v+1]=Math.round(h[1]),l[v+2]=Math.round(h[2]),l[v+3]=Math.round(h[3])}return e!=null&&(e.width=o,e.height=i,m=e.getContext("2d"),g=new ImageData(l,o,i),m.putImageData(g,0,0)),t!==n&&t.dispose(),[2,l]}})})}var Lce=H({fromPixels_:dR}),zce={__proto__:null,fromPixelsAsync:Mce,toPixels:Bce,fromPixels:Lce};function pR(n,e){var t=n.shape.length,r=e.shape.length;if(t<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(t,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.shape[r-1]>t)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(e.shape[r-1]," vs. ").concat(t));if(Ut(n.shape)===0)throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(n.shape,"."));for(var a=e.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=n.shape,c=a.slice();c.pop();for(var l=1,s=i;s<t;++s)l*=u[s],c.push(u[s]);var f=wt(wt([],ke(ec(n.shape).map(function(h){return h/l})),!1),[1],!1).slice(0,i);return[c,o,l,f]}var $ce={__proto__:null,prepareAndValidate:pR},I0=-2,qce=-1;function Wce(n,e,t){var r=n.shape.length;q(r===e.length,function(){return"Error in slice".concat(r,"D: Length of begin ").concat(e," must ")+"match the rank of the array (".concat(r,").")}),q(r===t.length,function(){return"Error in slice".concat(r,"D: Length of size ").concat(t," must ")+"match the rank of the array (".concat(r,").")});for(var a=function(o){q(e[o]+t[o]<=n.shape[o],function(){return"Error in slice".concat(r,"D: begin[").concat(o,"] + size[").concat(o,"] ")+"(".concat(e[o]+t[o],") would overflow input.shape[").concat(o,"] (").concat(n.shape[o],")")})},i=0;i<r;++i)a(i)}function Vce(n){for(var e=[],t=0;n>0;)n&1&&e.push(t),n/=2,t++;return e}function Gce(n,e,t){for(var r=[],a=0;a<n.length;a++)r[a]=Math.ceil((e[a]-n[a])/t[a]);return r}function vR(n,e,t,r){for(var a=wt([],ke(n),!1),i=a.length;i<r.length;i++)a.push(1);for(var i=0;i<t;i++)i===0?a[e]=1:(a.splice(e,0,1),a.pop());return a}function mR(n,e,t){return t<=n?t:t-(e-1)}function gR(n,e){for(var t=[],r=0;r<n;r++)t.push(e+r);return t}function Uce(n,e,t,r,a,i,o,s,u){var c=n.length,l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&t>0){var d=e[0],p=t+1;l=yR(o,d,p,r,n),f=bR(s,d,p,a,n),h=vR(i,d,p,n)}else for(var v=0;v<c;v++)l[v]=xR(o,r,i,n,v,u),f[v]=kR(s,a,i,n,v,u),h[v]=wR(i,v,u);return{begin:l,end:f,strides:h}}function yR(n,e,t,r,a){for(var i=wt([],ke(a),!1),o=gR(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=mR(e,t,s),c=r[u];n&1<<u&&(c=0),i[s]=c}return i}function bR(n,e,t,r,a){for(var i=wt([],ke(a),!1),o=gR(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=mR(e,t,s),c=r[u];n&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var f=a[l];i[l]<0&&(i[l]+=f),i[l]=Wl(0,i[l],a[l])}return i}function wR(n,e,t){var r=n[e];return(t&1<<e||r==null)&&(r=1),r}function xR(n,e,t,r,a,i){var o=e[a],s=t[a]||1;(n&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=Wl(0,o,u-1),o}function kR(n,e,t,r,a,i){var o=e[a],s=t[a]||1;(n&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),s>0?o=Wl(0,o,u):o=Wl(-1,o,u-1),o}function Hce(n,e,t){for(var r=t.length,a=0;a<t.length;a++)if(t[a]>1){r=a;break}for(var a=r+1;a<t.length;a++)if(e[a]>0||t[a]!==n[a])return!1;return!0}function Kce(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function jce(n,e,t){var r,a=n.shape.length;typeof e=="number"?r=wt([e],ke(new Array(a-1).fill(0)),!1):e.length<a?r=e.concat(new Array(a-e.length).fill(0)):r=e.slice(),r.forEach(function(o){q(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=wt([t],ke(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(q(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),n.shape[s]-r[s])}),[r,i]}function Xce(n,e,t,r,a,i,o,s,u){var c;if(r==null?(c=new Array(e.length),c.fill(1)):c=r,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<f.dims;h++)l&&(1<<h&s)!==0&&f.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);var d={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Yce(f,d);for(var p=!0,v=!0,m=!0,g=[],y=[],h=0;h<n.length;++h){if(d.strides[h]===0)throw Error("strides[".concat(h,"] must be non-zero"));var b=!!(d.shrinkAxisMask&1<<h),w=n[h];if(w===-1){g.push(b?1:-1);continue}var x=[d.beginMask&1<<h,d.endMask&1<<h],N=[d.strides[h]>0?0:-1,d.strides[h]>0?w:w-1];if(b&&d.strides[h]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&d.strides[h]===1;var T=!!(d.beginMask&1<<h&&d.endMask&1<<h);if(d.beginValid&&d.endValid){if(b){var E=d.begin[h]<0?w+d.begin[h]:d.begin[h];if(d.begin[h]=E,d.end[h]=d.begin[h]+1,E<0||E>=w)throw Error("slice index ".concat(d.begin[h]," of dimension ").concat(h," out of bounds."))}else d.begin[h]=PA(d.begin[h],0,d.strides[h],w,x,N),d.end[h]=PA(d.end[h],1,d.strides[h],w,x,N);var C=d.strides[h]===1&&d.begin[h]===0&&d.end[h]===w;p=p&&C,v=v&&(h===0&&d.strides[h]===1||C)}else p=p&&d.strides[h]===1&&T,v=v&&(h===0&&d.strides[h]===1||T);var F=void 0,D=!1;if(d.beginValid&&d.endValid?(F=d.end[h]-d.begin[h],D=!0):b?(F=1,D=!0):T&&w>=0&&(d.strides[h]<0?F=-w:F=w,D=!0),D){var O=void 0;F===0||F<0!=d.strides[h]<0?O=0:O=Math.trunc(F/d.strides[h])+(F%d.strides[h]!==0?1:0),g.push(O)}else g.push(-1)}for(var L=0;L<d.finalShapeGatherIndices.length;++L){var z=d.finalShapeGatherIndices[L];z>=0?y.push(g[z]):z===I0&&y.push(1)}var $=y.filter(function(B,W){return d.finalShapeGatherIndices[W]!==I0});return{finalShapeSparse:$,finalShape:y,isIdentity:p,sliceDim0:v,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function Yce(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;var t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(var r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask)for(var a=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);t<a;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r;else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(I0),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error("Index out of range using input dim ".concat(t,"; input ")+"has only ".concat(e.dims," dims, ").concat(e.begin.length,"."));n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(qce),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function PA(n,e,t,r,a,i){if(a[e])return t>0?i[e]:i[e+1&1];var o=n<0?r+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}var SR={__proto__:null,assertParamsValid:Wce,maskToAxes:Vce,computeOutShape:Gce,stridesWithElidedDims:vR,getNormalizedAxes:Uce,startIndicesWithElidedDims:yR,stopIndicesWithElidedDims:bR,stridesForAxis:wR,startForAxis:xR,stopForAxis:kR,isSliceContinous:Hce,computeFlatOffset:Kce,parseSliceParams:jce,sliceInfo:Xce};var Zce="4.2.0";var NR=function(){function n(){}return n.sgd=function(e){return new gp(e)},n.momentum=function(e,t,r){return r===void 0&&(r=!1),new cy(e,t,r)},n.rmsprop=function(e,t,r,a,i){return t===void 0&&(t=.9),r===void 0&&(r=0),a===void 0&&(a=null),i===void 0&&(i=!1),new ly(e,t,r,a,i)},n.adam=function(e,t,r,a){return e===void 0&&(e=.001),t===void 0&&(t=.9),r===void 0&&(r=.999),a===void 0&&(a=null),new sy(e,t,r,a)},n.adadelta=function(e,t,r){return e===void 0&&(e=.001),t===void 0&&(t=.95),r===void 0&&(r=null),new iy(e,t,r)},n.adamax=function(e,t,r,a,i){return e===void 0&&(e=.002),t===void 0&&(t=.9),r===void 0&&(r=.999),a===void 0&&(a=null),i===void 0&&(i=0),new uy(e,t,r,a,i)},n.adagrad=function(e,t){return t===void 0&&(t=.1),new oy(e,t)},n}();var Jce=NR;var Qce=function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(n){return n()}}();function ele(){return new Promise(function(n){return Qce(function(){return n()})})}function tle(n,e){var t=n[0].length;n.forEach(function(a,i){q(a.length===t,function(){return"Error in concat".concat(t,"D: rank of tensors[").concat(i,"] must be the same ")+"as the rank of the rest (".concat(t,")")})}),q(e>=0&&e<t,function(){return"Error in concat".concat(t,"D: axis must be between 0 and ").concat(t-1,".")});var r=n[0];n.forEach(function(a,i){for(var o=0;o<t;o++)q(o===e||a[o]===r[o],function(){return"Error in concat".concat(t,"D: Shape of tensors[").concat(i,"] (").concat(a,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(i,".")})})}function nle(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}var Ii;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Ii||(Ii={}));function rle(n,e,t){var r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.rank = ").concat(n+t.length,", but shape.rank = ").concat(r.length));for(var a=1;a<t.length;++a){var i=t[a],o=r[r.length-t.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.shape[").concat(a+n,"] = ").concat(i," but shape[").concat(a+n,"] = ").concat(s))}else r[o]=i}return r}function ale(n){var e,t,r={FIRST_DIM_SIZE:Ii.FIRST_DIM_SIZE,VALUE_ROWIDS:Ii.VALUE_ROWIDS,ROW_LENGTHS:Ii.ROW_LENGTHS,ROW_SPLITS:Ii.ROW_SPLITS,ROW_LIMITS:Ii.ROW_LIMITS,ROW_STARTS:Ii.ROW_STARTS},a=[];try{for(var i=cr(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(s in r)a.push(r[s]);else break}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return a}function ile(n){return n.length===0?0:n[0]===Ii.FIRST_DIM_SIZE?n.length-1:n.length}function ole(n,e){if(!(n==null||e==null)){var t=n.length,r=e.length;if(t>=r)throw new Error("defaultValue.shape=".concat(n," and ragged tensor flatValues.shape=").concat(e,", are incompatible: defaultValue.rank = ").concat(t," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(t,r-1);++a){var i=n[a],o=e[a+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error("defaultValue.shape=".concat(n,", and ragged tensor input flatValues.shape=").concat(e," are incompatible: defaultValue.shape[").concat(a-n.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-n.length,"] = ").concat(o))}}}var dy=30;function sle(n){return n<=dy?n:Vd(n,Math.floor(Math.sqrt(n)))}function ule(n,e,t){var r=t*(typeof n=="number"?n:n[0]),a=e*(typeof n=="number"?n:n[1]);return[r,a]}function cle(n,e,t,r){r===void 0&&(r=!0);var a=[];if(r)a=a.concat(e.slice(0)),a.push(n[0]/t),a=a.concat(n.slice(1));else{a=a.concat(n[0]);for(var i=e.length,o=0;o<i;++o)a=a.concat([n[o+1]/e[o],e[o]]);a=a.concat(n.slice(i+1))}return a}function lle(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var a=e+1;a<n;++a)a<=2*e?(r.push(a),r.push(a-(e+1))):r.push(a)}else{for(var i=[],o=[],a=1;a<n;++a)a>=e*2+1||a%2===1?o.push(a):i.push(a);r.push.apply(r,wt([],ke(i),!1)),r.push(0),r.push.apply(r,wt([],ke(o),!1))}return r}function fle(n,e,t,r){r===void 0&&(r=!0);var a=[];r?a.push(n[0]/t):a.push(n[0]*t);for(var i=1;i<n.length;++i)i<=e.length?r?a.push(e[i-1]*n[i]):a.push(n[i]/e[i-1]):a.push(n[i]);return a}function hle(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function dle(n,e,t){for(var r=n.slice(0,1),a=0;a<t;++a)r.push(n[a+1]-e[a][0]-e[a][1]);return r}var ple=1.7580993408473768,vle=1.0507009873554805;var mle=.3275911,gle=.254829592,yle=-.284496736,ble=1.421413741,wle=-1.453152027,xle=1.061405429;function kle(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(n.length,", imag: ").concat(e.length,"."));for(var t=new Float32Array(n.length*2),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function Sle(n){for(var e=new Float32Array(n.length/2),t=new Float32Array(n.length/2),r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function Nle(n){for(var e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e),a=0;a<n.length;a+=4)t[Math.floor(a/4)]=n[a],r[Math.floor(a/4)]=n[a+1];return{real:t,imag:r}}function Tle(n){for(var e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e),a=2;a<n.length;a+=4)t[Math.floor(a/4)]=n[a],r[Math.floor(a/4)]=n[a+1];return{real:t,imag:r}}function Ele(n,e){var t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function Ile(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function Cle(n,e){for(var t=new Float32Array(n/2),r=new Float32Array(n/2),a=0;a<Math.ceil(n/2);a++){var i=(e?2:-2)*Math.PI*(a/n);t[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:t,imag:r}}function Ale(n,e,t){var r=(t?2:-2)*Math.PI*(n/e),a=Math.cos(r),i=Math.sin(r);return{real:a,imag:i}}var n0="->",_le=/->/g,MA=",",BA="...";function Dle(n,e){n=n.replace(/\s/g,"");var t=(n.length-n.replace(_le,"").length)/n0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error('Equation must contain exactly one arrow ("'.concat(n0,'").'));var r=ke(n.split(n0),2),a=r[0],i=r[1];q(a.indexOf(BA)===-1,function(){return'The ellipsis notation ("'.concat(BA,'") is not supported yet.')});var o=a.split(MA),s=o.length;if(e!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(e));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],c=function(g){var y=i[g];if(!o.some(function(b){return b.indexOf(y)!==-1}))throw new Error("Output subscripts contain the label ".concat(y," ")+"not present in the input subscripts.");u.indexOf(y)===-1&&u.push(y)},l=0;l<i.length;++l)c(l);for(var l=0;l<a.length;++l){var f=a[l];u.indexOf(f)===-1&&f!==MA&&u.push(f)}for(var h=new Array(o.length),l=0;l<s;++l){if(new Set(o[l].split("")).size!==o[l].length)throw new Error("Found duplicate axes in input component ".concat(o[l],". ")+"Support for duplicate axes in input is not implemented yet.");h[l]=[];for(var d=0;d<o[l].length;++d)h[l].push(u.indexOf(o[l][d]))}for(var p=u.length,v=i.length,m=[],l=v;l<p;++l)m.push(l);return{allDims:u,summedDims:m,idDims:h}}function Fle(n,e){var t=new Array(n);t.fill(-1);for(var r=0;r<e.length;++r)t[e[r]]=r;for(var a=[],r=0;r<n;++r)t[r]===-1&&a.push(r);return t=t.filter(function(i){return i!==-1}),{permutationIndices:t,expandDims:a}}function Rle(n,e,t){for(var r=new Array(n),a=function(o){for(var s=t[o].shape,u=function(l){r[e[o][l]]===void 0?r[e[o][l]]=s[l]:q(r[e[o][l]]===s[l],function(){return"Expected dimension ".concat(r[e[o][l]]," at axis ").concat(l," ")+"of input shaped ".concat(JSON.stringify(s),", ")+"but got dimension ".concat(s[l])})},c=0;c<e[o].length;++c)u(c)},i=0;i<t.length;++i)a(i)}function Ole(n,e){var t,r,a=n,i=[],o=0;n.length===0&&a.push(-1),o=n.length+1;for(var s=0;s<o;++s)i.push([]);for(var u=[],s=0;s<a.length;++s){var c=a[s],l=Mle(e,c);try{for(var f=(t=void 0,cr(l)),h=f.next();!h.done;h=f.next()){var d=h.value;u.indexOf(d)===-1&&(i[s].push(d),u.push(d))}}catch(v){t={error:v}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}}return{path:a,steps:i}}function Ple(n){return n.every(function(e,t){return e===t})}function Mle(n,e){for(var t=[],r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function Ble(n,e,t){t===void 0&&(t=0);var r=[];if(typeof e=="number")q(n.shape[t]%e===0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(n.shape[t]/e);else{var a=e.reduce(function(s,u){return u===-1&&(s+=1),s},0);q(a<=1,function(){return"There should be only one negative value in split array."});var i=e.indexOf(-1);if(i!==-1){var o=e.reduce(function(s,u){return u>0?s+u:s});e[i]=n.shape[t]-o}q(n.shape[t]===e.reduce(function(s,u){return s+u}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e}return r}function Lle(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = `.concat(n)}function zle(n,e){return"indices(".concat(n,", 0) is invalid: ").concat(e," < 0")}function $le(n,e,t){return"indices(".concat(n,", 0) is invalid: ").concat(e," >= ").concat(t)}function qle(n,e){return"only one output dimension may be -1, not both ".concat(n," and ").concat(e)}function Wle(n,e){return"size ".concat(n," must be non-negative, not ").concat(e)}function Vle(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Gle(n,e){var t=Ut(n),r=Ut(e);return"Input to reshape is a SparseTensor with ".concat(t,`
  dense values, but the requested shape requires a multiple of `).concat(r,". inputShape=").concat(n," outputShape= ").concat(e)}function Ule(n,e){var t=Ut(n),r=Ut(e);return"Input to reshape is a tensor with ".concat(t," dense values, but the requested shape has ").concat(r,". inputShape=").concat(n," outputShape=").concat(e)}function Hle(){return"segment ids must be >= 0"}function Kle(){return"segment ids are not increasing"}function jle(n,e){return"Segment id ".concat(n," out of range [0, ").concat(e,"), possibly because segmentIds input is not sorted.")}function Xle(n,e,t){return"Bad: indices[".concat(n,"] == ").concat(e," out of range [0, ").concat(t,")")}function Yle(n,e){var t=!1,r;for(n<=dy?(r=n,t=!0):r=Vd(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=Vd(n,r+1);return r}function Zle(n,e,t){for(var r=[],a=n.length,i=0;i<a;i++)i!==e?r.push(n[i]):r.push(t);return r}function Jle(n,e,t,r){var a=e.shape.length,i=n.shape.length;if(r!==0&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,`) must be less than rank(x) (
    `).concat(i,")."));if(t<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(t,")."));for(var o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(n.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(e.shape[o],"."));for(var s=n.shape[t],u=[],c=1,l=1,f=1,o=0;o<r;++o)u.push(n.shape[o]),c*=n.shape[o];for(var o=r;o<t;o++)u.push(n.shape[o]),l*=n.shape[o];for(var o=r;o<a;o++)u.push(e.shape[o]);for(var o=t+1;o<i;o++)u.push(n.shape[o]),f*=n.shape[o];return{batchSize:c,sliceSize:f,outerSize:l,dimSize:s,outputShape:u}}var Qle={__proto__:null,segOpComputeOptimalWindowSize:Yle,computeOutShape:Zle,collectGatherOpShapeInfo:Jle};function efe(n){try{return n.map(function(e){return Kd(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function tfe(n){return n.map(function(e){return af(e)})}var nfe={__proto__:null,slice_util:SR,segment_util:Qle,fromUint8ToStringArray:efe,fromStringArrayToUint8:tfe,upcastType:ip,axesAreInnerMostDims:G0,combineLocations:xF,computeOutAndReduceShapes:vre,expandShapeToKeepDim:cf,assertAxesAreInnerMostDims:mre,getAxesPermutation:gre,getUndoAxesPermutation:yre,getInnerMostAxes:bre,getBroadcastDims:yF,getReductionAxes:V0,assertAndGetBroadcastShape:Bn,assertParamsConsistent:tle,computeOutShape:nle,computeDilation2DInfo:zte,computePool2DInfo:fF,computePool3DInfo:$te,computeConv2DInfo:sf,computeConv3DInfo:hF,computeDefaultPad:q0,tupleValuesAreOne:Xl,eitherStridesOrDilationsAreOne:Qi,stridesOrDilationsArePositive:xs,convertConv2DDataFormat:dF,checkPadOnDimRoundingMode:Ca,getFusedDyActivation:dp,getFusedBiasGradient:pp,applyActivation:vp,shouldFuse:mp,get RowPartitionType(){return Ii},combineRaggedTensorToTensorShapes:rle,getRowPartitionTypesHelper:ale,getRaggedRank:ile,validateDefaultValueShape:ole,PARALLELIZE_THRESHOLD:dy,computeOptimalWindowSize:sle,getImageCenter:ule,getReshaped:cle,getPermuted:lle,getReshapedPermuted:fle,getSliceBeginCoords:hle,getSliceSize:dle,prepareAndValidate:pR,validateUpdateShape:ty,validateInput:ny,calculateShapes:JF,SELU_SCALEALPHA:ple,SELU_SCALE:vle,ERF_P:mle,ERF_A1:gle,ERF_A2:yle,ERF_A3:ble,ERF_A4:wle,ERF_A5:xle,warn:To,log:AQ,mergeRealAndImagArrays:kle,splitRealAndImagArrays:Sle,complexWithEvenIndex:Nle,complexWithOddIndex:Tle,getComplexWithIndex:Ele,assignToTypedArray:Ile,exponents:Cle,exponent:Ale,decodeEinsumEquation:Dle,getEinsumPermutation:Fle,checkEinsumDimSizes:Rle,getEinsumComputePath:Ole,isIdentityPermutation:Ple,prepareSplitSize:Ble,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Lle,getSparseFillEmptyRowsNegativeIndexErrorMessage:zle,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:$le,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:qle,getSparseReshapeNegativeOutputDimErrorMessage:Wle,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Vle,getSparseReshapeInputOutputMultipleErrorMessage:Gle,getSparseReshapeInputOutputMismatchErrorMessage:Ule,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Hle,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Kle,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:jle,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Xle};var rfe={__proto__:null,nonMaxSuppressionV3Impl:nR,nonMaxSuppressionV4Impl:rR,nonMaxSuppressionV5Impl:aR,whereImpl:YF};fce();A.Abs=ZA;A.Acos=JA;A.Acosh=QA;A.AdadeltaOptimizer=iy;A.AdagradOptimizer=oy;A.AdamOptimizer=sy;A.AdamaxOptimizer=uy;A.Add=_0;A.AddN=e_;A.All=t_;A.Any=n_;A.ArgMax=r_;A.ArgMin=a_;A.Asin=i_;A.Asinh=o_;A.Atan=s_;A.Atan2=c_;A.Atanh=u_;A.AvgPool=l_;A.AvgPool3D=f_;A.AvgPool3DGrad=hQ;A.AvgPoolGrad=fQ;A.BatchMatMul=h_;A.BatchToSpaceND=d_;A.Bincount=p_;A.BroadcastArgs=v_;A.BroadcastTo=dQ;A.Cast=D0;A.Ceil=m_;A.ClipByValue=g_;A.Complex=y_;A.ComplexAbs=b_;A.Concat=w_;A.Conv2D=x_;A.Conv2DBackpropFilter=k_;A.Conv2DBackpropInput=S_;A.Conv3D=N_;A.Conv3DBackpropFilterV2=pQ;A.Conv3DBackpropInputV2=T_;A.Cos=E_;A.Cosh=I_;A.CropAndResize=__;A.Cumprod=C_;A.Cumsum=A_;A.DataStorage=VJ;A.DenseBincount=D_;A.DepthToSpace=F_;A.DepthwiseConv2dNative=R_;A.DepthwiseConv2dNativeBackpropFilter=O_;A.DepthwiseConv2dNativeBackpropInput=P_;A.Diag=M_;A.Dilation2D=B_;A.Dilation2DBackpropFilter=mQ;A.Dilation2DBackpropInput=vQ;A.Einsum=z_;A.Elu=$_;A.EluGrad=gQ;A.Environment=XA;A.Equal=W_;A.Erf=q_;A.Exp=V_;A.ExpandDims=G_;A.Expm1=U_;A.FFT=H_;A.Fill=K_;A.FlipLeftRight=j_;A.Floor=X_;A.FloorDiv=Y_;A.FromPixels=a0;A.FusedBatchNorm=Z_;A.FusedConv2D=o0;A.FusedDepthwiseConv2D=s0;A.GatherNd=Q_;A.GatherV2=J_;A.Greater=eD;A.GreaterEqual=tD;A.IFFT=nD;A.Identity=F0;A.Imag=rD;A.IsFinite=aD;A.IsInf=iD;A.IsNan=oD;A.KernelBackend=LA;A.LRN=mD;A.LRNGrad=xQ;A.LeakyRelu=sD;A.Less=uD;A.LessEqual=cD;A.LinSpace=lD;A.Log=fD;A.Log1p=hD;A.LogSoftmax=bQ;A.LogicalAnd=dD;A.LogicalNot=pD;A.LogicalOr=vD;A.LogicalXor=yQ;A.LowerBound=wQ;A.Max=gD;A.MaxPool=bD;A.MaxPool3D=wD;A.MaxPool3DGrad=SQ;A.MaxPoolGrad=kQ;A.MaxPoolWithArgmax=xD;A.Maximum=yD;A.Mean=kD;A.Min=SD;A.Minimum=ND;A.MirrorPad=TD;A.Mod=ED;A.MomentumOptimizer=cy;A.Multinomial=ID;A.Multiply=CD;A.Neg=AD;A.NonMaxSuppressionV3=DD;A.NonMaxSuppressionV4=FD;A.NonMaxSuppressionV5=RD;A.NotEqual=_D;A.OP_SCOPE_SUFFIX=Y3;A.OneHot=PD;A.OnesLike=OD;A.Optimizer=Po;A.OptimizerConstructors=NR;A.Pack=MD;A.PadV2=BD;A.Pool=NQ;A.Pow=LD;A.Prelu=zD;A.Prod=$D;A.RMSPropOptimizer=ly;A.RaggedGather=qD;A.RaggedRange=WD;A.RaggedTensorToTensor=VD;A.Range=GD;A.Real=UD;A.RealDiv=L_;A.Reciprocal=HD;A.Relu=KD;A.Relu6=ZD;A.Reshape=jD;A.ResizeBilinear=YD;A.ResizeBilinearGrad=EQ;A.ResizeNearestNeighbor=XD;A.ResizeNearestNeighborGrad=TQ;A.Reverse=JD;A.RotateWithOffset=M3;A.Round=QD;A.Rsqrt=e3;A.SGDOptimizer=gp;A.ScatterNd=t3;A.SearchSorted=n3;A.Select=r3;A.Selu=a3;A.Sigmoid=c3;A.Sign=u3;A.Sin=o3;A.Sinh=s3;A.Slice=i3;A.Softmax=v3;A.Softplus=l3;A.SpaceToBatchND=d3;A.SparseFillEmptyRows=m3;A.SparseReshape=g3;A.SparseSegmentMean=y3;A.SparseSegmentSum=b3;A.SparseToDense=w3;A.SplitV=p3;A.Sqrt=f3;A.Square=IQ;A.SquaredDifference=x3;A.Step=P3;A.StridedSlice=k3;A.StringNGrams=S3;A.StringSplit=N3;A.StringToHashBucketFast=T3;A.Sub=E3;A.Sum=h3;A.Tan=I3;A.Tanh=C3;A.Tensor=Pn;A.TensorBuffer=jd;A.Tile=R0;A.TopK=A3;A.Transform=_3;A.Transpose=Bd;A.Unique=D3;A.Unpack=F3;A.UnsortedSegmentSum=R3;A.UpperBound=CQ;A.Variable=Ul;A.ZerosLike=O3;A._FusedMatMul=i0;A.abs=ua;A.acos=mte;A.acosh=yte;A.add=ct;A.addN=wte;A.all=kte;A.any=Nte;A.argMax=Ete;A.argMin=Cte;A.asin=_te;A.asinh=Fte;A.atan=Ote;A.atan2=Mte;A.atanh=Lte;A.avgPool=pF;A.avgPool3d=jte;A.backend=ute;A.backend_util=nfe;A.basicLSTMCell=tne;A.batchNorm=op;A.batchNorm2d=one;A.batchNorm3d=une;A.batchNorm4d=lne;A.batchToSpaceND=vF;A.bincount=mF;A.booleanMaskAsync=ese;A.broadcastArgs=dne;A.broadcastTo=$d;A.broadcast_util=nre;A.browser=zce;A.buffer=Yi;A.cast=Nn;A.ceil=mne;A.clipByValue=yne;A.clone=ys;A.complex=Do;A.concat=Wr;A.concat1d=wne;A.concat2d=kne;A.concat3d=Nne;A.concat4d=Ene;A.conv1d=Ane;A.conv2d=sp;A.conv2dTranspose=Fne;A.conv3d=One;A.conv3dTranspose=Lne;A.copyRegisteredKernels=RQ;A.cos=$ne;A.cosh=Wne;A.cosineWindow=ry;A.cumprod=Gne;A.cumsum=Hne;A.customGrad=Ai;A.denseBincount=jne;A.deprecationWarn=Xee;A.depthToSpace=Yne;A.depthwiseConv2d=W0;A.device_util=fee;A.diag=Qne;A.dilation2d=tre;A.disableDeprecationWarnings=jee;A.dispose=Er;A.disposeVariables=Yee;A.div=Gt;A.divNoNan=sre;A.dot=cre;A.dropout=pse;A.einsum=fre;A.elu=wF;A.enableDebugMode=Kee;A.enableProdMode=Hee;A.enclosingPowerOfTwo=QF;A.engine=Zee;A.env=vt;A.equal=bF;A.erf=pre;A.euclideanNorm=Cre;A.exp=ks;A.expandDims=ds;A.expm1=Fre;A.eye=SF;A.fft=Z0;A.fill=uf;A.findBackend=ite;A.findBackendFactory=ote;A.floor=NF;A.floorDiv=lF;A.fused=Ase;A.gather=TF;A.gatherND=fse;A.gather_util=$ce;A.getBackend=rte;A.getGradient=u0;A.getKernel=Gd;A.getKernelsForBackend=Ud;A.grad=tae;A.grads=nae;A.greater=cp;A.greaterEqual=EF;A.ifft=Jd;A.imag=lp;A.image=ace;A.inTopKAsync=mse;A.io=Cce;A.irfft=HF;A.isFinite=qre;A.isInf=Vre;A.isNaN=Ure;A.keep=cF;A.kernel_impls=rfe;A.leakyRelu=IF;A.less=jre;A.lessEqual=U0;A.linalg=ice;A.linspace=Yre;A.localResponseNormalization=Jre;A.log=Zl;A.log1p=CF;A.logSigmoid=uae;A.logSoftmax=fae;A.logSumExp=DF;A.logicalAnd=Yd;A.logicalNot=FF;A.logicalOr=RF;A.logicalXor=gae;A.losses=oce;A.lowerBound=bae;A.matMul=Ft;A.math=Dce;A.max=ju;A.maxPool=OF;A.maxPool3d=kae;A.maxPoolWithArgmax=Nae;A.maximum=PF;A.mean=Zd;A.memory=Jee;A.meshgrid=Iae;A.min=S0;A.minimum=MF;A.mirrorPad=_ae;A.mod=Fae;A.moments=Oae;A.movingAverage=rse;A.mul=Me;A.multiRNNCell=Mae;A.multinomial=Lae;A.neg=Xi;A.nextFrame=ele;A.norm=up;A.notEqual=BF;A.oneHot=N0;A.ones=gs;A.onesLike=Wae;A.op=H;A.outerProduct=Gae;A.pad=lf;A.pad1d=Kae;A.pad2d=Xae;A.pad3d=Zae;A.pad4d=Qae;A.pool=aie;A.pow=Yl;A.prelu=zF;A.print=uF;A.prod=sie;A.profile=Qee;A.raggedGather=cie;A.raggedRange=fie;A.raggedTensorToTensor=die;A.rand=vie;A.randomGamma=Pie;A.randomNormal=WF;A.randomStandardNormal=Lie;A.randomUniform=VF;A.range=Jl;A.ready=nte;A.real=Ql;A.reciprocal=Wie;A.registerBackend=ste;A.registerGradient=_Q;A.registerKernel=B3;A.relu=hp;A.relu6=GF;A.removeBackend=ate;A.reshape=ve;A.reverse=Ss;A.reverse1d=Kie;A.reverse2d=Xie;A.reverse3d=Zie;A.reverse4d=Qie;A.rfft=J0;A.round=UF;A.rsqrt=noe;A.scalar=Rt;A.scatterND=ose;A.scatter_util=ase;A.searchSorted=H0;A.selu=aoe;A.separableConv2d=ooe;A.serialization=cce;A.setBackend=tte;A.setPlatform=cte;A.setdiff1dAsync=uoe;A.sigmoid=Ku;A.sign=loe;A.signal=rce;A.sin=hoe;A.sinh=poe;A.slice=un;A.slice1d=moe;A.slice2d=yoe;A.slice3d=woe;A.slice4d=koe;A.slice_util=SR;A.softmax=Noe;A.softplus=_F;A.spaceToBatchND=LF;A.sparse=sce;A.sparseToDense=cse;A.spectral=nce;A.split=ef;A.sqrt=Zi;A.square=ri;A.squaredDifference=KF;A.squeeze=Q0;A.stack=tf;A.step=jF;A.stridedSlice=Poe;A.string=uce;A.sub=bt;A.sum=Vt;A.sumOutType=nee;A.tan=Boe;A.tanh=k0;A.tensor=Gu;A.tensor1d=ni;A.tensor2d=ql;A.tensor3d=XF;A.tensor4d=Loe;A.tensor5d=zoe;A.tensor6d=$oe;A.tensor_util=iee;A.test_util=Die;A.tidy=Mn;A.tile=$l;A.time=ete;A.topk=Woe;A.train=Jce;A.transpose=Qd;A.truncatedNormal=Goe;A.unique=Hoe;A.unregisterGradient=FQ;A.unregisterKernel=DQ;A.unsortedSegmentSum=joe;A.unstack=ey;A.upcastType=ip;A.upperBound=Yoe;A.util=GQ;A.valueAndGrad=rae;A.valueAndGrads=aae;A.variable=Zoe;A.variableGrads=AF;A.version_core=Zce;A.where=Ju;A.whereAsync=ZF;A.zeros=Qu;A.zerosLike=ca});var PR=Y((Hit,OR)=>{OR.exports=jt;var Aa=null;try{Aa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function jt(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}jt.prototype.__isLong__;Object.defineProperty(jt.prototype,"__isLong__",{value:!0});function Hr(n){return(n&&n.__isLong__)===!0}jt.isLong=Hr;var TR={},ER={};function Ds(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=ER[n],r)?r:(t=Xt(n,(n|0)<0?-1:0,!0),a&&(ER[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=TR[n],r)?r:(t=Xt(n,n<0?-1:0,!1),a&&(TR[n]=t),t))}jt.fromInt=Ds;function _a(n,e){if(isNaN(n))return e?_s:Da;if(e){if(n<0)return _s;if(n>=_R)return RR}else{if(n<=-CR)return Ur;if(n+1>=CR)return FR}return n<0?_a(-n,e).neg():Xt(n%rc|0,n/rc|0,e)}jt.fromNumber=_a;function Xt(n,e,t){return new jt(n,e,t)}jt.fromBits=Xt;var yp=Math.pow;function vy(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Da;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return vy(n.substring(1),e,t).neg();for(var a=_a(yp(t,8)),i=Da,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=_a(yp(t,s));i=i.mul(c).add(_a(u))}else i=i.mul(a),i=i.add(_a(u))}return i.unsigned=e,i}jt.fromString=vy;function ii(n,e){return typeof n=="number"?_a(n,e):typeof n=="string"?vy(n,e):Xt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}jt.fromValue=ii;var IR=1<<16,afe=1<<24,rc=IR*IR,_R=rc*rc,CR=_R/2,AR=Ds(afe),Da=Ds(0);jt.ZERO=Da;var _s=Ds(0,!0);jt.UZERO=_s;var nc=Ds(1);jt.ONE=nc;var DR=Ds(1,!0);jt.UONE=DR;var py=Ds(-1);jt.NEG_ONE=py;var FR=Xt(-1,2147483647,!1);jt.MAX_VALUE=FR;var RR=Xt(-1,-1,!0);jt.MAX_UNSIGNED_VALUE=RR;var Ur=Xt(0,-2147483648,!1);jt.MIN_VALUE=Ur;var De=jt.prototype;De.toInt=function(){return this.unsigned?this.low>>>0:this.low};De.toNumber=function(){return this.unsigned?(this.high>>>0)*rc+(this.low>>>0):this.high*rc+(this.low>>>0)};De.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ur)){var t=_a(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=_a(yp(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};De.getHighBits=function(){return this.high};De.getHighBitsUnsigned=function(){return this.high>>>0};De.getLowBits=function(){return this.low};De.getLowBitsUnsigned=function(){return this.low>>>0};De.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ur)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};De.isZero=function(){return this.high===0&&this.low===0};De.eqz=De.isZero;De.isNegative=function(){return!this.unsigned&&this.high<0};De.isPositive=function(){return this.unsigned||this.high>=0};De.isOdd=function(){return(this.low&1)===1};De.isEven=function(){return(this.low&1)===0};De.equals=function(e){return Hr(e)||(e=ii(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};De.eq=De.equals;De.notEquals=function(e){return!this.eq(e)};De.neq=De.notEquals;De.ne=De.notEquals;De.lessThan=function(e){return this.comp(e)<0};De.lt=De.lessThan;De.lessThanOrEqual=function(e){return this.comp(e)<=0};De.lte=De.lessThanOrEqual;De.le=De.lessThanOrEqual;De.greaterThan=function(e){return this.comp(e)>0};De.gt=De.greaterThan;De.greaterThanOrEqual=function(e){return this.comp(e)>=0};De.gte=De.greaterThanOrEqual;De.ge=De.greaterThanOrEqual;De.compare=function(e){if(Hr(e)||(e=ii(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};De.comp=De.compare;De.negate=function(){return!this.unsigned&&this.eq(Ur)?Ur:this.not().add(nc)};De.neg=De.negate;De.add=function(e){Hr(e)||(e=ii(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,d=0;return d+=i+c,h+=d>>>16,d&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Xt(h<<16|d,l<<16|f,this.unsigned)};De.subtract=function(e){return Hr(e)||(e=ii(e)),this.add(e.neg())};De.sub=De.subtract;De.multiply=function(e){if(this.isZero())return Da;if(Hr(e)||(e=ii(e)),Aa){var t=Aa.mul(this.low,this.high,e.low,e.high);return Xt(t,Aa.get_high(),this.unsigned)}if(e.isZero())return Da;if(this.eq(Ur))return e.isOdd()?Ur:Da;if(e.eq(Ur))return this.isOdd()?Ur:Da;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(AR)&&e.lt(AR))return _a(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,d=0,p=0;return p+=o*l,d+=p>>>16,p&=65535,d+=i*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,Xt(d<<16|p,f<<16|h,this.unsigned)};De.mul=De.multiply;De.divide=function(e){if(Hr(e)||(e=ii(e)),e.isZero())throw Error("division by zero");if(Aa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Aa.div_u:Aa.div_s)(this.low,this.high,e.low,e.high);return Xt(t,Aa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?_s:Da;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return _s;if(e.gt(this.shru(1)))return DR;i=_s}else{if(this.eq(Ur)){if(e.eq(nc)||e.eq(py))return Ur;if(e.eq(Ur))return nc;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Da)?e.isNegative()?nc:py:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(Ur))return this.unsigned?_s:Da;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Da}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:yp(2,s-48),c=_a(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=_a(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=nc),i=i.add(c),a=a.sub(l)}return i};De.div=De.divide;De.modulo=function(e){if(Hr(e)||(e=ii(e)),Aa){var t=(this.unsigned?Aa.rem_u:Aa.rem_s)(this.low,this.high,e.low,e.high);return Xt(t,Aa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};De.mod=De.modulo;De.rem=De.modulo;De.not=function(){return Xt(~this.low,~this.high,this.unsigned)};De.and=function(e){return Hr(e)||(e=ii(e)),Xt(this.low&e.low,this.high&e.high,this.unsigned)};De.or=function(e){return Hr(e)||(e=ii(e)),Xt(this.low|e.low,this.high|e.high,this.unsigned)};De.xor=function(e){return Hr(e)||(e=ii(e)),Xt(this.low^e.low,this.high^e.high,this.unsigned)};De.shiftLeft=function(e){return Hr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Xt(0,this.low<<e-32,this.unsigned)};De.shl=De.shiftLeft;De.shiftRight=function(e){return Hr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Xt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};De.shr=De.shiftRight;De.shiftRightUnsigned=function(e){if(Hr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return Xt(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Xt(t,0,this.unsigned):Xt(t>>>e-32,0,this.unsigned)};De.shru=De.shiftRightUnsigned;De.shr_u=De.shiftRightUnsigned;De.toSigned=function(){return this.unsigned?Xt(this.low,this.high,!1):this};De.toUnsigned=function(){return this.unsigned?this:Xt(this.low,this.high,!0)};De.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};De.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};De.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};jt.fromBytes=function(e,t,r){return r?jt.fromBytesLE(e,t):jt.fromBytesBE(e,t)};jt.fromBytesLE=function(e,t){return new jt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};jt.fromBytesBE=function(e,t){return new jt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var u4=Y(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});var R=As();function ife(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}function ofe(n,e){return e.forEach(function(t){Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})}),n}var _=ife(R),Iy=function(n,e){return Iy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},Iy(n,e)};function se(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Iy(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ce(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Ee(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function fe(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function te(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function Qe(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var Lo=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),Fi=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),J=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),pt=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),sfe=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error);(function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e})(Error);var MO=function(){function n(e){this.maxEntries=e||100,this.cache=new Map}return n.prototype.get=function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t},n.prototype.put=function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)},n.prototype.getMaxEntries=function(){return this.maxEntries},n.prototype.setMaxEntries=function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e},n}();function Ms(n,e){if(Array.isArray(n)){for(var t=[],r=0;r<e;r++)t=t.concat(n);return t}else{var t=new Array(e);return t.fill(n),t}}function _i(n,e){if(!n)throw new sfe(e)}function MR(n,e){var t,r,a=0;try{for(var i=fe(n),o=i.next();!o.done;o=i.next()){var s=o.value;s===e&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a}function Ir(n){return n.length===1?n[0]:n}function Yt(n){return Array.isArray(n)?n:[n]}function to(n){var e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Fs(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var Fa={};function Hy(n){if(n==null)return null;var e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Cy(n){var e,t;if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(function(u){return Cy(u)});else{var r=Object.keys(n);try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value,s=n[o];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[o]=s.value:Cy(s))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}}function Cf(n,e,t,r,a){var i,o,s,u,c,l,f,h,d,p,v;if(e===void 0&&(e={}),t===void 0&&(t={}),r===void 0&&(r="object"),a===void 0&&(a=!1),typeof n=="string"){var m=n,g=void 0;if(m in t)g=t[m];else if(m in Fa)g=Fa[m];else if(g=e[m],g==null)throw new J("Unknown ".concat(r,": ").concat(n,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(r," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return g}else{var y=n;if(y.className==null||y.config==null)throw new J("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(y),`.
`)+"'className' and 'config' must set.");var b=y.className,w=void 0,x=void 0;if(b in t?(i=te(t[b],2),w=i[0],x=i[1]):b in Fa?(o=te(Fa.className,2),w=o[0],x=o[1]):b in e&&(s=te(e[b],2),w=s[0],x=s[1]),w==null)throw new J("Unknown ".concat(r,": ").concat(b,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(r," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(x!=null){var N={};try{for(var T=fe(Object.keys(Fa)),E=T.next();!E.done;E=T.next()){var C=E.value;N[C]=Fa[C]}}catch(Z){u={error:Z}}finally{try{E&&!E.done&&(c=T.return)&&c.call(T)}finally{if(u)throw u.error}}try{for(var F=fe(Object.keys(t)),D=F.next();!D.done;D=F.next()){var C=D.value;N[C]=t[C]}}catch(Z){l={error:Z}}finally{try{D&&!D.done&&(f=F.return)&&f.call(F)}finally{if(l)throw l.error}}var O=y.config;O.customObjects=N;var L=Object.assign({},Fa);try{for(var z=fe(Object.keys(t)),$=z.next();!$.done;$=z.next()){var C=$.value;Fa[C]=t[C]}}catch(Z){h={error:Z}}finally{try{$&&!$.done&&(d=z.return)&&d.call(z)}finally{if(h)throw h.error}}Cy(y.config);var B=x(w,y.config,t,a);return Fa=Object.assign({},L),B}else{var L=Object.assign({},Fa);try{for(var W=fe(Object.keys(t)),X=W.next();!X.done;X=W.next()){var C=X.value;Fa[C]=t[C]}}catch(j){p={error:j}}finally{try{X&&!X.done&&(v=W.return)&&v.call(W)}finally{if(p)throw p.error}}var B=new w(y.config);return Fa=Object.assign({},L),B}}}function ufe(n,e){return n<e?-1:n>e?1:0}function bp(n,e){return-1*ufe(n,e)}function zo(n){var e,t;if(n==null)return n;var r=[];try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.indexOf(o)===-1&&r.push(o)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}function cfe(n){if(n==null)throw new J("Invalid value in obj: ".concat(JSON.stringify(n)));for(var e in n)if(n.hasOwnProperty(e))return!1;return!0}function Ls(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new J("".concat(t," is not a valid ").concat(e,".  Valid values are ").concat(n," or null/undefined."))}function Ky(n,e,t,r){return t===void 0&&(t=0),r===void 0&&(r=1/0),_i(t>=0),_i(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(function(a){return typeof a===e})}function Kn(n,e){Array.isArray(n)?(R.util.assert(n.length>0,function(){return"".concat(e," is unexpectedly an empty array.")}),n.forEach(function(t,r){return Kn(t,"element ".concat(r+1," of ").concat(e))})):R.util.assert(Number.isInteger(n)&&n>0,function(){return"Expected ".concat(e," to be a positive integer, but got ")+"".concat(BO(n),".")})}function BO(n){return n===null?"null":Array.isArray(n)?"["+n.map(function(e){return BO(e)}).join(",")+"]":typeof n=="string"?'"'.concat(n,'"'):"".concat(n)}function lfe(n,e,t){var r=t!=null?t():R.util.now(),a,i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=t!=null?t():R.util.now();return u-r<e||(r=u,a=n.apply(void 0,Qe([],te(o),!1))),a};return i}function LO(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}var ffe=0;function zO(){return ffe++}var wp={};function Hp(n){return n===void 0&&(n=""),n in wp||(wp[n]=0),wp[n]+=1,n+wp[n].toString()}var hfe=["channelsFirst","channelsLast"],dfe=["nearest","bilinear"],pfe=["valid","same","causal"],vfe=["max","avg"],mfe=["sum","mul","concat","ave"];var ac=new Map;function Dn(n){Ls(hfe,"DataFormat",n)}function gfe(n){Ls(dfe,"InterpolationFormat",n)}function pa(n){Ls(pfe,"PaddingMode",n)}function $O(n){Ls(vfe,"PoolMode",n)}var kf=[],BR="/";function Os(n,e){kf.push(n);try{var t=e();return kf.pop(),t}catch(r){throw kf.pop(),r}}function yfe(){return kf.length===0?"":kf.join(BR)+BR}function qO(n){if(!VO(n))throw new Error("Not a valid tensor name: '"+n+"'");return yfe()+n}function WO(n){if(!VO(n))throw new Error("Not a valid tensor name: '"+n+"'");ac.has(n)||ac.set(n,0);var e=ac.get(n);if(ac.set(n,ac.get(n)+1),e>0){var t="".concat(n,"_").concat(e);return ac.set(t,1),t}else return n}var bfe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function VO(n){return!!n.match(bfe)}function wfe(n){return n===parseInt(n.toString(),10)}function $o(n,e,t){e==null&&(e=0),t==null&&(t=n.length);for(var r=1,a=e;a<t;++a)r*=n[a];return r}function fc(n){if(n.length===0)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,t=0;t<n.length;t++){var r=n[t];r<e&&(e=r)}return e}function qo(n){if(n.length===0)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,t=0;t<n.length;t++){var r=n[t];r>e&&(e=r)}return e}function fi(n,e){if(e<n)throw new J("end (".concat(e,") < begin (").concat(n,") is forbidden."));for(var t=[],r=n;r<e;++r)t.push(r);return t}var my;function qn(){return my==null&&(my=R.backend().epsilon()),my}function hi(){return"channelsLast"}function Ri(n,e){return _.cast(n,e)}function Af(n,e){e===void 0&&(e=-1);var t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),_.reshape(n,t)}function xfe(n,e){return R.tidy(function(){if(n.shape.length!==2)throw new J("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(n.shape.length," tensor."));var t=Af(n,1);return Ay(t,[1,e,1])})}function kfe(n){var e=[$o(n.shape)];return _.reshape(n,e)}function Sfe(n){if(n.rank<=1)throw new J("batchFlatten requires a minimum rank of 2. Got rank: ".concat(n.rank,"."));var e=[n.shape[0],$o(n.shape,1)];return _.reshape(n,e)}function Ps(n,e,t){return R.tidy(function(){switch(n.rank){case 1:return _.slice1d(n,e,t);case 2:return _.slice2d(n,[e,0],[t,n.shape[1]]);case 3:return _.slice3d(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return _.slice4d(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return _.slice(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return _.slice(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new J("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(n.rank))}})}function gy(n,e,t){return R.tidy(function(){switch(n.rank){case 1:return _.slice1d(n,e,t);case 2:return _.slice2d(n,[0,e],[n.shape[0],t]);case 3:return _.slice3d(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return _.slice4d(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new J("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(n.rank))}})}function xp(n,e,t,r){return R.tidy(function(){switch(n.rank){case 1:return _.slice1d(n,e,t);case 2:switch(r){case 1:return Ps(n,e,t);case 2:return gy(n,e,t);default:throw new J("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return Ps(n,e,t);case 2:return _.slice3d(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return gy(n,e,t);default:throw new J("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return Ps(n,e,t);case 2:return _.slice4d(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return _.slice4d(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return gy(n,e,t);default:throw new J("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new J("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(n.rank))}})}function jy(n,e){e===void 0&&(e=-1);var t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),_.concat(n,e)}function LR(n,e){switch(n.rank){case 1:return _.concat1d([n,e]);case 2:return _.concat2d([n,e],0);case 3:return _.concat3d([n,e],0);case 4:return _.concat4d([n,e],0);default:throw new J("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(n.rank))}}function Ay(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new J("The length of input n (".concat(e.length,") does not match ")+"the number of dimensions in input x (".concat(n.rank,")"));return _.tile(n,e)}function Kp(n,e,t,r,a){return e===void 0&&(e=0),t===void 0&&(t=1),_.randomNormal(n,e,t,r,a)}function Oi(n,e,t,r){if(n.rank<2||e.rank<2)throw new pt("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(n.shape," and y shape = ").concat(e.shape));if(e.rank>=3){var a=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(a!==i)throw new pt("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(n.shape," and ")+" y shape = ".concat(e.shape))}if(n.rank===2&&e.rank===2){var o=!1,s=!1;return _.fused.matMul({a:n,b:e,transposeA:o,transposeB:s,bias:r?_y(n.rank,r,hi()):null,activation:t})}else{var u=n.shape.slice(),c=u.pop();n=_.reshape(n,[-1,c]);var l=e.shape.slice(),f=l.pop(),i=l.pop(),h=Qe(Qe([],te(l),!1),[f],!1),d=Array.from({length:e.rank},function(y,b){return b===0?e.rank-2:b<=e.rank-2?b-1:b});e=_.reshape(_.transpose(e,d),[i,-1]);var p=Qe(Qe([],te(u),!1),te(h),!1),o=!1,s=!1;return _.reshape(_.fused.matMul({a:n,b:e,transposeA:o,transposeB:s,bias:r?_y(n.rank,r,hi()):null,activation:t}),p)}}function GO(n,e,t){return R.tidy(function(){return Array.isArray(e)?e=R.tensor1d(e,"int32"):e=_.cast(e,"int32"),_.gather(n,e,t)})}function _f(n){return _.mul(n,n)}function _y(n,e,t){var r=e.shape;if(e.rank!==1&&e.rank!==n)throw new J("Unexpected bias dimensions: ".concat(e.rank)+"; expected it to be 1 or ".concat(n));if(n===5){if(t==="channelsFirst")return r.length===1?_.reshape(e,[1,r[0],1,1,1]):_.reshape(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?_.reshape(e,[1,1,1,1,r[0]]):_.reshape(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?_.reshape(e,[1,r[0],1,1]):_.reshape(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?_.reshape(e,[1,1,1,r[0]]):_.reshape(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?_.reshape(e,[1,r[0],1]):_.reshape(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?_.reshape(e,[1,1,r[0]]):_.reshape(e,[1].concat(r))}else if(n<3)return e;throw new J("Unsupported input rank by biasAdd: ".concat(e.rank))}function vi(n,e,t){return R.tidy(function(){return t==null&&(t=hi()),Dn(t),_.add(n,_y(n.rank,e,t))})}function Nfe(n,e){if(e===void 0&&(e=1),e!==1)throw new pt("Support for alpha values other than 1 (".concat(e,") is not implemented ")+"yet.");return _.elu(n)}function Tfe(n){return R.tidy(function(){return _.div(n,_.add(_.abs(n),1))})}function UO(n,e,t,r){return R.tidy(function(){return _.dropout(n,e,t,r)})}function Efe(n){return R.tidy(function(){var e=_.add(.5,_.mul(.2,n));return _.clipByValue(e,0,1)})}function Df(n,e,t){return t===void 0&&(t=!1),t?n():e()}var Ife=["fanIn","fanOut","fanAvg"],Cfe=["normal","uniform","truncatedNormal"];function Afe(n){Ls(Ife,"FanMode",n)}function _fe(n){Ls(Cfe,"Distribution",n)}var Ba=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(R.serialization.Serializable),Xy=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return R.zeros(t,r)},e}(Ba);Xy.className="Zeros";R.serialization.registerClass(Xy);var jp=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return R.ones(t,r)},e}(Ba);jp.className="Ones";R.serialization.registerClass(jp);var Yy=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(typeof t!="object")throw new J("Expected argument of type ConstantConfig but got ".concat(t));if(t.value===void 0)throw new J("config must have value set but got ".concat(t));return r.value=t.value,r}return e.prototype.apply=function(t,r){var a=this;return R.tidy(function(){return R.mul(R.scalar(a.value),R.ones(t,r))})},e.prototype.getConfig=function(){return{value:this.value}},e}(Ba);Yy.className="Constant";R.serialization.registerClass(Yy);var Zy=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=t.minval||r.DEFAULT_MINVAL,r.maxval=t.maxval||r.DEFAULT_MAXVAL,r.seed=t.seed,r}return e.prototype.apply=function(t,r){return R.randomUniform(t,this.minval,this.maxval,r,this.seed)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e}(Ba);Zy.className="RandomUniform";R.serialization.registerClass(Zy);var Jy=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=t.mean||r.DEFAULT_MEAN,r.stddev=t.stddev||r.DEFAULT_STDDEV,r.seed=t.seed,r}return e.prototype.apply=function(t,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new pt("randomNormal does not support dType ".concat(r,"."));return Kp(t,this.mean,this.stddev,r,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(Ba);Jy.className="RandomNormal";R.serialization.registerClass(Jy);var Qy=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=t.mean||r.DEFAULT_MEAN,r.stddev=t.stddev||r.DEFAULT_STDDEV,r.seed=t.seed,r}return e.prototype.apply=function(t,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new pt("truncatedNormal does not support dType ".concat(r,"."));return R.truncatedNormal(t,this.mean,this.stddev,r,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(Ba);Qy.className="TruncatedNormal";R.serialization.registerClass(Qy);var eb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.gain=t.gain!=null?t.gain:1,r}return e.prototype.apply=function(t,r){var a=this;return R.tidy(function(){if(t.length!==2||t[0]!==t[1])throw new J("Identity matrix initializer can only be used for 2D square matrices.");return R.mul(a.gain,R.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e}(Ba);eb.className="Identity";R.serialization.registerClass(eb);function Dfe(n,e){e===void 0&&(e="channelsLast");var t,r;if(Dn(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){var a=$o(n,2);t=n[1]*a,r=n[0]*a}else if(e==="channelsLast"){var a=$o(n,0,n.length-2);t=n[n.length-2]*a,r=n[n.length-1]*a}}else{var i=$o(n);t=Math.sqrt(i),r=Math.sqrt(i)}return[t,r]}var Cr=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(t.scale<0)throw new J("scale must be a positive float. Got: ".concat(t.scale));return r.scale=t.scale==null?1:t.scale,r.mode=t.mode==null?"fanIn":t.mode,Afe(r.mode),r.distribution=t.distribution==null?"normal":t.distribution,_fe(r.distribution),r.seed=t.seed,r}return e.prototype.apply=function(t,r){var a=Dfe(t),i=a[0],o=a[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,i):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(i+o)/2),this.distribution==="normal"){var u=Math.sqrt(s);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new pt("".concat(this.getClassName()," does not support dType ").concat(r,"."));return R.truncatedNormal(t,0,u,r,this.seed)}else{var c=Math.sqrt(3*s);return R.randomUniform(t,-c,c,r,this.seed)}},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e}(Ba);Cr.className="VarianceScaling";R.serialization.registerClass(Cr);var Xp=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Xp.className="GlorotUniform";R.serialization.registerClass(Xp);var Yp=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Yp.className="GlorotNormal";R.serialization.registerClass(Yp);var Zp=function(n){se(e,n);function e(t){return n.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Zp.className="HeNormal";R.serialization.registerClass(Zp);var Jp=function(n){se(e,n);function e(t){return n.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Jp.className="HeUniform";R.serialization.registerClass(Jp);var Qp=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Qp.className="LeCunNormal";R.serialization.registerClass(Qp);var ev=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);ev.className="LeCunUniform";R.serialization.registerClass(ev);var tb=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(r.DEFAULT_GAIN=1,r.gain=t.gain==null?r.DEFAULT_GAIN:t.gain,r.seed=t.seed,r.seed!=null)throw new pt("Random seed is not implemented for Orthogonal Initializer yet.");return r}return e.prototype.apply=function(t,r){var a=this;return R.tidy(function(){if(t.length<2)throw new pt("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(t[0]*t[1],") elements: ")+"Slowness may result.");var i=t[0]>t[1]?[t[1],t[0]]:t,o=Kp(i,0,1,"float32"),s=R.linalg.gramSchmidt(o);return t[0]>t[1]&&(s=R.transpose(s)),R.mul(a.gain,s)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e}(Ba);tb.className="Orthogonal";R.serialization.registerClass(tb);var zR={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function $R(n,e){return e===void 0&&(e={}),Cf(n,R.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function mn(n){return Hy(n)}function cn(n){if(typeof n=="string"){var e=n in zR?zR[n]:n;if(e==="GlorotNormal")return new Yp;if(e==="GlorotUniform")return new Xp;if(e==="HeNormal")return new Zp;if(e==="HeUniform")return new Jp;if(e==="LeCunNormal")return new Qp;if(e==="LeCunUniform")return new ev;var t={};return t.className=e,t.config={},$R(t)}else return n instanceof Ba?n:$R(n)}function Dy(n){return Array.isArray(n)&&Array.isArray(n[0])}function Cp(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function it(n){var e;if(Array.isArray(n)){if(n.length!==1)throw new J("Expected Tensor length to be 1; got ".concat(n.length));e=n[0]}else e=n;return e}function It(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new J("Expected exactly 1 Shape; got ".concat(n.length))}else return n}function Ap(n){var e,t,r=0;try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;o.shape.length===0?r+=1:r+=o.shape.reduce(function(s,u){return s*u})}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}var qR="Variable",HO=function(){function n(e,t,r,a,i){t===void 0&&(t="float32"),r===void 0&&(r=qR),a===void 0&&(a=!0),i===void 0&&(i=null),this.dtype=t??"float32",this.shape=e.shape,this.id=zO(),r=r??qR,this.originalName=qO(r),this.name=WO(this.originalName),this.trainable_=a,this.constraint=i,this.val=_.variable(e,this.trainable_,this.name,this.dtype)}return n.prototype.read=function(){return this.assertNotDisposed(),this.val},n.prototype.write=function(e){return this.assertNotDisposed(),Ffe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},n.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},n.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))},Object.defineProperty(n.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!1,configurable:!0}),n}();function Ffe(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Fy(n){return n.map(function(e){return e.read()})}function nb(n){n.forEach(function(e){var t=e[0];t.write(e[1])})}var Ln=function(){function n(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}return n}(),ui=function(){function n(e,t,r,a,i,o,s){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=zO(),o!=null&&(this.originalName=qO(o),this.name=WO(this.originalName)),this.rank=t.length}return n}(),Rfe=0,tv=function(){function n(e,t){var r,a;this.callArgs=t,this.id=Rfe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;try{for(var i=fe(e.inboundLayers),o=i.next();!o.done;o=i.next()){var s=o.value;s?.outboundNodes.push(this)}}catch(u){r={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}e.outboundLayer.inboundNodes.push(this)}return n.prototype.getConfig=function(){var e,t,r=[];try{for(var a=fe(this.inboundLayers),i=a.next();!i.done;i=a.next()){var o=i.value;o!=null?r.push(o.name):r.push(null)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:r,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},n}(),Ofe=0,gt=function(n){se(e,n);function e(t){t===void 0&&(t={});var r=n.call(this)||this;r._callHook=null,r._addedWeightNames=[],r._stateful=!1,r.id=Ofe++,r.activityRegularizer=null,r.inputSpec=null,r.supportsMasking=!1,r._trainableWeights=[],r._nonTrainableWeights=[],r._losses=[],r._updates=[],r._built=!1,r.inboundNodes=[],r.outboundNodes=[];var a=t.name;if(!a){var i=r.getClassName();a=to(i)+"_"+Hp(i)}if(r.name=a,r.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var s=null;t.batchSize!=null&&(s=t.batchSize),o=[s].concat(t.inputShape)}r.batchInputShape=o;var u=t.dtype;u==null&&(u=t.inputDType),u==null&&(u="float32"),r.dtype=u}return t.weights!=null?r.initialWeights=t.weights:r.initialWeights=null,r._refCount=null,r.fastWeightInitDuringBuild=!1,r}return e.nodeKey=function(t,r){return t.name+"_ib-"+r.toString()},e.prototype.getNodeAtIndex=function(t,r){if(this.inboundNodes.length===0)throw new Fi("The layer has never been called "+"and thus has no defined ".concat(r,"."));if(this.inboundNodes.length<=t)throw new J("Asked to get ".concat(r," at node ").concat(t,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return Ir(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return Ir(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new Lo("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new Lo("Layer ".concat(this.name)+" is not connected, no input to return.");return Ir(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new Lo("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new Lo("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Ir(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!1,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(r){return r.trainable=t}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=Yt(t),!(this.inputSpec==null||this.inputSpec.length===0)){var r=Yt(this.inputSpec);if(t.length!==r.length)throw new J("Layer ".concat(this.name," expects ").concat(r.length," inputs, ")+"but it received ".concat(t.length," input tensors. ")+"Input received: ".concat(t));for(var a=0;a<t.length;a++){var i=t[a],o=r[a];if(o!=null){var s=i.rank;if(o.ndim!=null&&s!==o.ndim)throw new J("Input ".concat(a," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(o.ndim,", found ndim=").concat(s));if(o.maxNDim!=null&&s>o.maxNDim)throw new J("Input ".concat(a," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(o.maxNDim,", found ndim=").concat(s));if(o.minNDim!=null&&s<o.minNDim)throw new J("Input ".concat(a," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(o.minNDim,", found ndim=").concat(s,"."));if(o.dtype!=null&&i.dtype!==o.dtype)throw new J("Input ".concat(a," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(o.dtype,", found dtype=").concat(i.dtype,"."));if(o.axes){var u=i.shape;for(var c in o.axes){var l=Number(c),f=o.axes[c],h=l>=0?u[l]:u[u.length+l];if(f!=null&&[f,null].indexOf(h)===-1)throw new J("Input ".concat(a," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(l," of input shape to ")+"have value ".concat(f," but got shape ").concat(u,"."))}}if(o.shape!=null)for(var d=0;d<o.shape.length;++d){var p=o.shape[d],v=i.shape[d];if(p!=null&&v!=null&&p!==v)throw new J("Input ".concat(a," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(o.shape,", ")+"found shape=".concat(i.shape,"."))}}}}},e.prototype.call=function(t,r){return t},e.prototype.invokeCallHook=function(t,r){this._callHook!=null&&this._callHook(t,r)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,r){var a,i,o,s,u=this;r=r||{},this.assertNotDisposed();var c=Yt(t),l=!0;try{for(var f=fe(c),h=f.next();!h.done;h=f.next()){var d=h.value;if(!(d instanceof ui)){l=!1;break}}}catch(g){a={error:g}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var p=!0;try{for(var v=fe(c),m=v.next();!m.done;m=v.next()){var d=m.value;if(d instanceof ui){p=!1;break}}}catch(g){o={error:g}}finally{try{m&&!m.done&&(s=v.return)&&s.call(v)}finally{if(o)throw o.error}}if(l===p)throw new J("Arguments to apply() must be all SymbolicTensors or all Tensors");return Os(this.name,function(){var g,y,b,w;if(!u.built){u.assertInputCompatibility(t);var x=[];try{for(var N=fe(Yt(t)),T=N.next();!T.done;T=N.next()){var E=T.value;x.push(E.shape)}}catch(X){g={error:X}}finally{try{T&&!T.done&&(y=N.return)&&y.call(N)}finally{if(g)throw g.error}}u.build(Ir(x)),u.built=!0,u.initialWeights&&u.setWeights(u.initialWeights),u._refCount===null&&p&&(u._refCount=1)}if(u.assertInputCompatibility(t),p){var C=u.call(t,r),F=Yt(C),D=[];try{for(var O=fe(F),L=O.next();!L.done;L=O.next()){var z=L.value;c.indexOf(z)!==-1&&(z=z.clone()),D.push(z)}}catch(X){b={error:X}}finally{try{L&&!L.done&&(w=O.return)&&w.call(O)}finally{if(b)throw b.error}}if(C=Ir(D),u.activityRegularizer!=null)throw new pt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}else{var $=Pfe(t),B=u.computeOutputShape($),C=void 0,W=Mfe(t);if(u.warnOnIncompatibleInputShape(Array.isArray(t)?$[0]:$),B!=null&&B.length>0&&Array.isArray(B[0])?C=B.map(function(Z,V){return new ui(W,Z,u,Yt(t),r,u.name,V)}):C=new ui(W,B,u,Yt(t),r,u.name),u.addInboundNode(t,C,null,null,$,B,r),u._refCount++,u.activityRegularizer!=null)throw new pt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(t),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var r=!1;this.batchInputShape.forEach(function(a,i){a!=null&&t[i]!=null&&t[i]!==a&&(r=!0)}),r&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(t),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){var t,r;if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Lo("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var a=[];try{for(var i=fe(this.inboundNodes),o=i.next();!o.done;o=i.next()){var s=o.value,u=JSON.stringify(s.outputShapes);a.indexOf(u)===-1&&a.push(u)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}if(a.length===1){var c=this.inboundNodes[0].outputShapes;return Array.isArray(c)&&Array.isArray(c[0])&&c.length===1?c[0]:c}else throw new Lo("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!1,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new Fi("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return Ap(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),Fy(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var r=this;R.tidy(function(){var a=r.weights;if(a.length!==t.length)throw new J('You called setWeights(weights) on layer "'.concat(r.name,'" ')+"with a weight list of length ".concat(t.length,", ")+"but the layer was expecting ".concat(a.length," weights. ")+"Provided weights: ".concat(t,"..."));if(a.length!==0){for(var i=[],o=Fy(a),s=0;s<o.length;++s){var u=o[s],c=a[s],l=t[s];if(!R.util.arraysEqual(u.shape,l.shape))throw new J("Layer weight shape ".concat(u.shape," ")+"not compatible with provided weight shape ".concat(l.shape));i.push([c,l])}nb(i)}})},e.prototype.addWeight=function(t,r,a,i,o,s,u,c){if(this._addedWeightNames.indexOf(t)!==-1)throw new J("Duplicate weight name ".concat(t," for layer ").concat(this.name));this._addedWeightNames.push(t),a==null&&(a="float32"),this.fastWeightInitDuringBuild&&(i=c!=null?c():cn("zeros"));var l=i.apply(r,a),f=new HO(l,a,t,s,u);return l.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),s==null&&(s=!0),s?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var r;t==null||Array.isArray(t)&&t.length===0||(t=Yt(t),this._losses!==void 0&&this._losses!==null&&(r=this.losses).push.apply(r,Qe([],te(t),!1)))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,r){var a=this;if(!this.supportsMasking){if(r!=null)if(Array.isArray(r))r.forEach(function(i){if(i!=null)throw new TypeError("Layer ".concat(a.name," does not support masking, ")+"but was passed an inputMask.")});else throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");return null}return r},e.prototype.addInboundNode=function(t,r,a,i,o,s,u){var c,l;u===void 0&&(u=null);var f=Yt(t);r=Yt(r),a=Yt(a),i=Yt(i),o=Cp(o),s=Cp(s);var h=[],d=[],p=[];try{for(var v=fe(f),m=v.next();!m.done;m=v.next()){var g=m.value;h.push(g.sourceLayer),d.push(g.nodeIndex),p.push(g.tensorIndex)}}catch(b){c={error:b}}finally{try{m&&!m.done&&(l=v.return)&&l.call(v)}finally{if(c)throw c.error}}new tv({outboundLayer:this,inboundLayers:h,nodeIndices:d,tensorIndices:p,inputTensors:f,outputTensors:r,inputMasks:a,outputMasks:i,inputShapes:o,outputShapes:s},u);for(var y=0;y<r.length;y++)r[y].sourceLayer=this,r[y].nodeIndex=this.inboundNodes.length-1,r[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(R.serialization.Serializable);function Pfe(n){var e,t;n=Yt(n);var r=[];try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.push(o.shape)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return Ir(r)}function Mfe(n){return"float32"}function KO(n,e,t){var r,a;if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];var i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;for(var o=[],s=0;s<i.inboundLayers.length;s++){var u=i.inputTensors[s],c=i.inboundLayers[s],l=i.nodeIndices[s],f=KO(u,c,l);try{for(var h=(r=void 0,fe(f)),d=h.next();!d.done;d=h.next()){var p=d.value;o.indexOf(p)===-1&&o.push(p)}}catch(v){r={error:v}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(r)throw r.error}}}return o}var vc=function(n){se(e,n);function e(t){var r=n.call(this,{dtype:t.dtype,name:t.name!=null?t.name:Hp("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new J("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=t.batchInputShape;if(a==null){if(t.inputShape==null)throw new J("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new J("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new ui(r.dtype,r.batchInputShape,r,[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new tv({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return e.prototype.apply=function(t,r){throw new J("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e}(gt);vc.className="InputLayer";R.serialization.registerClass(vc);function jO(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new J("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));var t=n.dtype;t==null&&(t="float32");var r=new vc({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}),a=r.inboundNodes[0].outputTensors;return a[0]}function Bfe(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return R.cast(e,n.dtype)}catch{throw new J("The dtype of the feed (".concat(e.dtype,") can not be cast to the dtype ")+"of the key '".concat(n.name,"' (").concat(n.dtype,")."))}}var sc=function(){function n(e){var t,r;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof n)for(var a in e.id2Value)this.id2Value[a]=e.id2Value[a],a in e.id2Mask&&(this.id2Mask[a]=e.id2Mask[a]);else{if(e==null)return;try{for(var i=fe(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s.key,s.value)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}}return n.prototype.add=function(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=Bfe(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new J("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this},n.prototype.addFeed=function(e){this.add(e.key,e.value)},n.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},n.prototype.names=function(){return Object.keys(this.name2Id)},n.prototype.getValue=function(e){if(e instanceof ui){if(this.id2Value[e.id]==null)throw new J("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}else{var t=this.name2Id[e];if(t==null)throw new J("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},n.prototype.getMask=function(e){if(e instanceof ui){if(this.id2Value[e.id]==null)throw new J("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}else{var t=this.name2Id[e];if(t==null)throw new J("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},n.prototype.disposeMasks=function(){this.id2Mask!=null&&R.dispose(this.id2Mask)},n}(),_p=new MO,Dp=new MO;function Lfe(n){_p?.setMaxEntries(n),Dp?.setMaxEntries(n)}function yf(n,e,t,r){var a,i,o,s,u=t==null?!1:t.training,c=Array.isArray(n),l=c?n:[n],f=l.map(function(le){return le.name}),h=[],d=e.names();try{for(var p=fe(f),v=p.next();!v.done;v=p.next()){var m=v.value;d.indexOf(m)!==-1?h.push(e.getValue(m)):h.push(null)}}catch(le){a={error:le}}finally{try{v&&!v.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}}r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var g=f.join(",")+"|"+e.names().sort().join(","),y=_p.get(g),b;if(y==null){var w=zfe(l,e);y=w.sorted,b=w.recipientCounts,_p.put(g,y),Dp.put(g,b)}b={},u||Object.assign(b,Dp.get(g));for(var x=new sc(e),N=0;N<y.length;++N){if(r!=null){var T=R.memory().numTensors;T>r.maxNumTensors&&(r.maxNumTensors=T),T<r.minNumTensors&&(r.minNumTensors=T)}var E=y[N],C=E.sourceLayer;if(!(C instanceof vc)){var F=[],D=[],O=[],L=!1;try{for(var z=(o=void 0,fe(E.inputs)),$=z.next();!$.done;$=z.next()){var B=$.value,W=x.getValue(B),X=x.getMask(B);F.push(W),D.push(X),X!=null&&(L=!0),u||(b[B.name]--,b[B.name]===0&&!e.hasKey(B)&&f.indexOf(B.name)===-1&&!W.isDisposed&&B.sourceLayer.stateful!==!0&&O.push(W))}}catch(le){o={error:le}}finally{try{$&&!$.done&&(s=z.return)&&s.call(z)}finally{if(o)throw o.error}}L&&(t=t||{},t.mask=D[0]);var Z=Yt(C.apply(F,t)),V=null;C.supportsMasking&&(V=C.computeMask(F,D));for(var j=qfe(E),re=Array.isArray(j)?j:[j],ne=0;ne<re.length;++ne){x.hasKey(re[ne])||x.add(re[ne],Z[ne],Array.isArray(V)?V[0]:V);var oe=f.indexOf(re[ne].name);oe!==-1&&(h[oe]=Z[ne])}u||R.dispose(O)}}return x.disposeMasks(),c?h:h[0]}function zfe(n,e){var t,r,a,i;R.util.assert(n!=null&&n.length>0,function(){return"Expected at least one fetch, got none"});var o=[],s={};if(n.length===1){var u=WR(n[0],e);o=u.sorted,s=u.recipientMap}else{var c=new Set;try{for(var l=fe(n),f=l.next();!f.done;f=l.next()){var h=f.value,d=WR(h,e),p=d.sorted,v=d.recipientMap;try{for(var m=(a=void 0,fe(p)),g=m.next();!g.done;g=m.next()){var y=g.value;c.has(y.name)||(o.push(y),c.add(y.name))}}catch(x){a={error:x}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(a)throw a.error}}var b=function(x){s[x]==null&&(s[x]=new Set),v[x].forEach(function(N){return s[x].add(N)})};for(var w in v)b(w)}}catch(x){t={error:x}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}return{sorted:o,recipientCounts:$fe(s)}}function $fe(n){var e={};for(var t in n)e[t]=n[t].size;return e}function WR(n,e){var t,r,a,i,o=new Set,s=[],u={};try{for(var c=fe(e.names()),l=c.next();!l.done;l=c.next()){var f=l.value;o.add(f)}}catch(b){t={error:b}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}var h=[],d=[];for(h.push(n);h.length>0;){var p=h[h.length-1];if(o.has(p.name)){h.pop();continue}var v=d[d.length-1]===h.length-1;if(p.inputs.length===0||v)h.pop(),s.push(p),o.add(p.name),v&&d.pop();else{d.push(h.length-1);try{for(var m=(a=void 0,fe(p.inputs)),g=m.next();!g.done;g=m.next()){var y=g.value;u[y.name]==null&&(u[y.name]=new Set),u[y.name].add(p.name),!o.has(y.name)&&h.push(y)}}catch(b){a={error:b}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(a)throw a.error}}}}return{sorted:s,recipientMap:u}}function qfe(n){var e,t,r;if(n.sourceLayer.inboundNodes.length===1)r=n.sourceLayer.output;else{for(var a=null,i=0;i<n.sourceLayer.inboundNodes.length;++i)try{for(var o=(e=void 0,fe(n.sourceLayer.inboundNodes[i].outputTensors)),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===n.id){a=i;break}}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}r=n.sourceLayer.getOutputAt(a)}return r}var Wfe=R.env();Wfe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",function(){return 100},Lfe);var XO="Abs",Vfe="Acos",Gfe="Acosh",rb="Add",Ufe="AddN",Hfe="ArgMax",Kfe="ArgMin",jfe="Asin",Xfe="Asinh",Yfe="Atan",Zfe="Atanh",Jfe="Atan2",Qfe="AvgPool",ehe="AvgPoolGrad",the="AvgPool3D",nhe="AvgPool3DGrad",YO="BatchMatMul",ZO="BatchToSpaceND",rhe="BroadcastTo",ab="Cast",ahe="Ceil",ihe="ClipByValue",ohe="Complex",JO="ComplexAbs",QO="Concat",eP="Conv2D",she="Conv2DBackpropFilter",tP="Conv2DBackpropInput",uhe="Conv3D",che="Conv3DBackpropFilterV2",lhe="Conv3DBackpropInputV2",nP="Cos",rP="Cosh",fhe="Cumprod",aP="Cumsum",hhe="DepthwiseConv2dNative",dhe="DepthwiseConv2dNativeBackpropFilter",phe="DepthwiseConv2dNativeBackpropInput",vhe="Dilation2D",mhe="Dilation2DBackpropInput",ghe="Dilation2DBackpropFilter",iP="RealDiv",yhe="Elu",bhe="EluGrad",whe="Erf",xhe="Equal",oP="Exp",sP="ExpandDims",khe="Expm1",She="Fill",uP="Floor",cP="FloorDiv",Nhe="FusedBatchNorm",lP="GatherV2",The="Greater",fP="GreaterEqual",ib="Identity",Ehe="Imag",Ihe="IsFinite",Che="IsInf",Ahe="IsNan",_he="LeakyRelu",Dhe="Less",Fhe="LessEqual",hP="Log",Rhe="Log1p",Ohe="LogicalAnd",Phe="LogicalNot",Mhe="LogSoftmax",Bhe="LRN",Lhe="LRNGrad",zhe="Max",dP="Maximum",$he="MaxPool",qhe="MaxPoolGrad",Whe="MaxPool3D",Vhe="MaxPool3DGrad",Ghe="Mean",Uhe="Min",Hhe="Minimum",Khe="MirrorPad",jhe="Mod",pP="Multiply",vP="Neg",Xhe="OnesLike",Yhe="OneHot",mP="Pack",gP="PadV2",yP="Pow",Zhe="Prelu",Jhe="Prod",Qhe="Real",ede="Reciprocal",tde="Relu",bP="Reshape",nde="ResizeNearestNeighbor",rde="ResizeNearestNeighborGrad",ade="ResizeBilinear",ide="ResizeBilinearGrad",ode="Relu6",wP="Reverse",sde="Round",xP="Rsqrt",kP="Select",ude="Selu",SP="Slice",NP="Sin",TP="Sinh",cde="Sign",EP="Sigmoid",lde="Softplus",IP="Sqrt",CP="Sum",AP="SpaceToBatchND",_P="SplitV",fde="Softmax",hde="SquaredDifference",dde="Square",DP="Sub",pde="Tan",vde="Tanh",ob="Tile",Np="Transpose",FP="Unpack",RP="UnsortedSegmentSum",OP="ZerosLike",PP="Step";var mde=1e-7,gde=1e-4,yde=function(){function n(){}return n.prototype.refCount=function(e){return Kr("refCount")},n.prototype.incRef=function(e){return Kr("incRef")},n.prototype.timerAvailable=function(){return!0},n.prototype.time=function(e){return Kr("time")},n.prototype.read=function(e){return Kr("read")},n.prototype.readSync=function(e){return Kr("readSync")},n.prototype.readToGPU=function(e,t){return Kr("readToGPU")},n.prototype.numDataIds=function(){return Kr("numDataIds")},n.prototype.disposeData=function(e,t){return Kr("disposeData")},n.prototype.write=function(e,t,r){return Kr("write")},n.prototype.move=function(e,t,r,a,i){return Kr("move")},n.prototype.createTensorFromGPUData=function(e,t,r){return Kr("createTensorFromGPUData")},n.prototype.memory=function(){return Kr("memory")},n.prototype.floatPrecision=function(){return Kr("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?mde:gde},n.prototype.dispose=function(){return Kr("dispose")},n}();function Kr(n){throw new Error("'".concat(n,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Se(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function bde(n,e,t){t===void 0&&(t=""),Se(sb(n,e),function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}function Pi(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function sb(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Fp(n){return n%1===0}function Tp(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function zs(n,e){var t=e.length;return n=n==null?e.map(function(r,a){return a}):[].concat(n),Se(n.every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(n)}),Se(n.every(function(r){return Fp(r)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(n)}),n.map(function(r){return r<0?t+r:r})}function wde(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(n));return t}function xde(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(r,"."))}}function kde(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Ry(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype ".concat(n))}function Sde(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function ub(n){return typeof n=="string"||n instanceof String}function Nde(n){return typeof n=="boolean"}function Tde(n){return typeof n=="number"}function cb(n){return Array.isArray(n)?cb(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":Tde(n)?"float32":ub(n)?"string":Nde(n)?"bool":"float32"}function Oy(n){return!!(n&&n.constructor&&n.call&&n.apply)}function lb(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function MP(n,e,t,r){r===void 0&&(r=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(r?2:1),o=0;o<i;o++)a[o]=t[n+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(r?2:1),o=0;o<i;o++)a[o]=MP(n+o*u,s,t,r);return a}function VR(n,e,t){if(t===void 0&&(t=!1),n.length===0)return e[0];var r=n.reduce(function(a,i){return a*i})*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error("[".concat(n,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return MP(0,n,e,t)}function BP(n,e){for(var t=fb(n,e),r=0;r<t.length;r++)t[r]=1;return t}function fb(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type ".concat(e))}function Ff(n){n.forEach(function(e){Se(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(n,"].")})})}function hb(n){return n&&n.then&&typeof n.then=="function"}var GR="tfjsflags",Ede=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Ide,this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&(Tn().getBool("IS_TEST")||Tn().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var a=this.urlFlags[e];Tn().getBool("IS_TEST")||Tn().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},n.prototype.getAsync=function(e){return Ce(this,void 0,void 0,function(){var t,r;return Ee(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=a.sent(),[2,this.flags[e]]}})})},n.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(hb(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(GR in t){var r=t[GR].split(",");r.forEach(function(a){var i=te(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=Ade(o,s)})}}},n}();function Ide(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return Cde(e,r[0],r[1]),r.join("=")}),e}function Cde(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Ade(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if("".concat(+e)===e)return+e;throw new Error("Could not parse value flag value ".concat(e," for flag ").concat(n,"."))}function Tn(){return LP}var LP=null;function _de(n){LP=n}var yy;function zP(){if(yy==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");yy=n}return yy}function Dde(){var n=zP();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function db(n,e){var t=Dde();if(t.has(n))return t.get(n);var r=e();return t.set(n,r),t.get(n)}function oc(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Tn().getBool("IS_TEST")||Tn().getBool("PROD")||console.warn.apply(console,Qe([],te(n),!1))}var $P=db("kernelRegistry",function(){return new Map}),Py=db("gradRegistry",function(){return new Map});function UR(n,e){var t=Rde(n,e);return $P.get(t)}function HR(n){return Py.get(n)}function KR(n){for(var e=$P.entries(),t=[];;){var r=e.next(),a=r.done,i=r.value;if(a)break;var o=te(i,2),s=o[0],u=o[1],c=te(s.split("_"),1),l=c[0];l===n&&t.push(u)}return t}function Fde(n){var e=n.kernelName;Py.has(e)&&Tn().getBool("DEBUG")&&oc("Overriding the gradient for '".concat(e,"'")),Py.set(e,n)}function Rde(n,e){return"".concat(e,"_").concat(n)}var My=Zt,Oa=null;try{Oa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Zt(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Zt.prototype.__isLong__;Object.defineProperty(Zt.prototype,"__isLong__",{value:!0});function Xr(n){return(n&&n.__isLong__)===!0}Zt.isLong=Xr;var jR={},XR={};function $s(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=XR[n],r)?r:(t=Jt(n,(n|0)<0?-1:0,!0),a&&(XR[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=jR[n],r)?r:(t=Jt(n,n<0?-1:0,!1),a&&(jR[n]=t),t))}Zt.fromInt=$s;function Pa(n,e){if(isNaN(n))return e?Rs:Ma;if(e){if(n<0)return Rs;if(n>=qP)return GP}else{if(n<=-ZR)return jr;if(n+1>=ZR)return VP}return n<0?Pa(-n,e).neg():Jt(n%hc|0,n/hc|0,e)}Zt.fromNumber=Pa;function Jt(n,e,t){return new Zt(n,e,t)}Zt.fromBits=Jt;var Rp=Math.pow;function pb(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ma;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return pb(n.substring(1),e,t).neg();for(var a=Pa(Rp(t,8)),i=Ma,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Pa(Rp(t,s));i=i.mul(c).add(Pa(u))}else i=i.mul(a),i=i.add(Pa(u))}return i.unsigned=e,i}Zt.fromString=pb;function mi(n,e){return typeof n=="number"?Pa(n,e):typeof n=="string"?pb(n,e):Jt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Zt.fromValue=mi;var YR=1<<16,Ode=1<<24,hc=YR*YR,qP=hc*hc,ZR=qP/2,JR=$s(Ode),Ma=$s(0);Zt.ZERO=Ma;var Rs=$s(0,!0);Zt.UZERO=Rs;var uc=$s(1);Zt.ONE=uc;var WP=$s(1,!0);Zt.UONE=WP;var By=$s(-1);Zt.NEG_ONE=By;var VP=Jt(-1,2147483647,!1);Zt.MAX_VALUE=VP;var GP=Jt(-1,-1,!0);Zt.MAX_UNSIGNED_VALUE=GP;var jr=Jt(0,-2147483648,!1);Zt.MIN_VALUE=jr;var Fe=Zt.prototype;Fe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Fe.toNumber=function(){return this.unsigned?(this.high>>>0)*hc+(this.low>>>0):this.high*hc+(this.low>>>0)};Fe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(jr)){var t=Pa(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Pa(Rp(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Fe.getHighBits=function(){return this.high};Fe.getHighBitsUnsigned=function(){return this.high>>>0};Fe.getLowBits=function(){return this.low};Fe.getLowBitsUnsigned=function(){return this.low>>>0};Fe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(jr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Fe.isZero=function(){return this.high===0&&this.low===0};Fe.eqz=Fe.isZero;Fe.isNegative=function(){return!this.unsigned&&this.high<0};Fe.isPositive=function(){return this.unsigned||this.high>=0};Fe.isOdd=function(){return(this.low&1)===1};Fe.isEven=function(){return(this.low&1)===0};Fe.equals=function(e){return Xr(e)||(e=mi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Fe.eq=Fe.equals;Fe.notEquals=function(e){return!this.eq(e)};Fe.neq=Fe.notEquals;Fe.ne=Fe.notEquals;Fe.lessThan=function(e){return this.comp(e)<0};Fe.lt=Fe.lessThan;Fe.lessThanOrEqual=function(e){return this.comp(e)<=0};Fe.lte=Fe.lessThanOrEqual;Fe.le=Fe.lessThanOrEqual;Fe.greaterThan=function(e){return this.comp(e)>0};Fe.gt=Fe.greaterThan;Fe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Fe.gte=Fe.greaterThanOrEqual;Fe.ge=Fe.greaterThanOrEqual;Fe.compare=function(e){if(Xr(e)||(e=mi(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Fe.comp=Fe.compare;Fe.negate=function(){return!this.unsigned&&this.eq(jr)?jr:this.not().add(uc)};Fe.neg=Fe.negate;Fe.add=function(e){Xr(e)||(e=mi(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,d=0;return d+=i+c,h+=d>>>16,d&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Jt(h<<16|d,l<<16|f,this.unsigned)};Fe.subtract=function(e){return Xr(e)||(e=mi(e)),this.add(e.neg())};Fe.sub=Fe.subtract;Fe.multiply=function(e){if(this.isZero())return Ma;if(Xr(e)||(e=mi(e)),Oa){var t=Oa.mul(this.low,this.high,e.low,e.high);return Jt(t,Oa.get_high(),this.unsigned)}if(e.isZero())return Ma;if(this.eq(jr))return e.isOdd()?jr:Ma;if(e.eq(jr))return this.isOdd()?jr:Ma;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(JR)&&e.lt(JR))return Pa(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,d=0,p=0;return p+=o*l,d+=p>>>16,p&=65535,d+=i*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,Jt(d<<16|p,f<<16|h,this.unsigned)};Fe.mul=Fe.multiply;Fe.divide=function(e){if(Xr(e)||(e=mi(e)),e.isZero())throw Error("division by zero");if(Oa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Oa.div_u:Oa.div_s)(this.low,this.high,e.low,e.high);return Jt(t,Oa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Rs:Ma;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Rs;if(e.gt(this.shru(1)))return WP;i=Rs}else{if(this.eq(jr)){if(e.eq(uc)||e.eq(By))return jr;if(e.eq(jr))return uc;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ma)?e.isNegative()?uc:By:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(jr))return this.unsigned?Rs:Ma;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ma}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:Rp(2,s-48),c=Pa(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Pa(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=uc),i=i.add(c),a=a.sub(l)}return i};Fe.div=Fe.divide;Fe.modulo=function(e){if(Xr(e)||(e=mi(e)),Oa){var t=(this.unsigned?Oa.rem_u:Oa.rem_s)(this.low,this.high,e.low,e.high);return Jt(t,Oa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Fe.mod=Fe.modulo;Fe.rem=Fe.modulo;Fe.not=function(){return Jt(~this.low,~this.high,this.unsigned)};Fe.and=function(e){return Xr(e)||(e=mi(e)),Jt(this.low&e.low,this.high&e.high,this.unsigned)};Fe.or=function(e){return Xr(e)||(e=mi(e)),Jt(this.low|e.low,this.high|e.high,this.unsigned)};Fe.xor=function(e){return Xr(e)||(e=mi(e)),Jt(this.low^e.low,this.high^e.high,this.unsigned)};Fe.shiftLeft=function(e){return Xr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Jt(0,this.low<<e-32,this.unsigned)};Fe.shl=Fe.shiftLeft;Fe.shiftRight=function(e){return Xr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Jt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Fe.shr=Fe.shiftRight;Fe.shiftRightUnsigned=function(e){if(Xr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return Jt(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Jt(t,0,this.unsigned):Jt(t>>>e-32,0,this.unsigned)};Fe.shru=Fe.shiftRightUnsigned;Fe.shr_u=Fe.shiftRightUnsigned;Fe.toSigned=function(){return this.unsigned?Jt(this.low,this.high,!1):this};Fe.toUnsigned=function(){return this.unsigned?this:Jt(this.low,this.high,!0)};Fe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Fe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Fe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Zt.fromBytes=function(e,t,r){return r?Zt.fromBytesLE(e,t):Zt.fromBytesBE(e,t)};Zt.fromBytesLE=function(e,t){return new Zt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Zt.fromBytesBE=function(e,t){return new Zt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var Pde=ofe({__proto__:null,default:My},[My]),Mde=My||Pde;function vb(n){return Mde.fromString(n,!0,16)}vb("c3a5c85c97cb3127");vb("b492b66fbe98f273");vb("9ae16a3b2f90404f");function Bde(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function UP(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Sf(n)),Tn().getBool("DEBUG")&&xde(n,e),Bde(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var t=new Uint8Array(n.length),r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Op(){return Tn().platform.now()}function Lde(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Tn().platform.encode(n,e)}function QR(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Tn().platform.decode(n,e)}function di(n){return Tn().platform.isTypedArray(n)}function Sf(n,e,t){var r,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||hb(n)||n==null||di(n)&&t)e.push(n);else if(Array.isArray(n)||di(n))for(var i=0;i<n.length;++i)Sf(n[i],e,t);else{var o=-1;try{for(var s=fe(Object.keys(n)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){r={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}for(var i=0;i<=o;i++)Sf(n[i],e,t)}return e}var zde=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new qde)}return n.prototype.profileKernel=function(e,t,r){var a,i,o,s=function(){o=r()},u,c=Op();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=fe(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Op()-c})}if(Tn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var d=function(m){var g=o[m];g.data().then(function(y){$de(y,g.dtype,e)})},p=0;p<o.length;p++)d(p);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},n.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(r,u,c[0],c[1],o,c[2])})})},n}();function $de(n,e,t){if(e!=="float32")return!1;for(var r=0;r<n.length;r++){var a=n[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var qde=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,a,i,o){var s=typeof a=="number"?Tp("".concat(a,"ms"),9):a.error,u=Tp(e,25),c=t.rank,l=t.size,f=Tp(t.shape.toString(),14),h="";for(var d in i){var p=i[d];if(p!=null){var v=p.shape||t.shape,m=v.length;h+="".concat(d,": ").concat(m,"D ").concat(m>0?v:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function Wde(n,e,t){for(var r={},a={},i=0;i<e.length;i++)r[e[i].id]=!0;for(var i=0;i<n.length;i++){var o=n[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(r[c.id]){o.outputs.forEach(function(b){return r[b.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var d={},i=n.length-1;i>=0;i--)for(var o=n[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,d[o.id]=!0;break}for(var p=[],i=0;i<n.length;i++){var o=n[i];if(a[o.id]&&d[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,p.push(g)}}return p}function Vde(n,e,t,r){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var d=n[h.id];d!=null?u.push(d):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var d=t(function(){return c[h]()});if(d.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(d.dtype,"'"));var p=s.inputs[h];if(!sb(d.shape,p.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(d.shape,"', which does not match ")+"the shape of the input '".concat(p.shape,"'"));if(n[p.id]==null)n[p.id]=d;else{var v=n[p.id];n[p.id]=r(v,d),v.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var eO=20,ff=3,by=7;function Gde(n,e,t,r){var a=lb(e),i=Ude(n,e,t,a),o=e.length,s=Ep(n,e,t,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function Ude(n,e,t,r){var a=Pi(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?wf(n):n;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],bf(u[l+f],0,t).length);return o}function bf(n,e,t){var r;return Array.isArray(n)?r="".concat(parseFloat(n[0].toFixed(by))," + ")+"".concat(parseFloat(n[1].toFixed(by)),"j"):ub(n)?r="'".concat(n,"'"):t==="bool"?r=HP(n):r=parseFloat(n.toFixed(by)).toString(),Tp(r,e)}function HP(n){return n===0?"false":"true"}function Ep(n,e,t,r,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=wf(n);return[bf(c[0],0,t)]}return t==="bool"?[HP(n[0])]:[n[0].toString()]}if(u===1){if(s>eO){var l=ff*o,f=Array.from(n.slice(0,l)),h=Array.from(n.slice((s-ff)*o,s*o));return t==="complex64"&&(f=wf(f),h=wf(h)),["["+f.map(function(T,E){return bf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return bf(T,a[s-ff+E],t)}).join(", ")+"]"]}var d=t==="complex64"?wf(n):Array.from(n);return["["+d.map(function(T,E){return bf(T,a[E],t)}).join(", ")+"]"]}var p=e.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>eO){for(var y=0;y<ff;y++){var b=y*m,w=b+m;g.push.apply(g,Qe([],te(Ep(n.slice(b,w),p,t,v,a,!1)),!1))}g.push("...");for(var y=s-ff;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,Qe([],te(Ep(n.slice(b,w),p,t,v,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,Qe([],te(Ep(n.slice(b,w),p,t,v,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var N=`,
`,y=2;y<u;y++)N+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function wf(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}(function(){function n(e,t,r){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Pi(e),r!=null){var i=r.length;Se(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||wde(t,this.size),this.strides=lb(e)}return n.prototype.set=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),Se(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e,t,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r.length===0&&(r=[0]);var i=0;try{for(var o=fe(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(r,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=r[r.length-1],f=0;f<r.length-1;++f)l+=this.strides[f]*r[f];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.toTensor=function(){return si().makeTensor(this.values,this.shape,this.dtype)},n})();var si=null,hf=null;function Hde(n){si=n}var Ra=function(){function n(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Pi(e),this.strides=lb(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.buffer=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,hf.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return hf.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,VR(this.shape,e,this.dtype==="complex64")]}})})},n.prototype.arraySync=function(){return VR(this.shape,this.dataSync(),this.dtype==="complex64")},n.prototype.data=function(){return Ce(this,void 0,void 0,function(){var e,t;return Ee(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=si().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(a){return QR(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataToGPU=function(e){return this.throwIfDisposed(),si().readToGPU(this.dataId,e)},n.prototype.dataSync=function(){this.throwIfDisposed();var e=si().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return QR(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,si().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(si().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.print=function(e){return e===void 0&&(e=!1),hf.print(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),hf.clone(this)},n.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return Gde(t,this.shape,this.dtype,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),hf.cast(this,e)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),si().makeVariable(this,e,t,r)},n}();Object.defineProperty(Ra,Symbol.hasInstance,{value:function(n){return!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null}});function Kde(){return db("Tensor",function(){return Ra})}Kde();var Pp=function(n){se(e,n);function e(t,r,a,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!sb(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));si().disposeTensor(this),this.dataId=t.dataId,si().incRef(this,null)},e.prototype.dispose=function(){si().disposeVariable(this),this.isDisposedInternal=!0},e}(Ra);Object.defineProperty(Pp,Symbol.hasInstance,{value:function(n){return n instanceof Ra&&n.assign!=null&&n.assign instanceof Function}});var tO;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(tO||(tO={}));var Ly;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(Ly||(Ly={}));var zy;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(zy||(zy={}));var $y;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})($y||($y={}));var qy;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(qy||(qy={}));var jde={float32:$y,int32:Ly,bool:zy,complex64:qy};function Xde(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(n," with ").concat(e))}return jde[n][e]}function va(n,e){if(n.dtype===e.dtype)return[n,e];var t=Xde(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function KP(n){var e=[],t=new Set;return jP(n,e,t),e}function jP(n,e,t){if(n!=null){if(n instanceof Ra){e.push(n);return}if(!!Yde(n)){var r=n;for(var a in r){var i=r[a];t.has(i)||(t.add(i),jP(i,e,t))}}}}function Yde(n){return Array.isArray(n)||typeof n=="object"}function wy(n){return n.kernelName!=null}var nO=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),mb=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new nO}return n.prototype.ready=function(){return Ce(this,void 0,void 0,function(){var e,t,r,a;return Ee(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,r=e.asyncInit;if(r)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(oc("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o;return Ee(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,a=t.asyncInit,a?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new zde(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this,t=KR(this.backendName);t.forEach(function(r){r.setupFunc!=null&&r.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this,r=KR(e);r.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=r.factory();if(a&&!(a instanceof yde)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,oc("Initialization of backend ".concat(e," failed")),oc(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return oc("Initialization of backend ".concat(e," failed")),oc(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],a=this.initializeBackend(r),i=a.success,o=a.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},n.prototype.scopedRun=function(e,t,r){e();try{var a=r();return t(),a}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=me.runKernel(ib,{x:e}),r={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return me.runKernel(ab,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t},n.prototype.runKernel=function(e,t,r){this.backendName==null&&this.backend;var a=UR(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var a=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},n.prototype.runKernelFunc=function(e){var t=this,r,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=wy(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(wy(e)){var f=e.kernelName,h=e.inputs,d=e.attrs;this.backendName==null&&this.backend;var p=UR(f,this.backendName);Se(p!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=p.kernelFunc({inputs:h,attrs:d,backend:t.backend});var N=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,N);var T=N.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var v=e.forwardFunc,m=function(x){!i||(a=x.map(function(N){return t.keep(t.clone(N))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return v(t.backend,m)});var N=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,N),N}}var g=e.inputs,y=e.attrs,b=wy(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?r=u():(w=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),r=w.outputs)}),i&&this.addTapeNode(l,g,r,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:r.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(c)?r:r[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this,r=e.map(function(a){return t.keep(t.clone(a))});return r},n.prototype.getTensorsForGradient=function(e,t,r){var a=HR(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(Se(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return o[l]});return s.concat(u)}return[]},n.prototype.makeTensor=function(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var i=e;r==="string"&&ub(e[0])&&(i=e.map(function(l){return Lde(l)}));var o=a.write(i,t,r),s=new Ra(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){var u=this.state.tensorInfo.get(o),c=Sde(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,a){r=r||"float32";var i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)},n.prototype.makeTensorFromTensorInfo=function(e,t){var r=e.dataId,a=e.shape,i=e.dtype,o=new Ra(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o},n.prototype.makeVariable=function(e,t,r,a){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Pp(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Ry(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Pp||this.track(e)},n.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},n.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},n.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var r=e.size*Ry(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Ee(this,function(d){switch(d.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=d.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Qe([],te(this.state.activeProfile.kernels.map(function(p){return p.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,d.label=2;case 2:d.trys.push([2,8,9,10]),i=fe(this.state.activeProfile.kernels),o=i.next(),d.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=d.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=d.sent(),d.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=d.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=HR(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var d=r[h],p=fb(d.size,d.dtype);return s.makeTensor(p,d.shape,d.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=KP(e),a=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},n.prototype.gradients=function(e,t,r,a){var i=this;if(a===void 0&&(a=!1),Se(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(r.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});Se(o instanceof Ra,function(){return"The result y returned by f() must be a tensor."});var s=Wde(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=r??Zde(o.shape),Vde(u,s,function(l){return i.tidy(l)},Qde);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var d=fe(l.saved),p=d.next();!p.done;p=d.next()){var v=p.value;v.dispose()}}catch(m){f={error:m}}finally{try{p&&!p.done&&(h=d.return)&&h.call(d)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},n.prototype.customGrad=function(e){var t=this;return Se(Oy(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];Se(r.every(function(c){return c instanceof Ra}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};r.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Qe([],te(Qe(Qe([],te(r),!1),[l],!1)),!1)),Se(i.value instanceof Ra,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Se(Oy(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];Se(h.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Se(h.every(function(p){return p instanceof Ra}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return h.forEach(function(p,v){d[v]=function(){return p}}),d};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},n.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},n.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},n.prototype.readToGPU=function(e,t){var r=this.state.tensorInfo.get(e);return r.backend.readToGPU(e,t)},n.prototype.time=function(e){return Ce(this,void 0,void 0,function(){var t,r;return Ee(this,function(a){switch(a.label){case 0:return t=Op(),[4,this.backend.time(e)];case 1:return r=a.sent(),r.wallMs=Op()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new nO;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n}();mb.nextTensorId=0;mb.nextVariableId=0;function Zde(n){var e=BP(Pi(n),"float32");return me.makeTensor(e,n,"float32")}function Jde(){var n=zP();if(n._tfengine==null){var e=new Ede(n);n._tfengine=new mb(e)}return _de(n._tfengine.ENV),Hde(function(){return n._tfengine}),n._tfengine}var me=Jde();function Qde(n,e){var t={a:n,b:e};return me.runKernel(rb,t)}function epe(n,e){var t=n;if(di(n))return e==="string"?[]:[n.length];var r=typeof n=="object";if(r){if("texture"in n){var a=n.channels||"RGBA";return[n.height,n.width*a.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:Ry(e))]}if(!Array.isArray(n))return[];for(var i=[];Array.isArray(t)||di(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&Tn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&XP(n,i,[]),i}function XP(n,e,t){if(t=t||[],!Array.isArray(n)&&!di(n)){Se(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}Se(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(n.length," elements")}),Se(n.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(n.length," elements")});for(var r=e.slice(1),a=0;a<n.length;++a)XP(n[a],r,t.concat(a))}function rO(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(r,"' must ")+"be ".concat(n," tensor, but got ").concat(e," tensor"))}}function Ie(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Ra)return rO(r,n.dtype,e,t),n;var a=cb(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),rO(r,a,e,t),n==null||!di(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=epe(n,a);!di(n)&&!Array.isArray(n)&&(n=[n]);var s=!0,u=a!=="string"?UP(n,a):Sf(n,[],s);return me.makeTensor(u,o,a)}function YP(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=n;return a.map(function(i,o){return Ie(i,"".concat(e,"[").concat(o,"]"),t,r)})}var tpe="__op";function Ve(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+tpe;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];me.startScope(t);try{var s=r.apply(void 0,Qe([],te(i),!1));return hb(s)&&console.error("Cannot return a Promise inside of tidy."),me.endScope(s),s}catch(u){throw me.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function npe(n,e){var t=Ie(n,"x","cast");if(!kde(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={x:t},a={dtype:e};return me.runKernel(ab,r,a)}var St=Ve({cast_:npe});function rpe(n,e){var t,r=Ie(n,"a","mul"),a=Ie(e,"b","mul");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(pP,i)}var be=Ve({mul_:rpe});function ape(n,e){e===void 0&&(e=0);var t=Ie(n,"x","step"),r={x:t},a={alpha:e};return me.runKernel(PP,r,a)}var gb=Ve({step_:ape}),ZP={kernelName:XO,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,gb(St(r,"float32"),-1))}}}};function ipe(n,e){var t,r=Ie(n,"a","floorDiv"),a=Ie(e,"b","floorDiv");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(cP,i)}var ope=Ve({floorDiv_:ipe});function spe(n,e){var t,r=Ie(n,"a","div"),a=Ie(e,"b","div");if(t=te(va(r,a),2),r=t[0],a=t[1],r.dtype==="int32"&&a.dtype==="int32")return ope(r,a);var i={a:r,b:a},o={};return me.runKernel(iP,i,o)}var Ot=Ve({div_:spe});function upe(n){var e=Ie(n,"x","neg"),t={x:e};return me.runKernel(vP,t)}var La=Ve({neg_:upe});function cpe(n,e,t,r){if(r==null)r=cb(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return me.backend.createTensorFromGPUData(n,e||t,r)}if(!di(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Ff(e);var a=Pi(e),i=Pi(t);Se(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Pi(e.slice(o)):!0;Se(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!di(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?UP(n,r):Sf(n,[],!0),me.makeTensor(n,e,r)}function En(n,e){if((di(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&di(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],r=[];return cpe(n,t,r,e)}function lpe(n){var e=Ie(n,"x","sqrt","float32"),t={x:e};return me.runKernel(IP,t)}var pi=Ve({sqrt_:lpe});function fpe(n){var e=Ie(n,"x","square"),t={};return me.runKernel("Square",{x:e},t)}var In=Ve({square_:fpe});function hpe(n,e){var t,r=Ie(n,"a","sub"),a=Ie(e,"b","sub");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(DP,i)}var tr=Ve({sub_:hpe}),dpe={kernelName:Vfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=In(St(r,"float32")),i=pi(tr(En(1),a));return La(Ot(n,i))}}}},ppe={kernelName:Gfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=pi(tr(In(St(r,"float32")),1));return Ot(n,a)}}}};function nr(n,e){for(var t=[],r=0;r<e.length;r++){var a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function lr(n,e){for(var t=[],r=Math.max(n.length,e.length),a=0;a<r;a++){var i=n[n.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(n," and ").concat(e,".");throw Error(s)}else t.unshift(i)}return t}function vpe(n,e){var t=Ie(n,"x","reshape","string_or_numeric"),r={x:t},a={shape:e};return me.runKernel(bP,r,a)}var Je=Ve({reshape_:vpe});function mpe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Ie(n,"x","sum");r.dtype==="bool"&&(r=St(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return me.runKernel(CP,a,i)}var gn=Ve({sum_:mpe}),gpe={kernelName:rb,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=n,c=nr(r.shape,i);return c.length>0&&(u=gn(u,c)),Je(u,r.shape)},s=function(){var u=n,c=nr(a.shape,i);return c.length>0&&(u=gn(u,c)),Je(u,a.shape)};return{a:o,b:s}}};var ype={kernelName:Ufe,saveAllInputs:!0,gradFunc:function(n,e){var t={};return e.forEach(function(r,a){t[a]=function(){return n.clone()}}),t}};function bpe(n){var e=Ie(n,"x","zerosLike"),t={x:e};return me.runKernel(OP,t)}var At=Ve({zerosLike_:bpe}),wpe={kernelName:Hfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return At(r)}}}},xpe={kernelName:Kfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return At(r)}}}},kpe={kernelName:jfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,pi(tr(En(1),In(St(r,"float32")))))}}}};function Spe(n,e){var t,r=Ie(n,"a","add"),a=Ie(e,"b","add");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(rb,i)}var xt=Ve({add_:Spe}),Npe={kernelName:Xfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=pi(xt(En(1),In(St(r,"float32"))));return Ot(n,a)}}}},Tpe={kernelName:Jfe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=xt(In(r),In(a)),c=be(n,Ot(a,u)),l=nr(r.shape,i);return l.length>0&&(c=gn(c,l)),Je(c,r.shape)},s=function(){var u=xt(In(r),In(a)),c=La(be(n,Ot(r,u))),l=nr(a.shape,i);return l.length>0&&(c=gn(c,l)),Je(c,a.shape)};return{a:o,b:s}}},Epe={kernelName:Yfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,xt(In(St(r,"float32")),1))}}}},Ipe={kernelName:Zfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,tr(En(1),In(St(r,"float32"))))}}}};function JP(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Nf(n){var e=te(JP(n),3),t=e[0],r=e[1],a=e[2];return t===1&&r===1&&a===1}function QP(n,e){return Nf(n)||Nf(e)}function aO(n){return JP(n).every(function(e){return e>0})}function qs(n,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")Se(Fp(e),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(r){r.forEach(function(a){Se(Fp(a),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(n,": Unknown padding parameter: ").concat(e))}}function Cpe(n,e,t,r,a,i){var o=Ie(n,"dy","avgPool3dGrad"),s=Ie(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=Je(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Je(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Se(u.rank===5,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")}),Se(c.rank===5,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")}),qs("avgPool3dGrad",a,i);var f={dy:u,input:c},h={filterSize:t,strides:r,pad:a,dimRoundingMode:i},d=me.runKernel(nhe,f,h);return l?Je(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var Ape=Ve({avgPool3dGrad_:Cpe}),_pe={kernelName:the,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.filterSize,o=t.strides,s=t.pad,u=t.dimRoundingMode;return{x:function(){return Ape(n,a,i,o,s,u)}}}};function Dpe(n,e,t,r,a){var i=Ie(n,"dy","avgPoolGrad"),o=Ie(e,"input","avgPoolGrad");Se(o.rank===i.rank,function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")});var s=o,u=i,c=!1;o.rank===3&&(c=!0,s=Je(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Je(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Se(u.rank===4,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")}),Se(s.rank===4,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")});var l={dy:u,input:s},f={filterSize:t,strides:r,pad:a},h=me.runKernel(ehe,l,f);return c?Je(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var Fpe=Ve({avgPoolGrad_:Dpe}),Rpe={kernelName:Qfe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.filterSize,o=t.strides,s=t.pad;return{x:function(){return Fpe(n,a,i,o,s)}}}};function Ope(n,e,t,r){var a;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=Ie(n,"a","matMul"),o=Ie(e,"b","matMul");a=te(va(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:r};return me.runKernel(YO,s,u)}var Mo=Ve({matMul_:Ope}),Ppe={kernelName:YO,inputsToSave:["a","b"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.transposeA,s=t.transposeB;return!o&&!s?{a:function(){return Mo(n,i,!1,!0)},b:function(){return Mo(a,n,!0,!1)}}:!o&&s?{a:function(){return Mo(n,i,!1,!1)},b:function(){return Mo(n,a,!0,!1)}}:o&&!s?{a:function(){return Mo(i,n,!1,!0)},b:function(){return Mo(a,n,!1,!1)}}:{a:function(){return Mo(i,n,!0,!0)},b:function(){return Mo(n,a,!0,!0)}}}};function Mpe(n,e,t){var r=Ie(n,"x","spaceToBatchND");Se(r.rank>=1+e.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(e.length)}),Se(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),Se(r.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:r},i={blockShape:e,paddings:t};return me.runKernel(AP,a,i)}var Bpe=Ve({spaceToBatchND_:Mpe});var Lpe={kernelName:ZO,gradFunc:function(n,e,t){var r=t.blockShape,a=t.crops;return{x:function(){return Bpe(n,r,a)}}}};var zpe={kernelName:rhe,gradFunc:function(n,e,t){for(var r=t,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(a[s]!==1)throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return gn(n,u,!0)}}}};var $pe={kernelName:ab,gradFunc:function(n){return{x:function(){return n.clone()}}}};var qpe={kernelName:ahe,gradFunc:function(n){return{x:function(){return At(n)}}}};function Wpe(n,e){var t,r=Ie(n,"a","greaterEqual","string_or_numeric"),a=Ie(e,"b","greaterEqual","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(fP,i)}var yb=Ve({greaterEqual_:Wpe});function Vpe(n,e){var t,r=Ie(n,"a","lessEqual","string_or_numeric"),a=Ie(e,"b","lessEqual","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(Fhe,i)}var bb=Ve({lessEqual_:Vpe});function Gpe(n,e){var t=Ie(n,"a","logicalAnd","bool"),r=Ie(e,"b","logicalAnd","bool");lr(t.shape,r.shape);var a={a:t,b:r};return me.runKernel(Ohe,a)}var eM=Ve({logicalAnd_:Gpe});function Upe(n){var e=Ie(n,"x","clone","string_or_numeric"),t={x:e};return me.runKernel(ib,t)}var tM=Ve({clone_:Upe});function Hpe(n,e){var t=Ie(n,"broadcastTo","x"),r=t.shape;if(Ff(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Je(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return tM(t);var c={x:t},l={reps:o};return me.runKernel(ob,c,l)}var xy=Ve({broadcastTo_:Hpe});function Kpe(n,e,t){var r=Ie(e,"a","where"),a=Ie(t,"b","where"),i=Ie(n,"condition","where","bool"),o=lr(lr(i.shape,r.shape),a.shape),s=xy(i,o),u=xy(r,o),c=xy(a,o),l={condition:s,t:u,e:c};return me.runKernel(kP,l)}var Bs=Ve({where_:Kpe}),jpe={kernelName:ihe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.clipValueMin,o=t.clipValueMax;return{x:function(){return Bs(eM(yb(a,i),bb(a,o)),n,At(n))}}}};var Xpe={kernelName:JO,inputsToSave:["x"],gradFunc:ZP.gradFunc};function Ype(n,e,t){t===void 0&&(t=0);var r=Ie(n,"x","split"),a={x:r},i={numOrSizeSplits:e,axis:t};return me.runKernel(_P,a,i)}var Zpe=Ve({split_:Ype});var Jpe={kernelName:QO,saveAllInputs:!0,gradFunc:function(n,e,t){var r=e.map(function(u){return u.shape}),a=t.axis,i=zs(a,e[0].shape)[0],o=r.map(function(u){return u[i]}),s=Zpe(n,o,i);return s.map(function(u){return function(){return u}})}};function Qpe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC");var s=n;n.rank===3&&(s=Je(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Se(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),Se(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),Se(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];Se(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),Se(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),qs("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return me.runKernel(she,f,h)}var nM=Ve({conv2DBackpropFilter_:Qpe});function eve(n,e,t,r,a,i,o){i===void 0&&(i="NHWC"),Se(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var s=n,u=e,c=!1;e.rank===3&&(c=!0,u=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),Se(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),Se(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),Se(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];Se(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),Se(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),qs("conv2dDerInput",a,o);var h={dy:u,filter:t},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=me.runKernel(tP,h,d);return c?Je(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var tve=Ve({conv2DBackpropInput_:eve}),nve={kernelName:eP,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.dilations,s=t.strides,u=t.pad,c=t.dataFormat;return Se(Nf(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")}),{x:function(){return tve(a.shape,n,i,s,u,c)},filter:function(){return nM(a,n,i.shape,s,u,c)}}}};function rve(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=Ie(n,"x","conv2d","float32"),u=Ie(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=Je(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Se(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),Se(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),qs("conv2d",r,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];Se(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),Se(QP(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),Se(aO(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),Se(aO(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=me.runKernel(eP,h,d);return l?Je(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var ave=Ve({conv2d_:rve}),ive={kernelName:tP,inputsToSave:["dy","filter"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.strides,s=t.pad,u=t.dataFormat,c=t.dimRoundingMode;return{dy:function(){return ave(n,i,o,s,u,1,c)},filter:function(){return nM(n,a,i.shape,o,s,u,c)}}}};function ove(n,e,t,r,a){var i=n;n.rank===4&&(i=Je(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));var o=e;o.rank===4&&(o=Je(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Se(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")}),Se(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")}),Se(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(t,".")}),Se(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(t[3],".")}),Se(o.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(t[4],").")});var s={x:i,dy:o},u={strides:r,pad:a,filterShape:t};return me.runKernel(che,s,u)}var sve=Ve({conv3DBackpropFilter_:ove});function uve(n,e,t,r,a){Se(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var i=n,o=e,s=!1;e.rank===4&&(s=!0,o=Je(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=o.shape[4];Se(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),Se(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),Se(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),Se(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),Se(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=me.runKernel(lhe,l,f);return s?Je(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var cve=Ve({conv3DBackpropInput_:uve}),lve={kernelName:uhe,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=t.dilations,a=t.strides,i=t.pad;Se(Nf(r),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")});var o=te(e,2),s=o[0],u=o[1];return{x:function(){return cve(s.shape,n,u,a,i)},filter:function(){return sve(s,n,u.shape,a,i)}}}};function fve(n){var e=Ie(n,"x","sin","float32"),t={x:e};return me.runKernel(NP,t)}var hve=Ve({sin_:fve}),dve={kernelName:nP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(La(hve(St(r,"float32"))),n)}}}};function pve(n){var e=Ie(n,"x","sinh"),t={x:e};return me.runKernel(TP,t)}var vve=Ve({sinh_:pve}),mve={kernelName:rP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(vve(St(r,"float32")),n)}}}};function gve(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function yve(n,e,t){for(var r=n.length+e.length,a=[],i=0,o=0,s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function bve(n,e){for(var t=[],r=n.length,a=0;a<r;a++)e.indexOf(a)===-1&&t.push(n[a]);var i=e.map(function(o){return n[o]});return[t,i]}function iO(n,e){var t=e.map(function(r){return 1});return yve(n,t,e)}function rM(n,e){if(gve(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(a){return t.push(a)}),t}function wb(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function wve(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=Ie(n,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:r};return me.runKernel(aP,i,o)}var xve=Ve({cumsum_:wve});function $n(n,e){return me.tidy(n,e)}function ha(n){var e=KP(n);e.forEach(function(t){return t.dispose()})}function kve(n){return me.keep(n)}function Sve(n,e){var t=Ie(n,"real","complex"),r=Ie(e,"imag","complex");bde(t.shape,r.shape,"real and imag shapes, ".concat(t.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:r};return me.runKernel(ohe,a)}var xb=Ve({complex_:Sve});function Nve(n){var e=Ie(n,"input","imag"),t={input:e};return me.runKernel(Ehe,t)}var Tve=Ve({imag_:Nve});function Eve(n){var e=Ie(n,"input","real"),t={input:e};return me.runKernel(Qhe,t)}var Ive=Ve({real_:Eve});function Cve(n,e,t){var r=Ie(n,"x","transpose");if(e==null&&(e=r.shape.map(function(o,s){return s}).reverse()),Se(r.rank===e.length,function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){Se(o>=0&&o<r.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(e)})}),r.rank<=1)return r.clone();var a={x:r},i={perm:e};return r.dtype==="complex64"?$n(function(){var o=Ive(r),s=Tve(r);return o=me.runKernel(Np,{x:o},i),s=me.runKernel(Np,{x:s},i),t&&(s=La(s)),xb(o,s)}):me.runKernel(Np,a,i)}var dc=Ve({transpose_:Cve}),Ave={kernelName:aP,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis,o=t.exclusive,s=t.reverse;return{x:function(){var u=rM([i],a.rank),c=xve(n,i,o,!s);return u!=null&&(c=dc(c,u)),c}}}};function _ve(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=n;n.rank===3&&(s=Je(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return me.runKernel(dhe,c,l)}var Dve=Ve({depthwiseConv2dNativeBackpropFilter_:_ve});function Fve(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=me.runKernel(phe,c,l);return u?Je(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Rve=Ve({depthwiseConv2dNativeBackpropInput_:Fve}),Ove={kernelName:hhe,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=t.dilations,a=t.strides,i=t.pad,o=t.dimRoundingMode,s=r??[1,1];Se(Nf(s),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")});var u=te(e,2),c=u[0],l=u[1];return Se(c.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")}),Se(l.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")}),Se(c.shape[3]===l.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")}),Se(QP(a,s),function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")}),qs("depthwiseConv2d",i,o),{x:function(){return Rve(c.shape,n,l,a,i,s,o)},filter:function(){return Dve(c,n,l.shape,a,i,s,o)}}}},Pve={kernelName:vhe,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o={x:a,filter:i,dy:n},s={x:a,filter:i,dy:n};return{x:function(){return me.runKernel(mhe,o,t)},filter:function(){return me.runKernel(ghe,s,t)}}}},Mve={kernelName:yhe,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0],a={dy:n,y:r};return{x:function(){return me.runKernel(bhe,a)}}}};function Bve(n){var e=Ie(n,"x","exp"),t={x:e};return me.runKernel(oP,t)}var nv=Ve({exp_:Bve}),Lve={kernelName:whe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0],a=be(nv(La(In(r))),2/Math.sqrt(Math.PI));return{x:function(){return be(n,a)}}}},zve={kernelName:oP,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,r)}}}},$ve={kernelName:sP,inputsToSave:["input"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{input:function(){return Je(n,r.shape)}}}},qve={kernelName:khe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,nv(r))}}}};var Wve={kernelName:uP,gradFunc:function(n){return{x:function(){return At(n)}}}},Vve={kernelName:cP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=Ot(n,St(a,"float32")),c=nr(r.shape,i);return c.length>0?Je(gn(u,c),r.shape):u},s=function(){var u=be(n,St(r,"float32")),c=nr(a.shape,i);c.length>0&&(u=Je(gn(u,c),a.shape));var l=In(a);return La(Ot(u,St(l,"float32")))};return{a:o,b:s}}};function Gve(n){var e=Ie(n,"x","rsqrt","float32"),t={x:e};return me.runKernel(xP,t)}var Uve=Ve({rsqrt_:Gve});function Hve(n,e){var t=Ie(n,"x","tile","string_or_numeric");Se(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var r={x:t},a={reps:e};return me.runKernel(ob,r,a)}var Kve=Ve({tile_:Hve}),jve={kernelName:Nhe,inputsToSave:["x","mean","variance","scale"],gradFunc:function(n,e,t){var r=t.varianceEpsilon,a=te(e,4),i=a[0],o=a[1],s=a[2],u=a[3],c=u??En(1),l=nr(o.shape,i.shape),f=[];if(o.rank===1){for(var h=0;h<i.shape.length-1;++h)f.push(i.shape[h]);f.push(1)}var d=tr(i,o),p=be(n,c),v=Uve(xt(s,En(r))),m=be(be(be(v,v),v),En(-.5)),g=function(){return o.rank===1?Je(be(be(n,Kve(Je(v,[1,1,1,o.shape[0]]),f)),c),i.shape):Je(be(be(n,v),c),i.shape)},y=function(){var N=be(be(v,En(-1)),p);return o.rank===1&&(N=gn(N,l)),Je(N,o.shape)},b=function(){var N=be(be(m,d),p);return o.rank===1&&(N=gn(N,l)),Je(N,o.shape)},w=function(){var N=be(d,v),T=be(n,N);return o.rank===1&&(T=gn(T,l)),Je(T,o.shape)},x=function(){var N=n;return o.rank===1&&(N=gn(N,l)),Je(N,o.shape)};return{x:g,mean:y,variance:b,scale:w,offset:x}}};function Xve(n,e,t){var r=Ie(n,"x","unsortedSegmentSum"),a=Ie(e,"segmentIds","unsortedSegmentSum","int32");Se(Fp(t),function(){return"numSegments must be of dtype int"});var i={x:r,segmentIds:a},o={numSegments:t};return me.runKernel(RP,i,o)}var Yve=Ve({unsortedSegmentSum_:Xve}),Zve={kernelName:lP,inputsToSave:["x","indices"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.axis,s=zs(o,a.shape)[0],u=function(){var c=a.shape,l=i.size,f=c.slice(0,s),h=f.length,d=c.slice(o,c.length).slice(1),p=d.length,v=oO(0,h),m=oO(h+1,h+1+p),g=sO([f,[l],d]),y=Je(n,g),b=Je(i,[l]),w=sO([[h],v,m]),x=dc(y,w),N=Yve(x,b,a.shape[s]),T=wb(w);return N=dc(N,T),N};return{x:u,indices:function(){return i}}}};function oO(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function sO(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Jve={kernelName:fP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1];return{a:function(){return At(r)},b:function(){return At(a)}}}};var Qve={kernelName:ib,gradFunc:function(n){return{x:function(){return St(n,"float32")}}}};var eme={kernelName:Ihe,gradFunc:function(n){return{x:function(){return At(n)}}}};var tme={kernelName:Che,gradFunc:function(n){return{x:function(){return At(n)}}}};var nme={kernelName:Ahe,gradFunc:function(n){return{x:function(){return At(n)}}}};function rme(n,e){var t,r=Ie(n,"a","greater","string_or_numeric"),a=Ie(e,"b","greater","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(The,i)}var Rf=Ve({greater_:rme}),ame={kernelName:_he,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.alpha,o=Rf(a,0);return{x:function(){return Bs(o,n,be(n,i))}}}},ime={kernelName:Rhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,xt(r,1))}}}},ome={kernelName:hP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,St(r,"float32"))}}}},sme={kernelName:Mhe,inputsToSave:[],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis;return{logits:function(){var o=!0,s=nv(a);return tr(n,be(gn(n,i,o),s))}}}};function ume(n,e,t,r,a,i,o){r===void 0&&(r=5),a===void 0&&(a=1),i===void 0&&(i=1),o===void 0&&(o=.5);var s={x:n,y:e,dy:t},u={depthRadius:r,bias:a,alpha:i,beta:o};return me.runKernel(Lhe,s,u)}var cme=Ve({localResponseNormalizationBackprop_:ume}),lme={kernelName:Bhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.depthRadius,s=t.bias,u=t.alpha,c=t.beta;return{x:function(){return cme(a,i,n,o,s,u,c)}}}};function fme(n,e){var t,r=Ie(n,"a","equal","string_or_numeric"),a=Ie(e,"b","equal","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(xhe,i)}var hme=Ve({equal_:fme});function aM(n,e,t,r){return e.rank<t.rank&&(e=Je(e,iO(e.shape,r))),n.rank<t.rank&&(n=Je(n,iO(n.shape,r))),{x:function(){var a=be(n,St(hme(t,e),n.dtype));return a}}}var uO={kernelName:zhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=t,a=r.reductionIndices,i=e[0],o=e[1],s=zs(a,i.shape),u=aM(n,o,i,s);return{x:function(){return u.x()}}}};function dme(n,e){var t,r=Ie(n,"a","less","string_or_numeric"),a=Ie(e,"b","less","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(Dhe,i)}var pme=Ve({less_:dme}),vme={kernelName:dP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=function(){return be(n,St(yb(r,a),"float32"))},o=function(){return be(n,St(pme(r,a),"float32"))};return{a:i,b:o}}};function mme(n,e,t,r,a,i,o){var s=Ie(n,"dy","maxPool3dGrad"),u=Ie(e,"input","maxPool3dGrad"),c=Ie(t,"output","maxPool3dGrad"),l=s,f=u,h=c,d=!1;u.rank===4&&(d=!0,l=Je(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=Je(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=Je(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Se(l.rank===5,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")}),Se(f.rank===5,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,".")}),Se(h.rank===5,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(h.rank,".")}),qs("maxPool3dGrad",i,o);var p={dy:l,input:f,output:h},v={filterSize:r,strides:a,pad:i,dimRoundingMode:o},m=me.runKernel(Vhe,p,v);return d?Je(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var gme=Ve({maxPool3dGrad_:mme}),yme={kernelName:Whe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.filterSize,s=t.strides,u=t.pad,c=t.dimRoundingMode;return{x:function(){return gme(n,a,i,o,s,u,c)}}}};function bme(n,e,t,r,a,i,o){var s=Ie(n,"dy","maxPoolGrad"),u=Ie(e,"input","maxPoolGrad"),c=Ie(t,"output","maxPoolGrad");Se(u.rank===s.rank,function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")}),Se(s.rank===4,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")}),Se(u.rank===4,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")}),qs("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},f={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return me.runKernel(qhe,l,f)}var wme=Ve({maxPoolGrad_:bme}),xme={kernelName:$he,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.filterSize,s=t.strides,u=t.pad;return{x:function(){return wme(n,a,i,o,s,u)}}}};function Mp(n,e){if(e===void 0&&(e="float32"),Ff(n),e==="complex64"){var t=Mp(n,"float32"),r=Mp(n,"float32");return xb(t,r)}var a=fb(Pi(n),e);return me.makeTensor(a,n,e)}function rv(n,e){if(e===void 0&&(e="float32"),Ff(n),e==="complex64"){var t=rv(n,"float32"),r=Mp(n,"float32");return xb(t,r)}var a=BP(Pi(n),e);return me.makeTensor(a,n,e)}var kme={kernelName:Ghe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis,o=zs(i,a.shape),s=bve(a.shape,o),u=s[1],c=Pi(u),l=function(){var f=a.shape.slice();o.forEach(function(p){f[p]=1});var h=Je(n,f),d=Ot(be(h,rv(a.shape,"float32")),c);return d};return{x:l}}},Sme={kernelName:Uhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=t,a=r.axis,i=te(e,2),o=i[0],s=i[1],u=zs(a,o.shape),c=aM(n,s,o,u);return{x:function(){return c.x()}}}},Nme={kernelName:Hhe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=function(){return be(n,St(bb(r,a),"float32"))},o=function(){return be(n,St(Rf(r,a),"float32"))};return{a:i,b:o}}};function Tme(n,e,t){var r=Ie(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:e,size:t};return me.runKernel(SP,a,i)}var cc=Ve({slice_:Tme});var Eme={kernelName:Khe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return cc(n,i,r.shape)}}}};function Ime(n){var e=Ie(n,"x","floor","float32"),t={x:e};return me.runKernel(uP,t)}var Cme=Ve({floor_:Ime}),Ame={kernelName:jhe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=nr(r.shape,i);return u.length>0?Je(gn(n,u),r.shape):n},s=function(){var u=be(n,La(Cme(Ot(r,a)))),c=nr(a.shape,i);return c.length>0?Je(gn(u,c),a.shape):u};return{a:o,b:s}}},_me={kernelName:pP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=be(n,St(a,"float32")),c=nr(r.shape,i);return c.length>0?Je(gn(u,c),r.shape):u},s=function(){var u=be(n,St(r,"float32")),c=nr(a.shape,i);return c.length>0?Je(gn(u,c),a.shape):u};return{a:o,b:s}}};var Dme={kernelName:vP,gradFunc:function(n){return{x:function(){return La(n)}}}};var Fme={kernelName:Yhe,inputsToSave:["indices"],gradFunc:function(n,e){var t=e[0];return{indices:function(){return Mp(t.shape,"float32")}}}};var Rme={kernelName:Xhe,gradFunc:function(n){return{x:function(){return At(n)}}}};function Ome(n,e){e===void 0&&(e=0);var t=Ie(n,"x","unstack","string_or_numeric");Se(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var r={value:t},a={axis:e};return me.runKernel(FP,r,a)}var Pme=Ve({unstack_:Ome});var Mme={kernelName:mP,saveAllInputs:!0,gradFunc:function(n,e,t){var r=t.axis,a=Pme(n,r);return a.map(function(i){return function(){return i}})}};var cO={kernelName:gP,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return cc(n,i,r.shape)}}}};function Bme(n){var e=Ie(n,"x","log","float32"),t={x:e};return me.runKernel(hP,t)}var Lme=Ve({log_:Bme});function zme(n,e){var t,r=Ie(n,"base","pow"),a=Ie(e,"exp","pow");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(yP,i)}var Bp=Ve({pow_:zme}),$me={kernelName:yP,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,3),r=t[0],a=t[1],i=t[2],o=r,s=a,u=lr(o.shape,s.shape),c=function(){var f=St(s,"float32"),h=be(n,be(f,Bp(o,tr(f,En(1))))),d=nr(o.shape,u);return d.length>0&&(h=gn(h,d)),Je(h,o.shape)},l=function(){var f=Rf(o,0),h=Bs(f,Lme(o),At(o)),d=be(n,be(i,h)),p=nr(s.shape,u);return p.length>0&&(d=gn(d,p)),Je(d,s.shape)};return{a:c,b:l}}},qme={kernelName:Zhe,inputsToSave:["x","alpha"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=Rf(r,0);return{x:function(){return Bs(i,n,be(n,a))},alpha:function(){var o=Bs(i,At(n),be(n,r)),s=nr(a.shape,n.shape);return s.length>0&&(o=gn(o,s)),Je(o,a.shape)}}}};function Wme(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var da=Tn();da.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});da.registerFlag("IS_BROWSER",function(){return Wme()});da.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});da.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});da.registerFlag("PROD",function(){return!1});da.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return da.getBool("DEBUG")});da.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});da.registerFlag("IS_TEST",function(){return!1});da.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});da.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});da.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});da.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});var kb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function lO(n){return kb?Buffer.byteLength(n):new Blob([n]).size}function Vme(n){if(kb)return Buffer.from(n).toString("base64");for(var e=new Uint8Array(n),t="",r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function Gme(n){if(kb){var e=Buffer.from(n,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(n),r=new Uint8Array(t.length),a=0;a<t.length;++a)r.set([t.charCodeAt(a)],a);return r.buffer}function Ume(n){if(n.length===1)return n[0];var e=0;n.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(a){t.set(new Uint8Array(a),r),r+=a.byteLength}),t.buffer}function iM(n,e){var t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function Hme(n,e,t){var r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}function Kme(n,e){return Ce(this,void 0,void 0,function(){var t,r,a;return Ee(this,function(i){switch(i.label){case 0:return n.weightsManifest==null?[3,2]:[4,e(n.weightsManifest)];case 1:a=te.apply(void 0,[i.sent(),2]),t=a[0],r=a[1],i.label=2;case 2:return[2,Hme(n,t,r)]}})})}function av(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:lO(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:lO(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function jme(n){var e,t,r=[];try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.push.apply(r,Qe([],te(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}var Ws=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var a=[],i=t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,r);s!==null&&a.push(s)}),a},n}(),Xme="tensorflowjs",Yme=1,xf="models_store",Ip="model_info_store";function Zme(){if(!Tn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Jme(n){var e=n.result;e.createObjectStore(xf,{keyPath:"modelPath"}),e.createObjectStore(Ip,{keyPath:"modelPath"})}var Lp=function(){function n(e){if(this.indexedDB=Zme(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(a,i){var o=r.indexedDB.open(Xme,Yme);o.onupgradeneeded=function(){return Jme(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(xf,"readonly"),c=u.objectStore(xf),l=c.get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(r.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var f=av(t),h=s.transaction(Ip,"readwrite"),d=h.objectStore(Ip),p=d.put({modelPath:r.modelPath,modelArtifactsInfo:f}),v;p.onsuccess=function(){v=s.transaction(xf,"readwrite");var m=v.objectStore(xf),g=m.put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){d=h.objectStore(Ip);var b=d.delete(r.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},p.onerror=function(m){return s.close(),i(p.error)},h.oncomplete=function(){v==null?s.close():v.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},n}();Lp.URL_SCHEME="indexeddb://";var oM=function(n){return Tn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Lp.URL_SCHEME)?Qme(n.slice(Lp.URL_SCHEME.length)):null};Ws.registerSaveRouter(oM);Ws.registerLoadRouter(oM);function Qme(n){return new Lp(n)}var df="/",pf="tensorflowjs_models",ege="info",tge="model_topology",nge="weight_specs",rge="weight_data",age="model_metadata";function ige(n){return{info:[pf,n,ege].join(df),topology:[pf,n,tge].join(df),weightSpecs:[pf,n,nge].join(df),weightData:[pf,n,rge].join(df),modelMetadata:[pf,n,age].join(df)}}function oge(n){var e,t;try{for(var r=fe(Object.values(n)),a=r.next();!a.done;a=r.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}var zp=function(){function n(e){if(!Tn().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=ige(this.modelPath)}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i;return Ee(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=av(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Vme(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw oge(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},n.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,r,a,i,o,s;return Ee(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},r=JSON.parse(this.LS.getItem(this.keys.topology)),r==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=r,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=Gme(s),[2,t]})})},n}();zp.URL_SCHEME="localstorage://";var sM=function(n){return Tn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(zp.URL_SCHEME)?sge(n.slice(zp.URL_SCHEME.length)):null};Ws.registerSaveRouter(sM);Ws.registerLoadRouter(sM);function sge(n){return new zp(n)}var uge="model",cge=".json",lge=".weights.bin";function fO(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var $p=function(){function n(e){if(!Tn().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),(e==null||e.length===0)&&(e=uge),this.modelJsonFileName=e+cge,this.weightDataFileName=e+lge}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=iM(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,fO(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,fO(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:av(e)}]}})})},n}();$p.URL_SCHEME="downloads://";var fge=function(n){return Tn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith($p.URL_SCHEME)?hge(n.slice($p.URL_SCHEME.length)):null};Ws.registerSaveRouter(fge);function hge(n){return n===void 0&&(n="model"),new $p(n)}function hO(n,e,t,r){o(n),t=t??0,r=r??1,s(t,r);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/n.length*(r-t);return e(l),c}),u};function o(u){Se(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){Se(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),Se(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),Se(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(n.map(i))}function dge(n,e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Ee(this,function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Tn().platform.fetch:e.fetchFunc,r=n.map(function(p){return t(p,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=d.sent(),[3,4];case 2:return[4,hO(r,e.onProgress,a,i)];case 3:s=d.sent(),d.label=4;case 4:return o=s,u=o.map(function(p){return p.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=d.sent(),[3,8];case 6:return[4,hO(u,e.onProgress,c,l)];case 7:h=d.sent(),d.label=8;case 8:return f=h,[2,f]}})})}var pge="application/octet-stream",vge="application/json",Sb=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Se(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Tn().platform.fetch,Se(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Se(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i;return Ee(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=iM(e,r),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:vge}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:pge}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:av(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."))}})})},n.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,r,a,i,o=this;return Ee(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,Kme(t,function(u){return o.loadWeights(u)})]}})})},n.prototype.loadWeights=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E;return Ee(this,function(C){switch(C.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,r=te(mge(t),2),a=r[0],i=r[1],o=this.weightPathPrefix||a,s=jme(e),u=[],c=[];try{for(l=fe(e),f=l.next();!f.done;f=l.next()){h=f.value;try{for(d=(T=void 0,fe(h.paths)),p=d.next();!p.done;p=d.next())v=p.value,this.weightUrlConverter!=null?c.push(this.weightUrlConverter(v)):u.push(o+v+i)}catch(F){T={error:F}}finally{try{p&&!p.done&&(E=d.return)&&E.call(d)}finally{if(T)throw T.error}}}}catch(F){x={error:F}}finally{try{f&&!f.done&&(N=l.return)&&N.call(l)}finally{if(x)throw x.error}}return this.weightUrlConverter?(g=(m=u.push).apply,y=[u],b=[[]],[4,Promise.all(c)]):[3,2];case 1:g.apply(m,y.concat([Qe.apply(void 0,b.concat([te.apply(void 0,[C.sent()]),!1]))])),C.label=2;case 2:return[4,dge(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return w=C.sent(),[2,[s,Ume(w)]]}})})},n}();Sb.URL_SCHEME_REGEX=/^https?:\/\//;function mge(n){var e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),a=t>e?n.substring(t):"";return[r+"/",a]}function dO(n){return n.match(Sb.URL_SCHEME_REGEX)!=null}var uM=function(n,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(n)?t=n.every(function(r){return dO(r)}):t=dO(n),t?gge(n,e):null};Ws.registerSaveRouter(uM);Ws.registerLoadRouter(uM);function gge(n,e){return new Sb(n,e)}function yge(n,e,t){var r,a=n.shape.length;typeof e=="number"?r=Qe([e],te(new Array(a-1).fill(0)),!1):e.length<a?r=e.concat(new Array(a-e.length).fill(0)):r=e.slice(),r.forEach(function(o){Se(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=Qe([t],te(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(Se(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),n.shape[s]-r[s])}),[r,i]}var bge=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}();function wge(n){var e=Ie(n,"x","abs");if(e.dtype==="complex64"){var t={x:e};return me.runKernel(JO,t)}else{var t={x:e};return me.runKernel(XO,t)}}var xge=Ve({abs_:wge});function kge(n,e){e===void 0&&(e=0),Se(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=YP(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return tM(t[0]);var r=t,a={axis:e};return me.runKernel(QO,r,a)}var Sge=Ve({concat_:kge});function Nge(n){var e=Ie(n,"x","sigmoid","float32"),t={x:e};return me.runKernel(EP,t)}var Tge=Ve({sigmoid_:Nge});function Ege(n,e,t){var r=Ie(n,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});Se(r.rank>=1+e.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(e.length)}),Se(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),Se(r.shape[0]%a===0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:r},o={blockShape:e,crops:t};return me.runKernel(ZO,i,o)}var Ige=Ve({batchToSpaceND_:Ege});function Cge(n,e,t){Ff(n);var r={shape:n,value:e,dtype:t};return me.runKernel(She,{},r)}function Age(n){var e=Ie(n,"x","cos","float32"),t={x:e};return me.runKernel(nP,t)}var cM=Ve({cos_:Age});function _ge(n){var e=Ie(n,"x","cosh","float32"),t={x:e};return me.runKernel(rP,t)}var Dge=Ve({cosh_:_ge});function Fge(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=Ie(n,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:r};return me.runKernel(fhe,i,o)}var pO=Ve({cumprod_:Fge});function Rge(n,e){e===void 0&&(e=0);var t=Ie(n,"x","expandDims","string_or_numeric");Se(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r={input:t},a={dim:e};return me.runKernel(sP,r,a)}var Oge=Ve({expandDims_:Rge});function Pge(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=Ie(n,"x","gather"),i=Ie(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return me.runKernel(lP,o,s)}var Mge=Ve({gather_:Pge});function Bge(n,e){Se(Oy(n),function(){return"The f passed in variableGrads(f) must be a function"}),Se(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Pp}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var r in me.registeredVariables)e.push(me.registeredVariables[r])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),Se(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=me.gradients(n,e,null,o),u=s.value,c=s.grads;Se(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Se(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function Lge(n){var e=Ie(n,"x","logicalNot","bool"),t={x:e};return me.runKernel(Phe,t)}var zge=Ve({logicalNot_:Lge});function $ge(n,e){var t,r=Ie(n,"a","maximum"),a=Ie(e,"b","maximum");t=te(va(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=St(r,"int32"),a=St(a,"int32")),lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(dP,i)}var lM=Ve({maximum_:$ge});function qge(n,e,t){t===void 0&&(t=0);var r=Ie(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:r};return me.runKernel(gP,i,a)}var Wge=Ve({pad_:qge}),Vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vge(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function Gs(n){var e={exports:{}};return n(e,e.exports),e.exports}var Gge=Gs(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(Vs,n,!1)}),Uge=Gs(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(Vs,n,!1)}),Hge=Gs(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(Vs,n,!1)}),Kge=Gs(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8&&(d[7]=-1),l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(Vs,n,!1)}),jge=Gs(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(Vs,n,!1)}),Xge=Gs(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(Vs,n,!1)}),Yge={},Zge={__proto__:null,default:Yge},Jge=Vge(Zge),mc=Gs(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=Jge}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:Vs,[],Math)});mc.alea=Gge;mc.xor128=Uge;mc.xorwow=Hge;mc.xorshift7=Kge;mc.xor4096=jge;mc.tychei=Xge;function Qge(n,e){var t=Ie(n,"x","reverse"),r={x:t},a={dims:e};return me.runKernel(wP,r,a)}var e0e=Ve({reverse_:Qge});function t0e(n,e){e===void 0&&(e=0);var t=YP(n,"tensors","stack","string_or_numeric");Se(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&Se(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var r=t,a={axis:e};return me.runKernel(mP,r,a)}var n0e=Ve({stack_:t0e});var vO;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(vO||(vO={}));var Us=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.minimize=function(t,r,a){r===void 0&&(r=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return ha(s),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return Bge(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&ha(this.iterations_)},e.prototype.saveIterations=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:En(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ce(this,void 0,void 0,function(){var r;return Ee(this,function(a){switch(a.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(bge);Object.defineProperty(Us,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});(function(n){se(e,n);function e(t,r,a){a===void 0&&(a=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=me.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i],u=!1;r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:$n(function(){return At(s).variable(u)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:$n(function(){return At(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable,f=r.accumulatedUpdates[o].variable;$n(function(){var h=xt(be(l,r.rho),be(In(c),1-r.rho)),d=be(Ot(pi(xt(f,r.epsilon)),pi(xt(l,r.epsilon))),c),p=xt(be(f,r.rho),be(In(d),1-r.rho));l.assign(h),f.assign(p);var v=xt(be(d,-r.learningRate),s);s.assign(v)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ha(this.accumulatedGrads.map(function(t){return t.variable})),ha(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){switch(r.label){case 0:return t=Qe(Qe([],te(this.accumulatedGrads),!1),te(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e})(Us);(function(n){se(e,n);function e(t,r){r===void 0&&(r=.1);var a=n.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=r,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i];if(r.accumulatedGrads[o]==null){var u=!1;r.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:$n(function(){return Cge(s.shape,r.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable;$n(function(){var f=xt(l,In(c));l.assign(f);var h=xt(be(Ot(c,pi(xt(f,me.backend.epsilon()))),-r.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&ha(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e})(Us);(function(n){se(e,n);function e(t,r,a,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],$n(function(){o.accBeta1=En(r).variable(),o.accBeta2=En(a).variable()}),i==null&&(o.epsilon=me.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);$n(function(){var i=tr(1,r.accBeta1),o=tr(1,r.accBeta2);a.forEach(function(s,u){var c=me.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:$n(function(){return At(c).variable(l)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:$n(function(){return At(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,p=xt(be(h,r.beta1),be(f,1-r.beta1)),v=xt(be(d,r.beta2),be(In(f),1-r.beta2)),m=Ot(p,i),g=Ot(v,o);h.assign(p),d.assign(v);var y=xt(be(Ot(m,xt(pi(g),r.epsilon)),-r.learningRate),c);c.assign(y)}}),r.accBeta1.assign(be(r.accBeta1,r.beta1)),r.accBeta2.assign(be(r.accBeta2,r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ha(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&ha(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){switch(r.label){case 0:return t=Qe(Qe([],te(this.accumulatedFirstMoment),!1),te(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r,a,i=this;return Ee(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),$n(function(){i.accBeta1.assign(Bp(i.beta1,i.iterations_+1)),i.accBeta2.assign(Bp(i.beta2,i.iterations_+1))}),r=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(r,r*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e})(Us);(function(n){se(e,n);function e(t,r,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],$n(function(){s.iteration=En(0).variable(),s.accBeta1=En(r).variable()}),i==null&&(s.epsilon=me.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);$n(function(){var i=tr(1,r.accBeta1),o=Ot(-r.learningRate,xt(be(r.iteration,r.decay),1));a.forEach(function(s,u){var c=me.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:At(c).variable(l)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:At(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,p=xt(be(h,r.beta1),be(f,1-r.beta1)),v=be(d,r.beta2),m=xge(f),g=lM(v,m);h.assign(p),d.assign(g);var y=xt(be(Ot(o,i),Ot(p,xt(g,r.epsilon))),c);c.assign(y)}}),r.iteration.assign(xt(r.iteration,1)),r.accBeta1.assign(be(r.accBeta1,r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ha(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&ha(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e})(Us);var r0e=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=me.registeredVariables[i];$n(function(){var c=xt(be(r.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=kve(En(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=r.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e}(Us);(function(n){se(e,n);function e(t,r,a){a===void 0&&(a=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=a,i.accumulations=[],i.m=En(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i];if(r.accumulations[o]==null){var u=!1;r.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:$n(function(){return At(s).variable(u)})}}var c=r.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&$n(function(){var f,h=xt(be(r.m,c),l);r.useNesterov?f=xt(be(r.c,xt(l,be(h,r.m))),s):f=xt(be(r.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ha(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e})(r0e);(function(n){se(e,n);function e(t,r,a,i,o){r===void 0&&(r=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=me.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i],u=!1;r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:$n(function(){return At(s).variable(u)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:$n(function(){return At(s).variable(u)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:$n(function(){return At(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedMeanSquares[o].variable,f=r.accumulatedMoments[o].variable;$n(function(){var h=xt(be(l,r.decay),be(In(c),1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,p=xt(be(d,r.decay),be(c,1-r.decay)),v=Ot(be(c,r.learningRate),pi(tr(h,xt(In(p),r.epsilon)))),m=xt(be(f,r.momentum),v);l.assign(h),d.assign(p),f.assign(m);var g=tr(s,m);s.assign(g)}else{var y=xt(be(l,r.decay),be(In(c),1-r.decay)),m=xt(be(f,r.momentum),Ot(be(c,r.learningRate),pi(xt(y,r.epsilon))));l.assign(y),f.assign(m);var g=tr(s,m);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ha(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&ha(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&ha(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){switch(r.label){case 0:return t=Qe(Qe([],te(this.accumulatedMeanSquares),!1),te(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,Qe([],te(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(r*2,r*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e})(Us);(function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(n){return n()}})();var mO;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(mO||(mO={}));var a0e=1.7580993408473768,i0e=1.0507009873554805;function o0e(n,e,t){var r=n.shape.slice();r[t]=1;var a=Je(e,r),i=pO(n,t,!0,!1),o=pO(n,t,!0,!0),s=be(i,o);return be(a,s)}function s0e(n,e,t){var r=n.shape.length,a=r-t.length,i=rM(t,r),o=n;i!=null&&(o=dc(n,i));var s=o.shape.slice(),u=s.splice(r-t.length,t.length),c=u.reduce(function(d,p){return d*p},1);s.push(c);var l=o.reshape(s),f=o0e(l,e,a);if(f=f.reshape(o.shape),i!=null){var h=wb(i);f=dc(f,h)}return f}var u0e={kernelName:Jhe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis,o=[];return i==null?o=a.shape.map(function(s,u){return u}):typeof i=="number"?o=[i]:o=i,{x:function(){return s0e(a,n,o)}}}},c0e={kernelName:iP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=Ot(n,St(a,"float32")),c=nr(r.shape,i);return c.length>0?Je(gn(u,c),r.shape):u},s=function(){var u=be(n,St(r,"float32")),c=nr(a.shape,i);c.length>0&&(u=Je(gn(u,c),a.shape));var l=In(a);return La(Ot(u,St(l,"float32")))};return{a:o,b:s}}},l0e={kernelName:ede,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,La(In(r)))}}}},f0e={kernelName:ode,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0],a=be(bb(r,6),gb(r));return{x:function(){return be(n,St(a,"float32"))}}}},h0e={kernelName:tde,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,St(gb(r),"float32"))}}}},d0e={kernelName:bP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Je(n,r.shape)}}}},p0e={kernelName:ade,inputsToSave:["images"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i={dy:n,images:a},o=function(){return me.runKernel(ide,i,t)};return{images:o}}},v0e={kernelName:nde,inputsToSave:["images"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i={dy:n,images:a},o=function(){return me.runKernel(rde,i,t)};return{images:o}}};var m0e={kernelName:wP,gradFunc:function(n,e,t){var r=t.dims,a=zs(r,n.shape);return{x:function(){return e0e(n,a)}}}};var g0e={kernelName:sde,gradFunc:function(n){return{x:function(){return At(n)}}}},y0e={kernelName:xP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return La(Ot(n,be(Bp(r,1.5),2)))}}}},b0e={kernelName:kP,inputsToSave:["condition"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{condition:function(){return St(At(r),"float32")},t:function(){return be(n,St(r,n.dtype))},e:function(){return be(n,St(zge(r),n.dtype))}}}},w0e={kernelName:ude,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=Rf(r,En(0)),i=En(a0e),o=En(i0e),s=be(n,o),u=be(be(n,i),nv(St(r,"float32")));return Bs(a,s,u)}}}},x0e={kernelName:EP,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,be(r,tr(En(1),r)))}}}};var k0e={kernelName:cde,gradFunc:function(n){return{x:function(){return At(n)}}}},S0e={kernelName:NP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(cM(St(r,"float32")),n)}}}},N0e={kernelName:TP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(Dge(St(r,"float32")),n)}}}},T0e={kernelName:SP,inputsToSave:["x"],gradFunc:function(n,e,t){for(var r=te(e,1),a=r[0],i=t.begin,o=t.size,s=a.shape,u=te(yge(a,i,o),2),c=u[0],l=u[1],f=[],h=0;h<n.rank;h++)f.push([c[h],s[h]-c[h]-l[h]]);return{x:function(){return Wge(n,f)}}}},E0e={kernelName:fde,outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.dim,o=!0,s=be(n,a);return{logits:function(){return tr(s,be(gn(s,[i],o),a))}}}},I0e={kernelName:lde,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,Tge(r))}}}};var gO={kernelName:AP,gradFunc:function(n,e,t){var r=t.blockShape,a=t.paddings;return{x:function(){return Ige(n,r,a)}}}};var yO={kernelName:_P,gradFunc:function(n,e,t){var r=t.axis;return{x:function(){return Sge(n,r)}}}},C0e={kernelName:IP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,be(pi(St(r,"float32")),2))}}}},A0e={kernelName:dde,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,be(St(r,"float32"),2))}}}},_0e={kernelName:hde,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=En(2),o=function(){return be(n,be(i,tr(r,a)))},s=function(){return be(n,be(i,tr(a,r)))};return{a:o,b:s}}};var D0e={kernelName:PP,gradFunc:function(n){return{x:function(){return At(n)}}}},F0e={kernelName:DP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=n,c=nr(r.shape,i);return c.length>0&&(u=gn(u,c)),Je(u,r.shape)},s=function(){var u=n,c=nr(a.shape,i);return c.length>0&&(u=gn(u,c)),Je(La(u),a.shape)};return{a:o,b:s}}},R0e={kernelName:CP,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=a.shape.slice(),o=t.axis,s=zs(o,a.shape);s.forEach(function(l){i[l]=1});var u=Je(n,i),c=be(u,rv(a.shape,"float32"));return{x:function(){return c}}}},O0e={kernelName:pde,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,In(cM(r)))}}}},P0e={kernelName:vde,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(tr(En(1),In(r)),n)}}}},M0e={kernelName:ob,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.reps,o=function(){var s=At(a);if(a.rank===1)for(var u=0;u<i[0];++u)s=xt(s,cc(n,[u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)s=xt(s,cc(n,[u*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)s=xt(s,cc(n,[u*a.shape[0],c*a.shape[1],l*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else if(a.rank===4)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)for(var f=0;f<i[3];++f)s=xt(s,cc(n,[u*a.shape[0],c*a.shape[1],l*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));else throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(a.rank," tensors yet."));return s};return{x:o}}};var B0e={kernelName:Np,gradFunc:function(n,e,t){var r=t,a=r.perm,i=wb(a);return{x:function(){return dc(n,i)}}}};var L0e={kernelName:FP,gradFunc:function(n,e,t){var r=t,a=r.axis;return{value:function(){return n0e(n,a)}}}},z0e={kernelName:RP,inputsToSave:["segmentIds"],gradFunc:function(n,e){var t=te(e,1),r=t[0],a=function(){return $0e(n,r)};return{x:a}}};function $0e(n,e){for(var t=lM(e,At(e)),r=Mge(n,t),a=yb(e,En(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=Oge(a,o+1);a=eM(a,rv(r.shape,"bool"));var s=At(r);return Bs(a,r,s)}var q0e={kernelName:OP,gradFunc:function(n){return{x:function(){return At(n)}}}},ky,bO,W0e=[ZP,dpe,ppe,gpe,ype,wpe,xpe,kpe,Npe,Tpe,Epe,Ipe,_pe,Rpe,Ppe,Lpe,zpe,$pe,qpe,jpe,Xpe,Jpe,ive,nve,lve,dve,mve,Ave,Ove,Pve,c0e,Mve,Lve,zve,$ve,qve,Vve,Wve,jve,Zve,Jve,Qve,eme,tme,nme,ame,ime,ome,sme,lme,uO,uO,vme,yme,xme,kme,Sme,Nme,Eme,Ame,_me,Dme,Fme,Rme,Mme,cO,cO,$me,qme,u0e,l0e,f0e,h0e,d0e,p0e,v0e,m0e,g0e,y0e,b0e,w0e,x0e,k0e,S0e,N0e,T0e,E0e,I0e,gO,gO,yO,yO,C0e,_0e,A0e,D0e,F0e,R0e,O0e,P0e,M0e,B0e,L0e,z0e,q0e];try{for(vf=fe(W0e),ic=vf.next();!ic.done;ic=vf.next())wO=ic.value,Fde(wO)}catch(n){ky={error:n}}finally{try{ic&&!ic.done&&(bO=vf.return)&&bO.call(vf)}finally{if(ky)throw ky.error}}var wO,vf,ic;function Nb(n,e){return R.tidy(function(){return _.sqrt(_.sum(_.mul(n,n),e,!0))})}var Of=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(R.serialization.Serializable),Tb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.defaultMaxValue=2,r.defaultAxis=0,r.maxValue=t.maxValue!=null?t.maxValue:r.defaultMaxValue,r.axis=t.axis!=null?t.axis:r.defaultAxis,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){var a=Nb(t,r.axis),i=_.clipByValue(a,0,r.maxValue);return _.mul(t,_.div(i,_.add(qn(),a)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e}(Of);Tb.className="MaxNorm";R.serialization.registerClass(Tb);var Eb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.defaultAxis=0,r.axis=t.axis!=null?t.axis:r.defaultAxis,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){return _.div(t,_.add(qn(),Nb(t,r.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e}(Of);Eb.className="UnitNorm";R.serialization.registerClass(Eb);var Ib=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.relu(t)},e}(Of);Ib.className="NonNeg";R.serialization.registerClass(Ib);var Cb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=t.minValue!=null?t.minValue:r.defaultMinValue,r.maxValue=t.maxValue!=null?t.maxValue:r.defaultMaxValue,r.rate=t.rate!=null?t.rate:r.defaultRate,r.axis=t.axis!=null?t.axis:r.defaultAxis,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){var a=Nb(t,r.axis),i=_.add(_.mul(r.rate,_.clipByValue(a,r.minValue,r.maxValue)),_.mul(1-r.rate,a));return _.mul(t,_.div(i,_.add(qn(),a)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e}(Of);Cb.className="MinMaxNorm";R.serialization.registerClass(Cb);var xO={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Wn(n){return Hy(n)}function kO(n,e){return e===void 0&&(e={}),Cf(n,R.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function Vn(n){if(n==null)return null;if(typeof n=="string"){var e=n in xO?xO[n]:n,t={className:e,config:{}};return kO(t)}else return n instanceof Of?n:kO(n)}function V0e(n){return new Tb(n)}function G0e(n){return new Eb(n)}function U0e(){return new Ib}function H0e(n){return new Cb(n)}var K0e={__proto__:null,maxNorm:V0e,unitNorm:G0e,nonNeg:U0e,minMaxNorm:H0e};function j0e(){return new Xy}function X0e(){return new jp}function Y0e(n){return new Yy(n)}function Z0e(n){return new Zy(n)}function J0e(n){return new Jy(n)}function Q0e(n){return new Qy(n)}function eye(n){return new eb(n)}function tye(n){return new Cr(n)}function nye(n){return new Xp(n)}function rye(n){return new Yp(n)}function aye(n){return new Zp(n)}function iye(n){return new Jp(n)}function oye(n){return new Qp(n)}function sye(n){return new ev(n)}function uye(n){return new tb(n)}var cye={__proto__:null,zeros:j0e,ones:X0e,constant:Y0e,randomUniform:Z0e,randomNormal:J0e,truncatedNormal:Q0e,identity:eye,varianceScaling:tye,glorotUniform:nye,glorotNormal:rye,heNormal:aye,heUniform:iye,leCunNormal:oye,leCunUniform:sye,orthogonal:uye};function Bo(n){return Ce(this,void 0,void 0,function(){var e,t,r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(n==null)return[2];e=[],t=[],r=[];for(a in n)i=n[a],typeof i!="number"&&(o=i,e.push(o.data()),t.push(a),r.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=c.sent(),u=0;u<s.length;++u)n[t[u]]=s[u][0];R.dispose(r),c.label=2;case 2:return[2]}})})}function fM(n){if(n!=null)for(var e in n){var t=n[e];typeof t!="number"&&t.dispose()}}var SO;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(SO||(SO={}));var lye=125,pc=function(){function n(){this.validationData=null}return n.prototype.setParams=function(e){this.params=e},n.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},n.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},n.prototype.setModel=function(e){},n}(),hM=function(){function n(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return n.prototype.append=function(e){this.callbacks.push(e)},n.prototype.setParams=function(e){var t,r;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setParams(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},n.prototype.setModel=function(e){var t,r;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setModel(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},n.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),r=t.next(),u.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,a.onTrainBegin(e)]);case 3:u.sent(),u.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{r&&!r.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},n.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),r=t.next(),u.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,a.onTrainEnd(e)]);case 3:u.sent(),u.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{r&&!r.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},n}(),fye=function(n){se(e,n);function e(){return n.call(this)||this}return e.prototype.onEpochBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u=this;return Ee(this,function(c){r==null&&(r={}),a=r.size==null?0:r.size,this.seen+=a,i=function(l){var f=r[l];if(typeof f=="number")o.totals.hasOwnProperty(l)||(o.totals[l]=0),o.totals[l]=o.totals[l]+f*a;else{var h=void 0;l in o.totals?h=o.totals[l]:o.totals[l]=0;var d=R.tidy(function(){return R.add(u.totals[l],R.mul(f,a))});o.totals[l]=d,h?.dispose()}},o=this;for(s in r)i(s);return[2]})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f=this;return Ee(this,function(h){if(r!=null){a=function(d){if(i.totals[d]==null)return"continue";typeof i.totals[d]=="number"?r[d]=i.totals[d]/i.seen:R.tidy(function(){var p=R.mul(R.div(1,f.seen),f.totals[d]);r[d]=p,f.totals[d].dispose(),R.keep(r[d])})},i=this;try{for(o=fe(this.params.metrics),s=o.next();!s.done;s=o.next())u=s.value,a(u)}catch(d){c={error:d}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}}return[2]})})},e}(pc),dM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){r==null&&(r={}),this.epoch.push(t);for(a in r)this.history[a]==null&&(this.history[a]=[]),this.history[a].push(r[a]);return[2]})})},e.prototype.syncData=function(){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:t=[],r=[],a=[];for(i in this.history)for(o=this.history[i],s=0;s<o.length;++s)typeof o[s]!="number"&&(u=o[s],t.push(u.data()),r.push(i),a.push(s));return[4,Promise.all(t)];case 1:for(c=h.sent(),l=0;l<c.length;++l)f=this.history[r[l]][a[l]],f.dispose(),this.history[r[l]][a[l]]=c[l][0];return[2]}})})},e}(pc),pM=function(n){se(e,n);function e(t,r){var a=n.call(this)||this;if(a.currentEpoch=0,a.nowFunc=t.nowFunc,a.nextFrameFunc=t.nextFrameFunc||R.nextFrame,a.yieldEvery=r||"auto",a.yieldEvery==="auto"&&(a.yieldEvery=lye),a.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return R.util.isNumber(a.yieldEvery)&&(a.maybeWait=lfe(a.maybeWait.bind(a),a.yieldEvery,a.nowFunc)),a.trainBegin=t.onTrainBegin,a.trainEnd=t.onTrainEnd,a.epochBegin=t.onEpochBegin,a.epochEnd=t.onEpochEnd,a.batchBegin=t.onBatchBegin,a.batchEnd=t.onBatchEnd,a.yield=t.onYield,a}return e.prototype.maybeWait=function(t,r,a){return Ce(this,void 0,void 0,function(){var i;return Ee(this,function(o){switch(o.label){case 0:return i=[],this.yield==null?[3,2]:[4,Bo(a)];case 1:o.sent(),i.push(this.yield(t,r,a)),o.label=2;case 2:return i.push(this.nextFrameFunc()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,Bo(r)];case 1:return a.sent(),[4,this.epochBegin(t,r)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.epochEnd==null?[3,2]:[4,Bo(r)];case 1:i.sent(),a.push(this.epochEnd(t,r)),i.label=2;case 2:return this.yieldEvery==="epoch"&&a.push(this.nextFrameFunc()),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.batchBegin==null?[3,3]:[4,Bo(r)];case 1:return a.sent(),[4,this.batchBegin(t,r)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.batchEnd==null?[3,2]:[4,Bo(r)];case 1:i.sent(),a.push(this.batchEnd(t,r)),i.label=2;case 2:return this.yieldEvery==="batch"?a.push(this.nextFrameFunc()):R.util.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,r)),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){switch(r.label){case 0:return this.trainBegin==null?[3,3]:[4,Bo(t)];case 1:return r.sent(),[4,this.trainBegin(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){switch(r.label){case 0:return this.trainEnd==null?[3,3]:[4,Bo(t)];case 1:return r.sent(),[4,this.trainEnd(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e}(pc);function vM(n,e){if(n==null&&(n={}),n instanceof pc)return[n];if(Array.isArray(n)&&n[0]instanceof pc)return n;var t=Yt(n);return t.map(function(r){return new pM(r,e)})}var Ab=function(){function n(){}return n.registerCallbackConstructor=function(e,t){R.util.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)}),n.checkForDuplicate(t),n.constructors[e]==null&&(n.constructors[e]=[]),n.constructors[e].push(t)},n.checkForDuplicate=function(e){for(var t in n.constructors){var r=n.constructors[+t];r.forEach(function(a){if(a===e)throw new J("Duplicate callback constructor.")})}},n.clear=function(){n.constructors={}},n.createCallbacks=function(e){var t=[];for(var r in n.constructors){var a=+r;e>=a&&t.push.apply(t,Qe([],te(n.constructors[a]),!1))}return t.map(function(i){return new i})},n}();Ab.constructors={};function mM(n,e,t,r,a,i,o,s,u){var c=new dM,l=Qe([new fye],te(Ab.createCallbacks(e)),!1);n!=null&&l.push.apply(l,Qe([],te(n),!1)),l.push(c);var f=new hM(l);return f.setParams({epochs:t,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:f,history:c}}function ci(n,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),Cf(n,R.serialization.SerializationMap.getMap().classNameMap,e,"layer",t)}function qp(n,e){return R.tidy(function(){n.dtype!=="float32"&&(n=_.cast(n,"float32"));var t=_.sum(_f(n),e,!0),r=_.fill(t.shape,qn()),a=_.sqrt(_.maximum(t,r));return _.div(n,a)})}function Hs(n,e){return R.tidy(function(){return _.mean(_f(_.sub(e,n)),-1)})}function iv(n,e){return R.tidy(function(){return _.mean(_.abs(_.sub(e,n)),-1)})}function gc(n,e){return R.tidy(function(){var t=_.sub(n,e),r=_.clipByValue(_.abs(n),qn(),Number.MAX_VALUE),a=_.abs(_.div(t,r));return _.mul(100,_.mean(a,-1))})}function hye(n,e){return R.tidy(function(){var t=_.clipByValue(e,qn(),Number.MAX_VALUE),r=_.log(_.add(1,t)),a=_.clipByValue(n,qn(),Number.MAX_VALUE),i=_.log(_.add(1,a));return _.mean(_f(_.sub(r,i)),-1)})}function dye(n,e){return R.tidy(function(){var t=_.maximum(0,_.sub(1,_.mul(n,e)));return _.mean(_f(t),-1)})}function pye(n,e){return R.tidy(function(){var t=_.maximum(0,_.sub(1,_.mul(n,e)));return _.mean(t,-1)})}function vye(n,e){return R.tidy(function(){var t=_.sum(_.mul(n,e),-1),r=_.max(_.mul(_.sub(1,n),e),-1);return _.maximum(0,_.add(1,_.sub(r,t)))})}function mye(n,e){return R.tidy(function(){var t=Math.log(2),r=_.sub(e,n),a=_.sub(_.add(r,_.softplus(_.mul(-2,r))),t);return _.mean(a,-1)})}function Tf(n,e,t){return t===void 0&&(t=!1),R.tidy(function(){if(t)e=_.softmax(e);else{var r=_.sum(e,e.shape.length-1,!0);e=_.div(e,r)}return e=_.clipByValue(e,qn(),1-qn()),_.neg(_.sum(_.mul(_.cast(n,"float32"),_.log(e)),e.shape.length-1))})}function Wp(n,e,t){return t===void 0&&(t=!1),R.tidy(function(){var r=_.cast(_.floor(kfe(n)),"int32");e=_.clipByValue(e,qn(),1-qn());var a=e.shape,i=_.reshape(_.oneHot(r,a[a.length-1]),a);return Tf(i,e,t)})}function gye(n,e){if(!R.util.arraysEqual(n.shape,e.shape))throw new J("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(n.shape)," and ").concat(JSON.stringify(e.shape)));return R.tidy(function(){var t=_.relu(e),r=_.neg(_.abs(e));return _.add(_.sub(t,_.mul(e,n)),_.log1p(_.exp(r)))})}function ov(n,e){return R.tidy(function(){var t;return t=_.clipByValue(e,qn(),1-qn()),t=_.log(_.div(t,_.sub(1,t))),_.mean(gye(n,t),-1)})}function yye(n,e){return R.tidy(function(){var t=_.clipByValue(n,qn(),1),r=_.clipByValue(e,qn(),1);return _.sum(_.mul(n,_.log(_.div(t,r))),-1)})}function bye(n,e){return R.tidy(function(){var t=_.log(_.add(qn(),e));return _.mean(_.sub(e,_.mul(n,t)),-1)})}function _b(n,e){return R.tidy(function(){var t=qp(n,-1),r=qp(e,-1),a=_.mul(t,r);return _.neg(_.sum(a,-1))})}var Vp={meanSquaredError:Hs,meanAbsoluteError:iv,meanAbsolutePercentageError:gc,meanSquaredLogarithmicError:hye,squaredHinge:dye,hinge:pye,categoricalHinge:vye,logcosh:mye,categoricalCrossentropy:Tf,sparseCategoricalCrossentropy:Wp,binaryCrossentropy:ov,kullbackLeiblerDivergence:yye,poisson:bye,cosineProximity:_b};function Sy(n){if(typeof n=="string"){if(n in Vp)return Vp[n];var e="Unknown loss ".concat(n);throw n.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss ".concat(n,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new J(e)}else return n}function Db(n,e){return R.tidy(function(){var t=_.mul(.5,_.onesLike(e)),r=Ri(_.greater(e,t),n.dtype);return _.mean(_.equal(n,r),-1)})}function Fb(n,e){return R.tidy(function(){return Ri(_.equal(_.argMax(n,-1),_.argMax(e,-1)),"float32")})}function gM(n,e){return R.tidy(function(){return _.cast(_.sum(_.logicalAnd(_.equal(n,1),_.equal(e,1))),"float32")})}function wye(n,e){return R.tidy(function(){return _.cast(_.sum(_.logicalAnd(_.equal(n,1),_.equal(e,0))),"float32")})}function xye(n,e){return R.tidy(function(){return _.cast(_.sum(_.logicalAnd(_.equal(n,0),_.equal(e,1))),"float32")})}function yM(n,e){return R.tidy(function(){var t=gM(n,e),r=xye(n,e),a=_.add(t,r);return _.cast(_.where(_.greater(a,0),_.div(t,a),0),"float32")})}function kye(n,e){return R.tidy(function(){var t=gM(n,e),r=wye(n,e),a=_.add(t,r);return _.cast(_.where(_.greater(a,0),_.div(t,a),0),"float32")})}function bM(n,e){return ov(n,e)}function wM(n,e){return n.rank===e.rank&&(n=_.squeeze(n,[n.rank-1])),e=_.argMax(e,-1),e.dtype!==n.dtype&&(e=_.cast(e,n.dtype)),_.cast(_.equal(n,e),"float32")}var Sye=Hs,Nye=Hs,Tye=iv,Eye=iv,Iye=gc,Cye=gc,Rb=Tf,Aye=_b,xM=Wp,Gp={binaryAccuracy:Db,categoricalAccuracy:Fb,precision:yM,categoricalCrossentropy:Rb,sparseCategoricalCrossentropy:xM,mse:Sye,MSE:Nye,mae:Tye,MAE:Eye,mape:Iye,MAPE:Cye,cosine:Aye};function _ye(n){if(typeof n=="string"&&n in Gp)return Gp[n];if(typeof n!="string"&&n!=null)return n;throw new J("Unknown metric ".concat(n))}function kp(n){var e,t,r,a;if(_i(n!==null,"Unknown LossOrMetricFn ".concat(n)),typeof n=="string")return n;var i=void 0;try{for(var o=fe(Object.keys(Vp)),s=o.next();!s.done;s=o.next()){var u=s.value;if(Vp[u]===n){i=u;break}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(i!==void 0)return i;try{for(var c=fe(Object.keys(Gp)),l=c.next();!l.done;l=c.next()){var u=l.value;if(Gp[u]===n){i=u;break}}}catch(f){r={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return i!==void 0?i:n.name}function Dye(n){var e={Adagrad:function(){return R.train.adagrad(.01)},Adadelta:function(){return R.train.adadelta(1,.95,qn())},Adam:function(){return R.train.adam(.001,.9,.999,qn())},Adamax:function(){return R.train.adamax(.002,.9,.999,qn(),0)},RMSProp:function(){return R.train.rmsprop(.001,.9,0,qn())},SGD:function(){return R.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new J("Unknown Optimizer ".concat(n))}var NO=1*1024*1024;function TO(n,e,t){if(t===void 0&&(t=!1),n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Wy(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var r=JSON.stringify(n);r.length>NO&&console.warn('User-defined metadata of model "'.concat(e,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(NO,"."))}}function Wy(n){var e,t,r,a;if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){var i=Object.keys(n);try{for(var o=fe(i),s=o.next();!s.done;s=o.next()){var u=s.value;if(typeof u!="string"||!Wy(n[u]))return!1}}catch(d){e={error:d}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!0}else if(Array.isArray(n)){try{for(var c=fe(n),l=c.next();!l.done;l=c.next()){var f=l.value;if(!Wy(f))return!1}}catch(d){r={error:d}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return!0}else return!1;else{var h=typeof n;return h==="string"||h==="number"||h==="boolean"}}function Fye(n,e,t,r){r===void 0&&(r=console.log);var a=Oye(n),i=["Layer (type)","Input Shape","Output shape","Param #"];a?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(function(h){return Math.floor(e*h)}));var o;if(!a){i.push("Receives inputs"),o=[];for(var s in n.nodesByDepth)o.push.apply(o,Qe([],te(n.nodesByDepth[s]),!1))}r("_".repeat(e)),Up(i,t,r),r("=".repeat(e));for(var u=n.layers,c=0;c<u.length;++c)a?Pye(u[c],t,r):Mye(u[c],t,o,r),r((c===u.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();var l=Rye(n),f=Ap(n.nonTrainableWeights);r("Total params: ".concat(l+f)),r("Trainable params: ".concat(l)),r("Non-trainable params: ".concat(f)),r("_".repeat(e))}function Rye(n){var e;return n.collectedTrainableWeights!=null?e=Ap(n.collectedTrainableWeights):e=Ap(n.trainableWeights),e}function Oye(n){var e,t,r,a,i,o,s=!0,u=[],c=[];for(var l in n.nodesByDepth)u.push(n.nodesByDepth[l]);try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var d=h.value;if(d.length>1||d.length===1&&d[0].inboundLayers.length>1){s=!1;break}c.push.apply(c,Qe([],te(d),!1))}}catch(x){e={error:x}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(s)try{for(var p=fe(n.layers),v=p.next();!v.done;v=p.next()){var m=v.value,g=!1;try{for(var y=(i=void 0,fe(m.inboundNodes)),b=y.next();!b.done;b=y.next()){var w=b.value;if(c.indexOf(w)!==-1)if(g){s=!1;break}else g=!0}}catch(x){i={error:x}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}if(!s)break}}catch(x){r={error:x}}finally{try{v&&!v.done&&(a=p.return)&&a.call(p)}finally{if(r)throw r.error}}return s}function Up(n,e,t){t===void 0&&(t=console.log);for(var r="",a=0;a<n.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=n[a],r=r.slice(0,e[a]),r+=" ".repeat(e[a]-r.length);t(r)}function Pye(n,e,t){var r,a;try{a=n.inboundNodes.map(function(u){return JSON.stringify(u.inputShapes)}).join(",")}catch{a="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}var i=n.name,o=n.getClassName(),s=["".concat(i," (").concat(o,")"),a,r,n.countParams().toString()];Up(s,e,t)}function Mye(n,e,t,r){var a,i,o,s;try{s=n.inboundNodes.map(function(w){return JSON.stringify(w.inputShapes)}).join(",")}catch{s="multiple"}try{o=JSON.stringify(n.outputShape)}catch{o="multiple"}var u=[];try{for(var c=fe(n.inboundNodes),l=c.next();!l.done;l=c.next()){var f=l.value;if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(var h=0;h<f.inboundLayers.length;++h){var d=f.inboundLayers[h].name,p=f.nodeIndices[h],v=f.tensorIndices[h];u.push("".concat(d,"[").concat(p,"][").concat(v,"]"))}}}catch(w){a={error:w}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}var m=n.name,g=n.getClassName(),y=u.length===0?"":u[0],b=["".concat(m," (").concat(g,")"),s,o,n.countParams().toString(),y];Up(b,e,r);for(var h=1;h<u.length;++h)Up(["","","","",u[h]],e,r)}function kM(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Ef(n,e){var t,r;if(n===null)return null;if(typeof n=="string")return Fs(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){for(var a=[],i=n.length,o=0;o<i;++o){var s=n[o];kM(e,o,s)?a.push(s):a.push(Ef(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(n)),l=c.next();!l.done;l=c.next()){var f=l.value,h=n[f];if(f==="name"&&typeof h=="string")u[f]=h;else{var d=Fs(f);u[d]=Ef(h,d)}}}catch(p){t={error:p}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return u}}function Vy(n,e){var t,r;if(n==null)return null;if(typeof n=="string")return to(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){for(var a=[],i=n.length,o=0;o<i;++o){var s=n[o];kM(e,o,s)?a.push(s):a.push(Vy(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(n)),l=c.next();!l.done;l=c.next()){var f=l.value,h=n[f],d=to(f);(f==="name"||f==="className")&&typeof h=="string"?u[d]=h:u[d]=Vy(h,f)}}catch(p){t={error:p}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return u}}var Ob="4.2.0",Bye=function(n){se(e,n);function e(t){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E,C,F,D=n.call(this,{})||this;if(D.containerNodes=new Set,D.name=t.name,D.name==null){var O=D.getClassName().toLowerCase();D.name=Hp(O)}if(D.supportsMasking=!1,D.trainable_=!0,Array.isArray(t.inputs)?D.inputs=t.inputs.slice():D.inputs=[t.inputs],Array.isArray(t.outputs)?D.outputs=t.outputs.slice():D.outputs=[t.outputs],zo(D.inputs).length!==D.inputs.length)throw new J("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(D.inputs.map(function(dt){return dt.name})));zo(D.outputs).length!==D.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(D.outputs.map(function(dt){return dt.name}))),D.inputLayers=[],D.inputLayersNodeIndices=[],D.inputLayersTensorIndices=[],D.outputLayers=[],D.outputLayersNodeIndices=[],D.outputLayersTensorIndices=[],D.layers=[],D.internalContainerRefs=[];try{for(var L=fe(D.outputs),z=L.next();!z.done;z=L.next()){var $=z.value,B=$.sourceLayer,W=$.nodeIndex,X=$.tensorIndex;D.outputLayers.push(B),D.outputLayersNodeIndices.push(W),D.outputLayersTensorIndices.push(X)}}catch(dt){r={error:dt}}finally{try{z&&!z.done&&(a=L.return)&&a.call(L)}finally{if(r)throw r.error}}try{for(var Z=fe(D.inputs),V=Z.next();!V.done;V=Z.next()){var $=V.value,B=$.sourceLayer,W=$.nodeIndex,X=$.tensorIndex;_i(W===0,"input layer has >1 nodes"),_i(X===0,"input layer has >1 tensors"),D.inputLayers.push(B),D.inputLayersNodeIndices.push(W),D.inputLayersTensorIndices.push(X)}}catch(dt){i={error:dt}}finally{try{V&&!V.done&&(o=Z.return)&&o.call(Z)}finally{if(i)throw i.error}}D.inputNames=[],D.outputNames=[],D.feedInputShapes=[],D.feedInputNames=[],D.feedOutputNames=[];for(var j=0;j<D.inputLayers.length;j++){var B=D.inputLayers[j];if(!(B instanceof vc))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(t.inputs,". ")+"Input ".concat(j," (0-based) originates ")+"from layer type ".concat(B.getClassName(),"."));D.inputNames.push(B.name),D.feedInputShapes.push(B.batchInputShape),D.feedInputNames.push(B.name)}try{for(var re=fe(D.outputLayers),ne=re.next();!ne.done;ne=re.next()){var B=ne.value;D.outputNames.push(B.name)}}catch(dt){s={error:dt}}finally{try{ne&&!ne.done&&(u=re.return)&&u.call(re)}finally{if(s)throw s.error}}D.internalInputShapes=D.inputs.map(function(dt){return dt.shape}),D.internalOutputShapes=D.outputs.map(function(dt){return dt.shape});var oe={},le={},pe={},xe={},he={},ye=[],we=function(dt,Sa,Ja,Br,us,D2){(Br==null||us==null||D2==null)&&(Br=dt.sourceLayer,us=dt.nodeIndex,D2=dt.tensorIndex);var oa=Br.inboundNodes[us];if(Ja.indexOf(oa)!==-1)throw new Fi("The tensor ".concat(dt.name,' at layer "').concat(Br.name,'" ')+"is part of a cycle.");if(Sa.indexOf(oa)===-1){D.containerNodes.add(e.nodeKey(Br,us)),Br.id in he||(he[Br.id]=Object.keys(he).length),Ja.indexOf(oa)===-1&&Ja.push(oa);for(var d5=oa.inboundLayers.length,Au=0;Au<d5;Au++){var p5=oa.inputTensors[Au],v5=oa.inboundLayers[Au],m5=oa.nodeIndices[Au],g5=oa.tensorIndices[Au];we(p5,Sa,Ja,v5,m5,g5)}for(Sa.push(oa);Ja.indexOf(oa)>=0;)Ja.splice(Ja.indexOf(oa),1);ye.push(oa)}},Ae=[],Ye=[];try{for(var ht=fe(D.outputs),at=ht.next();!at.done;at=ht.next()){var $=at.value;we($,Ae,Ye)}}catch(dt){c={error:dt}}finally{try{at&&!at.done&&(l=ht.return)&&l.call(ht)}finally{if(c)throw c.error}}var rt=ye.slice().reverse();try{for(var ft=fe(rt),st=ft.next();!st.done;st=ft.next()){var Ze=st.value;le[Ze.id]=Ze,Ze.id in oe||(oe[Ze.id]=0);var tt=oe[Ze.id],et=pe[Ze.outboundLayer.id]==null?0:pe[Ze.outboundLayer.id];tt=Math.max(tt,et),pe[Ze.outboundLayer.id]=tt,xe[Ze.outboundLayer.id]=Ze.outboundLayer,oe[Ze.id]=tt;for(var j=0;j<Ze.inboundLayers.length;j++){var rn=Ze.inboundLayers[j],W=Ze.nodeIndices[j],He=rn.inboundNodes[W],kt=oe[He.id]==null?0:oe[He.id];oe[He.id]=Math.max(tt+1,kt),le[He.id]=He}}}catch(dt){f={error:dt}}finally{try{st&&!st.done&&(h=ft.return)&&h.call(ft)}finally{if(f)throw f.error}}var An={};for(var hr in oe){var tt=oe[hr];tt in An||(An[tt]=[]),An[tt].push(le[hr])}var On={};for(var _n in pe){var tt=pe[_n];tt in On||(On[tt]=[]),On[tt].push(xe[_n])}var an=Object.keys(On).map(function(dt){return parseInt(dt,10)}).sort(bp);D.layers=[];try{for(var Pr=fe(an),dr=Pr.next();!dr.done;dr=Pr.next()){var tt=dr.value,Mr=On[tt];Mr.sort(function(Sa,Ja){var Br=he[Sa.id],us=he[Ja.id];return Br<us?-1:Br>us?1:0});try{for(var Sn=(v=void 0,fe(Mr)),Gi=Sn.next();!Gi.done;Gi=Sn.next()){var B=Gi.value;B instanceof e&&D.internalContainerRefs.push(B),D.layers.push(B)}}catch(Sa){v={error:Sa}}finally{try{Gi&&!Gi.done&&(m=Sn.return)&&m.call(Sn)}finally{if(v)throw v.error}}}}catch(dt){d={error:dt}}finally{try{dr&&!dr.done&&(p=Pr.return)&&p.call(Pr)}finally{if(d)throw d.error}}D.layersByDepth=On,an=Object.keys(An).map(function(dt){return parseInt(dt,10)}).sort(bp);var Iu=D.inputs.slice(),jh=[];try{for(var Ui=fe(an),ss=Ui.next();!ss.done;ss=Ui.next()){var tt=ss.value;try{for(var Cu=(b=void 0,fe(An[tt])),vl=Cu.next();!vl.done;vl=Cu.next()){var Ze=vl.value,B=Ze.outboundLayer;if(B!=null){try{for(var Xh=(x=void 0,fe(Ze.inputTensors)),ml=Xh.next();!ml.done;ml=Xh.next()){var $=ml.value;if(Iu.indexOf($)===-1)throw new Fi("Graph disconnected: cannot obtain value for tensor ".concat($)+' at layer "'.concat(B.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(jh))}}catch(Br){x={error:Br}}finally{try{ml&&!ml.done&&(N=Xh.return)&&N.call(Xh)}finally{if(x)throw x.error}}try{for(var Yh=(T=void 0,fe(Ze.outputTensors)),gl=Yh.next();!gl.done;gl=Yh.next()){var $=gl.value;Iu.push($)}}catch(Br){T={error:Br}}finally{try{gl&&!gl.done&&(E=Yh.return)&&E.call(Yh)}finally{if(T)throw T.error}}jh.push(B.name)}}}catch(Sa){b={error:Sa}}finally{try{vl&&!vl.done&&(w=Cu.return)&&w.call(Cu)}finally{if(b)throw b.error}}}}catch(dt){g={error:dt}}finally{try{ss&&!ss.done&&(y=Ui.return)&&y.call(Ui)}finally{if(g)throw g.error}}D.nodesByDepth=An;var Xm=D.layers.map(function(dt){return dt.name}),f5=function(dt){var Sa=Xm.filter(function(Ja){return Ja===dt}).length;if(Sa!==1)throw new Fi('The name "'.concat(dt,'" is used ').concat(Sa," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(Xm))};try{for(var Zh=fe(Xm),yl=Zh.next();!yl.done;yl=Zh.next()){var h5=yl.value;f5(h5)}}catch(dt){C={error:dt}}finally{try{yl&&!yl.done&&(F=Zh.return)&&F.call(Zh)}finally{if(C)throw C.error}}return D.outboundNodes=[],D.inboundNodes=[],new tv({outboundLayer:D,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:D.inputs,outputTensors:D.outputs,inputMasks:D.inputs.map(function(dt){return null}),outputMasks:D.outputs.map(function(dt){return null}),inputShapes:D.inputs.map(function(dt){return dt.shape}),outputShapes:D.outputs.map(function(dt){return dt.shape})}),D.built=!0,D._refCount=1,D}return e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){var t,r,a,i;this.assertNotDisposed();var o={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.numDisposedVariables+=c.dispose().numDisposedVariables}}catch(d){t={error:d}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}try{for(var l=fe(this.internalContainerRefs),f=l.next();!f.done;f=l.next()){var h=f.value;o.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(d){a={error:d}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}}return o.refCountAfterDispose=this._refCount,o},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(r){r._trainableWeights.forEach(function(a){return a.trainable=t})}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,r;if(this._trainableWeights.length>0)throw new J("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value;a=a.concat(s.trainableWeights)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,r,a,i,o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Qe([],te(c.nonTrainableWeights),!1))}}catch(d){t={error:d}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.layers),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Qe([],te(c.trainableWeights),!1))}}catch(d){a={error:d}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.loadWeights=function(t,r){var a,i,o,s;r===void 0&&(r=!0);var u={},c=0;try{for(var l=fe(this.layers),f=l.next();!f.done;f=l.next()){var h=f.value;try{for(var d=(o=void 0,fe(h.weights)),p=d.next();!p.done;p=d.next()){var v=p.value;if(u[v.originalName]!=null)throw new J("Duplicate weight name: ".concat(v.originalName));u[v.originalName]=v,c++}}catch(N){o={error:N}}finally{try{p&&!p.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}}}catch(N){a={error:N}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}var m=[];for(var g in t){var y=g;if(u[g]==null){var b=g.split("/"),w=b.slice(0,-2).concat([b[b.length-1]]);y=w.join("/")}if(u[y]!=null)m.push([u[y],t[g]]);else if(r)throw new J("Provided weight data has no target variable: ".concat(g));delete u[y]}if(r){var x=[];for(var g in u)x.push(g);if(x.length>0)throw new J("".concat(x.length," of ").concat(c," weights are not set: ")+"".concat(x))}nb(m)},e.prototype.updatedConfig=function(){var t=this.getConfig(),r={};return r.className=this.getClassName(),r.config=t,r.kerasVersion="tfjs-layers ".concat(Ob),r.backend="TensorFlow.js",r},e.prototype.toJSON=function(t,r){r===void 0&&(r=!0);var a=Vy(this.updatedConfig());return r?JSON.stringify(a):a},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=Yt(t);for(var i=new sc,o=0;o<a.inputs.length;++o)i.add(a.inputs[o],t[o]);return yf(a.outputs,i,r)})},e.prototype.computeMask=function(t,r){var a=this;return R.tidy(function(){t=Yt(t);var i;return r==null?i=Ms(null,t.length):i=Yt(r),a.runInternalGraph(t,i)[1]})},e.prototype.computeOutputShape=function(t){var r,a,i,o,s=Cp(t);if(s.length!==this.inputLayers.length)throw new J("Invalid inputShape argument ".concat(t,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var u={},c=0;c<s.length;c++){var l=this.inputLayers[c],f=s[c],h=l.name+"_0_0";u[h]=f}var d=Object.keys(this.nodesByDepth).map(function(W){return parseInt(W,10)}).sort(bp);if(d.length>1)try{for(var p=fe(d),v=p.next();!v.done;v=p.next()){var m=v.value,g=this.nodesByDepth[m];try{for(var y=(i=void 0,fe(g)),b=y.next();!b.done;b=y.next()){var w=b.value,l=w.outboundLayer;if(this.inputLayers.map(function(X){return X.id}).indexOf(l.id)===-1){for(var x=[],N=0;N<w.inboundLayers.length;N++){var T=w.inboundLayers[N],E=w.nodeIndices[N],C=w.tensorIndices[N],h="".concat(T.name,"_").concat(E,"_").concat(C),F=u[h];x.push(F)}for(var D=l.computeOutputShape(Ir(x)),O=Cp(D),L=l.inboundNodes.indexOf(w),N=0;N<O.length;N++){var h="".concat(l.name,"_").concat(L,"_").concat(N);u[h]=O[N]}}}}catch(W){i={error:W}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(W){r={error:W}}finally{try{v&&!v.done&&(a=p.return)&&a.call(p)}finally{if(r)throw r.error}}for(var z=[],$=[],c=0;c<this.outputLayers.length;c++){var l=this.outputLayers[c],L=this.outputLayersNodeIndices[c],C=this.outputLayersTensorIndices[c],h="".concat(l.name,"_").concat(L,"_").concat(C);$.push(h)}for(var c=0;c<$.length;c++){var B=$[c];_i(B in u),z.push(u[B])}return Ir(z)},e.prototype.runInternalGraph=function(t,r){var a,i,o,s,u,c,l,f;r==null&&(r=Ms(null,t.length));for(var h={},d=0;d<this.inputs.length;++d){var p=this.inputs[d],v=t[d],m=r[d];h[p.id]=[v,m]}var g=Object.keys(this.nodesByDepth).map(function(we){return parseInt(we,10)}).sort(bp);try{for(var y=fe(g),b=y.next();!b.done;b=y.next()){var w=b.value,x=this.nodesByDepth[w];try{for(var N=(o=void 0,fe(x)),T=N.next();!T.done;T=N.next()){var E=T.value,C=E.outboundLayer,F=E.inputTensors,D=E.outputTensors,O=new Array;try{for(var L=(u=void 0,fe(F)),z=L.next();!z.done;z=L.next()){var p=z.value;p.id in h&&O.push(h[p.id])}}catch(we){u={error:we}}finally{try{z&&!z.done&&(c=L.return)&&c.call(L)}finally{if(u)throw u.error}}if(O.length===F.length){var $={},B=void 0,W=void 0,X=void 0,Z=void 0;if(E.callArgs!=null&&($=E.callArgs),O.length===1){var V=te(O[0],2),j=V[0],re=V[1];$.mask==null&&($.mask=re),X=Yt(C.call(j,$)),Z=Yt(C.computeMask(j,re)),B=[j],W=[re]}else B=O.map(function(we){return we[0]}),W=O.map(function(we){return we[1]}),$.mask==null&&($.mask=W),X=Yt(C.call(B,$)),Z=Yt(C.computeMask(B,W));if(C.activityRegularizer)throw new pt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var d=0;d<D.length;++d){var p=D[d],v=X[d],m=Z[d];h[p.id]=[v,m]}}}}catch(we){o={error:we}}finally{try{T&&!T.done&&(s=N.return)&&s.call(N)}finally{if(o)throw o.error}}}}catch(we){a={error:we}}finally{try{b&&!b.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}var ne=[],oe=[],le=[];try{for(var pe=fe(this.outputs),xe=pe.next();!xe.done;xe=pe.next()){var p=xe.value;_i(p.id in h,"Could not compute output ".concat(p.name," : ").concat(p.id));var he=te(h[p.id],2),ye=he[0],m=he[1];le.push(ye.shape),ne.push(ye),oe.push(m)}}catch(we){l={error:we}}finally{try{xe&&!xe.done&&(f=pe.return)&&f.call(pe)}finally{if(l)throw l.error}}return[ne,oe,le]},e.prototype.buildNodeConversionMap=function(t){var r,a,i={},o;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o=c instanceof e?1:0;for(var l=0;l<c.inboundNodes.length;l++){var f=e.nodeKey(c,l);this.containerNodes.has(f)&&(i[f]=o,o+=1)}}}catch(h){r={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}return i},e.prototype.getLayer=function(t,r){var a,i;if(r!=null){if(this.layers.length<=r)throw new J("Was asked to retrieve layer at index ".concat(r,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[r]}else if(t==null)throw new J("Provide either a layer name or layer index");try{for(var o=fe(this.layers),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.name===t)return u}}catch(c){a={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}throw new J("No such layer: ".concat(t))},e.prototype.calculateLosses=function(){var t=this;return R.tidy(function(){var r,a,i=[];try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next())for(var u=s.value,c=0;c<u.inboundNodes.length;++c){var l=e.nodeKey(u,c);t.containerNodes.has(l)&&i.push.apply(i,Qe([],te(u.calculateLosses()),!1))}}catch(f){r={error:f}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return i})},e.prototype.getConfig=function(){var t,r,a={name:this.name},i=this.buildNodeConversionMap(this.layers),o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=c.getClassName(),f=c.getConfig(),h=[],d=0;d<c.inboundNodes.length;d++){var p=c.inboundNodes[d],v=e.nodeKey(c,d),m={};if(this.containerNodes.has(v)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn("Layer ".concat(c.name," was passed ")+"non-serializable keyword arguments: "+"".concat(p.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),m={}}if(p.inboundLayers.length>0){for(var g=[],y=0;y<p.inboundLayers.length;y++){var b=p.inboundLayers[y],w=p.nodeIndices[y],x=p.tensorIndices[y],N=e.nodeKey(b,w),T=i[N];T==null&&(T=0),g.push([b.name,T,x,m])}h.push(g)}}}var E={};E.name=c.name,E.className=l,E.config=f,E.inboundNodes=h,o.push(E)}}catch(D){t={error:D}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}a.layers=o;for(var C=[],y=0;y<this.inputLayers.length;y++){var c=this.inputLayers[y],w=this.inputLayersNodeIndices[y],v=e.nodeKey(c,w);if(!!this.containerNodes.has(v)){var T=i[v];T==null&&(T=0);var x=this.inputLayersTensorIndices[y];C.push([c.name,T,x])}}a.inputLayers=C;for(var F=[],y=0;y<this.outputLayers.length;y++){var c=this.outputLayers[y],w=this.outputLayersNodeIndices[y],v=e.nodeKey(c,w);if(!!this.containerNodes.has(v)){var T=i[v];T==null&&(T=0);var x=this.outputLayersTensorIndices[y];F.push([c.name,T,x])}}return a.outputLayers=F,a},e.fromConfig=function(t,r,a,i){var o,s,u,c,l,f,h,d,p,v;i===void 0&&(i=!1);var m={},g={};function y(ye,we){ye.name in g?g[ye.name].push(we):g[ye.name]=[we]}function b(ye,we){var Ae,Ye,ht=[],at;try{for(var rt=fe(we),ft=rt.next();!ft.done;ft=rt.next()){var st=ft.value,Ze=st[0],tt=st[1],et=st[2];if(at=st[3]==null?{}:st[3],!(Ze in m)){y(ye,we);return}var rn=m[Ze];if(rn.inboundNodes.length<=tt){y(ye,we);return}var He=rn.inboundNodes[tt];ht.push(He.outputTensors[et])}}catch(kt){Ae={error:kt}}finally{try{ft&&!ft.done&&(Ye=rt.return)&&Ye.call(rt)}finally{if(Ae)throw Ae.error}}ht.length>0&&ye.apply(Ir(ht),at)}function w(ye){var we=ye.name,Ae=ci(ye,r.customObjects!=null?r.customObjects:{});Ae.setFastWeightInitDuringBuild(i),m[we]=Ae;var Ye=ye.inboundNodes;Ye.forEach(function(ht){if(!(ht instanceof Array))throw new J("Corrupted configuration, expected array for nodeData: ".concat(ht));y(Ae,ht)})}var x=r.name,N=r.layers;try{for(var T=fe(N),E=T.next();!E.done;E=T.next()){var C=E.value;w(C)}}catch(ye){o={error:ye}}finally{try{E&&!E.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}for(;!cfe(g);)try{for(var F=(u=void 0,fe(N)),D=F.next();!D.done;D=F.next()){var C=D.value,O=m[C.name];if(O.name in g){var L=g[O.name];delete g[O.name];try{for(var z=(l=void 0,fe(L)),$=z.next();!$.done;$=z.next()){var B=$.value;b(O,B)}}catch(we){l={error:we}}finally{try{$&&!$.done&&(f=z.return)&&f.call(z)}finally{if(l)throw l.error}}}}}catch(ye){u={error:ye}}finally{try{D&&!D.done&&(c=F.return)&&c.call(F)}finally{if(u)throw u.error}}var W=[],X=[],Z=r.inputLayers;try{for(var V=fe(Z),j=V.next();!j.done;j=V.next()){var C=j.value,re=C[0],ne=C[1],oe=C[2];_i(re in m);var O=m[re],le=O.inboundNodes[ne].outputTensors;W.push(le[oe])}}catch(ye){h={error:ye}}finally{try{j&&!j.done&&(d=V.return)&&d.call(V)}finally{if(h)throw h.error}}var pe=r.outputLayers;try{for(var xe=fe(pe),he=xe.next();!he.done;he=xe.next()){var C=he.value,re=C[0],ne=C[1],oe=C[2];_i(re in m);var O=m[re],le=O.inboundNodes[ne].outputTensors;X.push(le[oe])}}catch(ye){p={error:ye}}finally{try{he&&!he.done&&(v=xe.return)&&v.call(xe)}finally{if(p)throw p.error}}return new t({inputs:W,outputs:X,name:x})},Object.defineProperty(e.prototype,"stateful",{get:function(){var t,r;if(this._stateful)throw new J("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var a=fe(this.layers),i=a.next();!i.done;i=a.next()){var o=i.value;if(o.stateful)return!0}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return!1},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){var t=this;R.tidy(function(){t.layers.forEach(function(r){r.stateful&&r.resetStates()})})},e}(gt);function Lye(n,e,t){var r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(function(i){return null});if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error("Provided ".concat(t," is an array of ").concat(n.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){var a=[];return e.forEach(function(i){i in n?a.push(n[i]):a.push(null)}),a}else throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(t," must be either an array with ")+"".concat(r," elements or an object with ").concat(e," keys. ")+"Provided ".concat(t," not understood: ").concat(JSON.stringify(n)))}function SM(n,e){return Lye(n,e,"classWeight")}function NM(n,e,t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(e!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");return t==null?[3,2]:(a=R.tidy(function(){if(n.shape.length===1)return R.clone(n);if(n.shape.length===2)if(n.shape[1]>1){var l=1;return R.argMax(n,l)}else{if(n.shape[1]===1)return R.reshape(n,[n.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(n.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}else throw new Error("Unexpected rank of target (y) tensor (".concat(n.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),s=(o=Array).from,[4,a.data()]);case 1:return i=s.apply(o,[c.sent()]),R.dispose(a),u=[],i.forEach(function(l){if(t[l]==null)throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(l," exists in the data but not in ")+"classWeight");u.push(t[l])}),[2,R.tensor1d(u,"float32")];case 2:return[2,null]}})})}function zye(n,e){return R.mul(n,e)}var $ye=32;function TM(n,e){var t,r,a=e;t=a.xs,r=a.ys,_.util.assert(t!=null&&r!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(e)});var i=EO("input",n.inputNames,t),o=EO("output",n.outputNames,r),s=i[0].shape[0];_.util.assert(i.length===n.inputs.length,function(){return"LayersModel has ".concat(n.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(n.inputNames),")")}),_.util.assert(o.length===n.outputs.length,function(){return"LayersModel has ".concat(n.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(n.outputNames),")")});for(var u=function(h){_.util.assert(i[h].shape[0]===s,function(){return"Batch size mismatch: input "+"".concat(n.inputNames[h]," has ").concat(i[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(n.inputNames[0],".")})},c=0;c<i.length;c++)u(c);for(var l=function(h){_.util.assert(o[h].shape[0]===s,function(){return"Batch size mismatch: output "+"".concat(n.outputNames[h]," has ").concat(o[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(n.inputNames[0],".")})},f=0;f<o.length;f++)l(f);return{xs:i,ys:o}}function EO(n,e,t){var r,a;if(t instanceof _.Tensor)return[t];if(Array.isArray(t))return _.util.assert(t.length===e.length,function(){return"Received an array of ".concat(t.length," Tensors, but expected ").concat(e.length," to match the ").concat(n," keys ").concat(e,".")}),t;var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value;if(t[u]==null)throw new J("The feature data generated by the dataset lacks the required "+"".concat(n," key '").concat(u,"'."));i.push(t[u])}}catch(c){r={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return i}function qye(n){if(n.length===3)throw new pt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}function Wye(n,e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E,C,F,D,V,O,L,z,$,V,B,W,X,Z,V;return Ee(this,function(j){switch(j.label){case 0:if(r=t.batchesPerEpoch!=null,_.util.assert(n.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),_.util.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),_.util.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(t.epochs)}),_.util.assert(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(t.batchesPerEpoch)}),_.util.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0,j.label=1;case 1:return j.trys.push([1,,26,27]),a=t.validationData!=null,i=void 0,o=void 0,a&&(IO(t.validationData)?_.util.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(t.validationBatches)}):(s=qye(t.validationData),i=s.xs,o=s.ys)),u=n.makeTrainFunction(),c=n.getDedupedMetricsNames(),l=void 0,a?l=c.slice().concat(c.map(function(re){return"val_"+re})):l=c.slice(),f=vM(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,d=mM(f,h,t.epochs,null,null,Vye(e,t),null,a,l),p=d.callbackList,v=d.history,p.setModel(n),n.history=v,[4,p.onTrainBegin()];case 2:return j.sent(),n.stopTraining_=!1,m=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:g=j.sent(),j.label=4;case 4:return m<t.epochs?(y={},[4,p.onEpochBegin(m)]):[3,23];case 5:return j.sent(),b=0,w=0,r?[3,7]:[4,e.iterator()];case 6:g=j.sent(),j.label=7;case 7:return!r||b<t.batchesPerEpoch?[4,g.next()]:[3,21];case 8:return x=j.sent(),r&&x.done?(console.warn("You provided `batchesPerEpoch` as "+"".concat(t.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(b," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(t.batchesPerEpoch*t.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),[3,21]):x.value==null?[3,15]:(N=TM(n,x.value),T=N.xs,E=N.ys,C={},C.batch=w,C.size=T[0].shape[0],[4,p.onBatchBegin(w,C)]);case 9:if(j.sent(),F=[],t.classWeight==null)return[3,13];D=SM(t.classWeight,n.outputNames),V=0,j.label=10;case 10:return V<D.length?(L=(O=F).push,[4,NM(E[V],null,D[V])]):[3,13];case 11:L.apply(O,[j.sent()]),j.label=12;case 12:return++V,[3,10];case 13:for(z=T.concat(E).concat(F),$=u(z),_.dispose(z),V=0;V<c.length;++V)B=c[V],W=$[V],C[B]=W,_.keep(W);return[4,p.onBatchEnd(w,C)];case 14:j.sent(),fM(C),w++,b++,j.label=15;case 15:return(r?b>=t.batchesPerEpoch:x.done)?a?(X=void 0,IO(t.validationData)?(Z=Yt,[4,n.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return X=Z.apply(void 0,[j.sent()]),[3,18];case 17:X=Yt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?$ye:t.validationBatchSize,verbose:0})),j.label=18;case 18:for(V=0;V<n.metricsNames.length;++V)y["val_".concat(n.metricsNames[V])]=X[V];j.label=19;case 19:return[3,21];case 20:return n.stopTraining_?[3,21]:[3,7];case 21:return[4,p.onEpochEnd(m,y)];case 22:return j.sent(),m++,n.stopTraining_?[3,23]:[3,4];case 23:return[4,p.onTrainEnd()];case 24:return j.sent(),[4,n.history.syncData()];case 25:return j.sent(),[2,n.history];case 26:return n.isTraining=!1,[7];case 27:return[2]}})})}function Vye(n,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function IO(n){return typeof n.iterator=="function"}function Gye(n){return typeof n.next=="function"}function Uye(n,e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d;return Ee(this,function(p){switch(p.label){case 0:if(t=t||{},r=t.batches!=null,a=n.testFunction,i=[],t.verbose>0)throw new pt("Verbose mode is not implemented yet.");return _.util.assert(!r||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(t.batches))}),Gye(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=p.sent(),p.label=3;case 3:o=s,u=0,c=0,l=function(){var v;return Ee(this,function(m){switch(m.label){case 0:return[4,o.next()];case 1:return v=m.sent(),i=_.tidy(function(){if(v.value){var g=TM(n,v.value),y=g.xs,b=g.ys,w=y.concat(b),x=_.tidy(function(){return a(w)});if(_.dispose(w),c===0)for(var N=0;N<x.length;++N)i.push(R.scalar(0));for(var T=w[0].shape[0],E=function(C){var F=x[C],D=i[C];i[C]=_.tidy(function(){return _.add(i[C],_.mul(T,F))}),c>0&&_.dispose(D)},N=0;N<x.length;++N)E(N);_.dispose(x),u+=T,++c}return i}),v.done?(r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(t.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},p.label=4;case 4:return!r||c<t.batches?[5,l()]:[3,6];case 5:return f=p.sent(),f==="break"?[3,6]:[3,4];case 6:for(h=0;h<i.length;++h)d=i[h],i[h]=_.div(i[h],u),_.dispose(d);return[2,Ir(i)]}})})}function Ny(n){_.util.assert(n>0&&Number.isInteger(n),function(){return"batchSize is required to be a positive integer, but got ".concat(n)})}function mf(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(function(r){return Ps(r,e,t-e)}):Ps(n,e,t-e)}function Gy(n,e){return _.tidy(function(){return n==null?null:Array.isArray(n)?n.map(function(t){return Gy(t,e)}):GO(n,e.dtype==="int32"?e:_.cast(e,"int32"))})}function Ty(n,e){for(var t=[],r=0,a=null;r<n;)a=r+e,a>=n&&(a=n),t.push([r,a]),r=a;return t}function EM(n){var e=[];n instanceof R.Tensor&&(n=[n]);for(var t=0;t<n.length;++t){var r=n[t];if(r.rank===1)e.push(Af(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function oi(n,e){if(n!=null){var t=[];if(e instanceof R.Tensor)t.push(e.id);else if(Array.isArray(e))e.forEach(function(s){return t.push(s.id)});else if(e!=null)for(var r in e){var a=e[r];t.push(a.id)}var i=[];if(n instanceof R.Tensor)t.indexOf(n.id)===-1&&i.push(n);else if(Array.isArray(n))n.forEach(function(s){t.indexOf(s.id)===-1&&i.push(s)});else if(n!=null)for(var r in n){var o=n[r];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(function(s){s.isDisposed||s.dispose()})}}function Hye(n){return n instanceof R.Tensor}function Uy(n){return Array.isArray(n)}function CO(n){return!Hye(n)&&!Uy(n)}function AO(n,e,t,r,a){var i,o;if(r===void 0&&(r=!0),a===void 0&&(a=""),e==null||e.length===0){if(n!=null){var s=!1;if(Uy(n)&&n.length>0)s=!0;else if(CO(n)){for(var u in n)if(n.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new J("Error when checking model ".concat(a," expected no data, ")+"but got ".concat(n))}return[]}if(n==null)return e.map(function(y){return null});var c;if(CO(n)){n=n,c=[];try{for(var l=fe(e),f=l.next();!f.done;f=l.next()){var h=f.value;if(n[h]==null)throw new J('No data provided for "'.concat(h,'". Need data for each key in: ')+"".concat(e));c.push(n[h])}}catch(y){i={error:y}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}else if(Uy(n)){if(n=n,n.length!==e.length)throw new J("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(e.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(n));c=n}else{if(n=n,e.length>1)throw new J("The model ".concat(a," expects ").concat(e.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(n.shape));c=[n]}if(c=EM(c),t!=null){for(var d=0;d<e.length;++d)if(t[d]!=null){var p=c[d];if(p.shape.length!==t[d].length)throw new J("Error when checking ".concat(a,": expected ").concat(e[d]," ")+"to have ".concat(t[d].length," dimension(s). but got array with ")+"shape ".concat(p.shape));for(var v=0;v<t[d].length;++v)if(!(v===0&&!r)){var m=p.shape[v],g=t[d][v];if(g!=null&&g>=0&&m!==g)throw new J("".concat(a," expected a batch of elements where each ")+"example has shape [".concat(t[d].slice(1,t[d].length),"] ")+"(i.e.,tensor shape [*,".concat(t[d].slice(1,t[d].length),"])")+" but the ".concat(a," received an input with ").concat(p.shape[0])+" examples, each with shape [".concat(p.shape.slice(1,p.shape.length),"]")+" (tensor shape [".concat(p.shape,"])"))}}}return c}function Kye(n,e,t){var r=zo(n.map(function(i){return i.shape[0]}));r.sort();var a=zo(e.map(function(i){return i.shape[0]}));if(a.sort(),r.length>1)throw new J("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(n.map(function(i){return i.shape}))));if(a.length>1)throw new J("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(function(i){return i.shape}))));if(r.length>0&&a.length>0&&!R.util.arraysEqual(r,a))throw new J("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function jye(n,e,t){for(var r=[Hs,ov,Tf],a=0;a<n.length;++a){var i=n[a],o=e[a],s=t[a];if(o!=null){if(o===Tf&&i.shape[i.shape.length-1]===1)throw new J("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(r.indexOf(o)!==-1)for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var f=u[l],h=c[l];if(h!=null&&f!==h)throw new J("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function _O(n,e,t,r,a){r===void 0&&(r=!0),a===void 0&&(a="");var i;if(Array.isArray(n)){if(n.length!==e.length)throw new J("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(e.length," Tensor(s),")+" but instead got ".concat(n.length," Tensors(s)."));i=n}else{if(e.length>1)throw new J("The model expects ".concat(e.length," ").concat(a," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(n.shape),"."));i=[n]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var s=i[o];if(s.shape.length!==t[o].length)throw new J("Error when checking ".concat(a,": expected ").concat(e[o]," ")+"to have ".concat(t[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<t[o].length;++u)if(!(u===0&&!r)){var c=s.shape[u],l=t[o][u];if(l!=null&&l!==c)throw new J("Error when checking ".concat(a,": expected ")+"".concat(e[o]," to have shape ").concat(JSON.stringify(t[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}}function Xye(n,e){var t,r;if(n==null||Array.isArray(n)&&n.length===0)return e.map(function(l){return[]});var a;if(typeof n=="string"||typeof n=="function")a=[n];else if(Array.isArray(n)||typeof n=="object")a=n;else throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(n));if(Array.isArray(a))return e.map(function(l){return a});var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value,c=a.hasOwnProperty(u)?a[u]:[];Array.isArray(c)||(c=[c]),i.push(c)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i}var Yye="layers-model",no=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.isTraining=!1,r}return e.prototype.summary=function(t,r,a){if(a===void 0&&(a=console.log),!this.built)throw new J("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Fye(this,t,r,a)},e.prototype.compile=function(t){var r,a,i=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=Dye(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof R.Optimizer))throw new J("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var o=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(var s in t.loss)if(this.outputNames.indexOf(s)===-1)throw new J('Unknown entry in loss dictionary: "'.concat(s,'". ')+"Only expected the following keys: ".concat(this.outputNames));try{for(var u=fe(this.outputNames),c=u.next();!c.done;c=u.next()){var s=c.value;t.loss[s]==null&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(s," during training")),o.push(Sy(t.loss[s]))}}catch(g){r={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new J("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(t.loss,"."));var l=t.loss;o=l.map(function(g){return Sy(g)})}else{var f=Sy(t.loss);this.outputs.forEach(function(g){o.push(f)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var h=0;h<this.outputs.length;++h){var d=this.internalOutputShapes[h],s=this.outputNames[h];this.feedOutputNames.push(s),this.feedOutputShapes.push(d),this.feedLossFns.push(this.lossFunctions[h])}var p=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Os("loss",function(){for(var g=0;g<i.outputs.length;++g)if(p.indexOf(g)===-1){var y=i.lossFunctions[g];i.outputs.length>1&&(i.metricsTensors.push([y,g]),i.metricsNames.push(i.outputNames[g]+"_loss"))}});var v=Xye(t.metrics,this.outputNames),m=function(g,y,b){i.outputNames.length>1&&(y=i.outputNames[g]+"_"+y),i.metricsNames.push(y),i.metricsTensors.push([b,g])};Os("metric",function(){for(var g=function(b){if(p.indexOf(b)!==-1)return"continue";var w=v[b],x=function(N){var T,E,C="",F,D,O,L=function(W){if(typeof W=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(W)!==-1){var X=i.internalOutputShapes[b];X[X.length-1]===1||i.lossFunctions[b]===ov?["accuracy","acc"].indexOf(W)!==-1?D=Db:["crossentropy","ce"].indexOf(W)!==-1&&(D=bM):i.lossFunctions[b]===Wp?["accuracy","acc"].indexOf(W)!==-1?D=wM:["crossentropy","ce"].indexOf(W)!==-1&&(D=xM):["accuracy","acc"].indexOf(W)!==-1?D=Fb:["crossentropy","ce"].indexOf(W)!==-1&&(D=Rb);var Z=void 0;["accuracy","acc"].indexOf(W)!==-1?Z="acc":["crossentropy","ce"].indexOf(W)!==-1&&(Z="ce"),O=D,F=C+Z}else{var V=_ye(W);O=V,F=C+kp(W)}var j;Os(F,function(){j=O}),m(b,F,j)};try{for(var z=(T=void 0,fe(N)),$=z.next();!$.done;$=z.next()){var B=$.value;L(B)}}catch(W){T={error:W}}finally{try{$&&!$.done&&(E=z.return)&&E.call(z)}finally{if(T)throw T.error}}};x(w)},y=0;y<i.outputs.length;++y)g(y)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,r,a){a===void 0&&(a={});var i=a.batchSize==null?32:a.batchSize;Ny(i);var o=!0,s=this.standardizeUserDataXY(t,r,o,i);try{var u=s[0].concat(s[1]);this.makeTestFunction();var c=this.testFunction,l=this.testLoop(c,u,i,a.verbose,a.steps);return Ir(l)}finally{oi(s[0],t),oi(s[1],r)}},e.prototype.evaluateDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return this.makeTestFunction(),[2,Uye(this,t,r)]})})},e.prototype.checkNumSamples=function(t,r,a,i){i===void 0&&(i="steps");var o;if(a!=null){if(o=null,r!=null)throw new J("If ".concat(i," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(r))}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new J("Either the input data should have a defined shape, or "+"".concat(i," shoud be specified."));return o},e.prototype.execute=function(t,r){var a,i;if(Array.isArray(r)&&r.length===0)throw new J("`outputs` is an empty Array, which is not allowed.");var o=Array.isArray(r),s=o?r:[r],u=this.retrieveSymbolicTensors(s),c=new sc;if(t instanceof R.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new J("The number of inputs provided (".concat(t.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var l=0;l<this.inputs.length;++l)c.add(this.inputs[l],t[l])}else try{for(var f=fe(this.inputs),h=f.next();!h.done;h=f.next()){var d=h.value,p=t[d.name];if(p==null)throw new J("No value is provided for the model's input ".concat(d.name));c.add(d,p)}}catch(m){a={error:m}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var v=yf(u,c);return o?v:v[0]},e.prototype.retrieveSymbolicTensors=function(t){var r,a,i=Ms(null,t.length),o=t.length;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=Array.isArray(c.output)?c.output:[c.output],f=l.map(function(v){return v.name}),h=0;h<t.length;++h){var d=f.indexOf(t[h]);if(d!==-1&&(i[h]=l[d],o--),o===0)break}if(o===0)break}}catch(v){r={error:v}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}if(o>0){var p=[];throw i.forEach(function(v,m){v==null&&p.push(t[m])}),new J("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(p)))}return i},e.prototype.predictLoop=function(t,r,a){var i=this;return r===void 0&&(r=32),a===void 0&&(a=!1),_.tidy(function(){var o=i.checkNumSamples(t);if(a)throw new pt("Verbose predictLoop() is not implemented yet.");for(var s=Ty(o,r),u=i.outputs.map(function(f){return[]}),c=function(f){var h=_.tidy(function(){var d=s[f][0],p=s[f][1],v=mf(t,d,p),m=[];if(Array.isArray(v))for(var g=0;g<v.length;++g)m.push({key:i.inputs[g],value:v[g]});else m.push({key:i.inputs[0],value:v});var y=new sc(m);return yf(i.outputs,y)});h.forEach(function(d,p){return u[p].push(d)})},l=0;l<s.length;++l)c(l);return Ir(u.map(function(f){return _.concat(f,0)}))})},e.prototype.predict=function(t,r){r===void 0&&(r={});var a=EM(t);_O(a,this.inputNames,this.feedInputShapes,!1);try{var i=r.batchSize==null?32:r.batchSize;return Ny(i),this.predictLoop(a,i)}finally{oi(a,t)}},e.prototype.predictOnBatch=function(t){_O(t,this.inputNames,this.feedInputShapes,!0);var r=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,r)},e.prototype.standardizeUserDataXY=function(t,r,a,i){if(this.optimizer_==null)throw new Fi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s],c=this.feedLossFns[s];c===Wp?o.push(u.slice(0,u.length-1).concat([1])):o.push(u)}if(t=AO(t,this.feedInputNames,this.feedInputShapes,!1,"input"),r=AO(r,this.feedOutputNames,o,!1,"target"),Kye(t,r),jye(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new J("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(i,". Found: ").concat(t[0].shape[0]," sample(s)."));return[t,r]},e.prototype.standardizeUserData=function(t,r,a,i,o,s){return o===void 0&&(o=!0),Ce(this,void 0,void 0,function(){var u,c,l,f,h,d,p,v;return Ee(this,function(m){switch(m.label){case 0:if(u=te(this.standardizeUserDataXY(t,r,o,s),2),c=u[0],l=u[1],a!=null)throw new Error("sample weight is not supported yet.");if(f=null,i==null)return[3,4];h=SM(i,this.outputNames),f=[],d=0,m.label=1;case 1:return d<h.length?(v=(p=f).push,[4,NM(l[d],null,h[d])]):[3,4];case 2:v.apply(p,[m.sent()]),m.label=3;case 3:return++d,[3,1];case 4:return[2,[c,l,f]]}})})},e.prototype.testLoop=function(t,r,a,i,o){var s=this;return i===void 0&&(i=0),_.tidy(function(){var u=s.checkNumSamples(r,a,o,"steps"),c=[];if(i>0)throw new pt("Verbose mode is not implemented yet.");if(o!=null)throw new pt("steps mode in testLoop() is not implemented yet");for(var l=Ty(u,a),f=R.tensor1d(fi(0,u)),h=0;h<l.length;++h){var d=l[h][0],p=l[h][1],v=Ps(f,d,p-d),m=Gy(r,v),g=t(m);if(h===0)for(var y=0;y<g.length;++y)c.push(R.scalar(0));for(var y=0;y<g.length;++y){var b=g[y];c[y]=_.add(c[y],_.mul(p-d,b))}}for(var y=0;y<c.length;++y)c[y]=_.div(c[y],u);return c})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,r=[],a=0;a<t.length;++a){var i=t[a],o=i;if(MR(t,i)>1){var s=MR(t.slice(0,a),i);o+="_".concat(s)}r.push(o)}return r},e.prototype.makeTrainFunction=function(){var t=this;return function(r){var a=[],i=r.slice(0,t.inputs.length),o=r.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=r.slice(t.inputs.length+t.outputs.length,t.inputs.length+t.outputs.length*2),u=[],c=function(){for(var d=[],p=0;p<t.inputs.length;++p)d.push({key:t.inputs[p],value:i[p]});for(var v=new sc(d),m=yf(t.outputs,v,{training:!0}),g,p=0;p<t.lossFunctions.length;++p){var y=t.lossFunctions[p],b=y(o[p],m[p]);s[p]!=null&&(b=zye(b,s[p]));var w=_.mean(b);a.push(w),p===0?g=b:g=_.add(g,b)}for(var p=0;p<t.metricsTensors.length;++p){var x=void 0;if(t.outputs.length>1&&p<t.outputs.length)x=a[p];else{var N=t.metricsTensors[p][0],T=t.metricsTensors[p][1];x=_.mean(N(o[T],m[T]))}_.keep(x),u.push(x)}return g=_.mean(g),t.calculateLosses().forEach(function(E){g=_.add(g,E)}),g},l=t.collectedTrainableWeights.map(function(d){return d.read()}),f=!0,h=t.optimizer_.minimize(c,f,l);return[h].concat(u)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(r){return _.tidy(function(){for(var a=[],i,o=r.slice(0,t.inputs.length),s=r.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=[],c=0;c<t.inputs.length;++c)u.push({key:t.inputs[c],value:o[c]});for(var l=new sc(u),f=yf(t.outputs,l),c=0;c<t.lossFunctions.length;++c){var h=t.lossFunctions[c],d=_.mean(h(s[c],f[c]));c===0?i=d:i=_.add(i,d),a.push(i)}for(var c=0;c<t.metricsTensors.length;++c){var p=t.metricsTensors[c][0],v=t.metricsTensors[c][1],m=_.mean(p(s[v],f[v]));a.push(m)}return a})}},e.prototype.fit=function(t,r,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E,C,F,D,O,L;return Ee(this,function(z){switch(z.label){case 0:if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0,z.label=1;case 1:return z.trys.push([1,,7,8]),p=a.batchSize==null?32:a.batchSize,Ny(p),v=!1,[4,this.standardizeUserData(t,r,a.sampleWeight,a.classWeight,v,p)];case 2:if(m=z.sent(),i=m[0],o=m[1],d=m[2],g=!1,y=void 0,!(a.validationData!=null&&a.validationData.length>0))return[3,4];if(g=!0,a.validationData.length===2)c=a.validationData[0],l=a.validationData[1];else throw a.validationData.length===3?new pt("validationData including sample weights is not supported yet."):new J("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));return b=!0,[4,this.standardizeUserData(c,l,null,null,b,p)];case 3:return w=z.sent(),f=w[0],h=w[1],y=f.concat(h),[3,5];case 4:a.validationSplit!=null&&a.validationSplit>0&&a.validationSplit<1?(g=!0,x=Math.floor(i[0].shape[0]*(1-a.validationSplit)),N=i[0].shape[0],f=mf(i,x,N),s=i,i=mf(i,0,x),h=mf(o,x,N),u=o,o=mf(o,0,x),y=f.concat(h)):a.validationSteps!=null&&(g=!0),z.label=5;case 5:return T=i.concat(o).concat(d),this.checkTrainableWeightsConsistency(),E=this.makeTrainFunction(),C=this.getDedupedMetricsNames(),F=void 0,D=void 0,g?(this.makeTestFunction(),F=this.testFunction,D=C.slice().concat(C.map(function($){return"val_"+$}))):(F=null,y=[],D=C.slice()),O=vM(a.callbacks,a.yieldEvery),[4,this.fitLoop(E,T,C,p,a.epochs,a.verbose,O,F,y,a.shuffle,D,a.initialEpoch,null,null)];case 6:return L=z.sent(),[2,L];case 7:return this.isTraining=!1,oi(i,t),oi(o,r),oi(s,t),oi(u,r),oi(f,c),oi(h,l),d!=null&&_.dispose(d),[7];case 8:return[2]}})})},e.prototype.fitLoop=function(t,r,a,i,o,s,u,c,l,f,h,d,p,v){return Ce(this,void 0,void 0,function(){var m,g,y,b,w,x,N,T,E,C,F=this;return Ee(this,function(D){switch(D.label){case 0:if(i==null&&(i=32),o==null&&(o=1),f==null&&(f=!0),d==null&&(d=0),m=!1,c!=null&&l!=null&&(m=!0),v!=null&&(m=!0,p==null))throw new J("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return g=this.checkNumSamples(r,i,p,"steps_per_epoch"),g!=null&&(y=fi(0,g)),s==null&&(s=1),b=mM(u,s,o,d,g,p,i,m,h),w=b.callbackList,x=b.history,w.setModel(this),this.history=x,[4,w.onTrainBegin()];case 1:D.sent(),this.stopTraining_=!1,N=function(O){var L,z,$,B,W,X;return Ee(this,function(Z){switch(Z.label){case 0:return[4,w.onEpochBegin(O)];case 1:if(Z.sent(),L={},p==null)return[3,2];throw new pt("stepsPerEpoch mode is not implemented yet.");case 2:if(f==="batch")throw new pt("batch shuffling is not implemneted yet");f&&R.util.shuffle(y),z=R.tensor1d(y),$=Ty(g,i),B=function(V){var j;return Ee(this,function(re){switch(re.label){case 0:return j={},[4,w.onBatchBegin(V,j)];case 1:return re.sent(),_.tidy(function(){var ne=$[V][0],oe=$[V][1],le=Ps(z,ne,oe-ne);j.batch=V,j.size=oe-ne;for(var pe=Gy(r,le),xe=t(pe),he=0;he<a.length;++he){var ye=a[he],we=xe[he];j[ye]=we,_.keep(we)}if(V===$.length-1&&m)for(var Ae=F.testLoop(c,l,i),he=0;he<a.length;++he){var ye=a[he],we=Ae[he];_.keep(we),L["val_"+ye]=we}}),[4,w.onBatchEnd(V,j)];case 2:return re.sent(),fM(j),T.stopTraining_?[2,"break"]:[2]}})},W=0,Z.label=3;case 3:return W<$.length?[5,B(W)]:[3,6];case 4:if(X=Z.sent(),X==="break")return[3,6];Z.label=5;case 5:return++W,[3,3];case 6:z.dispose(),Z.label=7;case 7:return[4,w.onEpochEnd(O,L)];case 8:return Z.sent(),T.stopTraining_?[2,"break"]:[2]}})},T=this,E=d,D.label=2;case 2:return E<o?[5,N(E)]:[3,5];case 3:if(C=D.sent(),C==="break")return[3,5];D.label=4;case 4:return++E,[3,2];case 5:return[4,w.onTrainEnd()];case 6:return D.sent(),[4,this.history.syncData()];case 7:return D.sent(),[2,this.history]}})})},e.prototype.fitDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,Wye(this,t,r)]})})},e.prototype.trainOnBatch=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,d,p,v,m;return Ee(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(t,r)];case 1:a=g.sent(),i=a[0],o=a[1],s=this.makeTrainFunction(),u=s(i.concat(o)),c=[],g.label=2;case 2:g.trys.push([2,7,8,9]),l=fe(u),f=l.next(),g.label=3;case 3:return f.done?[3,6]:(h=f.value,[4,h.data()]);case 4:d=g.sent(),c.push(d[0]),g.label=5;case 5:return f=l.next(),[3,3];case 6:return[3,9];case 7:return p=g.sent(),v={error:p},[3,9];case 8:try{f&&!f.done&&(m=l.return)&&m.call(l)}finally{if(v)throw v.error}return[7];case 9:return _.dispose(u),oi(a[0],t),oi(a[1],r),[2,Ir(c)]}})})},e.prototype.getNamedWeights=function(t){for(var r=[],a=t!=null&&t.trainableOnly,i=a?this.trainableWeights:this.weights,o=this.getWeights(a),s=0;s<i.length;++s)a&&!i[s].trainable||r.push({name:i[s].originalName,tensor:o[s]});return r},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var t=n.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var r=_.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=r-_.memory().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t,r,a,i,o;if(typeof this.loss=="string")o=to(this.loss);else if(Array.isArray(this.loss)){try{for(var s=fe(this.loss),u=s.next();!u.done;u=s.next()){var c=u.value;if(typeof c!="string")throw new Error("Serialization of non-string loss is not supported.")}}catch(v){t={error:v}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}o=this.loss.map(function(v){return to(v)})}else{var l=Object.keys(this.loss);o={};var f=this.loss;try{for(var h=fe(l),d=h.next();!d.done;d=h.next()){var p=d.value;if(typeof f[p]=="string")o[p]=to(f[p]);else throw new Error("Serialization of non-string loss is not supported.")}}catch(v){a={error:v}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}}return o},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[to(kp(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(a){return to(kp(a))});var t={};for(var r in this.metrics)t[r]=to(kp(this.metrics[r]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var r=Ef(t.optimizer_config),a=ci(r),i;if(typeof t.loss=="string")i=Fs(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(function(u){return Fs(u)});else if(t.loss!=null){i={};for(var o in t.loss)i[o]=Fs(t.loss[o])}var s;if(Array.isArray(t.metrics))s=t.metrics.map(function(u){return Fs(u)});else if(t.metrics!=null){s={};for(var o in t.metrics)s[o]=Fs(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:a})},e.prototype.save=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,d,p,v,m,g,y;return Ee(this,function(b){switch(b.label){case 0:if(typeof t=="string"){if(a=R.io.getSaveHandlers(t),a.length===0)throw new J("Cannot find any save handlers for URL '".concat(t,"'"));if(a.length>1)throw new J("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(t,"'"));t=a[0]}if(t.save==null)throw new J("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,R.io.encodeWeights(this.getNamedWeights(r))];case 1:return i=b.sent(),o=!1,s=null,u=this.toJSON(s,o),c={modelTopology:u,format:Yye,generatedBy:"TensorFlow.js tfjs-layers v".concat(Ob),convertedBy:null},l=r==null?!1:r.includeOptimizer,l&&this.optimizer!=null?(c.trainingConfig=this.getTrainingConfig(),f="optimizer",m=(v=R.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,m.apply(v,[b.sent(),f])];case 3:h=b.sent(),d=h.data,p=h.specs,(y=i.specs).push.apply(y,Qe([],te(p),!1)),i.data=R.io.concatenateArrayBuffers([i.data,d]),b.label=4;case 4:return this.userDefinedMetadata!=null&&(g=!0,TO(this.userDefinedMetadata,this.name,g),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=i.data,c.weightSpecs=i.specs,[2,t.save(c)]}})})},e.prototype.setUserDefinedMetadata=function(t){TO(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e}(Bye);no.className="Model";R.serialization.registerClass(no);var IM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(no);IM.className="Functional";R.serialization.registerClass(IM);function Zye(n,e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:return"modelTopology"in n||(n={modelTopology:n}),n=n,t=n.modelTopology,t.model_config!=null&&(t=t.model_config),r=Ef(t),a=ci(r,e),n.weightsManifest==null?[3,2]:[4,R.io.loadWeights(n.weightsManifest,n.pathPrefix,a.weights.map(function(d){return d.originalName}))];case 1:i=h.sent(),o={};try{for(s=fe(a.weights),u=s.next();!u.done;u=s.next())c=u.value,o[c.originalName]=i[c.originalName]}catch(d){l={error:d}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(l)throw l.error}}a.loadWeights(o),R.dispose(i),h.label=2;case 2:return[2,a]}})})}function Jye(n,e){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){if(e==null&&(e={}),typeof n=="string"){if(t=R.io.getLoadHandlers(n,e),t.length===0)t.push(R.io.browserHTTPRequest(n,e));else if(t.length>1)throw new J("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat(n,"'"));n=t[0]}return[2,Qye(n,void 0,e)]})})}function Qye(n,e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:if(t==null&&(t={}),n.load==null)throw new J("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,n.load()];case 1:if(r=h.sent(),a=r.modelTopology,a.model_config!=null&&(a=a.model_config),i=t.strict==null?!0:t.strict,o=r.weightData!=null&&r.weightSpecs!=null&&i,s=ci(Ef(a),e,o),u=r.trainingConfig,u!=null&&s.loadTrainingConfig(u),r.userDefinedMetadata!=null&&s.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData==null)return[3,4];if(r.weightSpecs==null)throw new J("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return c=ebe(r.weightData,r.weightSpecs),l=c.modelWeights,f=c.optimizerWeights,s.loadWeights(l,i),s.optimizer!=null&&f.length>0?[4,s.optimizer.setWeights(f)]:[3,3];case 2:h.sent(),h.label=3;case 3:R.dispose(l),R.dispose(f.map(function(d){return d.tensor})),h.label=4;case 4:return[2,s]}})})}function ebe(n,e){var t=R.io.decodeWeights(n,e),r={},a=[];return e.forEach(function(i){i.group==="optimizer"?a.push({name:i.name,tensor:t[i.name]}):r[i.name]=t[i.name]}),{modelWeights:r,optimizerWeights:a}}var sv=function(n){se(e,n);function e(t){var r,a,i=n.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},i.trainable=!0,i.built=!1,i.name=t.name!=null?t.name:Hp("sequential_"),t.layers!=null)try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next()){var u=s.value;i.add(u)}}catch(c){r={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return i}return e.prototype.checkShape=function(t){var r=t.inboundNodes[0].outputTensors[0].shape;if(r.some(function(a){return a<0}))throw new J("Negative dimension size caused by adding layer "+"".concat(t.name," with input shape [")+"".concat(t.inboundNodes[0].inputTensors[0].shape,"]"))},e.prototype.add=function(t){var r=t instanceof e||t instanceof no,a;if(r){if(a=t,a.outputs.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(a.inputs.length!==1)throw new J("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new J("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=jO({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(r)this.outputs=a.outputs,this.inputs=a.inputs;else{if(t.inboundNodes.length!==1)throw new J("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(t.name," ")+"which has ".concat(t.inboundNodes.length," pre-existing inbound ")+"connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=KO(this.outputs[0])}this.inboundNodes=[],new tv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ms(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,r){return this.model==null&&this.build(),this.model.call(t,r)},e.prototype.build=function(t){if(It(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new no({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),n.prototype.countParams.call(this)},e.prototype.summary=function(t,r,a){a===void 0&&(a=console.log),this.built||this.build(),n.prototype.summary.call(this,t,r,a)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,r,a){if(a===void 0&&(a={}),!this.built)throw new Fi("The model needs to be compiled before being used.");return this.model.evaluate(t,r,a)},e.prototype.evaluateDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new Fi("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,r)]})})},e.prototype.predict=function(t,r){return r===void 0&&(r={}),this.model==null&&this.build(),this.model.predict(t,r)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!1,configurable:!0}),e.prototype.fit=function(t,r,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){return Ee(this,function(i){if(!this.built)throw new Fi("The model needs to be compiled before being used.");return[2,this.model.fit(t,r,a)]})})},e.prototype.fitDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new Fi("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,r)]})})},e.prototype.trainOnBatch=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,this.model.trainOnBatch(t,r)]})})},e.fromConfig=function(t,r,a,i){var o,s;i===void 0&&(i=!1);var u,c={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new J("Legacy serialization format not supported yet.");u=r}else R.util.assert(r.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),u=r.layers,delete r.layers,c=r;var l=new t(c);if(!(l instanceof e))throw new pt("Sequential.fromConfig called on non-Sequential input: ".concat(l));try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var d=h.value,p=void 0,v=ci(d,p,i);i&&v.setFastWeightInitDuringBuild(!0),l.add(v)}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return l},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new J("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new J("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!1,configurable:!0}),e.prototype.getConfig=function(){var t,r,a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value,u={};u.className=s.getClassName(),u.config=s.getConfig(),a.push(u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return{name:this.name,layers:a}},e}(no);sv.className="Sequential";R.serialization.registerClass(sv);function tbe(n){return new no(n)}function nbe(n){return new sv(n)}function CM(n){return jO(n)}function rbe(n,e){Ab.registerCallbackConstructor(n,e)}var Ar=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(R.serialization.Serializable),AM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=1),Nfe(t,r)},e}(Ar);AM.className="elu";R.serialization.registerClass(AM);var _M=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.selu(t)},e}(Ar);_M.className="selu";R.serialization.registerClass(_M);var DM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.relu(t)},e}(Ar);DM.className="relu";R.serialization.registerClass(DM);var FM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return R.tidy(function(){return _.minimum(6,_.relu(t))})},e}(Ar);FM.className="relu6";R.serialization.registerClass(FM);var RM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return t},e}(Ar);RM.className="linear";R.serialization.registerClass(RM);var OM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.sigmoid(t)},e}(Ar);OM.className="sigmoid";R.serialization.registerClass(OM);var PM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return Efe(t)},e}(Ar);PM.className="hardSigmoid";R.serialization.registerClass(PM);var MM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.softplus(t)},e}(Ar);MM.className="softplus";R.serialization.registerClass(MM);var BM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return Tfe(t)},e}(Ar);BM.className="softsign";R.serialization.registerClass(BM);var LM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.tanh(t)},e}(Ar);LM.className="tanh";R.serialization.registerClass(LM);var Pb=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=-1),_.softmax(t,r)},e}(Ar);Pb.className="softmax";R.serialization.registerClass(Pb);var zM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=-1),_.logSoftmax(t,r)},e}(Ar);zM.className="logSoftmax";R.serialization.registerClass(zM);var $M=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=1),R.tidy(function(){return _.mul(_.sigmoid(_.mul(t,r)),t)})},e}(Ar);$M.className="swish";R.serialization.registerClass($M);var qM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return R.tidy(function(){return _.mul(t,_.tanh(_.softplus(t)))})},e}(Ar);qM.className="mish";R.serialization.registerClass(qM);function Wo(n){return n.getClassName()}function Ey(n,e){return e===void 0&&(e={}),Cf(n,R.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function Vo(n){if(n==null){var e={};return e.className="linear",e.config={},Ey(e)}if(typeof n=="string"){var e={};return e.className=n,e.config={},Ey(e)}else return n instanceof Ar?n:Ey(n)}function Mb(n){if(n!=null&&typeof n!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(n))}var WM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(R.serialization.Serializable),Pf=function(n){se(e,n);function e(t){var r=n.call(this)||this;return Mb(t),r.l1=t==null||t.l1==null?.01:t.l1,r.l2=t==null||t.l2==null?.01:t.l2,r.hasL1=r.l1!==0,r.hasL2=r.l2!==0,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){var a=R.zeros([1]);return r.hasL1&&(a=R.add(a,R.sum(_.mul(r.l1,R.abs(t))))),r.hasL2&&(a=R.add(a,R.sum(_.mul(r.l2,_f(t))))),_.reshape(a,[])})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,r){return new t({l1:r.l1,l2:r.l2})},e}(WM);Pf.className="L1L2";R.serialization.registerClass(Pf);function abe(n){return Mb(n),new Pf({l1:n!=null?n.l1:null,l2:0})}function ibe(n){return Mb(n),new Pf({l2:n!=null?n.l2:null,l1:0})}var DO={l1l2:"L1L2"};function zt(n){return Hy(n)}function FO(n,e){return e===void 0&&(e={}),Cf(n,R.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function ln(n){if(n==null)return null;if(typeof n=="string"){var e=n in DO?DO[n]:n,t={className:e,config:{}};return FO(t)}else return n instanceof WM?n:FO(n)}var Bb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.supportsMasking=!0,t!=null&&(r.maxValue=t.maxValue),r}return e.prototype.call=function(t,r){t=it(t);var a=R.relu(t);return this.maxValue!=null&&(a=R.clipByValue(a,0,this.maxValue)),a},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Bb.className="ReLU";R.serialization.registerClass(Bb);var Lb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.DEFAULT_ALPHA=.3,t==null&&(t={}),r.alpha=t.alpha==null?r.DEFAULT_ALPHA:t.alpha,r}return e.prototype.call=function(t,r){var a=it(t);return R.leakyRelu(a,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Lb.className="LeakyReLU";R.serialization.registerClass(Lb);var zb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;if(r.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),r.supportsMasking=!0,r.alphaInitializer=cn(t.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=ln(t.alphaRegularizer),r.alphaConstraint=Vn(t.alphaConstraint),t.sharedAxes==null)r.sharedAxes=null;else if(Array.isArray(t.sharedAxes))r.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")r.sharedAxes=[t.sharedAxes];else throw new J("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(t.sharedAxes));return r}return e.prototype.build=function(t){var r,a;t=It(t);var i=t.slice(1);if(this.sharedAxes!=null)try{for(var o=fe(this.sharedAxes),s=o.next();!s.done;s=o.next()){var u=s.value;i[u-1]=1}}catch(l){r={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}this.alpha=this.addWeight("alpha",i,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var c={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)c[u]=t[u];this.inputSpec=[new Ln({ndim:t.length,axes:c})],this.built=!0},e.prototype.call=function(t,r){return t=it(t),R.prelu(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:mn(this.alphaInitializer),alphaRegularizer:zt(this.alphaRegularizer),alphaConstraint:Wn(this.alphaConstraint),sharedAxes:this.sharedAxes},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);zb.className="PReLU";R.serialization.registerClass(zb);var $b=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;if(r.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==r.DEFAULT_ALPHA)throw new pt("Non-default alpha value (".concat(t.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=t.alpha==null?r.DEFAULT_ALPHA:t.alpha,r}return e.prototype.call=function(t,r){var a=it(t);return R.elu(a)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);$b.className="ELU";R.serialization.registerClass($b);var qb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.DEFAULT_THETA=1,t==null&&(t={}),r.theta=t.theta==null?r.DEFAULT_THETA:t.theta,r}return e.prototype.call=function(t,r){var a=it(t);return R.mul(a,R.cast(R.greater(a,this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);qb.className="ThresholdedReLU";R.serialization.registerClass(qb);var Wb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.DEFAULT_AXIS=1,t==null&&(t={}),r.softmax=new Pb().apply,r.axis=t.axis==null?r.DEFAULT_AXIS:t.axis,r}return e.prototype.call=function(t,r){var a=it(t);return this.softmax(a,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Wb.className="Softmax";R.serialization.registerClass(Wb);function lc(n,e,t){if(typeof n=="number")return Ms(n,e);if(n.length!==e)throw new J("The ".concat(t," argument must be an integer or tuple of ").concat(e," integers.")+" Received: ".concat(n.length," elements."));for(var r=0;r<e;++r){var a=n[r];if(!wfe(a))throw new J("The ".concat(t," argument must be an integer or tuple of ").concat(e)+" integers. Received: ".concat(JSON.stringify(n)," including a")+" non-integer number ".concat(a))}return n}function li(n,e,t,r,a){if(a===void 0&&(a=1),n==null)return n;var i=e+(e-1)*(a-1),o;return t==="same"?o=n:o=n-i+1,Math.floor((o+r-1)/r)}function Di(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+qo([t-e,0]);else if(r==="same")n=n*e;else throw new J("Unsupport padding mode: ".concat(r,"."));return n}function Vb(n,e){return R.tidy(function(){return Dn(e),e==="channelsFirst"?_.transpose(n,[0,2,3,1]):n})}function VM(n,e){return R.tidy(function(){return Dn(e),e==="channelsFirst"?_.transpose(n,[0,2,3,4,1]):n})}function obe(n,e,t,r,a,i,o){return r===void 0&&(r=1),a===void 0&&(a="valid"),o===void 0&&(o=1),R.tidy(function(){if(i==null&&(i=hi()),Dn(i),n.shape.length!==3)throw new J("The input of a conv1dWithBias operation should be 3, but is "+"".concat(n.shape.length," instead."));if(e.shape.length!==3)throw new J("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead"));if(t!=null&&t.shape.length!==1)throw new J("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(e.shape.length," instead"));if(i==="channelsFirst"&&(n=_.transpose(n,[0,2,1])),a==="causal")throw new pt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=_.conv1d(n,e,r,a==="same"?"same":"valid","NWC",o);return t!=null&&(s=vi(s,t)),s})}function RO(n,e,t,r,a,i,o,s){return r===void 0&&(r=[1,1]),a===void 0&&(a="valid"),s===void 0&&(s=null),R.tidy(function(){if(i==null&&(i=hi()),Dn(i),n.rank!==3&&n.rank!==4)throw new J("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(n.rank,"."));if(e.rank!==3&&e.rank!==4)throw new J("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(n.rank,"."));var u=Vb(n,i);if(a==="causal")throw new pt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=_.fused.conv2d({x:u,filter:e,strides:r,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:s}),i==="channelsFirst"&&(u=_.transpose(u,[0,3,1,2])),u})}function sbe(n,e,t,r,a,i,o){return r===void 0&&(r=[1,1,1]),a===void 0&&(a="valid"),R.tidy(function(){if(i==null&&(i=hi()),Dn(i),n.rank!==4&&n.rank!==5)throw new J("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(n.rank,"."));if(e.rank!==4&&e.rank!==5)throw new J("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(n.rank,"."));var s=VM(n,i);if(a==="causal")throw new pt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=_.conv3d(s,e,r,a==="same"?"same":"valid","NDHWC",o),t!=null&&(s=vi(s,t)),i==="channelsFirst"&&(s=_.transpose(s,[0,4,1,2,3])),s})}var GM=function(n){se(e,n);function e(t,r){var a=n.call(this,r)||this;if(a.bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(r),a.rank=t,Kn(a.rank,"rank"),a.rank!==1&&a.rank!==2&&a.rank!==3)throw new pt("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=lc(r.kernelSize,t,"kernelSize"),a.strides=lc(r.strides==null?1:r.strides,t,"strides"),a.padding=r.padding==null?"valid":r.padding,pa(a.padding),a.dataFormat=r.dataFormat==null?"channelsLast":r.dataFormat,Dn(a.dataFormat),a.activation=Vo(r.activation),a.useBias=r.useBias==null?!0:r.useBias,a.biasInitializer=cn(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Vn(r.biasConstraint),a.biasRegularizer=ln(r.biasRegularizer),a.activityRegularizer=ln(r.activityRegularizer),a.dilationRate=lc(r.dilationRate==null?1:r.dilationRate,t,"dilationRate"),a.rank===1&&Array.isArray(a.dilationRate)&&a.dilationRate.length!==1)throw new J("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(a.rank===2){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==2)throw new J("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(a.rank===3){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==3)throw new J("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}return a}return e.verifyArgs=function(t){if(_i("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!Ky(t.kernelSize,"number",1,3))throw new J("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(t.kernelSize),"."))},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Wo(this.activation),useBias:this.useBias,biasInitializer:mn(this.biasInitializer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),biasConstraint:Wn(this.biasConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),uv=function(n){se(e,n);function e(t,r){var a=n.call(this,t,r)||this;return a.kernel=null,e.verifyArgs(r),a.filters=r.filters,Kn(a.filters,"filters"),a.kernelInitializer=cn(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Vn(r.kernelConstraint),a.kernelRegularizer=ln(r.kernelRegularizer),a}return e.prototype.build=function(t){var r;t=It(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(r={},r[a]=i,r)}],this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i,o=a.bias==null?null:a.bias.read(),s=LO(a.activation.getClassName());if(s!=null&&a.rank===2)i=RO(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate,s);else{if(a.rank===1)i=obe(t,a.kernel.read(),o,a.strides[0],a.padding,a.dataFormat,a.dilationRate[0]);else if(a.rank===2)i=RO(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else if(a.rank===3)i=sbe(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else throw new pt("convolutions greater than 3D are not implemented yet.");a.activation!=null&&(i=a.activation.apply(i))}return i})},e.prototype.computeOutputShape=function(t){t=It(t);for(var r=[],a=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),i=0;i<a.length;++i){var o=li(a[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);r.push(o)}var s=[t[0]];return this.dataFormat==="channelsLast"?(s=s.concat(r),s.push(this.filters)):(s.push(this.filters),s=s.concat(r)),s},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:mn(this.kernelInitializer),kernelRegularizer:zt(this.kernelRegularizer),kernelConstraint:Wn(this.kernelConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new J("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(t.filters)))},e}(GM),cv=function(n){se(e,n);function e(t){var r=n.call(this,2,t)||this;return e.verifyArgs(t),r}return e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!Ky(t.kernelSize,"number",1,2))throw new J("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(uv);cv.className="Conv2D";R.serialization.registerClass(cv);var lv=function(n){se(e,n);function e(t){var r=n.call(this,3,t)||this;return e.verifyArgs(t),r}return e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new J("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(uv);lv.className="Conv3D";R.serialization.registerClass(lv);var Gb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.inputSpec=[new Ln({ndim:4})],r.padding!=="same"&&r.padding!=="valid")throw new J("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return e.prototype.build=function(t){var r;if(t=It(t),t.length!==4)throw new J("Input should have rank 4; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ln({ndim:4,axes:(r={},r[a]=i,r)})],this.built=!0},e.prototype.call=function(t,r){var a=this;return _.tidy(function(){var i=it(t);if(i.shape.length!==4)throw new J("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c;a.dataFormat==="channelsFirst"?(u=2,c=3):(u=1,c=2);var l=o[u],f=o[c],h=a.kernelSize[0],d=a.kernelSize[1],p=a.strides[0],v=a.strides[1],m=Di(l,p,h,a.padding),g=Di(f,v,d,a.padding),y=[s,m,g,a.filters];a.dataFormat!=="channelsLast"&&(i=_.transpose(i,[0,2,3,1]));var b=_.conv2dTranspose(i,a.kernel.read(),y,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(b=_.transpose(b,[0,3,1,2])),a.bias!=null&&(b=vi(b,a.bias.read(),a.dataFormat)),a.activation!=null&&(b=a.activation.apply(b)),b})},e.prototype.computeOutputShape=function(t){t=It(t);var r=t.slice(),a,i,o;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3):(a=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return r[a]=this.filters,r[i]=Di(r[i],c,s,this.padding),r[o]=Di(r[o],l,u,this.padding),r},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(cv);Gb.className="Conv2DTranspose";R.serialization.registerClass(Gb);var Ub=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.inputSpec=[new Ln({ndim:5})],r.padding!=="same"&&r.padding!=="valid")throw new J("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return e.prototype.build=function(t){var r;if(t=It(t),t.length!==5)throw new J("Input should have rank 5; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ln({ndim:5,axes:(r={},r[a]=i,r)})],this.built=!0},e.prototype.call=function(t,r){var a=this;return _.tidy(function(){var i=it(t);if(i.shape.length!==5)throw new J("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c,l;a.dataFormat==="channelsFirst"?(l=2,u=3,c=4):(l=1,u=2,c=3);var f=o[l],h=o[u],d=o[c],p=a.kernelSize[0],v=a.kernelSize[1],m=a.kernelSize[2],g=a.strides[0],y=a.strides[1],b=a.strides[2],w=Di(f,g,p,a.padding),x=Di(h,y,v,a.padding),N=Di(d,b,m,a.padding),T=[s,w,x,N,a.filters];a.dataFormat!=="channelsLast"&&(i=_.transpose(i,[0,2,3,4,1]));var E=_.conv3dTranspose(i,a.kernel.read(),T,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(E=_.transpose(E,[0,4,1,2,3])),a.bias!==null&&(E=vi(E,a.bias.read(),a.dataFormat)),a.activation!==null&&(E=a.activation.apply(E)),E})},e.prototype.computeOutputShape=function(t){t=It(t);var r=t.slice(),a,i,o,s;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3,s=4):(a=4,i=1,o=2,s=3);var u=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],f=this.strides[0],h=this.strides[1],d=this.strides[2];return r[a]=this.filters,r[i]=Di(r[i],f,u,this.padding),r[o]=Di(r[o],h,c,this.padding),r[s]=Di(r[s],d,l,this.padding),r},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(lv);Ub.className="Conv3DTranspose";R.serialization.registerClass(Ub);var UM=function(n){se(e,n);function e(t,r){var a=n.call(this,t,r)||this;if(a.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,r.filters==null)throw new J("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new J("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new J("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,a.depthwiseInitializer=cn(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=ln(r.depthwiseRegularizer),a.depthwiseConstraint=Vn(r.depthwiseConstraint),a.pointwiseInitializer=cn(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=ln(r.pointwiseRegularizer),a.pointwiseConstraint=Vn(r.pointwiseConstraint),a}return e.prototype.build=function(t){var r;if(t=It(t),t.length<this.rank+2)throw new J("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(t)));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null||t[a]<0)throw new J("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(t[a])));for(var i=t[a],o=this.kernelSize.concat([i,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(i*this.depthMultiplier,this.filters);var c=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,c,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,c,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,c,this.biasConstraint):this.bias=null,this.inputSpec=[new Ln({ndim:this.rank+2,axes:(r={},r[a]=i,r)})],this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i;if(a.rank===1)throw new pt("1D separable convolution is not implemented yet.");return a.rank===2&&(a.dataFormat==="channelsFirst"&&(t=_.transpose(t,[0,2,3,1])),i=_.separableConv2d(t,a.depthwiseKernel.read(),a.pointwiseKernel.read(),a.strides,a.padding,a.dilationRate,"NHWC")),a.useBias&&(i=vi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),a.dataFormat==="channelsFirst"&&(i=_.transpose(i,[0,3,1,2])),i})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=mn(this.depthwiseInitializer),t.pointwiseInitializer=mn(this.pointwiseInitializer),t.depthwiseRegularizer=zt(this.depthwiseRegularizer),t.pointwiseRegularizer=zt(this.pointwiseRegularizer),t.depthwiseConstraint=Wn(this.depthwiseConstraint),t.pointwiseConstraint=Wn(this.pointwiseConstraint),t},e}(uv);UM.className="SeparableConv";var Hb=function(n){se(e,n);function e(t){return n.call(this,2,t)||this}return e}(UM);Hb.className="SeparableConv2D";R.serialization.registerClass(Hb);var Kb=function(n){se(e,n);function e(t){var r=n.call(this,1,t)||this;return e.verifyArgs(t),r.inputSpec=[{ndim:3}],r}return e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!Ky(t.kernelSize,"number",1,1))throw new J("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(uv);Kb.className="Conv1D";R.serialization.registerClass(Kb);var jb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return typeof t.cropping=="number"?r.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?r.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:r.cropping=t.cropping,r.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,r.inputSpec=[{ndim:4}],r}return e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(t=it(t),a.dataFormat==="channelsLast"){var i=xp(t,a.cropping[0][0],t.shape[1]-a.cropping[0][0]-a.cropping[0][1],2);return xp(i,a.cropping[1][0],t.shape[2]-a.cropping[1][1]-a.cropping[1][0],3)}else{var i=xp(t,a.cropping[0][0],t.shape[2]-a.cropping[0][0]-a.cropping[0][1],3);return xp(i,a.cropping[1][0],t.shape[3]-a.cropping[1][1]-a.cropping[1][0],4)}})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);jb.className="Cropping2D";R.serialization.registerClass(jb);var Xb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=t.size==null?r.DEFAULT_SIZE:t.size,r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(r.dataFormat),r.interpolation=t.interpolation==null?"nearest":t.interpolation,gfe(r.interpolation),r}return e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var r=t[2]==null?null:this.size[0]*t[2],a=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],r,a]}else{var r=t[1]==null?null:this.size[0]*t[1],a=t[2]==null?null:this.size[1]*t[2];return[t[0],r,a,t[3]]}},e.prototype.call=function(t,r){var a=this;return _.tidy(function(){var i=it(t),o=i.shape;if(a.dataFormat==="channelsFirst"){i=_.transpose(i,[0,2,3,1]);var s=a.size[0]*o[2],u=a.size[1]*o[3],c=a.interpolation==="nearest"?_.image.resizeNearestNeighbor(i,[s,u]):_.image.resizeBilinear(i,[s,u]);return _.transpose(c,[0,3,1,2])}else{var s=a.size[0]*o[1],u=a.size[1]*o[2];return a.interpolation==="nearest"?_.image.resizeNearestNeighbor(i,[s,u]):_.image.resizeBilinear(i,[s,u])}})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Xb.className="UpSampling2D";R.serialization.registerClass(Xb);function ube(n,e,t,r,a,i){return t===void 0&&(t=[1,1]),r===void 0&&(r="valid"),R.tidy(function(){a==null&&(a=hi()),Dn(a);var o=Vb(n,a);if(n.rank!==4)throw new J("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(n.rank,"-D"));if(e.rank!==4)throw new J("depthwiseKernel is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));return o=_.depthwiseConv2d(o,e,t,r==="same"?"same":"valid","NHWC",i),a==="channelsFirst"&&(o=_.transpose(o,[0,3,1,2])),o})}var Yb=function(n){se(e,n);function e(t){var r=n.call(this,2,t)||this;return r.depthwiseKernel=null,r.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,r.depthwiseInitializer=cn(t.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=Vn(t.depthwiseConstraint),r.depthwiseRegularizer=ln(t.depthwiseRegularizer),r}return e.prototype.build=function(t){if(t=It(t),t.length<4)throw new J("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(t),"."));var r=this.dataFormat==="channelsFirst"?1:3;if(t[r]==null||t[r]<0)throw new J("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(t[r],")."));var a=t[r],i=[this.kernelSize[0],this.kernelSize[1],a,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[a*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i=ube(t,a.depthwiseKernel.read(),a.strides,a.padding,a.dataFormat,null);return a.useBias&&(i=vi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),i})},e.prototype.computeOutputShape=function(t){t=It(t);var r=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=li(r,this.kernelSize[0],this.padding,this.strides[0]),s=li(a,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,s]:[t[0],o,s,i]},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=mn(this.depthwiseInitializer),t.depthwiseRegularizer=zt(this.depthwiseRegularizer),t.depthwiseConstraint=Wn(this.depthwiseRegularizer),t},e}(GM);Yb.className="DepthwiseConv2D";R.serialization.registerClass(Yb);function HM(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new J("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function a(i){return i==null||Array.isArray(i)?i:[i]}return e=a(e),t=a(t),{inputs:n,initialState:e,constants:t}}function KM(n,e,t,r,a,i,o,s){return r===void 0&&(r=!1),o===void 0&&(o=!1),s===void 0&&(s=!1),_.tidy(function(){var u=e.shape.length;if(u<3)throw new J("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(fi(2,u));if(e=_.transpose(e,c),i!=null)throw new pt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=_.cast(_.cast(a,"bool"),"float32"),a.rank===u-1&&(a=_.expandDims(a,-1)),a=_.transpose(a,c)),r&&(e=_.reverse(e,0),a!=null&&(a=_.reverse(a,0)));var l=[],f,h=t,d=e.shape[0],p=_.unstack(e),v;a!=null&&(v=_.unstack(a));for(var m=function(w){var x=p[w],N=_.tidy(function(){return n(x,h)});if(a==null)f=N[0],h=N[1];else{var T=_.tidy(function(){var E=v[w],C=_.sub(_.onesLike(E),E),F=_.add(_.mul(N[0],E),_.mul(h[0],C)),D=h.map(function(O,L){return _.add(_.mul(N[1][L],E),_.mul(O,C))});return{output:F,newStates:D}});f=T.output,h=T.newStates}s&&l.push(f)},g=0;g<d;++g)m(g);var y;if(s){var b=1;y=_.stack(l,b)}return[f,y,h]})}var ro=function(n){se(e,n);function e(t){var r=n.call(this,t)||this,a;if(t.cell==null)throw new J("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?a=new dv({cells:t.cell}):a=t.cell,a.stateSize==null)throw new J("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=t.returnSequences==null?!1:t.returnSequences,r.returnState=t.returnState==null?!1:t.returnState,r.goBackwards=t.goBackwards==null?!1:t.goBackwards,r._stateful=t.stateful==null?!1:t.stateful,r.unroll=t.unroll==null?!1:t.unroll,r.supportsMasking=!0,r.inputSpec=[new Ln({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return e.prototype.getStates=function(){if(this.states_==null){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return fi(0,t).map(function(r){return null})}else return this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){var r,a;Dy(t)&&(t=t[0]),t=t;var i=this.cell.stateSize;Array.isArray(i)||(i=[i]);var o=i[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){var u=[];try{for(var c=fe(i),l=c.next();!l.done;l=c.next()){var f=l.value;u.push([t[0],f])}}catch(h){r={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return[s].concat(u)}else return s},e.prototype.computeMask=function(t,r){var a=this;return _.tidy(function(){Array.isArray(r)&&(r=r[0]);var i=a.returnSequences?r:null;if(a.returnState){var o=a.states.map(function(s){return null});return[i].concat(o)}else return i})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[],a=0;a<t;++a)r.push(null);return r}else return this.states_},set:function(t){this.states_=t},enumerable:!1,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new pt("Constants support is not implemented in RNN yet.");Dy(t)&&(t=t[0]),t=t;var r=this.stateful?t[0]:null,a=t.slice(2);this.inputSpec[0]=new Ln({shape:Qe([r,null],te(a),!1)});var i=[t[0]].concat(t.slice(2));this.cell.build(i);var o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!R.util.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new J("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=o.map(function(s){return new Ln({shape:[null,s]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,r){var a=this;r===void 0&&(r=!1),R.tidy(function(){if(!a.stateful)throw new Lo("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape[0];if(i==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.states_==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return _.zeros([i,l])}):a.states_=[_.zeros([i,a.cell.stateSize])];else if(t==null)_.dispose(a.states_),a.keptStates!=null&&(_.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return _.zeros([i,l])}):a.states_[0]=_.zeros([i,a.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new J("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));r===!0?a.keptStates.push(a.states_.slice()):_.dispose(a.states_);for(var o=0;o<a.states_.length;++o){var s=t[o],u=Array.isArray(a.cell.stateSize)?a.cell.stateSize[o]:a.cell.stateSize,c=[i,u];if(!R.util.arraysEqual(s.shape,c))throw new J("State ".concat(o," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(c,", received shape=").concat(s.shape));a.states_[o]=s}}a.states_=a.states_.map(function(l){return _.keep(l.clone())})})},e.prototype.apply=function(t,r){var a,i,o=r==null?null:r.initialState,s=r==null?null:r.constants;r==null&&(r={});var u=HM(t,o,s,this.numConstants);t=u.inputs,o=u.initialState,s=u.constants;var c=[],l=[];if(o!=null){r.initialState=o,c=c.concat(o),this.stateSpec=[];try{for(var f=fe(o),h=f.next();!h.done;h=f.next()){var d=h.value;this.stateSpec.push(new Ln({shape:d.shape}))}}catch(b){a={error:b}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}l=l.concat(this.stateSpec)}s!=null&&(r.constants=s,c=c.concat(s),this.numConstants=s.length);var p=c[0]instanceof ui;if(p){var v=[t].concat(c),m=this.inputSpec.concat(l),g=this.inputSpec;this.inputSpec=m;var y=n.prototype.apply.call(this,v,r);return this.inputSpec=g,y}else return n.prototype.apply.call(this,t,r)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;t=it(t),s==null&&(a.stateful?s=a.states_:s=a.getInitialState(t));var u=Array.isArray(a.cell.stateSize)?a.cell.stateSize.length:1;if(s.length!==u)throw new J("RNN Layer has ".concat(u," state(s) but was passed ")+"".concat(s.length," initial state(s)."));a.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var c={training:o},l=function(m,g){var y=a.cell.call([m].concat(g),c);return[y[0],y.slice(1)]},f=KM(l,t,s,a.goBackwards,i,null,a.unroll,a.returnSequences),h=f[0],d=f[1],p=f[2];a.stateful&&a.resetStates(p,o);var v=a.returnSequences?d:h;return a.returnState?[v].concat(p):v})},e.prototype.getInitialState=function(t){var r=this;return R.tidy(function(){var a=_.zeros(t.shape);return a=_.sum(a,[1,2]),a=Af(a),Array.isArray(r.cell.stateSize)?r.cell.stateSize.map(function(i){return i>1?Ay(a,[1,i]):a}):r.cell.stateSize>1?[Ay(a,[1,r.cell.stateSize])]:[a]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){n.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);var a=this.cell.getConfig();return this.getClassName()===e.className&&(r.cell={className:this.cell.getClassName(),config:a}),Object.assign(Object.assign(Object.assign({},a),t),r)},e.fromConfig=function(t,r,a){a===void 0&&(a={});var i=r.cell,o=ci(i,a);return new t(Object.assign(r,{cell:o}))},e}(gt);ro.className="RNN";R.serialization.registerClass(ro);var yc=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(gt),fv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=t.units,Kn(r.units,"units"),r.activation=Vo(t.activation==null?r.DEFAULT_ACTIVATION:t.activation),r.useBias=t.useBias==null?!0:t.useBias,r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cn(t.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=ln(t.kernelRegularizer),r.recurrentRegularizer=ln(t.recurrentRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.kernelConstraint=Vn(t.kernelConstraint),r.recurrentConstraint=Vn(t.recurrentConstraint),r.biasConstraint=Vn(t.biasConstraint),r.dropout=fc([1,qo([0,t.dropout==null?0:t.dropout])]),r.recurrentDropout=fc([1,qo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),r.dropoutFunc=t.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return e.prototype.build=function(t){t=It(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(t=t,t.length!==2)throw new J("SimpleRNNCell expects 2 input Tensors, got ".concat(t.length,"."));var i=t[1];t=t[0];var o=r.training==null?!1:r.training;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Go({ones:function(){return _.onesLike(t)},rate:a.dropout,training:o,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Go({ones:function(){return _.onesLike(i)},rate:a.recurrentDropout,training:o,dropoutFunc:a.dropoutFunc}));var s,u=a.dropoutMask,c=a.recurrentDropoutMask;u!=null?s=Oi(_.mul(t,u),a.kernel.read()):s=Oi(t,a.kernel.read()),a.bias!=null&&(s=vi(s,a.bias.read())),c!=null&&(i=_.mul(i,c));var l=_.add(s,Oi(i,a.recurrentKernel.read()));return a.activation!=null&&(l=a.activation.apply(l)),[l,l]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={units:this.units,activation:Wo(this.activation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),recurrentInitializer:mn(this.recurrentInitializer),biasInitializer:mn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),r)},e}(yc);fv.className="SimpleRNNCell";R.serialization.registerClass(fv);var Zb=function(n){se(e,n);function e(t){return t.cell=new fv(t),n.call(this,t)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,r){return new t(r)},e}(ro);Zb.className="SimpleRNN";R.serialization.registerClass(Zb);var hv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new J("GRUCell does not support reset_after parameter set to true.");return r.units=t.units,Kn(r.units,"units"),r.activation=Vo(t.activation===void 0?r.DEFAULT_ACTIVATION:t.activation),r.recurrentActivation=Vo(t.recurrentActivation===void 0?r.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),r.useBias=t.useBias==null?!0:t.useBias,r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cn(t.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=ln(t.kernelRegularizer),r.recurrentRegularizer=ln(t.recurrentRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.kernelConstraint=Vn(t.kernelConstraint),r.recurrentConstraint=Vn(t.recurrentConstraint),r.biasConstraint=Vn(t.biasConstraint),r.dropout=fc([1,qo([0,t.dropout==null?0:t.dropout])]),r.recurrentDropout=fc([1,qo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),r.dropoutFunc=t.dropoutFunc,r.implementation=t.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return e.prototype.build=function(t){t=It(t);var r=t[t.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(t=t,t.length!==2)throw new J("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=r.training==null?!1:r.training,o=t[1];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Go({ones:function(){return _.onesLike(t)},rate:a.dropout,training:i,count:3,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Go({ones:function(){return _.onesLike(o)},rate:a.recurrentDropout,training:i,count:3,dropoutFunc:a.dropoutFunc}));var s=a.dropoutMask,u=a.recurrentDropoutMask,c,l,f;0<a.dropout&&a.dropout<1&&(t=_.mul(t,s[0]));var h=Oi(t,a.kernel.read());a.useBias&&(h=vi(h,a.bias.read())),0<a.recurrentDropout&&a.recurrentDropout<1&&(o=_.mul(o,u[0]));var d=a.recurrentKernel.read(),p=te(_.split(d,[2*a.units,a.units],d.rank-1),2),v=p[0],m=p[1],g=Oi(o,v),y=te(_.split(h,3,h.rank-1),3),b=y[0],w=y[1],x=y[2],N=te(_.split(g,2,g.rank-1),2),T=N[0],E=N[1];c=a.recurrentActivation.apply(_.add(b,T)),l=a.recurrentActivation.apply(_.add(w,E));var C=Oi(_.mul(l,o),m);f=a.activation.apply(_.add(x,C));var F=_.add(_.mul(c,o),_.mul(_.add(1,_.neg(c)),f));return[F,F]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={units:this.units,activation:Wo(this.activation),recurrentActivation:Wo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),recurrentInitializer:mn(this.recurrentInitializer),biasInitializer:mn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),r)},e}(yc);hv.className="GRUCell";R.serialization.registerClass(hv);var Jb=function(n){se(e,n);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new hv(t),n.call(this,t)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,r){return r.implmentation===0&&(r.implementation=1),new t(r)},e}(ro);Jb.className="GRU";R.serialization.registerClass(Jb);var Mf=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=t.units,Kn(r.units,"units"),r.activation=Vo(t.activation===void 0?r.DEFAULT_ACTIVATION:t.activation),r.recurrentActivation=Vo(t.recurrentActivation===void 0?r.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),r.useBias=t.useBias==null?!0:t.useBias,r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cn(t.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=t.unitForgetBias,r.kernelRegularizer=ln(t.kernelRegularizer),r.recurrentRegularizer=ln(t.recurrentRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.kernelConstraint=Vn(t.kernelConstraint),r.recurrentConstraint=Vn(t.recurrentConstraint),r.biasConstraint=Vn(t.biasConstraint),r.dropout=fc([1,qo([0,t.dropout==null?0:t.dropout])]),r.recurrentDropout=fc([1,qo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),r.dropoutFunc=t.dropoutFunc,r.implementation=t.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return e.prototype.build=function(t){var r;t=It(t);var a=t[t.length-1];this.kernel=this.addWeight("kernel",[a,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,s=this.units;i=new(r=function(u){se(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.prototype.apply=function(l,f){var h=o.apply([s]),d=new jp().apply([s]),p=o.apply([s*2]);return LR(LR(h,d),p)},c}(Ba),r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r.training==null?!1:r.training;if(t=t,t.length!==3)throw new J("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var o=t[1],s=t[2];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Go({ones:function(){return _.onesLike(t)},rate:a.dropout,training:i,count:4,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Go({ones:function(){return _.onesLike(o)},rate:a.recurrentDropout,training:i,count:4,dropoutFunc:a.dropoutFunc}));var u=a.dropoutMask,c=a.recurrentDropoutMask,l,f,h,d;0<a.dropout&&a.dropout<1&&(t=_.mul(t,u[0]));var p=Oi(t,a.kernel.read());0<a.recurrentDropout&&a.recurrentDropout<1&&(o=_.mul(o,c[0])),p=_.add(p,Oi(o,a.recurrentKernel.read())),a.useBias&&(p=vi(p,a.bias.read()));var v=te(_.split(p,4,p.rank-1),4),m=v[0],g=v[1],y=v[2],b=v[3];l=a.recurrentActivation.apply(m),f=a.recurrentActivation.apply(g),h=_.add(_.mul(f,s),_.mul(l,a.activation.apply(y))),d=a.recurrentActivation.apply(b);var w=_.mul(d,a.activation.apply(h));return[w,w,h]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={units:this.units,activation:Wo(this.activation),recurrentActivation:Wo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),recurrentInitializer:mn(this.recurrentInitializer),biasInitializer:mn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),r)},e}(yc);Mf.className="LSTMCell";R.serialization.registerClass(Mf);var Qb=function(n){se(e,n);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Mf(t),n.call(this,t)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,r){return r.implmentation===0&&(r.implementation=1),new t(r)},e}(ro);Qb.className="LSTM";R.serialization.registerClass(Qb);var dv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.cells=t.cells,r}return Object.defineProperty(e.prototype,"stateSize",{get:function(){var t,r,a=[];try{for(var i=fe(this.cells.slice().reverse()),o=i.next();!o.done;o=i.next()){var s=o.value;Array.isArray(s.stateSize)?a.push.apply(a,Qe([],te(s.stateSize),!1)):a.push(s.stateSize)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i,o,s,u;t=t;var c=t.slice(1),l=[];try{for(var f=fe(a.cells.slice().reverse()),h=f.next();!h.done;h=f.next()){var d=h.value;Array.isArray(d.stateSize)?l.push(c.splice(0,d.stateSize.length)):l.push(c.splice(0,1))}}catch(w){i={error:w}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}l.reverse();for(var p=[],v,m=0;m<a.cells.length;++m){var d=a.cells[m];c=l[m],m===0?v=[t[0]].concat(c):v=[v[0]].concat(c),v=d.call(v,r),p.push(v.slice(1))}c=[];try{for(var g=fe(p.slice().reverse()),y=g.next();!y.done;y=g.next()){var b=y.value;c.push.apply(c,Qe([],te(b),!1))}}catch(w){s={error:w}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}return[v[0]].concat(c)})},e.prototype.build=function(t){Dy(t)&&(t=t[0]),t=t;var r;this.cells.forEach(function(a,i){Os("RNNCell_".concat(i),function(){a.build(t),Array.isArray(a.stateSize)?r=a.stateSize[0]:r=a.stateSize,t=[t[0],r]})}),this.built=!0},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r=function(o){return{className:o.getClassName(),config:o.getConfig()}},a=this.cells.map(r),i={cells:a};return Object.assign(Object.assign({},t),i)},e.fromConfig=function(t,r,a){var i,o;a===void 0&&(a={});var s=[];try{for(var u=fe(r.cells),c=u.next();!c.done;c=u.next()){var l=c.value;s.push(ci(l,a))}}catch(f){i={error:f}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return new t({cells:s})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,r;if(!this.trainable)return[];var a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Qe([],te(s.trainableWeights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,r,a,i,o=[];try{for(var s=fe(this.cells),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Qe([],te(c.nonTrainableWeights),!1))}}catch(d){t={error:d}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.cells),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Qe([],te(c.trainableWeights),!1))}}catch(d){a={error:d}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){var t,r,a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Qe([],te(s.weights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return Fy(a)},e.prototype.setWeights=function(t){var r,a,i=[];try{for(var o=fe(this.cells),s=o.next();!s.done;s=o.next())for(var u=s.value,c=u.weights.length,l=t.splice(c),f=0;f<u.weights.length;++f)i.push([u.weights[f],l[f]])}catch(h){r={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}nb(i)},e}(yc);dv.className="StackedRNNCells";R.serialization.registerClass(dv);function Go(n){var e=n.ones,t=n.rate,r=n.training,a=r===void 0?!1:r,i=n.count,o=i===void 0?1:i,s=n.dropoutFunc,u=function(){return s!=null?s(e(),t):UO(e(),t)},c=function(){return Df(u,e,a)};if(!o||o<=1)return _.keep(c().clone());var l=Array(o).fill(void 0).map(c);return l.map(function(f){return _.keep(f.clone())})}var cbe=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(t[r[a]]=n[r[a]]);return t};(function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(yc);var jM=function(n){se(e,n);function e(t){var r=this;if(t.unroll)throw new pt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new pt("It is not possible at the moment to stack convolutional cells.");return r=n.call(this,t)||this,r.inputSpec=[new Ln({ndim:5})],r}return e.prototype.call=function(t,r){var a=this;return _.tidy(function(){if(a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null),r&&r.constants)throw new J("ConvRNN2D cell does not support constants");var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.prototype.computeOutputShape=function(t){var r=this.computeSingleOutputShape(t);return this.returnSequences||(r=Qe([r[0]],te(r.slice(2)),!1)),this.returnState&&(r=Qe([r],te(Array(2).fill(Qe([t[0]],te(r.slice(-3)),!1))),!1)),r},e.prototype.getInitialState=function(t){var r=this;return _.tidy(function(){var a=r.cell.stateSize,i=t.shape,o=r.computeSingleOutputShape(i),s=Qe([o[0]],te(o.slice(2)),!1),u=_.zeros(s);return Array.isArray(a)?Array(a.length).fill(u):[u]})},e.prototype.resetStates=function(t,r){var a=this;r===void 0&&(r=!1),_.tidy(function(){if(!a.stateful)throw new Lo("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape,o=a.computeSingleOutputShape(i),s=Qe([o[0]],te(o.slice(2)),!1),u=i[0];if(u==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.getStates()==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return _.zeros(s)}):a.states_=[_.zeros(s)];else if(t==null)_.dispose(a.states_),a.keptStates!=null&&(_.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return _.zeros(s)}):a.states_[0]=_.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new J("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));r?a.keptStates.push(a.states_.slice()):_.dispose(a.states_);for(var c=0;c<a.states_.length;++c){var l=t[c],f=s;if(!R.util.arraysEqual(l.shape,f))throw new J("State ".concat(c," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(f,", received shape=").concat(l.shape));a.states_[c]=l}}a.states_=a.states_.map(function(h){return _.keep(h.clone())})})},e.prototype.computeSingleOutputShape=function(t){var r=this.cell,a=r.dataFormat,i=r.filters,o=r.kernelSize,s=r.padding,u=r.strides,c=r.dilationRate,l=a==="channelsFirst",f=t[l?3:2],h=t[l?4:3],d=li(f,o[0],s,u[0],c[0]),p=li(h,o[1],s,u[1],c[1]),v=Qe(Qe([],te(t.slice(0,2)),!1),te(l?[i,d,p]:[d,p,i]),!1);return v},e}(ro);jM.className="ConvRNN2D";var pv=function(n){se(e,n);function e(t){var r=this,a=t.filters,i=t.kernelSize,o=t.strides,s=t.padding,u=t.dataFormat,c=t.dilationRate;return r=n.call(this,Object.assign(Object.assign({},t),{units:a}))||this,r.filters=a,Kn(r.filters,"filters"),r.kernelSize=lc(i,2,"kernelSize"),r.kernelSize.forEach(function(l){return Kn(l,"kernelSize")}),r.strides=lc(o||1,2,"strides"),r.strides.forEach(function(l){return Kn(l,"strides")}),r.padding=s||"valid",pa(r.padding),r.dataFormat=u||"channelsLast",Dn(r.dataFormat),r.dilationRate=lc(c||1,2,"dilationRate"),r.dilationRate.forEach(function(l){return Kn(l,"dilationRate")}),r}return e.prototype.build=function(t){var r;t=It(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=4,s=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var u=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var c=void 0;if(this.unitForgetBias){var l=this.biasInitializer,f=this.filters;c=new(r=function(h){se(d,h);function d(){return h!==null&&h.apply(this,arguments)||this}return d.prototype.apply=function(p,v){var m=l.apply([f]),g=_.ones([f]),y=l.apply([f*2]);return jy([m,g,y])},d}(Ba),r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,r){var a=this;return _.tidy(function(){if(t.length!==3)throw new J("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=r.training||!1,o=t[0],s=t[1],u=t[2],c=4;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Go({ones:function(){return _.onesLike(o)},rate:a.dropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var l=a.dropoutMask,f=function(le,pe,xe){return!pe||!pe[xe]?le:_.mul(pe[xe],le)},h=f(o,l,0),d=f(o,l,1),p=f(o,l,2),v=f(o,l,3);0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Go({ones:function(){return _.onesLike(s)},rate:a.recurrentDropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var m=a.recurrentDropoutMask,g=f(s,m,0),y=f(s,m,1),b=f(s,m,2),w=f(s,m,3),x=3,N=te(_.split(a.kernel.read(),c,x),4),T=N[0],E=N[1],C=N[2],F=N[3],D=te(a.useBias?_.split(a.bias.read(),c):[null,null,null,null],4),O=D[0],L=D[1],z=D[2],$=D[3];h=a.inputConv(h,T,O,a.padding),d=a.inputConv(d,E,L,a.padding),p=a.inputConv(p,C,z,a.padding),v=a.inputConv(v,F,$,a.padding);var B=te(_.split(a.recurrentKernel.read(),c,x),4),W=B[0],X=B[1],Z=B[2],V=B[3];g=a.recurrentConv(g,W),y=a.recurrentConv(y,X),b=a.recurrentConv(b,Z),w=a.recurrentConv(w,V);var j=a.recurrentActivation.apply(_.add(h,g)),re=a.recurrentActivation.apply(_.add(d,y)),ne=_.add(_.mul(re,u),_.mul(j,a.activation.apply(_.add(p,b)))),oe=_.mul(a.recurrentActivation.apply(_.add(v,w)),a.activation.apply(ne));return[oe,oe,ne]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);t.units;var r=cbe(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},r),a)},e.prototype.inputConv=function(t,r,a,i){var o=_.conv2d(t,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return a?vi(o,a,this.dataFormat):o},e.prototype.recurrentConv=function(t,r){var a=1;return _.conv2d(t,r,a,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")},e}(Mf);pv.className="ConvLSTM2DCell";_.serialization.registerClass(pv);var e1=function(n){se(e,n);function e(t){var r=new pv(t);return n.call(this,Object.assign(Object.assign({},t),{cell:r}))||this}return e.fromConfig=function(t,r){return new t(r)},e}(jM);e1.className="ConvLSTM2D";_.serialization.registerClass(e1);var vv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.rate=Math.max(Math.min(t.rate,1),0),r.noiseShape=t.noiseShape,r.seed=t.seed,r.supportsMasking=!0,r}return e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var r=t.shape,a=[],i=0;i<this.noiseShape.length;++i)a.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return a},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);if(0<a.rate&&a.rate<1){var o=r.training==null?!1:r.training,s=a.getNoiseShape(i),u=Df(function(){return UO(i,a.rate,s,a.seed)},function(){return i},o);return u}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.dispose=function(){return n.prototype.dispose.call(this)},e}(gt);vv.className="Dropout";R.serialization.registerClass(vv);var t1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.inputSpec=[{ndim:3}],r}return e.prototype.getNoiseShape=function(t){var r=t.shape;return[r[0],1,r[2]]},e}(vv);t1.className="SpatialDropout1D";R.serialization.registerClass(t1);var n1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var a=null;t.batchSize!=null&&(a=t.batchSize),r.batchInputShape=[a,t.inputDim]}return r.units=t.units,Kn(r.units,"units"),r.activation=Vo(t.activation),t.useBias!=null&&(r.useBias=t.useBias),r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=Vn(t.kernelConstraint),r.biasConstraint=Vn(t.biasConstraint),r.kernelRegularizer=ln(t.kernelRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.activityRegularizer=ln(t.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return e.prototype.build=function(t){var r;t=It(t);var a=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[a,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(r={},r[-1]=a,r)}],this.built=!0},e.prototype.computeOutputShape=function(t){t=It(t);var r=t.slice();return r[r.length-1]=this.units,r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=LO(a.activation.getClassName()),s;return o!=null?s=Oi(i,a.kernel.read(),o,a.bias?a.bias.read():null):(s=Oi(i,a.kernel.read()),a.bias!=null&&(s=vi(s,a.bias.read())),a.activation!=null&&(s=a.activation.apply(s))),s})},e.prototype.getConfig=function(){var t={units:this.units,activation:Wo(this.activation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),biasInitializer:mn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),biasConstraint:Wn(this.biasConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);n1.className="Dense";R.serialization.registerClass(n1);var r1=function(n){se(e,n);function e(t){var r=this;return t=t||{},r=n.call(this,t)||this,r.inputSpec=[{minNDim:3}],r.dataFormat=t.dataFormat,r}return e.prototype.computeOutputShape=function(t){var r,a;t=It(t);try{for(var i=fe(t.slice(1)),o=i.next();!o.done;o=i.next()){var s=o.value;if(s==null)throw new J('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(t.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(u){r={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}return[t[0],$o(t,1)]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);if(a.dataFormat==="channelsFirst"&&i.rank>1){for(var o=[0],s=2;s<i.rank;++s)o.push(s);o.push(1),i=R.transpose(i,o)}return Sfe(i)})},e.prototype.getConfig=function(){var t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);var r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);r1.className="Flatten";R.serialization.registerClass(r1);var a1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.activation=Vo(t.activation),r}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);return a.activation.apply(i)})},e.prototype.getConfig=function(){var t={activation:Wo(this.activation)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);a1.className="Activation";R.serialization.registerClass(a1);var i1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.n=t.n,r.inputSpec=[{ndim:2}],r}return e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return t=it(t),xfe(t,a.n)})},e.prototype.getConfig=function(){var t={n:this.n},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);i1.className="RepeatVector";R.serialization.registerClass(i1);var o1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;r.targetShape=t.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,r){for(var a="Total size of new array must be unchanged.",i=r.slice(),o=1,s=null,u=0;u<i.length;++u){var c=i[u];if(this.isUnknown(c))if(s===null)s=u;else throw new J("Can only specifiy one unknown dimension.");else o*=c}var l=$o(t);if(s!==null){if(o===0||l%o!==0)throw new J(a);i[s]=l/o}else if(l!==o)throw new J(a);return i},e.prototype.computeOutputShape=function(t){for(var r=!1,a=0;a<t.length;++a)if(this.isUnknown(t[a])){r=!0;break}return r?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=i.shape,s=o.slice(0,1).concat(a.fixUnknownDimension(o.slice(1),a.targetShape));return R.reshape(i,s)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);o1.className="Reshape";R.serialization.registerClass(o1);var s1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(t.dims," instead."));var a=fi(1,t.dims.length+1);if(!R.util.arraysEqual(t.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=t.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new Ln({ndim:r.dims.length+1})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=t.slice();return this.dims.forEach(function(a,i){r[i+1]=t[a]}),r},e.prototype.call=function(t,r){return R.transpose(it(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);s1.className="Permute";R.serialization.registerClass(s1);var u1=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.supportsMasking=!0,t!=null?r.maskValue=t.maskValue==null?0:t.maskValue:r.maskValue=0,r}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={maskValue:this.maskValue};return Object.assign(r,t),r},e.prototype.computeMask=function(t,r){var a=it(t),i=-1;return R.any(R.notEqual(a,this.maskValue),i)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=-1,s=!0,u=R.any(R.notEqual(i,a.maskValue),o,s),c=R.mul(i,R.cast(u,i.dtype));return c})},e}(gt);u1.className="Masking";R.serialization.registerClass(u1);var c1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var a=null;t.batchSize!=null&&(a=t.batchSize),t.inputLength==null?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(Yt(t.inputLength))}return r.inputDim=t.inputDim,Kn(r.inputDim,"inputDim"),r.outputDim=t.outputDim,Kn(r.outputDim,"outputDim"),r.embeddingsInitializer=cn(t.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=ln(t.embeddingsRegularizer),r.activityRegularizer=ln(t.activityRegularizer),r.embeddingsConstraint=Vn(t.embeddingsConstraint),r.maskZero=t.maskZero,r.supportsMasking=t.maskZero,r.inputLength=t.inputLength,r}return e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,r){var a=this;return R.tidy(function(){return a.maskZero?(t=it(t),R.notEqual(t,R.zerosLike(t))):null})},e.prototype.computeOutputShape=function(t){if(t=It(t),this.inputLength==null)return Qe(Qe([],te(t),!1),[this.outputDim],!1);var r=Yt(this.inputLength);if(r.length!==t.length-1)throw new J('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));for(var a=0,i=0;i<r.length;++i){var o=r[i],s=t[i+1];if(o!=null&&s!=null&&o!==s)throw new J('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));o==null&&(r[a]=s),a++}return Qe(Qe([t[0]],te(r),!1),[this.outputDim],!1)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);i.dtype!=="int32"&&(i=Ri(i,"int32"));var o=GO(a.embeddings.read(),R.reshape(i,[i.size]));return R.reshape(o,It(a.computeOutputShape(i.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:mn(this.embeddingsInitializer),embeddingsRegularizer:zt(this.embeddingsRegularizer),activityRegularizer:zt(this.activityRegularizer),embeddingsConstraint:Wn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);c1.className="Embedding";R.serialization.registerClass(c1);var Ks=function(n){se(e,n);function e(t){var r=n.call(this,t||{})||this;return r.supportsMasking=!0,r}return e.prototype.mergeFunction=function(t){throw new pt},e.prototype.computeElementwiseOpOutputShape=function(t,r){if(t==null||r==null)return null;if(t.length<r.length)return this.computeElementwiseOpOutputShape(r,t);if(r.length===0)return t;for(var a=t.slice(0,t.length-r.length),i=0;i<r.length;++i){var o=t[t.length-r.length+i],s=r[i];if(o==null||s==null||o<0||s<0)a.push(null);else if(o===1)a.push(s);else if(s===1)a.push(o);else{if(o!==s)throw new J("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(r));a.push(o)}}return a},e.prototype.build=function(t){var r,a;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[It(t)]),t=t,t.length<2)throw new J("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(t.length," input(s)."));var i=[];try{for(var o=fe(t),s=o.next();!s.done;s=o.next()){var u=s.value;u!=null&&u[0]!==null&&i.push(u[0])}}catch(h){r={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}if(i=zo(i),i.length>1)throw new J("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(t),"."));for(var c=t[0]==null?null:t[0].slice(1),l=1;l<t.length;++l){var u=t[l]==null?null:t[l].slice(1);c=this.computeElementwiseOpOutputShape(c,u)}var f=t.map(function(h){return h.length});t.indexOf(null)===-1&&zo(f).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i,o,s,u;if(t=t,a.reshapeRequired){var c=[],l=t.map(function(L){return L.rank});if(l.indexOf(null)===-1){var f=qo(l);try{for(var h=fe(t),d=h.next();!d.done;d=h.next()){for(var p=d.value,v=p.rank,m=0;m<f-v;++m)p=Af(p,1);c.push(p)}}catch(L){i={error:L}}finally{try{d&&!d.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a.mergeFunction(c)}else{var g=!1;try{for(var y=fe(t),b=y.next();!b.done;b=y.next()){var p=b.value,v=p.rank;if(v==null){var w=p.shape,x=w[0],N=w.slice(1).concat([x]),T=_.reshape(p,[x].concat($o(w.slice(1))));T=_.transpose(T,[1,0]),T=_.reshape(T,N),c.push(T),g=!0}else if(v>1){var E=fi(1,v).concat([0]);c.push(_.transpose(p,E)),g=!0}else c.push(p)}}catch(L){s={error:L}}finally{try{b&&!b.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}var C=a.mergeFunction(c),F=C.rank;if(g){if(F==null){var D=C.shape,O=D.length,x=D[O-1],N=[x].concat(D.slice(0,D.length-1));C=_.reshape(_.transpose(_.reshape(C,[-1,x]),[1,0]),N)}else if(F>1){var E=[F-1].concat(fi(0,F-1));C=_.transpose(C,E)}}return C}}else return a.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var r,a;t=t;var i;t[0]==null?i=null:i=t[0].slice(1);for(var o=1;o<t.length;++o){var s=t[o]==null?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=[];try{for(var c=fe(t),l=c.next();!l.done;l=c.next()){var s=l.value;s!=null&&s[0]!==null&&u.push(s[0])}}catch(f){r={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return u=zo(u),u.length===1?i=u.concat(i):i=[null].concat(i),i},e.prototype.computeMask=function(t,r){return _.tidy(function(){if(r==null)return null;if(!Array.isArray(r))throw new J("`mask` should be an Array");if(!Array.isArray(t))throw new J("`inputs` should be an Array");if(r.length!==t.length)throw new J("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(t.length," vs ").concat(r.length,")"));if(r.every(function(o){return o==null}))return null;r=r.map(function(o){return o==null?o:_.expandDims(o,0)});for(var a=r[0],i=1;i<r.length-1;++i)a=_.logicalAnd(a,r[i]);return a})},e}(gt),l1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0].clone(),a=1;a<t.length;++a)r=_.add(r,t[a]);return r})},e}(Ks);l1.className="Add";R.serialization.registerClass(l1);var f1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0].clone(),a=1;a<t.length;++a)r=_.mul(r,t[a]);return r})},e}(Ks);f1.className="Multiply";R.serialization.registerClass(f1);var h1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0].clone(),a=1;a<t.length;++a)r=_.add(r,t[a]);return _.mul(1/t.length,r)})},e}(Ks);h1.className="Average";R.serialization.registerClass(h1);var d1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0],a=1;a<t.length;++a)r=_.maximum(r,t[a]);return r})},e}(Ks);d1.className="Maximum";R.serialization.registerClass(d1);var p1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0],a=1;a<t.length;++a)r=_.minimum(r,t[a]);return r})},e}(Ks);p1.className="Minimum";R.serialization.registerClass(p1);var v1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_AXIS=-1,t==null&&(t={}),r.axis=t.axis==null?r.DEFAULT_AXIS:t.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return e.prototype.build=function(t){var r,a,i,o;if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new J("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var s=!0;try{for(var u=fe(t),c=u.next();!c.done;c=u.next()){var l=c.value;if(l!=null){s=!1;break}}}catch(g){r={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}if(!s){for(var f=[],h=0;h<t.length;++h){var d=t[h].slice();d.splice(this.axis,1);var p=!1;try{for(var v=(i=void 0,fe(f)),m=v.next();!m.done;m=v.next()){var l=m.value;if(R.util.arraysEqual(l,d)){p=!0;break}}}catch(g){i={error:g}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}p||f.push(d)}if(f.length>1)throw new J("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var r=this;return R.tidy(function(){return jy(t,r.axis)})},e.prototype.computeOutputShape=function(t){var r,a;if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new J("A `Concatenate` layer should be called on a list of inputs.");var i=t,o=i[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;try{for(var u=fe(i.slice(1)),c=u.next();!c.done;c=u.next()){var l=c.value;if(o[s]==null||l[s]==null){o[s]=null;break}o[s]+=l[s]}}catch(f){r={error:f}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}return o},e.prototype.computeMask=function(t,r){var a=this;if(r==null)return null;if(!Array.isArray(r))throw new J("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new J("`inputs` should be an array for Concatenate");if(r.length!==t.length)throw new J("Mismatch in the length of mask (".concat(r.length,") ")+"and the legnth of inputs (".concat(t.length,")"));return _.tidy(function(){var i=!0;if(r.forEach(function(c){if(c!=null){i=!1;return}}),i)return null;for(var o=[],s=0;s<t.length;++s)r[s]==null?o.push(_.cast(_.onesLike(t[s]),"bool")):r[s].rank<t[s].rank?o.push(_.expandDims(r[s],-1)):o.push(r[s]);var u=_.concat(o,a.axis);return _.all(u,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(Ks);v1.className="Concatenate";R.serialization.registerClass(v1);function gf(n,e){for(;n<0;)n+=e;return n}function lbe(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new pt("batchDot is not implemented for tensors of 4D or higher rank yet");if(_.util.assert(n.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(n.shape.length)}),_.util.assert(n.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(e.shape.length)}),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new pt("batchDot is not implemented for complex64-type Tensors yet.");var r=n.shape.length,a=e.shape.length;t==null&&(t=[r-1,a-2]);var i=t;return _.tidy(function(){var o;if(r>a){o=r-a;for(var s=[],u=0;u<o;++u)s.push(1);e=_.reshape(e,e.shape.concat(s))}else if(a>r){o=a-r;for(var s=[],u=0;u<o;++u)s.push(1);n=_.reshape(n,n.shape.concat(s))}else o=0;var c;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?c=_.sum(_.mul(n,e),i[0]):c=_.sum(_.mul(_.transpose(n,[1,0]),e),i[1]);else{var l=i[0]!==n.shape.length-1,f=i[1]===e.shape.length-1;c=_.matMul(n,e,l,f)}if(o>0){var h=void 0;r>a?h=r+a-3:h=r-1;for(var d=[],u=h;u<h+o;++u)d.push(u);c=_.squeeze(c,d)}return c.shape.length===1&&(c=_.expandDims(c,1)),c})}var m1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.axes=t.axes,r.normalize=t.normalize==null?!1:t.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return e.prototype.build=function(t){_.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var r=t[0],a=t[1];if(r.length>3||a.length>3)throw new pt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(r,a);if(r[i[0]]!==a[i[1]])throw new J("Dimension incompatibility: "+"".concat(r[i[0]]," !== ").concat(a[i[1]]))},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new J("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(t.length," input(s)."));var r=t[0],a=t[1],i;return Array.isArray(this.axes)?i=this.axes.map(function(o,s){return gf(o,t[s].shape.length)}):i=[gf(this.axes,r.shape.length),gf(this.axes,a.shape.length)],this.normalize&&(r=qp(r,i[0]),a=qp(a,i[1])),lbe(r,a,i)},e.prototype.interpretAxes=function(t,r){var a;return Array.isArray(this.axes)?a=this.axes:a=[gf(this.axes,t.length),gf(this.axes,r.length)],a},e.prototype.computeOutputShape=function(t){_.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var r=t[0].slice(),a=t[1].slice();if(r.length>3||a.length>3)throw new pt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(r,a);r.splice(i[0],1),a.splice(i[1],1),a.splice(0,1);var o=r.concat(a);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,r){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(Ks);m1.className="Dot";R.serialization.registerClass(m1);var g1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.stddev=t.stddev,r}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={stddev:this.stddev};return Object.assign(r,t),r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=function(){return R.add(Kp(i.shape,0,a.stddev),i)},s=Df(o,function(){return i},r.training||!1);return s})},e}(gt);g1.className="GaussianNoise";R.serialization.registerClass(g1);var y1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.rate=t.rate,r}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={rate:this.rate};return Object.assign(r,t),r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);if(a.rate>0&&a.rate<1){var o=function(){var s=Math.sqrt(a.rate/(1-a.rate));return R.mul(i,Kp(i.shape,1,s))};return Df(o,function(){return i},r.training||!1)}return i})},e}(gt);y1.className="GaussianDropout";R.serialization.registerClass(y1);var b1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.rate=t.rate,r.noiseShape=t.noiseShape,r}return e.prototype._getNoiseShape=function(t){return this.noiseShape||it(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={rate:this.rate};return Object.assign(r,t),r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(a.rate<1&&a.rate>0){var i=a._getNoiseShape(t),o=function(){var s=it(t),u=1.6732632423543772,c=1.0507009873554805,l=-u*c,f=R.greaterEqual(R.randomUniform(i),a.rate);f=Ri(f,"float32");var h=Math.pow((1-a.rate)*(1+a.rate*Math.pow(l,2)),-.5),d=-h*l*a.rate,p=R.add(R.mul(s,f),R.mul(R.add(f,-1),l));return R.add(R.mul(p,h),d)};return Df(o,function(){return it(t)},r.training||!1)}return t})},e}(gt);b1.className="AlphaDropout";R.serialization.registerClass(b1);function If(n,e,t,r,a,i){i===void 0&&(i=.001);var o;if(n.rank===2)o=_.batchNorm2d(n,e,t,r,a,i);else if(n.rank===3)o=_.batchNorm3d(n,e,t,r,a,i);else if(n.rank===4)o=_.batchNorm4d(n,e,t,r,a,i);else throw new pt("batchNormalization is not implemented for array of rank ".concat(n.rank," ")+"yet");return o}function fbe(n,e,t,r,a){return a===void 0&&(a=.001),R.tidy(function(){var i=_.moments(n,r),o=i.mean,s=i.variance,u=If(n,o,s,t,e,a);return[u,o,s]})}function hbe(n,e,t,r,a){return a===void 0&&(a=.001),R.tidy(function(){var i,o,s=_.moments(n,r),u=s.mean,c=s.variance,l=[];try{for(var f=fe(fi(0,n.rank)),h=f.next();!h.done;h=f.next()){var d=h.value;r.indexOf(d)!==-1?l.push(1):l.push(n.shape[d])}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}var p=R.reshape(u,l),v=R.reshape(c,l),m=e==null?null:R.reshape(e,l),g=t==null?null:R.reshape(t,l),y=If(n,p,v,g,m,a);return[y,u,c]})}function dbe(n,e,t,r,a){return a===void 0&&(a=.001),R.util.arraysEqual(r.slice().sort(),fi(0,n.rank-1))?fbe(n,e,t,r,a):hbe(n,e,t,r,a)}var w1=function(n){se(e,n);function e(t){var r=this;return t==null&&(t={}),r=n.call(this,t)||this,r.supportsMasking=!0,r.axis=t.axis==null?-1:t.axis,r.momentum=t.momentum==null?.99:t.momentum,r.epsilon=t.epsilon==null?.001:t.epsilon,r.center=t.center==null?!0:t.center,r.scale=t.scale==null?!0:t.scale,r.betaInitializer=cn(t.betaInitializer||"zeros"),r.gammaInitializer=cn(t.gammaInitializer||"ones"),r.movingMeanInitializer=cn(t.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=cn(t.movingVarianceInitializer||"ones"),r.betaConstraint=Vn(t.betaConstraint),r.gammaConstraint=Vn(t.gammaConstraint),r.betaRegularizer=ln(t.betaRegularizer),r.gammaRegularizer=ln(t.gammaRegularizer),r}return e.prototype.build=function(t){var r;t=It(t);var a=this.axis>=0?this.axis:this.axis+t.length,i=t[a];if(i==null)throw new J("Axis ".concat(a," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(t),"."));this.inputSpec=[new Ln({ndim:t.length,axes:(r={},r[a]=i,r)})];var o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r.training==null?!1:r.training,o=it(t),s=o.shape,u=s.length,c=fi(0,u),l=a.axis>=0?a.axis:a.axis+u;c.splice(l,1);var f=Ms(1,u);f[l]=s[l];var h=c.slice();h.sort();var d=!R.util.arraysEqual(h,fi(0,u).slice(0,u-1)),p=function(){if(d){var x=R.reshape(a.movingMean.read(),f),N=R.reshape(a.movingVariance.read(),f),T=a.center?R.reshape(a.beta.read(),f):null,E=a.scale?R.reshape(a.gamma.read(),f):null;return If(o,x,N,T,E,a.epsilon)}else return If(o,a.movingMean.read(),a.movingVariance.read(),a.beta==null?null:a.beta.read(),a.gamma==null?null:a.gamma.read(),a.epsilon)};if(!i)return p();var v=te(dbe(o,a.gamma.read(),a.beta.read(),c,a.epsilon),3),m=v[0],g=v[1],y=v[2],b=function(x,N,T){_.tidy(function(){var E=1-T,C=x.read(),F=_.mul(_.sub(C,N),E);x.write(_.sub(C,F))})},w=function(){b(a.movingMean,g,a.momentum),b(a.movingVariance,y,a.momentum)};return w(),m})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mn(this.betaInitializer),gammaInitializer:mn(this.gammaInitializer),movingMeanInitializer:mn(this.movingMeanInitializer),movingVarianceInitializer:mn(this.movingVarianceInitializer),betaRegularizer:zt(this.betaRegularizer),gammaRegularizer:zt(this.gammaRegularizer),betaConstraint:Wn(this.betaConstraint),gammaConstraint:Wn(this.gammaConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);w1.className="BatchNormalization";R.serialization.registerClass(w1);var x1=function(n){se(e,n);function e(t){var r,a,i=this;if(t==null&&(t={}),i=n.call(this,t)||this,i.axis=t.axis==null?-1:t.axis,typeof i.axis=="number"){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received ".concat(i.axis))}else if(Array.isArray(i.axis))try{for(var o=fe(i.axis),s=o.next();!s.done;s=o.next()){var u=s.value;if(!Number.isInteger(u))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(i.axis)))}}catch(c){r={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}else throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(i.axis)));return i.epsilon=t.epsilon==null?.001:t.epsilon,i.center=t.center==null?!0:t.center,i.scale=t.scale==null?!0:t.scale,i.betaInitializer=cn(t.betaInitializer||"zeros"),i.gammaInitializer=cn(t.gammaInitializer||"ones"),i.betaRegularizer=ln(t.betaRegularizer),i.gammaRegularizer=ln(t.gammaRegularizer),i.supportsMasking=!0,i}return e.prototype.build=function(t){var r,a;t=It(t);var i=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=i);try{for(var s=fe(this.axis),u=s.next();!u.done;u=s.next()){var c=u.value;if(c<0||c>=i)throw new Error("Invalid axis: ".concat(c))}}catch(h){r={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}if(this.axis.length!==zo(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var l=this.axis.map(function(h){return t[h]}),f=!0;this.scale?this.gamma=this.addWeight("gamma",l,"float32",this.gammaInitializer,this.gammaRegularizer,f):this.gamma=null,this.center?this.beta=this.addWeight("beta",l,"float32",this.betaInitializer,this.betaRegularizer,f):this.beta=null,this.built=!0},e.prototype.call=function(t,r){var a=this,i=it(t),o=i.shape,s=o.length;return R.tidy(function(){var u,c,l=!0,f=R.moments(i,a.axis,l),h=f.mean,d=f.variance,p=Ms(1,s);try{for(var v=fe(a.axis),m=v.next();!m.done;m=v.next()){var g=m.value;p[g]=o[g]}}catch(E){u={error:E}}finally{try{m&&!m.done&&(c=v.return)&&c.call(v)}finally{if(u)throw u.error}}for(var y=function(E){return E!=null&&E.shape.length!==s?_.reshape(E,p):E},b=a.scale?y(a.gamma.read()):null,w=a.center?y(a.beta.read()):null,x=[],N=[],T=0;T<s;++T)a.axis.indexOf(T)!==-1?(x.push(o[T]),N.push(1)):(x.push(1),N.push(o[T]));return h=_.tile(h,x),d=_.tile(d,x),b!=null&&(b=_.tile(b,N)),w!=null&&(w=_.tile(w,N)),If(i,h,d,w,b,a.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mn(this.betaInitializer),gammaInitializer:mn(this.gammaInitializer),betaRegularizer:zt(this.betaRegularizer),gammaRegularizer:zt(this.gammaRegularizer)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);x1.className="LayerNormalization";R.serialization.registerClass(x1);function pbe(n,e,t){return R.tidy(function(){if(n.rank!==4)throw new J("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(n.rank,"-D tensor."));if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new J("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=hi()),t!=="channelsLast"&&t!=="channelsFirst")throw new J("Unknown data format: ".concat(t,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],_.pad(n,r)})}var k1=function(n){se(e,n);function e(t){var r=this;if(t==null&&(t={}),r=n.call(this,t)||this,r.dataFormat=t.dataFormat==null?hi():t.dataFormat,t.padding==null)r.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")r.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new J("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(t.padding.length," array."));var a=void 0,i=void 0;if(typeof t.padding[0]=="number")a=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new J("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(t.padding[0].length," array."));if(a=t.padding[0],t.padding[1].length!==2)throw new J("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(t.padding[1].length," array."));i=t.padding[1]}r.padding=[a,i]}return r.inputSpec=[new Ln({ndim:4})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r,a;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?r=t[2]+this.padding[0][0]+this.padding[0][1]:r=null,t[3]!=null&&t[3]>=0?a=t[3]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],t[1],r,a]):(t[1]!=null&&t[1]>=0?r=t[1]+this.padding[0][0]+this.padding[0][1]:r=null,t[2]!=null&&t[2]>=0?a=t[2]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],r,a,t[3]])},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return pbe(it(t),a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);k1.className="ZeroPadding2D";R.serialization.registerClass(k1);function mv(n,e,t,r,a,i){return R.tidy(function(){Dn(a),$O(i),pa(r),t==null&&(t=[1,1]),r==null&&(r="valid"),a==null&&(a=hi()),i==null&&(i="max"),n=Vb(n,a);var o,s=r==="same"?"same":"valid";return i==="max"?o=_.maxPool(n,e,t,s):o=_.avgPool(n,e,t,s),a==="channelsFirst"&&(o=_.transpose(o,[0,3,1,2])),o})}function XM(n,e,t,r,a,i){return R.tidy(function(){Dn(a),$O(i),pa(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),a==null&&(a=hi()),i==null&&(i="max"),n=VM(n,a);var o,s=r==="same"?"same":"valid";return i==="max"?o=_.maxPool3d(n,e,t,s):o=_.avgPool3d(n,e,t,s),a==="channelsFirst"&&(o=_.transpose(o,[0,4,1,2,3])),o})}var YM=function(n){se(e,n);function e(t){var r=this;if(t.poolSize==null&&(t.poolSize=2),r=n.call(this,t)||this,typeof t.poolSize=="number")r.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")r.poolSize=t.poolSize;else throw new J("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.poolSize)));if(Kn(r.poolSize,"poolSize"),t.strides==null)r.strides=r.poolSize;else if(typeof t.strides=="number")r.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")r.strides=t.strides;else throw new J("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.strides)));return Kn(r.strides,"strides"),r.padding=t.padding==null?"valid":t.padding,pa(r.padding),r.inputSpec=[new Ln({ndim:3})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=li(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],r,t[2]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r),t=Af(it(t),2);var i=a.poolingFunction(it(t),[a.poolSize[0],1],[a.strides[0],1],a.padding,"channelsLast");return _.squeeze(i,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),S1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),pa(i),mv(t,r,a,i,o,"max")},e}(YM);S1.className="MaxPooling1D";R.serialization.registerClass(S1);var N1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),pa(i),mv(t,r,a,i,o,"avg")},e}(YM);N1.className="AveragePooling1D";R.serialization.registerClass(N1);var ZM=function(n){se(e,n);function e(t){var r=this;if(t.poolSize==null&&(t.poolSize=[2,2]),r=n.call(this,t)||this,r.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)r.strides=r.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new J("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(t.strides.length,"."));r.strides=t.strides}else r.strides=[t.strides,t.strides];return Kn(r.poolSize,"poolSize"),Kn(r.strides,"strides"),r.padding=t.padding==null?"valid":t.padding,r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(r.dataFormat),pa(r.padding),r.inputSpec=[new Ln({ndim:4})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2];return r=li(r,this.poolSize[0],this.padding,this.strides[0]),a=li(a,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],r,a]:[t[0],r,a,t[3]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return a.invokeCallHook(t,r),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),T1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),pa(i),mv(t,r,a,i,o,"max")},e}(ZM);T1.className="MaxPooling2D";R.serialization.registerClass(T1);var E1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),pa(i),mv(t,r,a,i,o,"avg")},e}(ZM);E1.className="AveragePooling2D";R.serialization.registerClass(E1);var JM=function(n){se(e,n);function e(t){var r=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),r=n.call(this,t)||this,r.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)r.strides=r.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new J("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(t.strides.length,"."));r.strides=t.strides}else r.strides=[t.strides,t.strides,t.strides];return Kn(r.poolSize,"poolSize"),Kn(r.strides,"strides"),r.padding=t.padding==null?"valid":t.padding,r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(r.dataFormat),pa(r.padding),r.inputSpec=[new Ln({ndim:5})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return r=li(r,this.poolSize[0],this.padding,this.strides[0]),a=li(a,this.poolSize[1],this.padding,this.strides[1]),i=li(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],r,a,i]:[t[0],r,a,i,t[4]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return a.invokeCallHook(t,r),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),I1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),pa(i),XM(t,r,a,i,o,"max")},e}(JM);I1.className="MaxPooling3D";R.serialization.registerClass(I1);var C1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),pa(i),XM(t,r,a,i,o,"avg")},e}(JM);C1.className="AveragePooling3D";R.serialization.registerClass(C1);var QM=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.inputSpec=[new Ln({ndim:3})],r}return e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,r){throw new pt},e}(gt),A1=function(n){se(e,n);function e(t){return n.call(this,t||{})||this}return e.prototype.call=function(t,r){return R.tidy(function(){var a=it(t);return _.mean(a,1)})},e}(QM);A1.className="GlobalAveragePooling1D";R.serialization.registerClass(A1);var _1=function(n){se(e,n);function e(t){return n.call(this,t||{})||this}return e.prototype.call=function(t,r){return R.tidy(function(){var a=it(t);return _.max(a,1)})},e}(QM);_1.className="GlobalMaxPooling1D";R.serialization.registerClass(_1);var e4=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(r.dataFormat),r.inputSpec=[new Ln({ndim:4})],r}return e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,r){throw new pt},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),D1=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?_.mean(i,[1,2]):_.mean(i,[2,3])})},e}(e4);D1.className="GlobalAveragePooling2D";R.serialization.registerClass(D1);var F1=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?_.max(i,[1,2]):_.max(i,[2,3])})},e}(e4);F1.className="GlobalMaxPooling2D";R.serialization.registerClass(F1);var t4=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.layer=t.layer,r}return e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null?this.layer.trainable:!1},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.setFastWeightInitDuringBuild=function(t){n.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,r,a){a===void 0&&(a={});var i=r.layer,o=ci(i,a);delete r.layer;var s={layer:o};return Object.assign(s,r),new t(s)},e}(gt),R1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r}return e.prototype.build=function(t){if(t=It(t),t.length<3)throw new J("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(t)));this.inputSpec=[{shape:t}];var r=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),n.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){t=It(t);var r=[t[0]].concat(t.slice(2)),a=this.layer.computeOutputShape(r),i=t[1];return[a[0],i].concat(a.slice(1))},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i=function(u,c){var l=it(a.layer.call(u,r));return[l,[]]},o=KM(i,t,[],!1,null,null,!1,!0),s=o[1];return s})},e}(t4);R1.className="TimeDistributed";R.serialization.registerClass(R1);function vbe(n){Ls(mfe,"BidirectionalMergeMode",n)}var mbe="concat",O1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this,a=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=a,r.forwardLayer=ci(i),a.goBackwards=a.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=a,r.backwardLayer=ci(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=t.mergeMode===void 0?mbe:t.mergeMode,vbe(r.mergeMode),t.weights)throw new pt("weights support is not implemented for Bidirectional layer yet.");return r._stateful=t.layer.stateful,r.returnSequences=t.layer.returnSequences,r.returnState=t.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=t.layer.inputSpec,r.numConstants=null,r}return Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var r=t.length,a=Math.floor(r/2);this.forwardLayer.setWeights(t.slice(0,a)),this.backwardLayer.setWeights(t.slice(a))},e.prototype.computeOutputShape=function(t){var r=this.forwardLayer.computeOutputShape(t);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;var a,i,o;return this.returnState&&(o=r.slice(1)),a=r[0],a=a,this.mergeMode==="concat"?(a[a.length-1]*=2,i=[a]):this.mergeMode==null?i=[a,a.slice()]:i=[a],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[a].concat(o).concat(o.slice()):Ir(i)},e.prototype.apply=function(t,r){var a,i,o=r==null?null:r.initialState,s=r==null?null:r.constants;r==null&&(r={});var u=HM(t,o,s,this.numConstants);if(t=u.inputs,o=u.initialState,s=u.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return n.prototype.apply.call(this,t,r);var c=[],l=[];if(o!=null){var f=o.length;if(f%2>0)throw new J("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,c.push.apply(c,Qe([],te(o),!1));var h=o.map(function(x){return new Ln({shape:x.shape})});this.forwardLayer.stateSpec=h.slice(0,f/2),this.backwardLayer.stateSpec=h.slice(f/2),l.push.apply(l,Qe([],te(h),!1))}if(s!=null)throw new pt("Support for constants in Bidirectional layers is not implemented yet.");var d=c[0]instanceof ui;try{for(var p=fe(c),v=p.next();!v.done;v=p.next()){var m=v.value;if(m instanceof ui!==d)throw new J("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(x){a={error:x}}finally{try{v&&!v.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}}if(d){var g=[t].concat(c),y=this.inputSpec.concat(l),b=this.inputSpec;this.inputSpec=y;var w=n.prototype.apply.call(this,g,r);return this.inputSpec=b,w}else return n.prototype.apply.call(this,t,r)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r.initialState,o,s;if(i==null)o=a.forwardLayer.call(t,r),s=a.backwardLayer.call(t,r);else{var u=i.slice(0,i.length/2),c=i.slice(i.length/2);o=a.forwardLayer.call(t,Object.assign(r,{initialState:u})),s=a.backwardLayer.call(t,Object.assign(r,{initialState:c}))}var l;a.returnState&&(Array.isArray(o)&&(l=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),a.returnSequences&&(s=_.reverse(s,1));var f;return a.mergeMode==="concat"?f=jy([o,s]):a.mergeMode==="sum"?f=_.add(o,s):a.mergeMode==="ave"?f=_.mul(.5,_.add(o,s)):a.mergeMode==="mul"?f=_.mul(o,s):a.mergeMode==null&&(f=[o,s]),a.returnState?a.mergeMode==null?f.concat(l):[f].concat(l):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var r=this;Os(this.forwardLayer.name,function(){r.forwardLayer.build(t)}),Os(this.backwardLayer.name,function(){r.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,r){Array.isArray(r)&&(r=r[0]);var a;if(this.returnSequences?this.mergeMode==null?a=[r,r]:a=r:this.mergeMode==null?a=[null,null]:a=null,this.returnState){var i=this.forwardLayer.states,o=i.map(function(s){return null});return Array.isArray(a)?a.concat(o).concat(o):[a].concat(o).concat(o)}else return a},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){n.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.fromConfig=function(t,r){var a=ci(r.layer);if(delete r.layer,r.numConstants!=null)throw new pt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=r;return i.layer=a,new t(i)},e}(t4);O1.className="Bidirectional";R.serialization.registerClass(O1);var P1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.scale=t.scale,t.offset?r.offset=t.offset:r.offset=0,r}return e.prototype.getConfig=function(){var t={scale:this.scale,offset:this.offset},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return t=it(t),t.dtype!=="float32"&&(t=Ri(t,"float32")),R.add(R.mul(t,a.scale),a.offset)})},e}(gt);P1.className="Rescaling";R.serialization.registerClass(P1);var gbe=R.image.resizeBilinear,ybe=R.image.cropAndResize,M1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.height=t.height,r.width=t.width,r}return e.prototype.centerCrop=function(t,r,a,i,o,s,u,c){return R.tidy(function(){var l,f=!1,h=r/s,d=a/u,p=(i+r)/s,v=(o+a)/u,m=[h,d,p,v],g=[];t.rank===3?(f=!0,l=R.stack([t])):l=t;for(var y=0;y<l.shape[0];y++)g.push(m);var b=R.tensor(g,[g.length,4]),w=R.range(0,g.length,1,"int32"),x=[i,o],N=ybe(l,b,w,x,"nearest");return Ri(f?it(R.unstack(N)):N,c)})},e.prototype.upsize=function(t,r,a,i){return R.tidy(function(){var o=gbe(t,[r,a]);return Ri(o,i)})},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=it(t),o=i.dtype,s=i.shape,u=s[s.length-3],c=s[s.length-2],l=0;u!==a.height&&(l=Math.floor((u-a.height)/2));var f=0;return c!==a.width&&(f=Math.floor((c-a.width)/2),f===0&&(f=1)),l>=0&&f>=0?a.centerCrop(i,l,f,a.height,a.width,u,c,o):a.upsize(t,a.height,a.width,o)})},e.prototype.getConfig=function(){var t={height:this.height,width:this.width},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.computeOutputShape=function(t){t=It(t);var r=t.length-3,a=t.length-2;return t[r]=this.height,t[a]=this.width,t},e}(gt);M1.className="CenterCrop";R.serialization.registerClass(M1);function bbe(n,e,t,r){var a=it(n);if(a.dtype!=="int32"&&(a=Ri(a,"int32")),e==="int")return a;var i=a.shape;if(a.rank===0&&(a=R.expandDims(a,-1)),e==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=R.expandDims(a,-1)),a.rank>2)throw new J("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(e," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o=["multiHot","oneHot"].includes(e),s=a,u;if(typeof r<"u"&&e==="count"?u=R.denseBincount(s,r,t,o):u=R.denseBincount(s,[],t,o),e!=="tfIdf")return u;if(r)return R.mul(u,r);throw new J("When outputMode is 'tfIdf', weights must be provided.")}var B1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.numTokens=t.numTokens,t.outputMode?r.outputMode=t.outputMode:r.outputMode="multiHot",r}return e.prototype.getConfig=function(){var t={numTokens:this.numTokens,outputMode:this.outputMode},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.computeOutputShape=function(t){return t=It(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t),t.dtype!=="int32"&&(t=Ri(t,"int32"));var i;if(typeof r.countWeights<"u"){if(a.outputMode!=="count")throw new J(`countWeights is not used when outputMode !== count.
              Received countWeights=`.concat(r.countWeights));i=it(r.countWeights)}var o=R.max(t),s=R.min(t),u=R.greater(a.numTokens,o).bufferSync().get(0),c=R.greaterEqual(s,0).bufferSync().get(0);if(!(u&&c))throw new J("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(a.numTokens));return bbe(t,a.outputMode,a.numTokens,i)})},e}(gt);B1.className="CategoryEncoding";R.serialization.registerClass(B1);var wbe=["bilinear","nearest"],OO=new Set(wbe),L1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.height=t.height,r.width=t.width,t.interpolation)if(OO.has(t.interpolation))r.interpolation=t.interpolation;else throw new J("Invalid interpolation parameter: ".concat(t.interpolation," is not implemented"));else r.interpolation="bilinear";return r.cropToAspectRatio=Boolean(t.cropToAspectRatio),r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=t[2];return[this.height,this.width,r]},e.prototype.getConfig=function(){var t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=[a.height,a.width];if(a.interpolation==="bilinear")return R.image.resizeBilinear(t,i,!a.cropToAspectRatio);if(a.interpolation==="nearest")return R.image.resizeNearestNeighbor(t,i,!a.cropToAspectRatio);throw new Error("Interpolation is ".concat(a.interpolation," but only ").concat(Qe([],te(OO),!1)," are supported"))})},e}(gt);L1.className="Resizing";R.serialization.registerClass(L1);function xbe(n){return new vc(n)}function kbe(n){return new $b(n)}function Sbe(n){return new Bb(n)}function Nbe(n){return new Lb(n)}function Tbe(n){return new zb(n)}function Ebe(n){return new Wb(n)}function Ibe(n){return new qb(n)}function Cbe(n){return new Kb(n)}function Abe(n){return new cv(n)}function _be(n){return new Gb(n)}function Dbe(n){return new lv(n)}function Fbe(n){return new Ub(n)}function Rbe(n){return new Hb(n)}function Obe(n){return new jb(n)}function Pbe(n){return new Xb(n)}function Mbe(n){return new Yb(n)}function Bbe(n){return new a1(n)}function Lbe(n){return new n1(n)}function zbe(n){return new vv(n)}function $be(n){return new t1(n)}function qbe(n){return new r1(n)}function Wbe(n){return new i1(n)}function Vbe(n){return new o1(n)}function Gbe(n){return new s1(n)}function Ube(n){return new c1(n)}function Hbe(n){return new l1(n)}function Kbe(n){return new h1(n)}function jbe(n){return new v1(n)}function Xbe(n){return new d1(n)}function Ybe(n){return new p1(n)}function Zbe(n){return new f1(n)}function Jbe(n){return new m1(n)}function Qbe(n){return new w1(n)}function e1e(n){return new x1(n)}function t1e(n){return new k1(n)}function z1(n){return new N1(n)}function n1e(n){return z1(n)}function r1e(n){return z1(n)}function $1(n){return new E1(n)}function a1e(n){return $1(n)}function i1e(n){return $1(n)}function q1(n){return new C1(n)}function o1e(n){return q1(n)}function s1e(n){return q1(n)}function u1e(n){return new A1(n)}function c1e(n){return new D1(n)}function n4(n){return new _1(n)}function r4(n){return new F1(n)}function a4(n){return new S1(n)}function i4(n){return new T1(n)}function l1e(n){return new I1(n)}function f1e(n){return new Jb(n)}function h1e(n){return new hv(n)}function d1e(n){return new Qb(n)}function p1e(n){return new Mf(n)}function v1e(n){return new Zb(n)}function m1e(n){return new fv(n)}function g1e(n){return new e1(n)}function y1e(n){return new pv(n)}function b1e(n){return new ro(n)}function w1e(n){return new dv(n)}function x1e(n){return new O1(n)}function k1e(n){return new R1(n)}var S1e=n4,N1e=r4,T1e=a4,E1e=i4;function I1e(n){return new g1(n)}function C1e(n){return new y1(n)}function A1e(n){return new b1(n)}function _1e(n){return new u1(n)}function D1e(n){return new P1(n)}function F1e(n){return new M1(n)}function R1e(n){return new L1(n)}function O1e(n){return new B1(n)}var P1e={__proto__:null,inputLayer:xbe,elu:kbe,reLU:Sbe,leakyReLU:Nbe,prelu:Tbe,softmax:Ebe,thresholdedReLU:Ibe,conv1d:Cbe,conv2d:Abe,conv2dTranspose:_be,conv3d:Dbe,conv3dTranspose:Fbe,separableConv2d:Rbe,cropping2D:Obe,upSampling2d:Pbe,depthwiseConv2d:Mbe,activation:Bbe,dense:Lbe,dropout:zbe,spatialDropout1d:$be,flatten:qbe,repeatVector:Wbe,reshape:Vbe,permute:Gbe,embedding:Ube,add:Hbe,average:Kbe,concatenate:jbe,maximum:Xbe,minimum:Ybe,multiply:Zbe,dot:Jbe,batchNormalization:Qbe,layerNormalization:e1e,zeroPadding2d:t1e,averagePooling1d:z1,avgPool1d:n1e,avgPooling1d:r1e,averagePooling2d:$1,avgPool2d:a1e,avgPooling2d:i1e,averagePooling3d:q1,avgPool3d:o1e,avgPooling3d:s1e,globalAveragePooling1d:u1e,globalAveragePooling2d:c1e,globalMaxPooling1d:n4,globalMaxPooling2d:r4,maxPooling1d:a4,maxPooling2d:i4,maxPooling3d:l1e,gru:f1e,gruCell:h1e,lstm:d1e,lstmCell:p1e,simpleRNN:v1e,simpleRNNCell:m1e,convLstm2d:g1e,convLstm2dCell:y1e,rnn:b1e,stackedRNNCells:w1e,bidirectional:x1e,timeDistributed:k1e,globalMaxPool1d:S1e,globalMaxPool2d:N1e,maxPool1d:T1e,maxPool2d:E1e,Layer:gt,RNN:ro,RNNCell:yc,input:CM,gaussianNoise:I1e,gaussianDropout:C1e,alphaDropout:A1e,masking:_1e,rescaling:D1e,centerCrop:F1e,resizing:R1e,categoryEncoding:O1e};function M1e(n,e){return Db(n,e)}function B1e(n,e){return bM(n,e)}function L1e(n,e){return wM(n,e)}function z1e(n,e){return Fb(n,e)}function $1e(n,e){return Rb(n,e)}function q1e(n,e){return yM(n,e)}function W1e(n,e){return kye(n,e)}function V1e(n,e){return _b(n,e)}function G1e(n,e){return iv(n,e)}function U1e(n,e){return gc(n,e)}function H1e(n,e){return gc(n,e)}function K1e(n,e){return gc(n,e)}function j1e(n,e){return Hs(n,e)}function X1e(n,e){return Hs(n,e)}function Y1e(n,e){return Hs(n,e)}var Z1e={__proto__:null,binaryAccuracy:M1e,binaryCrossentropy:B1e,sparseCategoricalAccuracy:L1e,categoricalAccuracy:z1e,categoricalCrossentropy:$1e,precision:q1e,recall:W1e,cosineProximity:V1e,meanAbsoluteError:G1e,meanAbsolutePercentageError:U1e,MAPE:H1e,mape:K1e,meanSquaredError:j1e,MSE:X1e,mse:Y1e};var J1e={__proto__:null,modelFromJSON:Zye};function Q1e(n){return new Pf(n)}function ewe(n){return abe(n)}function twe(n){return ibe(n)}var nwe={__proto__:null,l1l2:Q1e,l1:ewe,l2:twe},o4=function(n){se(e,n);function e(){var t=n.apply(this,Qe([],te(arguments),!1))||this;return t.model=null,t}return e.prototype.setModel=function(t){if(!(t instanceof no))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(pc);function Sp(n,e){return n<e}function PO(n,e){return n>e}var s4=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new pt("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=t.monitor||"val_loss",r.minDelta=Math.abs(t.minDelta||0),r.patience=t.patience||0,r.verbose=t.verbose||0,r.mode=t.mode||"auto",r.baseline=t.baseline,["auto","min","max"].indexOf(r.mode)===-1&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. ")+"Falling back to mode 'auto'."),r.mode="auto"),r.mode==="min"?r.monitorFunc=Sp:r.mode==="max"||r.monitor.indexOf("acc")!==-1?r.monitorFunc=PO:r.monitorFunc=Sp,r.monitorFunc===Sp&&(r.minDelta*=-1),r}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===Sp?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return[4,Bo(r)];case 1:return i.sent(),a=this.getMonitorValue(r),a==null?[2]:(this.monitorFunc(a-this.minDelta,this.best)?(this.best=a,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping.")),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var r=t[this.monitor];return r==null&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. ")+"Available metrics are: ".concat(Object.keys(t))),r},e}(o4);function rwe(n){return new s4(n)}var awe={earlyStopping:rwe};Qt.Callback=o4;Qt.CallbackList=hM;Qt.CustomCallback=pM;Qt.EarlyStopping=s4;Qt.History=dM;Qt.InputSpec=Ln;Qt.LayerVariable=HO;Qt.LayersModel=no;Qt.RNN=ro;Qt.Sequential=sv;Qt.SymbolicTensor=ui;Qt.callbacks=awe;Qt.constraints=K0e;Qt.initializers=cye;Qt.input=CM;Qt.layers=P1e;Qt.loadLayersModel=Jye;Qt.metrics=Z1e;Qt.model=tbe;Qt.models=J1e;Qt.registerCallbackConstructor=rbe;Qt.regularizers=nwe;Qt.sequential=nbe;Qt.version_layers=Ob});var VB=Y(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});var Be=As();function iwe(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}function owe(n,e){return e.forEach(function(t){Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})}),n}var c4=iwe(Be);var swe=Be.env();swe.registerFlag("KEEP_INTERMEDIATE_TENSORS",function(){return!1},function(n){n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var K1=function(n,e){return K1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},K1(n,e)};function uwe(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");K1(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Pt(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function _t(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Sc(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ne(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function yn(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var za;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(za||(za={}));var l4;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(l4||(l4={}));var bw={};function cwe(n,e){var t={tfOpName:n,category:"custom",inputs:[],attrs:[],customExecutor:e};bw[n]=t}function $4(n){return bw[n]}function lwe(n){delete bw[n]}function I(n,e,t,r,a){var i=e.inputParams[n];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,s=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd;if(i.type==="tensor")return gr(e.inputNames[i.inputIndexStart],t,r,a);if(i.type==="tensors"){var u=e.inputNames.slice(o,s);return u.map(function(h){return gr(h,t,r,a)})}var c=gr(e.inputNames.slice(o)[0],t,r,a),l=c.dataSync();return i.type==="number"?l[0]:Be.util.toNestedArray(c.shape,l)}var f=e.attrParams[n];return f&&f.value}function gr(n,e,t,r){var a=Ne(Zr(n),2),i=a[0],o=a[1];if(r!=null){var s=r.getHashTableHandleByName(i);if(s!=null)return s}var u=t.currentContextIds.find(function(c){return!!e[kv(i,c)]});return u!==void 0?e[kv(i,u)][o]:void 0}function fwe(n,e,t){return e[kv(n,t.currentContextId)]}function ao(n,e){var t=Ne(Zr(n),3),r=t[0],a=t[1],i=t[2];return[kv(r,e&&e.currentContextId),a,i]}function kv(n,e){return e?"".concat(n,"-").concat(e):n}function Zr(n){var e=n.split(":");if(e.length===1)return[n,0,void 0];var t=e[0],r=e.length===3?e[1]:void 0,a=Number(e[e.length-1]);return[t,a,r]}function yv(n,e,t){var r=I("pad",n,e,t);if(r==="explicit"){r=I("explicitPaddings",n,e,t);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[i*2],a[i][1]=r[i*2+1];return a}return r}function io(n){return n.kept?n:Be.clone(n)}var hwe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],dwe={__proto__:null,json:hwe};var pwe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],vwe={__proto__:null,json:pwe};var mwe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],gwe={__proto__:null,json:mwe};var ywe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],bwe={__proto__:null,json:ywe};var wwe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],xwe={__proto__:null,json:wwe};var kwe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Swe={__proto__:null,json:kwe};var Nwe=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Twe={__proto__:null,json:Nwe};var Ewe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Iwe={__proto__:null,json:Ewe};var Cwe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Awe={__proto__:null,json:Cwe};var _we=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Dwe={__proto__:null,json:_we};var Fwe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Rwe={__proto__:null,json:Fwe};var Owe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],Pwe={__proto__:null,json:Owe};var Mwe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],Bwe={__proto__:null,json:Mwe};var Lwe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],zwe={__proto__:null,json:Lwe};var $we=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],qwe={__proto__:null,json:$we};var Wwe=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Vwe={__proto__:null,json:Wwe};var Gwe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Uwe={__proto__:null,json:Gwe};var Hwe=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Kwe={__proto__:null,json:Hwe};var jwe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Xwe={__proto__:null,json:jwe},f4=function(){function n(){var e=[dwe,vwe,gwe,bwe,xwe,Swe,Twe,Iwe,Awe,Dwe,Rwe,Pwe,Bwe,zwe,qwe,Vwe,Uwe,Kwe,Xwe],t=[].concat.apply([],yn([],Ne(e.map(function(r){return r.json})),!1));this.opMappers=t.reduce(function(r,a){return r[a.tfOpName]=a,r},{})}return Object.defineProperty(n,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!1,configurable:!0}),n.prototype.transformGraph=function(e,t){var r=this;t===void 0&&(t={});var a=e.node,i=[],o=[],s=[],u=a.reduce(function(m,g){return m[g.name]=r.mapNode(g),g.op.startsWith("Placeholder")?i.push(m[g.name]):g.op==="Const"?o.push(m[g.name]):(g.input==null||g.input.length===0)&&s.push(m[g.name]),m},{}),c=[],l=[],f={},h={};t!=null&&(f=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));var d=Object.keys(u);d.forEach(function(m){var g=u[m];g.inputNames.forEach(function(y,b){var w=Ne(ao(y),3),x=w[0],N=w[2],T=u[x];if(T.outputs!=null){var E=T.outputs.indexOf(N);if(E!==-1){var C="".concat(x,":").concat(E);g.inputNames[b]=C}}g.inputs.push(T),T.children.push(g)})}),Object.keys(h).length===0?d.forEach(function(m){var g=u[m];g.children.length===0&&l.push(g)}):Object.keys(h).forEach(function(m){var g=Ne(ao(m),1),y=g[0],b=u[y];b!=null&&(b.signatureKey=h[m],l.push(b))}),Object.keys(f).length>0?Object.keys(f).forEach(function(m){var g=Ne(ao(m),1),y=g[0],b=u[y];b&&(b.signatureKey=f[m],c.push(b))}):c=i;var p={};e.library!=null&&e.library.function!=null&&(p=e.library.function.reduce(function(m,g){return m[g.signature.name]=r.mapFunction(g),m},{}));var v={nodes:u,inputs:c,outputs:l,weights:o,placeholders:i,signature:t,functions:p};return s.length>0&&(v.initNodes=s),v},n.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,r){return t[e[r].name]=r,t},{})},n.prototype.mapNode=function(e){var t=$4(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var r={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(a){return a.startsWith("^")?a.slice(1):a}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(r.inputParams=t.inputs.reduce(function(a,i){return a[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},a},{})),t.attrs!=null&&(r.attrParams=t.attrs.reduce(function(a,i){var o=i.type,s=void 0;switch(i.type){case"string":s=j1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=j1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":s=tw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=tw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":s=Y1(e.attr,i.tfName,i.defaultValue||0),s===void 0&&!!i.tfDeprecatedName&&(s=Y1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":s=ew(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=ew(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":s=X1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=X1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":s=rw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=rw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":s=Q1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Q1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":s=nw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=nw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":s=Z1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Z1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":s=J1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=J1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":s=h4(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=h4(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(i.type," for op: ").concat(e.op))}return a[i.name]={value:s,type:o},a},{})),r},n.prototype.mapFunction=function(e){var t=this,r=e.nodeDef,a=[],i=[],o={};r!=null&&(o=r.reduce(function(h,d){return h[d.name]=t.mapNode(d),d.op==="Const"&&i.push(h[d.name]),h},{}));var s=[],u=[];e.signature.inputArg.forEach(function(h){var d=Ne(ao(h.name),1),p=d[0],v={name:p,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:ww(h.type),type:"dtype"}},children:[]};v.signatureKey=h.name,s.push(v),o[p]=v});var c=Object.keys(o);c.forEach(function(h){var d=o[h];d.inputNames.forEach(function(p,v){var m=Ne(ao(p),3),g=m[0],y=m[2],b=o[g];if(b.outputs!=null){var w=b.outputs.indexOf(y);if(w!==-1){var x="".concat(g,":").concat(w);d.inputNames[v]=x}}d.inputs.push(b),b.children.push(d)})});var l=e.ret;e.signature.outputArg.forEach(function(h){var d=Ne(ao(l[h.name]),2),p=d[0],v=d[1],m=o[p];m!=null&&(m.defaultOutput=v,u.push(m))});var f=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:u,weights:i,placeholders:a,signature:f}},n.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(r,a){return r[a.name]=t.mapArgToTensorInfo(a),r},{}),outputs:e.signature.outputArg.reduce(function(r,a){return r[a.name]=t.mapArgToTensorInfo(a,e.ret),r},{})}},n.prototype.mapArgToTensorInfo=function(e,t){var r=e.name;return t!=null&&(r=t[r]),{name:r,dtype:e.type}},n}();function Ywe(n){var e=Be.env().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function q4(n,e){var t=Array.isArray(n)?String.fromCharCode.apply(null,n):Ywe(n);return e?t:t.toLowerCase()}function j1(n,e,t,r){r===void 0&&(r=!1);var a=n[e];return a!=null?q4(a.s,r):t}function X1(n,e,t){var r=n[e];return r?r.b:t}function Y1(n,e,t){var r=n[e]||{},a=r.i!=null?r.i:r.f!=null?r.f:t;return typeof a=="number"?a:parseInt(a,10)}function ww(n){switch(typeof n=="string"&&(n=za[n]),n){case za.DT_FLOAT:case za.DT_HALF:return"float32";case za.DT_INT32:case za.DT_INT64:case za.DT_INT8:case za.DT_UINT8:return"int32";case za.DT_BOOL:return"bool";case za.DT_DOUBLE:return"float32";case za.DT_STRING:return"string";default:return null}}function h4(n,e,t){var r=n[e];return r&&r.func?r.func.name:t}function Z1(n,e,t){var r=n[e];return r&&r.type?ww(r.type):t}function J1(n,e,t){var r=n[e];return r&&r.list&&r.list.type?r.list.type.map(function(a){return ww(a)}):t}function W4(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function Q1(n,e,t){var r=n[e];return r&&r.shape?W4(r.shape):t}function ew(n,e,t){var r=n[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(function(a){return typeof a=="number"?a:parseInt(a,10)}):t}function tw(n,e,t,r){r===void 0&&(r=!1);var a=n[e];return a&&a.list&&a.list.s?a.list.s.map(function(i){return q4(i,r)}):t}function nw(n,e,t){var r=n[e];return r&&r.list&&r.list.shape?r.list.shape.map(function(a){return W4(a)}):t}function rw(n,e,t){var r=n[e];return r&&r.list&&r.list.b?r.list.b:t}var Zwe=function(){function n(e,t,r){var a=this;this.node=e,this.tensorMap=t,this.context=r,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(i){return a.getInput(i)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(i,o){return i[o]=a.getAttr(o),i},{}))}return n.prototype.getInput=function(e){return gr(e,this.tensorMap,this.context)},n.prototype.getAttr=function(e,t){var r=this.node.rawAttrs[e];if(r.tensor!=null)return gr(e,this.tensorMap,this.context);if(r.i!=null||r.f!=null)return Y1(this.node.rawAttrs,e,t);if(r.s!=null)return j1(this.node.rawAttrs,e,t);if(r.b!=null)return X1(this.node.rawAttrs,e,t);if(r.shape!=null)return Q1(this.node.rawAttrs,e,t);if(r.type!=null)return Z1(this.node.rawAttrs,e,t);if(r.list!=null){if(r.list.i!=null||r.list.f!=null)return ew(this.node.rawAttrs,e,t);if(r.list.s!=null)return tw(this.node.rawAttrs,e,t);if(r.list.shape!=null)return nw(this.node.rawAttrs,e,t);if(r.list.b!=null)return rw(this.node.rawAttrs,e,t);if(r.list.type!=null)return J1(this.node.rawAttrs,e,t)}return t},n}();var Jwe=1e-7,Qwe=1e-4,exe=function(){function n(){}return n.prototype.refCount=function(e){return Yr("refCount")},n.prototype.incRef=function(e){return Yr("incRef")},n.prototype.timerAvailable=function(){return!0},n.prototype.time=function(e){return Yr("time")},n.prototype.read=function(e){return Yr("read")},n.prototype.readSync=function(e){return Yr("readSync")},n.prototype.readToGPU=function(e,t){return Yr("readToGPU")},n.prototype.numDataIds=function(){return Yr("numDataIds")},n.prototype.disposeData=function(e,t){return Yr("disposeData")},n.prototype.write=function(e,t,r){return Yr("write")},n.prototype.move=function(e,t,r,a,i){return Yr("move")},n.prototype.createTensorFromGPUData=function(e,t,r){return Yr("createTensorFromGPUData")},n.prototype.memory=function(){return Yr("memory")},n.prototype.floatPrecision=function(){return Yr("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?Jwe:Qwe},n.prototype.dispose=function(){return Yr("dispose")},n}();function Yr(n){throw new Error("'".concat(n,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function G(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Ua(n,e,t){t===void 0&&(t=""),G(Ac(n,e),function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}function Cc(n){G(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Fr(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Ac(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Uf(n){return n%1===0}function bv(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function Dv(n,e){var t=e.length;return n=n==null?e.map(function(r,a){return a}):[].concat(n),G(n.every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(n)}),G(n.every(function(r){return Uf(r)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(n)}),n.map(function(r){return r<0?t+r:r})}function txe(n,e){for(var t=[],r=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Dv(e,n).sort(),o=0,s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(n[s],"' is not 1"));(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function nxe(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type ".concat(n));return t}function rxe(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(n));return t}function axe(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(r,"."))}}function ixe(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function aw(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype ".concat(n))}function oxe(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function xw(n){return typeof n=="string"||n instanceof String}function sxe(n){return typeof n=="boolean"}function uxe(n){return typeof n=="number"}function kw(n){return Array.isArray(n)?kw(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":uxe(n)?"float32":xw(n)?"string":sxe(n)?"bool":"float32"}function d4(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Sw(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function V4(n,e,t,r){r===void 0&&(r=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(r?2:1),o=0;o<i;o++)a[o]=t[n+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(r?2:1),o=0;o<i;o++)a[o]=V4(n+o*u,s,t,r);return a}function p4(n,e,t){if(t===void 0&&(t=!1),n.length===0)return e[0];var r=n.reduce(function(a,i){return a*i})*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error("[".concat(n,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return V4(0,n,e,t)}function G4(n,e){for(var t=Nw(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Nw(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type ".concat(e))}function ga(n){n.forEach(function(e){G(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(n,"].")})})}function Tw(n){return n&&n.then&&typeof n.then=="function"}var v4="tfjsflags",cxe=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=lxe,this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&(ma().getBool("IS_TEST")||ma().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var a=this.urlFlags[e];ma().getBool("IS_TEST")||ma().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},n.prototype.getAsync=function(e){return Pt(this,void 0,void 0,function(){var t,r;return _t(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=a.sent(),[2,this.flags[e]]}})})},n.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Tw(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(v4 in t){var r=t[v4].split(",");r.forEach(function(a){var i=Ne(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=hxe(o,s)})}}},n}();function lxe(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return fxe(e,r[0],r[1]),r.join("=")}),e}function fxe(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function hxe(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if("".concat(+e)===e)return+e;throw new Error("Could not parse value flag value ".concat(e," for flag ").concat(n,"."))}function ma(){return U4}var U4=null;function dxe(n){U4=n}var W1;function H4(){if(W1==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");W1=n}return W1}function pxe(){var n=H4();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Ew(n,e){var t=pxe();if(t.has(n))return t.get(n);var r=e();return t.set(n,r),t.get(n)}var vxe="Abs",mxe="Acos",gxe="Acosh",K4="Add",yxe="AddN",bxe="All",wxe="Any",xxe="ArgMax",kxe="ArgMin",Sxe="Asin",Nxe="Asinh",Txe="Atan",Exe="Atanh",Ixe="Atan2",Cxe="AvgPool",Axe="AvgPool3D",_xe="BatchMatMul",Dxe="BatchToSpaceND",Fxe="Bincount",Rxe="BroadcastArgs",j4="Cast",Oxe="Ceil",Pxe="ClipByValue",Mxe="Complex",Bxe="ComplexAbs",Lxe="Concat",zxe="Conv2D",$xe="Conv2DBackpropFilter",qxe="Conv2DBackpropInput",Wxe="Conv3D",Vxe="Conv3DBackpropInputV2",Gxe="Cos",Uxe="Cosh",Hxe="Cumprod",Kxe="Cumsum",jxe="CropAndResize",Xxe="DenseBincount",Yxe="DepthToSpace",Zxe="DepthwiseConv2dNative",Jxe="DepthwiseConv2dNativeBackpropFilter",Qxe="DepthwiseConv2dNativeBackpropInput",eke="Diag",tke="Dilation2D",nke="RealDiv",rke="Einsum",ake="Elu",ike="Erf",oke="Equal",ske="Exp",uke="ExpandDims",cke="Expm1",lke="FFT",fke="Fill",hke="FlipLeftRight",dke="Floor",pke="FloorDiv",vke="FusedBatchNorm",mke="GatherV2",gke="GatherNd",yke="Greater",bke="GreaterEqual",X4="Identity",wke="IFFT",xke="Imag",kke="IsFinite",Ske="IsInf",Nke="IsNan",Tke="LeakyRelu",Eke="Less",Ike="LessEqual",Cke="LinSpace",Ake="Log",_ke="Log1p",Dke="LogicalAnd",Fke="LogicalNot",Rke="LogicalOr",Oke="LRN",Pke="Max",Mke="Maximum",Bke="MaxPool",Lke="MaxPool3D",zke="MaxPoolWithArgmax",$ke="Mean",qke="Min",Wke="Minimum",Vke="MirrorPad",Gke="Mod",Uke="Multinomial",Hke="Multiply",Kke="Neg",jke="NotEqual",Xke="NonMaxSuppressionV3",Yke="NonMaxSuppressionV4",Zke="NonMaxSuppressionV5",Jke="OnesLike",Qke="OneHot",e2e="Pack",t2e="PadV2",n2e="Pow",r2e="Prelu",a2e="Prod",i2e="RaggedGather",o2e="RaggedRange",s2e="RaggedTensorToTensor",u2e="Range",c2e="Real",l2e="Reciprocal",f2e="Relu",h2e="Reshape",d2e="ResizeNearestNeighbor",p2e="ResizeBilinear",v2e="Relu6",m2e="Reverse",g2e="Round",y2e="Rsqrt",b2e="ScatterNd",w2e="SearchSorted",x2e="Select",k2e="Selu",S2e="Slice",N2e="Sin",T2e="Sinh",E2e="Sign",I2e="Sigmoid",C2e="Softplus",A2e="Sqrt",_2e="Sum",D2e="SpaceToBatchND",F2e="SplitV",R2e="Softmax",O2e="SparseFillEmptyRows",P2e="SparseReshape",M2e="SparseSegmentMean",B2e="SparseSegmentSum",L2e="SparseToDense",z2e="SquaredDifference",$2e="StridedSlice",q2e="StringNGrams",W2e="StringSplit",V2e="StringToHashBucketFast",G2e="Sub",U2e="Tan",H2e="Tanh",Y4="Tile",K2e="TopK",j2e="Transform",V1="Transpose",X2e="Unique",Y2e="Unpack",Z2e="UnsortedSegmentSum",J2e="ZerosLike",Q2e="Step",eSe="RotateWithOffset",m4="_FusedMatMul",g4="FusedConv2D",y4="FusedDepthwiseConv2D";function Bf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];ma().getBool("IS_TEST")||ma().getBool("PROD")||console.warn.apply(console,yn([],Ne(n),!1))}var Z4=Ew("kernelRegistry",function(){return new Map}),tSe=Ew("gradRegistry",function(){return new Map});function b4(n,e){var t=nSe(n,e);return Z4.get(t)}function w4(n){return tSe.get(n)}function x4(n){for(var e=Z4.entries(),t=[];;){var r=e.next(),a=r.done,i=r.value;if(a)break;var o=Ne(i,2),s=o[0],u=o[1],c=Ne(s.split("_"),1),l=c[0];l===n&&t.push(u)}return t}function nSe(n,e){return"".concat(e,"_").concat(n)}var iw=tn,Wa=null;try{Wa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function tn(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}tn.prototype.__isLong__;Object.defineProperty(tn.prototype,"__isLong__",{value:!0});function ea(n){return(n&&n.__isLong__)===!0}tn.isLong=ea;var k4={},S4={};function eu(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=S4[n],r)?r:(t=nn(n,(n|0)<0?-1:0,!0),a&&(S4[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=k4[n],r)?r:(t=nn(n,n<0?-1:0,!1),a&&(k4[n]=t),t))}tn.fromInt=eu;function Va(n,e){if(isNaN(n))return e?Xs:Ga;if(e){if(n<0)return Xs;if(n>=J4)return tB}else{if(n<=-T4)return Jr;if(n+1>=T4)return eB}return n<0?Va(-n,e).neg():nn(n%Nc|0,n/Nc|0,e)}tn.fromNumber=Va;function nn(n,e,t){return new tn(n,e,t)}tn.fromBits=nn;var Sv=Math.pow;function Iw(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ga;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Iw(n.substring(1),e,t).neg();for(var a=Va(Sv(t,8)),i=Ga,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Va(Sv(t,s));i=i.mul(c).add(Va(u))}else i=i.mul(a),i=i.add(Va(u))}return i.unsigned=e,i}tn.fromString=Iw;function wi(n,e){return typeof n=="number"?Va(n,e):typeof n=="string"?Iw(n,e):nn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}tn.fromValue=wi;var N4=1<<16,rSe=1<<24,Nc=N4*N4,J4=Nc*Nc,T4=J4/2,E4=eu(rSe),Ga=eu(0);tn.ZERO=Ga;var Xs=eu(0,!0);tn.UZERO=Xs;var bc=eu(1);tn.ONE=bc;var Q4=eu(1,!0);tn.UONE=Q4;var ow=eu(-1);tn.NEG_ONE=ow;var eB=nn(-1,2147483647,!1);tn.MAX_VALUE=eB;var tB=nn(-1,-1,!0);tn.MAX_UNSIGNED_VALUE=tB;var Jr=nn(0,-2147483648,!1);tn.MIN_VALUE=Jr;var Re=tn.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*Nc+(this.low>>>0):this.high*Nc+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Jr)){var t=Va(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Va(Sv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Jr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return ea(e)||(e=wi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(ea(e)||(e=wi(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(Jr)?Jr:this.not().add(bc)};Re.neg=Re.negate;Re.add=function(e){ea(e)||(e=wi(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,d=0;return d+=i+c,h+=d>>>16,d&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,nn(h<<16|d,l<<16|f,this.unsigned)};Re.subtract=function(e){return ea(e)||(e=wi(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return Ga;if(ea(e)||(e=wi(e)),Wa){var t=Wa.mul(this.low,this.high,e.low,e.high);return nn(t,Wa.get_high(),this.unsigned)}if(e.isZero())return Ga;if(this.eq(Jr))return e.isOdd()?Jr:Ga;if(e.eq(Jr))return this.isOdd()?Jr:Ga;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(E4)&&e.lt(E4))return Va(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,d=0,p=0;return p+=o*l,d+=p>>>16,p&=65535,d+=i*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,nn(d<<16|p,f<<16|h,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(ea(e)||(e=wi(e)),e.isZero())throw Error("division by zero");if(Wa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Wa.div_u:Wa.div_s)(this.low,this.high,e.low,e.high);return nn(t,Wa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Xs:Ga;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Xs;if(e.gt(this.shru(1)))return Q4;i=Xs}else{if(this.eq(Jr)){if(e.eq(bc)||e.eq(ow))return Jr;if(e.eq(Jr))return bc;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ga)?e.isNegative()?bc:ow:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(Jr))return this.unsigned?Xs:Ga;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ga}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:Sv(2,s-48),c=Va(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Va(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=bc),i=i.add(c),a=a.sub(l)}return i};Re.div=Re.divide;Re.modulo=function(e){if(ea(e)||(e=wi(e)),Wa){var t=(this.unsigned?Wa.rem_u:Wa.rem_s)(this.low,this.high,e.low,e.high);return nn(t,Wa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return nn(~this.low,~this.high,this.unsigned)};Re.and=function(e){return ea(e)||(e=wi(e)),nn(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return ea(e)||(e=wi(e)),nn(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return ea(e)||(e=wi(e)),nn(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return ea(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):nn(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return ea(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):nn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(ea(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return nn(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?nn(t,0,this.unsigned):nn(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?nn(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:nn(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};tn.fromBytes=function(e,t,r){return r?tn.fromBytesLE(e,t):tn.fromBytesBE(e,t)};tn.fromBytesLE=function(e,t){return new tn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};tn.fromBytesBE=function(e,t){return new tn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var aSe=owe({__proto__:null,default:iw},[iw]),iSe=iw||aSe;function Cw(n){return iSe.fromString(n,!0,16)}Cw("c3a5c85c97cb3127");Cw("b492b66fbe98f273");Cw("9ae16a3b2f90404f");function oSe(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function nB(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Hf(n)),ma().getBool("DEBUG")&&axe(n,e),oSe(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var t=new Uint8Array(n.length),r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Nv(){return ma().platform.now()}function sSe(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ma().platform.encode(n,e)}function I4(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ma().platform.decode(n,e)}function bi(n){return ma().platform.isTypedArray(n)}function Hf(n,e,t){var r,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Tw(n)||n==null||bi(n)&&t)e.push(n);else if(Array.isArray(n)||bi(n))for(var i=0;i<n.length;++i)Hf(n[i],e,t);else{var o=-1;try{for(var s=Sc(Object.keys(n)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){r={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}for(var i=0;i<=o;i++)Hf(n[i],e,t)}return e}var uSe=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new lSe)}return n.prototype.profileKernel=function(e,t,r){var a,i,o,s=function(){o=r()},u,c=Nv();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=Sc(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Nv()-c})}if(ma().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var d=function(m){var g=o[m];g.data().then(function(y){cSe(y,g.dtype,e)})},p=0;p<o.length;p++)d(p);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},n.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(r,u,c[0],c[1],o,c[2])})})},n}();function cSe(n,e,t){if(e!=="float32")return!1;for(var r=0;r<n.length;r++){var a=n[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var lSe=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,a,i,o){var s=typeof a=="number"?bv("".concat(a,"ms"),9):a.error,u=bv(e,25),c=t.rank,l=t.size,f=bv(t.shape.toString(),14),h="";for(var d in i){var p=i[d];if(p!=null){var v=p.shape||t.shape,m=v.length;h+="".concat(d,": ").concat(m,"D ").concat(m>0?v:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function fSe(n,e,t){for(var r={},a={},i=0;i<e.length;i++)r[e[i].id]=!0;for(var i=0;i<n.length;i++){var o=n[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(r[c.id]){o.outputs.forEach(function(b){return r[b.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var d={},i=n.length-1;i>=0;i--)for(var o=n[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,d[o.id]=!0;break}for(var p=[],i=0;i<n.length;i++){var o=n[i];if(a[o.id]&&d[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,p.push(g)}}return p}function hSe(n,e,t,r){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var d=n[h.id];d!=null?u.push(d):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var d=t(function(){return c[h]()});if(d.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(d.dtype,"'"));var p=s.inputs[h];if(!Ac(d.shape,p.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(d.shape,"', which does not match ")+"the shape of the input '".concat(p.shape,"'"));if(n[p.id]==null)n[p.id]=d;else{var v=n[p.id];n[p.id]=r(v,d),v.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var C4=20,Lf=3,G1=7;function dSe(n,e,t,r){var a=Sw(e),i=pSe(n,e,t,a),o=e.length,s=wv(n,e,t,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function pSe(n,e,t,r){var a=Fr(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Wf(n):n;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],qf(u[l+f],0,t).length);return o}function qf(n,e,t){var r;return Array.isArray(n)?r="".concat(parseFloat(n[0].toFixed(G1))," + ")+"".concat(parseFloat(n[1].toFixed(G1)),"j"):xw(n)?r="'".concat(n,"'"):t==="bool"?r=rB(n):r=parseFloat(n.toFixed(G1)).toString(),bv(r,e)}function rB(n){return n===0?"false":"true"}function wv(n,e,t,r,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Wf(n);return[qf(c[0],0,t)]}return t==="bool"?[rB(n[0])]:[n[0].toString()]}if(u===1){if(s>C4){var l=Lf*o,f=Array.from(n.slice(0,l)),h=Array.from(n.slice((s-Lf)*o,s*o));return t==="complex64"&&(f=Wf(f),h=Wf(h)),["["+f.map(function(T,E){return qf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return qf(T,a[s-Lf+E],t)}).join(", ")+"]"]}var d=t==="complex64"?Wf(n):Array.from(n);return["["+d.map(function(T,E){return qf(T,a[E],t)}).join(", ")+"]"]}var p=e.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>C4){for(var y=0;y<Lf;y++){var b=y*m,w=b+m;g.push.apply(g,yn([],Ne(wv(n.slice(b,w),p,t,v,a,!1)),!1))}g.push("...");for(var y=s-Lf;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,yn([],Ne(wv(n.slice(b,w),p,t,v,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,yn([],Ne(wv(n.slice(b,w),p,t,v,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var N=`,
`,y=2;y<u;y++)N+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function Wf(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var sw=function(){function n(e,t,r){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Fr(e),r!=null){var i=r.length;G(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||rxe(t,this.size),this.strides=Sw(e)}return n.prototype.set=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),G(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e,t,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r.length===0&&(r=[0]);var i=0;try{for(var o=Sc(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(r,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=r[r.length-1],f=0;f<r.length-1;++f)l+=this.strides[f]*r[f];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.toTensor=function(){return gi().makeTensor(this.values,this.shape,this.dtype)},n}(),gi=null,zf=null;function vSe(n){gi=n}var _r=function(){function n(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Fr(e),this.strides=Sw(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.buffer=function(){return Pt(this,void 0,void 0,function(){var e;return _t(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,zf.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return zf.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Pt(this,void 0,void 0,function(){var e;return _t(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,p4(this.shape,e,this.dtype==="complex64")]}})})},n.prototype.arraySync=function(){return p4(this.shape,this.dataSync(),this.dtype==="complex64")},n.prototype.data=function(){return Pt(this,void 0,void 0,function(){var e,t;return _t(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=gi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(a){return I4(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataToGPU=function(e){return this.throwIfDisposed(),gi().readToGPU(this.dataId,e)},n.prototype.dataSync=function(){this.throwIfDisposed();var e=gi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return I4(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Pt(this,void 0,void 0,function(){var e;return _t(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,gi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(gi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.print=function(e){return e===void 0&&(e=!1),zf.print(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),zf.clone(this)},n.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return dSe(t,this.shape,this.dtype,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),zf.cast(this,e)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),gi().makeVariable(this,e,t,r)},n}();Object.defineProperty(_r,Symbol.hasInstance,{value:function(n){return!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null}});function mSe(){return Ew("Tensor",function(){return _r})}mSe();var uw=function(n){uwe(e,n);function e(t,r,a,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Ac(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));gi().disposeTensor(this),this.dataId=t.dataId,gi().incRef(this,null)},e.prototype.dispose=function(){gi().disposeVariable(this),this.isDisposedInternal=!0},e}(_r);Object.defineProperty(uw,Symbol.hasInstance,{value:function(n){return n instanceof _r&&n.assign!=null&&n.assign instanceof Function}});var A4;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(A4||(A4={}));var cw;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(cw||(cw={}));var lw;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(lw||(lw={}));var fw;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(fw||(fw={}));var hw;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(hw||(hw={}));var gSe={float32:fw,int32:cw,bool:lw,complex64:hw};function ySe(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(n," with ").concat(e))}return gSe[n][e]}function Cn(n,e){if(n.dtype===e.dtype)return[n,e];var t=ySe(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function bSe(n,e){G(n.dtype===e.dtype,function(){return"The dtypes of the first(".concat(n.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function aB(n){var e=[],t=new Set;return iB(n,e,t),e}function iB(n,e,t){if(n!=null){if(n instanceof _r){e.push(n);return}if(!!wSe(n)){var r=n;for(var a in r){var i=r[a];t.has(i)||(t.add(i),iB(i,e,t))}}}}function wSe(n){return Array.isArray(n)||typeof n=="object"}function U1(n){return n.kernelName!=null}var _4=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),Aw=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new _4}return n.prototype.ready=function(){return Pt(this,void 0,void 0,function(){var e,t,r,a;return _t(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,r=e.asyncInit;if(r)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(Bf("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Pt(this,void 0,void 0,function(){var t,r,a,i,o;return _t(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,a=t.asyncInit,a?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new uSe(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this,t=x4(this.backendName);t.forEach(function(r){r.setupFunc!=null&&r.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this,r=x4(e);r.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=r.factory();if(a&&!(a instanceof exe)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Bf("Initialization of backend ".concat(e," failed")),Bf(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Bf("Initialization of backend ".concat(e," failed")),Bf(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],a=this.initializeBackend(r),i=a.success,o=a.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},n.prototype.scopedRun=function(e,t,r){e();try{var a=r();return t(),a}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=Q.runKernel(X4,{x:e}),r={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return Q.runKernel(j4,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t},n.prototype.runKernel=function(e,t,r){this.backendName==null&&this.backend;var a=b4(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var a=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},n.prototype.runKernelFunc=function(e){var t=this,r,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=U1(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(U1(e)){var f=e.kernelName,h=e.inputs,d=e.attrs;this.backendName==null&&this.backend;var p=b4(f,this.backendName);G(p!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=p.kernelFunc({inputs:h,attrs:d,backend:t.backend});var N=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,N);var T=N.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var v=e.forwardFunc,m=function(x){!i||(a=x.map(function(N){return t.keep(t.clone(N))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return v(t.backend,m)});var N=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,N),N}}var g=e.inputs,y=e.attrs,b=U1(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?r=u():(w=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),r=w.outputs)}),i&&this.addTapeNode(l,g,r,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:r.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(c)?r:r[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this,r=e.map(function(a){return t.keep(t.clone(a))});return r},n.prototype.getTensorsForGradient=function(e,t,r){var a=w4(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(G(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return o[l]});return s.concat(u)}return[]},n.prototype.makeTensor=function(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var i=e;r==="string"&&xw(e[0])&&(i=e.map(function(l){return sSe(l)}));var o=a.write(i,t,r),s=new _r(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){var u=this.state.tensorInfo.get(o),c=oxe(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,a){r=r||"float32";var i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)},n.prototype.makeTensorFromTensorInfo=function(e,t){var r=e.dataId,a=e.shape,i=e.dtype,o=new _r(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o},n.prototype.makeVariable=function(e,t,r,a){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new uw(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*aw(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof uw||this.track(e)},n.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},n.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},n.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var r=e.size*aw(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Pt(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return _t(this,function(d){switch(d.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=d.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,yn([],Ne(this.state.activeProfile.kernels.map(function(p){return p.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,d.label=2;case 2:d.trys.push([2,8,9,10]),i=Sc(this.state.activeProfile.kernels),o=i.next(),d.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=d.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=d.sent(),d.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=d.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=w4(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var d=r[h],p=Nw(d.size,d.dtype);return s.makeTensor(p,d.shape,d.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=aB(e),a=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},n.prototype.gradients=function(e,t,r,a){var i=this;if(a===void 0&&(a=!1),G(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(r.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});G(o instanceof _r,function(){return"The result y returned by f() must be a tensor."});var s=fSe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=r??xSe(o.shape),hSe(u,s,function(l){return i.tidy(l)},SSe);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var d=Sc(l.saved),p=d.next();!p.done;p=d.next()){var v=p.value;v.dispose()}}catch(m){f={error:m}}finally{try{p&&!p.done&&(h=d.return)&&h.call(d)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},n.prototype.customGrad=function(e){var t=this;return G(d4(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];G(r.every(function(c){return c instanceof _r}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};r.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,yn([],Ne(yn(yn([],Ne(r),!1),[l],!1)),!1)),G(i.value instanceof _r,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),G(d4(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];G(h.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),G(h.every(function(p){return p instanceof _r}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return h.forEach(function(p,v){d[v]=function(){return p}}),d};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},n.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},n.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},n.prototype.readToGPU=function(e,t){var r=this.state.tensorInfo.get(e);return r.backend.readToGPU(e,t)},n.prototype.time=function(e){return Pt(this,void 0,void 0,function(){var t,r;return _t(this,function(a){switch(a.label){case 0:return t=Nv(),[4,this.backend.time(e)];case 1:return r=a.sent(),r.wallMs=Nv()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new _4;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n}();Aw.nextTensorId=0;Aw.nextVariableId=0;function xSe(n){var e=G4(Fr(n),"float32");return Q.makeTensor(e,n,"float32")}function kSe(){var n=H4();if(n._tfengine==null){var e=new cxe(n);n._tfengine=new Aw(e)}return dxe(n._tfengine.ENV),vSe(function(){return n._tfengine}),n._tfengine}var Q=kSe();function SSe(n,e){var t={a:n,b:e};return Q.runKernel(K4,t)}function Ho(n,e){var t=n;if(bi(n))return e==="string"?[]:[n.length];var r=typeof n=="object";if(r){if("texture"in n){var a=n.channels||"RGBA";return[n.height,n.width*a.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:aw(e))]}if(!Array.isArray(n))return[];for(var i=[];Array.isArray(t)||bi(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&ma().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&oB(n,i,[]),i}function oB(n,e,t){if(t=t||[],!Array.isArray(n)&&!bi(n)){G(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}G(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(n.length," elements")}),G(n.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(n.length," elements")});for(var r=e.slice(1),a=0;a<n.length;++a)oB(n[a],r,t.concat(a))}function D4(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(r,"' must ")+"be ".concat(n," tensor, but got ").concat(e," tensor"))}}function M(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof _r)return D4(r,n.dtype,e,t),n;var a=kw(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),D4(r,a,e,t),n==null||!bi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Ho(n,a);!bi(n)&&!Array.isArray(n)&&(n=[n]);var s=!0,u=a!=="string"?nB(n,a):Hf(n,[],s);return Q.makeTensor(u,o,a)}function Tv(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=n;return a.map(function(i,o){return M(i,"".concat(e,"[").concat(o,"]"),t,r)})}var sB="__op";function K(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+sB;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Q.startScope(t);try{var s=r.apply(void 0,yn([],Ne(i),!1));return Tw(s)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(s),s}catch(u){throw Q.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function NSe(n){var e=M(n,"x","abs");if(e.dtype==="complex64"){var t={x:e};return Q.runKernel(Bxe,t)}else{var t={x:e};return Q.runKernel(vxe,t)}}var $a=K({abs_:NSe});function TSe(n){var e=M(n,"x","acos"),t={x:e};return Q.runKernel(mxe,t)}var ESe=K({acos_:TSe});function ISe(n){var e=M(n,"x","acosh"),t={x:e};return Q.runKernel(gxe,t)}var CSe=K({acosh_:ISe});function ASe(n,e){var t,r=M(n,"a","add"),a=M(e,"b","add");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(K4,i)}var jn=K({add_:ASe});function _Se(n){G(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),G(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(n.length)});var e=n.map(function(a,i){return M(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!Ac(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return Q.runKernel(yxe,r)}var DSe=K({addN_:_Se});function FSe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","all","bool"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(bxe,a,i)}var RSe=K({all_:FSe});function OSe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","any","bool"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(wxe,a,i)}var PSe=K({any_:OSe});function MSe(n,e){e===void 0&&(e=0);var t=M(n,"x","argMax"),r={x:t},a={axis:e};return Q.runKernel(xxe,r,a)}var BSe=K({argMax_:MSe});function LSe(n,e){e===void 0&&(e=0);var t=M(n,"x","argMin"),r={x:t},a={axis:e};return Q.runKernel(kxe,r,a)}var zSe=K({argMin_:LSe});function $Se(n){var e=M(n,"x","asin"),t={x:e};return Q.runKernel(Sxe,t)}var qSe=K({asin_:$Se});function WSe(n){var e=M(n,"x","asinh"),t={x:e};return Q.runKernel(Nxe,t)}var VSe=K({asinh_:WSe});function GSe(n){var e=M(n,"x","atan"),t={x:e};return Q.runKernel(Txe,t)}var USe=K({atan_:GSe});function HSe(n,e){var t,r=M(n,"a","atan2"),a=M(e,"b","atan2");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(Ixe,i)}var KSe=K({atan2_:HSe});function jSe(n){var e=M(n,"x","atanh"),t={x:e};return Q.runKernel(Exe,t)}var XSe=K({atanh_:jSe});function YSe(n,e){var t=M(n,"x","cast");if(!ixe(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={x:t},a={dtype:e};return Q.runKernel(j4,r,a)}var rr=K({cast_:YSe});function ZSe(n,e,t,r,a,i,o){o===void 0&&(o="channelsLast");var s=Ne(Kf(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,n[3],n[3]];else if(o==="channelsFirst")l=[u,c,n[1],n[1]];else throw new Error("Unknown dataFormat ".concat(o));return _w(n,l,t,r,a,i,!1,o)}function _w(n,e,t,r,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=Ne([-1,-1,-1,-1],4),f=l[0],h=l[1],d=l[2],p=l[3];if(s==="channelsLast")u=Ne(n,4),f=u[0],h=u[1],d=u[2],p=u[3];else if(s==="channelsFirst")c=Ne(n,4),f=c[0],p=c[1],h=c[2],d=c[3];else throw new Error("Unknown dataFormat ".concat(s));var v=Ne(e,4),m=v[0],g=v[1],y=v[3],b=Ne(Kf(t),2),w=b[0],x=b[1],N=Ne(Kf(r),2),T=N[0],E=N[1],C=dw(m,T),F=dw(g,E),D=eNe(a,h,d,w,x,C,F,i,s),O=D.padInfo,L=D.outHeight,z=D.outWidth,$=o?y*p:y,B;return s==="channelsFirst"?B=[f,$,L,z]:s==="channelsLast"&&(B=[f,L,z,$]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:d,inChannels:p,outHeight:L,outWidth:z,outChannels:$,padInfo:O,strideHeight:w,strideWidth:x,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:F,dilationHeight:T,dilationWidth:E,inShape:n,outShape:B,filterShape:e}}function JSe(n,e,t,r,a){r==null&&(r=QSe(n,e,t));var i=n[0],o=n[1],s=Ev((i-e+2*r)/t+1,a),u=Ev((o-e+2*r)/t+1,a);return[s,u]}function QSe(n,e,t,r){r===void 0&&(r=1);var a=dw(e,r);return Math.floor((n[0]*(t-1)-t+a)/2)}function Kf(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function dw(n,e){return e<=1?n:n+(n-1)*(e-1)}function eNe(n,e,t,r,a,i,o,s,u){var c,l,f;if(typeof n=="number"){var h=n===0?"VALID":"NUMBER";c={top:n,bottom:n,left:n,right:n,type:h};var d=JSe([e,t],i,r,n,s);l=d[0],f=d[1]}else if(n==="same"){l=Math.ceil(e/r),f=Math.ceil(t/a);var p=Math.max(0,(l-1)*r+i-e),v=Math.max(0,(f-1)*a+o-t),m=Math.floor(p/2),g=p-m,y=Math.floor(v/2),b=v-y;c={top:m,bottom:g,left:y,right:b,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/a);else if(typeof n=="object"){var m=u==="channelsLast"?n[1][0]:n[2][0],g=u==="channelsLast"?n[1][1]:n[2][1],y=u==="channelsLast"?n[2][0]:n[3][0],b=u==="channelsLast"?n[2][1]:n[3][1],h=m===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";c={top:m,bottom:g,left:y,right:b,type:h},l=Ev((e-i+m+g)/r+1,s),f=Ev((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(n));return{padInfo:c,outHeight:l,outWidth:f}}function Ev(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode ".concat(e))}}function Iv(n){var e=Ne(Kf(n),3),t=e[0],r=e[1],a=e[2];return t===1&&r===1&&a===1}function Ko(n,e){return Iv(n)||Iv(e)}function Tc(n){return Kf(n).every(function(e){return e>0})}function xi(n,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")G(Uf(e),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(r){r.forEach(function(a){G(Uf(a),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(n,": Unknown padding parameter: ").concat(e))}}function tNe(n,e){var t=M(n,"x","reshape","string_or_numeric"),r={x:t},a={shape:e};return Q.runKernel(h2e,r,a)}var ge=K({reshape_:tNe});function nNe(n,e,t,r,a){var i=M(n,"x","avgPool","float32"),o=1;G(Ko(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),xi("avgPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=Q.runKernel(Cxe,c,l);return f=rr(f,i.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var uB=K({avgPool_:nNe});function rNe(n,e,t,r,a,i){i===void 0&&(i="NDHWC");var o=M(n,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),G(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),xi("avgPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(Axe,c,l);return f=rr(f,s.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var aNe=K({avgPool3d_:rNe});function iNe(n){var e=M(n,"x","clone","string_or_numeric"),t={x:e};return Q.runKernel(X4,t)}var wc=K({clone_:iNe});function oNe(n,e){e===void 0&&(e=0),G(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Tv(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return wc(t[0]);var r=t,a={axis:e};return Q.runKernel(Lxe,r,a)}var Qr=K({concat_:oNe});function sNe(n,e,t,r){var a;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=M(n,"a","matMul"),o=M(e,"b","matMul");a=Ne(Cn(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:r};return Q.runKernel(_xe,s,u)}var Bt=K({matMul_:sNe});function uNe(n,e){var t,r=M(n,"a","mul"),a=M(e,"b","mul");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(Hke,i)}var mt=K({mul_:uNe});function cNe(n){var e=M(n,"x","sigmoid","float32"),t={x:e};return Q.runKernel(I2e,t)}var xc=K({sigmoid_:cNe});function lNe(n,e,t){var r=M(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:e,size:t};return Q.runKernel(S2e,a,i)}var fn=K({slice_:lNe});function fNe(n){var e=M(n,"x","tanh","float32"),t={x:e};return Q.runKernel(H2e,t)}var pw=K({tanh_:fNe});function hNe(n,e,t,r,a,i){var o=M(n,"forgetBias","basicLSTMCell"),s=M(e,"lstmKernel","basicLSTMCell"),u=M(t,"lstmBias","basicLSTMCell"),c=M(r,"data","basicLSTMCell"),l=M(a,"c","basicLSTMCell"),f=M(i,"h","basicLSTMCell"),h=Qr([c,f],1),d=Bt(h,s),p=jn(d,u),v=p.shape[0],m=p.shape[1]/4,g=[v,m],y=fn(p,[0,0],g),b=fn(p,[0,m],g),w=fn(p,[0,m*2],g),x=fn(p,[0,m*3],g),N=jn(mt(xc(y),pw(b)),mt(l,xc(jn(o,w)))),T=mt(pw(N),xc(x));return[N,T]}var dNe=K({basicLSTMCell_:hNe});function pNe(n,e,t){var r=M(n,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});G(r.rank>=1+e.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(e.length)}),G(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),G(r.shape[0]%a===0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:r},o={blockShape:e,crops:t};return Q.runKernel(Dxe,i,o)}var cB=K({batchToSpaceND_:pNe});function vNe(n){var e;return n.rank===0||n.rank===1?e=ge(n,[1,1,1,n.size]):n.rank===2?e=ge(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function mNe(n,e,t,r,a,i){i==null&&(i=.001);var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;r!=null&&(l=M(r,"offset","batchNorm")),G(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),G(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),G(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=vNe(o),h={x:f,scale:c,offset:l,mean:s,variance:u},d={varianceEpsilon:i},p=Q.runKernel(vke,h,d);return ge(p,o.shape)}var Fv=K({batchNorm_:mNe});function gNe(n,e,t,r,a,i){var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return r!=null&&(l=M(r,"offset","batchNorm")),G(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),G(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),Fv(o,s,u,l,c,i)}var yNe=K({batchNorm2d_:gNe});function bNe(n,e,t,r,a,i){var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return r!=null&&(l=M(r,"offset","batchNorm")),G(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),G(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),Fv(o,s,u,l,c,i)}var wNe=K({batchNorm3d_:bNe});function xNe(n,e,t,r,a,i){var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return r!=null&&(l=M(r,"offset","batchNorm")),G(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),G(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),Fv(o,s,u,l,c,i)}var kNe=K({batchNorm4d_:xNe});function SNe(n,e,t){var r=M(n,"x","bincount"),a=M(e,"weights","bincount");G(r.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(a.size===r.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:r,weights:a},o={size:t};return Q.runKernel(Fxe,i,o)}var lB=K({bincount_:SNe});function NNe(n,e){var t=M(n,"s0","broadcastArgs","int32"),r=M(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(r.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:t,s1:r};return Q.runKernel(Rxe,a)}var TNe=K({broadcastArgs_:NNe});function ENe(n,e){var t=M(n,"broadcastTo","x"),r=t.shape;if(ga(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ge(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return wc(t);var c={x:t},l={reps:o};return Q.runKernel(Y4,c,l)}var xv=K({broadcastTo_:ENe});function Uo(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",ga(n),new sw(n,e,t)}function INe(n){var e=M(n,"x","ceil","float32"),t={x:e};return Q.runKernel(Oxe,t)}var CNe=K({ceil_:INe});function Rv(n,e,t){ga(n);var r={shape:n,value:e,dtype:t};return Q.runKernel(fke,{},r)}function ANe(n,e,t){var r=M(n,"x","clipByValue");if(G(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return Rv(r.shape,e,r.dtype);var a={x:r},i={clipValueMin:e,clipValueMax:t};return Q.runKernel(Pxe,a,i)}var _Ne=K({clipByValue_:ANe});function DNe(n,e){var t=M(n,"real","complex"),r=M(e,"imag","complex");Ua(t.shape,r.shape,"real and imag shapes, ".concat(t.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:r};return Q.runKernel(Mxe,a)}var Zs=K({complex_:DNe});function FNe(n){return Qr(n,0)}var RNe=K({concat1d_:FNe});function ONe(n,e){return Qr(n,e)}var PNe=K({concat2d_:ONe});function MNe(n,e){return Qr(n,e)}var BNe=K({concat3d_:MNe});function LNe(n,e){return Qr(n,e)}var zNe=K({concat4d_:LNe});function $Ne(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(n,"x","conv2d","float32"),u=M(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),xi("conv2d",r,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),G(Ko(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(Tc(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),G(Tc(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=Q.runKernel(zxe,h,d);return l?ge(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Ov=K({conv2d_:$Ne});function qNe(n,e,t,r,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=M(n,"x","conv1d"),u=M(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1]])),G(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),G(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),xi("conv1d",r,o),G(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),G(Ko(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),G(Tc(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),G(Tc(t),function(){return"Error in conv1D: Stride should be larger than 0."}),G(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ge(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ge(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=[1,t],p=[1,i],v="NHWC",m=Ov(h,f,d,r,v,p,o);return l?ge(m,[m.shape[2],m.shape[3]]):ge(m,[m.shape[0],m.shape[2],m.shape[3]])}var WNe=K({conv1d_:qNe});function VNe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC"),G(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var s=n,u=e,c=!1;e.rank===3&&(c=!0,u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),G(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),G(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),G(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];G(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),G(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),xi("conv2dDerInput",a,o);var h={dy:u,filter:t},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=Q.runKernel(qxe,h,d);return c?ge(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var fB=K({conv2DBackpropInput_:VNe});function GNe(n,e,t,r,a,i){var o=M(n,"x","conv2dTranspose"),s=M(e,"filter","conv2dTranspose");return fB(t,o,s,r,a,"NHWC",i)}var UNe=K({conv2dTranspose_:GNe});function HNe(n,e,t,r,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=M(n,"x","conv3d"),s=M(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),G(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),G(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),G(Ko(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),G(Tc(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),G(Tc(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:r,dataFormat:a,dilations:i},h=Q.runKernel(Wxe,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var KNe=K({conv3d_:HNe});function jNe(n,e,t,r,a){G(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var i=n,o=e,s=!1;e.rank===4&&(s=!0,o=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=o.shape[4];G(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),G(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),G(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),G(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),G(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=Q.runKernel(Vxe,l,f);return s?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var XNe=K({conv3DBackpropInput_:jNe});function YNe(n,e,t,r,a){var i=M(n,"x","conv3dTranspose"),o=M(e,"filter","conv3dTranspose");return XNe(t,i,o,r,a)}var ZNe=K({conv3dTranspose_:YNe});function JNe(n){var e=M(n,"x","cos","float32"),t={x:e};return Q.runKernel(Gxe,t)}var QNe=K({cos_:JNe});function eTe(n){var e=M(n,"x","cosh","float32"),t={x:e};return Q.runKernel(Uxe,t)}var tTe=K({cosh_:eTe});function nTe(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:r};return Q.runKernel(Hxe,i,o)}var rTe=K({cumprod_:nTe});function aTe(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:r};return Q.runKernel(Kxe,i,o)}var iTe=K({cumsum_:aTe});function oTe(n,e,t,r){r===void 0&&(r=!1);var a=M(n,"x","denseBincount"),i=M(e,"weights","denseBincount");G(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),G(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:r};return Q.runKernel(Xxe,o,s)}var sTe=K({denseBincount_:oTe});function uTe(n,e,t){t===void 0&&(t="NHWC");var r=M(n,"x","depthToSpace","float32"),a=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];G(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),G(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(r.shape)}),G(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(r.shape)}),G(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)});var s={x:r},u={blockSize:e,dataFormat:t};return Q.runKernel(Yxe,s,u)}var cTe=K({depthToSpace_:uTe});function lTe(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(n,"x","depthwiseConv2d","float32"),u=M(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),xi("depthwiseConv2d",r,o);var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=Q.runKernel(Zxe,h,d);return l?ge(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Dw=K({depthwiseConv2d_:lTe});function fTe(n){var e=M(n,"x","diag"),t={x:e};return Q.runKernel(eke,t)}var hTe=K({diag_:fTe});function dTe(n,e,t,r,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=M(n,"x","dilation2d"),s=M(e,"filter","dilation2d");G(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),G(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),G(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),G(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:r,dilations:a},h=Q.runKernel(tke,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var pTe=K({dilation2d_:dTe});function vTe(n,e){var t,r=M(n,"a","floorDiv"),a=M(e,"b","floorDiv");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(pke,i)}var hB=K({floorDiv_:vTe});function mTe(n,e){var t,r=M(n,"a","div"),a=M(e,"b","div");if(t=Ne(Cn(r,a),2),r=t[0],a=t[1],r.dtype==="int32"&&a.dtype==="int32")return hB(r,a);var i={a:r,b:a},o={};return Q.runKernel(nke,i,o)}var yr=K({div_:mTe});function gTe(n,e){for(var t=[],r=0;r<e.length;r++){var a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Xn(n,e){for(var t=[],r=Math.max(n.length,e.length),a=0;a<r;a++){var i=n[n.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(n," and ").concat(e,".");throw Error(s)}else t.unshift(i)}return t}function yTe(n,e){var t,r=M(n,"a","equal","string_or_numeric"),a=M(e,"b","equal","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(oke,i)}var dB=K({equal_:yTe});function bTe(n,e,t){var r=M(e,"a","where"),a=M(t,"b","where"),i=M(n,"condition","where","bool"),o=Xn(Xn(i.shape,r.shape),a.shape),s=xv(i,o),u=xv(r,o),c=xv(a,o),l={condition:s,t:u,e:c};return Q.runKernel(x2e,l)}var Ec=K({where_:bTe});function wTe(n){var e=M(n,"x","zerosLike"),t={x:e};return Q.runKernel(J2e,t)}var Fw=K({zerosLike_:wTe});function xTe(n,e){var t,r=M(n,"a","div"),a=M(e,"b","div");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i=yr(r,a),o=Fw(i),s=dB(a,o);return Ec(s,o,i)}var kTe=K({divNoNan_:xTe});function STe(n,e){var t=M(n,"t1","dot"),r=M(e,"t2","dot");G((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(G(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&r.rank===1){var o=ge(t,[1,-1]),s=ge(r,[-1,1]),u=Bt(o,s);return ge(u,[])}else if(t.rank===1&&r.rank===2){var o=ge(t,[1,-1]),s=ge(r,[r.shape[0],r.shape[1]]),u=Bt(o,s);return ge(u,[u.size])}else if(t.rank===2&&r.rank===1){var s=ge(r,[-1,1]),u=Bt(t,s);return ge(u,[u.size])}else{var s=ge(r,[r.shape[0],r.shape[1]]),u=Bt(t,s);return u}}var NTe=K({dot_:STe});function TTe(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=e.map(function(i,o){return M(i,"tensors".concat(o),"einsum")}),a={equation:n};return Q.runKernel(rke,r,a)}var ETe=K({einsum_:TTe});function ITe(n){var e=M(n,"x","elu","float32"),t={x:e};return Q.runKernel(ake,t)}var pB=K({elu_:ITe});function CTe(n){var e=M(n,"x","erf");G(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=rr(e,"float32"));var t={x:e};return Q.runKernel(ike,t)}var ATe=K({erf_:CTe});function _Te(n,e,t){for(var r=n.length+e.length,a=[],i=0,o=0,s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function Pv(n,e){var t=e.map(function(r){return 1});return _Te(n,t,e)}function DTe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","max"),a={x:r},i={reductionIndices:e,keepDims:t};return Q.runKernel(Pke,a,i)}var kc=K({max_:DTe});function FTe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","min"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(qke,a,i)}var vw=K({min_:FTe});function RTe(n,e){var t,r=M(n,"base","pow"),a=M(e,"exp","pow");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(n2e,i)}var Rw=K({pow_:RTe});function jo(n,e,t,r){if(r==null)r=kw(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return Q.backend.createTensorFromGPUData(n,e||t,r)}if(!bi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ga(e);var a=Fr(e),i=Fr(t);G(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Fr(e.slice(o)):!0;G(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!bi(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?nB(n,r):Hf(n,[],!0),Q.makeTensor(n,e,r)}function bn(n,e){if((bi(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&bi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],r=[];return jo(n,t,r,e)}function OTe(n){var e=M(n,"x","sqrt","float32"),t={x:e};return Q.runKernel(A2e,t)}var mw=K({sqrt_:OTe});function PTe(n){var e=M(n,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}var Mv=K({square_:PTe});function MTe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","sum");r.dtype==="bool"&&(r=rr(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return Q.runKernel(_2e,a,i)}var en=K({sum_:MTe});function BTe(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),n=M(n,"x","norm");var a=vB(n,e,t),i=a.shape;if(r){var o=Dv(t,n.shape);i=Pv(a.shape,o)}return ge(a,i)}function vB(n,e,t){if(t===void 0&&(t=null),n.rank===0)return $a(n);if(n.rank!==1&&t===null)return vB(ge(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return en($a(n),t);if(e===1/0)return kc($a(n),t);if(e===-1/0)return vw($a(n),t);if(e==="euclidean"||e===2)return mw(en(Rw($a(n),bn(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return kc(en($a(n),t[0]),t[1]-1);if(e===1/0)return kc(en($a(n),t[1]),t[0]);if(e===-1/0)return vw(en($a(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return mw(en(Mv(n),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var Bv=K({norm_:BTe});function LTe(n,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),Bv(n,"euclidean",e,t)}var zTe=K({euclideanNorm_:LTe});function $Te(n){var e=M(n,"x","exp"),t={x:e};return Q.runKernel(ske,t)}var Js=K({exp_:$Te});function qTe(n,e){e===void 0&&(e=0);var t=M(n,"x","expandDims","string_or_numeric");G(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r={input:t},a={dim:e};return Q.runKernel(uke,r,a)}var js=K({expandDims_:qTe});function WTe(n){var e=M(n,"x","expm1"),t={x:e};return Q.runKernel(cke,t)}var VTe=K({expm1_:WTe});function GTe(n,e){var t=M(n,"x","tile","string_or_numeric");G(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var r={x:t},a={reps:e};return Q.runKernel(Y4,r,a)}var Vf=K({tile_:GTe});function UTe(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var a=Uo([n,e],r),i=n<=e?n:e,o=0;o<i;++o)a.set(1,o,o);var s=ge(a.toTensor(),[n,e]);if(t==null)return s;if(t.length===1)return Vf(js(s,0),[t[0],1,1]);if(t.length===2)return Vf(js(js(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Vf(js(js(js(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var mB=K({eye_:UTe});function HTe(n){var e=M(n,"x","floor","float32"),t={x:e};return Q.runKernel(dke,t)}var gB=K({floor_:HTe});function KTe(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=M(n,"x","gather"),i=M(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return Q.runKernel(mke,o,s)}var yB=K({gather_:KTe});function jTe(n,e){var t,r=M(n,"a","greater","string_or_numeric"),a=M(e,"b","greater","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(yke,i)}var Lv=K({greater_:jTe});function XTe(n,e){var t,r=M(n,"a","greaterEqual","string_or_numeric"),a=M(e,"b","greaterEqual","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(bke,i)}var bB=K({greaterEqual_:XTe});function YTe(n){var e=M(n,"input","imag"),t={input:e};return Q.runKernel(xke,t)}var zv=K({imag_:YTe});function ZTe(n){var e=M(n,"x","isFinite"),t={x:e};return Q.runKernel(kke,t)}var JTe=K({isFinite_:ZTe});function QTe(n){var e=M(n,"x","isInf"),t={x:e};return Q.runKernel(Ske,t)}var eEe=K({isInf_:QTe});function tEe(n){var e=M(n,"x","isNaN"),t={x:e};return Q.runKernel(Nke,t)}var nEe=K({isNaN_:tEe});function rEe(n,e){e===void 0&&(e=.2);var t=M(n,"x","leakyRelu"),r={x:t},a={alpha:e};return Q.runKernel(Tke,r,a)}var wB=K({leakyRelu_:rEe});function aEe(n,e){var t,r=M(n,"a","less","string_or_numeric"),a=M(e,"b","less","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Eke,i)}var iEe=K({less_:aEe});function oEe(n,e){var t,r=M(n,"a","lessEqual","string_or_numeric"),a=M(e,"b","lessEqual","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Ike,i)}var Ow=K({lessEqual_:oEe});function sEe(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");var r={start:n,stop:e,num:t};return Q.runKernel(Cke,{},r)}function uEe(n,e,t,r,a){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),a===void 0&&(a=.5);var i=M(n,"x","localResponseNormalization");G(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),G(Uf(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:r,beta:a},l=Q.runKernel(Oke,u,c);return s?ge(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var cEe=K({localResponseNormalization_:uEe});function lEe(n){var e=M(n,"x","log","float32"),t={x:e};return Q.runKernel(Ake,t)}var jf=K({log_:lEe});function fEe(n){var e=M(n,"x","log1p"),t={x:e};return Q.runKernel(_ke,t)}var xB=K({log1p_:fEe});function so(n){return Q.customGrad(n)}function hEe(n){var e=M(n,"x","neg"),t={x:e};return Q.runKernel(Kke,t)}var oo=K({neg_:hEe});function dEe(n){var e=M(n,"x","softplus"),t={x:e};return Q.runKernel(C2e,t)}var kB=K({softplus_:dEe});function pEe(n){var e=M(n,"x","logSigmoid"),t=so(function(r){var a=oo(kB(oo(r))),i=function(o){var s=mt(o,xc(oo(r)));return s};return{value:a,gradFunc:i}});return t(e)}var vEe=K({logSigmoid_:pEe});function mEe(n,e){var t,r=M(n,"a","sub"),a=M(e,"b","sub");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(G2e,i)}var Ct=K({sub_:mEe});function gEe(n,e){e===void 0&&(e=-1);var t=M(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var r=so(function(a,i){var o=!0,s=kc(a,e,!0),u=Ct(a,s),c=Ct(rr(u,"float32"),jf(en(Js(u),e,o)));i([c]);var l=function(f,h){var d=Ne(h,1),p=d[0],v=!0,m=Js(p);return Ct(f,mt(en(f,e,v),m))};return{value:c,gradFunc:l}});return r(t)}var yEe=K({logSoftmax_:gEe});function bEe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","logSumExp"),a=Dv(e,r.shape),i=kc(r,a,!0),o=Ct(r,i),s=Js(o),u=en(s,a),c=jf(u),l=jn(ge(i,c.shape),c);if(t){var f=Pv(l.shape,a);return ge(l,f)}return l}var SB=K({logSumExp_:bEe});function wEe(n,e){var t=M(n,"a","logicalAnd","bool"),r=M(e,"b","logicalAnd","bool");Xn(t.shape,r.shape);var a={a:t,b:r};return Q.runKernel(Dke,a)}var Cv=K({logicalAnd_:wEe});function xEe(n){var e=M(n,"x","logicalNot","bool"),t={x:e};return Q.runKernel(Fke,t)}var NB=K({logicalNot_:xEe});function kEe(n,e){var t=M(n,"a","logicalOr","bool"),r=M(e,"b","logicalOr","bool");Xn(t.shape,r.shape);var a={a:t,b:r};return Q.runKernel(Rke,a)}var TB=K({logicalOr_:kEe});function SEe(n,e){var t=M(n,"a","logicalXor","bool"),r=M(e,"b","logicalXor","bool");return Xn(t.shape,r.shape),Cv(TB(n,e),NB(Cv(n,e)))}var NEe=K({logicalXor_:SEe});var gv=2147483648;function TEe(n,e,t){t===void 0&&(t="left");var r=M(n,"sortedSequence","searchSorted"),a=M(e,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=ge(r,[-1,i]),u=ge(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Fr(u.shape)>=gv)throw new Error("values tensor size must less than ".concat(gv));if(s.shape[1]>=gv)throw new Error("trailing dim_size must less than ".concat(gv," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return Q.runKernel(w2e,c,l)}var Pw=K({searchSorted_:TEe});function EEe(n,e){return Pw(n,e,"left")}function IEe(n,e,t,r,a){var i=M(n,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),G(Ko(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),xi("maxPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=Q.runKernel(Bke,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var EB=K({maxPool_:IEe});function CEe(n,e,t,r,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=M(n,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),xi("maxPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(Lke,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var AEe=K({maxPool3d_:CEe});function _Ee(n,e,t,r,a){a===void 0&&(a=!1);var i=M(n,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:r,includeBatchInIndex:a},u=Q.runKernel(zke,o,s);return{result:u[0],indexes:u[1]}}var DEe=K({maxPoolWithArgmax_:_Ee});function FEe(n,e){var t,r=M(n,"a","maximum"),a=M(e,"b","maximum");t=Ne(Cn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=rr(r,"int32"),a=rr(a,"int32")),Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Mke,i)}var REe=K({maximum_:FEe});function OEe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","mean"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel($ke,a,i)}var Av=K({mean_:OEe});function Ic(n,e){if(e===void 0&&(e="float32"),ga(n),e==="complex64"){var t=Ic(n,"float32"),r=Ic(n,"float32");return Zs(t,r)}var a=Nw(Fr(n),e);return Q.makeTensor(a,n,e)}function Ys(n,e){if(e===void 0&&(e="float32"),ga(n),e==="complex64"){var t=Ys(n,"float32"),r=Ic(n,"float32");return Zs(t,r)}var a=G4(Fr(n),e);return Q.makeTensor(a,n,e)}function PEe(n,e,t){var r=t===void 0?{}:t,a=r.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(n===void 0)return[];var o=M(n,"x","meshgrid",n instanceof _r?n.dtype:"float32");if(e===void 0)return[o];var s=M(e,"y","meshgrid",e instanceof _r?e.dtype:"float32"),u=Fr(o.shape),c=Fr(s.shape);return i==="xy"?(o=ge(o,[1,-1]),s=ge(s,[-1,1]),[Bt(Ys([c,1],o.dtype),o),Bt(s,Ys([1,u],s.dtype))]):(o=ge(o,[-1,1]),s=ge(s,[1,-1]),[Bt(o,Ys([1,c],o.dtype)),Bt(Ys([u,1],s.dtype),s)])}function MEe(n,e){var t,r=M(n,"a","minimum"),a=M(e,"b","minimum");t=Ne(Cn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=rr(r,"int32"),a=rr(a,"int32")),Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Wke,i)}var IB=K({minimum_:MEe});function BEe(n,e,t){G(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var r=M(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");G(e.length===r.rank,function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){G(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),G(e[c][0]>=0&&e[c][0]<=r.shape[c]-a&&e[c][1]>=0&&e[c][1]<=r.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(r.shape[c]-a," or less than 0 for input of ")+"shape ".concat(r.shape)})},o=0;o<r.rank;o++)i(o);var s={paddings:e,mode:t},u={x:r};return Q.runKernel(Vke,u,s)}var LEe=K({mirrorPad_:BEe});function zEe(n,e){var t,r=M(n,"a","mod"),a=M(e,"b","mod");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(Gke,i)}var $Ee=K({mod_:zEe});function qEe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),n=M(n,"x","moments");var r=Dv(e,n.shape),a=Av(n,r,t),i=a.shape;t||(i=Pv(a.shape,r));var o=Mv(Ct(rr(n,"float32"),ge(a,i))),s=Av(o,r,t);return{mean:a,variance:s}}var WEe=K({moments_:qEe});function VEe(n,e,t,r){for(var a=M(e,"data","multiRNNCell"),i=Tv(t,"c","multiRNNCell"),o=Tv(r,"h","multiRNNCell"),s=a,u=[],c=0;c<n.length;c++){var l=n[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var GEe=K({multiRNNCell_:VEe});function UEe(n,e,t,r){r===void 0&&(r=!1);var a=M(n,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ge(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:r},l=Q.runKernel(Uke,u,c);return o===1?ge(l,[l.size]):l}var HEe=K({multinomial_:UEe});function KEe(n,e){var t,r=M(n,"a","notEqual","string_or_numeric"),a=M(e,"b","notEqual","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(jke,i)}var CB=K({notEqual_:KEe});function jEe(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=M(n,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:r};return Q.runKernel(Qke,o,s)}var XEe=K({oneHot_:jEe});function YEe(n){var e=M(n,"x","onesLike"),t={x:e};return Q.runKernel(Jke,t)}var ZEe=K({onesLike_:YEe});function JEe(n,e){var t=M(n,"v1","outerProduct"),r=M(e,"v2","outerProduct");G(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=ge(t,[-1,1]),i=ge(r,[1,-1]);return Bt(a,i)}var QEe=K({outerProduct_:JEe});function eIe(n,e,t){t===void 0&&(t=0);var r=M(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:r};return Q.runKernel(t2e,i,a)}var Qf=K({pad_:eIe});function tIe(n,e,t){return t===void 0&&(t=0),G(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Qf(n,[e],t)}var nIe=K({pad1d_:tIe});function rIe(n,e,t){return t===void 0&&(t=0),G(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Qf(n,e,t)}var aIe=K({pad2d_:rIe});function iIe(n,e,t){return t===void 0&&(t=0),G(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Qf(n,e,t)}var oIe=K({pad3d_:iIe});function sIe(n,e,t){return t===void 0&&(t=0),G(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Qf(n,e,t)}var uIe=K({pad4d_:sIe});function cIe(n,e,t){var r=M(n,"x","spaceToBatchND");G(r.rank>=1+e.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(e.length)}),G(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),G(r.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:r},i={blockShape:e,paddings:t};return Q.runKernel(D2e,a,i)}var AB=K({spaceToBatchND_:cIe});function lIe(n,e,t,r,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),r===0&&(r="valid");var s=M(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(Ko(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=ZSe(u.shape,e,i,a,r),f=[l.dilationHeight,l.dilationWidth],h;r==="same"?h=hIe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var d=f[0]===1&&f[1]===1,p=Ne(fIe([l.inHeight,l.inWidth],f,h),2),v=p[0],m=p[1],g=d?r:"valid",y=d?u:AB(u,f,v),b=t==="avg"?function(){return uB(y,e,i,g,o)}:function(){return EB(y,e,i,g,o)},w=b(),x=d?w:cB(w,f,m);return c?ge(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function fIe(n,e,t){var r=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=n.concat(r,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[r[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function hIe(n,e){var t=n.map(function(o,s){return o+(o-1)*(e[s]-1)}),r=t.map(function(o){return o-1}),a=r.map(function(o){return Math.floor(o/2)}),i=r.map(function(o,s){return o-a[s]});return r.map(function(o,s){return[a[s],i[s]]})}var dIe=K({pool_:lIe});function pIe(n,e){var t=M(n,"x","prelu"),r=M(e,"alpha","prelu"),a={x:t,alpha:r};return Q.runKernel(r2e,a)}var _B=K({prelu_:pIe});function vIe(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}function mIe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","prod");r.dtype==="bool"&&(r=rr(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return Q.runKernel(a2e,a,i)}var gIe=K({prod_:mIe});function yIe(n,e,t,r){var a=n.map(function(l,f){return M(l,"tensors".concat(f),"raggedGather","int32")}),i=M(e,"paramsDenseValues","raggedGather"),o=M(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:r},c=Q.runKernel(i2e,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var bIe=K({raggedGather_:yIe});function wIe(n,e,t){var r=M(n,"starts","raggedRange"),a=M(e,"limits","raggedRange",r.dtype),i=M(t,"deltas","raggedRange",r.dtype),o={starts:r,limits:a,deltas:i},s=Q.runKernel(o2e,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var xIe=K({raggedRange_:wIe});function kIe(n,e,t,r,a){var i=M(n,"shape","raggedTensorToTensor","int32"),o=M(e,"values","raggedTensorToTensor"),s=M(t,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map(function(f,h){return M(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return Q.runKernel(s2e,c,l)}var SIe=K({raggedTensorToTensor_:kIe});function NIe(n,e,t){ga(n);var r=Fr(n),a=null;if(t==null||t==="float32")a=new Float32Array(r);else if(t==="int32")a=new Int32Array(r);else if(t==="bool")a=new Uint8Array(r);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<r;i++)a[i]=e();return Q.makeTensor(a,n,t)}var TIe=K({rand_:NIe}),tu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function EIe(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function nu(n){var e={exports:{}};return n(e,e.exports),e.exports}var IIe=nu(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(tu,n,!1)}),CIe=nu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(tu,n,!1)}),AIe=nu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(tu,n,!1)}),_Ie=nu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8&&(d[7]=-1),l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(tu,n,!1)}),DIe=nu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(tu,n,!1)}),FIe=nu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(tu,n,!1)}),RIe={},OIe={__proto__:null,default:RIe},PIe=EIe(OIe),ru=nu(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=PIe}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:tu,[],Math)});ru.alea=IIe;ru.xor128=CIe;ru.xorwow=AIe;ru.xorshift7=_Ie;ru.xor4096=DIe;ru.tychei=FIe;var Mw=ru;var Bw=function(){function n(e,t,r,a,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=Mw.alea(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(r))&&(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),MIe=function(){function n(e,t,r,a){this.alpha=e,this.beta=1/t,this.dtype=r;var i=a||Math.random();this.randu=Mw.alea(i.toString()),this.randn=new Bw(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,r=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),BIe=function(){function n(e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=Mw.alea(a)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function LIe(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r="float32"),ga(n),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type ".concat(r));for(var i=new MIe(e,t,r,a),o=Uo(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var zIe=K({randomGamma_:LIe});function $Ie(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ga(n),r!=null&&r==="bool")throw new Error("Unsupported data type ".concat(r));for(var i=new Bw(e,t,r,!1,a),o=Uo(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var DB=K({randomNormal_:$Ie});function qIe(n,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return DB(n,0,1,e,t)}var WIe=K({randomStandardNormal_:qIe});function VIe(n,e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32"),ga(n);for(var i=Uo(n,r),o=new BIe(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var FB=K({randomUniform_:VIe});function Xf(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:n,stop:e,step:t,dtype:r};return Q.runKernel(u2e,{},a)}function GIe(n){var e=M(n,"input","real"),t={input:e};return Q.runKernel(c2e,t)}var Yf=K({real_:GIe});function UIe(n){var e=M(n,"x","reciprocal"),t={x:e};return Q.runKernel(l2e,t)}var HIe=K({reciprocal_:UIe});function KIe(n){var e=M(n,"x","relu"),t={x:e};return Q.runKernel(f2e,t)}var $v=K({relu_:KIe});function jIe(n){var e=M(n,"x","relu6"),t={x:e};return Q.runKernel(v2e,t)}var RB=K({relu6_:jIe});function XIe(n,e){var t=M(n,"x","reverse"),r={x:t},a={dims:e};return Q.runKernel(m2e,r,a)}var Qs=K({reverse_:XIe});function YIe(n){var e=M(n,"x","reverse");return G(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),Qs(e,0)}var ZIe=K({reverse1d_:YIe});function JIe(n,e){var t=M(n,"x","reverse");return G(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),Qs(t,e)}var QIe=K({reverse2d_:JIe});function eCe(n,e){var t=M(n,"x","reverse");return G(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),Qs(t,e)}var tCe=K({reverse3d_:eCe});function nCe(n,e){var t=M(n,"x","reverse");return G(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),Qs(t,e)}var rCe=K({reverse4d_:nCe});function aCe(n){var e=M(n,"x","round"),t={x:e};return Q.runKernel(g2e,t)}var OB=K({round_:aCe});function iCe(n){var e=M(n,"x","rsqrt","float32"),t={x:e};return Q.runKernel(y2e,t)}var oCe=K({rsqrt_:iCe});function sCe(n){var e=M(n,"x","selu"),t={x:e};return Q.runKernel(k2e,t)}var uCe=K({selu_:sCe});function cCe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=M(n,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),c=M(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),G(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),G(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],d=u.shape[3];G(c.shape[2]===h*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*d,", ")+"but got ".concat(c.shape[2],".")});var p=Dw(l,u,r,a,o,i),v=1,m=Ov(p,c,v,"valid",o);return f?ge(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var lCe=K({separableConv2d_:cCe});function fCe(n,e){return Pt(this,void 0,void 0,function(){var t,r,a,i,o,s,l,u,c,l,f;return _t(this,function(h){switch(h.label){case 0:return t=M(n,"x","setdiff1d"),r=M(e,"y","setdiff1d"),G(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(r.dtype,").")}),G(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),G(r.rank===1,function(){return"y should be 1D tensor, but got y (".concat(r.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,r.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new sw([s],t.dtype),c=new sw([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var hCe=fCe;function dCe(n){var e=M(n,"x","sign"),t={x:e};return Q.runKernel(E2e,t)}var pCe=K({sign_:dCe});function vCe(n){var e=M(n,"x","sin","float32"),t={x:e};return Q.runKernel(N2e,t)}var mCe=K({sin_:vCe});function gCe(n){var e=M(n,"x","sinh"),t={x:e};return Q.runKernel(T2e,t)}var yCe=K({sinh_:gCe});function bCe(n,e,t){var r=M(n,"x","slice1d");return G(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,[e],[t])}var wCe=K({slice1d_:bCe});function xCe(n,e,t){var r=M(n,"x","slice2d");return G(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,e,t)}var kCe=K({slice2d_:xCe});function SCe(n,e,t){var r=M(n,"x","slice3d");return G(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,e,t)}var NCe=K({slice3d_:SCe});function TCe(n,e,t){var r=M(n,"x","slice4d");return G(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,e,t)}var ECe=K({slice4d_:TCe});function ICe(n,e){e===void 0&&(e=-1);var t=M(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var r={logits:t},a={dim:e};return Q.runKernel(R2e,r,a)}var CCe=K({softmax_:ICe});function ACe(n){G(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return Q.runKernel(lke,e)}var Lw=K({fft_:ACe});function _Ce(n){G(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return Q.runKernel(wke,e)}var _v=K({ifft_:_Ce});function DCe(n){var e=n.shape[n.shape.length-1],t=n.size/e,r;if(e<=2){var a=ge(n,[t,e]);r=_v(a)}else{var i=[t,2*(e-1)],o=ge(Yf(n),[t,e]),s=ge(zv(n),[t,e]),u=Qs(fn(o,[0,1],[t,e-2]),1),c=mt(Qs(fn(s,[0,1],[t,e-2]),1),bn(-1)),l=Qr([o,u],1),f=Qr([s,c],1),a=ge(Zs(l,f),[i[0],i[1]]);r=_v(a)}if(r=Yf(r),n.rank===3&&n.shape[0]!==0){var h=r,d=n.shape[0];r=ge(r,[d,r.shape[0]/d,r.shape[1]]),h.dispose()}return r}var PB=K({irfft_:DCe});function FCe(n,e,t){t===void 0&&(t=0);var r=M(n,"x","split"),a={x:r},i={numOrSizeSplits:e,axis:t};return Q.runKernel(F2e,a,i)}var Zf=K({split_:FCe});function RCe(n,e){G(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(n.dtype)});var t=n.shape[n.shape.length-1],r=n.size/t,a;if(e!=null&&e<t){var i=n.shape.map(function(g){return 0}),o=n.shape.map(function(g){return g});o[n.shape.length-1]=e,a=fn(n,i,o),t=e}else if(e!=null&&e>t){var s=n.shape.map(function(g){return g});s[n.shape.length-1]=e-t,a=Qr([n,Ic(s)],n.shape.length-1),t=e}else a=n;var u=Fw(a),c=ge(Zs(a,u),[r,t]),l=Lw(c),f=Math.floor(t/2)+1,h=Yf(l),d=zv(l),p=Zf(h,[f,t-f],h.shape.length-1),v=Zf(d,[f,t-f],d.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=f,ge(Zs(p[0],v[0]),m)}var zw=K({rfft_:RCe});function OCe(n,e){var t,r=M(n,"a","squaredDifference"),a=M(e,"b","squaredDifference");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a},o={};return Q.runKernel(z2e,i,o)}var MB=K({squaredDifference_:OCe});function PCe(n,e){var t=M(n,"x","squeeze","string_or_numeric");return ge(t,txe(t.shape,e).newShape)}var $w=K({squeeze_:PCe});function MCe(n,e){e===void 0&&(e=0);var t=Tv(n,"tensors","stack","string_or_numeric");G(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&G(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var r=t,a={axis:e};return Q.runKernel(e2e,r,a)}var Jf=K({stack_:MCe});function BCe(n,e){e===void 0&&(e=0);var t=M(n,"x","step"),r={x:t},a={alpha:e};return Q.runKernel(Q2e,r,a)}var BB=K({step_:BCe});function LCe(n,e,t,r,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=M(n,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Q.runKernel($2e,l,f)}var zCe=K({stridedSlice_:LCe});function $Ce(n){var e=M(n,"x","tan","float32"),t={x:e};return Q.runKernel(U2e,t)}var qCe=K({tan_:$Ce});function qw(n,e,t){var r=Ho(n,t);return jo(n,e,r,t)}function yi(n,e){Cc(n);var t=Ho(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var r=null;return jo(n,r,t,e)}function Gf(n,e,t){if(Cc(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Ho(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return jo(n,e,r,t)}function WCe(n,e,t){if(Cc(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Ho(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return jo(n,e,r,t)}function VCe(n,e,t){if(Cc(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Ho(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return jo(n,e,r,t)}function GCe(n,e,t){if(Cc(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Ho(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return jo(n,e,r,t)}function UCe(n,e,t){if(Cc(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Ho(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,jo(n,e,r,t)}function HCe(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=M(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:r},o={k:e,sorted:t},s=Ne(Q.runKernel(K2e,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var KCe=K({topk_:HCe});function jCe(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ga(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new Bw(e,t,r,!0,a),o=Uo(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var XCe=K({truncatedNormal_:jCe});function YCe(n,e){e===void 0&&(e=0);var t=M(n,"x","unique","string_or_numeric");G(t.rank>0,function(){return"The input tensor must be at least 1D"});var r={x:t},a={axis:e},i=Ne(Q.runKernel(X2e,r,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var ZCe=K({unique_:YCe});function JCe(n,e,t){var r=M(n,"x","unsortedSegmentSum"),a=M(e,"segmentIds","unsortedSegmentSum","int32");G(Uf(t),function(){return"numSegments must be of dtype int"});var i={x:r,segmentIds:a},o={numSegments:t};return Q.runKernel(Z2e,i,o)}var QCe=K({unsortedSegmentSum_:JCe});function eAe(n,e){e===void 0&&(e=0);var t=M(n,"x","unstack","string_or_numeric");G(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var r={value:t},a={axis:e};return Q.runKernel(Y2e,r,a)}var Ww=K({unstack_:eAe});function tAe(n,e){return Pw(n,e,"right")}function nAe(n,e,t,r){return e===void 0&&(e=!0),Q.makeVariable(n,e,t,r)}function rAe(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);for(var a=Uo(n,"int32"),i=Uo([t.length,n.length],"int32"),r=0;r<t.length;r++){var o=a.indexToLoc(t[r]),s=r*n.length;i.values.set(o,s)}return i.toTensor()}function aAe(n){return Pt(this,void 0,void 0,function(){var e,t,r;return _t(this,function(a){switch(a.label){case 0:return e=M(n,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),r=rAe(e.shape,t),n!==e&&e.dispose(),[2,r]}})})}var LB=aAe;function iAe(n,e,t){return Pt(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v;return _t(this,function(m){switch(m.label){case 0:for(r=M(n,"tensor","boolMask"),a=M(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=r.shape,G(o>0,function(){return"mask cannot be scalar"}),Ua(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ge(r,l),h=ge(a,[-1]),[4,LB(h)];case 1:return d=m.sent(),p=$w(d,[1]),v=yB(f,p,i),n!==r&&r.dispose(),e!==a&&a.dispose(),p.dispose(),f.dispose(),h.dispose(),d.dispose(),[2,v]}})})}var oAe=iAe;function sAe(n,e){return Q.tidy(n,e)}function uAe(n){var e=aB(n);e.forEach(function(t){return t.dispose()})}function cAe(n,e,t){var r=M(n,"x","transpose");if(e==null&&(e=r.shape.map(function(o,s){return s}).reverse()),G(r.rank===e.length,function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){G(o>=0&&o<r.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(e)})}),r.rank<=1)return r.clone();var a={x:r},i={perm:e};return r.dtype==="complex64"?sAe(function(){var o=Yf(r),s=zv(r);return o=Q.runKernel(V1,{x:o},i),s=Q.runKernel(V1,{x:s},i),t&&(s=oo(s)),Zs(o,s)}):Q.runKernel(V1,a,i)}var gw=K({transpose_:cAe});function lAe(n,e,t,r,a){a===void 0&&(a=!0);var i=M(n,"v","movingAverage"),o=M(e,"x","movingAverage"),s=M(t,"decay","movingAverage");bSe(i,o),G(Ac(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=bn(1),c=Ct(u,s),l=mt(Ct(o,i),c);if(a){G(r!=null,function(){return"When using zeroDebias: true, step is required."});var f=M(r,"step","movingAverage");l=yr(l,Ct(u,Rw(s,f)))}return jn(i,l)}var fAe=K({movingAverage_:lAe});function hAe(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(n)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(n.length<r+(t.rank-a))throw new Error(i+" Output shape length < ".concat(r+(t.rank-a)));if(t.rank!==a+n.length-r)throw new Error(i+" update.rank != ".concat(a+n.length-r));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==n[o+r])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(n[o+a],")"))}function dAe(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(n.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(n.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(n.shape))}hAe(t,e,n)}function pAe(n,e,t){ga(t);var r=M(n,"indices","scatterND","int32"),a=M(e,"updates","scatterND");dAe(a,r,t);var i={indices:r,updates:a},o={shape:t};return Q.runKernel(b2e,i,o)}var vAe=K({scatterND_:pAe});function mAe(n,e,t,r){if(n.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(n.dtype,"."));if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(n.shape,"."));var a=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function gAe(n,e,t,r){r===void 0&&(r=0),ga(t);var a=M(n,"sparseIndices","sparseToDense","int32"),i=M(e,"sparseValues","sparseToDense","string_or_numeric"),o=M(r,"defaultValue","sparseToDense",i.dtype);mAe(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return Q.runKernel(L2e,s,u)}var yAe=K({sparseToDense_:gAe});function bAe(n,e){var t=M(e,"indices","gatherND","int32"),r=M(n,"x","gatherND","string_or_numeric"),a={params:r,indices:t};return Q.runKernel(gke,a)}var wAe=K({gatherND_:bAe});function xAe(n,e){if(e==null)return n.shape.slice();if(Ac(n.shape,e))return e;if(n.shape.length===e.length){for(var t=[],r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}function kAe(n,e,t,r){var a=M(n,"x","dropout");if(G(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),G(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return n instanceof _r?a.clone():a;var i=xAe(a,t),o=1-e,s=yr(gB(jn(FB(i,0,1,"float32",r),o)),o);return mt(a,s)}var SAe=K({dropout_:kAe});function zB(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function Vw(n,e,t){for(var r=1-n%2,a=new Float32Array(n),i=0;i<n;++i){var o=2*Math.PI*i/(n+r-1);a[i]=e-t*Math.cos(o)}return yi(a,"float32")}function NAe(n,e,t){return t===void 0&&(t=1),Pt(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,m;return _t(this,function(g){switch(g.label){case 0:return r=M(n,"predictions","inTopK"),a=M(e,"targets","inTopK"),G(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(r.rank)}),G(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(r.rank," and targets rank ").concat(a.rank)}),Ua(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],G(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,r.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=Ne([o.length/i,i],2),c=u[0],l=u[1],f=nxe("bool",c),h=0;h<c;h++){for(d=h*l,p=o.subarray(d,d+l),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort(function(y,b){return b.value-y.value}),f[h]=0,m=0;m<t;m++)if(v[m].index===s[h]){f[h]=1;break}}return n!==r&&r.dispose(),e!==a&&a.dispose(),[2,qw(f,a.shape,"bool")]}})})}var TAe=NAe;function EAe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC");var s=n;n.rank===3&&(s=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]])),G(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),G(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),G(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];G(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),G(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),xi("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return Q.runKernel($xe,f,h)}var IAe=K({conv2DBackpropFilter_:EAe});function Gw(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return mt(n,BB(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function Uw(n,e){var t=e,r=gTe(n.shape,e.shape);return r.length>0&&(t=en(t,r)),ge(t,n.shape)}function Hw(n,e,t,r){if(e==="linear")return n;if(e==="relu")return $v(n);if(e==="elu")return pB(n);if(e==="relu6")return RB(n);if(e==="prelu")return _B(n,t);if(e==="leakyrelu")return wB(n,r);if(e==="sigmoid")return xc(n);throw new Error("Unknown fused activation ".concat(e,"."))}var Kw=function(n,e){var t=n>0;return!t||e==="linear"};function CAe(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights,v=n.leakyreluAlpha;if(d=d||"linear",Kw(Q.state.gradientDepth,d)===!1){G(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var m=Ov(t,r,a,i,s,c,l);return f!=null&&(m=jn(m,f)),Hw(m,d,p,v)}var g=M(t,"x","conv2d","float32"),y=M(r,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(b.rank,".")}),G(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),xi("fused conv2d",i,l);var x=s==="NHWC"?b.shape[3]:b.shape[1];G(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),G(Ko(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var N=_w(b.shape,y.shape,a,c,i,l),T;f!=null&&(T=M(f,"bias","fused conv2d"),e=Ne(Cn(T,g),1),T=e[0],s==="NHWC"?Xn(N.outShape,T.shape):(G(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),G(T.shape.length===0||T.shape[0]===N.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(N.outChannels,")")})));var E;if(p!=null){var C=p.shape;if(G(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)G(C[0]===1||C[0]===N.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(N.outChannels,").")});else if(C.length===3)try{Xn(C,N.outShape)}catch{var F="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(N.outShape,").");throw Error(F)}E=M(p,"prelu weights","fused conv2d")}var D=function(B,W){G(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=Ne(W,4),Z=X[0],V=X[1],j=X[2],re=X[3],ne=Gw(B,j,d);G(Iv(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=fB(V.shape,ne,Z,a,i),le=IAe(V,ne,Z.shape,a,i),pe=[oe,le];if(re!=null){var xe=Uw(re,ne);pe.push(xe)}return pe},O={x:b,filter:y,bias:T,preluActivationWeights:E},L={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:v};if(f==null){var z=so(function(B,W,X){var Z=Q.runKernel(g4,O,L);return X([W,B,Z]),w&&(Z=ge(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:D}});return z(b,y)}else{var $=so(function(B,W,X,Z){var V=Q.runKernel(g4,O,L);return Z([W,B,V,X]),w&&(V=ge(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:D}});return $(b,y,T)}}var AAe=K({fusedConv2d_:CAe});function _Ae(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=n;n.rank===3&&(s=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return Q.runKernel(Jxe,c,l)}var DAe=K({depthwiseConv2dNativeBackpropFilter_:_Ae});function FAe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=Q.runKernel(Qxe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var RAe=K({depthwiseConv2dNativeBackpropInput_:FAe});function OAe(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights,v=n.leakyreluAlpha;if(Kw(Q.state.gradientDepth,d)===!1){var m=Dw(t,r,a,i,s,c,l);return f!=null&&(m=jn(m,f)),Hw(m,d,p,v)}var g=M(t,"x","depthwiseConv2d","float32"),y=M(r,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(b.rank,".")}),G(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),G(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(b.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),G(Ko(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),xi("fused depthwiseConv2d",i,l);var x=_w(b.shape,y.shape,a,c,i,l,!0),N;f!=null&&(N=M(f,"bias","fused conv2d"),e=Ne(Cn(N,g),1),N=e[0],Xn(x.outShape,N.shape));var T;p!=null&&(T=M(p,"prelu weights","fused depthwiseConv2d"));var E=function(L,z){G(Iv(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var $=Ne(z,4),B=$[0],W=$[1],X=$[2],Z=$[3],V=Gw(L,X,d),j=RAe(W.shape,V,B,a,i,c,l),re=DAe(W,V,B.shape,a,i,c,l);if(Z!=null){var ne=Uw(N,V);return[j,re,ne]}return[j,re]},C={x:b,filter:y,bias:N,preluActivationWeights:T},F={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:v};if(f==null){var D=so(function(L,z,$){var B=Q.runKernel(y4,C,F);return $([z,L,B]),w&&(B=ge(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return D(b,y)}else{var O=so(function(L,z,$,B){var W=Q.runKernel(y4,C,F);return B([z,L,W,$]),w&&(W=ge(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:E}});return O(b,y,N)}}var PAe=K({fusedDepthwiseConv2d_:OAe});function MAe(n){var e,t,r=n.a,a=n.b,i=n.transposeA,o=i===void 0?!1:i,s=n.transposeB,u=s===void 0?!1:s,c=n.bias,l=n.activation,f=l===void 0?"linear":l,h=n.preluActivationWeights,d=n.leakyreluAlpha,p=d===void 0?.2:d;if(Kw(Q.state.gradientDepth,f)===!1){var v=Bt(r,a,o,u);return c!=null&&(v=jn(v,c)),Hw(v,f,h,p)}var m=M(r,"a","fused matMul"),g=M(a,"b","fused matMul");e=Ne(Cn(m,g),2),m=e[0],g=e[1];var y=o?m.shape[m.rank-2]:m.shape[m.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?m.shape[m.rank-1]:m.shape[m.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],N=m.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Fr(N),C=Fr(T);G(y===b,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(m.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var F=Xn(m.shape.slice(0,-2),g.shape.slice(0,-2)),D=F.concat([w,x]),O=o?ge(m,[E,y,w]):ge(m,[E,w,y]),L=u?ge(g,[C,x,b]):ge(g,[C,b,x]),z;c!=null&&(z=M(c,"bias","fused matMul"),t=Ne(Cn(z,m),1),z=t[0],Xn(D,z.shape));var $;h!=null&&($=M(h,"prelu weights","fused matMul"));var B=function(j,re){var ne=Ne(re,4),oe=ne[0],le=ne[1],pe=ne[2],xe=ne[3],he=Gw(ge(j,pe.shape),pe,f),ye,we;if(!o&&!u?(ye=Bt(he,le,!1,!0),we=Bt(oe,he,!0,!1)):!o&&u?(ye=Bt(he,le,!1,!1),we=Bt(he,oe,!0,!1)):o&&!u?(ye=Bt(le,he,!1,!0),we=Bt(oe,he,!1,!1)):(ye=Bt(le,he,!0,!0),we=Bt(he,oe,!0,!0)),c!=null){var Ae=Uw(xe,he);return[ye,we,Ae]}else return[ye,we]},W={a:O,b:L,bias:z,preluActivationWeights:$},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:p};if(c==null){var Z=so(function(j,re,ne){var oe=Q.runKernel(m4,W,X);return ne([j,re,oe]),{value:ge(oe,D),gradFunc:B}});return Z(O,L)}else{var V=so(function(j,re,ne,oe){var le=Q.runKernel(m4,W,X);return oe([j,re,le,ne]),{value:ge(le,D),gradFunc:B}});return V(O,L,z)}}var BAe=K({fusedMatMul_:MAe});var LAe={__proto__:null,conv2d:AAe,depthwiseConv2d:PAe,matMul:BAe};function zAe(n){return Vw(n,.54,.46)}var $Ae=K({hammingWindow_:zAe});function qAe(n){return Vw(n,.5,.5)}var $B=K({hannWindow_:qAe});function WAe(n,e,t,r,a){r===void 0&&(r=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=n.size;)o.push(fn(n,i,e)),i+=t;if(r)for(;i<n.size;){var s=i+e-n.size,u=Qr([fn(n,i,e-s),Rv([s],a)]);o.push(u),i+=t}return o.length===0?Gf([],[0,e]):ge(Qr(o),[o.length,e])}var qB=K({frame_:WAe});function VAe(n,e,t,r,a){a===void 0&&(a=$B),r==null&&(r=zB(e));var i=qB(n,e,t),o=mt(i,a(e));return zw(o,r)}var GAe=K({stft_:VAe});function UAe(n,e,t,r,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=M(n,"image","cropAndResize"),s=M(e,"boxes","cropAndResize","float32"),u=M(t,"boxInd","cropAndResize","int32"),c=s.shape[0];G(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),G(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),G(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")}),G(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(r)}),G(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:r},h=Q.runKernel(jxe,l,f);return h}var HAe=K({cropAndResize_:UAe});function KAe(n){var e=M(n,"image","flipLeftRight","float32");G(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},r=Q.runKernel(hke,t,{});return r}var jAe=K({flipLeftRight_:KAe});function XAe(n){var e=M(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];G(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),G(r===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Vf(e,a)}var YAe=K({grayscaleToRGB_:XAe});function ZAe(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=.5);var a=M(n,"image","rotateWithOffset","float32");G(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:r},s=Q.runKernel(eSe,i,o);return s}var JAe=K({rotateWithOffset_:ZAe});function _c(n,e,t,r,a,i){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=n.shape[0];return t=Math.min(t,o),G(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")}),G(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(n.rank,"'")}),G(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(n.shape[1])}),G(e.rank===1,function(){return"scores must be a 1D tensor"}),G(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),G(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}function QAe(n,e,t,r,a){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=M(n,"boxes","nonMaxSuppression","float32"),o=M(e,"scores","nonMaxSuppression","float32"),s=_c(i,o,t,r,a);t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:a};return Q.runKernel(Xke,{boxes:i,scores:o},u)}var e_e=K({nonMaxSuppression_:QAe});function t_e(n,e,t){var r=n_e(n,e,t),a=r<0?-(r+1):r;n.splice(a,0,e)}function n_e(n,e,t){return a_e(n,e,t||r_e)}function r_e(n,e){return n>e?1:n<e?-1:0}function a_e(n,e,t){for(var r=0,a=n.length,i=0,o=!1;r<a;){i=r+(a-r>>>1);var s=t(e,n[i]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}function i_e(n,e,t,r,a){return jw(n,e,t,r,a,0)}function o_e(n,e,t,r,a,i){return jw(n,e,t,r,a,0,!1,i,!0)}function s_e(n,e,t,r,a,i){return jw(n,e,t,r,a,i,!0)}function jw(n,e,t,r,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(F4);for(var f=i>0?-.5/i:0,h=[],d=[];h.length<t&&c.length>0;){var p=c.pop(),v=p.score,m=p.boxIndex,g=p.suppressBeginIndex;if(v<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=u_e(n,m,h[b]);if(w>=r){y=!0;break}if(p.score=p.score*c_e(r,f,w),p.score<=a)break}p.suppressBeginIndex=h.length,y||(p.score===v?(h.push(m),d.push(p.score)):p.score>a&&t_e(c,p,F4))}var x=h.length,N=t-x;s&&N>0&&(h.push.apply(h,yn([],Ne(new Array(N).fill(0)),!1)),d.push.apply(d,yn([],Ne(new Array(N).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=d),u&&(T.validOutputs=x),T}function u_e(n,e,t){var r=n.subarray(e*4,e*4+4),a=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(f-c)*(h-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function c_e(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function F4(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function l_e(n,e,t,r,a){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Pt(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return _t(this,function(h){switch(h.label){case 0:return i=M(n,"boxes","nonMaxSuppressionAsync"),o=M(e,"scores","nonMaxSuppressionAsync"),s=_c(i,o,t,r,a),t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=i_e(c,l,t,r,a).selectedIndices,i!==n&&i.dispose(),o!==e&&o.dispose(),[2,yi(f,"int32")]}})})}var f_e=l_e;function h_e(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=M(n,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=_c(o,s,t,r,a,i);t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i},f=Q.runKernel(Zke,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var d_e=K({nonMaxSuppressionWithScore_:h_e});function p_e(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,d,p;return _t(this,function(v){switch(v.label){case 0:return o=M(n,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=_c(o,s,t,r,a,i),t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=v.sent(),l=c[0],f=c[1],h=s_e(l,f,t,r,a,i),d=h.selectedIndices,p=h.selectedScores,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:yi(d,"int32"),selectedScores:yi(p)}]}})})}var v_e=p_e;function m_e(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=M(n,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=_c(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},d={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},p=Q.runKernel(Yke,h,d);return{selectedIndices:p[0],validOutputs:p[1]}}var g_e=K({nonMaxSuppressionPadded_:m_e});function y_e(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,d,p,v,m,g;return _t(this,function(y){switch(y.label){case 0:return o=M(n,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=_c(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=Ne.apply(void 0,[y.sent(),2]),d=h[0],p=h[1],v=o_e(d,p,c,l,f,i),m=v.selectedIndices,g=v.validOutputs,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:yi(m,"int32"),validOutputs:bn(g,"int32")}]}})})}var b_e=y_e;function w_e(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"images","resizeBilinear");G(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),G(r===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Ne(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=Q.runKernel(p2e,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var x_e=K({resizeBilinear_:w_e});function k_e(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"images","resizeNearestNeighbor");G(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),G(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),G(r===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Ne(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=Q.runKernel(d2e,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var S_e=K({resizeNearestNeighbor_:k_e});function N_e(n,e,t,r){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),r===void 0&&(r=.5);var i=M(n,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=mt(yi([r]),255),f,h,d,p;if(G(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),G(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),G(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),G(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=Ne(Zf(i,[1,1,1],-1),3),f=a[0],h=a[1],d=a[2];var v=mt(f,o),m=mt(h,s),g=mt(d,u);p=jn(jn(v,m),g)}else p=n;if(e==="otsu"){var y=lB(rr(OB(p),"int32"),qw([]),256);l=T_e(y,c)}var b=t?Ow(p,l):Lv(p,l),w=rr(mt(b,255),"int32");return w}function T_e(n,e){for(var t=yi([-1]),r=yi([0]),a=yi([0]),i,o,s,u,c,l,f=0;f<n.size-1;f++){i=fn(n,0,f+1),o=fn(n,f+1),c=yr(en(i),e),l=yr(en(o),e);var h=en(mt(i,Xf(0,i.size)));s=yr(h,en(i));var d=Rv(o.shape,i.size),p=jn(Xf(0,o.size),d),v=mt(o,p);u=yr(en(v),en(o));var m=Ct(s,u),g=Ct(s,u),y=mt(c,l);a=mt(mt(y,m),g);var b=Lv(a,r);r=Ec(b,a,r),t=Ec(b,yi([f]),t)}return t}var E_e=K({threshold_:N_e});function I_e(n,e,t,r,a,i){t===void 0&&(t="nearest"),r===void 0&&(r="constant"),a===void 0&&(a=0);var o=M(n,"image","transform","float32"),s=M(e,"transforms","transform","float32");G(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),G(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:r,fillValue:a,outputShape:i};return Q.runKernel(j2e,u,c)}var C_e=K({transform_:I_e});function A_e(n,e,t){G(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),G(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")});var r=M(n,"a","bandPart");G(r.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")});var a=r.shape,i=Ne(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(t<=s))throw new Error("bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,")."));e<0&&(e=o),t<0&&(t=s);var u=ge(Xf(0,o,1,"int32"),[-1,1]),c=Xf(0,s,1,"int32"),l=Ct(u,c),f=Cv(Ow(l,bn(+e,"int32")),bB(l,bn(-t,"int32"))),h=Ic([o,s],r.dtype);return ge(Jf(Ww(ge(r,[-1,o,s])).map(function(d){return Ec(f,d,h)})),a)}var __e=K({bandPart_:A_e});function D_e(n){var e;if(Array.isArray(n)){e=!1,G(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){G(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(n[u].shape[0]," vs. ").concat(t,")")})},a=1;a<n.length;++a)r(a)}else e=!0,n=Zf(n,n.shape[0],0).map(function(u){return $w(u,[0])});G(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(n.length,") exceeds ")+"number of dimensions (".concat(n[0].shape[0],").")});for(var i=[],o=n,s=function(u){i.push(Q.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=mt(en(mt(i[l],c)),i[l]);c=Ct(c,f)}return yr(c,Bv(c,"euclidean"))}))},a=0;a<n.length;++a)s(a);return e?Jf(i,0):i}var F_e=K({gramSchmidt_:D_e});function R_e(n,e){if(e===void 0&&(e=!1),G(n.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(n.rank)}),n.rank===2)return R4(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(u,c){return u*c}),r=Ww(ge(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),a=[],i=[];r.forEach(function(u){var c=Ne(R4(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ge(Jf(a,0),n.shape),s=ge(Jf(i,0),n.shape);return[o,s]}function R4(n,e){return e===void 0&&(e=!1),Q.tidy(function(){G(n.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(n.shape.length,"D Tensor.")});for(var t=n.shape[0],r=n.shape[1],a=mB(t),i=wc(n),o=Gf([[1]],[1,1]),s=wc(o),u=t>=r?r:t,c=function(f){var h,d=i,p=s,v=a;h=Ne(Q.tidy(function(){var m=fn(i,[f,f],[t-f,1]),g=Bv(m),y=fn(i,[f,f],[1,1]),b=Ec(Lv(y,0),Gf([[-1]]),Gf([[1]])),w=Ct(y,mt(b,g)),x=yr(m,w);x.shape[0]===1?s=wc(o):s=Qr([o,fn(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var N=oo(yr(Bt(b,w),g)),T=fn(i,[f,0],[t-f,r]),E=mt(N,s),C=gw(s);if(f===0)i=Ct(T,Bt(E,Bt(C,T)));else{var F=Ct(T,Bt(E,Bt(C,T)));i=Qr([fn(i,[0,0],[f,r]),F],0)}var D=gw(E),O=fn(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=Ct(O,Bt(Bt(O,s),D));else{var L=Ct(O,Bt(Bt(O,s),D));a=Qr([fn(a,[0,0],[t,f]),L],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],uAe([d,p,v])},l=0;l<u;++l)c(l);return!e&&t>r&&(a=fn(a,[0,0],[t,r]),i=fn(i,[0,0],[r,r])),[a,i]})}var O_e=K({qr_:R_e});var Dr;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Dr||(Dr={}));function P_e(n,e,t){t===void 0&&(t=Dr.SUM_BY_NONZERO_WEIGHTS);var r=M(n,"losses","computeWeightedLoss"),a=null;e!=null&&(a=M(e,"weights","computeWeightedLoss"));var i=a==null?r:mt(r,a);if(t===Dr.NONE)return i;if(t===Dr.SUM)return en(i);if(t===Dr.MEAN){if(a==null)return Av(i);var o=r.size/a.size,s=yr(en(i),en(a));return o>1?yr(s,bn(o)):s}if(t===Dr.SUM_BY_NONZERO_WEIGHTS){if(a==null)return yr(en(i),bn(r.size));var u=mt(a,Ys(r.shape)),c=rr(en(CB(u,bn(0))),"float32");return yr(en(i),c)}throw Error("Unknown reduction: ".concat(t))}var uo=K({computeWeightedLoss_:P_e});function M_e(n,e,t,r){r===void 0&&(r=Dr.SUM_BY_NONZERO_WEIGHTS);var a=M(n,"labels","absoluteDifference"),i=M(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=M(t,"weights","absoluteDifference")),Ua(a.shape,i.shape,"Error in absoluteDifference: ");var s=$a(Ct(a,i));return uo(s,o,r)}var B_e=K({absoluteDifference_:M_e});function L_e(n,e,t,r,a){a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","cosineDistance"),o=M(e,"predictions","cosineDistance"),s=null;r!=null&&(s=M(r,"weights","cosineDistance")),Ua(i.shape,o.shape,"Error in cosineDistance: ");var u=bn(1),c=Ct(u,en(mt(i,o),t,!0));return uo(c,s,a)}var z_e=K({cosineDistance_:L_e});function $_e(n,e,t,r){r===void 0&&(r=Dr.SUM_BY_NONZERO_WEIGHTS);var a=M(n,"labels","hingeLoss"),i=M(e,"predictions","hingeLoss"),o=null;t!=null&&(o=M(t,"weights","hingeLoss")),Ua(a.shape,i.shape,"Error in hingeLoss: ");var s=bn(1);a=Ct(mt(bn(2),a),s);var u=$v(Ct(s,mt(a,i)));return uo(u,o,r)}var q_e=K({hingeLoss_:$_e});function W_e(n,e,t,r,a){r===void 0&&(r=1),a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","huberLoss"),o=M(e,"predictions","huberLoss"),s=null;t!=null&&(s=M(t,"weights","huberLoss")),Ua(i.shape,o.shape,"Error in huberLoss: ");var u=bn(r),c=$a(Ct(o,i)),l=IB(c,u),f=Ct(c,l),h=jn(mt(bn(.5),Mv(l)),mt(u,f));return uo(h,s,a)}var V_e=K({huberLoss_:W_e});function G_e(n,e,t,r,a){r===void 0&&(r=1e-7),a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","logLoss"),o=M(e,"predictions","logLoss"),s=null;t!=null&&(s=M(t,"weights","logLoss")),Ua(i.shape,o.shape,"Error in logLoss: ");var u=bn(1),c=bn(r),l=oo(mt(i,jf(jn(o,c)))),f=mt(Ct(u,i),jf(jn(Ct(u,o),c))),h=Ct(l,f);return uo(h,s,a)}var U_e=K({logLoss_:G_e});function H_e(n,e,t,r){r===void 0&&(r=Dr.SUM_BY_NONZERO_WEIGHTS);var a=M(n,"labels","meanSquaredError"),i=M(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=M(t,"weights","meanSquaredError")),Ua(a.shape,i.shape,"Error in meanSquaredError: ");var s=MB(a,i);return uo(s,o,r)}var K_e=K({meanSquaredError_:H_e});function j_e(n,e){var t=M(n,"labels","sigmoidCrossEntropyWithLogits"),r=M(e,"logits","sigmoidCrossEntropyWithLogits");Ua(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=$v(r),i=mt(r,t),o=xB(Js(oo($a(r))));return jn(Ct(a,i),o)}function X_e(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"multiClassLabels","sigmoidCrossEntropy"),o=M(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","sigmoidCrossEntropy")),Ua(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=bn(r),c=bn(1),l=bn(.5);i=jn(mt(i,Ct(c,u)),mt(l,u))}var f=j_e(i,o);return uo(f,s,a)}var Y_e=K({sigmoidCrossEntropy_:X_e});function Z_e(n,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var r=so(function(a,i,o){var s=!0,u=SB(i,[t],s),c=Ct(rr(i,"float32"),u);o([a,c]);var l=oo(mt(c,a)),f=en(l,[t]),h=function(d,p){var v=Ne(p,2),m=v[0],g=v[1],y=Pv(d.shape,[t]);return[mt(ge(d,y),Ct(rr(m,"float32"),Js(g))),mt(ge(d,y),Ct(Js(g),rr(m,"float32")))]};return{value:f,gradFunc:h}});return r(n,e)}function J_e(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"onehotLabels","softmaxCrossEntropy"),o=M(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","softmaxCrossEntropy")),Ua(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=bn(r),c=bn(1),l=bn(i.shape[1]);i=jn(mt(i,Ct(c,u)),yr(u,l))}var f=Z_e(i,o);return uo(f,s,a)}var Q_e=K({softmaxCrossEntropy_:J_e});function eDe(n,e,t,r){var a=M(n,"indices","sparseFillEmptyRows","int32"),i=M(e,"values","sparseFillEmptyRows"),o=M(t,"denseShape","sparseFillEmptyRows","int32"),s=M(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Q.runKernel(O2e,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var tDe=K({sparseFillEmptyRows_:eDe});function nDe(n,e,t){var r=M(n,"inputIndices","sparseReshape","int32"),a=M(e,"inputShape","sparseReshape","int32"),i=M(t,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(r.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Q.runKernel(P2e,o);return{outputIndices:s[0],outputShape:s[1]}}var rDe=K({sparseReshape_:nDe});function aDe(n,e,t){var r=M(n,"data","sparseSegmentMean"),a=M(e,"indices","sparseSegmentMean","int32"),i=M(t,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Q.runKernel(M2e,o)}var iDe=K({sparseSegmentMean_:aDe});function oDe(n,e,t){var r=M(n,"data","sparseSegmentSum"),a=M(e,"indices","sparseSegmentSum","int32"),i=M(t,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Q.runKernel(B2e,o)}var sDe=K({sparseSegmentSum_:oDe});function uDe(n,e,t,r,a,i,o,s){var u=M(n,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=M(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=Q.runKernel(q2e,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var cDe=K({stringNGrams_:uDe});function lDe(n,e,t){t===void 0&&(t=!0);var r=M(n,"input","stringSplit","string"),a=M(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:r,delimiter:a},s=Q.runKernel(W2e,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var fDe=K({stringSplit_:lDe});function hDe(n,e){var t=M(n,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return Q.runKernel(V2e,a,r)}var dDe=K({stringToHashBucketFast_:hDe});var pDe={fft:Lw,ifft:_v,rfft:zw,irfft:PB},vDe={hammingWindow:$Ae,hannWindow:$B,frame:qB,stft:GAe},mDe={flipLeftRight:jAe,grayscaleToRGB:YAe,resizeNearestNeighbor:S_e,resizeBilinear:x_e,rotateWithOffset:JAe,cropAndResize:HAe,nonMaxSuppression:e_e,nonMaxSuppressionAsync:f_e,nonMaxSuppressionWithScore:d_e,nonMaxSuppressionWithScoreAsync:v_e,nonMaxSuppressionPadded:g_e,nonMaxSuppressionPaddedAsync:b_e,threshold:E_e,transform:C_e},gDe={bandPart:__e,gramSchmidt:F_e,qr:O_e},yDe={absoluteDifference:B_e,computeWeightedLoss:uo,cosineDistance:z_e,hingeLoss:q_e,huberLoss:V_e,logLoss:U_e,meanSquaredError:K_e,sigmoidCrossEntropy:Y_e,softmaxCrossEntropy:Q_e},bDe={sparseFillEmptyRows:tDe,sparseReshape:rDe,sparseSegmentMean:iDe,sparseSegmentSum:sDe},wDe={stringNGrams:cDe,stringSplit:fDe,stringToHashBucketFast:dDe};var ar={__proto__:null,abs:$a,acos:ESe,acosh:CSe,add:jn,addN:DSe,all:RSe,any:PSe,argMax:BSe,argMin:zSe,asin:qSe,asinh:VSe,atan:USe,atan2:KSe,atanh:XSe,avgPool:uB,avgPool3d:aNe,basicLSTMCell:dNe,batchToSpaceND:cB,batchNorm:Fv,batchNorm2d:yNe,batchNorm3d:wNe,batchNorm4d:kNe,bincount:lB,broadcastArgs:TNe,broadcastTo:xv,buffer:Uo,cast:rr,ceil:CNe,clipByValue:_Ne,clone:wc,complex:Zs,concat:Qr,concat1d:RNe,concat2d:PNe,concat3d:BNe,concat4d:zNe,conv1d:WNe,conv2d:Ov,conv2dTranspose:UNe,conv3d:KNe,conv3dTranspose:ZNe,cos:QNe,cosh:tTe,cumprod:rTe,cumsum:iTe,denseBincount:sTe,depthToSpace:cTe,depthwiseConv2d:Dw,diag:hTe,dilation2d:pTe,div:yr,divNoNan:kTe,dot:NTe,einsum:ETe,elu:pB,equal:dB,erf:ATe,euclideanNorm:zTe,exp:Js,expandDims:js,expm1:VTe,eye:mB,fill:Rv,floor:gB,floorDiv:hB,gather:yB,greater:Lv,greaterEqual:bB,imag:zv,isFinite:JTe,isInf:eEe,isNaN:nEe,leakyRelu:wB,less:iEe,lessEqual:Ow,linspace:sEe,localResponseNormalization:cEe,log:jf,log1p:xB,logSigmoid:vEe,logSoftmax:yEe,logSumExp:SB,logicalAnd:Cv,logicalNot:NB,logicalOr:TB,logicalXor:NEe,lowerBound:EEe,matMul:Bt,max:kc,maxPool:EB,maxPool3d:AEe,maxPoolWithArgmax:DEe,maximum:REe,mean:Av,meshgrid:PEe,min:vw,minimum:IB,mirrorPad:LEe,mod:$Ee,moments:WEe,mul:mt,multiRNNCell:GEe,multinomial:HEe,neg:oo,notEqual:CB,oneHot:XEe,ones:Ys,onesLike:ZEe,outerProduct:QEe,pad:Qf,pad1d:nIe,pad2d:aIe,pad3d:oIe,pad4d:uIe,pool:dIe,pow:Rw,prelu:_B,print:vIe,prod:gIe,raggedGather:bIe,raggedRange:xIe,raggedTensorToTensor:SIe,rand:TIe,randomGamma:zIe,randomNormal:DB,randomStandardNormal:WIe,randomUniform:FB,range:Xf,real:Yf,reciprocal:HIe,relu:$v,relu6:RB,reshape:ge,reverse:Qs,reverse1d:ZIe,reverse2d:QIe,reverse3d:tCe,reverse4d:rCe,round:OB,rsqrt:oCe,scalar:bn,selu:uCe,separableConv2d:lCe,setdiff1dAsync:hCe,sigmoid:xc,sign:pCe,sin:mCe,sinh:yCe,slice:fn,slice1d:wCe,slice2d:kCe,slice3d:NCe,slice4d:ECe,softmax:CCe,softplus:kB,spaceToBatchND:AB,fft:Lw,ifft:_v,irfft:PB,rfft:zw,split:Zf,sqrt:mw,square:Mv,squaredDifference:MB,squeeze:$w,stack:Jf,step:BB,stridedSlice:zCe,sub:Ct,sum:en,tan:qCe,tanh:pw,tensor:qw,tensor1d:yi,tensor2d:Gf,tensor3d:WCe,tensor4d:VCe,tensor5d:GCe,tensor6d:UCe,tile:Vf,topk:KCe,truncatedNormal:XCe,unique:ZCe,unsortedSegmentSum:QCe,unstack:Ww,upperBound:tAe,variable:nAe,where:Ec,whereAsync:LB,zeros:Ic,zerosLike:Fw,op:K,OP_SCOPE_SUFFIX:sB,booleanMaskAsync:oAe,transpose:gw,norm:Bv,movingAverage:fAe,scatterND:vAe,searchSorted:Pw,sparseToDense:yAe,gatherND:wAe,dropout:SAe,enclosingPowerOfTwo:zB,cosineWindow:Vw,inTopKAsync:TAe,image:mDe,linalg:gDe,losses:yDe,spectral:pDe,fused:LAe,signal:vDe,sparse:bDe,string:wDe};var xDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(I("a",n,e,t),I("b",n,e,t))];case"AddN":return[r.addN(I("tensors",n,e,t))];case"FloorMod":case"Mod":return[r.mod(I("a",n,e,t),I("b",n,e,t))];case"Mul":return[r.mul(I("a",n,e,t),I("b",n,e,t))];case"RealDiv":case"Div":return[r.div(I("a",n,e,t),I("b",n,e,t))];case"DivNoNan":return[r.divNoNan(I("a",n,e,t),I("b",n,e,t))];case"FloorDiv":return[r.floorDiv(I("a",n,e,t),I("b",n,e,t))];case"Sub":return[r.sub(I("a",n,e,t),I("b",n,e,t))];case"Minimum":return[r.minimum(I("a",n,e,t),I("b",n,e,t))];case"Maximum":return[r.maximum(I("a",n,e,t),I("b",n,e,t))];case"Pow":return[r.pow(I("a",n,e,t),I("b",n,e,t))];case"SquaredDifference":return[r.squaredDifference(I("a",n,e,t),I("b",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var kDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Abs":case"ComplexAbs":return[r.abs(I("x",n,e,t))];case"Acos":return[r.acos(I("x",n,e,t))];case"Acosh":return[r.acosh(I("x",n,e,t))];case"Asin":return[r.asin(I("x",n,e,t))];case"Asinh":return[r.asinh(I("x",n,e,t))];case"Atan":return[r.atan(I("x",n,e,t))];case"Atan2":return[r.atan2(I("x",n,e,t),I("y",n,e,t))];case"Atanh":return[r.atanh(I("x",n,e,t))];case"Ceil":return[r.ceil(I("x",n,e,t))];case"Complex":return[r.complex(I("real",n,e,t),I("imag",n,e,t))];case"Cos":return[r.cos(I("x",n,e,t))];case"Cosh":return[r.cosh(I("x",n,e,t))];case"Elu":return[r.elu(I("x",n,e,t))];case"Erf":return[r.erf(I("x",n,e,t))];case"Exp":return[r.exp(I("x",n,e,t))];case"Expm1":return[r.expm1(I("x",n,e,t))];case"Floor":return[r.floor(I("x",n,e,t))];case"Log":return[r.log(I("x",n,e,t))];case"Log1p":return[r.log1p(I("x",n,e,t))];case"Imag":return[r.imag(I("x",n,e,t))];case"Neg":return[r.neg(I("x",n,e,t))];case"Reciprocal":return[r.reciprocal(I("x",n,e,t))];case"Real":return[r.real(I("x",n,e,t))];case"Relu":return[r.relu(I("x",n,e,t))];case"Round":return[r.round(I("x",n,e,t))];case"Selu":return[r.selu(I("x",n,e,t))];case"Sigmoid":return[r.sigmoid(I("x",n,e,t))];case"Sin":return[r.sin(I("x",n,e,t))];case"Sign":return[r.sign(I("x",n,e,t))];case"Sinh":return[r.sinh(I("x",n,e,t))];case"Softplus":return[r.softplus(I("x",n,e,t))];case"Sqrt":return[r.sqrt(I("x",n,e,t))];case"Square":return[r.square(I("x",n,e,t))];case"Tanh":return[r.tanh(I("x",n,e,t))];case"Tan":return[r.tan(I("x",n,e,t))];case"ClipByValue":return[r.clipByValue(I("x",n,e,t),I("clipValueMin",n,e,t),I("clipValueMax",n,e,t))];case"Relu6":return[r.relu6(I("x",n,e,t))];case"Rsqrt":return[r.rsqrt(gr(n.inputNames[0],e,t))];case"Prod":return[r.prod(I("x",n,e,t),I("axes",n,e,t))];case"LeakyRelu":return[r.leakyRelu(I("x",n,e,t),I("alpha",n,e,t))];case"Prelu":return[r.prelu(I("x",n,e,t),I("alpha",n,e,t))];case"IsNan":return[r.isNaN(gr(n.inputNames[0],e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};function qa(n,e,t){if(t===void 0&&(t=""),!(typeof n=="number"||typeof e=="number")){Be.util.assert(n.length===e.length,function(){return t+" Shapes ".concat(n," and ").concat(e," must match")});for(var r=0;r<n.length;r++){var a=n[r],i=e[r];Be.util.assert(a<0||i<0||a===i,function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}}}function O4(n){return!(typeof n=="number"||n.some(function(e){return e<0}))}function $f(n,e,t){var r=yw(n,t),a=!O4(r);if(a&&e.length===0)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(r));if(a&&e.forEach(function(i){r=yw(i.shape,r)}),!O4(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function yw(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error("Incompatible ranks during merge: ".concat(n," vs. ").concat(e));for(var t=[],r=0;r<n.length;++r){var a=n[r],i=e[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(n," vs. ").concat(e));t[r]=a>=0?a:i}return t}var SDe=function(){function n(e,t,r,a,i,o,s){this.name=e,this.dtype=t,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Be.scalar(0),Be.keep(this.idTensor)}return Object.defineProperty(n.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"closed",{get:function(){return this.closed_},enumerable:!1,configurable:!0}),n.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},n.prototype.size=function(){return this.tensors.length},n.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},n.prototype.readMany=function(e){var t=this;return e.map(function(r){return t.read(r)})},n.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var r=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,`,
          because the value dtype is `).concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),qa(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),r.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(r.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));r.tensor=t,Be.keep(t),r.written=!0,this.tensors[e]=r},n.prototype.writeMany=function(e,t){var r=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach(function(a,i){return r.write(a,t[i])})},n.prototype.gather=function(e,t){if(!!t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Be.tensor([],[0].concat(this.elementShape));var a=this.readMany(e);return qa(this.elementShape,a[0].shape,"TensorArray shape mismatch: "),Be.stack(a,0)},n.prototype.concat=function(e){if(!!e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(this.size()===0)return Be.tensor([],[0].concat(this.elementShape));for(var t=[],r=0;r<this.size();r++)t.push(r);var a=this.readMany(t);return qa(this.elementShape,a[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(a[0].shape,")")),Be.concat(a,0)},n.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var r=Math.max.apply(Math,yn([],Ne(e),!1));if(!this.dynamicSize&&r>=this.maxSize)throw new Error("Max index must be < array size (".concat(r,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Be.unstack(t,0))},n.prototype.split=function(e,t){var r=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var a=0,i=e.map(function(l){return a+=l,a});if(a!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(a,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var o=a===0?0:t.size/a,s=[];Be.tidy(function(){t=Be.reshape(t,[1,a,o]);for(var l=0;l<e.length;++l){var f=l===0?0:i[l-1],h=[0,f,0],d=[1,e[l],o];s[l]=Be.reshape(Be.slice(t,h,d),r.elementShape)}return s});for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)},n}(),qv=function(){function n(e,t,r,a){a===void 0&&(a=-1),this.tensors=e,this.elementShape=t,this.elementDtype=r,e?.forEach(function(i){if(r!==i.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(i.dtype));qa(t,i.shape,"TensorList shape mismatch: "),Be.keep(i)}),this.idTensor=Be.scalar(0),this.maxNumElements=a,Be.keep(this.idTensor)}return Object.defineProperty(n.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),n.prototype.copy=function(){return new n(yn([],Ne(this.tensors),!1),this.elementShape,this.elementDtype)},n.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},n.prototype.size=function(){return this.tensors.length},n.prototype.stack=function(e,t,r){var a=this;if(r===void 0&&(r=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(r!==-1&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));qa(e,this.elementShape,"TensorList shape mismatch: ");var i=$f(this.elementShape,this.tensors,e);return Be.tidy(function(){var o=a.tensors.map(function(s){return Be.reshape(s,i)});return Be.stack(o,0)})},n.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(this.size()===0)throw new Error("Trying to pop from an empty list.");var r=$f(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,qa(a.shape,e,"TensorList shape mismatch: "),Be.reshape(a,r)},n.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(qa(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Be.keep(e),this.tensors.push(e)},n.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));var t=new n([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(var r=0;r<Math.min(this.tensors.length,e);++r)t.tensors[r]=this.tensors[r];return t},n.prototype.getItem=function(e,t,r){if(r!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(this.tensors[e]==null)throw new Error("element at index ".concat(e," is null."));qa(this.tensors[e].shape,t,"TensorList shape mismatch: ");var a=$f(this.elementShape,this.tensors,t);return Be.reshape(this.tensors[e],a)},n.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));qa(this.elementShape,t.shape,"TensorList shape mismatch: "),Be.keep(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t},n.prototype.gather=function(e,t,r){var a=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));qa(this.elementShape,r,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=$f(this.elementShape,this.tensors,r);return e.length===0?Be.tensor([],[0].concat(i)):Be.tidy(function(){var o=e.map(function(s){return Be.reshape(a.tensors[s],i)});return Be.stack(o,0)})},n.prototype.concat=function(e,t){var r=this;if(!!e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));qa(this.elementShape,t,"TensorList shape mismatch: ");var a=$f(this.elementShape,this.tensors,t);return this.size()===0?Be.tensor([],[0].concat(a)):Be.tidy(function(){var i=r.tensors.map(function(o){return Be.reshape(o,a)});return Be.concat(i,0)})},n}();function NDe(n,e,t){var r=n.dtype;if(n.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(n.shape));if(n.dtype!==t)throw new Error("Invalid data types; op elements ".concat(n.dtype,", but list elements ").concat(t));var a=n.shape.slice(1);qa(a,e,"TensorList shape mismatch: ");var i=Be.unstack(n);return new qv(i,e,r)}function TDe(n,e,t,r){return new qv([],n,e,r)}function EDe(n,e,t,r){if(e.length!==n.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(n.shape[0]));var a=Math.max.apply(Math,yn([],Ne(e),!1));if(r!=null&&r!==-1&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new qv([],t,n.dtype,r),o=Be.unstack(n,0);return e.forEach(function(s,u){i.setItem(s,o[u])}),i}function IDe(n,e,t){var r=0,a=e.map(function(f){return r+=f,r});if(r!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(r,", and tensor's shape is: ").concat(n.shape));for(var i=n.shape.slice(1),o=yw(i,t),s=r===0?0:n.size/r,u=Be.tidy(function(){var f=[];n=Be.reshape(n,[1,r,s]);for(var h=0;h<e.length;++h){var d=h===0?0:a[h-1],p=[0,d,0],v=[1,e[h],s];f[h]=Be.reshape(Be.slice(n,p,v),o)}return n.dispose(),f}),c=new qv([],t,n.dtype,e.length),l=0;l<u.length;l++)c.setItem(l,u[l]);return c}var CDe=function(n,e,t){return Pt(void 0,void 0,void 0,function(){var r,a,i,o,c,h,s,u,c,l,f,h,d,p,v,v,y,m,y,g,y,y,y,An,b,et,w,x,N,T,E,C,oe,st,F,D,le,O,we,Ae,L,z,$,pe,xe,B,rt,W,ft,X,tt,rn,Z,V,j,re,ne,kt,oe,st,He,kt,le,et,Ze,He,pe,xe,et,Ye,He,et,at,he,Ye,ye,He,we,Ae,et,at,He,kt,et,at,Ye,He,ht,et,at,He,rt,He,ft,et,kt,st,He,kt,et,Ze,He,tt,et,rn,He,kt,He,kt,An,hr,On;return _t(this,function(_n){switch(_n.label){case 0:switch(r=n.op,r){case"If":return[3,1];case"StatelessIf":return[3,1];case"While":return[3,3];case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":return[3,27];case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"EmptyTensorList":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListConcatV2":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35];case"TensorListLength":return[3,36];case"TensorListResize":return[3,37]}return[3,38];case 1:return a=I("thenBranch",n,e,t),i=I("elseBranch",n,e,t),o=I("cond",n,e,t),c=I("args",n,e,t),[4,o.data()];case 2:return h=_n.sent(),h[0]?[2,t.functionMap[a].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)]:[2,t.functionMap[i].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 3:return s=I("body",n,e,t),u=I("cond",n,e,t),c=I("args",n,e,t),[4,t.functionMap[u].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 4:return l=_n.sent(),f=c.map(function(an){return an.id}),[4,l[0].data()];case 5:h=_n.sent(),l.forEach(function(an){!an.kept&&f.indexOf(an.id)===-1&&an.dispose()}),d=c,p=function(){var an,Pr,dr;return _t(this,function(Mr){switch(Mr.label){case 0:return an=d,[4,t.functionMap[s].executeFunctionAsync(d,t.tensorArrayMap,t.tensorListMap)];case 1:return d=Mr.sent(),Pr=d.map(function(Sn){return Sn.id}),an.forEach(function(Sn){!Sn.kept&&f.indexOf(Sn.id)===-1&&Pr.indexOf(Sn.id)===-1&&Sn.dispose()}),[4,t.functionMap[u].executeFunctionAsync(d,t.tensorArrayMap,t.tensorListMap)];case 2:return dr=Mr.sent(),[4,dr[0].data()];case 3:return h=Mr.sent(),dr.forEach(function(Sn){!Sn.kept&&f.indexOf(Sn.id)===-1&&Pr.indexOf(Sn.id)===-1&&Sn.dispose()}),[2]}})},_n.label=6;case 6:return h[0]?[5,p()]:[3,8];case 7:return _n.sent(),[3,6];case 8:return[2,d];case 9:return v=I("pred",n,e,t),[2,[io(v)]];case 10:return v=I("pred",n,e,t),y=I("data",n,e,t),y.kept||(y=io(y)),[4,v.data()];case 11:return[2,_n.sent()[0]?[void 0,y]:[y,void 0]];case 12:return m=n.inputNames.find(function(an){return gr(an,e,t)!==void 0}),m?(y=gr(m,e,t),[2,[io(y)]]):[2,void 0];case 13:return g=I("frameName",n,e,t),y=I("tensor",n,e,t),t.enterFrame(g),[2,[io(y)]];case 14:return y=I("tensor",n,e,t),t.exitFrame(),[2,[io(y)]];case 15:return y=I("tensor",n,e,t),t.nextIteration(),[2,[io(y)]];case 16:return An=I("size",n,e,t),b=I("dtype",n,e,t),et=I("elementShape",n,e,t),w=I("dynamicSize",n,e,t),x=I("clearAfterRead",n,e,t),N=I("identicalElementShapes",n,e,t),T=I("name",n,e,t),E=new SDe(T,b,An,et,N,w,x),t.addTensorArray(E),[2,[E.idTensor,Be.scalar(1)]];case 17:return C=I("tensorArrayId",n,e,t),oe=I("index",n,e,t),st=I("tensor",n,e,t),F=t.getTensorArray(C.id),F.write(oe,st),[2,[F.idTensor]];case 18:return D=I("tensorArrayId",n,e,t),le=I("index",n,e,t),O=t.getTensorArray(D.id),[2,[O.read(le)]];case 19:return we=I("tensorArrayId",n,e,t),Ae=I("indices",n,e,t),L=I("dtype",n,e,t),z=t.getTensorArray(we.id),[2,[z.gather(Ae,L)]];case 20:return $=I("tensorArrayId",n,e,t),pe=I("indices",n,e,t),xe=I("tensor",n,e,t),B=t.getTensorArray($.id),B.scatter(pe,xe),[2,[B.idTensor]];case 21:return rt=I("tensorArrayId",n,e,t),W=t.getTensorArray(rt.id),ft=I("dtype",n,e,t),[2,[W.concat(ft)]];case 22:return X=I("tensorArrayId",n,e,t),tt=I("tensor",n,e,t),rn=I("lengths",n,e,t),Z=t.getTensorArray(X.id),Z.split(rn,tt),[2,[Z.idTensor]];case 23:return V=I("tensorArrayId",n,e,t),j=t.getTensorArray(V.id),[2,[Be.scalar(j.size(),"int32")]];case 24:return re=I("tensorArrayId",n,e,t),ne=t.getTensorArray(re.id),ne.clearAndClose(),[2,[ne.idTensor]];case 25:return kt=I("tensorListId",n,e,t),oe=I("index",n,e,t),st=I("tensor",n,e,t),He=t.getTensorList(kt.id),He.setItem(oe,st),[2,[He.idTensor]];case 26:return kt=I("tensorListId",n,e,t),le=I("index",n,e,t),et=I("elementShape",n,e,t),Ze=I("elementDType",n,e,t),He=t.getTensorList(kt.id),[2,[He.getItem(le,et,Ze)]];case 27:return pe=I("indices",n,e,t),xe=I("tensor",n,e,t),et=I("elementShape",n,e,t),Ye=I("numElements",n,e,t),He=EDe(xe,pe,et,Ye),t.addTensorList(He),[2,[He.idTensor]];case 28:return et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),he=void 0,n.op==="TensorListReserve"?he="numElements":he="maxNumElements",Ye=I(he,n,e,t),ye=n.op==="TensorListReserve"?-1:Ye,He=TDe(et,at,Ye,ye),t.addTensorList(He),[2,[He.idTensor]];case 29:return we=I("tensorListId",n,e,t),Ae=I("indices",n,e,t),et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),He=t.getTensorList(we.id),[2,[He.gather(Ae,at,et)]];case 30:return kt=I("tensorListId",n,e,t),et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),Ye=I("numElements",n,e,t),He=t.getTensorList(kt.id),[2,[He.stack(et,at,Ye)]];case 31:return ht=I("tensor",n,e,t),et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),He=NDe(ht,et,at),t.addTensorList(He),[2,[He.idTensor]];case 32:return rt=I("tensorListId",n,e,t),He=t.getTensorList(rt.id),ft=I("dtype",n,e,t),et=I("elementShape",n,e,t),[2,[He.concat(ft,et)]];case 33:return kt=I("tensorListId",n,e,t),st=I("tensor",n,e,t),He=t.getTensorList(kt.id),He.pushBack(st),[2,[He.idTensor]];case 34:return kt=I("tensorListId",n,e,t),et=I("elementShape",n,e,t),Ze=I("elementDType",n,e,t),He=t.getTensorList(kt.id),[2,[He.popBack(et,Ze)]];case 35:return tt=I("tensor",n,e,t),et=I("elementShape",n,e,t),rn=I("lengths",n,e,t),He=IDe(tt,rn,et),t.addTensorList(He),[2,[He.idTensor]];case 36:return kt=I("tensorListId",n,e,t),He=t.getTensorList(kt.id),[2,[Be.scalar(He.size(),"int32")]];case 37:return kt=I("tensorListId",n,e,t),An=I("size",n,e,t),hr=t.getTensorList(kt.id),On=hr.resize(An),t.addTensorList(On),[2,[On.idTensor]];case 38:throw TypeError("Node type ".concat(n.op," is not implemented"))}})})};function P4(n,e,t){var r=Ne(I("fusedOps",n,e,t),2),a=r[0],i=r[1],o=a==="biasadd",s=!o,u=i==="prelu",c=a==="fusedbatchnorm",l=I("numArgs",n,e,t);if(o){if(u&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=I("strides",n,e,t),h=yv(n,e,t),d=I("dataFormat",n,e,t).toUpperCase(),p=I("dilations",n,e,t),v=Ne(I("args",n,e,t),2),m=v[0],g=v[1];s&&(g=m,m=void 0);var y=I("leakyreluAlpha",n,e,t);return{stride:f,pad:h,dataFormat:d,dilations:p,biasArg:m,preluArg:g,activationFunc:i,leakyreluAlpha:y}}var ADe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Conv1D":{var a=I("stride",n,e,t),i=I("pad",n,e,t),o=I("dataFormat",n,e,t).toUpperCase(),s=I("dilation",n,e,t);return[r.conv1d(I("x",n,e,t),I("filter",n,e,t),a,i,o,s)]}case"Conv2D":{var a=I("strides",n,e,t),i=yv(n,e,t),o=I("dataFormat",n,e,t).toUpperCase(),u=I("dilations",n,e,t);return[r.conv2d(I("x",n,e,t),I("filter",n,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"_FusedConv2D":{var c=P4(n,e,t),a=c.stride,i=c.pad,o=c.dataFormat,u=c.dilations,l=c.biasArg,f=c.preluArg,h=c.activationFunc,d=c.leakyreluAlpha;return[r.fused.conv2d({x:I("x",n,e,t),filter:I("filter",n,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:d})]}case"FusedDepthwiseConv2dNative":{var p=P4(n,e,t),a=p.stride,i=p.pad,o=p.dataFormat,u=p.dilations,l=p.biasArg,f=p.preluArg,h=p.activationFunc,d=p.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:I("x",n,e,t),filter:I("filter",n,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:d})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{var v=I("outputShape",n,e,t),a=I("strides",n,e,t),i=yv(n,e,t);return[r.conv2dTranspose(I("x",n,e,t),I("filter",n,e,t),v,[a[1],a[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{var a=I("strides",n,e,t),i=yv(n,e,t),u=I("dilations",n,e,t),o=I("dataFormat",n,e,t).toUpperCase();return[r.depthwiseConv2d(I("input",n,e,t),I("filter",n,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"Conv3D":{var a=I("strides",n,e,t),i=I("pad",n,e,t),o=I("dataFormat",n,e,t).toUpperCase(),u=I("dilations",n,e,t);return[r.conv3d(I("x",n,e,t),I("filter",n,e,t),[a[1],a[2],a[3]],i,o,[u[1],u[2],u[3]])]}case"AvgPool":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.avgPool(I("x",n,e,t),[m[1],m[2]],[a[1],a[2]],i)]}case"MaxPool":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.maxPool(I("x",n,e,t),[m[1],m[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t),g=I("includeBatchInIndex",n,e,t),y=r.maxPoolWithArgmax(I("x",n,e,t),[m[1],m[2]],[a[1],a[2]],i,g),b=y.result,w=y.indexes;return[b,w]}case"AvgPool3D":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.avgPool3d(I("x",n,e,t),[m[1],m[2],m[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.maxPool3d(I("x",n,e,t),[m[1],m[2],m[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{var x=I("strides",n,e,t),i=I("pad",n,e,t),u=I("dilations",n,e,t),N=x[1],T=x[2],E=u[1],C=u[2];return[r.dilation2d(I("x",n,e,t),I("filter",n,e,t),[N,T],i,[E,C],"NHWC")]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var _De=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Fill":{var a=I("shape",n,e,t),i=I("dtype",n,e,t),o=I("value",n,e,t);return[r.fill(a,o,i)]}case"LinSpace":{var s=I("start",n,e,t),u=I("stop",n,e,t),c=I("num",n,e,t);return[r.linspace(s,u,c)]}case"Multinomial":{var l=I("logits",n,e,t),f=I("numSamples",n,e,t),h=I("seed",n,e,t);return[r.multinomial(l,f,h)]}case"OneHot":{var d=I("indices",n,e,t),p=I("depth",n,e,t),v=I("onValue",n,e,t),m=I("offValue",n,e,t),i=I("dtype",n,e,t);return[r.oneHot(d,p,v,m,i)]}case"Ones":return[r.ones(I("shape",n,e,t),I("dtype",n,e,t))];case"OnesLike":return[r.onesLike(I("x",n,e,t))];case"RandomStandardNormal":return[r.randomStandardNormal(I("shape",n,e,t),I("dtype",n,e,t),I("seed",n,e,t))];case"RandomUniform":return[r.randomUniform(I("shape",n,e,t),I("minval",n,e,t),I("maxval",n,e,t),I("dtype",n,e,t))];case"Range":{var s=I("start",n,e,t),u=I("stop",n,e,t),g=I("step",n,e,t);return[r.range(s,u,g,I("dtype",n,e,t))]}case"TruncatedNormal":{var a=I("shape",n,e,t),y=I("mean",n,e,t),b=I("stdDev",n,e,t),h=I("seed",n,e,t);return[r.truncatedNormal(a,y,b,I("dtype",n,e,t),h)]}case"Zeros":return[r.zeros(I("shape",n,e,t),I("dtype",n,e,t))];case"ZerosLike":return[r.zerosLike(I("x",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};function H1(n,e,t){var r=I("boxes",n,e,t),a=I("scores",n,e,t),i=I("maxOutputSize",n,e,t),o=I("iouThreshold",n,e,t),s=I("scoreThreshold",n,e,t),u=I("softNmsSigma",n,e,t);return{boxes:r,scores:a,maxOutputSize:i,iouThreshold:o,scoreThreshold:s,softNmsSigma:u}}var DDe=function(n,e,t,r,a){return a===void 0&&(a=ar),Pt(void 0,void 0,void 0,function(){var i,o,f,h,d,p,v,s,g,u,f,h,d,p,v,c,g,l,f,h,d,p,v,m,g;return _t(this,function(y){switch(y.label){case 0:switch(i=n.op,i){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":return[3,5];case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return o=H1(n,e,t),f=o.boxes,h=o.scores,d=o.maxOutputSize,p=o.iouThreshold,v=o.scoreThreshold,s=o.softNmsSigma,[4,a.image.nonMaxSuppressionWithScoreAsync(f,h,d,p,v,s)];case 2:return g=y.sent(),[2,[g.selectedIndices,g.selectedScores]];case 3:return u=H1(n,e,t),f=u.boxes,h=u.scores,d=u.maxOutputSize,p=u.iouThreshold,v=u.scoreThreshold,c=I("padToMaxOutputSize",n,e,t),[4,a.image.nonMaxSuppressionPaddedAsync(f,h,d,p,v,c)];case 4:return g=y.sent(),[2,[g.selectedIndices,g.validOutputs]];case 5:return l=H1(n,e,t),f=l.boxes,h=l.scores,d=l.maxOutputSize,p=l.iouThreshold,v=l.scoreThreshold,[4,a.image.nonMaxSuppressionAsync(f,h,d,p,v)];case 6:return[2,[y.sent()]];case 7:return m=a.cast(I("condition",n,e,t),"bool"),[4,a.whereAsync(m)];case 8:return g=[y.sent()],m.dispose(),[2,g];case 9:return[2,a.setdiff1dAsync(I("x",n,e,t),I("y",n,e,t))];case 10:throw TypeError("Node type ".concat(n.op," is not implemented"))}})})};var FDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"LowerBound":{var a=I("sortedSequence",n,e,t),i=I("values",n,e,t);return[r.lowerBound(a,i)]}case"TopKV2":{var o=I("x",n,e,t),s=I("k",n,e,t),u=I("sorted",n,e,t),c=r.topk(o,s,u);return[c.values,c.indices]}case"UpperBound":{var a=I("sortedSequence",n,e,t),i=I("values",n,e,t);return[r.upperBound(a,i)]}case"Unique":{var o=I("x",n,e,t),c=r.unique(o);return[c.values,c.indices]}case"UniqueV2":{var o=I("x",n,e,t),l=I("axis",n,e,t),c=r.unique(o,l);return[c.values,c.indices]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var RDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":var a=I("default",n,e,t);return[gr(n.name,e,t)||a];case"Placeholder":return[gr(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{var i=I("x",n,e,t);return[io(i)]}case"IdentityN":return I("x",n,e,t).map(function(h){return io(h)});case"Snapshot":var o=I("x",n,e,t);return[io(o)];case"Shape":return[r.tensor1d(I("x",n,e,t).shape,"int32")];case"ShapeN":return I("x",n,e,t).map(function(h){return r.tensor1d(h.shape)});case"Size":return[r.scalar(I("x",n,e,t).size,"int32")];case"Rank":return[r.scalar(I("x",n,e,t).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var s=I("x",n,e,t),u=I("data",n,e,t),c=I("message",n,e,t),l=I("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var f=0;f<u.length;f++)console.log(Array.prototype.slice.call(u[f].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}},ODe=function(){function n(e,t){this.keyDType=e,this.valueDType=t,this.handle=Be.scalar(0),this.tensorMap=new Map,Be.keep(this.handle)}return Object.defineProperty(n.prototype,"id",{get:function(){return this.handle.id},enumerable:!1,configurable:!0}),n.prototype.clearAndClose=function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()},n.prototype.size=function(){return this.tensorMap.size},n.prototype.tensorSize=function(){return bn(this.size(),"int32")},n.prototype.import=function(e,t){return Pt(this,void 0,void 0,function(){var r,a=this;return _t(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return r=i.sent(),this.tensorMap.forEach(function(o){return o.dispose()}),this.tensorMap.clear(),[2,Be.tidy(function(){var o=Be.unstack(t),s=r.length,u=o.length;Be.util.assert(s===u,function(){return"The number of elements doesn't match, keys has "+"".concat(s," elements, the values has ").concat(u," ")+"elements."});for(var c=0;c<s;c++){var l=r[c],f=o[c];Be.keep(f),a.tensorMap.set(l,f)}return a.handle})]}})})},n.prototype.find=function(e,t){return Pt(this,void 0,void 0,function(){var r,a=this;return _t(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return r=i.sent(),[2,Be.tidy(function(){for(var o=[],s=0;s<r.length;s++){var u=r[s],c=a.findWithDefault(u,t);o.push(c)}return Be.stack(o)})]}})})},n.prototype.findWithDefault=function(e,t){var r=this.tensorMap.get(e);return r??t},n.prototype.checkKeyAndValueTensor=function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))},n}(),PDe=function(n,e,t,r){return Pt(void 0,void 0,void 0,function(){var a,i,o,s,h,f,c,u,h,f,c,l,h,f,h;return _t(this,function(d){switch(d.label){case 0:switch(a=n.op,a){case"HashTable":return[3,1];case"HashTableV2":return[3,1];case"InitializeTable":return[3,2];case"InitializeTableV2":return[3,2];case"LookupTableImport":return[3,2];case"LookupTableImportV2":return[3,2];case"LookupTableFind":return[3,4];case"LookupTableFindV2":return[3,4];case"LookupTableSize":return[3,6];case"LookupTableSizeV2":return[3,6]}return[3,7];case 1:return i=r.getHashTableHandleByName(n.name),i!=null?[2,[i]]:(o=I("keyDType",n,e,t),s=I("valueDType",n,e,t),h=new ODe(o,s),r.addHashTable(n.name,h),[2,[h.handle]]);case 2:return f=I("tableHandle",n,e,t,r),c=I("keys",n,e,t),u=I("values",n,e,t),h=r.getHashTableById(f.id),[4,h.import(c,u)];case 3:return[2,[d.sent()]];case 4:return f=I("tableHandle",n,e,t,r),c=I("keys",n,e,t),l=I("defaultValue",n,e,t),h=r.getHashTableById(f.id),[4,h.find(c,l)];case 5:return[2,[d.sent()]];case 6:return f=I("tableHandle",n,e,t,r),h=r.getHashTableById(f.id),[2,[h.tensorSize()]];case 7:throw TypeError("Node type ".concat(n.op," is not implemented"))}})})};var MDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"ResizeBilinear":{var a=I("images",n,e,t),i=I("size",n,e,t),o=I("alignCorners",n,e,t),s=I("halfPixelCenters",n,e,t);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)]}case"ResizeNearestNeighbor":{var a=I("images",n,e,t),i=I("size",n,e,t),o=I("alignCorners",n,e,t),s=I("halfPixelCenters",n,e,t);return[r.image.resizeNearestNeighbor(a,[i[0],i[1]],o,s)]}case"CropAndResize":{var u=I("image",n,e,t),c=I("boxes",n,e,t),l=I("boxInd",n,e,t),f=I("cropSize",n,e,t),h=I("method",n,e,t),d=I("extrapolationValue",n,e,t);return[r.image.cropAndResize(u,c,l,f,h,d)]}case"ImageProjectiveTransformV3":{var a=I("images",n,e,t),p=I("transforms",n,e,t),v=I("outputShape",n,e,t),m=I("fillValue",n,e,t),g=I("interpolation",n,e,t),y=I("fillMode",n,e,t);return[r.image.transform(a,p,g.toLowerCase(),y.toLowerCase(),m,v)]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var BDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Equal":return[r.equal(I("a",n,e,t),I("b",n,e,t))];case"NotEqual":return[r.notEqual(I("a",n,e,t),I("b",n,e,t))];case"Greater":return[r.greater(I("a",n,e,t),I("b",n,e,t))];case"GreaterEqual":return[r.greaterEqual(I("a",n,e,t),I("b",n,e,t))];case"Less":return[r.less(I("a",n,e,t),I("b",n,e,t))];case"LessEqual":return[r.lessEqual(I("a",n,e,t),I("b",n,e,t))];case"LogicalAnd":return[r.logicalAnd(I("a",n,e,t),I("b",n,e,t))];case"LogicalNot":return[r.logicalNot(I("a",n,e,t))];case"LogicalOr":return[r.logicalOr(I("a",n,e,t),I("b",n,e,t))];case"Select":case"SelectV2":return[r.where(I("condition",n,e,t),I("a",n,e,t),I("b",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}},LDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(I("a",n,e,t),I("b",n,e,t),I("transposeA",n,e,t),I("transposeB",n,e,t))];case"Einsum":return[r.einsum.apply(r,yn([I("equation",n,e,t)],Ne(I("tensors",n,e,t)),!1))];case"Transpose":return[r.transpose(I("x",n,e,t),I("perm",n,e,t))];case"_FusedMatMul":var a=Ne(I("fusedOps",n,e,t),2),i=a[0],o=a[1],s=i==="biasadd",u=o==="prelu",c=I("numArgs",n,e,t),l=I("leakyreluAlpha",n,e,t);if(s){if(u&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=Ne(I("args",n,e,t),2),h=f[0],d=f[1];return[r.fused.matMul({a:I("a",n,e,t),b:I("b",n,e,t),transposeA:I("transposeA",n,e,t),transposeB:I("transposeB",n,e,t),bias:h,activation:o,preluActivationWeights:d,leakyreluAlpha:l})];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var zDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"EuclideanNorm":return[r.euclideanNorm(I("x",n,e,t),I("axis",n,e,t),I("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(I("x",n,e,t),I("mean",n,e,t),I("variance",n,e,t),I("offset",n,e,t),I("scale",n,e,t),I("epsilon",n,e,t))];case"FusedBatchNormV3":return[r.batchNorm(I("x",n,e,t),I("mean",n,e,t),I("variance",n,e,t),I("offset",n,e,t),I("scale",n,e,t),I("epsilon",n,e,t))];case"LRN":return[r.localResponseNormalization(I("x",n,e,t),I("radius",n,e,t),I("bias",n,e,t),I("alpha",n,e,t),I("beta",n,e,t))];case"Softmax":return[r.softmax(I("x",n,e,t))];case"LogSoftmax":return[r.logSoftmax(I("x",n,e,t))];case"SparseToDense":return[r.sparseToDense(I("sparseIndices",n,e,t),I("outputShape",n,e,t),I("sparseValues",n,e,t),I("defaultValue",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var $De=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"RaggedGather":{var a=r.raggedGather(I("paramsNestedSplits",n,e,t),I("paramsDenseValues",n,e,t),I("indices",n,e,t),I("outputRaggedRank",n,e,t)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o)}case"RaggedRange":{var s=r.raggedRange(I("starts",n,e,t),I("limits",n,e,t),I("splits",n,e,t)),u=s.rtNestedSplits,c=s.rtDenseValues;return[u,c]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(I("shape",n,e,t),I("values",n,e,t),I("defaultValue",n,e,t),I("rowPartitionTensors",n,e,t),I("rowPartitionTypes",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var qDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Max":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.max(I("x",n,e,t),a,i)]}case"Mean":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.mean(I("x",n,e,t),a,i)]}case"Min":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.min(I("x",n,e,t),a,i)]}case"Sum":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.sum(I("x",n,e,t),a,i)]}case"All":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.all(I("x",n,e,t),a,i)]}case"Any":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.any(I("x",n,e,t),a,i)]}case"ArgMax":{var a=I("axis",n,e,t);return[r.argMax(I("x",n,e,t),a)]}case"ArgMin":{var a=I("axis",n,e,t);return[r.argMin(I("x",n,e,t),a)]}case"Prod":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.prod(I("x",n,e,t),a,i)]}case"Cumprod":{var a=I("axis",n,e,t),o=I("exclusive",n,e,t),s=I("reverse",n,e,t);return[r.cumprod(I("x",n,e,t),a,o,s)]}case"Cumsum":{var a=I("axis",n,e,t),o=I("exclusive",n,e,t),s=I("reverse",n,e,t);return[r.cumsum(I("x",n,e,t),a,o,s)]}case"Bincount":var u=I("x",n,e,t),c=I("weights",n,e,t),l=I("size",n,e,t);return[r.bincount(u,c,l)];case"DenseBincount":{var f=I("x",n,e,t),h=I("weights",n,e,t),d=I("size",n,e,t),p=I("binaryOutput",n,e,t);return[r.denseBincount(f,h,d,p)]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var WDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"ConcatV2":case"Concat":{var a=I("n",n,e,t),i=I("axis",n,e,t),o=I("tensors",n,e,t);return o=o.slice(0,a),[r.concat(o,i)]}case"Gather":{var s=I("x",n,e,t),u=I("indices",n,e,t);return[r.gather(s,r.cast(u,"int32"),0)]}case"GatherV2":{var i=I("axis",n,e,t),c=I("batchDims",n,e,t),s=I("x",n,e,t),u=I("indices",n,e,t);return[r.gather(s,r.cast(u,"int32"),i,c)]}case"Reverse":{for(var l=I("dims",n,e,t),i=[],f=0;f<l.length;f++)l[f]&&i.push(f);var s=I("x",n,e,t);return[r.reverse(s,i)]}case"ReverseV2":{var i=I("axis",n,e,t),s=I("x",n,e,t);return[r.reverse(s,i)]}case"Slice":{var h=I("begin",n,e,t),d=I("size",n,e,t);return[r.slice(I("x",n,e,t),h,d)]}case"StridedSlice":{var h=I("begin",n,e,t),p=I("end",n,e,t),v=I("strides",n,e,t),m=I("beginMask",n,e,t),g=I("endMask",n,e,t),y=I("ellipsisMask",n,e,t),b=I("newAxisMask",n,e,t),w=I("shrinkAxisMask",n,e,t),x=I("x",n,e,t);return[r.stridedSlice(x,h,p,v,m,g,y,b,w)]}case"Pack":return Be.tidy(function(){var L=I("axis",n,e,t),z=I("tensors",n,e,t),$=z[0].shape,B=r.squeeze(z[0]).shape,W=z.map(function(X){var Z=Be.util.arraysEqual(X.shape,$);if(!Z&&!Be.util.arraysEqual(r.squeeze(X).shape,B))throw new Error("the input tensors shape does not match");return Z?X:r.reshape(X,$)});return[r.stack(W,L)]});case"Unpack":{var i=I("axis",n,e,t),x=I("tensor",n,e,t);return r.unstack(x,i)}case"Tile":{var N=I("reps",n,e,t);return[r.tile(I("x",n,e,t),N)]}case"Split":case"SplitV":{var i=I("axis",n,e,t),T=I("numOrSizeSplits",n,e,t),x=I("x",n,e,t);return r.split(x,T,i)}case"ScatterNd":{var u=I("indices",n,e,t),E=I("values",n,e,t),C=I("shape",n,e,t);return[r.scatterND(u,E,C)]}case"GatherNd":{var F=I("x",n,e,t),u=I("indices",n,e,t);return[r.gatherND(F,u)]}case"SparseToDense":{var u=I("sparseIndices",n,e,t),C=I("outputShape",n,e,t),D=I("sparseValues",n,e,t),O=I("defaultValue",n,e,t);return[r.sparseToDense(u,D,C,D.dtype===O.dtype?O:r.cast(O,D.dtype))]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var VDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"SparseFillEmptyRows":{var a=r.sparse.sparseFillEmptyRows(I("indices",n,e,t),I("values",n,e,t),I("denseShape",n,e,t),I("defaultValue",n,e,t)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u]}case"SparseReshape":{var c=r.sparse.sparseReshape(I("inputIndices",n,e,t),I("inputShape",n,e,t),I("newShape",n,e,t)),i=c.outputIndices,l=c.outputShape;return[i,l]}case"SparseSegmentMean":{var f=r.sparse.sparseSegmentMean(I("data",n,e,t),I("indices",n,e,t),I("segmentIds",n,e,t));return[f]}case"SparseSegmentSum":{var f=r.sparse.sparseSegmentSum(I("data",n,e,t),I("indices",n,e,t),I("segmentIds",n,e,t));return[f]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var GDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"FFT":return[r.fft(I("x",n,e,t))];case"IFFT":return[r.ifft(I("x",n,e,t))];case"RFFT":return[r.rfft(I("x",n,e,t))];case"IRFFT":return[r.irfft(I("x",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var UDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"StringNGrams":{var a=r.string.stringNGrams(I("data",n,e,t),I("dataSplits",n,e,t),I("separator",n,e,t),I("nGramWidths",n,e,t),I("leftPad",n,e,t),I("rightPad",n,e,t),I("padWidth",n,e,t),I("preserveShortSequences",n,e,t)),i=a.nGrams,o=a.nGramsSplits;return[i,o]}case"StringSplit":{var s=r.string.stringSplit(I("input",n,e,t),I("delimiter",n,e,t),I("skipEmpty",n,e,t)),u=s.indices,c=s.values,l=s.shape;return[u,c,l]}case"StringToHashBucketFast":{var f=r.string.stringToHashBucketFast(I("input",n,e,t),I("numBuckets",n,e,t));return[f]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var HDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Cast":return[r.cast(I("x",n,e,t),I("dtype",n,e,t))];case"ExpandDims":{var a=I("axis",n,e,t);return[r.expandDims(I("x",n,e,t),a)]}case"Squeeze":{var a=I("axis",n,e,t);return[r.squeeze(I("x",n,e,t),a)]}case"Reshape":return[r.reshape(I("x",n,e,t),I("shape",n,e,t))];case"MirrorPad":return[r.mirrorPad(I("x",n,e,t),I("padding",n,e,t),I("mode",n,e,t))];case"PadV2":case"Pad":return[r.pad(I("x",n,e,t),I("padding",n,e,t),I("constantValue",n,e,t))];case"SpaceToBatchND":{var i=I("blockShape",n,e,t),o=I("paddings",n,e,t);return[r.spaceToBatchND(I("x",n,e,t),i,o)]}case"BatchToSpaceND":{var i=I("blockShape",n,e,t),s=I("crops",n,e,t);return[r.batchToSpaceND(I("x",n,e,t),i,s)]}case"DepthToSpace":{var u=I("blockSize",n,e,t),c=I("dataFormat",n,e,t).toUpperCase();return[r.depthToSpace(I("x",n,e,t),u,c)]}case"BroadcastTo":return[r.broadcastTo(I("x",n,e,t),I("shape",n,e,t))];case"BroadcastArgs":return[r.broadcastArgs(I("s0",n,e,t),I("s1",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};function M4(n,e,t,r,a){a===void 0&&(a=c4.tidy);var i=function(o,s,u){switch(o.category){case"arithmetic":return a(function(){return xDe(o,s,u)});case"basic_math":return a(function(){return kDe(o,s,u)});case"control":return CDe(o,s,u);case"convolution":return a(function(){return ADe(o,s,u)});case"creation":return a(function(){return _De(o,s,u)});case"dynamic":return DDe(o,s,u);case"evaluation":return a(function(){return FDe(o,s,u)});case"image":return a(function(){return MDe(o,s,u)});case"graph":return a(function(){return RDe(o,s,u)});case"logical":return a(function(){return BDe(o,s,u)});case"matrices":return a(function(){return LDe(o,s,u)});case"normalization":return a(function(){return zDe(o,s,u)});case"ragged":return a(function(){return $De(o,s,u)});case"reduction":return a(function(){return qDe(o,s,u)});case"slice_join":return a(function(){return WDe(o,s,u)});case"sparse":return a(function(){return VDe(o,s,u)});case"spectral":return a(function(){return GDe(o,s,u)});case"string":return a(function(){return UDe(o,s,u)});case"transformation":return a(function(){return HDe(o,s,u)});case"hash_table":return PDe(o,s,u,r);case"custom":var c=$4(o.op);if(c&&c.customExecutor)return c.customExecutor(new Zwe(o,s,u));throw TypeError("Custom op ".concat(o.op," is not registered."));default:throw TypeError("Unknown op '".concat(o.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(n,e,t);return c4.util.isPromise(i)?i.then(function(o){return[].concat(o)}):[].concat(i)}var B4=function(){function n(e,t,r,a){e===void 0&&(e={}),t===void 0&&(t={}),r===void 0&&(r={}),a===void 0&&(a={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return n.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(n.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!1,configurable:!0}),n.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var r=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(r))}e.push(""),this._currentContextIds=e},n.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":"".concat(t.frameName,"-").concat(t.iterationId)}).join("/"):""},n.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},n.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")},n.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")},n.prototype.getWeight=function(e){return this.weightMap[e]},n.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},n.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},n.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},n.prototype.getTensorList=function(e){return this.tensorListMap[e]},n.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},n}();function L4(n,e,t,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(n).map(function(d){return Zr(d)[0]}),l=[];r!=null&&(l=r.map(function(d){return Zr(d.name)[0]}));for(var f=yn([],Ne(e),!1);f.length>0;){var h=f.pop();if((WB(h)||ZDe(h)||JDe(h))&&o==null&&(o=h,s=o.children.map(function(d){return d.name}).filter(function(d){return a.has(d)})),a.add(h.name),t[h.name]==null&&c.indexOf(h.name)===-1&&l.indexOf(h.name)===-1){if(h.inputs.length===0){i.push(h.name);continue}h.inputs.forEach(function(d){u.has(d.name)||(u.add(d.name),f.push(d))})}}return{inputs:n,outputs:e,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function KDe(n,e,t){var r=t.usedNodes,a=t.inputs,i=[],o=Object.keys(a).map(function(f){return Zr(f)[0]}).map(function(f){return n.nodes[f]}),s=n.initNodes;o.forEach(function(f){r.has(f.name)&&i.push(f)}),n.weights.forEach(function(f){r.has(f.name)&&i.push(f)}),s?.forEach(function(f){r.has(f.name)&&i.push(f)});for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),e[l.name]||c.push(l),l.children.forEach(function(f){!u.has(f.name)&&r.has(f.name)&&f.inputs.every(function(h){return u.has(h.name)})&&i.push(f)})}return c}var jDe=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],XDe=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],YDe=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function WB(n){return jDe.indexOf(n.op)>=0}function ZDe(n){return XDe.indexOf(n.op)>=0}function JDe(n){return YDe.indexOf(n.op)>=0}var z4=function(){function n(e,t){var r=this;this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(function(a){r._functionExecutorMap[a]=new n(e.functions[a],r)})}return Object.defineProperty(n.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(r){return e[r].map(function(a){return a.id})});this._weightIds=[].concat.apply([],yn([],Ne(t),!1)),this._weightMap=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"resourceManager",{set:function(e){this._resourceManager=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,r){return t[r]=e._functions[r].signature,t},{})},enumerable:!1,configurable:!0}),n.prototype.getCompilationKey=function(e,t){var r=e.map(function(i){return i.name}).sort(),a=t.map(function(i){return i.name}).sort();return r.join(this.SEPERATOR)+"--"+a.join(this.SEPERATOR)},n.prototype.compile=function(e,t){var r=L4(e,t,this.weightMap,this._initNodes),a=r.missingInputs,i=r.dynamicNode,o=r.syncInputs;if(i!=null)throw new Error("This execution contains the node '".concat(i.name,"', which has ")+"the dynamic op '".concat(i.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(o,"]"));if(a.length>0){var s=t.map(function(c){return c.name}),u=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(s,"] from the provided inputs ")+"[".concat(u,"]. Missing the following inputs: [").concat(a,"]"))}return KDe(this.graph,this.weightMap,r)},n.prototype.cloneAndKeepTensor=function(e){if(e==null)return null;var t=e.clone();return Be.keep(t),t},n.prototype.cloneTensorList=function(e){var t=this;if(!e)return null;var r=e.map(function(a){return t.cloneAndKeepTensor(a)});return r},n.prototype.cloneTensorMap=function(e){var t=this;return Object.fromEntries(Object.entries(e).map(function(r){var a=Ne(r,2),i=a[0],o=a[1];return[i,t.cloneTensorList(o)]}))},n.prototype.execute=function(e,t){var r=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(h){return r.graph.nodes[Zr(h)[0]]}),o=t.map(function(h){return Zr(h)[0]}),s=o.map(function(h){return r.graph.nodes[h]});s.length===0&&(s=this._outputs);var u=this.getCompilationKey(i,s),c=this.compiledMap.get(u);c==null&&(c=this.compile(e,s),this.compiledMap.set(u,c));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}var l={},f={};return Be.tidy(function(){var h=new B4(r.weightMap,l,f,r.functionExecutorMap),d=Object.assign({},r.weightMap);r.keepIntermediateTensors&&(r.clonedTensorsMap=r.cloneTensorMap(r.weightMap)),Object.keys(e).forEach(function(b){var w=Ne(Zr(b),2),x=w[0],N=w[1],T=[];T[N]=e[b],d[x]=T,r.keepIntermediateTensors&&(r.clonedTensorsMap[x]=r.cloneTensorList(T))});for(var p=r.getFrozenTensorIds(d),v={},m=0;m<c.length;m++){var g=c[m];if(!d[g.name]){var y=M4(g,d,h,r._resourceManager);if(Be.util.isPromise(y))throw new Error("The execution of the op '".concat(g.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");d[g.name]=y,r.keepIntermediateTensors&&(r.clonedTensorsMap[g.name]=r.cloneTensorList(y)),r.checkTensorForDisposal(g.name,g,d,h,p,o,v)}}return r.parent==null&&h.dispose(p),t.map(function(b){return gr(b,d,h)})})},n.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(r){return e[r]}).map(function(r){return r.map(function(a){return a.id})}));return new Set(t)},n.prototype.checkTensorForDisposal=function(e,t,r,a,i,o,s){t.category==="control"||o.indexOf(e)!==-1||(r[e].forEach(function(u){u!=null&&(s[u.id]=(s[u.id]||0)+t.children.length)}),t.inputs.forEach(function(u){if(u.category!=="control"){var c=fwe(u.name,r,a);c?.forEach(function(l){if(l&&!l.kept&&!i.has(l.id)){var f=s[l.id];f===1?(l.dispose(),delete s[l.id]):f!=null&&s[l.id]--}})}}))},n.prototype.executeAsync=function(e,t){return Pt(this,void 0,void 0,function(){return _t(this,function(r){return[2,this._executeAsync(e,t)]})})},n.prototype.disposeIntermediateTensors=function(){!this.clonedTensorsMap||(Object.values(this.clonedTensorsMap).forEach(function(e){var t,r;try{for(var a=Sc(e),i=a.next();!i.done;i=a.next()){var o=i.value;o&&!o.isDisposed&&o.dispose()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}),this.clonedTensorsMap=null)},n.prototype.getIntermediateTensors=function(){return this.clonedTensorsMap},n.prototype._executeAsync=function(e,t,r,a,i){return r===void 0&&(r=!1),a===void 0&&(a={}),i===void 0&&(i={}),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f;return _t(this,function(h){switch(h.label){case 0:this.disposeIntermediateTensors(),r||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}return o=new B4(this.weightMap,a,i,this.functionExecutorMap),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),[4,this.executeWithControlFlow(e,o,t,r)];case 1:return s=h.sent(),u=t.map(function(d){return gr(d,s,o)}),c=u.map(function(d){return d.id}),l=Object.keys(e).map(function(d){return e[d].id}),f=new Set(yn(yn(yn([],Ne(c),!1),Ne(l),!1),Ne(this.weightIds),!1)),Object.values(s).forEach(function(d){d.forEach(function(p){p&&!p.isDisposed&&!f.has(p.id)&&p.dispose()})}),this.parent==null&&o.dispose(f),[2,u]}})})},n.prototype.executeFunctionAsync=function(e,t,r){return Pt(this,void 0,void 0,function(){var a,i=this;return _t(this,function(o){return a=e.reduce(function(s,u,c){return s[i.inputs[c].name]=u,s},{}),[2,this._executeAsync(a,this.outputNodes,!0,t,r)]})})},n.prototype.executeWithControlFlow=function(e,t,r,a){return Pt(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N=this;return _t(this,function(T){switch(T.label){case 0:i=Object.keys(e),o=i.map(function(E){return N.graph.nodes[Zr(E)[0]]}),s=r.map(function(E){return Zr(E)[0]}),u=s.map(function(E){return N.graph.nodes[E]}),u.length===0&&(u=this._outputs),c=L4(e,u,this.weightMap,this._initNodes),l=c.usedNodes,f=c.missingInputs,h=c.dynamicNode,d=c.syncInputs,p=yn(yn(yn([],Ne(o),!1),Ne(this.graph.weights),!1),Ne(this._initNodes||[]),!1).map(function(E){return{node:E,contexts:t.currentContext}}),v=Object.assign({},this.weightMap),Object.keys(e).forEach(function(E){var C=Ne(Zr(E),2),F=C[0],D=C[1],O=[];O[D]=e[E],v[F]=O}),m={},g=this.getFrozenTensorIds(v),y={},T.label=1;case 1:return p.length>0?(b=this.processStack(o,p,t,v,y,g,s,m,l),[4,Promise.all(b)]):[3,3];case 2:return T.sent(),[3,1];case 3:if(h==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),w=u.filter(function(E){return!WB(E)&&!gr(E.name,v,t)}).map(function(E){return E.name}),w.length>0)throw x="",h!=null&&(x="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(w,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(f,"]. ").concat(x));return[2,v]}})})},n.prototype.processStack=function(e,t,r,a,i,o,s,u,c){for(var l=this,f=[],h=function(){var p,v,m=t.pop();r.currentContext=m.contexts;var g="";if(m.node.op==="Enter"&&I("isConstant",m.node,a,r)&&(p=Ne(ao(m.node.name,r),1),g=p[0]),a[m.node.name]==null){var y=M4(m.node,a,r,d._resourceManager);g||(v=Ne(ao(m.node.name,r),1),g=v[0]);var b=r.currentContext;Be.util.isPromise(y)?f.push(y.then(function(w){return a[g]=w,l.keepIntermediateTensors&&(l.clonedTensorsMap[g]=l.cloneTensorList(w)),r.currentContext=b,l.checkTensorForDisposal(g,m.node,a,r,o,s,u),l.processChildNodes(m.node,t,r,a,i,c),w})):(a[g]=y,d.keepIntermediateTensors&&(d.clonedTensorsMap[g]=d.cloneTensorList(y)),d.checkTensorForDisposal(g,m.node,a,r,o,s,u),d.processChildNodes(m.node,t,r,a,i,c))}else d.processChildNodes(m.node,t,r,a,i,c)},d=this;t.length>0;)h();return f},n.prototype.processChildNodes=function(e,t,r,a,i,o){e.children.forEach(function(s){var u=Ne(ao(s.name,r),1),c=u[0];i[c]||!o.has(s.name)||(s.op==="Merge"?s.inputNames.some(function(l){return!!gr(l,a,r)})&&(i[c]=!0,t.push({contexts:r.currentContext,node:s})):s.inputNames.every(function(l){return!!gr(l,a,r)})&&(i[c]=!0,t.push({contexts:r.currentContext,node:s})))})},n.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(r){return r.dispose()})})},n.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(r){var a=e[r],i=Ne(Zr(r),1),o=i[0],s=t.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){var u=s.attrParams.shape.value,c=u.length===a.shape.length&&a.shape.every(function(l,f){return u[f]===-1||u[f]===l});Be.util.assert(c,function(){return"The shape of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be [".concat(u,"], but was ")+"[".concat(a.shape,"]")})}s.attrParams.dtype&&s.attrParams.dtype.value&&Be.util.assert(a.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(s.attrParams.dtype.value,", but was ").concat(a.dtype)})})},n.prototype.mapInputs=function(e){var t,r,a={};for(var i in e){var o=(r=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||r===void 0?void 0:r[i];o!=null?a[o.name]=e[i]:a[i]=e[i]}return a},n.prototype.checkInputs=function(e){var t=this,r=Object.keys(e).filter(function(a){var i=Ne(Zr(a),1),o=i[0];return t.graph.nodes[o]==null});if(r.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(r,"] that are not part of graph"))},n.prototype.mapOutputs=function(e){var t=this;return e.map(function(r){var a,i,o=(i=(a=t._signature)===null||a===void 0?void 0:a.outputs)===null||i===void 0?void 0:i[r];return o!=null?o.name:r},{})},n.prototype.checkOutputs=function(e){var t=this;e.forEach(function(r){var a=Ne(Zr(r),1),i=a[0];if(!t.graph.nodes[i])throw new Error("The output '".concat(r,"' is not found in the graph"))})},n}(),QDe=function(){function n(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.hashTableNameToHandle=e,this.hashTableMap=t}return n.prototype.addHashTable=function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t},n.prototype.getHashTableHandleByName=function(e){return this.hashTableNameToHandle[e]},n.prototype.getHashTableById=function(e){return this.hashTableMap[e]},n.prototype.dispose=function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]},n}(),e3e="?tfjs-format=file",t3e="model.json",Xw=function(){function n(e,t,r){t===void 0&&(t={}),r===void 0&&(r=Be.io),this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=r,t==null&&(this.loadOptions={}),this.resourceManager=new QDe}return Object.defineProperty(n.prototype,"modelVersion",{get:function(){return this.version},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"metadata",{get:function(){return this.artifacts.userDefinedMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelSignature",{get:function(){return this.signature},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelStructuredOutputKeys",{get:function(){return this.structuredOutputKeys},enumerable:!1,configurable:!0}),n.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}},n.prototype.load=function(){var e=this;if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Be.util.isPromise(t)?t.then(function(r){return e.loadSync(r)}):this.loadSync(t)},n.prototype.loadSync=function(e){this.artifacts=e;var t=this.artifacts.modelTopology,r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){var a=this.artifacts.userDefinedMetadata;a.signature!=null&&(r=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}this.signature=r,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var i=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new z4(f4.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(i),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){var o=f4.Instance.transformGraph(e.modelInitializer);this.initializer=new z4(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0},n.prototype.save=function(e,t){return Pt(this,void 0,void 0,function(){var r;return _t(this,function(a){if(typeof e=="string"){if(r=this.io.getSaveHandlers(e),r.length===0)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(r.length>1)throw new Error("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(e,"'"));e=r[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},n.prototype.addStructuredOutputNames=function(e){var t=this;if(this.structuredOutputKeys){var r=e instanceof Be.Tensor?[e]:e,a={};return r.forEach(function(i,o){return a[t.structuredOutputKeys[o]]=i}),a}return e},n.prototype.predict=function(e,t){var r=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(r)},n.prototype.predictAsync=function(e,t){return Pt(this,void 0,void 0,function(){var r;return _t(this,function(a){switch(a.label){case 0:return[4,this.executeAsync(e,this.outputNodes)];case 1:return r=a.sent(),[2,this.addStructuredOutputNames(r)]}})})},n.prototype.normalizeInputs=function(e){var t=this,r;if(!(e instanceof Be.Tensor)&&!Array.isArray(e)){var a=(r=this.signature)===null||r===void 0?void 0:r.inputs;if(a!=null)for(var i in a){var o=a[i];o.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[o.resourceId])}return e}e=Array.isArray(e)?e:[e];var s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-s," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var u=0;return this.inputNodes.reduce(function(c,l){var f,h,d,p=(d=(h=(f=t.signature)===null||f===void 0?void 0:f.inputs)===null||h===void 0?void 0:h[l])===null||d===void 0?void 0:d.resourceId;return p!=null?c[l]=t.resourceIdToCapturedInput[p]:c[l]=e[u++],c},{})},n.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},n.prototype.executeInitializerGraph=function(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))},n.prototype.executeInitializerGraphAsync=function(){return Pt(this,void 0,void 0,function(){return _t(this,function(e){return this.initializer==null?[2,[]]:this.initializerSignature==null?[2,this.initializer.executeAsync({},[])]:[2,this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))]})})},n.prototype.setResourceIdToCapturedInput=function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,r=Object.keys(t),a=0;a<r.length;a++){var i=r[a],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[a]}},n.prototype.execute=function(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var r=this.executor.execute(e,t);return r.length>1?r:r[0]},n.prototype.executeAsync=function(e,t){return Pt(this,void 0,void 0,function(){var r,a;return _t(this,function(i){switch(i.label){case 0:return this.resourceIdToCapturedInput!=null?[3,2]:(r=this.setResourceIdToCapturedInput,[4,this.executeInitializerGraphAsync()]);case 1:r.apply(this,[i.sent()]),i.label=2;case 2:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 3:return a=i.sent(),[2,a.length>1?a:a[0]]}})})},n.prototype.getIntermediateTensors=function(){return this.executor.getIntermediateTensors()},n.prototype.disposeIntermediateTensors=function(){this.executor.disposeIntermediateTensors()},n.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,r){return t[r]=[e[r]],t},{})},n.prototype.dispose=function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Be.dispose(this.resourceIdToCapturedInput)),this.resourceManager.dispose()},n}();function n3e(n,e,t){return e===void 0&&(e={}),t===void 0&&(t=Be.io),Pt(this,void 0,void 0,function(){var r;return _t(this,function(a){switch(a.label){case 0:if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=a3e(n)),r=new Xw(n,e,t),[4,r.load()];case 1:return a.sent(),[2,r]}})})}function r3e(n){if(n==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var e;if(n instanceof Array){var t=Ne(n,2),r=t[0],a=t[1];if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");var i=Be.io.getWeightSpecs(r.weightsManifest),o=Be.io.getModelArtifactsForJSONSync(r,i,a);e=Be.io.fromMemorySync(o)}else if("load"in n)e=n;else if("modelTopology"in n&&"weightSpecs"in n&&"weightData"in n)e=Be.io.fromMemorySync(n);else throw new Error("Unknown model format");var s=new Xw(e);return s.load(),s}function a3e(n){return n.endsWith("/")||(n=n+"/"),"".concat(n).concat(t3e).concat(e3e)}var i3e="4.2.0";Xo.GraphModel=Xw;Xo.deregisterOp=lwe;Xo.loadGraphModel=n3e;Xo.loadGraphModelSync=r3e;Xo.registerOp=cwe;Xo.version_converter=i3e});var Yw=Y(()=>{});var GB=Y(()=>{});var fL=Y(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});var wn=As();function o3e(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}var hn=o3e(wn),Jw=function(n,e){return Jw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},Jw(n,e)};function Dt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Jw(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Le(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function ze(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function au(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s3e(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function u3e(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var iu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function c3e(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function ou(n){var e={exports:{}};return n(e,e.exports),e.exports}var l3e=ou(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(iu,n,!1)}),f3e=ou(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(iu,n,!1)}),h3e=ou(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(iu,n,!1)}),d3e=ou(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8&&(d[7]=-1),l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(iu,n,!1)}),p3e=ou(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(iu,n,!1)}),v3e=ou(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(iu,n,!1)}),m3e={},g3e={__proto__:null,default:m3e},y3e=c3e(g3e),su=ou(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=y3e}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:iu,[],Math)});su.alea=l3e;su.xor128=f3e;su.xorwow=h3e;su.xorshift7=d3e;su.xor4096=p3e;su.tychei=v3e;var jB=su;function b3e(n,e){return Gv(n,e)}function Gv(n,e,t,r){if(t===void 0&&(t=new Map),r===void 0&&(r=new Set),n==null)return null;if(typeof Blob=="function"&&n instanceof Blob)return n.slice();if(r.has(n))throw new Error("Circular references are not supported.");if(t.has(n))return t.get(n);var a=e(n);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(Dc(n)){var i=Array.isArray(n)?[]:{};r.add(n);for(var o in n){var s=n[o],u=Gv(s,e,t,r);i[o]=u}return r.delete(n),n.__proto__&&(i.__proto__=n.__proto__),i}else throw new Error("Can't recurse into non-iterable type: ".concat(n));else return t.set(n,a.value),a.value}function w3e(n,e){return e===void 0&&(e=YB),XB(n,e)}function XB(n,e,t){t===void 0&&(t=new Set);var r=n[0];if(t.has(r))throw new Error("Circular references are not supported.");var a=e(n);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(Dc(r)){var i=Array.isArray(r)?[]:{};t.add(r);var o=function(u){var c=n.map(function(f){return f[u]}),l=XB(c,e,t);i[u]=l};for(var s in r)o(s);return t.delete(r),i}else throw new Error("Can't recurse into non-iterable type: ".concat(r));else return a.value}function YB(n){return n===null?null:Dc(n[0])?{value:null,recurse:!0}:{value:n,recurse:!1}}function ZB(n,e){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f;return ze(this,function(h){switch(h.label){case 0:t=new Map,Gv(n,e,t),h.label=1;case 1:h.trys.push([1,6,7,8]),r=au(Array.from(t.keys())),a=r.next(),h.label=2;case 2:return a.done?[3,5]:(i=a.value,o=t.get(i),hn.util.isPromise(o)?[4,o]:[3,4]);case 3:s=h.sent(),t.set(i,s),h.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),l={error:u},[3,8];case 7:try{a&&!a.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 8:return c=Gv(n,e,t),[2,c]}})})}function Dc(n){var e=!1;if(hn.env().get("IS_BROWSER"))e=n instanceof TextDecoder;else{var t=Yw().StringDecoder;e=n instanceof t}return n!=null&&!ArrayBuffer.isView(n)&&(Array.isArray(n)||typeof n=="object"&&!(n instanceof hn.Tensor)&&!(n instanceof Promise)&&!e)}function x3e(n){return n==null||k3e(n)||Array.isArray(n)||typeof n=="object"&&n instanceof hn.Tensor||hn.util.isTypedArray(n)}function k3e(n){return n===null||typeof n!="object"&&typeof n!="function"}function S3e(n){return b3e(n,N3e)}function N3e(n){return n instanceof hn.Tensor?{value:n.clone(),recurse:!1}:Dc(n)?{value:null,recurse:!0}:{value:n,recurse:!1}}var JB=function(){function n(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return n.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},n.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},n.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},n.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},n.prototype.isFull=function(){return this.length()===this.capacity},n.prototype.isEmpty=function(){return this.length()===0},n.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},n.prototype.pushAll=function(e){var t,r;try{for(var a=au(e),i=a.next();!i.done;i=a.next()){var o=i.value;this.push(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},n.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},n.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},n.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},n.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),r=this.get(t);return this.set(t,this.pop()),r},n}(),QB=function(n){Dt(e,n);function e(){return n.call(this,e.INITIAL_CAPACITY)||this}return e.prototype.isFull=function(){return!1},e.prototype.push=function(t){n.prototype.isFull.call(this)&&this.expand(),n.prototype.push.call(this,t)},e.prototype.unshift=function(t){n.prototype.isFull.call(this)&&this.expand(),n.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=this.capacity*2,r=new Array(t),a=this.length(),i=0;i<a;i++)r[i]=this.get(this.wrap(this.begin+i));this.data=r,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=a},e}(JB);QB.INITIAL_CAPACITY=32;function eL(n){return new I3e(n)}function Qw(n){return new C3e(n)}function T3e(n,e){return new tL(n,e)}function E3e(n,e){return e===void 0&&(e=Yo.FAIL),new B3e(n,e)}var Yn=function(){function n(){}return n.prototype.toArray=function(){return Le(this,void 0,void 0,function(){var e,t;return ze(this,function(r){switch(r.label){case 0:return e=[],[4,this.next()];case 1:t=r.sent(),r.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=r.sent(),[3,2];case 4:return[2,e]}})})},n.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){var e,t,r;return ze(this,function(a){switch(a.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:r=a.sent(),a.label=2;case 2:return r.done?[3,4]:(t.push(r.value),[4,e.next()]);case 3:return r=a.sent(),[3,2];case 4:return[2,t]}})})},n.prototype.resolveFully=function(){return Le(this,void 0,void 0,function(){var e;return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},n.prototype.resolveWhile=function(e){return Le(this,void 0,void 0,function(){var t,r;return ze(this,function(a){switch(a.label){case 0:return[4,this.next()];case 1:t=a.sent(),r=e(t.value),a.label=2;case 2:return!t.done&&r?[4,this.next()]:[3,4];case 3:return t=a.sent(),r=e(t.value),[3,2];case 4:return[2]}})})},n.prototype.handleErrors=function(e){return new P3e(this,e)},n.prototype.filter=function(e){return new R3e(this,e)},n.prototype.map=function(e){return new O3e(this,e)},n.prototype.mapAsync=function(e){return new UB(this,e)},n.prototype.serialMapAsync=function(e){return new UB(this,e).serial()},n.prototype.flatmap=function(e){return new M3e(this,e)},n.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.map(e).resolveFully()]})})},n.prototype.serialForEach=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(r){return r===!0})]})})},n.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new F3e(this,e,t)},n.prototype.columnMajorBatch=function(e,t,r){t===void 0&&(t=!0),r===void 0&&(r=YB);var a=this.rowMajorBatch(e,t);return a.map(function(i){return w3e(i,r)})},n.prototype.concatenate=function(e,t){return new tL(eL([this,e]),t)},n.prototype.take=function(e){return e<0||e==null?this:new D3e(this,e)},n.prototype.skip=function(e){return e<0||e==null?this:new _3e(this,e)},n.prototype.prefetch=function(e){return new nL(this,e)},n.prototype.shuffle=function(e,t){return new L3e(this,e,t)},n.prototype.serial=function(){return new A3e(this)},n}(),I3e=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.items=t,r.trav=0,r}return e.prototype.summary=function(){return"Array of ".concat(this.items.length," items")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:S3e(t),done:!1}])})})},e}(Yn),C3e=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.nextFn=t,r}return e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){try{return[2,this.nextFn()]}catch(r){throw r.message="Error thrown while iterating through a dataset: ".concat(r.message),r}return[2]})})},e}(Yn),A3e=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.upstream=t,r.lastRead=Promise.resolve({value:null,done:!1}),r}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Serial")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.upstream.next()]})})},e}(Yn),_3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Skip")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return t=r.sent(),t.done?[2,t]:(hn.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(Yn),D3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.maxCount=r,a.count=0,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Take")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(Yn),F3e=function(n){Dt(e,n);function e(t,r,a){a===void 0&&(a=!0);var i=n.call(this)||this;return i.upstream=t,i.batchSize=r,i.enableSmallLastBatch=a,i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,r;return ze(this,function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return r=a.sent(),r.done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(r.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(Yn),R3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Filter")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:return t=r.sent(),t.done||this.predicate(t.value)?[2,t]:(hn.dispose(t.value),[3,0]);case 2:return[2]}})})},e}(Yn),O3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.transform=r,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Map")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,{value:null,done:!0}];r=hn.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=hn.tensor_util.getTensorsInContainer(a);try{for(o=au(r),s=o.next();!s.done;s=o.next())u=s.value,hn.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(Yn),P3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> handleErrors")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,r.sent()];case 3:return t=r.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(Yn),UB=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.transform=r,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> AsyncMap")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:return t=f.sent(),t.done?[2,{value:null,done:!0}]:(r=hn.tensor_util.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:a=f.sent(),i=hn.tensor_util.getTensorsInContainer(a);try{for(o=au(r),s=o.next();!s.done;s=o.next())u=s.value,hn.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(Yn),ex=function(n){Dt(e,n);function e(){var t=n.call(this)||this;return t.outputQueue=new QB,t.lastRead=Promise.resolve({value:null,done:!1}),t}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(Yn),M3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.transform=r,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Flatmap")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,!1];r=hn.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=hn.tensor_util.getTensorsInContainer(a),this.outputQueue.pushAll(a);try{for(o=au(r),s=o.next();!s.done;s=o.next())u=s.value,hn.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,!0]}})})},e}(ex),tL=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=t,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of chained summaries";return"".concat(t," -> Chained")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return Le(this,void 0,void 0,function(){var r,a;return ze(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if(r=i.sent(),r.done)return[2,{value:null,done:!0}];this.iterator=r.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),i.label=3;case 3:return[4,this.iterator.next()];case 4:return a=i.sent(),a.done?(this.iterator=null,[2,this.readFromChain(t)]):[2,a]}})})},e}(Yn),Yo;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Yo||(Yo={}));var B3e=function(n){Dt(e,n);function e(t,r){r===void 0&&(r=Yo.FAIL);var a=n.call(this)||this;return a.iterators=t,a.mismatchMode=r,a.count=0,a.currentPromise=null,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of zip summaries";return"{".concat(t,"} -> Zip")},e.prototype.nextState=function(t){return Le(this,void 0,void 0,function(){function r(s){if(s instanceof Yn){var u=s.next();return{value:u.then(function(c){return a++,c.done&&i++,c.value}),recurse:!1}}else return{value:null,recurse:!0}}var a,i,o;return ze(this,function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),a=0,i=0,[4,ZB(this.iterators,r)];case 2:if(o=s.sent(),a===i)return[2,{value:null,done:!0}];if(i>0)switch(this.mismatchMode){case Yo.FAIL:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case Yo.SHORTEST:return[2,{value:null,done:!0}];case Yo.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e}(Yn),nL=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.bufferSize=r,a.buffer=new JB(r),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Prefetch")},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(Yn),L3e=function(n){Dt(e,n);function e(t,r,a){var i=n.call(this,t,r)||this;return i.upstream=t,i.windowSize=r,i.upstreamExhausted=!1,i.random=jB.alea(a||hn.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,r;return ze(this,function(a){switch(a.label){case 0:this.upstreamExhausted||this.refill(),a.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:if(r=a.sent(),r.done)this.upstreamExhausted=!0;else return this.refill(),[2,r];return[3,1];case 3:return[2,{value:null,done:!0}]}})})},e}(nL),Fc=function(){function n(){this.size=null}return n.prototype.batch=function(e,t){var r=this;t===void 0&&(t=!0);var a=this;hn.util.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `.concat(e)});var i;return this.size===1/0||this.size==null?i=this.size:t?i=Math.ceil(this.size/e):i=Math.floor(this.size/e),ta(function(){return Le(r,void 0,void 0,function(){return ze(this,function(o){switch(o.label){case 0:return[4,a.iterator()];case 1:return[2,o.sent().columnMajorBatch(e,t,q3e)]}})})},i)},n.prototype.concatenate=function(e){var t=this,r=this,a;return this.size===1/0||e.size===1/0?a=1/0:this.size!=null&&e.size!=null?a=this.size+e.size:a=null,ta(function(){return Le(t,void 0,void 0,function(){var i,o;return ze(this,function(s){switch(s.label){case 0:return[4,r.iterator()];case 1:return o=(i=s.sent()).concatenate,[4,e.iterator()];case 2:return[2,o.apply(i,[s.sent()])]}})})},a)},n.prototype.filter=function(e){var t=this,r=this,a;return this.size===1/0?a=1/0:a=null,ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,r.iterator()];case 1:return[2,i.sent().filter(function(o){return hn.tidy(function(){return e(o)})})]}})})},a)},n.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},n.prototype.map=function(e){var t=this,r=this;return ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,r.iterator()];case 1:return[2,a.sent().map(function(i){return hn.tidy(function(){return e(i)})})]}})})},this.size)},n.prototype.mapAsync=function(e){var t=this,r=this;return ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,r.iterator()];case 1:return[2,a.sent().mapAsync(e)]}})})},this.size)},n.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var r=this;return ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,r.iterator()];case 1:return[2,a.sent().prefetch(e)]}})})},this.size)},n.prototype.repeat=function(e){var t=this,r=this,a;return this.size!=null&&e>0?a=this.size*e:e===0?a=0:this.size!=null&&(e===void 0||e<0)?a=1/0:a=null,ta(function(){return Le(t,void 0,void 0,function(){var i,o=this;return ze(this,function(s){return i=Qw(function(){return Le(o,void 0,void 0,function(){var u;return ze(this,function(c){switch(c.label){case 0:return u={},[4,r.iterator()];case 1:return[2,(u.value=c.sent(),u.done=!1,u)]}})})}),[2,T3e(i.take(e))]})})},a)},n.prototype.skip=function(e){var t=this,r=this,a;return this.size!=null&&e>=0&&this.size>=e?a=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?a=0:a=null,ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,r.iterator()];case 1:return[2,i.sent().skip(e)]}})})},a)},n.prototype.shuffle=function(e,t,r){var a=this;if(r===void 0&&(r=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var i=this,o=jB.alea(t||hn.util.now().toString());return ta(function(){return Le(a,void 0,void 0,function(){var s;return ze(this,function(u){switch(u.label){case 0:return s=o.int32(),r&&(s+=o.int32()),[4,i.iterator()];case 1:return[2,u.sent().shuffle(e,s.toString())]}})})},this.size)},n.prototype.take=function(e){var t=this,r=this,a;return this.size!=null&&this.size>e?a=e:this.size!=null&&this.size<=e?a=this.size:a=null,ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,r.iterator()];case 1:return[2,i.sent().take(e)]}})})},a)},n.prototype.toArray=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},n.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},n}();Fc.MAX_BUFFER_SIZE=1e4;function ta(n,e){return e===void 0&&(e=null),new(function(t){Dt(r,t);function r(){var a=t.apply(this,u3e([],s3e(arguments),!1))||this;return a.size=e,a}return r.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(a){return[2,n()]})})},r}(Fc))}function z3e(n){var e=this;return ta(function(){return Le(e,void 0,void 0,function(){return ze(this,function(t){return[2,eL(n)]})})},n.length)}function $3e(n){var e=this;if(!Dc(n))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(n))for(var r=0;r<n.length;r++)t=t==null?n[r].size:Math.min(t,n[r].size);else if(n instanceof Object)for(var a in n)t=t==null?n[a].size:Math.min(t,n[a].size);return ta(function(){return Le(e,void 0,void 0,function(){var i;return ze(this,function(o){switch(o.label){case 0:return[4,ZB(n,function(s){if(s instanceof Fc)return{value:s.iterator(),recurse:!1};if(Dc(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return i=o.sent(),[2,E3e(i,Yo.SHORTEST)]}})})},t)}function q3e(n){if(n===null)return null;var e=n[0];if(x3e(e)){var t=W3e(n);return{value:t,recurse:!1}}return{value:null,recurse:!0}}function W3e(n){if(n.length===0)throw new Error("Can't make a batch of zero elements.");return n[0]instanceof hn.Tensor?hn.stack(n):hn.tensor(n)}var rL=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.input=t,r}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,r,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),r=t.decodeUTF8(),a=r.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o}),[2,a]}})})},e}(Fc),Wv='"',eh=Symbol("out"),HB=Symbol("field"),Vv=Symbol("quote"),Zw=Symbol("quoteafterquote"),KB=Symbol("quoteinquote"),aL=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.input=t,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new rL(t),r||(r={}),a.hasHeader=r.hasHeader!==!1,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(wn.util.assert(r.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return e.prototype.columnNames=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f=this;return ze(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&wn.util.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+f.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),r=this.fullColumnNames.reduce(function(d,p){return d[p]=d[p]+1||1,d},{}),a=Object.keys(r).filter(function(d){return r[d]>1}),wn.util.assert(a.length===0,function(){return"Duplicate column names found: "+a.toString()}),this.columnConfigs)try{for(i=au(Object.keys(this.columnConfigs)),o=i.next();!o.done;o=i.next())if(s=o.value,u=this.fullColumnNames.indexOf(s),u===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}catch(d){c={error:d}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return Le(this,void 0,void 0,function(){var t,r,a,i;return ze(this,function(o){switch(o.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return t=o.sent(),[4,t.next()];case 2:if(r=o.sent(),r.done)throw new Error("No data was found for CSV parsing.");return a=r.value,i=this.parseRow(a,!1),[2,i];case 3:return[2,null]}})})},e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,r=this;return ze(this,function(a){switch(a.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:a.sent(),a.label=2;case 2:return[4,this.base.iterator()];case 3:return t=a.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(i){return r.makeDataElement(i)})]}})})},e.prototype.makeDataElement=function(t){for(var r=this.parseRow(t),a={},i={},o=0;o<this.fullColumnNames.length;o++){var s=this.fullColumnNames[o],u=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!u)){var c=r[o],l=null;if(c==="")if(u&&u.default!==void 0)l=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column ".concat(s," is empty in this line: ").concat(t));l=void 0}else{var f=Number(c);if(isNaN(f))u&&u.dtype==="bool"?l=this.getBoolean(c):l=c;else if(!u||!u.dtype)l=f;else switch(u.dtype){case"float32":l=f;break;case"int32":l=Math.floor(f);break;case"bool":l=this.getBoolean(c);break;default:l=f}}u&&u.isLabel?i[s]=l:a[s]=l}}return Object.keys(i).length===0?a:{xs:a,ys:i}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,r){r===void 0&&(r=!0);for(var a=[],i=0,o=t.length,s=eh,u=0;u<o;u++)switch(s){case eh:switch(t.charAt(u)){case Wv:i=u+1,s=Vv;break;case this.delimiter:if(i=u+1,this.delimiter===" "&&this.delimWhitespace)break;a.push(""),s=eh;break;default:s=HB,i=u;break}break;case HB:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u)),s=eh,i=u+1;break}break;case Vv:switch(t.charAt(u)){case Wv:s=Zw;break}break;case Zw:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u-1)),s=eh,i=u+1;break;case Wv:s=Vv;break;default:s=KB;break}break;case KB:switch(t.charAt(u)){case Wv:s=Vv;break}break}if(s===Zw?a.push(t.substring(i,o-1)):a.push(t.substring(i)),r&&a.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(a));return a},e}(Fc),V3e=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;r.microphoneConfig=t,r.isClosed=!1,r.fftSize=t.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+"2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=t.numFramesPerSpectrogram||43,r.sampleRateHz=t.sampleRateHz,r.columnTruncateLength=t.columnTruncateLength||r.fftSize,r.audioTrackConstraints=t.audioTrackConstraints,r.smoothingTimeConstant=t.smoothingTimeConstant||0,r.includeSpectrogram=t.includeSpectrogram!==!1,r.includeWaveform=t.includeWaveform===!0,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),Le(this,void 0,void 0,function(){var r;return ze(this,function(a){switch(a.label){case 0:if(!wn.env().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");return r=new e(t),[4,r.start()];case 1:return a.sent(),[2,r]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,r,a,i;return ze(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw r=o.sent(),new Error("Error thrown while initializing video stream: ".concat(r.message));case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: "+"Expected: ".concat(this.sampleRateHz,"; ")+"Actual: ".concat(this.audioContext.sampleRate));return i=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,i.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o;return ze(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return a=s.sent(),this.includeSpectrogram&&(i=this.flattenQueue(a.freqDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(a.timeDataQueue),r=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:r},done:!1}]}})})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return Le(this,void 0,void 0,function(){var t,r,a,i=this;return ze(this,function(o){return t=[],r=[],a=0,[2,new Promise(function(s){var u=setInterval(function(){i.includeSpectrogram&&(i.analyser.getFloatFrequencyData(i.freqData),i.freqData[0]===-1/0&&s({freqDataQueue:t,timeDataQueue:r}),t.push(i.freqData.slice(0,i.columnTruncateLength))),i.includeWaveform&&(i.analyser.getFloatTimeDomainData(i.timeData),r.push(i.timeData.slice())),++a===i.numFrames&&(clearInterval(u),s({freqDataQueue:t,timeDataQueue:r}))},i.fftSize/i.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var r=t[0].length,a=new Float32Array(t.length*r);return t.forEach(function(i,o){return a.set(i,o*r)}),a},e.prototype.getTensorFromAudioDataArray=function(t,r){var a=new Float32Array(wn.util.sizeFromShape(r));return a.set(t,a.length-t.length),wn.tensor(a,r)},e}(Yn),G3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;if(a.webcamVideoElement=t,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=wn.tensor1d([0],"int32"),a.webcamConfig.centerCrop){var i=a.webcamConfig.resizeWidth*1/a.webcamVideoElement.width,o=a.webcamConfig.resizeHeight*1/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=wn.tensor2d([u,s,l,c],[1,4])}else a.cropBox=wn.tensor2d([0,0,1,1],[1,4]);return a}return e.prototype.summary=function(){return"webcam"},e.create=function(t,r){return r===void 0&&(r={}),Le(this,void 0,void 0,function(){var a;return ze(this,function(i){switch(i.label){case 0:if(!wn.env().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!r.resizeWidth||!r.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=r.resizeWidth,t.height=r.resizeHeight}return a=new e(t,r),[4,a.start()];case 1:return i.sent(),[2,a]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,r,a=this;return ze(this,function(i){switch(i.label){case 0:this.webcamConfig.facingMode&&wn.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: ".concat(a.webcamConfig.facingMode,". ")+"Please provide 'user' or 'environment'"}),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=i.sent(),[3,4];case 3:throw r=i.sent(),r.message="Error thrown while initializing video stream: ".concat(r.message),r;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){a.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){if(this.isClosed)return[2,{value:null,done:!0}];try{t=wn.browser.fromPixels(this.webcamVideoElement)}catch(a){throw new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(a)))}if(this.resize)try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(a){throw new Error("Error thrown cropping the video: ".concat(a.message))}finally{t.dispose()}else return[2,{value:t,done:!1}];return[2]})})},e.prototype.needToResize=function(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))},e.prototype.cropAndResizeFrame=function(t){var r=this;return wn.tidy(function(){var a=wn.expandDims(wn.cast(t,"float32"),0),i;i=wn.image.cropAndResize(a,r.cropBox,r.cropBoxInd,r.cropSize,"bilinear");var o=i.shape;return wn.reshape(i,o.slice(1))})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){var t=this.stream.getTracks();t.forEach(function(r){return r.stop()});try{this.webcamVideoElement.srcObject=null}catch(r){console.log(r),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e}(Yn);var iL=function(){function n(){}return n}(),oL=function(n){Dt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.split=function(t){return new U3e(this,t)},e}(Yn),U3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.impl=new H3e(t,r),a}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(oL),H3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.separator=r,a.carryover="",a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u;return ze(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:if(t=c.sent(),t.done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);r=t.value.split(this.separator),r[0]=this.carryover+r[0];try{for(a=au(r.slice(0,-1)),i=a.next();!i.done;i=a.next())o=i.value,this.outputQueue.push(o)}catch(l){s={error:l}}finally{try{i&&!i.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}return this.carryover=r[r.length-1],[2,!0]}})})},e}(ex),K3e=function(n){Dt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.decodeUTF8=function(){return new j3e(this)},e}(Yn),j3e=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.upstream=t,r.impl=new X3e(t),r}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(oL),X3e=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;if(r.upstream=t,wn.env().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=Yw().StringDecoder;r.decoder=new a("utf8")}return r}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Utf8")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,r,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:return t=i.sent(),t.done?[2,!1]:(r=t.value,wn.env().get("IS_BROWSER")?a=this.decoder.decode(r,{stream:!0}):a=this.decoder.write(Buffer.from(r.buffer)),this.outputQueue.push(a),[2,!0])}})})},e}(ex),sL=function(n){Dt(e,n);function e(t,r){r===void 0&&(r={});var a=n.call(this)||this;return a.file=t,a.options=r,wn.util.assert(t instanceof Uint8Array||(wn.env().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),a.offset=r.offset||0,a.chunkSize=r.chunkSize||1024*1024,a}return e.prototype.summary=function(){return"FileChunks ".concat(this.file)},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a=this;return ze(this,function(i){switch(i.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,s){var u=a.offset+a.chunkSize;if(a.file instanceof Uint8Array)o(new Uint8Array(a.file.slice(a.offset,u)));else{var c=new FileReader;c.onload=function(f){var h=c.result;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),!(h instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));o(h)},c.onabort=function(f){return s(new Error("Aborted"))},c.onerror=function(f){return s(new Error(f.type))};var l=a.file.slice(a.offset,u);c.readAsArrayBuffer(l)}a.offset=u}),r={},[4,t]);case 1:return[2,(r.value=i.sent(),r.done=!1,r)]}})})},e}(K3e);function Y3e(n,e,t){return e===void 0&&(e={}),Le(this,void 0,void 0,function(){var r,a,i,o,s;return ze(this,function(u){switch(u.label){case 0:return typeof n=="string"?r=n:(r=n.url,a=Z3e(n)),[4,(t||wn.util.fetch)(r,a)];case 1:return i=u.sent(),i.ok?(s=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new sL(o,e)];case 3:throw new Error(i.statusText)}})})}var Z3e=function(n){var e={method:n.method,headers:n.headers,body:n.body,mode:n.mode,credentials:n.credentials,cache:n.cache,redirect:n.redirect,referrer:n.referrer,integrity:n.integrity};return e};function uL(n){return typeof n=="string"&&n.slice(0,7)==="file://"}var cL=function(n){Dt(e,n);function e(t,r){r===void 0&&(r={});var a=n.call(this)||this;return a.input=t,a.options=r,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){return uL(this.input)&&wn.env().get("IS_NODE")&&(t=GB(),this.input=t.readFileSync(this.input.slice(7))),[2,new sL(this.input,this.options)]})})},e}(iL),lL=function(n){Dt(e,n);function e(t,r){r===void 0&&(r={});var a=n.call(this)||this;return a.url=t,a.fileOptions=r,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return uL(this.url)?[2,new cL(this.url,this.fileOptions).iterator()]:[2,Y3e(this.url,this.fileOptions)]})})},e}(iL);function J3e(n,e){return e===void 0&&(e={}),new aL(new lL(n),e)}function Q3e(n){var e=this,t=Qw(n);return ta(function(){return Le(e,void 0,void 0,function(){return ze(this,function(r){return[2,t]})})})}function eFe(n){var e=this;return ta(function(){return Le(e,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:return[4,n()];case 1:return t=r.sent(),[2,Qw(function(){return t.next()})]}})})})}function tFe(n,e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,G3e.create(n,e)]})})}function nFe(n){return Le(this,void 0,void 0,function(){return ze(this,function(e){return[2,V3e.create(n)]})})}var rFe="4.2.0";Rr.CSVDataset=aL;Rr.Dataset=Fc;Rr.FileDataSource=cL;Rr.TextLineDataset=rL;Rr.URLDataSource=lL;Rr.array=z3e;Rr.csv=J3e;Rr.func=Q3e;Rr.generator=eFe;Rr.microphone=nFe;Rr.version_data=rFe;Rr.webcam=tFe;Rr.zip=$3e});var dL=Y((hL,tx)=>{(function(n,e,t){function r(s){var u=this,c=o();u.next=function(){var l=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=l-(u.c=l|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(s),u.s0<0&&(u.s0+=1),u.s1-=c(s),u.s1<0&&(u.s1+=1),u.s2-=c(s),u.s2<0&&(u.s2+=1),c=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var c=new r(s),l=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,l&&(typeof l=="object"&&a(l,c),f.state=function(){return a(c,{})}),f}function o(){var s=4022871197,u=function(c){c=String(c);for(var l=0;l<c.length;l++){s+=c.charCodeAt(l);var f=.02519603282416938*s;s=f>>>0,f-=s,f*=s,s=f>>>0,f-=s,s+=f*4294967296}return(s>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.alea=i})(hL,typeof tx=="object"&&tx,typeof define=="function"&&define)});var vL=Y((pL,nx)=>{(function(n,e,t){function r(o){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var l=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^l^l>>>8},o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s}function i(o,s){var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor128=i})(pL,typeof nx=="object"&&nx,typeof define=="function"&&define)});var gL=Y((mL,rx)=>{(function(n,e,t){function r(o){var s=this,u="";s.next=function(){var l=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(l^l<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,c==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s.v=o.v,s.d=o.d,s}function i(o,s){var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorwow=i})(mL,typeof rx=="object"&&rx,typeof define=="function"&&define)});var bL=Y((yL,ax)=>{(function(n,e,t){function r(o){var s=this;s.next=function(){var c=s.x,l=s.i,f,h,d;return f=c[l],f^=f>>>7,h=f^f<<24,f=c[l+1&7],h^=f^f>>>10,f=c[l+3&7],h^=f^f>>>3,f=c[l+4&7],h^=f^f<<7,f=c[l+7&7],f=f^f<<13,h^=f^f<<9,c[l]=h,s.i=l+1&7,h};function u(c,l){var f,h,d=[];if(l===(l|0))h=d[0]=l;else for(l=""+l,f=0;f<l.length;++f)d[f&7]=d[f&7]<<15^l.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?h=d[7]=-1:h=d[f],c.x=d,c.i=0,f=256;f>0;--f)c.next()}u(s,o)}function a(o,s){return s.x=o.x.slice(),s.i=o.i,s}function i(o,s){o==null&&(o=+new Date);var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(c.x&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorshift7=i})(yL,typeof ax=="object"&&ax,typeof define=="function"&&define)});var xL=Y((wL,ix)=>{(function(n,e,t){function r(o){var s=this;s.next=function(){var c=s.w,l=s.X,f=s.i,h,d;return s.w=c=c+1640531527|0,d=l[f+34&127],h=l[f=f+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,d=l[f]=d^h,s.i=f,d+(c^c>>>16)|0};function u(c,l){var f,h,d,p,v,m=[],g=128;for(l===(l|0)?(h=l,l=null):(l=l+"\0",h=0,g=Math.max(g,l.length)),d=0,p=-32;p<g;++p)l&&(h^=l.charCodeAt((p+32)%l.length)),p===0&&(v=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(v=v+1640531527|0,f=m[p&127]^=h+v,d=f==0?d+1:0);for(d>=128&&(m[(l&&l.length||0)&127]=-1),d=127,p=4*128;p>0;--p)h=m[d+34&127],f=m[d=d+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,m[d]=h^f;c.w=v,c.X=m,c.i=d}u(s,o)}function a(o,s){return s.i=o.i,s.w=o.w,s.X=o.X.slice(),s}function i(o,s){o==null&&(o=+new Date);var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(c.X&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor4096=i})(wL,typeof ix=="object"&&ix,typeof define=="function"&&define)});var SL=Y((kL,ox)=>{(function(n,e,t){function r(o){var s=this,u="";s.next=function(){var l=s.b,f=s.c,h=s.d,d=s.a;return l=l<<25^l>>>7^f,f=f-h|0,h=h<<24^h>>>8^d,d=d-l|0,s.b=l=l<<20^l>>>12^f,s.c=f=f-h|0,s.d=h<<16^f>>>16^d,s.a=d-l|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,o===Math.floor(o)?(s.a=o/4294967296|0,s.b=o|0):u+=o;for(var c=0;c<u.length+20;c++)s.b^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.a=o.a,s.b=o.b,s.c=o.c,s.d=o.d,s}function i(o,s){var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.tychei=i})(kL,typeof ox=="object"&&ox,typeof define=="function"&&define)});var TL=Y((NL,Uv)=>{(function(n,e,t){var r=256,a=6,i=52,o="random",s=t.pow(r,a),u=t.pow(2,i),c=u*2,l=r-1,f;function h(b,w,x){var N=[];w=w==!0?{entropy:!0}:w||{};var T=m(v(w.entropy?[b,y(e)]:b??g(),3),N),E=new d(N),C=function(){for(var F=E.g(a),D=s,O=0;F<u;)F=(F+O)*r,D*=r,O=E.g(1);for(;F>=c;)F/=2,D/=2,O>>>=1;return(F+O)/D};return C.int32=function(){return E.g(4)|0},C.quick=function(){return E.g(4)/4294967296},C.double=C,m(y(E.S),e),(w.pass||x||function(F,D,O,L){return L&&(L.S&&p(L,E),F.state=function(){return p(E,{})}),O?(t[o]=F,D):F})(C,T,"global"in w?w.global:this==t,w.state)}function d(b){var w,x=b.length,N=this,T=0,E=N.i=N.j=0,C=N.S=[];for(x||(b=[x++]);T<r;)C[T]=T++;for(T=0;T<r;T++)C[T]=C[E=l&E+b[T%x]+(w=C[T])],C[E]=w;(N.g=function(F){for(var D,O=0,L=N.i,z=N.j,$=N.S;F--;)D=$[L=l&L+1],O=O*r+$[l&($[L]=$[z=l&z+D])+($[z]=D)];return N.i=L,N.j=z,O})(r)}function p(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function v(b,w){var x=[],N=typeof b,T;if(w&&N=="object")for(T in b)try{x.push(v(b[T],w-1))}catch{}return x.length?x:N=="string"?b:b+"\0"}function m(b,w){for(var x=b+"",N,T=0;T<x.length;)w[l&T]=l&(N^=w[l&T]*19)+x.charCodeAt(T++);return y(w)}function g(){try{var b;return f&&(b=f.randomBytes)?b=b(r):(b=new Uint8Array(r),(n.crypto||n.msCrypto).getRandomValues(b)),y(b)}catch{var w=n.navigator,x=w&&w.plugins;return[+new Date,n,x,n.screen,y(e)]}}function y(b){return String.fromCharCode.apply(0,b)}if(m(t.random(),e),typeof Uv=="object"&&Uv.exports){Uv.exports=h;try{f=Od()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+o]=h})(typeof self<"u"?self:NL,[],Math)});var IL=Y((eot,EL)=>{var aFe=dL(),iFe=vL(),oFe=gL(),sFe=bL(),uFe=xL(),cFe=SL(),uu=TL();uu.alea=aFe;uu.xor128=iFe;uu.xorwow=oFe;uu.xorshift7=sFe;uu.xor4096=uFe;uu.tychei=cFe;EL.exports=uu});var Uz=Y(ih=>{"use strict";Object.defineProperty(ih,"__esModule",{value:!0});var S=As(),lFe=IL();function fFe(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}var hFe=fFe(lFe),ux=function(n,e){return ux=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},ux(n,e)};function dFe(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ux(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function CL(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function AL(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Pc(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function We(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function ya(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}function Ge(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&S.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors in the CPU backend.")})})}var pFe=S.kernel_impls.whereImpl,fx=function(n){dFe(e,n);function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new S.DataStorage(t,S.engine()),t}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.write=function(t,r,a){this.firstUse&&(this.firstUse=!1,S.env().get("IS_NODE")&&S.backend_util.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));var i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:a,refCount:1}),i},e.prototype.makeTensorInfo=function(t,r,a){var i;if(r==="string"&&a!=null&&a.length>0&&S.util.isString(a[0])){var o=a.map(function(s){return S.util.encodeString(s)});i=this.write(o,t,r)}else i=this.write(a,t,r);return{dataId:i,shape:t,dtype:r}},e.prototype.refCount=function(t){if(this.data.has(t)){var r=this.data.get(t);return r.refCount}return 0},e.prototype.incRef=function(t){var r=this.data.get(t);r.refCount++},e.prototype.decRef=function(t){if(this.data.has(t)){var r=this.data.get(t);r.refCount--}},e.prototype.move=function(t,r,a,i,o){this.data.set(t,{values:r,dtype:i,refCount:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return CL(this,void 0,void 0,function(){return AL(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),a=r.dtype,i=r.complexTensorInfos;if(a==="complex64"){var o=this.readSync(i.real.dataId),s=this.readSync(i.imag.dataId);return S.backend_util.mergeRealAndImagArrays(o,s)}return S.util.convertBackendValuesAndArrayBuffer(this.data.get(t).values,a)},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId);if(t.dtype==="string")try{var a=r.map(function(i){return S.util.decodeString(i)});return S.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return S.buffer(t.shape,t.dtype,r)},e.prototype.makeOutput=function(t,r,a){return S.engine().makeTensorFromTensorInfo(this.makeTensorInfo(r,a,t),this)},e.prototype.disposeData=function(t,r){if(r===void 0&&(r=!1),this.data.has(t)){if(this.data.get(t).refCount--,!r&&this.data.get(t).refCount>0)return!1;var a=this.data.get(t).complexTensorInfos;a!=null&&(this.disposeData(a.real.dataId,!0),this.disposeData(a.imag.dataId,!0)),this.data.delete(t)}return!0},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.time=function(t){return CL(this,void 0,void 0,function(){var r,a;return AL(this,function(i){return r=S.util.now(),t(),a=S.util.now()-r,[2,{kernelMs:a}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.where=function(t){Ge([t],"where");var r=this.readSync(t.dataId);return pFe(t.shape,r)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return n.prototype.epsilon.call(this)},e}(S.KernelBackend);fx.nextDataId=0;function LL(n){for(var e=new Float32Array(n.length),t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}var vFe=function(n){var e=n.inputs.x,t=n.backend;Ge(e,"abs");var r=new Float32Array(S.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId).values;return r=LL(a),t.makeOutput(r,e.shape,e.dtype)},mFe={kernelName:S.Abs,backendName:"cpu",kernelFunc:vFe};function zn(n){return function(e,t,r,a,i){var o=S.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=S.util.computeStrides(o),c=S.util.sizeFromShape(o),l=S.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,d=S.util.computeStrides(e),p=S.util.computeStrides(t),v=S.backend_util.getBroadcastDims(e,o),m=S.backend_util.getBroadcastDims(t,o);if(v.length+m.length===0)for(var g=0;g<l.length;++g)l[g]=n(r[g%r.length],a[g%a.length]);else for(var y=function(b){var w=S.util.indexToLoc(b,s,u),x=w.slice(-f);v.forEach(function(C){return x[C]=0});var N=S.util.locToIndex(x,f,d),T=w.slice(-h);m.forEach(function(C){return T[C]=0});var E=S.util.locToIndex(T,h,p);l[b]=n(r[N],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function na(n){var e=n.inputs,t=n.backend,r=e.real,a=e.imag,i=t.data.get(r.dataId).values,o=t.data.get(a.dataId).values,s=t.makeTensorInfo(r.shape,"complex64"),u=t.data.get(s.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",i),imag:t.makeTensorInfo(a.shape,"float32",o)},s}var gFe={kernelName:S.Complex,backendName:"cpu",kernelFunc:na};function Hv(n,e,t){if(t===void 0&&(t="float32"),t==="complex64"){var r=Hv(n,e,"float32"),a=Hv(n,e,"float32");return na({inputs:{real:r,imag:a},backend:n})}var i=S.util.makeZerosTypedArray(S.util.sizeFromShape(e),t);return n.makeTensorInfo(e,t,i)}function Mi(n){var e=n.inputs,t=n.backend,r=e.x;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var yFe={kernelName:S.Identity,backendName:"cpu",kernelFunc:Mi};function cu(n){var e=n.inputs,t=n.backend,r=e.input,a=t.data.get(r.dataId).complexTensorInfos.real,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var bFe={kernelName:S.Real,backendName:"cpu",kernelFunc:cu};function zL(n,e,t,r){if(r==="int32"){var a=Int32Array.from(n);return[e,"int32",a]}if(r==="bool"){var i=S.util.toTypedArray([0],t),o=We(zn(function(c,l){return c!==l?1:0})(e,[],n,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(r))}function Zo(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dtype;if(i==="complex64"){if(a.dtype==="complex64")return Mi({inputs:{x:a},backend:t});var o=Hv(t,a.shape,a.dtype),s=Zo({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=na({inputs:{real:s,imag:o},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=cu({inputs:{input:a},backend:t}),u=Zo({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!S.util.hasEncodingLoss(a.dtype,i)){var u=Mi({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}var l=t.data.get(a.dataId).values,f=We(zL(l,a.shape,a.dtype,i),3),h=f[0],d=f[1],p=f[2];return t.makeTensorInfo(h,d,p)}var wFe={kernelName:S.Cast,backendName:"cpu",kernelFunc:Zo};function Zn(n,e,t,r){return t==null?function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;Ge([s,u],n);var l=c.data.get(s.dataId).values,f=c.data.get(u.dataId).values,h=s.dtype==="string"?S.backend_util.fromUint8ToStringArray(l):l,d=s.dtype==="string"?S.backend_util.fromUint8ToStringArray(f):f,p=r||s.dtype,v=We(e(s.shape,u.shape,h,d,p),2),m=v[0],g=v[1];return c.makeTensorInfo(g,p,m)}:function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;if(s.dtype==="complex64"||u.dtype==="complex64"){var l=Zo({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),f=c.data.get(l.dataId),h=f.complexTensorInfos.real,d=f.complexTensorInfos.imag,p=c.data.get(h.dataId).values,v=c.data.get(d.dataId).values,m=Zo({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(m.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,w=c.data.get(y.dataId).values,x=c.data.get(b.dataId).values,N=We(t(s.shape,u.shape,p,v,w,x),3),T=N[0],E=N[1],C=N[2],F=c.makeTensorInfo(C,"float32",T),D=c.makeTensorInfo(C,"float32",E),O=na({inputs:{real:F,imag:D},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(m),c.disposeIntermediateTensorInfo(F),c.disposeIntermediateTensorInfo(D),O}else{var L=c.data.get(s.dataId).values,z=c.data.get(u.dataId).values,$=r||s.dtype,B=We(e(s.shape,u.shape,L,z,$),2),W=B[0],C=B[1];return c.makeTensorInfo(C,$,W)}}}function hx(n){return function(e,t,r,a,i,o){var s=S.backend_util.assertAndGetBroadcastShape(e,t),u=S.util.sizeFromShape(s),c=s.length,l=S.util.computeStrides(s),f=S.util.getTypedArrayFromDType("float32",u),h=S.util.getTypedArrayFromDType("float32",u),d=S.backend_util.getBroadcastDims(e,s),p=S.backend_util.getBroadcastDims(t,s),v=S.backend_util.mergeRealAndImagArrays(r,a),m=S.backend_util.mergeRealAndImagArrays(i,o),g=e.length,y=S.util.computeStrides(e),b=t.length,w=S.util.computeStrides(t);if(d.length+p.length===0)for(var x=0;x<f.length;x++){var N=x%v.length,T=x%m.length,E=n(v[N*2],v[N*2+1],m[T*2],m[T*2+1]);f[x]=E.real,h[x]=E.imag}else for(var C=function(F){var D=S.util.indexToLoc(F,c,l),O=D.slice(-g);d.forEach(function(W){return O[W]=0});var L=S.util.locToIndex(O,g,y),z=D.slice(-b);p.forEach(function(W){return z[W]=0});var $=S.util.locToIndex(z,b,w),B=n(v[L*2],v[L*2+1],m[$*2],m[$*2+1]);f[F]=B.real,h[F]=B.imag},x=0;x<f.length;x++)C(x);return[f,h,s]}}var $L=zn(function(n,e){return n+e}),xFe=hx(function(n,e,t,r){return{real:n+t,imag:e+r}}),Mc=Zn(S.Add,$L,xFe),kFe={kernelName:S.Add,backendName:"cpu",kernelFunc:Mc};function dx(n,e,t,r,a){for(var i=S.util.sizeFromShape(r),o=S.util.makeZerosTypedArray(a,t),s=0;s<n.length;s++){var u=n[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function qL(n,e,t,r){r===void 0&&(r=!1);for(var a=n.shape[0],i=n.shape[1],o=S.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=n.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(r?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}function Jo(n){return function(e,t,r){for(var a=S.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=n(e[i],r);return a}}function Mt(n,e,t){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(Ge(s,n),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=S.util.sizeFromShape(s.shape),f=t||s.dtype,h=S.util.getArrayFromDType(f,l),d=0;d<l;++d)h[d]=e(c[d],i);return u.makeTensorInfo(s.shape,f,h)}}function zc(n,e,t){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(Ge(s,n),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=t||s.dtype,f=e(c,l,i);return u.makeTensorInfo(s.shape,l,f)}}var WL=Jo(function(n){return Math.ceil(n)}),SFe=zc(S.Ceil,WL),NFe={kernelName:S.Ceil,backendName:"cpu",kernelFunc:SFe};function VL(n,e,t,r){var a=S.util.getArrayFromDType(t,S.util.sizeFromShape(e));if(r&&t!=="string"){var i=0;n.forEach(function(s){var u=S.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;n.forEach(function(s){for(var u=t==="string"?S.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var GL=zn(function(n,e){return n===e?1:0}),UL=Zn(S.Equal,GL,null,"bool"),TFe={kernelName:S.Equal,backendName:"cpu",kernelFunc:UL};var HL=Jo(function(n){return Math.exp(n)}),KL=zc(S.Exp,HL,"float32"),EFe={kernelName:S.Exp,backendName:"cpu",kernelFunc:KL};var jL=Jo(function(n){return Math.expm1(n)}),IFe=zc(S.Expm1,jL),CFe={kernelName:S.Expm1,backendName:"cpu",kernelFunc:IFe};var XL=Jo(function(n){return Math.floor(n)}),AFe=zc(S.Floor,XL),_Fe={kernelName:S.Floor,backendName:"cpu",kernelFunc:AFe};function YL(n,e,t,r,a,i,o,s,u){for(var c=S.buffer([r,i],t),l=0;l<r;l++){for(var f=[],h=0,d=0;d<a;d++){var p=n[l*a+d];h+=p*o[d],f.push(p)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var v=0;v<i;v++)c.values[l*i+v]=e.get.apply(e,ya([],We(e.indexToLoc(h*i+v)),!1))}return c}function ZL(n,e,t){for(var r=S.buffer(t,n.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=n.locToIndex(o);0<=l&&l<n.values.length&&(r.values[a]=n.values[l])}return r}var JL=zn(function(n,e){return n>e?1:0}),DFe=Zn(S.Greater,JL,null,"bool"),FFe={kernelName:S.Greater,backendName:"cpu",kernelFunc:DFe};var QL=zn(function(n,e){return n>=e?1:0}),RFe=Zn(S.GreaterEqual,QL,null,"bool"),OFe={kernelName:S.GreaterEqual,backendName:"cpu",kernelFunc:RFe};var ez=zn(function(n,e){return n<e?1:0}),PFe=Zn(S.Less,ez,null,"bool"),MFe={kernelName:S.Less,backendName:"cpu",kernelFunc:PFe};var tz=zn(function(n,e){return n<=e?1:0}),BFe=Zn(S.LessEqual,tz,null,"bool"),LFe={kernelName:S.LessEqual,backendName:"cpu",kernelFunc:BFe};function nz(n,e,t){var r=(e-n)/(t-1),a=S.util.makeZerosTypedArray(t,"float32");a[0]=n;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var rz=Jo(function(n){return Math.log(n)}),zFe=zc(S.Log,rz),$Fe={kernelName:S.Log,backendName:"cpu",kernelFunc:zFe};function az(n,e,t,r){for(var a=S.util.getTypedArrayFromDType(r,S.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=n[o],u=0;u<e;++u){var c=n[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var iz=zn(function(n,e){return Math.max(n,e)}),qFe=Zn(S.Maximum,iz),WFe={kernelName:S.Maximum,backendName:"cpu",kernelFunc:qFe};var oz=zn(function(n,e){return Math.min(n,e)}),VFe=Zn(S.Minimum,oz),GFe={kernelName:S.Minimum,backendName:"cpu",kernelFunc:VFe};var px=zn(function(n,e){return n*e}),UFe=hx(function(n,e,t,r){return{real:n*t-e*r,imag:n*r+e*t}}),Yv=Zn(S.Multiply,px,UFe),HFe={kernelName:S.Multiply,backendName:"cpu",kernelFunc:Yv};function sz(n,e,t){var r=S.util.createScalarValue(-1,t);return px([],e,r,n,t)}function KFe(n){var e=n.inputs,t=n.backend,r=e.x;Ge(r,"neg");var a=t.data.get(r.dataId).values,i=We(sz(a,r.shape,r.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,r.dtype,o)}var jFe={kernelName:S.Neg,backendName:"cpu",kernelFunc:KFe};var uz=zn(function(n,e){return n!==e?1:0}),XFe=Zn(S.NotEqual,uz,null,"bool"),YFe={kernelName:S.NotEqual,backendName:"cpu",kernelFunc:XFe};function vx(n,e,t,r,a){for(var i=e.length,o=S.util.sizeFromShape(e),s=S.util.computeStrides(e),u=S.util.computeStrides(a),c=S.util.getTypedArrayFromDType(t,S.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=S.util.indexToLoc(l,i,s),h=new Array(f.length),d=0;d<h.length;d++)h[d]=f[r[d]];var p=S.util.locToIndex(h,i,u);c[p]=n[l]}return c}function Or(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=t.perm;Ge(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=r.data.get(a.dataId).values,l=vx(c,a.shape,a.dtype,i,s),f=r.write(l,s,a.dtype);return{dataId:f,shape:s,dtype:a.dtype}}var ZFe={kernelName:S.Transpose,backendName:"cpu",kernelFunc:Or};function cz(n,e,t,r){for(var a=We(S.backend_util.computeOutAndReduceShapes(n,r),2),i=a[0],o=a[1],s=S.upcastType(e,"int32"),u=S.util.makeZerosTypedArray(S.util.sizeFromShape(i),s),c=S.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,d=0;d<c;++d)h*=t[f+d];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function JFe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"prod");var s=a.shape.length,u=S.util.parseAxisParam(i,a.shape),c=S.backend_util.getAxesPermutation(u,s),l=u,f=a,h=[];c!=null&&(f=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),h.push(f),l=S.backend_util.getInnerMostAxes(l.length,s));var d=t.data.get(f.dataId).values,p=cz(f.shape,f.dtype,d,l),v=p.outVals,m=p.outShape,g=p.outDtype,y=m;return o&&(y=S.backend_util.expandShapeToKeepDim(m,u)),h.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),t.makeTensorInfo(y,g,v)}var QFe={kernelName:S.Prod,backendName:"cpu",kernelFunc:JFe};function eRe(n,e,t){n.forEach(function(r,a){if(r<0||r>=t){var i=S.util.indexToLoc(a,e.length,S.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(r," is not in [0, ").concat(t,")"))}})}function tRe(n,e){for(var t=0;t<n.length;++t){var r=n[t],a=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function nRe(n,e,t,r){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});tRe(t,r);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<n.length;++f){for(var h=n[f],d=n[f]+1,c=0;c<t.length;++c){var p=t[c],v=c+e.length-1;if(v>=0)for(var m=s[v],g=m[m.length-1]-p[h],y=h;y<d;++y)s[v].push(p[y+1]+g);h=p[h],d=p[d]}d!==h&&(a.push([h,d]),i+=d-h)}return{outSplits:s,valueSlices:a,numValues:i}}function rRe(n){for(var e=[],t=function(a){var i=n[a].length,o=S.util.getArrayFromDType("int32",i);e.push(o),n[a].forEach(function(s,u){return o[u]=s})},r=0;r<n.length;++r)t(r);return e}function _L(n,e){for(var t=n.slice(0,e);t.length<e;)t.push(1);for(var r=e;r<n.length;r++)t[e-1]*=n[r];return t}function aRe(n,e,t,r,a,i){var o,s,u=_L(e,2)[1],c=_L(i,2)[1],l=0;try{for(var f=Pc(t),h=f.next();!h.done;h=f.next())for(var d=h.value,p=d[0];p<d[1];++p){for(var v=0;v<r;++v)a[l*c+v]=n[p*u+v];++l}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function iRe(n,e,t,r,a){var i=e.slice();i[0]=a;var o=S.util.getArrayFromDType(t,S.util.sizeFromShape(i)),s=n.length,u=s===0?0:s/e[0];return aRe(n,e,r,u,o,i),[o,i]}function lz(n,e,t,r,a,i,o,s){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(eRe(i,o,u),r.length===0)throw new Error("params.rank must be nonzero");var c=r[0],l=nRe(i,o,n,c),f=l.outSplits,h=l.valueSlices,d=l.numValues,p=rRe(f),v=iRe(t,r,a,h,d);return[p,v[0],v[1]]}var DL=2147483647;function fz(n,e,t,r,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],d=S.util.getArrayFromDType("int32",h+1);d[0]=0;for(var p=0;p<h;++p){var v=s?n[0]:n[p],m=u?r[0]:r[p],g=c?i[0]:i[p];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&m<v||g<0&&m>v)y=0;else if(y=Math.ceil(Math.abs((m-v)/g)),y>DL)throw new Error("Requires ((limit - start) / delta) <= ".concat(DL));d[p+1]=d[p]+y}for(var b=d[h],w=S.util.getArrayFromDType(t,b),x=0,p=0;p<h;++p)for(var N=d[p+1]-d[p],T=s?n[0]:n[p],g=c?i[0]:i[p],f=0;f<N;++f)w[x++]=T,T+=g;return[d,w]}var Ha=S.backend_util.RowPartitionType,oRe=function(){function n(e,t,r,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=S.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=S.backend_util.getRaggedRank(this.rowPartitionTypes)}return n.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Ha.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},n.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Ha.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},n.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ha.VALUE_ROWIDS:return n.getMaxWidthValueRowID(t);case Ha.ROW_SPLITS:return n.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Ha[this.getRowPartitionTypeByDimension(e-1)]))}},n.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var r=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>r&&(r=i)}return r},n.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var r=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-r,i),r=o)}return Math.max(t-r,i)},n.prototype.tensorShapeFromTensor=function(e,t,r){if(r===void 0&&(r=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return RL(e,r)},n.prototype.calculateOutputSize=function(e){var t=this.valuesShape,r=this.defaultValueShape;S.backend_util.validateDefaultValueShape(r,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=S.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},n.prototype.calculateFirstParentOutputIndex=function(e,t,r){for(var a=Math.min(e,r),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return S.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},n.prototype.calculateOutputIndexRowSplit=function(e,t,r,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=r;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},n.prototype.calculateOutputIndexValueRowID=function(e,t,r,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=r:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},n.prototype.calculateOutputIndex=function(e,t,r,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ha.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,a);case Ha.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,r,a);default:throw new Error("Unsupported partition type: ".concat(Ha[o]))}},n.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Ha.FIRST_DIM_SIZE:return e[0];case Ha.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ha.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Ha[t]))}},n.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*r[i+1];var o=RL(r,!1),s=S.util.getArrayFromDType(this.valuesDType,S.util.sizeFromShape(o)),u=a[0]*r[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],r[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],r[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},n.prototype.setOutput=function(e,t,r,a){if(r.length!==0){var i=this.values,o=r,s=a.slice();s=s.slice(e+1);var u=S.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;S.tidy(function(){var x=S.reshape(l,f),N=S.broadcastTo(x,s);l=N.dataSync()})}for(var h=0,d=0,p=0,v=0;v<=c;++v){var m=v<c?t[v]:-1;if(m===p){++p;continue}if(d<p){var g=i.subarray(h*u),y=o.subarray(d*u),b=(p-d)*u;FL(y,g,b)}if(v>=c){var w=r.length;m=Math.floor(w/u)}if(m>p)if(this.defaultValue.length===1)o.subarray(p*u,m*u).fill(this.defaultValue[0]),p=m;else for(;m>p;){var y=o.slice(p*u);FL(y,l,u),++p}m<0?(h=v+1,d=p):(h=v,d=p,p=d+1)}}},n}();function FL(n,e,t){for(var r=0;r<t;r++)n[r]=e[r]}function RL(n,e){var t,r,a=[];try{for(var i=Pc(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a}function hz(n,e,t,r,a,i,o,s,u,c){return new oRe(n,e,t,r,a,i,o,s,u,c).compute()}function dz(n,e,t,r){var a=n===e,i=n<e&&t<0,o=e<n&&t>1;if(a||i||o)return S.util.makeZerosTypedArray(0,r);var s=Math.abs(Math.ceil((e-n)/t)),u=S.util.makeZerosTypedArray(s,r);e<n&&t===1&&(t=-1),u[0]=n;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var pz=Jo(function(n){return 1/Math.sqrt(n)}),sRe=zc(S.Rsqrt,pz),uRe={kernelName:S.Rsqrt,backendName:"cpu",kernelFunc:sRe};function Oc(n,e,t,r,a,i,o,s,u,c){var l=[r/a,a],f=n.values,h=e.values;if(r===0)return S.buffer(t,e.dtype);var d=S.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?d.values.fill(u):typeof u=="boolean"&&d.values.fill(+u);for(var p=0;p<i;p++){for(var v=[],m=0,g=0;g<o;g++){var y=f[p*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(t));for(var b=0;b<a;b++)c?d.values[m*a+b]+=h[p*a+b]:d.values[m*a+b]=e.rank===0?h[0]:h[p*a+b]}return d}var cRe=Jo(function(n){return 1/(1+Math.exp(-n))}),vz=Mt(S.Sigmoid,function(n){return 1/(1+Math.exp(-n))}),lRe={kernelName:S.Sigmoid,backendName:"cpu",kernelFunc:vz};function mz(n,e,t,r,a){var i=S.slice_util.isSliceContinous(r,e,t),o=S.util.sizeFromShape(t),s=S.util.computeStrides(r);if(i){var u=S.slice_util.computeFlatOffset(e,s);return a==="string"?n.slice(u,u+o):n.subarray(u,u+o)}for(var c=a==="string"?S.backend_util.fromUint8ToStringArray(n):n,l=S.buffer(r,a,c),f=S.buffer(t,a),h=0;h<f.size;++h){var d=f.indexToLoc(h),p=d.map(function(v,m){return v+e[m]});f.set.apply(f,ya([l.get.apply(l,ya([],We(p),!1))],We(d),!1))}return a==="string"?S.backend_util.fromStringArrayToUint8(f.values):f.values}function lu(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.size;Ge(a,"slice");var s=We(S.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];S.slice_util.assertParamsValid(a,u,c);var l=t.data.get(a.dataId).values,f=mz(l,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var fRe={kernelName:S.Slice,backendName:"cpu",kernelFunc:lu};function gz(n,e,t,r,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(S.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=S.util.getArrayFromDType(t,0),d=S.util.getArrayFromDType(a,0);return[h,[0,f],d,c,l]}for(var p=!0,v=0,m=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f];if(y<0)throw new Error(S.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(S.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++m[y],p=p&&y>=v,v=y}for(var b=!0,y=0;y<u;++y){var w=m[y]===0;c[y]=w,b=b&&!w,m[y]=Math.max(m[y],1),y>0&&(m[y]+=m[y-1])}if(b&&p){for(var h=n,d=r,g=0;g<s;++g)l[g]=g;return[h,[s,f],d,c,l]}else{for(var x=m[u-1],h=S.util.getArrayFromDType(t,x*f),d=S.util.getArrayFromDType(a,x),N=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f],T=N[y],E=(y===0?0:m[y-1])+T;N[y]++;for(var C=0;C<f;++C)h[E*f+C]=n[g*f+C];d[E]=r[g],l[g]=E}for(var y=0;y<u;++y){var F=N[y];if(F===0){var D=y===0?0:m[y-1];h[D*f+0]=y;for(var O=1;O<f;++O)h[D*f+O]=0;d[D]=o}}return[h,[x,f],d,c,l]}}function yz(n,e,t,r,a){for(var i=S.util.sizeFromShape(r),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(S.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(S.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(S.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var d=Math.trunc(i/c);if(c*d!==i)throw new Error(S.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=d}var p=S.util.sizeFromShape(u);if(p!==i)throw new Error(S.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var v=r.length,m=[];if(v>0){m[v-1]=1;for(var f=v-2;f>=0;--f)m[f]=m[f+1]*r[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=S.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,x=0;x<v;++x)w+=n[b*v+x]*m[x];for(var x=0;x<s;++x)y[b*s+x]=Math.trunc(w/g[x]),w%=g[x]}return[y,[o,s],u]}function mx(n,e,t,r,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=r.length,u=[e[0],n.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(S.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var d=h.reduce(function(T,E){return T*E},1),p=S.util.getArrayFromDType(t,d);if(s===0)return f>0&&p.fill(o),[p,h];if(f<=0)throw new Error(S.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,m=1,g=0,y=a[v];;){var b=0;if(m<s){if(b=a[m],y===b){++m;continue}if(y>=b)throw new Error(S.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(S.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&p.fill(o,g*c,y*c);for(var w=v;w<m;++w){var x=r[w];if(x<0||x>=u[0])throw new Error(S.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,r[w],u[0]));for(var N=0;N<c;N++)p[y*c+N]+=n[x*c+N]}if(i)for(var N=0;N<c;N++)p[y*c+N]/=m-v;if(v=m,++m,g=y+1,y=b,m>s)break}return g<f&&p.fill(o,g*c,f*c),[p,h]}var hRe=Jo(function(n){return Math.sqrt(n)}),dRe=Mt(S.Sqrt,function(n){return Math.sqrt(n)}),pRe={kernelName:S.Sqrt,backendName:"cpu",kernelFunc:dRe};var bz=zn(function(n,e){var t=n-e;return t*t}),vRe=Zn(S.SquaredDifference,bz),mRe={kernelName:S.SquaredDifference,backendName:"cpu",kernelFunc:vRe};function wz(n,e,t,r){for(var a=S.buffer(n,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+r[u];a.set.apply(a,ya([e.get.apply(e,ya([],We(s),!1))],We(o),!1))}return a}var gRe=function(){function n(e,t,r,a,i,o){this.separator=S.util.encodeString(e),this.nGramWidths=t,this.leftPad=S.util.encodeString(r),this.rightPad=S.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return n.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},n.prototype.getNumNGrams=function(e,t){var r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)},n.prototype.createNGrams=function(e,t,r,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),d=Math.max(0,f-(i-(l+1))),p=o-(h+d),v=t+(h>0?0:l-f),m=0;m+=h*u.leftPad.length;for(var g=0;g<p;++g)m+=e[v+g].length;m+=d*u.rightPad.length;var y=h+d+p-1;m+=y*u.separator.length,r[a+l]=new Uint8Array(m);for(var b=r[a+l],w=0,x=function(N){return N.forEach(function(T){return b[w++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<p-1;++g)x(e[v+g]),x(u.separator);if(p>0){x(e[v+p-1]);for(var g=0;g<d;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<d-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},n.prototype.compute=function(e,t){var r=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=S.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;d.nGramWidths.forEach(function(w){b+=r.getNumNGrams(y,w)}),d.preserveShort&&y>0&&b===0&&(b=1),l[g]=l[g-1]+b},d=this,s=1;s<=c;++s)h(s);for(var p=new Array(l[c]),v=function(g){var y=t[g],b=l[g];if(m.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=r.getNumNGrams(E,T);r.createNGrams(e,y,p,b,C,T),b+=C}),m.preserveShort&&b===l[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var x=w+2*m.padWidth,N=1;m.createNGrams(e,y,p,b,N,x)}},m=this,s=0;s<c;++s)v(s);return[p,l]},n}();function xz(n,e,t,r,a,i,o,s){return new gRe(t,r,a,i,o,s).compute(n,e)}function yRe(n,e,t,r){if(!!n.length){if(e.length===0){for(var a=0;a<n.length;++a)r.push(n.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=n.indexOf(i);o!==-1;){var s=n.subarray(0,o);(!t||s.length!==0)&&r.push(s),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}for(var u=0,a=0;a<n.length+1;a++)if(a===n.length||e.indexOf(n[a])!==-1){var s=n.subarray(u,a);(!t||s.length!==0)&&r.push(s),u=a+1}}}function kz(n,e,t){for(var r=n.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;yRe(n[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=S.util.getArrayFromDType("int32",i*2),h=new Array(i),d=[r,o],p=0,u=0;u<r;++u)for(var v=0;v<s[u];++v)f[p*2]=u,f[p*2+1]=v,h[p]=a[p],++p;return[f,h,d]}function Sz(n,e){for(var t=S.util.getArrayFromDType("int32",n.length),r=0;r<n.length;++r)t[r]=S.util.fingerPrint64(n[r]).modulo(e).getLowBitsUnsigned();return t}var Nz=zn(function(n,e){return n-e}),bRe=hx(function(n,e,t,r){return{real:n-t,imag:e-r}}),gx=Zn(S.Sub,Nz,bRe),wRe={kernelName:S.Sub,backendName:"cpu",kernelFunc:gx};function Tz(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];for(var a=S.buffer(t,n.dtype),r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),o=new Array(n.rank),s=0;s<o.length;s++)o[s]=i[s]%n.shape[s];var u=n.locToIndex(o);a.values[r]=n.values[u]}return a}var nh=function(n,e){var t=e.value-n.value;return t===0?n.index-e.index:t};function Ez(n,e,t,r){for(t===void 0&&(t=0),r===void 0&&(r=n.length-1);r>t;){if(r-t>600){var a=r-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(r,Math.floor(e+(a-i)*s/a+u));Ez(n,e,c,l)}var f=n[e],h=t,d=r;for(S.util.swap(n,t,e),nh(n[r],f)>0&&S.util.swap(n,t,r);h<d;){for(S.util.swap(n,h,d),h++,d--;nh(n[h],f)<0;)h=h+1;for(;nh(n[d],f)>0;)d=d-1}nh(n[t],f)===0?S.util.swap(n,t,d):(d=d+1,S.util.swap(n,d,r)),d<=e&&(t=d+1),e<=d&&(r=d-1)}}function Iz(n,e,t,r,a){for(var i=e[e.length-1],o=We([n.length/i,i],2),s=o[0],u=o[1],c=S.util.getTypedArrayFromDType(t,s*r),l=S.util.getTypedArrayFromDType("int32",s*r),f=function(p){var v=p*u,m=n.subarray(v,v+u),g=new Array(m.length);m.forEach(function(N,T){return g[T]={value:N,index:T}}),r<g.length&&(Ez(g,r),g=g.slice(0,r)),a&&g.sort(nh);for(var y=p*r,b=c.subarray(y,y+r),w=l.subarray(y,y+r),x=0;x<r;x++)b[x]=g[x].value,w[x]=g[x].index},h=0;h<s;h++)f(h);var d=e.slice();return d[d.length-1]=r,[S.buffer(d,t,c),S.buffer(d,"int32",l)]}function Cz(n,e,t,r){for(var a=S.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),c=new S.TensorBuffer(i,r,n),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=n[o].toString();else{for(var d=[],p=0;p<i[0];p++)for(var v=0;v<i[2];v++)d.push(c.get(p,o,v));h=d.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var m=Object.keys(s).length;s[h]=m,u[o]=m,l.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new S.TensorBuffer(g,r);l.forEach(function(w,x){for(var N=0;N<i[0];N++)for(var T=0;T<i[2];T++)y.set(c.get(N,w,T),N,x,T)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var xRe={__proto__:null,simpleAbsImpl:LL,addImpl:$L,bincountImpl:dx,bincountReduceImpl:qL,castImpl:zL,ceilImpl:WL,concatImpl:VL,equalImpl:GL,expImpl:HL,expm1Impl:jL,floorImpl:XL,gatherNdImpl:YL,gatherV2Impl:ZL,greaterImpl:JL,greaterEqualImpl:QL,lessImpl:ez,lessEqualImpl:tz,linSpaceImpl:nz,logImpl:rz,maxImpl:az,maximumImpl:iz,minimumImpl:oz,multiplyImpl:px,negImpl:sz,notEqualImpl:uz,prodImpl:cz,raggedGatherImpl:lz,raggedRangeImpl:fz,raggedTensorToTensorImpl:hz,rangeImpl:dz,rsqrtImpl:pz,scatterImpl:Oc,sigmoidImpl:cRe,sliceImpl:mz,sparseFillEmptyRowsImpl:gz,sparseReshapeImpl:yz,sparseSegmentReductionImpl:mx,sqrtImpl:hRe,squaredDifferenceImpl:bz,stridedSliceImpl:wz,stringNGramsImpl:xz,stringSplitImpl:kz,stringToHashBucketFastImpl:Sz,subImpl:Nz,tileImpl:Tz,topKImpl:Iz,transposeImpl:vx,uniqueImpl:Cz};var kRe="4.2.0";S.registerBackend("cpu",function(){return new fx},1);var Az=Mt(S.Elu,function(n){return n>=0?n:Math.exp(n)-1}),SRe={kernelName:S.Elu,backendName:"cpu",kernelFunc:Az};function _z(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.alpha;Ge([a],"leakyRelu");for(var o=S.util.sizeFromShape(a.shape),s=t.data.get(a.dataId).values,u=S.util.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return t.makeTensorInfo(a.shape,"float32",u)}var NRe={kernelName:S.LeakyRelu,backendName:"cpu",kernelFunc:_z},TRe=zn(function(n,e){return n<0?e*n:n});function Dz(n){var e=n.inputs,t=n.backend,r=e.x,a=e.alpha;Ge([r,a],"prelu");var i=t.data.get(r.dataId).values,o=t.data.get(a.dataId).values,s=We(TRe(r.shape,a.shape,i,o,"float32"),2),u=s[0],c=s[1];return t.makeTensorInfo(c,"float32",u)}var ERe={kernelName:S.Prelu,backendName:"cpu",kernelFunc:Dz};var Fz=Mt(S.Relu,function(n){return Math.max(0,n)}),IRe={kernelName:S.Relu,backendName:"cpu",kernelFunc:Fz};var Rz=Mt(S.Relu6,function(n){return Math.min(Math.max(0,n),6)}),CRe={kernelName:S.Relu6,backendName:"cpu",kernelFunc:Rz};function Kv(n,e,t,r,a){if(t==="linear")return Mi({inputs:{x:e},backend:n});if(t==="relu")return Fz({inputs:{x:e},backend:n});if(t==="elu")return Az({inputs:{x:e},backend:n});if(t==="relu6")return Rz({inputs:{x:e},backend:n});if(t==="prelu")return Dz({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return _z({inputs:{x:e},backend:n,attrs:{alpha:a}});if(t==="sigmoid")return vz({inputs:{x:e},backend:n});throw new Error("Activation ".concat(t," has not been implemented for the CPU backend."))}function qt(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.shape,o=S.util.sizeFromShape(a.shape),s=S.util.inferFromImplicitShape(i,o),u=S.util.sizeFromShape(s);S.util.assert(o===u,function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."}),t.incRef(a.dataId);var c=t.data.get(a.dataId);if(c.complexTensorInfos!=null){var l=c.complexTensorInfos.real,f=c.complexTensorInfos.imag;l.shape=s,f.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var ARe={kernelName:S.Reshape,backendName:"cpu",kernelFunc:qt};function Oz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.a,i=e.b,o=r.transposeA,s=r.transposeB;Ge([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],d=s?i.shape[c-2]:i.shape[c-1],p=a.shape.slice(0,-2),v=i.shape.slice(0,-2),m=S.util.sizeFromShape(p),g=S.util.sizeFromShape(v),y=S.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),b=y.concat([h,d]);S.util.assert(l===f,function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")});for(var w=o?[m,l,h]:[m,h,l],x=s?[g,d,f]:[g,f,d],N=qt({inputs:{x:a},backend:t,attrs:{shape:w}}),T=qt({inputs:{x:i},backend:t,attrs:{shape:x}}),E=o?N.shape[1]:N.shape[2],C=o?N.shape[2]:N.shape[1],F=s?T.shape[1]:T.shape[2],D=Math.max(m,g),O=t.data.get(N.dataId).values,L=t.data.get(T.dataId).values,z=S.util.computeStrides(N.shape),$=S.util.computeStrides(T.shape),B=We(o?[z[0],1,z[1]]:[z[0],z[1],1],3),W=B[0],X=B[1],Z=B[2],V=We(s?[1,$[1],$[0]]:[$[1],1,$[0]],3),j=V[0],re=V[1],ne=V[2],oe=C*F,le=S.buffer([D,C,F],N.dtype),pe=le.values,xe=t.blockSize,he=0;he<D;he++)for(var ye=he%m,we=he%g,Ae=0;Ae<C;Ae+=xe)for(var Ye=Math.min(Ae+xe,C),ht=0;ht<F;ht+=xe)for(var at=Math.min(ht+xe,F),rt=0;rt<E;rt+=xe)for(var ft=Math.min(rt+xe,E),st=Ae;st<Ye;st++)for(var Ze=ht;Ze<at;Ze++){for(var tt=0,et=rt;et<ft;et++){var rn=O[ye*W+st*X+et*Z],He=L[et*j+Ze*re+we*ne];tt+=rn*He}pe[he*oe+(st*F+Ze)]+=tt}return t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(b,le.dtype,le.values)}var _Re={kernelName:S.BatchMatMul,backendName:"cpu",kernelFunc:Oz};function DRe(n){var e,t,r=n.inputs,a=n.backend,i=n.attrs,o=r.a,s=r.b,u=r.bias,c=r.preluActivationWeights,l=i.transposeA,f=i.transposeB,h=i.activation,d=i.leakyreluAlpha,p,v,m,g=[],y=Oz({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:f},backend:a});p=y,u&&(v=Mc({inputs:{a:p,b:u},backend:a}),g.push(p),p=v),h&&(m=Kv(a,p,h,c,d),g.push(p),p=m);try{for(var b=Pc(g),w=b.next();!w.done;w=b.next()){var x=w.value;a.disposeIntermediateTensorInfo(x)}}catch(N){e={error:N}}finally{try{w&&!w.done&&(t=b.return)&&t.call(b)}finally{if(e)throw e.error}}return p}var FRe={kernelName:S._FusedMatMul,backendName:"cpu",kernelFunc:DRe};var RRe=Mt(S.Acos,function(n){return Math.acos(n)}),ORe={kernelName:S.Acos,backendName:"cpu",kernelFunc:RRe};var PRe=Mt(S.Acosh,function(n){return Math.acosh(n)}),MRe={kernelName:S.Acosh,backendName:"cpu",kernelFunc:PRe};function BRe(n){var e=n.inputs,t=n.backend,r=e;Ge(e,"addN");for(var a=r.map(function(l){return t.data.get(l.dataId).values}),i=S.buffer(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return t.makeTensorInfo(i.shape,i.dtype,i.values)}var LRe={kernelName:S.AddN,backendName:"cpu",kernelFunc:BRe};function zRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"all");var s=S.util.parseAxisParam(i,a.shape),u=s,c=S.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),u=S.backend_util.getInnerMostAxes(u.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var f=We(S.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],d=f[1],p=S.util.sizeFromShape(d),v=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),l.dtype),m=t.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*p,b=m[y],w=0;w<p;++w){var x=m[y+w];b=b&&x}v[g]=b}c!=null&&t.disposeIntermediateTensorInfo(l);var N=t.makeTensorInfo(h,l.dtype,v);if(o){var T=S.backend_util.expandShapeToKeepDim(h,s),E=qt({inputs:{x:N},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(N),E}return N}var $Re={kernelName:S.All,backendName:"cpu",kernelFunc:zRe};function qRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"any");var s=S.util.parseAxisParam(i,a.shape),u=s,c=S.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),u=S.backend_util.getInnerMostAxes(u.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var f=We(S.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],d=f[1],p=S.util.sizeFromShape(d),v=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),l.dtype),m=t.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*p,b=m[y],w=0;w<p;++w){var x=m[y+w];b=b||x}v[g]=b}c!=null&&t.disposeIntermediateTensorInfo(l);var N=t.makeTensorInfo(h,l.dtype,v);if(o){var T=S.backend_util.expandShapeToKeepDim(h,s),E=qt({inputs:{x:N},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(N),E}return N}var WRe={kernelName:S.Any,backendName:"cpu",kernelFunc:qRe};function VRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis;Ge(a,"argMax");var o=S.util.parseAxisParam(i,a.shape),s=S.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Or({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=S.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],S.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=We(S.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],d=S.util.sizeFromShape(f),p=S.util.makeZerosTypedArray(d,"int32"),v=S.util.sizeFromShape(h),m=t.data.get(u.dataId).values,g=0;g<p.length;++g){for(var y=g*v,b=m[y],w=0,x=0;x<v;++x){var N=m[y+x];N>b&&(b=N,w=x)}p[g]=w}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",p)}var GRe={kernelName:S.ArgMax,backendName:"cpu",kernelFunc:VRe};function URe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis;Ge(a,"argMin");var o=S.util.parseAxisParam(i,a.shape),s=S.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Or({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=S.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],S.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=We(S.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],d=S.util.sizeFromShape(f),p=S.util.makeZerosTypedArray(d,"int32"),v=S.util.sizeFromShape(h),m=t.data.get(u.dataId).values,g=0;g<p.length;++g){for(var y=g*v,b=m[y],w=0,x=0;x<v;++x){var N=m[y+x];N<b&&(b=N,w=x)}p[g]=w}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",p)}var HRe={kernelName:S.ArgMin,backendName:"cpu",kernelFunc:URe};var KRe=Mt(S.Asin,function(n){return Math.asin(n)}),jRe={kernelName:S.Asin,backendName:"cpu",kernelFunc:KRe};var XRe=Mt(S.Asinh,function(n){return Math.asinh(n)}),YRe={kernelName:S.Asinh,backendName:"cpu",kernelFunc:XRe};var ZRe=Mt(S.Atan,function(n){return Math.atan(n)}),JRe={kernelName:S.Atan,backendName:"cpu",kernelFunc:ZRe};var QRe=zn(function(n,e){return Math.atan2(n,e)}),eOe=Zn(S.Atan2,QRe),tOe={kernelName:S.Atan2,backendName:"cpu",kernelFunc:eOe};var nOe=Mt(S.Atanh,function(n){return Math.atanh(n)}),rOe={kernelName:S.Atanh,backendName:"cpu",kernelFunc:nOe};function yx(n,e,t,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=a.padInfo.top,d=a.padInfo.left,p=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=S.buffer(a.outShape,t),m=v.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],w=0;w<a.batchSize;++w)for(var x=w*g,N=w*r[0],T=0;T<a.inChannels;++T)for(var E=0;E<a.outHeight;++E)for(var C=E*o-h,F=Math.max(0,C),D=Math.min(a.inHeight,l+C),O=x+E*y,L=0;L<a.outWidth;++L){for(var z=L*s-d,$=Math.max(0,z),B=Math.min(a.inWidth,f+z),W=p,X=0,Z=0,V=F;V<D;V+=u){for(var j=N+V*r[1],re=$;re<B;re+=c){var ne=j+re*r[2],oe=n[ne+T];i==="max"&&oe>W?W=oe:i==="avg"&&(X+=oe,Z++)}if(isNaN(W))break}var le=O+L*b+T;m[le]=i==="avg"?X/Z:W}return v}function Pz(n,e,t,r,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=S.buffer(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,v=S.buffer(e,t,n),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,w=b;w<0;)w+=c;for(var x=Math.min(r.inHeight,f+b),N=0;N<r.outWidth;++N){for(var T=N*u-p,E=T;E<0;)E+=l;for(var C=Math.min(r.inWidth,h+T),F=Number.NEGATIVE_INFINITY,D=-1,O=w;O<x;O+=c)for(var L=O-b,z=E;z<C;z+=l){var $=z-T,B=v.get(m,O,z,g);B>F&&(F=B,a?D=i?((m*r.inHeight+O)*r.inWidth+z)*r.inChannels+g:(O*r.inWidth+z)*r.inChannels+g:D=L*h+$)}o.set(D,m,y,N,g)}}return o}function Mz(n,e,t,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,d=a.effectiveFilterHeight,p=a.effectiveFilterWidth,v=a.padInfo.front,m=a.padInfo.top,g=a.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=S.buffer(a.outShape,t),w=b.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],N=a.outShape[2]*a.outShape[3]*a.outShape[4],T=a.outShape[3]*a.outShape[4],E=a.outShape[4],C=0;C<a.batchSize;++C)for(var F=C*x,D=C*r[0],O=0;O<a.inChannels;++O)for(var L=0;L<a.outDepth;++L){for(var z=L*o-v,$=z;$<0;)$+=c;for(var B=Math.min(a.inDepth,h+z),W=F+L*N,X=0;X<a.outHeight;++X){for(var Z=X*s-m,V=Z;V<0;)V+=l;for(var j=Math.min(a.inHeight,d+Z),re=W+X*T,ne=0;ne<a.outWidth;++ne){for(var oe=ne*u-g,le=oe;le<0;)le+=f;for(var pe=Math.min(a.inWidth,p+oe),xe=re+ne*E,he=y,ye=0,we=0,Ae=$;Ae<B;Ae+=c){for(var Ye=D+Ae*r[1],ht=V;ht<j;ht+=l){for(var at=Ye+ht*r[2],rt=le;rt<pe;rt+=f){var ft=at+rt*r[3],st=n[ft+O];if(i==="max"&&st>he?he=st:i==="avg"&&(ye+=st,we++),isNaN(he))break}if(isNaN(he))break}if(isNaN(he))break}var Ze=xe+O;w[Ze]=i==="avg"?ye/Math.max(we,1):he}}}return b}function aOe(n,e){for(var t=S.buffer(e.outShape,"int32"),r=e.strideDepth,a=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left,v=0;v<e.batchSize;++v)for(var m=0;m<e.inChannels;++m)for(var g=0;g<e.outDepth;++g){for(var y=g*r-h,b=y;b<0;)b+=o;for(var w=Math.min(e.inDepth,c+y),x=0;x<e.outHeight;++x){for(var N=x*a-d,T=N;T<0;)T+=s;for(var E=Math.min(e.inHeight,l+N),C=0;C<e.outWidth;++C){for(var F=C*i-p,D=F;D<0;)D+=u;for(var O=Math.min(e.inWidth,f+F),L=Number.NEGATIVE_INFINITY,z=-1,$=b;$<w;$+=o)for(var B=$-y,W=T;W<E;W+=s)for(var X=W-N,Z=D;Z<O;Z+=u){var V=Z-F,j=n.get(v,$,W,Z,m);j>=L&&(L=j,z=B*l*f+X*l+V)}t.set(z,v,g,x,C,m)}}}return t}function iOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Ge(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=S.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&S.util.arraysEqual(l.inShape,l.outShape))f=Mi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,d=S.util.computeStrides(a.shape),p=yx(h,a.shape,a.dtype,d,l,"avg");f=t.makeTensorInfo(l.outShape,a.dtype,p.values)}return f}var oOe={kernelName:S.AvgPool,backendName:"cpu",kernelFunc:iOe};function sOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;Ge(a,"avgPool3d");var l=S.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Mz(f,a.shape,a.dtype,S.util.computeStrides(a.shape),l,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}var uOe={kernelName:S.AvgPool3D,backendName:"cpu",kernelFunc:sOe};function cOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;Ge([a,i],"avgPool3DGrad");for(var l=S.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=l.strideDepth,h=l.strideHeight,d=l.strideWidth,p=l.filterDepth,v=l.filterHeight,m=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,w=l.effectiveFilterDepth,x=l.effectiveFilterHeight,N=l.effectiveFilterWidth,T=w-1-l.padInfo.front,E=N-1-l.padInfo.left,C=x-1-l.padInfo.top,F=S.buffer(i.shape,"float32"),D=1/(p*v*m),O=t.bufferSync(a),L=0;L<l.batchSize;++L)for(var z=0;z<l.inChannels;++z)for(var $=0;$<l.inDepth;++$)for(var B=0;B<l.inHeight;++B)for(var W=0;W<l.inWidth;++W){for(var X=$-T,Z=B-C,V=W-E,j=0,re=0;re<w;re+=g){var ne=(X+re)/f;if(!(ne<0||ne>=l.outDepth||Math.floor(ne)!==ne))for(var oe=0;oe<x;oe+=y){var le=(Z+oe)/h;if(!(le<0||le>=l.outHeight||Math.floor(le)!==le))for(var pe=0;pe<N;pe+=b){var xe=(V+pe)/d;if(!(xe<0||xe>=l.outWidth||Math.floor(xe)!==xe)){var he=O.get(L,ne,le,xe,z);j+=he}}}}F.set(j*D,L,$,B,W,z)}return t.makeTensorInfo(F.shape,F.dtype,F.values)}var lOe={kernelName:S.AvgPool3DGrad,backendName:"cpu",kernelFunc:cOe};function fOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i;Ge([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=S.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=l.strideHeight,h=l.strideWidth,d=l.filterHeight,p=l.filterWidth,v=l.dilationHeight,m=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,w=g-1-l.padInfo.top,x=S.buffer(o.shape,"float32"),N=1/(d*p),T=t.data.get(a.dataId).values,E=S.buffer(a.shape,"float32",T),C=0;C<l.batchSize;++C)for(var F=0;F<l.inChannels;++F)for(var D=0;D<l.inHeight;++D)for(var O=0;O<l.inWidth;++O){for(var L=D-w,z=O-b,$=0,B=0;B<g;B+=v){var W=(L+B)/f;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var X=0;X<y;X+=m){var Z=(z+X)/h;if(!(Z<0||Z>=l.outWidth||Math.floor(Z)!==Z)){var V=E.get(C,W,Z,F);$+=V}}}x.set($*N,C,D,O,F)}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var hOe={kernelName:S.AvgPoolGrad,backendName:"cpu",kernelFunc:fOe};function dOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.scale,o=e.offset,s=e.mean,u=e.variance;S.util.assert(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),S.util.assert(o==null||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),S.util.assert(i==null||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),Ge([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;c==null&&(c=.001);for(var l=t.data.get(a.dataId).values,f=t.data.get(s.dataId).values,h=t.data.get(u.dataId).values,d=i?t.data.get(i.dataId).values:new Float32Array([1]),p=o?t.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(l.length),m=p.length,g=d.length,y=h.length,b=f.length,w=0,x=0,N=0,T=0,E=0;E<l.length;++E)v[E]=p[w++]+(l[E]-f[x++])*d[N++]/Math.sqrt(h[T++]+c),w>=m&&(w=0),x>=b&&(x=0),N>=g&&(N=0),T>=y&&(T=0);return t.makeTensorInfo(a.shape,a.dtype,v)}var pOe={kernelName:S.FusedBatchNorm,backendName:"cpu",kernelFunc:dOe};function vOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.crops;Ge([a],"batchToSpaceND");var s=i.reduce(function(g,y){return g*y}),u=S.backend_util.getReshaped(a.shape,i,s),c=S.backend_util.getPermuted(u.length,i.length),l=S.backend_util.getReshapedPermuted(a.shape,i,s),f=S.backend_util.getSliceBeginCoords(o,i.length),h=S.backend_util.getSliceSize(l,o,i.length),d=qt({inputs:{x:a},backend:t,attrs:{shape:u}}),p=Or({inputs:{x:d},backend:t,attrs:{perm:c}}),v=qt({inputs:{x:p},backend:t,attrs:{shape:l}}),m=lu({inputs:{x:v},backend:t,attrs:{begin:f,size:h}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),m}var mOe={kernelName:S.BatchToSpaceND,backendName:"cpu",kernelFunc:vOe};function gOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=dx(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var yOe={kernelName:S.Bincount,backendName:"cpu",kernelFunc:gOe};function bOe(n){var e=n.inputs,t=n.backend,r=e.s0,a=e.s1,i=t.data.get(r.dataId).values,o=t.data.get(a.dataId).values,s=S.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var wOe={kernelName:S.BroadcastArgs,backendName:"cpu",kernelFunc:bOe};var xOe=Mt(S.ClipByValue,function(n,e){var t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),kOe={kernelName:S.ClipByValue,backendName:"cpu",kernelFunc:xOe};var SOe=function(n){for(var e=n.inputs.x,t=n.backend,r=new Float32Array(S.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],f=u[c];r[c]=Math.hypot(l,f)}return t.makeOutput(r,e.shape,"float32")},NOe={kernelName:S.ComplexAbs,backendName:"cpu",kernelFunc:SOe};function Bc(n){var e=n.inputs,t=n.backend,r=e.input,a=t.data.get(r.dataId).complexTensorInfos.imag,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var TOe={kernelName:S.Imag,backendName:"cpu",kernelFunc:Bc};function Lc(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis,i=S.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(w){return w.shape});S.backend_util.assertParamsConsistent(o,i);var s=S.backend_util.computeOutShape(e.map(function(w){return w.shape}),i);if(S.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(w){return S.util.sizeFromShape(w.shape)>0});if(u.length===1)return Mi({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){var c=u.map(function(w){return cu({inputs:{input:w},backend:t})}),l=u.map(function(w){return Bc({inputs:{input:w},backend:t})}),f=Lc({inputs:c,backend:t,attrs:{axis:i}}),h=Lc({inputs:l,backend:t,attrs:{axis:i}}),d=na({inputs:{real:f,imag:h},backend:t});return c.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),l.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),d}var p=u.map(function(w){var x=S.util.sizeFromShape(w.shape.slice(i)),N=[-1,x];return qt({inputs:{x:w},backend:t,attrs:{shape:N}})}),v=p.map(function(w){return{vals:t.data.get(w.dataId).values,shape:w.shape}});s=S.backend_util.computeOutShape(p.map(function(w){return w.shape}),1);var m=p[0].shape[0]===1,g=VL(v,s,e[0].dtype,m),y=S.backend_util.computeOutShape(u.map(function(w){return w.shape}),i),b=t.makeTensorInfo(y,e[0].dtype,g);return p.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),b}var EOe={kernelName:S.Concat,backendName:"cpu",kernelFunc:Lc};function Bz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;Ge([a,i],"conv2d");for(var f=S.backend_util.convertConv2DDataFormat(u),h=S.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),d=h.filterHeight,p=h.filterWidth,v=h.dilationHeight,m=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,b=h.dataFormat==="channelsLast",w=new S.TensorBuffer(h.outShape,a.dtype),x=S.util.computeStrides(a.shape),N=S.util.computeStrides(i.shape),T=x[0],E=b?x[1]:x[2],C=b?x[2]:1,F=b?1:x[1],D=w.strides[0],O=b?w.strides[1]:w.strides[2],L=b?w.strides[2]:1,z=b?1:w.strides[1],$=t.data.get(a.dataId).values,B=t.data.get(i.dataId).values,W=w.values,X=0;X<h.batchSize;++X)for(var Z=X*T,V=X*D,j=0;j<h.outHeight;++j)for(var re=V+j*O,ne=j*h.strideHeight-y,oe=0;oe<d;++oe){var le=ne+oe*v;if(!(le<0||le>=h.inHeight))for(var pe=oe*N[0],xe=Z+le*E,he=0;he<h.outWidth;++he)for(var ye=re+he*L,we=he*h.strideWidth-g,Ae=0;Ae<p;++Ae){var Ye=we+Ae*m;if(!(Ye<0||Ye>=h.inWidth))for(var ht=pe+Ae*N[1],at=xe+Ye*C,rt=ht,ft=0;ft<h.inChannels;++ft){for(var st=$[at+ft*F],Ze=0;Ze<h.outChannels;++Ze)W[ye+Ze*z]+=st*B[rt+Ze];rt+=h.outChannels}}}return t.makeTensorInfo(w.shape,w.dtype,W)}var IOe={kernelName:S.Conv2D,backendName:"cpu",kernelFunc:Bz};function COe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;Ge([a,i],"conv2dBackpropFilter");for(var f=S.backend_util.convertConv2DDataFormat(u),h=S.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),d=h.strideHeight,p=h.strideWidth,v=h.filterHeight,m=h.filterWidth,g=h.dataFormat==="channelsLast",y=new S.TensorBuffer(h.filterShape,"float32"),b=h.padInfo.left,w=h.padInfo.top,x=t.data.get(a.dataId).values,N=t.data.get(i.dataId).values,T=new S.TensorBuffer(a.shape,a.dtype,x),E=new S.TensorBuffer(i.shape,i.dtype,N),C=0;C<v;++C)for(var F=Math.max(0,Math.ceil((w-C)/d)),D=Math.min(h.outHeight,(h.inHeight+w-C)/d),O=0;O<m;++O)for(var L=Math.max(0,Math.ceil((b-O)/p)),z=Math.min(h.outWidth,(h.inWidth+b-O)/p),$=0;$<h.inChannels;++$)for(var B=0;B<h.outChannels;++B){for(var W=0,X=0;X<h.batchSize;++X)for(var Z=F;Z<D;++Z)for(var V=C+Z*d-w,j=L;j<z;++j){var re=O+j*p-b;g?W+=T.get(X,V,re,$)*E.get(X,Z,j,B):W+=T.get(X,$,V,re)*E.get(X,B,Z,j)}y.set(W,C,O,$,B)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var AOe={kernelName:S.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:COe};function _Oe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;Ge([a,i],"conv2dBackpropInput");var f=S.util.computeStrides(i.shape),h=S.util.computeStrides(a.shape),d=S.backend_util.convertConv2DDataFormat(c),p=S.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,d),v=new S.TensorBuffer(p.inShape,"float32"),m=v.values,g=t.data.get(a.dataId).values,y=t.data.get(i.dataId).values,b=We(f,3),w=b[0],x=b[1],N=b[2],T=p.batchSize,E=p.filterHeight,C=p.filterWidth,F=p.inChannels,D=p.inHeight,O=p.inWidth,L=p.outChannels,z=p.outHeight,$=p.outWidth,B=p.strideHeight,W=p.strideWidth;d=p.dataFormat;for(var X=E-1-p.padInfo.top,Z=C-1-p.padInfo.left,V=d==="channelsLast",j=v.strides[0],re=V?v.strides[1]:v.strides[2],ne=V?v.strides[2]:1,oe=V?1:v.strides[1],le=h[0],pe=V?h[1]:h[2],xe=V?h[2]:1,he=V?1:h[1],ye=0;ye<T;++ye)for(var we=0;we<F;++we)for(var Ae=0;Ae<D;++Ae)for(var Ye=Ae-X,ht=Math.max(0,Math.ceil(Ye/B)),at=Math.min(z,(E+Ye)/B),rt=0;rt<O;++rt){for(var ft=rt-Z,st=Math.max(0,Math.ceil(ft/W)),Ze=Math.min($,(C+ft)/W),tt=0,et=ht;et<at;++et)for(var rn=et*B-Ye,He=st;He<Ze;++He)for(var kt=He*W-ft,An=le*ye+pe*et+xe*He,hr=w*(E-1-rn)+x*(C-1-kt)+N*we,On=0;On<L;++On){var _n=g[An+he*On],an=y[hr+On];tt+=_n*an}var Pr=j*ye+re*Ae+ne*rt+oe*we;m[Pr]=tt}return t.makeTensorInfo(v.shape,v.dtype,v.values)}var DOe={kernelName:S.Conv2DBackpropInput,backendName:"cpu",kernelFunc:_Oe};function FOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations;Ge([a,i],"conv3d");for(var c=S.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,f=c.filterHeight,h=c.filterWidth,d=c.dilationDepth,p=c.dilationHeight,v=c.dilationWidth,m=c.padInfo,g=m.front,y=m.left,b=m.top,w=new S.TensorBuffer(c.outShape,a.dtype),x=t.data.get(a.dataId).values,N=t.data.get(i.dataId).values,T=w.values,E=S.util.computeStrides(a.shape),C=S.util.computeStrides(i.shape),F=0;F<c.batchSize;++F)for(var D=F*E[0],O=F*w.strides[0],L=0;L<c.outDepth;++L)for(var z=O+L*w.strides[1],$=L*c.strideDepth-g,B=0;B<l;++B){var W=$+B*d;if(!(W<0||W>=c.inDepth))for(var X=B*C[0],Z=D+W*E[1],V=0;V<c.outHeight;++V)for(var j=z+V*w.strides[2],re=V*c.strideHeight-b,ne=0;ne<f;++ne){var oe=re+ne*p;if(!(oe<0||oe>=c.inHeight))for(var le=X+ne*C[1],pe=Z+oe*E[2],xe=0;xe<c.outWidth;++xe)for(var he=j+xe*c.outChannels,ye=xe*c.strideWidth-y,we=0;we<h;++we){var Ae=ye+we*v;if(!(Ae<0||Ae>=c.inWidth))for(var Ye=le+we*C[2],ht=pe+Ae*c.inChannels,at=Ye,rt=0;rt<c.inChannels;++rt){for(var ft=x[ht+rt],st=0;st<c.outChannels;++st)T[he+st]+=ft*N[at+st];at+=c.outChannels}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var ROe={kernelName:S.Conv3D,backendName:"cpu",kernelFunc:FOe};function OOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.filterShape;Ge([a,i],"conv3dBackpropFilterV2");for(var c=S.util.computeStrides(a.shape),l=S.util.computeStrides(i.shape),f=S.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,d=f.strideHeight,p=f.strideWidth,v=f.filterDepth,m=f.filterHeight,g=f.filterWidth,y=new S.TensorBuffer(f.filterShape,"float32"),b=y.values,w=We(y.strides,4),x=w[0],N=w[1],T=w[2],E=w[3],C=t.data.get(i.dataId).values,F=We(l,4),D=F[0],O=F[1],L=F[2],z=F[3],$=t.data.get(a.dataId).values,B=We(c,4),W=B[0],X=B[1],Z=B[2],V=B[3],j=f.padInfo.front,re=f.padInfo.left,ne=f.padInfo.top,oe=0;oe<v;++oe)for(var le=Math.max(0,Math.ceil((j-oe)/h)),pe=Math.min(f.outDepth,(f.inDepth+j-oe)/h),xe=oe*x,he=0;he<m;++he)for(var ye=Math.max(0,Math.ceil((ne-he)/d)),we=Math.min(f.outHeight,(f.inHeight+ne-he)/d),Ae=he*N+xe,Ye=0;Ye<g;++Ye)for(var ht=Math.max(0,Math.ceil((re-Ye)/p)),at=Math.min(f.outWidth,(f.inWidth+re-Ye)/p),rt=Ye*T+Ae,ft=0;ft<f.inChannels;++ft)for(var st=ft*E+rt,Ze=0;Ze<f.outChannels;++Ze){for(var tt=0,et=0;et<f.batchSize;++et)for(var rn=et*W,He=et*D,kt=le;kt<pe;++kt)for(var An=oe+kt*h-j,hr=An*X+rn,On=kt*O+He,_n=ye;_n<we;++_n)for(var an=he+_n*d-ne,Pr=an*Z+hr,dr=_n*L+On,Mr=ht;Mr<at;++Mr){var Sn=Ye+Mr*p-re,Gi=Sn*V+Pr,Iu=Mr*z+dr;tt+=$[Gi+ft]*C[Iu+Ze]}b[st+Ze]=tt}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var POe={kernelName:S.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:OOe};function MOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.pad,s=r.strides,u=r.inputShape;Ge([a],"conv3dBackpropInputV2");for(var c=S.util.computeStrides(a.shape),l=S.util.computeStrides(i.shape),f=S.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new S.TensorBuffer(f.inShape,"float32"),d=h.values,p=We(h.strides,4),v=p[0],m=p[1],g=p[2],y=p[3],b=t.data.get(a.dataId).values,w=We(c,4),x=w[0],N=w[1],T=w[2],E=w[3],C=t.data.get(i.dataId).values,F=We(l,4),D=F[0],O=F[1],L=F[2],z=F[3],$=f.batchSize,B=f.filterDepth,W=f.filterHeight,X=f.filterWidth,Z=f.inChannels,V=f.inDepth,j=f.inHeight,re=f.inWidth,ne=f.outChannels,oe=f.outDepth,le=f.outHeight,pe=f.outWidth,xe=f.strideDepth,he=f.strideHeight,ye=f.strideWidth,we=B-1-f.padInfo.front,Ae=W-1-f.padInfo.top,Ye=X-1-f.padInfo.left,ht=0;ht<$;++ht)for(var at=0;at<Z;++at)for(var rt=0;rt<V;++rt)for(var ft=rt-we,st=Math.max(0,Math.ceil(ft/xe)),Ze=Math.min(oe,(B+ft)/xe),tt=0;tt<j;++tt)for(var et=tt-Ae,rn=Math.max(0,Math.ceil(et/he)),He=Math.min(le,(W+et)/he),kt=0;kt<re;++kt){for(var An=kt-Ye,hr=Math.max(0,Math.ceil(An/ye)),On=Math.min(pe,(X+An)/ye),_n=0,an=st;an<Ze;++an)for(var Pr=an*xe-ft,dr=rn;dr<He;++dr)for(var Mr=dr*he-et,Sn=hr;Sn<On;++Sn)for(var Gi=Sn*ye-An,Iu=x*ht+N*an+T*dr+E*Sn,jh=D*(B-1-Pr)+O*(W-1-Mr)+L*(X-1-Gi)+z*at,Ui=0;Ui<ne;++Ui){var ss=b[Iu+Ui],Cu=C[jh+Ui];_n+=ss*Cu}d[v*ht+m*rt+g*tt+y*kt+at]=_n}return t.makeTensorInfo(h.shape,h.dtype,h.values)}var BOe={kernelName:S.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:MOe};var LOe=Mt(S.Cos,function(n){return Math.cos(n)}),zOe={kernelName:S.Cos,backendName:"cpu",kernelFunc:LOe};var $Oe=Mt(S.Cosh,function(n){return Math.cosh(n)}),qOe={kernelName:S.Cosh,backendName:"cpu",kernelFunc:$Oe};function WOe(n){for(var e=n.inputs,t=n.backend,r=n.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=We(a.shape,4),f=l[0],h=l[1],d=l[2],p=l[3],v=i.shape[0],m=We(s,2),g=m[0],y=m[1],b=S.buffer([v,g,y,p],"float32"),w=t.data.get(i.dataId).values,x=t.data.get(o.dataId).values,N=t.data.get(a.dataId).values,T=S.util.computeStrides(a.shape),E=S.util.computeStrides(b.shape),C=0;C<v;C++){var F=C*4,D=w[F],O=w[F+1],L=w[F+2],z=w[F+3],$=x[C];if(!($>=f))for(var B=g>1?(L-D)*(h-1)/(g-1):0,W=y>1?(z-O)*(d-1)/(y-1):0,X=0;X<g;X++){var Z=g>1?D*(h-1)+X*B:.5*(D+L)*(h-1);if(Z<0||Z>h-1){for(var V=0;V<y;V++)for(var j=0;j<p;j++){var re=j+V*E[2]+X*E[1]+C*E[0];b.values[re]=c}continue}if(u==="bilinear")for(var ne=Math.floor(Z),oe=Math.ceil(Z),le=Z-ne,V=0;V<y;V++){var pe=y>1?O*(d-1)+V*W:.5*(O+z)*(d-1);if(pe<0||pe>d-1){for(var j=0;j<p;j++){var re=j+V*E[2]+X*E[1]+C*E[0];b.values[re]=c}continue}for(var xe=Math.floor(pe),he=Math.ceil(pe),ye=pe-xe,j=0;j<p;j++){var re=j+xe*T[2]+ne*T[1]+$*T[0],we=N[re];re=j+he*T[2]+ne*T[1]+$*T[0];var Ae=N[re];re=j+xe*T[2]+oe*T[1]+$*T[0];var Ye=N[re];re=j+he*T[2]+oe*T[1]+$*T[0];var ht=N[re],at=we+(Ae-we)*ye,rt=Ye+(ht-Ye)*ye;re=j+V*E[2]+X*E[1]+C*E[0],b.values[re]=at+(rt-at)*le}}else for(var V=0;V<y;++V){var pe=y>1?O*(d-1)+V*W:.5*(O+z)*(d-1);if(pe<0||pe>d-1){for(var j=0;j<p;j++){var re=j+V*E[2]+X*E[1]+C*E[0];b.values[re]=c}continue}for(var ft=Math.round(pe),st=Math.round(Z),j=0;j<p;j++){var Ze=j+ft*T[2]+st*T[1]+$*T[0],tt=j+V*E[2]+X*E[1]+C*E[0];b.values[tt]=N[Ze]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}var VOe={kernelName:S.CropAndResize,backendName:"cpu",kernelFunc:WOe};function GOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;Ge(a,"cumprod");var u=S.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Or({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=S.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=S.upcastType(c.dtype,"int32"),h=S.util.makeOnesTypedArray(S.util.sizeFromShape(c.shape),f),d=t.data.get(c.dataId).values,p=c.shape[c.shape.length-1],v=s?function(T,E){return T+p-E-1}:function(T,E){return T+E},m=0;m<d.length;m+=p)for(var g=0;g<p;g++){var y=v(m,g);if(g===0)h[y]=o?1:d[y];else{var b=v(m,g-1);h[y]=o?d[b]*h[b]:d[y]*h[b]}}var w=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=S.backend_util.getUndoAxesPermutation(u),N=Or({inputs:{x:w},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(c),N}return w}var UOe={kernelName:S.Cumprod,backendName:"cpu",kernelFunc:GOe};function HOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;Ge(a,"cumsum");var u=S.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Or({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=S.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=S.upcastType(c.dtype,"int32"),h=S.util.makeZerosTypedArray(S.util.sizeFromShape(c.shape),f),d=t.data.get(c.dataId).values,p=c.shape[c.shape.length-1],v=s?function(T,E){return T+p-E-1}:function(T,E){return T+E},m=0;m<d.length;m+=p)for(var g=0;g<p;g++){var y=v(m,g);if(g===0)h[y]=o?0:d[y];else{var b=v(m,g-1);h[y]=o?d[b]+h[b]:d[y]+h[b]}}var w=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=S.backend_util.getUndoAxesPermutation(u),N=Or({inputs:{x:w},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(c),N}return w}var KOe={kernelName:S.Cumsum,backendName:"cpu",kernelFunc:HOe};function jOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=r.binaryOutput;if(a.shape.length===1){var u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=dx(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),d=qL(f,h,o,s);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var XOe={kernelName:S.DenseBincount,backendName:"cpu",kernelFunc:jOe};function YOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockSize,o=r.dataFormat;S.util.assert(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)});for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],f=u*i,h=c*i,d=l/(i*i),p=t.data.get(a.dataId).values,v=new Float32Array(s*f*h*d),m=0,g=0;g<s;++g)for(var y=0;y<f;++y)for(var b=Math.floor(y/i),w=y%i,x=0;x<h;++x)for(var N=Math.floor(x/i),T=x%i,E=(w*i+T)*d,C=0;C<d;++C){var F=C+E,D=F+l*(N+c*(b+u*g));v[m++]=p[D]}return t.makeTensorInfo([s,f,h,d],a.dtype,v)}var ZOe={kernelName:S.DepthToSpace,backendName:"cpu",kernelFunc:YOe};function Lz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;Ge([a,i],"depthwiseConv2DNative");var l=S.util.computeStrides(a.shape),f=S.util.computeStrides(i.shape),h=u;h==null&&(h=[1,1]),S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,h),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(h,"'")});for(var d=S.backend_util.computeConv2DInfo(a.shape,i.shape,o,h,s,c,!0),p=d.filterHeight,v=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo,b=y.left,w=y.top,x=d.outChannels/d.inChannels,N=new S.TensorBuffer(d.outShape,a.dtype),T=t.data.get(a.dataId).values,E=t.data.get(i.dataId).values,C=N.values,F=0;F<d.batchSize;++F)for(var D=F*l[0],O=F*N.strides[0],L=0;L<d.outHeight;++L)for(var z=O+L*N.strides[1],$=L*d.strideHeight-w,B=0;B<p;++B){var W=$+B*m;if(!(W<0||W>=d.inHeight))for(var X=B*f[0],Z=D+W*l[1],V=0;V<d.outWidth;++V)for(var j=z+V*N.strides[2],re=V*d.strideWidth-b,ne=0;ne<v;++ne){var oe=re+ne*g;if(!(oe<0||oe>=d.inWidth))for(var le=X+ne*f[1],pe=Z+oe*d.inChannels,xe=j,he=le,ye=0;ye<d.inChannels;++ye){for(var we=T[pe+ye],Ae=0;Ae<x;++Ae)C[xe+Ae]+=we*E[he+Ae];xe+=x,he+=x}}}return t.makeTensorInfo(N.shape,N.dtype,N.values)}var JOe={kernelName:S.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:Lz};function QOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;Ge([a,i],"depthwiseConv2dNativeBackpropFilter");for(var f=S.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=f.strideHeight,d=f.strideWidth,p=f.filterHeight,v=f.filterWidth,m=new S.TensorBuffer(f.filterShape,"float32"),g=f.padInfo.left,y=f.padInfo.top,b=f.outChannels/f.inChannels,w=t.data.get(a.dataId).values,x=new S.TensorBuffer(a.shape,a.dtype,w),N=t.data.get(i.dataId).values,T=new S.TensorBuffer(i.shape,i.dtype,N),E=0;E<p;++E)for(var C=Math.max(0,Math.ceil((y-E)/h)),F=Math.min(f.outHeight,(f.inHeight+y-E)/h),D=0;D<v;++D)for(var O=Math.max(0,Math.ceil((g-D)/d)),L=Math.min(f.outWidth,(f.inWidth+g-D)/d),z=0;z<f.outChannels;++z){for(var $=Math.trunc(z/b),B=z%b,W=0,X=0;X<f.batchSize;++X)for(var Z=C;Z<F;++Z)for(var V=E+Z*h-y,j=O;j<L;++j){var re=D+j*d-g;W+=x.get(X,V,re,$)*T.get(X,Z,j,z)}m.set(W,E,D,$,B)}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var ePe={kernelName:S.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:QOe};function tPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;Ge([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=S.util.computeStrides(a.shape),h=S.util.computeStrides(i.shape),d=S.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),p=new S.TensorBuffer(d.inShape,"float32"),v=p.values,m=We(p.strides,3),g=m[0],y=m[1],b=m[2],w=t.data.get(a.dataId).values,x=We(f,3),N=x[0],T=x[1],E=x[2],C=t.data.get(i.dataId).values,F=We(h,3),D=F[0],O=F[1],L=F[2],z=d.batchSize,$=d.filterHeight,B=d.filterWidth,W=d.inChannels,X=d.inHeight,Z=d.inWidth,V=d.outChannels,j=d.outHeight,re=d.outWidth,ne=d.strideHeight,oe=d.strideWidth,le=$-1-d.padInfo.top,pe=B-1-d.padInfo.left,xe=V/W,he=0;he<z;++he)for(var ye=0;ye<W;++ye)for(var we=0;we<X;++we)for(var Ae=we-le,Ye=Math.max(0,Math.ceil(Ae/ne)),ht=Math.min(j,($+Ae)/ne),at=0;at<Z;++at){for(var rt=at-pe,ft=Math.max(0,Math.ceil(rt/oe)),st=Math.min(re,(B+rt)/oe),Ze=0,tt=Ye;tt<ht;++tt)for(var et=tt*ne-Ae,rn=ft;rn<st;++rn)for(var He=rn*oe-rt,kt=N*he+T*tt+E*rn,An=D*($-1-et)+O*(B-1-He)+L*ye,hr=0;hr<xe;++hr){var On=ye*xe+hr,_n=w[kt+On],an=C[An+hr];Ze+=_n*an}v[g*he+y*we+b*at+ye]=Ze}return t.makeTensorInfo(p.shape,p.dtype,p.values)}var nPe={kernelName:S.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:tPe};function rPe(n){for(var e=n.inputs,t=n.backend,r=e.x,a=S.util.sizeFromShape(r.shape),i=t.data.get(r.dataId).values,o=S.buffer([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=ya(ya([],We(r.shape),!1),We(r.shape),!1);return t.makeTensorInfo(c,o.dtype,o.values)}var aPe={kernelName:S.Diag,backendName:"cpu",kernelFunc:rPe};var iPe={kernelName:S.Dilation2D,backendName:"cpu",kernelFunc:function(n){for(var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=t,l=c.data.get(a.dataId).values,f=a.shape.length,h=c.data.get(i.dataId).values,d=i.shape.length,p=S.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),v=p.batchSize,m=p.inHeight,g=p.inWidth,y=p.inChannels,b=p.outHeight,w=p.outWidth,x=p.padInfo,N=p.strideHeight,T=p.strideWidth,E=p.filterHeight,C=p.filterWidth,F=p.dilationHeight,D=p.dilationWidth,O=p.outShape,L=S.util.sizeFromShape(O),z=O.length,$=S.util.getArrayFromDType(a.dtype,L),B=0;B<v;++B)for(var W=0;W<b;++W)for(var X=W*N-x.top,Z=0;Z<w;++Z)for(var V=Z*T-x.left,j=0;j<y;++j){for(var re=Number.MIN_SAFE_INTEGER,ne=0;ne<E;++ne){var oe=X+ne*F;if(oe>=0&&oe<m)for(var le=0;le<C;++le){var pe=V+le*D;if(pe>=0&&pe<g){var xe=S.util.locToIndex([B,oe,pe,j],f,S.util.computeStrides(a.shape)),he=S.util.locToIndex([ne,le,j],d,S.util.computeStrides(i.shape)),ye=l[xe]+h[he];ye>re&&(re=ye)}}}var we=S.util.locToIndex([B,W,Z,j],z,S.util.computeStrides(O));$[we]=re}var Ae=c.write(S.util.toTypedArray($,a.dtype),O,a.dtype);return{dataId:Ae,shape:O,dtype:a.dtype}}};var oPe={kernelName:S.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.dy,s=r.strides,u=r.pad,c=r.dilations,l=t,f=S.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=S.util.toNestedArray(i.shape,l.data.get(i.dataId).values),d=S.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),p=d.batchSize,v=d.inHeight,m=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,w=d.padInfo,x=d.strideHeight,N=d.strideWidth,T=d.filterHeight,E=d.filterWidth,C=d.dilationHeight,F=d.dilationWidth,D=d.outShape;S.util.assert(o.rank===D.length,function(){return"Error in ".concat(S.Dilation2DBackpropFilter,", dy ")+"must have the same rank as output ".concat(D.length,", but got ")+"".concat(o.rank)});for(var O=S.util.toNestedArray(D,l.data.get(o.dataId).values),L=S.util.makeZerosNestedTypedArray(i.shape,i.dtype),z=0;z<p;++z)for(var $=0;$<y;++$)for(var B=$*x-w.top,W=0;W<b;++W)for(var X=W*N-w.left,Z=0;Z<g;++Z){for(var V=Number.MIN_SAFE_INTEGER,j=0,re=0,ne=0;ne<T;++ne){var oe=B+ne*C;if(oe>=0&&oe<v)for(var le=0;le<E;++le){var pe=X+le*F;if(pe>=0&&pe<m){var xe=f[z][oe][pe][Z]+h[ne][le][Z];xe>V&&(V=xe,j=ne,re=le)}}}L[j][re][Z]+=O[z][$][W][Z]}var he=l.write(S.util.toTypedArray(L,a.dtype),i.shape,i.dtype);return{dataId:he,shape:i.shape,dtype:i.dtype}}};var sPe={kernelName:S.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.dy,s=r.strides,u=r.pad,c=r.dilations,l=t,f=S.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=S.util.toNestedArray(i.shape,l.data.get(i.dataId).values),d=S.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),p=d.batchSize,v=d.inHeight,m=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,w=d.padInfo,x=d.strideHeight,N=d.strideWidth,T=d.filterHeight,E=d.filterWidth,C=d.dilationHeight,F=d.dilationWidth,D=d.outShape;S.util.assert(o.rank===D.length,function(){return"Error in ".concat(S.Dilation2DBackpropInput,", dy ")+"must have the same rank as output ".concat(D.length,", but got ")+"".concat(o.rank)});for(var O=S.util.toNestedArray(D,l.data.get(o.dataId).values),L=S.util.makeZerosNestedTypedArray(a.shape,a.dtype),z=0;z<p;++z)for(var $=0;$<y;++$)for(var B=$*x-w.top,W=0;W<b;++W)for(var X=W*N-w.left,Z=0;Z<g;++Z){for(var V=Number.MIN_SAFE_INTEGER,j=B<0?0:B,re=X<0?0:X,ne=0;ne<T;++ne){var oe=B+ne*C;if(oe>=0&&oe<v)for(var le=0;le<E;++le){var pe=X+le*F;if(pe>=0&&pe<m){var xe=f[z][oe][pe][Z]+h[ne][le][Z];xe>V&&(V=xe,j=oe,re=pe)}}}L[z][j][re][Z]+=O[z][$][W][Z]}var he=l.write(S.util.toTypedArray(L,a.dtype),a.shape,a.dtype);return{dataId:he,shape:a.shape,dtype:a.dtype}}};function ah(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"sum");var s;a.dtype==="bool"?s=Zo({inputs:{x:a},backend:t,attrs:{dtype:"int32"}}):s=Mi({inputs:{x:a},backend:t});var u=s.shape.length,c=S.util.parseAxisParam(i,s.shape),l=S.backend_util.getAxesPermutation(c,u),f=c,h=s;l!=null&&(h=Or({inputs:{x:s},backend:t,attrs:{perm:l}}),f=S.backend_util.getInnerMostAxes(f.length,u)),S.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var d=We(S.backend_util.computeOutAndReduceShapes(h.shape,f),2),p=d[0],v=d[1],m=S.backend_util.upcastType(h.dtype,"int32"),g=Hv(t,p,m),y=S.util.sizeFromShape(v),b=t.data.get(g.dataId).values,w=t.data.get(h.dataId).values,x=0;x<b.length;++x){for(var N=x*y,T=0,E=0;E<y;++E)T+=w[N+E];b[x]=T}if(o){var C=S.backend_util.expandShapeToKeepDim(g.shape,c),F=g;g=qt({inputs:{x:g},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(F)}return t.disposeIntermediateTensorInfo(s),l!=null&&t.disposeIntermediateTensorInfo(h),g}var uPe={kernelName:S.Sum,backendName:"cpu",kernelFunc:ah};function cPe(n){var e,t,r,a,i=n.inputs,o=n.backend,s=n.attrs,u=s.equation,c=i,l=S.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,d=l.idDims;S.backend_util.checkEinsumDimSizes(f.length,d,c);for(var p=S.backend_util.getEinsumComputePath(h,d),v=p.path,m=p.steps,g=m.length,y=null,b=f.length,w=[],x=0;x<g;++x){try{for(var N=(e=void 0,Pc(m[x])),T=N.next();!T.done;T=N.next()){var E=T.value,C=S.backend_util.getEinsumPermutation(b,d[E]),F=C.permutationIndices,D=C.expandDims,O=void 0;S.backend_util.isIdentityPermutation(F)?O=c[E]:(O=Or({inputs:{x:c[E]},backend:o,attrs:{perm:F}}),w.push(O));for(var L=O.shape.slice(),z=0;z<D.length;++z)L.splice(D[z],0,1);S.util.arraysEqual(O.shape,L)||(O=qt({inputs:{x:O},backend:o,attrs:{shape:L}}),w.push(O)),y===null?y=O:(y=Yv({inputs:{a:O,b:y},backend:o}),w.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=N.return)&&t.call(N)}finally{if(e)throw e.error}}x<g-1&&(v[x]>=0&&(y=ah({inputs:{x:y},backend:o,attrs:{axis:v[x]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var $=Pc(w),B=$.next();!B.done;B=$.next()){var W=B.value;W!==y&&o.disposeIntermediateTensorInfo(W)}}catch(X){r={error:X}}finally{try{B&&!B.done&&(a=$.return)&&a.call($)}finally{if(r)throw r.error}}return y}var lPe={kernelName:S.Einsum,backendName:"cpu",kernelFunc:cPe};function fPe(n){var e=n.inputs,t=n.backend,r=e.dy,a=e.y;Ge([r,a],"eluGrad");for(var i=new Float32Array(S.util.sizeFromShape(a.shape)),o=t.data.get(a.dataId).values,s=t.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];c>=1?i[u]=s[u]:i[u]=s[u]*(c+1)}return t.makeTensorInfo(a.shape,"float32",i)}var hPe={kernelName:S.EluGrad,backendName:"cpu",kernelFunc:fPe};var dPe=S.backend_util.ERF_P,pPe=S.backend_util.ERF_A1,vPe=S.backend_util.ERF_A2,mPe=S.backend_util.ERF_A3,gPe=S.backend_util.ERF_A4,yPe=S.backend_util.ERF_A5,bPe=Mt(S.Erf,function(n){var e=Math.sign(n),t=Math.abs(n),r=1/(1+dPe*t);return e*(1-((((yPe*r+gPe)*r+mPe)*r+vPe)*r+pPe)*r*Math.exp(-t*t))}),wPe={kernelName:S.Erf,backendName:"cpu",kernelFunc:bPe};function jv(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(S.util.assert(-(o+1)<=i,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+i+1),s.splice(u,0,1),qt({inputs:{x:a},backend:t,attrs:{shape:s}})}var xPe={kernelName:S.ExpandDims,backendName:"cpu",kernelFunc:jv};var kPe=zn(function(n,e){return n/e}),bx=Zn(S.RealDiv,kPe),cx={kernelName:S.RealDiv,backendName:"cpu",kernelFunc:bx};function zz(n,e,t){for(var r=n.shape,a=r[0],i=r[1],o=t.data.get(n.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=S.util.sizeFromShape(c),f=S.util.getTypedArrayFromDType("float32",l),h=S.util.getTypedArrayFromDType("float32",l),d=0;d<a;d++){for(var p=lu({inputs:{x:s},backend:t,attrs:{begin:[d,0],size:[1,i]}}),v=lu({inputs:{x:u},backend:t,attrs:{begin:[d,0],size:[1,i]}}),m=na({inputs:{real:p,imag:v},backend:t}),g=SPe(m,e,t),y=g.real,b=g.imag,w=S.backend_util.mergeRealAndImagArrays(y,b),x=0;x<i;x++){var N=S.backend_util.getComplexWithIndex(w,x);f[d*i+x]=N.real,h[d*i+x]=N.imag}t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(m)}var T=t.makeTensorInfo(c,"float32",f),E=t.makeTensorInfo(c,"float32",h),C=na({inputs:{real:T,imag:E},backend:t});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(E),C}function SPe(n,e,t){var r=S.util.sizeFromShape(n.shape),a=t.data.get(n.dataId),i=t.data.get(a.complexTensorInfos.real.dataId).values,o=t.data.get(a.complexTensorInfos.imag.dataId).values;if(NPe(r)){var s=lx(i,o,r,e,t),u=[n.shape[0],n.shape[1]];if(e){var c=t.makeTensorInfo(u,"float32",s.real),l=t.makeTensorInfo(u,"float32",s.imag),f=t.makeTensorInfo([],"float32",S.util.createScalarValue(r,"float32")),h=Mi({inputs:{x:f},backend:t}),d=cx.kernelFunc({inputs:{a:c,b:f},backend:t}),p=cx.kernelFunc({inputs:{a:l,b:h},backend:t}),v=t.data.get(d.dataId).values,m=t.data.get(p.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),{real:v,imag:m}}return s}else{var g=S.backend_util.mergeRealAndImagArrays(i,o),y=TPe(g,r,e);return S.backend_util.splitRealAndImagArrays(y)}}function NPe(n){return(n&n-1)===0}function lx(n,e,t,r,a){if(t===1)return{real:n,imag:e};var i=S.backend_util.mergeRealAndImagArrays(n,e),o=t/2,s=S.backend_util.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],f=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),d=na({inputs:{real:f,imag:h},backend:a}),p=S.backend_util.complexWithOddIndex(i),v=p.real,m=p.imag,g=[v.length],y=a.makeTensorInfo(g,"float32",v),b=a.makeTensorInfo(g,"float32",m),w=na({inputs:{real:y,imag:b},backend:a}),x=lx(u,c,o,r,a),N=x.real,T=x.imag,E=[N.length],C=a.makeTensorInfo(E,"float32",N),F=a.makeTensorInfo(E,"float32",T),D=na({inputs:{real:C,imag:F},backend:a}),O=lx(v,m,o,r,a),L=O.real,z=O.imag,$=[L.length],B=a.makeTensorInfo($,"float32",L),W=a.makeTensorInfo($,"float32",z),X=na({inputs:{real:B,imag:W},backend:a}),Z=S.backend_util.exponents(t,r),V=[Z.real.length],j=a.makeTensorInfo(V,"float32",Z.real),re=a.makeTensorInfo(V,"float32",Z.imag),ne=na({inputs:{real:j,imag:re},backend:a}),oe=Yv({inputs:{a:ne,b:X},backend:a}),le=Mc({inputs:{a:D,b:oe},backend:a}),pe=gx({inputs:{a:D,b:oe},backend:a}),xe=cu({inputs:{input:le},backend:a}),he=cu({inputs:{input:pe},backend:a}),ye=Bc({inputs:{input:le},backend:a}),we=Bc({inputs:{input:pe},backend:a}),Ae=Lc({inputs:[xe,he],backend:a,attrs:{axis:0}}),Ye=Lc({inputs:[ye,we],backend:a,attrs:{axis:0}}),ht=a.data.get(Ae.dataId).values,at=a.data.get(Ye.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(re),a.disposeIntermediateTensorInfo(ne),a.disposeIntermediateTensorInfo(oe),a.disposeIntermediateTensorInfo(le),a.disposeIntermediateTensorInfo(pe),a.disposeIntermediateTensorInfo(xe),a.disposeIntermediateTensorInfo(ye),a.disposeIntermediateTensorInfo(he),a.disposeIntermediateTensorInfo(we),a.disposeIntermediateTensorInfo(Ae),a.disposeIntermediateTensorInfo(Ye),{real:ht,imag:at}}function TPe(n,e,t){for(var r=new Float32Array(e*2),a=0;a<e;a++){for(var i=0,o=0,s=0;s<e;s++){var u=S.backend_util.exponent(a*s,e,t),c=S.backend_util.getComplexWithIndex(n,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}t&&(i/=e,o/=e),S.backend_util.assignToTypedArray(r,i,o,a)}return r}function EPe(n){var e=n.inputs,t=n.backend,r=e.input,a=S.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=qt({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=zz(s,!1,t),c=qt({inputs:{x:u},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var IPe={kernelName:S.FFT,backendName:"cpu",kernelFunc:EPe};function wx(n){var e=n.backend,t=n.attrs,r=t.shape,a=t.value,i=t.dtype,o=i||S.util.inferDtype(a),s=S.util.getArrayFromDType(o,S.util.sizeFromShape(r));return APe(s,a,o),e.makeTensorInfo(r,o,s)}var CPe={kernelName:S.Fill,backendName:"cpu",kernelFunc:wx};function APe(n,e,t){n.fill(e)}var _Pe={kernelName:S.FlipLeftRight,backendName:"cpu",kernelFunc:function(n){var e=n.inputs;n.attrs;for(var t=n.backend,r=e.image,a=t,i=S.util.getTypedArrayFromDType(r.dtype,S.util.sizeFromShape(r.shape)),o=We(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],f=a.data.get(r.dataId).values,h=0;h<s;h++)for(var d=h*c*u*l,p=0;p<u;p++)for(var v=p*(c*l),m=0;m<c;m++)for(var g=m*l,y=0;y<l;y++){var b=Math.round(c-m-1),w=d+v+g+y,x=f[w];if(b>=0&&b<c){var N=b*l,T=d+v+N+y;x=f[T]}i[w]=x}var E=a.write(i,r.shape,r.dtype);return{dataId:E,shape:r.shape,dtype:r.dtype}}};var DPe=zn(function(n,e){return Math.floor(n/e)}),FPe=Zn(S.FloorDiv,DPe,null,"int32"),RPe={kernelName:S.FloorDiv,backendName:"cpu",kernelFunc:FPe};function OPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,f=r.dilations,h=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=Bz({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var m=v;if(l==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){var g=qt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});v=Mc({inputs:{a:v,b:g},backend:t}),t.disposeIntermediateTensorInfo(g)}else v=Mc({inputs:{a:v,b:o},backend:t});t.disposeIntermediateTensorInfo(m)}if(d){var m=v;if(l==="NCHW"&&d==="prelu"&&s.shape.length===1&&s.shape[0]!==1){var y=qt({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});v=Kv(t,v,d,y,p),t.disposeIntermediateTensorInfo(y)}else v=Kv(t,v,d,s,p);t.disposeIntermediateTensorInfo(m)}return v}var PPe={kernelName:S.FusedConv2D,backendName:"cpu",kernelFunc:OPe};function MPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,f=r.dilations,h=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=Lz({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var m=v;v=Mc({inputs:{a:v,b:o},backend:t}),t.disposeIntermediateTensorInfo(m)}if(d){var m=v;v=Kv(t,v,d,s,p),t.disposeIntermediateTensorInfo(m)}return v}var BPe={kernelName:S.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:MPe};function LPe(n){var e=n.inputs,t=n.backend,r=e.params,a=e.indices,i=S.util.sizeFromShape(r.shape),o=a.shape,s=o[o.length-1],u=We(S.backend_util.prepareAndValidate(r,a),4),c=u[0],l=u[1],f=u[2],h=u[3];if(l===0)return t.makeTensorInfo(c,r.dtype,[]);var d=t.data.get(a.dataId).values,p=t.bufferSync(r),v=YL(d,p,r.dtype,l,s,f,h,r.shape,i);return t.makeTensorInfo(c,r.dtype,v.values)}var zPe={kernelName:S.GatherNd,backendName:"cpu",kernelFunc:LPe};function $Pe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.indices,o=r.axis,s=r.batchDims;Ge([a,i],"gatherV2");for(var u=S.util.parseAxisParam(o,a.shape)[0],c=t.data.get(i.dataId).values,l=a.shape[u],f=function(N){var T=c[N];S.util.assert(T<=l-1&&T>=0,function(){return"GatherV2: the index value ".concat(T," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var d=s;s==null&&(d=0);var p=S.util.sizeFromShape(i.shape),v=S.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,d),m=qt({inputs:{x:a},backend:t,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),g=qt({inputs:{x:i},backend:t,attrs:{shape:[v.batchSize,p/v.batchSize]}}),y=[v.batchSize,v.outerSize,p/v.batchSize,v.sliceSize],b=t.bufferSync(g),w=t.bufferSync(m),x=ZL(w,b,y);return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(v.outputShape,x.dtype,x.values)}var qPe={kernelName:S.GatherV2,backendName:"cpu",kernelFunc:$Pe};function WPe(n){var e=n.inputs,t=n.backend,r=e.input,a=S.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=qt({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=zz(s,!0,t),c=qt({inputs:{x:u},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var VPe={kernelName:S.IFFT,backendName:"cpu",kernelFunc:WPe};var GPe=Mt(S.IsFinite,function(n){return Number.isFinite(n)?1:0},"bool"),UPe={kernelName:S.IsFinite,backendName:"cpu",kernelFunc:GPe};var HPe=Mt(S.IsInf,function(n){return Math.abs(n)===1/0?1:0},"bool"),KPe={kernelName:S.IsInf,backendName:"cpu",kernelFunc:HPe};var jPe=Mt(S.IsNan,function(n){return Number.isNaN(n)?1:0},"bool"),XPe={kernelName:S.IsNan,backendName:"cpu",kernelFunc:jPe};function YPe(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.num,o=nz(r,a,i);return e.makeTensorInfo([o.length],"float32",o)}var ZPe={kernelName:S.LinSpace,backendName:"cpu",kernelFunc:YPe};var JPe=Mt(S.Log1p,function(n){return Math.log1p(n)}),QPe={kernelName:S.Log1p,backendName:"cpu",kernelFunc:JPe};var eMe=zn(function(n,e){return n&&e}),tMe=Zn(S.LogicalAnd,eMe,null,"bool"),nMe={kernelName:S.LogicalAnd,backendName:"cpu",kernelFunc:tMe};var rMe=Mt(S.LogicalNot,function(n){return n?0:1},"bool"),aMe={kernelName:S.LogicalNot,backendName:"cpu",kernelFunc:rMe};var iMe=zn(function(n,e){return n||e}),oMe=Zn(S.LogicalOr,iMe,null,"bool"),sMe={kernelName:S.LogicalOr,backendName:"cpu",kernelFunc:oMe};function uMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;Ge(a,"LRN");var c=a.shape[3],l=c-1,f=t.data.get(a.dataId).values,h=S.util.sizeFromShape(a.shape),d=new Float32Array(h);function p(y){for(var b=y%c,w=y-b+Math.max(0,b-i),x=y-b+Math.min(b+i,l),N=0;w<=x;w++){var T=f[w];N+=T*T}return N}for(var v=0;v<h;v++){var m=p(v),g=f[v]*Math.pow(o+s*m,-u);d[v]=g}return t.makeTensorInfo(a.shape,a.dtype,d)}var cMe={kernelName:S.LRN,backendName:"cpu",kernelFunc:uMe};function lMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.y,o=e.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;Ge(o,"LRNGrad");for(var f=S.util.sizeFromShape(o.shape),h=o.shape[3],d=t.data.get(o.dataId).values,p=t.data.get(a.dataId).values,v=t.data.get(i.dataId).values,m=new Float32Array(f),g=f,y=0;y<g;y++){for(var b=y%h,w=y-b+Math.max(0,b-s),x=y-b+Math.min(h,b+s+1),N=0,T=w;T<x;T++)N+=Math.pow(p[T],2);N=c*N+u;for(var T=w;T<x;T++){var E=-2*c*l*p[T]*v[y]/N;y===T&&(E+=Math.pow(N,-l)),E*=d[y],m[T]+=E}}return t.makeTensorInfo(o.shape,a.dtype,m)}var fMe={kernelName:S.LRNGrad,backendName:"cpu",kernelFunc:lMe};function $z(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reductionIndices,o=r.keepDims,s=t,u=a.shape,c=u.length,l=S.util.parseAxisParam(i,u),f=l,h=S.backend_util.getAxesPermutation(f,c),d=s.data.get(a.dataId).values;if(h!=null){for(var p=new Array(c),v=0;v<p.length;v++)p[v]=u[h[v]];d=vx(d,u,a.dtype,h,p),f=S.backend_util.getInnerMostAxes(f.length,c),u=p}Ge(a,"max"),S.backend_util.assertAxesAreInnerMostDims("max",f,c);var m=We(S.backend_util.computeOutAndReduceShapes(u,f),2),g=m[0],y=m[1],b=S.util.sizeFromShape(y),w=az(d,b,g,a.dtype),x=s.write(w,g,a.dtype),N=g;if(o){var p=S.backend_util.expandShapeToKeepDim(g,l);N=p}return{dataId:x,shape:N,dtype:a.dtype}}var hMe={kernelName:S.Max,backendName:"cpu",kernelFunc:$z};function dMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Ge(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=S.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&S.util.arraysEqual(l.inShape,l.outShape))f=Mi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,d=S.util.computeStrides(a.shape),p=yx(h,a.shape,a.dtype,d,l,"max");f=t.makeTensorInfo(l.outShape,a.dtype,p.values)}return f}var pMe={kernelName:S.MaxPool,backendName:"cpu",kernelFunc:dMe};function vMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;Ge(a,"maxPool3d");var l=S.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Mz(f,a.shape,a.dtype,S.util.computeStrides(a.shape),l,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}var mMe={kernelName:S.MaxPool3D,backendName:"cpu",kernelFunc:vMe};function gMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;Ge([a,i],"maxPool3DGrad");for(var l=S.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=t.bufferSync(i),h=aOe(f,l),d=l.strideDepth,p=l.strideHeight,v=l.strideWidth,m=l.dilationDepth,g=l.dilationHeight,y=l.dilationWidth,b=l.effectiveFilterDepth,w=l.effectiveFilterHeight,x=l.effectiveFilterWidth,N=b-1-l.padInfo.front,T=x-1-l.padInfo.left,E=w-1-l.padInfo.top,C=S.buffer(i.shape,"float32"),F=t.bufferSync(a),D=0;D<l.batchSize;++D)for(var O=0;O<l.inChannels;++O)for(var L=0;L<l.inDepth;++L)for(var z=0;z<l.inHeight;++z)for(var $=0;$<l.inWidth;++$){for(var B=L-N,W=z-E,X=$-T,Z=0,V=0;V<b;V+=m){var j=(B+V)/d;if(!(j<0||j>=l.outDepth||Math.floor(j)!==j))for(var re=0;re<w;re+=g){var ne=(W+re)/p;if(!(ne<0||ne>=l.outHeight||Math.floor(ne)!==ne))for(var oe=0;oe<x;oe+=y){var le=(X+oe)/v;if(!(le<0||le>=l.outWidth||Math.floor(le)!==le)){var pe=b*w*x-1-h.get(D,j,ne,le,O),xe=V*w*x+re*x+oe,he=pe===xe?1:0;if(he!==0){var ye=F.get(D,j,ne,le,O);Z+=ye*he}}}}}C.set(Z,D,L,z,$,O)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}var yMe={kernelName:S.MaxPool3DGrad,backendName:"cpu",kernelFunc:gMe};function bMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=e.output,s=i;Ge([i,o],"maxPoolGrad");for(var u=r.filterSize,c=r.strides,l=r.pad,f=r.dimRoundingMode,h=S.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),d=t.data.get(s.dataId).values,p=S.buffer(h.outShape,s.dtype,Pz(d,s.shape,s.dtype,h).values),v=h.strideHeight,m=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,b=h.effectiveFilterHeight,w=h.effectiveFilterWidth,x=w-1-h.padInfo.left,N=b-1-h.padInfo.top,T=S.buffer(s.shape,"float32"),E=t.data.get(a.dataId).values,C=S.buffer(a.shape,"float32",E),F=0;F<h.batchSize;++F)for(var D=0;D<h.inChannels;++D)for(var O=0;O<h.inHeight;++O)for(var L=0;L<h.inWidth;++L){for(var z=O-N,$=L-x,B=0,W=0;W<b;W+=g){var X=(z+W)/v;if(!(X<0||X>=h.outHeight||Math.floor(X)!==X))for(var Z=0;Z<w;Z+=y){var V=($+Z)/m;if(!(V<0||V>=h.outWidth||Math.floor(V)!==V)){var j=b*w-1-p.get(F,X,V,D),re=W*w+Z,ne=j===re?1:0;if(ne!==0){var oe=C.get(F,X,V,D);B+=oe*ne}}}}T.set(B,F,O,L,D)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}var wMe={kernelName:S.MaxPoolGrad,backendName:"cpu",kernelFunc:bMe};function xMe(n,e,t,r,a){var i=S.util.computeStrides(e),o=yx(n,e,t,i,a,"max"),s=Pz(n,e,t,a,!0,r);return[o.values,s.values]}var kMe={kernelName:S.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=r;Ge(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,f=S.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=We(xMe(l,a.shape,a.dtype,u,f),2),d=h[0],p=h[1],v=c.write(d,f.outShape,a.dtype),m=c.write(p,f.outShape,a.dtype);return[{dataId:v,shape:f.outShape,dtype:a.dtype},{dataId:m,shape:f.outShape,dtype:"int32"}]}};function SMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=S.util.parseAxisParam(i,a.shape),u=S.backend_util.computeOutAndReduceShapes(a.shape,s),c=u[1],l=S.util.sizeFromShape(c),f=[],h=t.makeTensorInfo([],"float32",new Float32Array([l]));f.push(h);var d=Zo({inputs:{x:a},backend:t,attrs:{dtype:"float32"}});f.push(d);var p=bx({inputs:{a:d,b:h},backend:t});f.push(p);var v=ah({inputs:{x:p},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(function(m){return t.disposeIntermediateTensorInfo(m)}),v}var NMe={kernelName:S.Mean,backendName:"cpu",kernelFunc:SMe};function TMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"min");var s=S.util.parseAxisParam(i,a.shape),u=s,c=S.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),u=S.backend_util.getInnerMostAxes(u.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var f=We(S.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],d=f[1],p=S.util.sizeFromShape(d),v=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),l.dtype),m=t.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*p,b=m[y],w=0;w<p;++w){var x=m[y+w];(Number.isNaN(x)||x<b)&&(b=x)}v[g]=b}c!=null&&t.disposeIntermediateTensorInfo(l);var N=t.makeTensorInfo(h,l.dtype,v);if(o){var T=S.backend_util.expandShapeToKeepDim(h,s),E=qt({inputs:{x:N},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(N),E}return N}var EMe={kernelName:S.Min,backendName:"cpu",kernelFunc:TMe};function IMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.mode;Ge(a,"mirrorPad");for(var s=i.map(function(T,E){return T[0]+a.shape[E]+T[1]}),u=i.map(function(T){return T[0]}),c=i.map(function(T,E){return T[0]+a.shape[E]}),l=o==="reflect"?0:1,f=t.data.get(a.dataId).values,h=a.shape.length,d=S.util.computeStrides(a.shape),p=S.util.sizeFromShape(s),v=s.length,m=S.util.computeStrides(s),g=S.util.getTypedArrayFromDType(a.dtype,p),y=0;y<p;y++){for(var b=S.util.indexToLoc(y,v,m),w=0;w<v;w++)b[w]<u[w]?b[w]=u[w]*2-b[w]-l:b[w]>=c[w]&&(b[w]=(c[w]-1)*2-b[w]+l);b=b.map(function(T,E){return T-u[E]});var x=S.util.locToIndex(b,h,d);g[y]=f[x]}var N=t.write(g,s,a.dtype);return{dataId:N,shape:s,dtype:a.dtype}}var CMe={kernelName:S.MirrorPad,backendName:"cpu",kernelFunc:IMe};var AMe=zn(function(n,e){var t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),_Me=Zn(S.Mod,AMe),DMe={kernelName:S.Mod,backendName:"cpu",kernelFunc:_Me};function qz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.dim,o=a.shape.length,s=i;if(s===-1&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=S.util.parseAxisParam([s],a.shape),c=$z({inputs:{x:a},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),l=S.backend_util.expandShapeToKeepDim(c.shape,u),f=qt({inputs:{x:c},backend:t,attrs:{shape:l}}),h=gx({inputs:{a,b:f},backend:t}),d=KL({inputs:{x:h},backend:t}),p=ah({inputs:{x:d},backend:t,attrs:{axis:u,keepDims:!1}}),v=qt({inputs:{x:p},backend:t,attrs:{shape:l}}),m=bx({inputs:{a:d,b:v},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),m}var FMe={kernelName:S.Softmax,backendName:"cpu",kernelFunc:qz};function RMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.numSamples,o=r.seed,s=r.normalized;Ge(a,"multinomial");for(var u=s?a:qz({inputs:{logits:a},backend:t,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],f=t.data.get(u.dataId).values,h=[c,i],d=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),"int32"),p=0;p<c;++p){var v=p*l,m=new Float32Array(l-1);m[0]=f[v];for(var g=1;g<m.length;++g)m[g]=m[g-1]+f[v+g];for(var y=hFe.alea(o.toString()),b=p*i,w=0;w<i;++w){var x=y();d[b+w]=m.length;for(var g=0;g<m.length;g++)if(x<m[g]){d[b+w]=g;break}}}return s||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(h,"int32",d)}var OMe={kernelName:S.Multinomial,backendName:"cpu",kernelFunc:RMe};var PMe=S.kernel_impls.nonMaxSuppressionV3Impl;function MMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;Ge(a,"NonMaxSuppression");var c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=PMe(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var BMe={kernelName:S.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:MMe};var LMe=S.kernel_impls.nonMaxSuppressionV4Impl;function zMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;Ge(a,"NonMaxSuppressionPadded");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=LMe(l,f,o,s,u,c),d=h.selectedIndices,p=h.validOutputs;return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}var $Me={kernelName:S.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:zMe};var qMe=S.kernel_impls.nonMaxSuppressionV5Impl;function WMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;Ge(a,"NonMaxSuppressionWithScore");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=o,d=s,p=u,v=c,m=qMe(l,f,h,d,p,v),g=m.selectedIndices,y=m.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var VMe={kernelName:S.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:WMe};function GMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;Ge(a,"oneHot");var c=S.util.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var f=t.data.get(a.dataId).values,h=0;h<c;++h)f[h]>=0&&f[h]<o&&(l[h*o+f[h]]=s);return t.makeTensorInfo(ya(ya([],We(a.shape),!1),[o],!1),i,l)}var UMe={kernelName:S.OneHot,backendName:"cpu",kernelFunc:GMe};function Xv(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){var a=cu({inputs:{input:r},backend:t}),i=Xv({inputs:{x:a},backend:t}),o=Bc({inputs:{input:r},backend:t}),s=Xv({inputs:{x:o},backend:t}),u=na({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return wx({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var HMe={kernelName:S.ZerosLike,backendName:"cpu",kernelFunc:Xv};function Wz(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){var a=cu({inputs:{input:r},backend:t}),i=Wz({inputs:{x:a},backend:t}),o=Bc({inputs:{input:r},backend:t}),s=Xv({inputs:{x:o},backend:t}),u=na({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return wx({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var KMe={kernelName:S.OnesLike,backendName:"cpu",kernelFunc:Wz};function Vz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis;if(e.length===1)return jv({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){S.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),S.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=jv({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=Lc({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var jMe={kernelName:S.Pack,backendName:"cpu",kernelFunc:Vz};function XMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.constantValue;Ge(a,"pad");var s=i.map(function(N,T){return N[0]+a.shape[T]+N[1]}),u=i.map(function(N){return N[0]}),c=t.data.get(a.dataId).values,l=S.util.sizeFromShape(a.shape),f=a.shape.length,h=S.util.computeStrides(a.shape),d=S.util.sizeFromShape(s),p=s.length,v=S.util.computeStrides(s),m=S.util.getTypedArrayFromDType(a.dtype,d);o!==0&&m.fill(o);for(var g=0;g<l;g++){var y=S.util.indexToLoc(g,f,h),b=y.map(function(N,T){return N+u[T]}),w=S.util.locToIndex(b,p,v);m[w]=c[g]}var x=t.write(m,s,a.dtype);return{dataId:x,shape:s,dtype:a.dtype}}var Gz={kernelName:S.PadV2,backendName:"cpu",kernelFunc:XMe};var YMe=zn(function(n,e){return Math.pow(n,e)}),ZMe=Zn(S.Pow,YMe),JMe={kernelName:S.Pow,backendName:"cpu",kernelFunc:ZMe};function QMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;r.outputRaggedRank;var s=a.map(function(g){return t.data.get(g.dataId).values}),u=a.map(function(g){return g.shape}),c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values,f=We(lz(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],d=f[1],p=f[2],v=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),m=t.makeTensorInfo(p,i.dtype,d);return v.concat([m])}var e4e={kernelName:S.RaggedGather,backendName:"cpu",kernelFunc:QMe};function t4e(n){var e=n.inputs,t=n.backend,r=e.starts,a=e.limits,i=e.deltas,o=t.data.get(r.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(fz(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),d=t.makeTensorInfo([f.length],r.dtype,f);return[h,d]}var n4e={kernelName:S.RaggedRange,backendName:"cpu",kernelFunc:t4e};function r4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=r.rowPartitionTypes,c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,h=s.map(function(g){return t.data.get(g.dataId).values}),d=s.map(function(g){return g.shape}),p=We(hz(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,d,u),2),v=p[0],m=p[1];return t.makeTensorInfo(v,i.dtype,m)}var a4e={kernelName:S.RaggedTensorToTensor,backendName:"cpu",kernelFunc:r4e};function i4e(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.dtype,o=t.step,s=dz(r,a,o,i);return e.makeTensorInfo([s.length],i,s)}var o4e={kernelName:S.Range,backendName:"cpu",kernelFunc:i4e};var s4e=Mt(S.Reciprocal,function(n){return 1/n}),u4e={kernelName:S.Reciprocal,backendName:"cpu",kernelFunc:s4e};function c4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;Ge(a,"resizeBilinear");for(var u=S.util.computeStrides(a.shape),c=We(s,2),l=c[0],f=c[1],h=We(a.shape,4),d=h[0],p=h[1],v=h[2],m=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(S.util.sizeFromShape([d,l,f,m])),b=[i&&l>1?p-1:p,i&&f>1?v-1:v],w=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=0,N=b[0]/w[0],T=b[1]/w[1],E=0;E<d;E++)for(var C=0;C<l;C++){var F=void 0;o?F=N*(C+.5)-.5:F=N*C;for(var D=Math.max(0,Math.floor(F)),O=F-D,L=Math.min(p-1,Math.ceil(F)),z=E*u[0]+D*u[1],$=E*u[0]+L*u[1],B=0;B<f;B++){var W=void 0;o?W=T*(B+.5)-.5:W=T*B;for(var X=Math.max(0,Math.floor(W)),Z=W-X,V=Math.min(v-1,Math.ceil(W)),j=z+X*u[2],re=$+X*u[2],ne=z+V*u[2],oe=$+V*u[2],le=0;le<m;le++){var pe=g[j+le],xe=g[re+le],he=g[ne+le],ye=g[oe+le],we=pe+(he-pe)*Z,Ae=xe+(ye-xe)*Z,Ye=we+(Ae-we)*O;y[x++]=Ye}}}return t.makeTensorInfo([d,l,f,m],"float32",y)}var l4e={kernelName:S.ResizeBilinear,backendName:"cpu",kernelFunc:c4e};function f4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners;Ge([i,a],"resizeBilinearGrad");for(var s=S.util.computeStrides(a.shape),u=We(a.shape,4),c=u[0],l=u[1],f=u[2],h=u[3],d=We(i.shape,3),p=d[1],v=d[2],m=new Float32Array(c*l*f*h),g=[o&&p>1?l-1:l,o&&v>1?f-1:f],y=[o&&p>1?p-1:p,o&&v>1?v-1:v],b=g[0]/y[0],w=g[1]/y[1],x=t.data.get(i.dataId).values,N=0,T=0;T<c;T++)for(var E=T*s[0],C=0;C<p;C++)for(var F=C*b,D=Math.floor(F),O=Math.min(Math.ceil(F),l-1),L=E+D*s[1],z=E+O*s[1],$=F-D,B=1-$,W=0;W<v;W++)for(var X=W*w,Z=Math.floor(X),V=Math.min(Math.ceil(X),f-1),j=X-Z,re=1-j,ne=L+Z*s[2],oe=L+V*s[2],le=z+Z*s[2],pe=z+V*s[2],xe=B*re,he=B*j,ye=$*re,we=$*j,Ae=0;Ae<h;Ae++){var Ye=x[N++];m[ne+Ae]+=Ye*xe,m[oe+Ae]+=Ye*he,m[le+Ae]+=Ye*ye,m[pe+Ae]+=Ye*we}return t.makeTensorInfo([c,f,l,h],"float32",m)}var h4e={kernelName:S.ResizeBilinearGrad,backendName:"cpu",kernelFunc:f4e};function d4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;Ge(a,"resizeNearestNeighbor");for(var u=S.util.computeStrides(a.shape),c=We(s,2),l=c[0],f=c[1],h=We(a.shape,4),d=h[0],p=h[1],v=h[2],m=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(d*l*f*m),b=[i&&l>1?p-1:p,i&&f>1?v-1:v],w=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=b[0]/w[0],N=b[1]/w[1],T=0,E=0;E<d;E++)for(var C=E*u[0],F=0;F<l;F++){var D=o?x*(F+.5):x*F,O=Math.min(p-1,i?Math.round(D):Math.floor(D));o&&(O=Math.max(0,O));for(var L=C+O*u[1],z=0;z<f;z++){var $=o?N*(z+.5):N*z,B=Math.min(v-1,i?Math.round($):Math.floor($));o&&(B=Math.max(0,B));for(var W=L+B*u[2],X=0;X<m;X++){var Z=g[W+X];y[T++]=Z}}}return t.makeTensorInfo([d,l,f,m],a.dtype,y)}var p4e={kernelName:S.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:d4e};function v4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners;Ge([i,a],"resizeNearestNeighborGrad");for(var s=S.util.computeStrides(a.shape),u=S.util.computeStrides(i.shape),c=We(a.shape,4),l=c[0],f=c[1],h=c[2],d=c[3],p=We(i.shape,3),v=p[1],m=p[2],g=new Float32Array(l*f*h*d),y=t.data.get(i.dataId).values,b=[o&&v>1?f-1:f,o&&m>1?h-1:h],w=[o&&v>1?v-1:v,o&&m>1?m-1:m],x=b[0]/w[0],N=b[1]/w[1],T=1/x,E=1/N,C=Math.ceil(T)*2+2,F=Math.ceil(E)*2+2,D=0;D<l;D++)for(var O=D*s[0],L=0;L<f;L++)for(var z=O+L*s[1],$=Math.floor(L*T),B=Math.floor($-C/2),W=0;W<h;W++)for(var X=z+W*s[2],Z=Math.floor(W*E),V=Math.floor(Z-F/2),j=0;j<d;j++){for(var re=0,ne=0;ne<C;ne++){var oe=ne+B;if(!(oe<0||oe>=v)){var le=O+oe*u[1],pe=oe*x,xe=Math.min(f-1,o?Math.round(pe):Math.floor(pe));if(L===xe)for(var he=0;he<F;he++){var ye=he+V;if(!(ye<0||ye>=m)){var we=le+ye*u[2],Ae=ye*N,Ye=Math.min(h-1,o?Math.round(Ae):Math.floor(Ae));W===Ye&&(re+=y[we+j])}}}}g[X+j]=re}return t.makeTensorInfo(a.shape,a.dtype,g)}var m4e={kernelName:S.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:v4e};function g4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dims;Ge(a,"reverse");var o=a.shape.length,s=S.util.parseAxisParam(i,a.shape);if(o===0)return Mi({inputs:{x:a},backend:t});for(var u=new S.TensorBuffer(a.shape,a.dtype),c=t.bufferSync(a),l=function(h){var d=u.indexToLoc(h),p=d.slice();s.forEach(function(v){return p[v]=a.shape[v]-1-p[v]}),u.set.apply(u,ya([c.get.apply(c,ya([],We(p),!1))],We(d),!1))},f=0;f<u.size;f++)l(f);return t.makeTensorInfo(u.shape,u.dtype,u.values)}var y4e={kernelName:S.Reverse,backendName:"cpu",kernelFunc:g4e},b4e={kernelName:S.RotateWithOffset,backendName:"cpu",kernelFunc:function(n){for(var e=n.inputs,t=n.attrs,r=n.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=r,c=S.util.getTypedArrayFromDType(a.dtype,S.util.sizeFromShape(a.shape)),l=We(a.shape,4),f=l[0],h=l[1],d=l[2],p=l[3],v=We(S.backend_util.getImageCenter(s,h,d),2),m=v[0],g=v[1],y=255,b=Math.sin(i),w=Math.cos(i),x=u.data.get(a.dataId).values,N=0;N<f;N++)for(var T=N*d*h*p,E=0;E<h;E++)for(var C=E*(d*p),F=0;F<d;F++)for(var D=F*p,O=0;O<p;O++){var L=[f,E,F,O],z=L[2],$=L[1],B=(z-m)*w-($-g)*b,W=(z-m)*b+($-g)*w;B=Math.round(B+m),W=Math.round(W+g);var X=o;if(typeof o!="number"&&(O===3?X=y:X=o[O]),B>=0&&B<d&&W>=0&&W<h){var Z=W*(d*p),V=B*p,j=T+Z+V+O;X=x[j]}var re=T+C+D+O;c[re]=X}var ne=u.write(c,a.shape,a.dtype);return{dataId:ne,shape:a.shape,dtype:a.dtype}}};var w4e=Mt(S.Round,function(n){var e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),x4e={kernelName:S.Round,backendName:"cpu",kernelFunc:w4e};function k4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=e.updates,o=r.shape,s=S.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,d=!0,p=t.bufferSync(a),v=t.bufferSync(i),m=Oc(p,v,o,h,l,c,u,f,0,d);return t.makeTensorInfo(o,m.dtype,m.values)}var S4e={kernelName:S.ScatterNd,backendName:"cpu",kernelFunc:k4e};function N4e(n,e){for(var t=0,r=n.length,a=0;t<r;)a=Math.floor((t+r)/2),n[a]<e?t=a+1:r=a;return r}function T4e(n,e){for(var t=0,r=n.length,a=0;t<r;)a=Math.floor((t+r)/2),n[a]<=e?t=a+1:r=a;return r}function E4e(n,e,t,r,a,i){for(var o=S.util.getArrayFromDType("int32",t*a),s=0;s<t;++s)for(var u=n.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]=i==="left"?N4e(u,e[l+c]):T4e(u,e[l+c]);return o}function I4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sortedSequence,i=e.values,o=r.side,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=E4e(s,u,a.shape[0],a.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",c)}var C4e={kernelName:S.SearchSorted,backendName:"cpu",kernelFunc:I4e};function A4e(n){var e=n.inputs,t=n.backend,r=e.condition,a=e.t,i=e.e;Ge([r,a,i],"select");for(var o=r.shape.length,s=t.data.get(r.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=S.upcastType(a.dtype,i.dtype),f=S.util.makeZerosTypedArray(S.util.sizeFromShape(a.shape),l),h=0,d=o===0||o>1||a.shape.length===1?1:S.util.sizeFromShape(a.shape.slice(1)),p=0;p<s.length;p++)for(var v=0;v<d;v++)s[p]===1?f[h++]=u[p]:f[h++]=c[p];return t.makeTensorInfo(a.shape,l,f)}var _4e={kernelName:S.Select,backendName:"cpu",kernelFunc:A4e};var D4e=S.backend_util.SELU_SCALEALPHA,F4e=S.backend_util.SELU_SCALE,R4e=Mt(S.Selu,function(n){return n>=0?F4e*n:D4e*(Math.exp(n)-1)}),O4e={kernelName:S.Selu,backendName:"cpu",kernelFunc:R4e};var P4e=Mt(S.Sign,function(n){return n<0?-1:n>0?1:0}),M4e={kernelName:S.Sign,backendName:"cpu",kernelFunc:P4e};var B4e=Mt(S.Sin,function(n){return Math.sin(n)}),L4e={kernelName:S.Sin,backendName:"cpu",kernelFunc:B4e};var z4e=Mt(S.Sinh,function(n){return Math.sinh(n)}),$4e={kernelName:S.Sinh,backendName:"cpu",kernelFunc:z4e};var q4e=11920928955078125e-23,OL=Math.log(q4e)+2,W4e=Mt(S.Softplus,function(n){var e=n>-OL,t=n<OL,r=Math.exp(n),a;return t?a=r:e?a=n:a=Math.log(1+r),a}),V4e={kernelName:S.Softplus,backendName:"cpu",kernelFunc:W4e};function G4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.paddings;Ge([a],"spaceToBatchND");var s=S.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,ya([],We(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=Gz.kernelFunc({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),f=S.backend_util.getReshaped(l.shape,i,s,!1),h=S.backend_util.getPermuted(f.length,i.length,!1),d=S.backend_util.getReshapedPermuted(l.shape,i,s,!1),p={x:l},v={shape:f},m=qt({inputs:p,backend:t,attrs:v}),g={x:m},y={perm:h},b=Or({inputs:g,backend:t,attrs:y}),w={x:b},x={shape:d},N=qt({inputs:w,backend:t,attrs:x});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(b),N}var U4e={kernelName:S.SpaceToBatchND,backendName:"cpu",kernelFunc:G4e};function H4e(n){var e=n.inputs,t=n.backend,r=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        `.concat(i.shape));if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        `.concat(r.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.data.get(r.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],f=We(gz(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=f[0],d=f[1],p=f[2],v=f[3],m=f[4];return[t.makeTensorInfo(d,r.dtype,h),t.makeTensorInfo([d[0]],a.dtype,p),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(function(g){return Number(g)}))),t.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var K4e={kernelName:S.SparseFillEmptyRows,backendName:"cpu",kernelFunc:H4e};function j4e(n){var e=n.inputs,t=n.backend,r=e.inputIndices,a=e.inputShape,i=e.newShape;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        `.concat(r.shape));if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        `.concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.data.get(a.dataId).values),s=t.data.get(r.dataId).values,u=Array.from(t.data.get(i.dataId).values),c=We(yz(s,r.shape,r.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,r.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var X4e={kernelName:S.SparseReshape,backendName:"cpu",kernelFunc:j4e};function Y4e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(r.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(mx(o,r.shape,r.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var Z4e={kernelName:S.SparseSegmentMean,backendName:"cpu",kernelFunc:Y4e};function J4e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(r.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(mx(o,r.shape,r.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var Q4e={kernelName:S.SparseSegmentSum,backendName:"cpu",kernelFunc:J4e};function eBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=r.outputShape,u=S.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,d=u.outputSize,p=!1,v=t.bufferSync(a),m;switch(i.dtype){case"bool":{var g=t.bufferSync(i),y=Boolean(t.data.get(o.dataId).values[0]);m=Oc(v,g,s,d,f,l,c,h,y,p);break}case"float32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];m=Oc(v,g,s,d,f,l,c,h,y,p);break}case"int32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];m=Oc(v,g,s,d,f,l,c,h,y,p);break}case"string":{var g=t.bufferSync(i),y=S.util.decodeString(t.data.get(o.dataId).values[0]);m=Oc(v,g,s,d,f,l,c,h,y,p);break}default:throw new Error("Unsupported type ".concat(i.dtype))}return t.makeTensorInfo(s,m.dtype,m.values)}var tBe={kernelName:S.SparseToDense,backendName:"cpu",kernelFunc:eBe};function nBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.numOrSizeSplits,o=r.axis,s=S.util.parseAxisParam(o,a.shape)[0],u=S.backend_util.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map(function(f){var h=ya([],We(l),!1);h[s]=f;var d=lu({inputs:{x:a},backend:t,attrs:{begin:c,size:h}});return c[s]+=f,d})}var rBe={kernelName:S.SplitV,backendName:"cpu",kernelFunc:nBe};var aBe={kernelName:S.Square,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,a=t;Ge(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}var c=a.write(o,r.shape,r.dtype);return{dataId:c,shape:r.shape,dtype:r.dtype}}};var iBe=Mt(S.Step,function(n,e){var t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),oBe={kernelName:S.Step,backendName:"cpu",kernelFunc:iBe};function sBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,f=r.newAxisMask,h=r.shrinkAxisMask;Ge(a,"stridedSlice");var d=S.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),p=d.finalShapeSparse,v=d.finalShape,m=d.isIdentity,g=d.sliceDim0,y=d.isSimpleSlice,b=d.begin,w=d.end,x=d.strides,N;if(m)N=qt({inputs:{x:a},backend:t,attrs:{shape:v}});else if(g||y){S.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=S.slice_util.computeOutShape(b,w,x),E=lu({inputs:{x:a},backend:t,attrs:{begin:b,size:T}});N=qt({inputs:{x:E},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.bufferSync(a),F=wz(p,C,x,b);N=t.makeTensorInfo(v,F.dtype,F.values)}return N}var uBe={kernelName:S.StridedSlice,backendName:"cpu",kernelFunc:sBe};function cBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.data.get(l.dataId).values,d=t.data.get(f.dataId).values,p=We(xz(h,d,a,i,o,s,u,c),2),v=p[0],m=p[1];return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(f.shape,"int32",m)]}var lBe={kernelName:S.StringNGrams,backendName:"cpu",kernelFunc:cBe};function fBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],c=We(kz(s,u,a),3),l=c[0],f=c[1],h=c[2],d=f.length;return[t.makeTensorInfo([d,2],"int32",l),t.makeTensorInfo([d],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var hBe={kernelName:S.StringSplit,backendName:"cpu",kernelFunc:fBe};function dBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.data.get(i.dataId).values,s=Sz(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var pBe={kernelName:S.StringToHashBucketFast,backendName:"cpu",kernelFunc:dBe};var vBe=Mt(S.Tan,function(n){return Math.tan(n)}),mBe={kernelName:S.Tan,backendName:"cpu",kernelFunc:vBe};var gBe=Mt(S.Tanh,function(n){return Math.tanh(n)}),yBe={kernelName:S.Tanh,backendName:"cpu",kernelFunc:gBe};function bBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reps;Ge(a,"tile");var o=Tz(t.bufferSync(a),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}var wBe={kernelName:S.Tile,backendName:"cpu",kernelFunc:bBe};function xBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.k,o=r.sorted;Ge(a,"topk");var s=t.data.get(a.dataId).values,u=We(Iz(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}var kBe={kernelName:S.TopK,backendName:"cpu",kernelFunc:xBe};function SBe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.image,i=e.transforms,o=t.interpolation,s=t.fillMode,u=t.fillValue,c=t.outputShape,l=We(a.shape,4),f=l[0],h=l[1],d=l[2],p=l[3],v=We(c??[h,d],2),m=v[0],g=v[1],y=[f,m,g,p],b=S.util.computeStrides(a.shape),w=b[0],x=b[1],N=b[2],T=S.util.computeStrides(y),E=T[0],C=T[1],F=T[2],D=S.util.getTypedArrayFromDType(a.dtype,S.util.sizeFromShape(y));D.fill(u);for(var O=r.data.get(a.dataId).values,L=r.data.get(i.dataId).values,z=0;z<f;++z){for(var $=i.shape[0]===1?L:L.subarray(z*8,z*8+8),B=0;B<m;++B)for(var W=0;W<g;++W)for(var X=0;X<p;++X){var Z=void 0,V=$[6]*W+$[7]*B+1;if(V!==0){var j=($[0]*W+$[1]*B+$[2])/V,re=($[3]*W+$[4]*B+$[5])/V,ne=PL(j,d,s),oe=PL(re,h,s);switch(o){case"nearest":Z=ABe(O,h,d,w,x,N,z,oe,ne,X,u);break;case"bilinear":Z=_Be(O,h,d,w,x,N,z,oe,ne,X,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}var le=z*E+B*C+W*F+X;D[le]=Z}}return r.makeTensorInfo(y,a.dtype,D)}var pe=r.write(D,y,a.dtype);return{dataId:pe,shape:a.shape,dtype:a.dtype}}var NBe={kernelName:S.Transform,backendName:"cpu",kernelFunc:SBe};function PL(n,e,t){switch(t){case"reflect":return TBe(n,e);case"wrap":return EBe(n,e);case"nearest":return CBe(n,e);case"constant":default:return IBe(n)}}function TBe(n,e){var t=n;if(t<0)if(e<=1)t=0;else{var r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{var r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return S.util.clamp(0,t,e-1)}function EBe(n,e){var t=n;if(t<0)if(e<=1)t=0;else{var r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{var r=e-1;t-=e*Math.trunc(t/r)}return S.util.clamp(0,t,e-1)}function IBe(n,e){return n}function CBe(n,e){return S.util.clamp(0,n,e-1)}function rh(n,e,t,r,a,i,o,s,u,c,l){var f=o*r+s*a+u*i+c;return 0<=s&&s<e&&0<=u&&u<t?n[f]:l}function ABe(n,e,t,r,a,i,o,s,u,c,l){var f=Math.round(s),h=Math.round(u);return rh(n,e,t,r,a,i,o,f,h,c,l)}function _Be(n,e,t,r,a,i,o,s,u,c,l){var f=Math.floor(s),h=Math.floor(u),d=f+1,p=h+1,v=(p-u)*rh(n,e,t,r,a,i,o,f,h,c,l)+(u-h)*rh(n,e,t,r,a,i,o,f,p,c,l),m=(p-u)*rh(n,e,t,r,a,i,o,d,h,c,l)+(u-h)*rh(n,e,t,r,a,i,o,d,p,c,l);return(d-s)*v+(s-f)*m}function DBe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=t.axis,i=e.x;Ge(i,"unique");var o=r.data.get(i.dataId).values,s=Cz(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}var FBe={kernelName:S.Unique,backendName:"cpu",kernelFunc:DBe};function RBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var f=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var d=new Array(s),l=0;l<d.length;l++){f[i]=l;var p=lu({inputs:{x:a},backend:t,attrs:{begin:f,size:h}});d[l]=qt({inputs:{x:p},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(p)}return d}var OBe={kernelName:S.Unpack,backendName:"cpu",kernelFunc:RBe};function PBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.segmentIds,o=r.numSegments;Ge(a,"unsortedSegmentSum");for(var s=a.shape.length,u=i.shape.length,c=[],l=[],f=s-u,h=i,d=0;d<f;++d){var p=jv({inputs:{input:h},backend:t,attrs:{dim:d+1}});h=p,l.push(p)}for(var d=0;d<o;++d){var v=S.util.createScalarValue(d,"int32"),m=t.makeTensorInfo([],"int32",v),g=UL({inputs:{a:m,b:h},backend:t}),y=Zo({inputs:{x:g},backend:t,attrs:{dtype:"float32"}}),b=Yv({inputs:{a:y,b:a},backend:t}),w=ah({inputs:{x:b},backend:t,attrs:{axis:0,keepDims:!1}});c.push(w),l.push(m),l.push(g),l.push(y),l.push(b),l.push(w)}var x=Vz({inputs:c,backend:t,attrs:{axis:0}});return l.forEach(function(N){return t.disposeIntermediateTensorInfo(N)}),x}var MBe={kernelName:S.UnsortedSegmentSum,backendName:"cpu",kernelFunc:PBe},sx,ML,BBe=[FRe,mFe,ORe,MRe,kFe,LRe,$Re,WRe,GRe,HRe,jRe,YRe,JRe,tOe,rOe,oOe,uOe,lOe,hOe,_Re,pOe,mOe,yOe,wOe,wFe,NFe,kOe,gFe,NOe,EOe,IOe,AOe,DOe,ROe,POe,BOe,zOe,qOe,VOe,UOe,KOe,XOe,ZOe,JOe,ePe,nPe,aPe,iPe,oPe,sPe,lPe,SRe,hPe,TFe,wPe,EFe,xPe,CFe,IPe,CPe,_Pe,_Fe,RPe,PPe,BPe,zPe,qPe,FFe,OFe,yFe,VPe,TOe,UPe,KPe,XPe,NRe,MFe,LFe,ZPe,$Fe,QPe,nMe,aMe,sMe,cMe,fMe,hMe,WFe,pMe,mMe,yMe,wMe,kMe,NMe,EMe,GFe,CMe,DMe,OMe,HFe,jFe,BMe,$Me,VMe,YFe,UMe,KMe,jMe,Gz,JMe,ERe,QFe,e4e,n4e,a4e,o4e,bFe,cx,u4e,IRe,CRe,ARe,l4e,h4e,p4e,m4e,y4e,b4e,x4e,uRe,S4e,C4e,_4e,O4e,lRe,M4e,L4e,$4e,fRe,FMe,V4e,U4e,K4e,X4e,Z4e,Q4e,tBe,rBe,pRe,aBe,mRe,oBe,uBe,lBe,hBe,pBe,wRe,uPe,mBe,yBe,wBe,kBe,NBe,ZFe,FBe,OBe,MBe,HMe];try{for(th=Pc(BBe),Rc=th.next();!Rc.done;Rc=th.next())BL=Rc.value,S.registerKernel(BL)}catch(n){sx={error:n}}finally{try{Rc&&!Rc.done&&(ML=th.return)&&ML.call(th)}finally{if(sx)throw sx.error}}var BL,th,Rc;ih.MathBackendCPU=fx;ih.shared=xRe;ih.version_cpu=kRe});var Jq=Y(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});var k=As();function LBe(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}var zBe=LBe(k),Sx=function(n,e){return Sx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},Sx(n,e)};function $Be(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Sx(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Wc(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Vc(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function ra(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function dn(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var hu={},Zv={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function k$(n,e){hu[n]=e}function ki(n,e){if(!(n in hu)||e!=null){var t=WBe(n,e);if(t!==null)hu[n]=t;else return console.log("Could not get context for WebGL version",n),null}var r=hu[n];return r==null||r.isContextLost()?(delete hu[n],ki(n)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),hu[n])}function qBe(n){if(typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function WBe(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=e??qBe(n);return t.addEventListener("webglcontextlost",function(r){r.preventDefault(),delete hu[n]},!1),k.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(Zv.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Zv)||t.getContext("experimental-webgl",Zv):t.getContext("webgl2",Zv)}var hh;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(hh||(hh={}));var ba;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ba||(ba={}));var ir;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ir||(ir={}));function gh(n,e){return[e,n]}function VBe(n,e){return n*e}function Jv(n){var e=k.util.sizeFromShape(n),t=Math.ceil(e/4);return k.util.sizeToSquarishShape(t)}function Uc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function GBe(n,e){var t=Te(Uc(n,e),2),r=t[0],a=t[1];return r*a*4}function Dx(n,e){var t=n,r,a,i,o,s,u,c,l,f,h;return k.env().getNumber("WEBGL_VERSION")===2?(r=t.R32F,a=t.R16F,i=t.RGBA16F,o=t.RGBA32F,s=t.RED,c=4,l=1,f=t.HALF_FLOAT,h=t.FLOAT,u=t.RGBA8):(r=n.RGBA,a=n.RGBA,i=n.RGBA,o=t.RGBA,s=n.RGBA,c=4,l=4,f=e!=null?e.HALF_FLOAT_OES:null,h=n.FLOAT,u=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:h}}function Oe(n,e){var t=e();return k.env().getBool("DEBUG")&&UBe(n),t}function UBe(n){var e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+N$(n,e))}var HBe=596e-10,KBe=65504;function S$(n){return!!(k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||HBe<Math.abs(n)&&Math.abs(n)<KBe)}function N$(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(e)}}function sh(n,e){return co(n,function(){return n.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function T$(n,e){var t=co(n,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Oe(n,function(){return n.shaderSource(t,e)}),Oe(n,function(){return n.compileShader(t)}),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function E$(n,e){var t=co(n,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Oe(n,function(){return n.shaderSource(t,e)}),Oe(n,function(){return n.compileShader(t)}),k.env().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw Fx(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var jBe=/ERROR: [0-9]+:([0-9]+):/g;function Fx(n,e){var t=jBe.exec(e);if(t==null){console.log("Couldn't parse line number in error: ".concat(e)),console.log(n);return}for(var r=+t[1],a=n.split(`
`),i=a.length.toString().length+2,o=a.map(function(h,d){return k.util.rightPad((d+1).toString(),i)+h}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),f=o.slice(r);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c ".concat(k.util.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function I$(n){return co(n,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function C$(n,e){if(Oe(n,function(){return n.linkProgram(e)}),!k.env().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function nm(n,e){if(Oe(n,function(){return n.validateProgram(e)}),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function A$(n,e){var t=co(n,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,t)}),Oe(n,function(){return n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}),t}function _$(n,e){var t=co(n,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Oe(n,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)}),Oe(n,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}),t}function XBe(){return k.env().getNumber("WEBGL_VERSION")===2?1:4}function D$(n){return co(n,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function F$(n,e){var t=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="[".concat(n,"x").concat(e,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){var r="[".concat(n,"x").concat(e,"]"),a="[".concat(t,"x").concat(t,"]");throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+a+".")}}function R$(n){return co(n,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Nx(n,e,t,r,a,i,o){var s=n.getAttribLocation(e,t);return s===-1?!1:(Oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Oe(n,function(){return n.vertexAttribPointer(s,a,n.FLOAT,!1,i,o)}),Oe(n,function(){return n.enableVertexAttribArray(s)}),!0)}function O$(n,e,t){z$(n,t),Oe(n,function(){return n.activeTexture(n.TEXTURE0+t)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,e)})}function YBe(n,e){z$(n,e),Oe(n,function(){return n.activeTexture(n.TEXTURE0+e)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function P$(n,e,t){return co(n,function(){return n.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function M$(n,e,t){return n.getUniformLocation(e,t)}function B$(n,e,t,r){Oe(n,function(){return O$(n,e,r)}),Oe(n,function(){return n.uniform1i(t,r)})}function ZBe(n){Oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),Oe(n,function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)}),Oe(n,function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)})}function rm(n,e,t){Oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),Oe(n,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)})}function Tx(n,e){Oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)}),Oe(n,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function uh(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+L$(n,e))}function L$(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(e)}}function co(n,e,t){var r=Oe(n,function(){return e()});if(r==null)throw new Error(t);return r}function z$(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){var a="[gl.TEXTURE0, gl.TEXTURE".concat(t,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function du(n,e){return e===void 0&&(e=2),k.util.sizeFromShape(n.slice(0,n.length-e))}function pu(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function ch(n){var e=[1,1,1],t=n.length===0||n.length===1&&n[0]===1;return t||(e=dn([du(n)],Te(pu(n)),!1)),e}function $$(n,e){var t;e===void 0&&(e=!1);var r=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=k.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(a===1/0&&k.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=r/2),e&&(r=r*2,a=a*2,n=n.map(function(h,d){return d>=n.length-2?k.util.nearestLargerEven(n[d]):n[d]}),n.length===1&&(n=[2,n[0]])),n.length!==2){var i=k.util.squeezeShape(n);n=i.newShape}var o=k.util.sizeFromShape(n),s=null;n.length<=1&&o<=r?s=[1,o]:n.length===2&&n[0]<=r&&n[1]<=r?s=n:n.length===3&&n[0]*n[1]<=r&&n[2]<=r?s=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=r&&n[1]*n[2]<=r?s=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r?s=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r&&(s=[n[0],n[1]*n[2]*n[3]]);var u=s!=null&&Math.max.apply(Math,dn([],Te(s),!1))>a&&Math.min.apply(Math,dn([],Te(s),!1))<=(e?2:1)&&Math.min.apply(Math,dn([],Te(s),!1))>0;if(s==null||u)if(e){var c=du(n),l=2,f=2;n.length&&(t=Te(pu(n),2),l=t[0],f=t[1]),o=c*(l/2)*(f/2),s=k.util.sizeToSquarishShape(o).map(function(h){return h*2})}else s=k.util.sizeToSquarishShape(o);return s}function Qv(n){return n%2===0}function dh(n,e){if(n=n.slice(-2),e=e.slice(-2),k.util.arraysEqual(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Qv(t)&&Qv(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Qv(n[0])&&Qv(e[0])}var am,im;function q$(n){if(am==null){var e=ki(n);am=e.getParameter(e.MAX_TEXTURE_SIZE)}return am}function JBe(){am=null}function QBe(){im=null}function W$(n){if(im==null){var e=ki(n);im=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,im)}function V$(n){if(n===0)return 0;var e,t=ki(n);return wa(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:wa(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function wa(n,e){var t=n.getExtension(e);return t!=null}function Ex(n){try{var e=ki(n);if(e!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function G$(n){if(n===0)return!1;var e=ki(n);if(n===1){if(!wa(e,"OES_texture_float"))return!1}else if(!wa(e,"EXT_color_buffer_float"))return!1;var t=Ix(e);return t}function U$(n){if(n===0)return!1;var e=ki(n);if(n===1){if(!wa(e,"OES_texture_float")||!wa(e,"WEBGL_color_buffer_float"))return!1}else{if(wa(e,"EXT_color_buffer_float"))return Ix(e);var t="EXT_color_buffer_half_float";if(wa(e,t)){var r=e.getExtension(t);return eLe(e,r)}return!1}var a=Ix(e);return a}function Ix(n){var e=Dx(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);var r=1,a=1;n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,r,a,0,e.textureFormatFloat,e.textureTypeFloat,null);var i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function eLe(n,e){var t=Dx(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r);var a=1,i=1;n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,a,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);var s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(o),s}function H$(n){if(n!==2)return!1;var e=ki(n),t=e.fenceSync!=null;return t}function Hc(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&k.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors ")+"in the WebGL backend."})})}var tLe={__proto__:null,callAndCheck:Oe,canBeRepresented:S$,getWebGLErrorMessage:N$,getExtensionOrThrow:sh,createVertexShader:T$,createFragmentShader:E$,logShaderSourceAndInfoLog:Fx,createProgram:I$,linkProgram:C$,validateProgram:nm,createStaticVertexBuffer:A$,createStaticIndexBuffer:_$,getNumChannels:XBe,createTexture:D$,validateTextureSize:F$,createFramebuffer:R$,bindVertexBufferToProgramAttribute:Nx,bindTextureUnit:O$,unbindTextureUnit:YBe,getProgramUniformLocationOrThrow:P$,getProgramUniformLocation:M$,bindTextureToProgramUniformSampler:B$,bindCanvasToFramebuffer:ZBe,bindColorTextureToFramebuffer:rm,unbindColorTextureFromFramebuffer:Tx,validateFramebuffer:uh,getFramebufferErrorMessage:L$,getBatchDim:du,getRowsCols:pu,getShapeAs3D:ch,getTextureShapeFromLogicalShape:$$,isReshapeFree:dh,getWebGLMaxTextureSize:q$,resetMaxTextureSize:JBe,resetMaxTexturesInShader:QBe,getMaxTexturesInShader:W$,getWebGLDisjointQueryTimerVersion:V$,hasExtension:wa,isWebGLVersionEnabled:Ex,isCapableOfRenderingToFloatTexture:G$,isDownloadFloatTextureEnabled:U$,isWebGLFenceEnabled:H$,assertNotComplex:Hc};var Ke=k.env();Ke.registerFlag("HAS_WEBGL",function(){return Ke.getNumber("WEBGL_VERSION")>0});Ke.registerFlag("WEBGL_VERSION",function(){return Ex(2)?2:Ex(1)?1:0});Ke.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1});Ke.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ke.get("WEBGL_VERSION")===2});Ke.registerFlag("WEBGL_CPU_FORWARD",function(){return!0});Ke.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1});Ke.registerFlag("WEBGL_PACK",function(){return Ke.getBool("HAS_WEBGL")});Ke.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_CLIP",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_REDUCE",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_CONV_IM2COL",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return q$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return W$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=Ke.getNumber("WEBGL_VERSION");return n===0?0:V$(n)});Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ke.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!k.device_util.isMobile()});Ke.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return G$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return Ke.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ke.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")});Ke.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return U$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return H$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){var n=Ke.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return n?4:0});Ke.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(n){if(n<0&&n!==-1)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(n,"."))});Ke.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return k.device_util.isMobile()?1:-1},function(n){if(n<0&&n!==-1)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(n,"."))});Ke.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",function(){return 128});Ke.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",function(){return!1});Ke.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",function(){return 1e5});Ke.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",function(){return 128});Ke.registerFlag("WEBGL_EXP_CONV",function(){return!1});Ke.registerFlag("SOFTWARE_WEBGL_ENABLED",function(){return Ke.getBool("IS_TEST")});Ke.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",function(){return 1/0});Ke.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",function(){return!1});Ke.registerFlag("WEBGL2_ISNAN_CUSTOM",function(){return!1});Ke.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});function xr(){var n,e,t,r,a,i,o,s,u,c;return k.env().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=k.env().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function vu(n,e,t){t===void 0&&(t="index");var r=k.util.computeStrides(e);return r.map(function(a,i){var o="int ".concat(n[i]," = ").concat(t," / ").concat(a),s=i===r.length-1?"int ".concat(n[i+1]," = ").concat(t," - ").concat(n[i]," * ").concat(a):"index -= ".concat(n[i]," * ").concat(a);return"".concat(o,"; ").concat(s,";")}).join("")}function fm(n,e,t){t===void 0&&(t="index");var r=k.util.computeStrides(e);return r.map(function(a,i){var o="int ".concat(n[i]," = ").concat(t," / outShapeStrides[").concat(i,"]"),s=i===r.length-1?"int ".concat(n[i+1]," = ").concat(t," - ").concat(n[i]," * outShapeStrides[").concat(i,"]"):"index -= ".concat(n[i]," * outShapeStrides[").concat(i,"]");return"".concat(o,"; ").concat(s,";")}).join("")}function nLe(n,e){var t=n.length,r=n.map(function(o){return"".concat(e,"[").concat(o,"]")}),a=new Array(t-1);a[t-2]=r[t-1];for(var i=t-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}function rLe(n,e,t){t===void 0&&(t="index");var r=n.map(function(i,o){return o}),a=nLe(r,e);return a.map(function(i,o){var s="int ".concat(n[o]," = ").concat(t," / ").concat(a[o]),u=o===a.length-1?"int ".concat(n[o+1]," = ").concat(t," - ").concat(n[o]," * ").concat(a[o]):"index -= ".concat(n[o]," * ").concat(a[o]);return"".concat(s,"; ").concat(u,";")}).join("")}function Rx(n){var e=k.util.computeStrides(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `.concat(e[0]," + coords.y * ").concat(e[1],` + coords.z;
  }
`)}function Ox(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var K$=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,j$=k.backend_util.getBroadcastDims;function aLe(n,e,t){var r=[];if(n.forEach(function(d){var p=k.util.sizeFromShape(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?r.push("uniform float ".concat(d.name).concat(p>1?"[".concat(p,"]"):"",";")):(r.push("uniform sampler2D ".concat(d.name,";")),r.push("uniform int offset".concat(d.name,";"))),t.enableShapeUniforms){var v=Px(t.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape).uniformShape;switch(v.length){case 1:r.push("uniform int ".concat(d.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(d.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(d.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(d.name,"Shape;"));break}r.push("uniform ivec2 ".concat(d.name,"TexShape;"))}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(function(d){r.push("uniform ".concat(d.type," ").concat(d.name).concat(d.arrayIndex?"[".concat(d.arrayIndex,"]"):"",";"))});var a=r.join(`
`),i=n.map(function(d){return iLe(d,e,t.packedInputs,t.enableShapeUniforms)}).join(`
`),o=e.texShape,s=xr(),u=uLe(s),c,l,f=fLe(s);e.isPacked?(c=oLe(e.logicalShape,o,t.enableShapeUniforms),l=lLe(s)):(c=sLe(e.logicalShape,o,t.enableShapeUniforms),l=cLe(s)),t.packedInputs&&(f+=vLe);var h=[f,u,l,a,c,i,t.userCode].join(`
`);return h}function Kc(n,e){e===void 0&&(e=!1);var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return ILe(n,e);case 1:return ALe(n,e);case 2:return DLe(n,e);case 3:return RLe(n,e);case 4:return PLe(n,e);case 5:return MLe(n);case 6:return BLe(n);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function X$(n,e){var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return ELe(n);case 1:return CLe(n,e);case 2:return _Le(n,e);case 3:return FLe(n,e);default:return OLe(n,e)}}function iLe(n,e,t,r){t===void 0&&(t=!1);var a="";t?a+=X$(n,r):a+=Kc(n,r);var i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?a+=LLe(n,e):a+=zLe(n,e)),a}function oLe(n,e,t){switch(n.length){case 0:return Y$();case 1:return mLe(n,e,t);case 2:return NLe(n,e,t);case 3:return yLe(n,e,t);default:return wLe(n,e,t)}}function sLe(n,e,t){switch(n.length){case 0:return Y$();case 1:return gLe(n,e,t);case 2:return TLe(n,e,t);case 3:return bLe(n,e,t);case 4:return xLe(n,e,t);case 5:return kLe(n,e);case 6:return SLe(n,e);default:throw new Error("".concat(n.length,"-D output sampling is not yet supported"))}}function uLe(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `.concat(n.texture2D,`(textureSampler, uv).r;
    }
  `)}function cLe(n){return`
    void setOutput(float val) {
      `.concat(n.output,` = vec4(val, 0, 0, 0);
    }
  `)}function lLe(n){return`
    void setOutput(vec4 val) {
      `.concat(n.output,` = val;
    }
  `)}function fLe(n){var e="".concat(n.version,`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `).concat(n.varyingFs,` vec2 resultUV;
    `).concat(n.defineOutput,`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `).concat(n.defineSpecialNaN,`
    `).concat(n.defineSpecialInf,`
    `).concat(n.defineRound,`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `).concat(hLe,`
    `).concat(dLe,`
    `).concat(pLe,`
  `);return e}var hLe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,dLe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,pLe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,vLe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Y$(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function mLe(n,e,t){var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `.concat(r[1],`.0);
      }
    `):r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `.concat(r[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(r[0],", ").concat(r[1],`));
      return 2 * (resTexRC.x * `).concat(r[1],` + resTexRC.y);
    }
  `)}function gLe(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * `.concat(e[1],`.0);
      }
    `):e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * `.concat(e[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      return resTexRC.x * `).concat(e[1],` + resTexRC.y;
    }
  `)}function yLe(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(n[2]/2),i=a*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(r[0],", ").concat(r[1],`));
      int index = resTexRC.x * `).concat(r[1],` + resTexRC.y;

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec3(b, r, c);
    }
  `)}function bLe(n,e,t){if(t){var r=fm(["r","c","d"],n);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    `.concat(r,`
    return ivec3(r, c, d);
  }
`)}var a=vu(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec3(r, c, d);
    }
  `)}function wLe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;for(var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(n[n.length-1]/2),i=a*Math.ceil(n[n.length-2]/2),o=i,s="",u="b, r, c",c=2;c<n.length-1;c++)o*=n[n.length-c-1],s=`
      int b`.concat(c," = index / ").concat(o,`;
      index -= b`).concat(c," * ").concat(o,`;
    `)+s,u="b".concat(c,", ")+u;return`
    ivec`.concat(n.length,` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`).concat(r[0],", ").concat(r[1],`));
      int index = resTexRC.x * `).concat(r[1],` + resTexRC.y;

      `).concat(s,`

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec`).concat(n.length,"(").concat(u,`);
    }
  `)}function xLe(n,e,t){if(t){var r=fm(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      `.concat(r,`
      return ivec4(r, c, d, d2);
    }
  `)}var a=vu(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec4(r, c, d, d2);
    }
  `)}function kLe(n,e){var t=vu(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`.concat(e[0],`,
                             `).concat(e[1],`));

      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `)}function SLe(n,e){var t=vu(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `)}function NLe(n,e,t){var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(k.util.arraysEqual(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`.concat(r[0],", ").concat(r[1],`));
      }
    `);var a=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(r[0],", ").concat(r[1],`));

      int index = resTexRC.x * `).concat(r[1],` + resTexRC.y;
      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec2(r, c);
    }
  `)}function TLe(n,e,t){return k.util.arraysEqual(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`.concat(e[0],", ").concat(e[1],`));
      }
    `):n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(index, 0);
      }
    `):n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(0, index);
      }
    `):t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      int r = index / `).concat(n[1],`;
      int c = index - r * `).concat(n[1],`;
      return ivec2(r, c);
    }
  `)}function mu(n){return"offset".concat(n)}function ELe(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=xr();return`
    vec4 `.concat(t,`() {
      return `).concat(r.texture2D,"(").concat(e,`, halfCR);
    }
  `)}function ILe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(t,";}");var a=Te(n.shapeInfo.texShape,2),i=a[0],o=a[1];if(i===1&&o===1)return`
      float `.concat(r,`() {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=mu(t);if(e)return`
    float `.concat(r,`() {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `);var u=Te(n.shapeInfo.texShape,2),c=u[0],l=u[1];return`
    float `.concat(r,`() {
      vec2 uv = uvFromFlat(`).concat(c,", ").concat(l,", ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function CLe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=n.shapeInfo.texShape,i=xr();if(e)return`
    vec4 `.concat(r,`(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `);var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `.concat(r,`(int index) {
      vec2 uv = packedUVfrom1D(
        `).concat(o[0],", ").concat(o[1],`, index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `)}function ALe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float `.concat(r,`(int index) {
        `).concat(jc(n),`
      }
    `);var a=n.shapeInfo.texShape,i=a[0],o=a[1];if(o===1&&i===1)return`
      float `.concat(r,`(int index) {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=mu(t);return o===1?e?`
      float `.concat(r,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[0]));
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(r,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / ").concat(i,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):i===1?e?`
      float `.concat(r,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(r,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / ").concat(o,`.0, 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):e?`
    float `.concat(r,`(int index) {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `):`
    float `.concat(r,`(int index) {
      vec2 uv = uvFromFlat(`).concat(i,", ").concat(o,", index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function _Le(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=i[0],s=i[1],u=xr();if(i!=null&&k.util.arraysEqual(t,i))return e?`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);

        return `).concat(u.texture2D,"(").concat(r,`, uv);
      }
    `):`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);

        return `).concat(u.texture2D,"(").concat(r,`, uv);
      }
    `);if(e)return`
    vec4 `.concat(a,`(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(r,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return `).concat(u.texture2D,"(").concat(r,`, uv);
    }
  `);var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int row, int col) {
      vec2 uv = packedUVfrom2D(`).concat(l,", ").concat(c[0],", ").concat(c[1],`, row, col);
      return `).concat(u.texture2D,"(").concat(r,`, uv);
    }
  `)}function DLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape;if(i!=null&&k.util.arraysEqual(t,i)){if(e)return`
      float `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `);var o=i[0],s=i[1];return`
    float `.concat(a,`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);
      return sampleTexture(`).concat(r,`, uv);
    }
  `)}var u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims,f=c;if(f.length<t.length){var h=Xc(n,f),d=["row","col"];return`
      `.concat(Kc(h,e),`
      float `).concat(a,`(int row, int col) {
        return `).concat(a,"(").concat(Yc(d,l),`);
      }
    `)}if(n.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`).concat(t[1],`, 1)));
        `).concat(jc(n),`
      }
    `);var p=i[0],v=i[1],m=mu(r);return v===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(r,`Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(`).concat(r,`TexShape[0]));
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `).concat(p,`.0);
      return sampleTexture(`).concat(r,`, uv);
    }
  `):p===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(r,`Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(`).concat(r,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `).concat(v,`.0, 0.5);
      return sampleTexture(`).concat(r,`, uv);
    }
  `):e?`
      float `.concat(a,`(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(r,"Shape[1] + col + ").concat(m,`;
        vec2 uv = uvFromFlat(`).concat(r,"TexShape[0], ").concat(r,`TexShape[1], index);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
  float `.concat(a,`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `).concat(t[1]," + col + ").concat(m,`;
    vec2 uv = uvFromFlat(`).concat(p,", ").concat(v,`, index);
    return sampleTexture(`).concat(r,`, uv);
  }
`)}function FLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){var s=t.slice(1),u=[1,2],c=Xc(n,s),l=["b","row","col"];return`
        `.concat(X$(c,e),`
        vec4 `).concat(a,`(int b, int row, int col) {
          return `).concat(a,"(").concat(Yc(l,u),`);
        }
      `)}var f=xr();if(e)return`
    vec4 `.concat(a,`(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(r,`Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(r,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return `).concat(f.texture2D,"(").concat(r,`, uv);
    }
  `);var h=o[0],d=o[1],p=Math.ceil(t[2]/2),v=p*Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `).concat(h,", ").concat(d,", ").concat(v,", ").concat(p,`, b, row, col);
      return `).concat(f.texture2D,"(").concat(r,`, uv);
    }
  `)}function RLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[1]*t[2],o=t[2],s=k.util.squeezeShape(t),u=s.newShape,c=s.keptDims,l=u;if(l.length<t.length){var f=Xc(n,l),h=["row","col","depth"];return`
        `.concat(Kc(f,e),`
        float `).concat(a,`(int row, int col, int depth) {
          return `).concat(a,"(").concat(Yc(h,c),`);
        }
      `)}if(n.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`).concat(i,", ").concat(o,`, 1)));
        `).concat(jc(n),`
      }
    `);var d=n.shapeInfo.texShape,p=d[0],v=d[1],m=n.shapeInfo.flatOffset;if(v===i&&m==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        int stride1 = `).concat(r,`Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
        float `.concat(a,`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`).concat(o,`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`).concat(v,".0, ").concat(p,`.0);
          return sampleTexture(`).concat(r,`, uv);
        }
      `);if(v===o&&m==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(`).concat(r,`Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`).concat(t[1],`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(v,".0, ").concat(p,`.0);
      return sampleTexture(`).concat(r,`, uv);
    }
  `);var g=mu(r);return e?`
    float `.concat(a,`(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = `).concat(r,"Shape[1] * ").concat(r,`Shape[2];
      int stride1 = `).concat(r,`Shape[2];
      int index = row * stride0 + col * stride1 + depth + `).concat(g,`;
      vec2 uv = uvFromFlat(`).concat(r,"TexShape[0], ").concat(r,`TexShape[1], index);
      return sampleTexture(`).concat(r,`, uv);
    }
    `):`
      float `.concat(a,`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(i," + col * ").concat(o," + depth + ").concat(g,`;
        vec2 uv = uvFromFlat(`).concat(p,", ").concat(v,`, index);
        return sampleTexture(`).concat(r,`, uv);
      }
  `)}function OLe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=xr();if(e)return`
    vec4 `.concat(r,`(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(`).concat(t,`Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(t,`Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= `).concat(t,`Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `);for(var i=n.shapeInfo.logicalShape,o=i.length,s=n.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],f=Math.ceil(i[o-1]/2),h=f*Math.ceil(i[o-2]/2),d="int b, int row, int col",p="b * ".concat(h," + (row / 2) * ").concat(f," + (col / 2)"),v=2;v<o-1;v++)d="int b".concat(v,", ")+d,h*=i[o-v-1],p="b".concat(v," * ").concat(h," + ")+p;return`
    vec4 `.concat(r,"(").concat(d,`) {
      int index = `).concat(p,`;
      int texR = index / `).concat(l,`;
      int texC = index - texR * `).concat(l,`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(l,", ").concat(c,`);
      return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `)}function PLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[3],o=t[2]*i,s=t[1]*o,u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var f=Xc(n,c),h=["row","col","depth","depth2"];return`
      `.concat(Kc(f,e),`
      float `).concat(a,`(int row, int col, int depth, int depth2) {
        return `).concat(a,"(").concat(Yc(h,l),`);
      }
    `)}if(n.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`).concat(s,", ").concat(o,", ").concat(i,`, 1)));
        `).concat(jc(n),`
      }
    `);var d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,v=p[0],m=p[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(m===s&&d==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        `).concat(g,`
        `).concat(y,`
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`).concat(o,", ").concat(i,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(r,`, uv);
      }
    `);if(m===i&&d==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,`Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(t[1]*t[2],", ").concat(t[2],`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(r,`, uv);
      }
    `);var w=mu(r);return e?`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      `).concat(g,`
      `).concat(y,`
      `).concat(b,`
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(`).concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(w,`);
      return sampleTexture(`).concat(r,`, uv);
    }
  `):`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o,` +
          depth * `).concat(i,` + depth2;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(m,", index + ").concat(w,`);
      return sampleTexture(`).concat(r,`, uv);
    }
  `)}function MLe(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=e[4],i=e[3]*a,o=e[2]*i,s=e[1]*o,u=k.util.squeezeShape(e),c=u.newShape,l=u.keptDims;if(c.length<e.length){var f=Xc(n,c),h=["row","col","depth","depth2","depth3"];return`
      `.concat(Kc(f),`
      float `).concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        return `).concat(r,"(").concat(Yc(h,l),`);
      }
    `)}if(n.shapeInfo.isUniform)return`
      float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(s,", ").concat(o,", ").concat(i,", ").concat(a,`)) +
          depth3;
        `).concat(jc(n),`
      }
    `);var d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,v=p[0],m=p[1];if(m===s&&d==null)return`
      float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`).concat(o,", ").concat(i,", ").concat(a,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(m===a&&d==null)return`
      float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3],`,
               `).concat(e[2]*e[3],", ").concat(e[3],`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var g=mu(t);return`
    float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o," + depth * ").concat(i,` +
          depth2 * `).concat(a," + depth3 + ").concat(g,`;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(m,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function BLe(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=k.util.squeezeShape(e),i=a.newShape,o=a.keptDims;if(i.length<e.length){var s=Xc(n,i),u=["row","col","depth","depth2","depth3","depth4"];return`
      `.concat(Kc(s),`
      float `).concat(r,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `).concat(r,"(").concat(Yc(u,o),`);
      }
    `)}var c=e[5],l=e[4]*c,f=e[3]*l,h=e[2]*f,d=e[1]*h;if(n.shapeInfo.isUniform)return`
      float `.concat(r,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(d,", ").concat(h,", ").concat(f,", ").concat(l,`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`).concat(c,`, 1)));
        `).concat(jc(n),`
      }
    `);var p=n.shapeInfo.flatOffset,v=n.shapeInfo.texShape,m=v[0],g=v[1];if(g===d&&p==null)return`
      float `.concat(r,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`).concat(h,", ").concat(f,", ").concat(l,", ").concat(c,`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(g,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(g===c&&p==null)return`
      float `.concat(r,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3]*e[4],`,
               `).concat(e[2]*e[3]*e[4],`,
               `).concat(e[3]*e[4],`,
               `).concat(e[4],`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(g,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var y=mu(t);return`
    float `.concat(r,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(d," + col * ").concat(h," + depth * ").concat(f,` +
          depth2 * `).concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,`;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(g,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function jc(n){var e=n.name,t=k.util.sizeFromShape(n.shapeInfo.logicalShape);return t<2?"return ".concat(e,";"):`
    for (int i = 0; i < `.concat(t,`; i++) {
      if (i == index) {
        return `).concat(e,`[i];
      }
    }
  `)}function LLe(n,e){var t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),a="get"+r+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,s=j$(n.shapeInfo.logicalShape,e.logicalShape),u=Wt(o),c=o-i,l,f=["x","y","z","w","u","v"];i===0?l="":o<2&&s.length>=1?l="coords = 0;":l=s.map(function(w){return"coords.".concat(f[w+c]," = 0;")}).join(`
`);var h="";o<2&&i>0?h="coords":h=n.shapeInfo.logicalShape.map(function(w,x){return"coords.".concat(f[x+c])}).join(", ");var d="return outputValue;",p=k.util.sizeFromShape(n.shapeInfo.logicalShape),v=p===1,m=k.util.sizeFromShape(e.logicalShape),g=m===1;if(i===1&&!v&&!g)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!g)o===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(s.length){var y=i-2,b=i-1;s.indexOf(y)>-1&&s.indexOf(b)>-1?d="return vec4(outputValue.x);":s.indexOf(y)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(b)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `.concat(a,`() {
      `).concat(u,` coords = getOutputCoords();
      `).concat(l,`
      vec4 outputValue = get`).concat(r,"(").concat(h,`);
      `).concat(d,`
    }
  `)}function zLe(n,e){var t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),a="get"+r+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,s=n.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!n.shapeInfo.isUniform&&s===u&&n.shapeInfo.flatOffset==null&&k.util.arraysEqual(o,i))return`
      float `.concat(a,`() {
        return sampleTexture(`).concat(t,`, resultUV);
      }
    `);var c=Wt(u),l=j$(n.shapeInfo.logicalShape,e.logicalShape),f=u-s,h,d=["x","y","z","w","u","v"];s===0?h="":u<2&&l.length>=1?h="coords = 0;":h=l.map(function(v){return"coords.".concat(d[v+f]," = 0;")}).join(`
`);var p="";return u<2&&s>0?p="coords":p=n.shapeInfo.logicalShape.map(function(v,m){return"coords.".concat(d[m+f])}).join(", "),`
    float `.concat(a,`() {
      `).concat(c,` coords = getOutputCoords();
      `).concat(h,`
      return get`).concat(r,"(").concat(p,`);
    }
  `)}function Wt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank ".concat(n," is not yet supported"))}function Px(n,e,t){var r=k.util.squeezeShape(e),a=r.newShape,i=r.keptDims,o=e.length,s=n&&o===3&&e[0]===1,u=s?e.slice(1):a,c=!n&&o>1&&!k.util.arraysEqual(e,t)&&a.length<o||s,l=c?u:e;return{useSqueezeShape:c,uniformShape:l,keptDims:i}}function Xc(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Yc(n,e){return e.map(function(t){return n[t]}).join(", ")}function $Le(n,e,t,r){var a=t.map(function(l,f){var h={logicalShape:l.shape,texShape:l.isUniform?null:l.texData.texShape,isUniform:l.isUniform,isPacked:l.isUniform?!1:l.texData.isPacked,flatOffset:null};return l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0&&(h.flatOffset=l.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:h}}),i=a.map(function(l){return l.shapeInfo}),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=aLe(a,o,e),u=E$(n.gl,s),c=n.createProgram(u);return k.env().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},Z$(n,e,c))}function Z$(n,e,t){var r={},a={},i={},o=[],s,u,c,l=null,f=null;f=n.getUniformLocation(t,"NAN",!1),k.env().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));for(var h=!1,d=0;d<e.variableNames.length;d++){var p=e.variableNames[d];r[p]=n.getUniformLocation(t,p,h),r["offset".concat(p)]=n.getUniformLocation(t,"offset".concat(p),h),e.enableShapeUniforms&&(a["".concat(p,"Shape")]=n.getUniformLocation(t,"".concat(p,"Shape"),h),i["".concat(p,"TexShape")]=n.getUniformLocation(t,"".concat(p,"TexShape"),h))}return e.enableShapeUniforms&&(s=n.getUniformLocation(t,"outShape",h),c=n.getUniformLocation(t,"outShapeStrides",h),u=n.getUniformLocation(t,"outTexShape",h)),e.customUniforms&&e.customUniforms.forEach(function(v,m){o[m]=n.getUniformLocation(t,v.name,h)}),{uniformLocations:r,customUniformLocations:o,infLoc:l,nanLoc:f,inShapesLocations:a,inTexShapesLocations:i,outShapeLocation:s,outShapeStridesLocation:c,outTexShapeLocation:u}}function Hz(n,e){if(n.length!==e.length)throw Error("Binary was compiled with ".concat(n.length," inputs, but ")+"was executed with ".concat(e.length," inputs"));n.forEach(function(t,r){var a=t.logicalShape,i=e[r],o=i.shape;if(!k.util.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!(t.isUniform&&i.isUniform)){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!k.util.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(u," must match"))}})}function qLe(n,e,t,r,a){e.program.enableShapeUniforms||(Hz(e.inShapeInfos,t),Hz([e.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),k.env().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN),t.forEach(function(c,l){var f=e.program.variableNames[l],h=e.uniformLocations[f],d=e.uniformLocations["offset".concat(f)],p=e.inShapesLocations["".concat(f,"Shape")],v=e.inTexShapesLocations["".concat(f,"TexShape")];if(p){var m=Px(e.program.packedInputs,c.shape,c.texData.texShape).uniformShape;switch(m.length){case 1:n.gl.uniform1iv(p,new Int32Array(m));break;case 2:n.gl.uniform2iv(p,new Int32Array(m));break;case 3:n.gl.uniform3iv(p,new Int32Array(m));break;case 4:n.gl.uniform4iv(p,new Int32Array(m));break}}if(v&&n.gl.uniform2i(v,c.texData.texShape[0],c.texData.texShape[1]),h!=null){if(c.isUniform){if(k.util.sizeFromShape(c.shape)<2)n.gl.uniform1f(h,c.uniformValues[0]);else{var g=c.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),n.gl.uniform1fv(h,g)}return}c.texData.slice!=null&&d!=null&&n.gl.uniform1i(d,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,h,l)}});var s=e.outShapeLocation;if(s)switch(r.shape.length){case 1:n.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(s,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){var u=k.util.computeStrides(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(u));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(u));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(u));break}}e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&a&&e.program.customUniforms.forEach(function(c,l){var f=e.customUniformLocations[l],h=a[l];if(c.type==="float")n.gl.uniform1fv(f,h);else if(c.type==="vec2")n.gl.uniform2fv(f,h);else if(c.type==="vec3")n.gl.uniform3fv(f,h);else if(c.type==="vec4")n.gl.uniform4fv(f,h);else if(c.type==="int")n.gl.uniform1iv(f,h);else if(c.type==="ivec2")n.gl.uniform2iv(f,h);else if(c.type==="ivec3")n.gl.uniform3iv(f,h);else if(c.type==="ivec4")n.gl.uniform4iv(f,h);else throw Error("uniform type ".concat(c.type," is not supported yet."))}),n.executeProgram()}function WLe(n,e,t){var r="";e.concat(t).forEach(function(o){var s=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){var u=o.texData.texShape,c=Px(n.packedInputs,o.shape,u),l=c.useSqueezeShape,f=c.uniformShape,h=c.keptDims,d="",p="",v="";if(f.length===1&&n.packedInputs){var m=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];d="".concat(m[0]>1,"_").concat(m[1]>1)}else if(f.length===2&&!n.packedInputs)p="".concat(f[0]>1,"_").concat(f[1]>1);else if(f.length>2&&!n.packedInputs){var g=k.util.computeStrides(f);v="".concat(g[0]===u[1],"_").concat(g[g.length-1]===u[1])}var y=o.shape.length,b=f.length===2&&k.util.arraysEqual(o.shape,u),w=k.util.sizeFromShape(o.shape)===1,x=k.backend_util.getBroadcastDims(o.shape,t.shape),N=!n.packedInputs&&y===t.shape.length&&k.util.arraysEqual(u,t.texData.texShape),T=n.packedInputs||f.length>2?"":"".concat(u[0]>1,"_").concat(u[1]>1);r+="".concat(y,"_").concat(N,"_").concat(l?h:"","_").concat(f.length,"_").concat(w,"_").concat(x,"_").concat(b,"_").concat(d,"_").concat(p,"_").concat(v,"_").concat(T,"_").concat(s)}else{var E=o.isUniform?"uniform":o.texData.texShape;r+="".concat(o.shape,"_").concat(E,"_").concat(s)}});var a=n.userCode,i=n.constructor.name;return i+="_"+r+"_"+a+"".concat(k.env().getNumber("WEBGL_VERSION")),i}function kr(n){return k.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}var VLe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=hh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?fm(["r","c","d"],e):vu(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `).concat(t.output,` = result;
      }
    `)}return n}();var GLe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=hh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?fm(["r","c","d"],e):vu(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `).concat(t.output,` = result;
      }
    `)}return n}();var ULe=function(){function n(e){this.variableNames=["A"],this.outTexUsage=ba.DOWNLOAD;var t=xr();this.outputShape=e,this.userCode=`
      `.concat(K$,`

      void main() {
        float x = getAAtOutCoords();
        `).concat(t.output,` = encode_float(x);
      }
    `)}return n}();var HLe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ba.DOWNLOAD;var t=xr();this.outputShape=e,this.userCode=`
      `.concat(K$,`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `).concat(t.output,` = encode_float(x);
      }
    `)}return n}();var KLe={R:0,G:1,B:2,A:3},Kz=function(){function n(e,t,r){t===void 0&&(t=!1),r===void 0&&(r="RGBA"),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);var i="result";t&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+=`
          if(offset == `.concat(s,`) {
            result = values[`).concat(KLe[u],`];
          }`)}this.userCode=`
      `.concat(this.enableShapeUniforms?Ox():Rx(e),`

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, `).concat(r.length,`);

        flatIndex = idiv(flatIndex, `).concat(r.length,`, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = `).concat(a.texture2D,`(A, uv);
          `).concat(o,`
        }
        `).concat(a.output," = vec4(").concat(i,`, 0., 0., 0.);
      }
    `)}return n}();var jLe=function(){function n(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);var a="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=o*2+s;a+=`
          localCoords = coords;
          if(localCoords[2] + `.concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),`) {
          localCoords[2] += `).concat(s,`;
          if (localCoords[1] + `).concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),`) {
            localCoords[1] += `).concat(o,`;

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = `).concat(r.texture2D,`(A, uv);

            if (offset == 0) {
              result[`).concat(u,`] = values[0];
            } else if (offset == 1) {
              result[`).concat(u,`] = values[1];
            } else if (offset == 2) {
              result[`).concat(u,`] = values[2];
            } else {
              result[`).concat(u,`] = values[3];
            }
          }
        }
        `)}this.userCode=`
        `.concat(this.enableShapeUniforms?Ox():Rx(e),`

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          `).concat(a,`

          `).concat(r.output," = ").concat(i,`;
        }
    `)}return n}();function J$(n){var e=xr(),t="".concat(e.version,`
    precision highp float;
    `).concat(e.attribute,` vec3 clipSpacePos;
    `).concat(e.attribute,` vec2 uv;
    `).concat(e.varyingVs,` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`);return T$(n,t)}function Q$(n){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return A$(n,e)}function eq(n){var e=new Uint16Array([0,1,2,2,1,3]);return _$(n,e)}function yh(n,e,t,r,a,i){F$(e,t);var o=D$(n),s=n.TEXTURE_2D;return Oe(n,function(){return n.bindTexture(s,o)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_MAG_FILTER,n.NEAREST)}),k.env().getNumber("WEBGL_VERSION")===1?Oe(n,function(){return n.texImage2D(s,0,r,e,t,0,a,i,null)}):Oe(n,function(){return n.texStorage2D(s,1,r,e,t)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)}),{texture:o,texShape:[t,e]}}function Mx(n){return n.internalFormatFloat}function tq(n,e,t,r){var a=Te(gh(e,t),2),i=a[0],o=a[1];return yh(n,i,o,Mx(r),r.textureFormatFloat,n.FLOAT)}function Bx(n){return n.internalFormatHalfFloat}function nq(n,e,t,r){var a=Te(gh(e,t),2),i=a[0],o=a[1];return yh(n,i,o,Bx(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function Lx(n){return n.downloadTextureFormat}function rq(n,e,t,r){var a=Te(gh(e,t),2),i=a[0],o=a[1];return yh(n,i,o,Lx(r),n.RGBA,n.UNSIGNED_BYTE)}function zx(n){return n.internalFormatPackedFloat}function aq(n,e,t,r){var a=Te(Uc(e,t),2),i=a[0],o=a[1];return yh(n,i,o,zx(r),n.RGBA,n.FLOAT)}function $x(n){return n.internalFormatPackedHalfFloat}function iq(n,e,t,r){var a=Te(Uc(e,t),2),i=a[0],o=a[1];return yh(n,i,o,$x(r),n.RGBA,r.textureTypeHalfFloat)}function oq(n,e,t){var r=0,a=3*4,i=3*4+2*4;Oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,t)});var o=Nx(n,e,"clipSpacePos",t,3,i,r);return o&&Nx(n,e,"uv",t,2,i,a)}function sq(n,e,t,r,a,i){Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,e)});var o,s,u;a instanceof Uint8Array?(o=new Uint8Array(t*r*4),s=n.UNSIGNED_BYTE,u=n.RGBA):(o=new Float32Array(t*r*4),s=n.FLOAT,u=i.internalFormatPackedFloat),o.set(a),k.env().getNumber("WEBGL_VERSION")===2?Oe(n,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,s,o)}):Oe(n,function(){return n.texImage2D(n.TEXTURE_2D,0,u,t,r,0,n.RGBA,s,o)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function uq(n,e,t){Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,e)}),t.data instanceof Uint8Array?k.env().getNumber("WEBGL_VERSION")===2?Oe(n,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)}):Oe(n,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)}):k.env().getNumber("WEBGL_VERSION")===2?Oe(n,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)}):Oe(n,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function cq(n,e,t,r){var a=n.createBuffer();Oe(n,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,a)});var i=4,o=4,s=i*o*e*t;return Oe(n,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)}),Oe(n,function(){return n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)}),Oe(n,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),a}function lq(n,e,t){var r=n,a=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function fq(n,e,t,r){var a=Te(gh(e,t),2),i=a[0],o=a[1],s=4,u=new Uint8Array(VBe(e*t,s));return Oe(n,function(){return n.readPixels(0,0,i,o,r.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function hq(n,e,t,r,a,i,o,s){var u=n,c=new Float32Array(GBe(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function dq(n,e,t){var r=new Float32Array(e*t*4);return Oe(n,function(){return n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)}),r}var XLe={__proto__:null,createVertexShader:J$,createVertexBuffer:Q$,createIndexBuffer:eq,getInternalFormatForFloat32MatrixTexture:Mx,createFloat32MatrixTexture:tq,getInternalFormatForFloat16MatrixTexture:Bx,createFloat16MatrixTexture:nq,getInternalFormatForUnsignedBytesMatrixTexture:Lx,createUnsignedBytesMatrixTexture:rq,getInternalFormatForPackedMatrixTexture:zx,createPackedMatrixTexture:aq,getInternalFormatForFloat16PackedMatrixTexture:$x,createFloat16PackedMatrixTexture:iq,bindVertexProgramAttributeStreams:oq,uploadDenseMatrixToTexture:sq,uploadPixelDataToTexture:uq,createBufferFromOutputTexture:cq,downloadFloat32MatrixFromBuffer:lq,downloadByteEncodedFloatMatrixFromOutputTexture:fq,downloadPackedMatrixFromBuffer:hq,downloadMatrixFromPackedOutputTexture:dq},om=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var t=k.env().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,k$(t,e)):this.gl=ki(t),e=this.gl,k.env().getNumber("WEBGL_VERSION")===2){var r=e;this.createVertexArray=function(){return Oe(r,function(){return r.createVertexArray()})},this.bindVertexArray=function(c){return Oe(r,function(){return r.bindVertexArray(c)})},this.deleteVertexArray=function(c){return Oe(r,function(){return r.deleteVertexArray(c)})},this.getVertexArray=function(){return Oe(r,function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)})}}else if(e!=null){var a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return Oe(e,function(){return a.createVertexArrayOES()})},this.bindVertexArray=function(c){return Oe(e,function(){return a.bindVertexArrayOES(c)})},this.deleteVertexArray=function(c){return Oe(e,function(){return a.deleteVertexArrayOES(c)})},this.getVertexArray=function(){return Oe(e,function(){return e.getParameter(a.VERTEX_ARRAY_BINDING_OES)})}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),k.env().getNumber("WEBGL_VERSION")===1){var s="OES_texture_float",u="OES_texture_half_float";if(this.textureFloatExtension=sh(this.gl,s),wa(this.gl,u))this.textureHalfFloatExtension=sh(this.gl,u);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),wa(this.gl,o))this.colorBufferHalfFloatExtension=sh(this.gl,o);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",wa(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(wa(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Q$(this.gl),this.indexBuffer=eq(this.gl),this.framebuffer=R$(this.gl),this.textureConfig=Dx(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return k.env().getBool("DEBUG")},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Oe(t,function(){return t.finish()}),Oe(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Oe(t,function(){return t.deleteFramebuffer(e.framebuffer)}),Oe(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Oe(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Oe(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),tq(this.gl,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),nq(this.gl,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),rq(this.gl,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),uq(this.gl,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,a){this.throwIfDisposed(),sq(this.gl,e,t,r,a,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),iq(this.gl,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),aq(this.gl,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Tx(this.gl,this.framebuffer),this.outputTexture=null),Oe(this.gl,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var a=this;return this.downloadMatrixDriver(e,function(){return fq(a.gl,t,r,a.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,a,i,o){return hq(this.gl,e,t,r,a,i,o,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return lq(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var a=cq(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t=this,r,a;if(k.env().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},r=o}else k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(r=this.beginQuery(),this.endQuery(),a=function(){return t.isQueryAvailable(r,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:r,isFencePassed:a}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var a=this;return this.downloadMatrixDriver(e,function(){return dq(a.gl,t,r)})},n.prototype.createProgram=function(e){var t=this;this.throwIfDisposed();var r=this.gl;this.vertexShader==null&&(this.vertexShader=J$(r));var a=I$(r);Oe(r,function(){return r.attachShader(a,t.vertexShader)}),Oe(r,function(){return r.attachShader(a,e)}),C$(r,a);var i;return i=Object.assign(a,{vao:this.createVertexArray()}),this.bindVertexArray(i.vao),Oe(r,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer)}),console.assert(oq(r,i,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&nm(r,i),this.setProgram(i),i},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Oe(this.gl,function(){return t.gl.deleteProgram(e)}),this.deleteVertexArray(e.vao))},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&(this.bindVertexArray(this.program.vao),this.debug&&nm(this.gl,this.program)),Oe(this.gl,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?P$(this.gl,e,t):M$(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Oe(this.gl,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),B$(this.gl,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var a=Te(Uc(t,r),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,a){this.setOutputMatrixWriteRegionDriver(r,e,a,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&nm(this.gl,this.program),uh(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Oe(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Oe(this.gl,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=sh(this.gl,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},n.prototype.endQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}var r=this.getQueryTimerExtensionWebGL1();r.endQueryEXT(r.TIME_ELAPSED_EXT)},n.prototype.waitForQueryAndGetTime=function(e){return Wc(this,void 0,void 0,function(){var t=this;return Vc(this,function(r){switch(r.label){case 0:return[4,k.util.repeatedTry(function(){return t.disposed||t.isQueryAvailable(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl,a=r.getQueryParameter(e,r.QUERY_RESULT);return a/1e6}else{var i=this.getQueryTimerExtensionWebGL1(),a=i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT);return a/1e6}},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{var a=this.getQueryTimerExtensionWebGL1(),i=a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=YLe(this.itemsToPoll.map(function(a){return a.isDoneFn})),t=0;t<=e;++t){var r=this.itemsToPoll[t].resolveFn;r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var a=void 0;"setTimeoutCustom"in k.env().platform&&(a=k.env().platform.setTimeoutCustom.bind(k.env().platform)),k.util.repeatedTry(function(){return r.pollItems(),r.itemsToPoll.length===0},function(){return 0},null,a)}},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),rm(this.gl,e,this.framebuffer),this.debug&&uh(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(rm(this.gl,this.outputTexture,this.framebuffer),this.debug&&uh(this.gl)):Tx(this.gl,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var a=this.gl;rm(a,e,this.framebuffer),this.debug&&uh(a),this.outputTexture=e,Oe(a,function(){return a.viewport(0,0,t,r)}),Oe(a,function(){return a.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,a){var i=this;this.throwIfDisposed(),Oe(this.gl,function(){return i.gl.scissor(e,t,r,a)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function YLe(n){for(var e=0;e<n.length;++e){var t=n[e]();if(!t)break}return e-1}function ZLe(n){for(var e=new Float32Array(n.length),t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}function ja(n){return function(e,t,r,a,i){var o=k.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=k.util.computeStrides(o),c=k.util.sizeFromShape(o),l=k.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,d=k.util.computeStrides(e),p=k.util.computeStrides(t),v=k.backend_util.getBroadcastDims(e,o),m=k.backend_util.getBroadcastDims(t,o);if(v.length+m.length===0)for(var g=0;g<l.length;++g)l[g]=n(r[g%r.length],a[g%a.length]);else for(var y=function(b){var w=k.util.indexToLoc(b,s,u),x=w.slice(-f);v.forEach(function(C){return x[C]=0});var N=k.util.locToIndex(x,f,d),T=w.slice(-h);m.forEach(function(C){return T[C]=0});var E=k.util.locToIndex(T,h,p);l[b]=n(r[N],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function JLe(n,e,t,r){if(r==="int32"){var a=Int32Array.from(n);return[e,"int32",a]}if(r==="bool"){var i=k.util.toTypedArray([0],t),o=Te(ja(function(c,l){return c!==l?1:0})(e,[],n,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(r))}var QLe=ja(function(n,e){return n+e});function eze(n,e,t,r,a){for(var i=k.util.sizeFromShape(r),o=k.util.makeZerosTypedArray(a,t),s=0;s<n.length;s++){var u=n[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function tze(n,e,t,r){r===void 0&&(r=!1);for(var a=n.shape[0],i=n.shape[1],o=k.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=n.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(r?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}function ts(n){return function(e,t,r){for(var a=k.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=n(e[i],r);return a}}var nze=ts(function(n){return Math.ceil(n)});function rze(n,e,t,r){var a=k.util.getArrayFromDType(t,k.util.sizeFromShape(e));if(r&&t!=="string"){var i=0;n.forEach(function(s){var u=k.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;n.forEach(function(s){for(var u=t==="string"?k.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var aze=ja(function(n,e){return n===e?1:0});var ize=ts(function(n){return Math.exp(n)});var oze=ts(function(n){return Math.expm1(n)});var sze=ts(function(n){return Math.floor(n)});function uze(n,e,t,r,a,i,o,s,u){for(var c=k.buffer([r,i],t),l=0;l<r;l++){for(var f=[],h=0,d=0;d<a;d++){var p=n[l*a+d];h+=p*o[d],f.push(p)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var v=0;v<i;v++)c.values[l*i+v]=e.get.apply(e,dn([],Te(e.indexToLoc(h*i+v)),!1))}return c}function cze(n,e,t){for(var r=k.buffer(t,n.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=n.locToIndex(o);0<=l&&l<n.values.length&&(r.values[a]=n.values[l])}return r}var lze=ja(function(n,e){return n>e?1:0});var fze=ja(function(n,e){return n>=e?1:0});var hze=ja(function(n,e){return n<e?1:0});var dze=ja(function(n,e){return n<=e?1:0});function pze(n,e,t){var r=(e-n)/(t-1),a=k.util.makeZerosTypedArray(t,"float32");a[0]=n;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var vze=ts(function(n){return Math.log(n)});function mze(n,e,t,r){for(var a=k.util.getTypedArrayFromDType(r,k.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=n[o],u=0;u<e;++u){var c=n[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var gze=ja(function(n,e){return Math.max(n,e)});var yze=ja(function(n,e){return Math.min(n,e)});var pq=ja(function(n,e){return n*e});function bze(n,e,t){var r=k.util.createScalarValue(-1,t);return pq([],e,r,n,t)}var wze=ja(function(n,e){return n!==e?1:0});function xze(n,e,t,r,a){for(var i=e.length,o=k.util.sizeFromShape(e),s=k.util.computeStrides(e),u=k.util.computeStrides(a),c=k.util.getTypedArrayFromDType(t,k.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=k.util.indexToLoc(l,i,s),h=new Array(f.length),d=0;d<h.length;d++)h[d]=f[r[d]];var p=k.util.locToIndex(h,i,u);c[p]=n[l]}return c}function kze(n,e,t,r){for(var a=Te(k.backend_util.computeOutAndReduceShapes(n,r),2),i=a[0],o=a[1],s=k.upcastType(e,"int32"),u=k.util.makeZerosTypedArray(k.util.sizeFromShape(i),s),c=k.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,d=0;d<c;++d)h*=t[f+d];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function Sze(n,e,t){n.forEach(function(r,a){if(r<0||r>=t){var i=k.util.indexToLoc(a,e.length,k.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(r," is not in [0, ").concat(t,")"))}})}function Nze(n,e){for(var t=0;t<n.length;++t){var r=n[t],a=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Tze(n,e,t,r){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});Nze(t,r);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<n.length;++f){for(var h=n[f],d=n[f]+1,c=0;c<t.length;++c){var p=t[c],v=c+e.length-1;if(v>=0)for(var m=s[v],g=m[m.length-1]-p[h],y=h;y<d;++y)s[v].push(p[y+1]+g);h=p[h],d=p[d]}d!==h&&(a.push([h,d]),i+=d-h)}return{outSplits:s,valueSlices:a,numValues:i}}function Eze(n){for(var e=[],t=function(a){var i=n[a].length,o=k.util.getArrayFromDType("int32",i);e.push(o),n[a].forEach(function(s,u){return o[u]=s})},r=0;r<n.length;++r)t(r);return e}function jz(n,e){for(var t=n.slice(0,e);t.length<e;)t.push(1);for(var r=e;r<n.length;r++)t[e-1]*=n[r];return t}function Ize(n,e,t,r,a,i){var o,s,u=jz(e,2)[1],c=jz(i,2)[1],l=0;try{for(var f=ra(t),h=f.next();!h.done;h=f.next())for(var d=h.value,p=d[0];p<d[1];++p){for(var v=0;v<r;++v)a[l*c+v]=n[p*u+v];++l}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function Cze(n,e,t,r,a){var i=e.slice();i[0]=a;var o=k.util.getArrayFromDType(t,k.util.sizeFromShape(i)),s=n.length,u=s===0?0:s/e[0];return Ize(n,e,r,u,o,i),[o,i]}function Aze(n,e,t,r,a,i,o,s){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(Sze(i,o,u),r.length===0)throw new Error("params.rank must be nonzero");var c=r[0],l=Tze(i,o,n,c),f=l.outSplits,h=l.valueSlices,d=l.numValues,p=Eze(f),v=Cze(t,r,a,h,d);return[p,v[0],v[1]]}var Xz=2147483647;function _ze(n,e,t,r,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],d=k.util.getArrayFromDType("int32",h+1);d[0]=0;for(var p=0;p<h;++p){var v=s?n[0]:n[p],m=u?r[0]:r[p],g=c?i[0]:i[p];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&m<v||g<0&&m>v)y=0;else if(y=Math.ceil(Math.abs((m-v)/g)),y>Xz)throw new Error("Requires ((limit - start) / delta) <= ".concat(Xz));d[p+1]=d[p]+y}for(var b=d[h],w=k.util.getArrayFromDType(t,b),x=0,p=0;p<h;++p)for(var N=d[p+1]-d[p],T=s?n[0]:n[p],g=c?i[0]:i[p],f=0;f<N;++f)w[x++]=T,T+=g;return[d,w]}var Ka=k.backend_util.RowPartitionType,Dze=function(){function n(e,t,r,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=k.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=k.backend_util.getRaggedRank(this.rowPartitionTypes)}return n.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Ka.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},n.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Ka.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},n.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ka.VALUE_ROWIDS:return n.getMaxWidthValueRowID(t);case Ka.ROW_SPLITS:return n.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Ka[this.getRowPartitionTypeByDimension(e-1)]))}},n.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var r=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>r&&(r=i)}return r},n.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var r=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-r,i),r=o)}return Math.max(t-r,i)},n.prototype.tensorShapeFromTensor=function(e,t,r){if(r===void 0&&(r=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Zz(e,r)},n.prototype.calculateOutputSize=function(e){var t=this.valuesShape,r=this.defaultValueShape;k.backend_util.validateDefaultValueShape(r,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=k.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},n.prototype.calculateFirstParentOutputIndex=function(e,t,r){for(var a=Math.min(e,r),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return k.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},n.prototype.calculateOutputIndexRowSplit=function(e,t,r,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=r;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},n.prototype.calculateOutputIndexValueRowID=function(e,t,r,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=r:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},n.prototype.calculateOutputIndex=function(e,t,r,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ka.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,a);case Ka.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,r,a);default:throw new Error("Unsupported partition type: ".concat(Ka[o]))}},n.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Ka.FIRST_DIM_SIZE:return e[0];case Ka.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ka.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Ka[t]))}},n.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*r[i+1];var o=Zz(r,!1),s=k.util.getArrayFromDType(this.valuesDType,k.util.sizeFromShape(o)),u=a[0]*r[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],r[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],r[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},n.prototype.setOutput=function(e,t,r,a){if(r.length!==0){var i=this.values,o=r,s=a.slice();s=s.slice(e+1);var u=k.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;k.tidy(function(){var x=k.reshape(l,f),N=k.broadcastTo(x,s);l=N.dataSync()})}for(var h=0,d=0,p=0,v=0;v<=c;++v){var m=v<c?t[v]:-1;if(m===p){++p;continue}if(d<p){var g=i.subarray(h*u),y=o.subarray(d*u),b=(p-d)*u;Yz(y,g,b)}if(v>=c){var w=r.length;m=Math.floor(w/u)}if(m>p)if(this.defaultValue.length===1)o.subarray(p*u,m*u).fill(this.defaultValue[0]),p=m;else for(;m>p;){var y=o.slice(p*u);Yz(y,l,u),++p}m<0?(h=v+1,d=p):(h=v,d=p,p=d+1)}}},n}();function Yz(n,e,t){for(var r=0;r<t;r++)n[r]=e[r]}function Zz(n,e){var t,r,a=[];try{for(var i=ra(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a}function Fze(n,e,t,r,a,i,o,s,u,c){return new Dze(n,e,t,r,a,i,o,s,u,c).compute()}function Rze(n,e,t,r){var a=n===e,i=n<e&&t<0,o=e<n&&t>1;if(a||i||o)return k.util.makeZerosTypedArray(0,r);var s=Math.abs(Math.ceil((e-n)/t)),u=k.util.makeZerosTypedArray(s,r);e<n&&t===1&&(t=-1),u[0]=n;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var Oze=ts(function(n){return 1/Math.sqrt(n)});function Pze(n,e,t,r,a,i,o,s,u,c){var l=[r/a,a],f=n.values,h=e.values;if(r===0)return k.buffer(t,e.dtype);var d=k.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?d.values.fill(u):typeof u=="boolean"&&d.values.fill(+u);for(var p=0;p<i;p++){for(var v=[],m=0,g=0;g<o;g++){var y=f[p*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(t));for(var b=0;b<a;b++)c?d.values[m*a+b]+=h[p*a+b]:d.values[m*a+b]=e.rank===0?h[0]:h[p*a+b]}return d}var Mze=ts(function(n){return 1/(1+Math.exp(-n))});function Bze(n,e,t,r,a){var i=k.slice_util.isSliceContinous(r,e,t),o=k.util.sizeFromShape(t),s=k.util.computeStrides(r);if(i){var u=k.slice_util.computeFlatOffset(e,s);return a==="string"?n.slice(u,u+o):n.subarray(u,u+o)}for(var c=a==="string"?k.backend_util.fromUint8ToStringArray(n):n,l=k.buffer(r,a,c),f=k.buffer(t,a),h=0;h<f.size;++h){var d=f.indexToLoc(h),p=d.map(function(v,m){return v+e[m]});f.set.apply(f,dn([l.get.apply(l,dn([],Te(p),!1))],Te(d),!1))}return a==="string"?k.backend_util.fromStringArrayToUint8(f.values):f.values}function Lze(n,e,t,r,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(k.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=k.util.getArrayFromDType(t,0),d=k.util.getArrayFromDType(a,0);return[h,[0,f],d,c,l]}for(var p=!0,v=0,m=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f];if(y<0)throw new Error(k.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(k.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++m[y],p=p&&y>=v,v=y}for(var b=!0,y=0;y<u;++y){var w=m[y]===0;c[y]=w,b=b&&!w,m[y]=Math.max(m[y],1),y>0&&(m[y]+=m[y-1])}if(b&&p){for(var h=n,d=r,g=0;g<s;++g)l[g]=g;return[h,[s,f],d,c,l]}else{for(var x=m[u-1],h=k.util.getArrayFromDType(t,x*f),d=k.util.getArrayFromDType(a,x),N=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f],T=N[y],E=(y===0?0:m[y-1])+T;N[y]++;for(var C=0;C<f;++C)h[E*f+C]=n[g*f+C];d[E]=r[g],l[g]=E}for(var y=0;y<u;++y){var F=N[y];if(F===0){var D=y===0?0:m[y-1];h[D*f+0]=y;for(var O=1;O<f;++O)h[D*f+O]=0;d[D]=o}}return[h,[x,f],d,c,l]}}function zze(n,e,t,r,a){for(var i=k.util.sizeFromShape(r),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(k.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(k.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(k.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var d=Math.trunc(i/c);if(c*d!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=d}var p=k.util.sizeFromShape(u);if(p!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var v=r.length,m=[];if(v>0){m[v-1]=1;for(var f=v-2;f>=0;--f)m[f]=m[f+1]*r[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=k.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,x=0;x<v;++x)w+=n[b*v+x]*m[x];for(var x=0;x<s;++x)y[b*s+x]=Math.trunc(w/g[x]),w%=g[x]}return[y,[o,s],u]}function $ze(n,e,t,r,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=r.length,u=[e[0],n.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var d=h.reduce(function(T,E){return T*E},1),p=k.util.getArrayFromDType(t,d);if(s===0)return f>0&&p.fill(o),[p,h];if(f<=0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,m=1,g=0,y=a[v];;){var b=0;if(m<s){if(b=a[m],y===b){++m;continue}if(y>=b)throw new Error(k.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(k.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&p.fill(o,g*c,y*c);for(var w=v;w<m;++w){var x=r[w];if(x<0||x>=u[0])throw new Error(k.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,r[w],u[0]));for(var N=0;N<c;N++)p[y*c+N]+=n[x*c+N]}if(i)for(var N=0;N<c;N++)p[y*c+N]/=m-v;if(v=m,++m,g=y+1,y=b,m>s)break}return g<f&&p.fill(o,g*c,f*c),[p,h]}var qze=ts(function(n){return Math.sqrt(n)});function Wze(n,e,t,r){for(var a=k.buffer(n,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+r[u];a.set.apply(a,dn([e.get.apply(e,dn([],Te(s),!1))],Te(o),!1))}return a}var Vze=function(){function n(e,t,r,a,i,o){this.separator=k.util.encodeString(e),this.nGramWidths=t,this.leftPad=k.util.encodeString(r),this.rightPad=k.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return n.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},n.prototype.getNumNGrams=function(e,t){var r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)},n.prototype.createNGrams=function(e,t,r,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),d=Math.max(0,f-(i-(l+1))),p=o-(h+d),v=t+(h>0?0:l-f),m=0;m+=h*u.leftPad.length;for(var g=0;g<p;++g)m+=e[v+g].length;m+=d*u.rightPad.length;var y=h+d+p-1;m+=y*u.separator.length,r[a+l]=new Uint8Array(m);for(var b=r[a+l],w=0,x=function(N){return N.forEach(function(T){return b[w++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<p-1;++g)x(e[v+g]),x(u.separator);if(p>0){x(e[v+p-1]);for(var g=0;g<d;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<d-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},n.prototype.compute=function(e,t){var r=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=k.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;d.nGramWidths.forEach(function(w){b+=r.getNumNGrams(y,w)}),d.preserveShort&&y>0&&b===0&&(b=1),l[g]=l[g-1]+b},d=this,s=1;s<=c;++s)h(s);for(var p=new Array(l[c]),v=function(g){var y=t[g],b=l[g];if(m.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=r.getNumNGrams(E,T);r.createNGrams(e,y,p,b,C,T),b+=C}),m.preserveShort&&b===l[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var x=w+2*m.padWidth,N=1;m.createNGrams(e,y,p,b,N,x)}},m=this,s=0;s<c;++s)v(s);return[p,l]},n}();function Gze(n,e,t,r,a,i,o,s){return new Vze(t,r,a,i,o,s).compute(n,e)}function Uze(n,e,t,r){if(!!n.length){if(e.length===0){for(var a=0;a<n.length;++a)r.push(n.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=n.indexOf(i);o!==-1;){var s=n.subarray(0,o);(!t||s.length!==0)&&r.push(s),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}for(var u=0,a=0;a<n.length+1;a++)if(a===n.length||e.indexOf(n[a])!==-1){var s=n.subarray(u,a);(!t||s.length!==0)&&r.push(s),u=a+1}}}function Hze(n,e,t){for(var r=n.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;Uze(n[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=k.util.getArrayFromDType("int32",i*2),h=new Array(i),d=[r,o],p=0,u=0;u<r;++u)for(var v=0;v<s[u];++v)f[p*2]=u,f[p*2+1]=v,h[p]=a[p],++p;return[f,h,d]}function Kze(n,e){for(var t=k.util.getArrayFromDType("int32",n.length),r=0;r<n.length;++r)t[r]=k.util.fingerPrint64(n[r]).modulo(e).getLowBitsUnsigned();return t}var jze=ja(function(n,e){return n-e});function Xze(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];for(var a=k.buffer(t,n.dtype),r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),o=new Array(n.rank),s=0;s<o.length;s++)o[s]=i[s]%n.shape[s];var u=n.locToIndex(o);a.values[r]=n.values[u]}return a}var lh=function(n,e){var t=e.value-n.value;return t===0?n.index-e.index:t};function vq(n,e,t,r){for(t===void 0&&(t=0),r===void 0&&(r=n.length-1);r>t;){if(r-t>600){var a=r-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(r,Math.floor(e+(a-i)*s/a+u));vq(n,e,c,l)}var f=n[e],h=t,d=r;for(k.util.swap(n,t,e),lh(n[r],f)>0&&k.util.swap(n,t,r);h<d;){for(k.util.swap(n,h,d),h++,d--;lh(n[h],f)<0;)h=h+1;for(;lh(n[d],f)>0;)d=d-1}lh(n[t],f)===0?k.util.swap(n,t,d):(d=d+1,k.util.swap(n,d,r)),d<=e&&(t=d+1),e<=d&&(r=d-1)}}function Yze(n,e,t,r,a){for(var i=e[e.length-1],o=Te([n.length/i,i],2),s=o[0],u=o[1],c=k.util.getTypedArrayFromDType(t,s*r),l=k.util.getTypedArrayFromDType("int32",s*r),f=function(p){var v=p*u,m=n.subarray(v,v+u),g=new Array(m.length);m.forEach(function(N,T){return g[T]={value:N,index:T}}),r<g.length&&(vq(g,r),g=g.slice(0,r)),a&&g.sort(lh);for(var y=p*r,b=c.subarray(y,y+r),w=l.subarray(y,y+r),x=0;x<r;x++)b[x]=g[x].value,w[x]=g[x].index},h=0;h<s;h++)f(h);var d=e.slice();return d[d.length-1]=r,[k.buffer(d,t,c),k.buffer(d,"int32",l)]}function Zze(n,e,t,r){for(var a=k.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),c=new k.TensorBuffer(i,r,n),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=n[o].toString();else{for(var d=[],p=0;p<i[0];p++)for(var v=0;v<i[2];v++)d.push(c.get(p,o,v));h=d.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var m=Object.keys(s).length;s[h]=m,u[o]=m,l.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new k.TensorBuffer(g,r);l.forEach(function(w,x){for(var N=0;N<i[0];N++)for(var T=0;T<i[2];T++)y.set(c.get(N,w,T),N,x,T)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var Jze=QLe,mq=eze,Qze=tze,e$e=JLe,t$e=nze,n$e=rze,r$e=aze,a$e=ize,i$e=oze,o$e=sze,s$e=uze,u$e=cze,c$e=lze,l$e=fze,f$e=hze,h$e=dze,d$e=pze,p$e=vze,v$e=mze,m$e=gze,g$e=yze,y$e=pq,b$e=bze,w$e=wze,x$e=kze,k$e=Aze,S$e=_ze,N$e=Fze,T$e=Rze,E$e=Oze,I$e=Pze,C$e=Mze,gq=ZLe,A$e=Bze,_$e=Lze,D$e=zze,yq=$ze,F$e=qze,R$e=Wze,O$e=Gze,P$e=Hze,M$e=Kze,B$e=jze,L$e=Xze,z$e=Yze,qx=xze,$$e=Zze;function bq(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return"".concat(n,".").concat(t)})}function br(n,e){return e===1?[n]:bq(n,e)}function q$e(n,e){if(n===1)return"rc";for(var t="",r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}var W$e=function(){function n(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=kr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=br("rc",this.rank),r=Wt(this.rank),a=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          `.concat(r,` rc = getOutputCoords();

          if(`).concat(a,`) {
            setOutput(vec4(0));
          } else {
            `).concat(i,`

            setOutput(vec4(`).concat(o,`));
          }
        }
      `)}}return n.prototype.getSourceCoordsArr=function(e){for(var t=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(r===0?"r":"rp1",", ").concat(a===0?"c":"cp1"),o=2;o<this.rank;o++)i="".concat(e[e.length-1-o],",")+i;t.push(i)}return t},n.prototype.getOutOfBoundsCondition=function(e){if(this.rank===1)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",r=this.rank-2;r<this.rank;r++)t+="".concat(e[r]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(r,"]"):this.outputShape[r]),r<this.rank-1&&(t+="||");return t},n.prototype.getSetup=function(e){if(this.rank===1)return"";var t=e.slice(-2),r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return`
      int r = `.concat(t[0],`;
      int c = `).concat(t[1],`;
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= `).concat(r,`;
      bool rEdge = rp1 >= `).concat(a,`;
    `)},n.prototype.getOutput=function(e){var t=this.getSourceCoordsArr(e);if(this.rank===1){var r=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(r," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],`),
            cEdge ? 0. : getA(`).concat(t[1],`),
            rEdge ? 0. : getA(`).concat(t[2],`),
            rEdge || cEdge ? 0. : getA(`).concat(t[3],")")},n}();var wq=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+=`
        `.concat(i,`
        `).concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"",`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`).concat(a,`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `).concat(a>0?"}":"",`
      `)}this.userCode=`
      `.concat(V$e(t,this.enableShapeUniforms),`
      `).concat(this.enableShapeUniforms?Ox():Rx(e),`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `).concat(this.enableShapeUniforms?"outShape[1]":e[1],`;
        int cols = `).concat(this.enableShapeUniforms?"outShape[2]":e[2],`;

        `).concat(r,`

        setOutput(result);
      }
    `)}return n}();function V$e(n,e){var t=e?rLe(["r","c","d"],"inputShape"):vu(["r","c","d"],n);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `.concat(t,`
      return ivec3(r, c, d);
    }
  `)}var G$e=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var a=Qz(t,r),i=e$(e,a,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);var o=Jz(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}var u;return a===ir.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===ir.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===ir.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===ir.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===ir.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),u},n.prototype.releaseTexture=function(e,t,r,a){if(this.freeTextures!=null){var i=Qz(r,a),o=e$(t,i,a);o in this.freeTextures||(this.freeTextures[o]=[]);var s=Jz(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,a),u=k.env().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var c=this.usedTextures[o],l=c.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(l,1),this.log()}},n.prototype.log=function(){if(!!this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}},Object.defineProperty(n.prototype,"numBytesAllocated",{get:function(){return this._numBytesAllocated},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"numBytesFree",{get:function(){return this._numBytesFree},enumerable:!1,configurable:!0}),n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r.texture)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){e.gpgpu.deleteMatrixTexture(a.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}},n}();function U$e(n,e){var t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error("Unknown internal format ".concat(e))}function Jz(n,e,t,r,a){var i=H$e(e,r),o;if(a){var s=Te(Uc(n[0],n[1]),2),u=s[0],c=s[1];o=u*c}else{var l=Te(gh(n[0],n[1]),2),f=l[0],h=l[1];o=f*h}var d=U$e(t,i);return o*d}function H$e(n,e){switch(n){case ir.PACKED_2X2_FLOAT32:return zx(e);case ir.PACKED_2X2_FLOAT16:return $x(e);case ir.UNPACKED_FLOAT32:return Mx(e);case ir.UNPACKED_FLOAT16:return Bx(e);case ir.PACKED_4X1_UNSIGNED_BYTE:return Lx(e);default:throw new Error("Unknown physical texture type ".concat(n))}}function K$e(n){return k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?ir.PACKED_2X2_FLOAT32:ir.UNPACKED_FLOAT32:n?ir.PACKED_2X2_FLOAT16:ir.UNPACKED_FLOAT16}function Qz(n,e){if(n===ba.UPLOAD)return ir.PACKED_2X2_FLOAT32;if(n===ba.RENDER||n==null)return K$e(e);if(n===ba.DOWNLOAD||n===ba.PIXELS)return ir.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(n))}function e$(n,e,t){return"".concat(n[0],"_").concat(n[1],"_").concat(e,"_").concat(t)}var Bi=function(){function n(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        `.concat(t,`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `)}return n}(),Xa="if (isnan(x)) return x;",j$e="return x;",t$="return abs(x);",X$e="return (x >= 0.0) ? x : (exp(x) - 1.0);",Y$e=Xa+`
  return (x < 0.0) ? 0.0 : x;
`,Z$e=Xa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Qo="return x;",J$e="return 1.0 / (1.0 + exp(-1.0 * x));";var Q$e="return x;",eqe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,tqe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,nqe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rqe="return 1.0 / (1.0 + exp(-1.0 * x));",es=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `.concat(t,`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `)}return n}();var aqe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);var t=e.length,r=br("rc",t),a=Wt(t),i=q$e(t,r),o=r.slice(-2),s=t<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode=`
      void main() {
        `.concat(a,` rc = getOutputCoords();
        vec4 packedInput = getA(`).concat(i,`);

        setOutput(getChannel(packedInput, `).concat(s,`));
      }
    `)}return n}(),iqe=k.kernel_impls.whereImpl,oqe=1e-7,sqe=1e-4,em={};function uqe(n){return n in em||(em[n]={}),em[n]}var cqe=k.env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),lqe=600;function fqe(){return k.env().global.screen==null?1024:k.env().global.screen.height*k.env().global.screen.width*window.devicePixelRatio*lqe/1024/1024}var Wx=function(n){$Be(e,n);function e(t){var r=n.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!k.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");var a;if(t!=null){if(t instanceof om)a=t;else{var i=ki(k.env().getNumber("WEBGL_VERSION"),t);a=new om(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var i=ki(k.env().getNumber("WEBGL_VERSION"));a=new om(i),r.binaryCache=uqe(k.env().getNumber("WEBGL_VERSION")),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new G$e(r.gpgpu),r.numMBBeforeWarning=fqe(),r.texData=new k.DataStorage(r,k.engine()),r}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.numDataIds=function(){return this.texData.numDataIds()-this.pendingDeletes},e.prototype.writeTexture=function(t,r,a,i,o,s){var u=this.makeTensorInfo(r,a),c=this.texData.get(u.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[i,o]},c.texShape=[i,o];var l=ch(r),f=new Kz(l,!1,s),h=this.runWebGLProgram(f,[u],a,[[i,o]]);return h.shape=r,c.texture=null,this.disposeIntermediateTensorInfo(u),h.dataId},e.prototype.write=function(t,r,a){if((k.env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||k.env().getBool("DEBUG"))&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:a,values:t,usage:ba.UPLOAD,refCount:1}),i},e.prototype.refCount=function(t){if(this.texData.has(t)){var r=this.texData.get(t);return r.refCount}return 0},e.prototype.incRef=function(t){var r=this.texData.get(t);r.refCount++},e.prototype.decRef=function(t){if(this.texData.has(t)){var r=this.texData.get(t);r.refCount--}},e.prototype.move=function(t,r,a,i,o){if(k.env().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:i,values:r,usage:ba.UPLOAD,refCount:o})},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.readSync=function(t){var r=this.texData.get(t),a=r.values,i=r.dtype,o=r.complexTensorInfos,s=r.slice,u=r.shape,c=r.isPacked;if(s!=null){var l=void 0;c?l=new es(u,Qo):l=new Bi(u,Qo);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),h}if(a!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return a;var d=this.activeTimers!=null,p;d&&(p=k.util.now());var v;if(i==="complex64"){var m=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);v=k.backend_util.mergeRealAndImagArrays(m,g)}else v=this.getValuesFromTexture(t);return d&&(this.downloadWaitMs+=k.util.now()-p),this.convertAndCacheOnCPU(t,v)},e.prototype.read=function(t){return Wc(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E,C;return Vc(this,function(F){switch(F.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(D){return r.push(D)})];if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensorInfos,l=a.isPacked,s!=null)return f=void 0,l?f=new es(o,Qo):f=new Bi(o,Qo),h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),d=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),[2,d];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(k.env().getBool("DEBUG")&&!k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&k.env().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&k.env().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),m=this.texData.get(v.dataId),p=(C=this.gpgpu).createBufferFromTexture.apply(C,dn([m.texture.texture],Te(Jv(o)),!1))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:F.sent(),F.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)])];case 3:return y=F.sent(),b=y[0],w=y[1],g=k.backend_util.mergeRealAndImagArrays(b,w),[3,5];case 4:p==null?g=this.getValuesFromTexture(t):(x=k.util.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),F.label=5;case 5:return v!=null&&this.disposeIntermediateTensorInfo(v),p!=null&&(N=this.gpgpu.gl,Oe(N,function(){return N.deleteBuffer(p)})),T=this.convertAndCacheOnCPU(t,g),E=this.pendingRead.get(t),this.pendingRead.delete(t),E.forEach(function(D){return D(T)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&k.engine().removeDataId(t,this),this.pendingDeletes--),[2,T]}})})},e.prototype.readToGPU=function(t,r){r===void 0&&(r={});var a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.isPacked,l=a.texture;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){var f=void 0;c?f=new es(o,Qo):f=new Bi(o,Qo);var h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),d=this.readToGPU(h,r);return this.disposeIntermediateTensorInfo(h),d}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var p=this.decode(t,r.customTexShape),v=k.engine().makeTensorFromTensorInfo(p),m=this.texData.get(p.dataId);return Object.assign({tensorRef:v},m.texture)},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId);if(t.dtype==="string")try{var a=r.map(function(i){return k.util.decodeString(i)});return k.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return k.buffer(t.shape,t.dtype,r)},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var a=t[r];if(!S$(a))throw k.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(a," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value ".concat(a," cannot be represented on this device."))}},e.prototype.getValuesFromTexture=function(t){var r,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.isPacked,u=k.util.sizeFromShape(i);if(k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,dn([l.texture.texture],Te(Jv(i)),!1)).subarray(0,u);return this.disposeIntermediateTensorInfo(c),f}var h=k.env().getBool("WEBGL_PACK")&&s===!0,d=h?ch(i):i,p=h?new HLe(d):new ULe(d),v=this.runWebGLProgram(p,[{shape:d,dtype:o,dataId:t}],"float32"),m=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeIntermediateTensorInfo(v),g},e.prototype.timerAvailable=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0},e.prototype.time=function(t){var r=this,a=this.activeTimers,i=[],o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();var s=k.util.flatten(this.activeTimers.map(function(l){return l.query})).filter(function(l){return l!=null}),u=k.util.flatten(this.activeTimers.map(function(l){return l.name})).filter(function(l){return l!=null});this.activeTimers=a,o&&(this.programTimersStack=null);var c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return function(){return Wc(r,void 0,void 0,function(){var l;return Vc(this,function(f){switch(f.label){case 0:return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=f.sent(),c.kernelMs=k.util.sum(l),c.getExtraProfileInfo=function(){return l.map(function(h,d){return{name:u[d],ms:h}}).map(function(h){return"".concat(h.name,": ").concat(h.ms)}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})}()},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}},e.prototype.startTimer=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:k.util.now(),endMs:null}},e.prototype.endTimer=function(t){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=k.util.now(),t)},e.prototype.getQueryTime=function(t){return Wc(this,void 0,void 0,function(){var r;return Vc(this,function(a){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(r=t,[2,r.endMs-r.startMs])})})},e.prototype.disposeData=function(t,r){if(r===void 0&&(r=!1),this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(r?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!r&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);var a=this.texData.get(t).complexTensorInfos;return a!=null&&(this.disposeData(a.real.dataId,r),this.disposeData(a.imag.dataId,r)),this.texData.delete(t),!0},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),a=r.texture,i=r.dtype,o=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.shouldExecuteOnCPU=function(t,r){var a=this;return r===void 0&&(r=cqe),k.env().getBool("WEBGL_CPU_FORWARD")&&t.every(function(i){return a.texData.get(i.dataId).texture==null&&k.util.sizeFromShape(i.shape)<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.where=function(t){k.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return iqe(t.shape,r)},e.prototype.packedUnaryOp=function(t,r,a){var i=new es(t.shape,r),o=this.compileAndRun(i,[t],a);return k.engine().makeTensorFromTensorInfo(o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){var r=gq(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,r)}if(k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,t$,t.dtype);var a=new Bi(t.shape,t$),i=this.compileAndRun(a,[t]);return k.engine().makeTensorFromTensorInfo(i)},e.prototype.makeTensorInfo=function(t,r,a){var i;if(r==="string"&&a!=null&&a.length>0&&k.util.isString(a[0])){var o=a.map(function(s){return k.util.encodeString(s)});i=this.write(o,t,r)}else i=this.write(a,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r,a){return k.engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,a),this)},e.prototype.unpackTensor=function(t){var r=new aqe(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new W$e(t.shape),a=!0;return this.runWebGLProgram(r,[t],t.dtype,null,a)},e.prototype.packedReshape=function(t,r){var a=dn([du(t.shape)],Te(pu(t.shape)),!1),i={dtype:t.dtype,shape:a,dataId:t.dataId},o=dn([du(r)],Te(pu(r)),!1),s=new wq(o,a),u=!0,c=[a],l=this.runWebGLProgram(s,[i],t.dtype,c,u);return{dataId:l.dataId,shape:r,dtype:l.dtype}},e.prototype.decode=function(t,r){var a=this.texData.get(t),i=a.isPacked,o=a.shape,s=a.dtype;if(r!=null){var u=k.util.sizeFromShape(o),c=r[0]*r[1]*4;k.util.assert(u<=c,function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."})}var l=ch(o),f;i?f=new GLe(l):f=new VLe(l);var h=!0,d=[r??Jv(l)],p=this.runWebGLProgram(f,[{shape:l,dtype:s,dataId:t}],s,d,h,r);return{dtype:s,shape:o,dataId:p.dataId}},e.prototype.runWebGLProgram=function(t,r,a,i,o,s){var u=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(t.outputShape,a),l=this.texData.get(c.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===hh.DENSE){var f=s??Jv(t.outputShape);l.texShape=f.map(function(N){return N*2})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),k.util.sizeFromShape(c.shape)===0)return l.values=k.util.getTypedArrayFromDType(c.dtype,0),c;var h=[],d=r.map(function(N){if(N.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var T=u.texData.get(N.dataId);if(T.texture==null){if(!t.packedInputs&&k.util.sizeFromShape(N.shape)<=k.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:N.shape,texData:null,isUniform:!0,uniformValues:T.values};t.packedInputs&&(T.isPacked=!0,T.shape=N.shape)}if(u.uploadToGPU(N.dataId),!!T.isPacked!=!!t.packedInputs)N=T.isPacked?u.unpackTensor(N):u.packTensor(N),h.push(N),T=u.texData.get(N.dataId);else if(T.isPacked&&!dh(T.shape,N.shape)){var E=N,C=N.shape;N.shape=T.shape,N=u.packedReshape(N,C),h.push(N),T=u.texData.get(N.dataId),E.shape=C}return{shape:N.shape,texData:T,isUniform:!1}});this.uploadToGPU(c.dataId);var p={shape:c.shape,texData:l,isUniform:!1},v=WLe(t,d,p),m=this.getAndSaveBinary(v,function(){return $Le(u.gpgpu,t,d,p)}),g=this.activeTimers!=null,y;g&&(y=this.startTimer()),k.env().get("ENGINE_COMPILE_ONLY")||qLe(this.gpgpu,m,d,p,i),h.forEach(function(N){return u.disposeIntermediateTensorInfo(N)}),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));var b=k.env().get("WEBGL_FLUSH_THRESHOLD");if(b>0){var w=k.util.now();w-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=w)}if(!k.env().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){var x=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),x}return c},e.prototype.compileAndRun=function(t,r,a,i,o){o===void 0&&(o=!1),a=a||r[0].dtype;var s=this.runWebGLProgram(t,r,a,i,o);return s},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;if(!this.disposed){if(!k.env().getBool("IS_TEST")){var r=Object.keys(this.binaryCache);r.forEach(function(a){t.gpgpu.deleteProgram(t.binaryCache[a].webGLProgram),delete t.binaryCache[a]})}this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=k.tidy(function(){if(!k.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=k.env().getBool("DEBUG");k.env().set("DEBUG",!1);var a=t.abs(k.scalar(1e-8)).dataSync()[0];if(k.env().set("DEBUG",r),a>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?oqe:sqe},e.prototype.uploadToGPU=function(t){var r,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.values,u=a.texture,c=a.usage,l=a.isPacked;if(u==null){var f=this.activeTimers!=null,h;f&&(h=k.util.now());var d=a.texShape;if(d==null&&(d=$$(i,l),a.texShape=d),s!=null){var p=ch(i),v=void 0,m=d[1],g=d[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!y)&&(r=Te(Uc(d[0],d[1]),2),m=r[0],g=r[1]),l?v=new jLe(p,y):v=new Kz(p,y);var b=y?[g,m]:d,w=this.makeTensorInfo(b,o),x=this.texData.get(w.dataId);y?x.usage=ba.PIXELS:x.usage=ba.UPLOAD,x.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),m,g,s);var N=[[g,m]],T=!0,E=this.runWebGLProgram(v,[w],o,N,T),C=this.texData.get(E.dataId);a.texShape=C.texShape,a.isPacked=C.isPacked,a.usage=C.usage,k.env().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(a.texture=C.texture,a.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(w),f&&(this.uploadWaitMs+=k.util.now()-h)}else{var F=this.acquireTexture(d,c,o,l);a.texture=F}}},e.prototype.convertAndCacheOnCPU=function(t,r){var a=this.texData.get(t),i=a.dtype;return r!=null&&(a.values=hqe(r,i)),a.values},e.prototype.acquireTexture=function(t,r,a,i){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(o," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,i)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*k.util.bytesPerElement(r)},e.prototype.checkCompileCompletion=function(){var t,r;try{for(var a=ra(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Te(i.value,2),s=o[1];this.checkCompletion_(s)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.checkCompileCompletionAsync=function(){return Wc(this,void 0,void 0,function(){var t,r,a,i,l,o,s,u,c,l,f,h,d,p,v=this;return Vc(this,function(m){if(t=[],this.gpgpu.parallelCompilationExtension){try{for(r=ra(Object.entries(this.binaryCache)),a=r.next();!a.done;a=r.next())i=Te(a.value,2),l=i[1],t.push(this.checkCompletionAsync_(l))}catch(g){f={error:g}}finally{try{a&&!a.done&&(h=r.return)&&h.call(r)}finally{if(f)throw f.error}}return[2,Promise.all(t)]}else{o=function(g){var y=new Promise(function(b){try{v.checkCompletion_(g),b(!0)}catch(w){throw w}});t.push(y)};try{for(s=ra(Object.entries(this.binaryCache)),u=s.next();!u.done;u=s.next())c=Te(u.value,2),l=c[1],o(l)}catch(g){d={error:g}}finally{try{u&&!u.done&&(p=s.return)&&p.call(s)}finally{if(d)throw d.error}}return[2,Promise.all(t)]}})})},e.prototype.checkCompletionAsync_=function(t){return Wc(this,void 0,void 0,function(){return Vc(this,function(r){switch(r.label){case 0:return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?[2,this.checkCompletion_(t)]:[3,1];case 1:return[4,k.nextFrame()];case 2:return r.sent(),[2,this.checkCompletionAsync_(t)]}})})},e.prototype.checkCompletion_=function(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Fx(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0},e.prototype.getUniformLocations=function(){var t,r;try{for(var a=ra(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Te(i.value,2),s=o[1],u=Z$(this.gpgpu,s.program,s.webGLProgram),c=u.uniformLocations,l=u.customUniformLocations,f=u.infLoc,h=u.nanLoc,d=u.inShapesLocations,p=u.inTexShapesLocations,v=u.outShapeLocation,m=u.outShapeStridesLocation,g=u.outTexShapeLocation;s.uniformLocations=c,s.customUniformLocations=l,s.infLoc=f,s.nanLoc=h,s.inShapesLocations=d,s.inTexShapesLocations=p,s.outShapeLocation=v,s.outShapeStridesLocation=m,s.outTexShapeLocation=g}}catch(y){t={error:y}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.createTensorFromGPUData=function(t,r,a){t.channels=t.channels||"RGBA";var i=t.texture,o=t.height,s=t.width,u=t.channels,c=k.engine().backend;if(!c.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var l=c.writeTexture(i,r,a,o,s,u);return k.engine().makeTensorFromDataId(l,r,a,c)},e}(k.KernelBackend);Wx.nextDataId=0;function hqe(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length),r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error("Unknown dtype ".concat(e))}var dqe="4.2.0";function xq(){k.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}k.device_util.isBrowser()&&k.registerBackend("webgl",function(){return new Wx},2);var pqe={forceHalfFloat:xq};var Vx=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,Gc=function(){function n(e,t,r){this.variableNames=["A","B"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,r),this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        `.concat(e,`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `)}return n}();var bh=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,wh=function(){function n(e,t,r,a){a===void 0&&(a=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,r);var i=this.outputShape.length;this.enableShapeUniforms=kr(i);var o="";if(a)if(i===0||k.util.sizeFromShape(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{var s=Wt(i);if(o=`
          `.concat(s,` coords = getOutputCoords();
        `),i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= `.concat(this.outputShape[0],` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `);else{var u=br("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= outShape[").concat(i,` - 2];
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= outShape[").concat(i,` - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `):o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],`;
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `)}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `.concat(e,`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `).concat(o,`

        setOutput(result);
      }
    `)}return n}();function aa(n){var e=n.inputs,t=n.backend,r=e.x;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var vqe={kernelName:k.Identity,backendName:"webgl",kernelFunc:aa};function ns(n){var e=n.inputs,t=n.backend,r=e.real,a=e.imag,i=t.makeTensorInfo(r.shape,"complex64"),o=t.texData.get(i.dataId),s=aa({inputs:{x:r},backend:t}),u=aa({inputs:{x:a},backend:t});return o.complexTensorInfos={real:s,imag:u},i}var mqe={kernelName:k.Complex,backendName:"webgl",kernelFunc:ns};var kq="return (a < 0.) ? b * a : a;",Sq=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function gqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.alpha,o=t.makeTensorInfo([],"float32",k.util.createScalarValue(i,"float32")),s=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wh(Sq,a.shape,o.shape):new Gc(kq,a.shape,o.shape),u=t.runWebGLProgram(s,[a,o],"float32");return t.disposeIntermediateTensorInfo(o),u}var yqe={kernelName:k.LeakyRelu,backendName:"webgl",kernelFunc:gqe};var Nq="return (a < 0.) ? b * a : a;",Tq=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function bqe(n){var e=n.inputs,t=n.backend,r=e.x,a=e.alpha,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wh(Tq,r.shape,a.shape):new Gc(Nq,r.shape,a.shape);return t.runWebGLProgram(i,[r,a],"float32")}var wqe={kernelName:k.Prelu,backendName:"webgl",kernelFunc:bqe},Zc="if (isnan(x)) return x;";function Nt(n){var e=n.opSnippet,t=n.packedOpSnippet,r=n.cpuKernelImpl,a=n.dtype;return function(i){var o=i.inputs,s=i.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&r!=null){var f=c.texData.get(u.dataId),h=r(f.values,l);return c.makeTensorInfo(u.shape,l,h)}var d=k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,p;return d?p=new es(u.shape,t):p=new Bi(u.shape,e),c.runWebGLProgram(p,[u],l)}}function or(n){var e=n.opSnippet,t=n.packedOpSnippet,r=n.checkOutOfBounds,a=r===void 0?!1:r,i=n.supportsComplex,o=i===void 0?!1:i,s=n.cpuKernelImpl,u=n.dtype;return function(c){var l=c.inputs,f=c.backend,h=l.a,d=l.b,p=f;if(o&&h.dtype==="complex64"){var v=p.texData.get(h.dataId),m=p.texData.get(d.dataId),g=Te([[v.complexTensorInfos.real,m.complexTensorInfos.real],[v.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(function(W){var X=Te(W,2),Z=X[0],V=X[1],j={dataId:Z.dataId,dtype:Z.dtype,shape:h.shape},re={dataId:V.dataId,dtype:V.dtype,shape:d.shape},ne=new Gc(e,h.shape,d.shape);return p.runWebGLProgram(ne,[j,re],k.upcastType(Z.dtype,V.dtype))}),2),y=g[0],b=g[1],w=ns({inputs:{real:y,imag:b},backend:p});return p.disposeIntermediateTensorInfo(y),p.disposeIntermediateTensorInfo(b),w}var x=u||k.upcastType(h.dtype,d.dtype);if((h.dtype==="string"||d.dtype==="string"||p.shouldExecuteOnCPU([h,d]))&&s!=null){var N=p.texData.get(h.dataId).values,T=p.texData.get(d.dataId).values,E=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(N):N,C=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(T):T,F=Te(s(h.shape,d.shape,E,C,x),2),D=F[0],O=F[1],L=p.makeTensorInfo(O,x),z=p.texData.get(L.dataId);return z.values=D,L}var $=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,B;return $?B=new wh(t,h.shape,d.shape,a):B=new Gc(e,h.shape,d.shape),p.runWebGLProgram(B,[h,d],x)}}function ph(n,e){if(e===void 0&&(e=!1),n==="linear")return e?Q$e:j$e;if(n==="relu")return e?tqe:Y$e;if(n==="elu")return e?eqe:X$e;if(n==="relu6")return e?nqe:Z$e;if(n==="prelu")return e?Tq:Nq;if(n==="leakyrelu")return e?Sq:kq;if(n==="sigmoid")return e?rqe:J$e;throw new Error("Activation ".concat(n," has not been implemented for the WebGL backend."))}var Eq=function(){function n(e,t,r,a,i,o,s,u,c){a===void 0&&(a=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),s===void 0&&(s=null),u===void 0&&(u=!1),c===void 0&&(c=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=kr(this.outputShape.length);var l=a?e[1]:e[2],f=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",p=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";s&&(u?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(s,`
        }`):c?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(s,`
        }`):m=`vec4 activation(vec4 x) {
          `.concat(s,`
        }`),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",w="rc.x";e[0]<t[0]?b="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(w="imod(rc.x, ".concat(t[0],")")),this.userCode=`
      `.concat(m,`
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = `).concat(f,`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = `).concat(b,`;
        int batchB = `).concat(w,`;
        for (int i = 0; i < `).concat(f,`; i++) {
          vec4 a = getMatrixA(batchA, `).concat(h,`);
          vec4 b = getMatrixB(batchB, `).concat(d,`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`).concat(p[0]," * ").concat(v[0],`);
          result += (`).concat(p[1]," * ").concat(v[1],`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `).concat(y,`

        `).concat(g,`

        setOutput(result);
      }
    `)}return n}();var n$={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},r$=function(){function n(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `.concat(e,`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `)}return n}(),a$="return a * b;";function Gx(n){var e=n.inputs,t=n.backend,r=e.a,a=e.b,i=k.backend_util.upcastType(r.dtype,a.dtype);if(r.dtype==="complex64"){var o=t.texData.get(r.dataId),s=t.texData.get(a.dataId),u=new r$(n$.REAL,r.shape,a.shape),c=new r$(n$.IMAG,r.shape,a.shape),l=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:r.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape}],f=t.runWebGLProgram(u,l,"float32"),h=t.runWebGLProgram(c,l,"float32"),d=ns({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),d}if(t.shouldExecuteOnCPU([r,a])){var o=t.texData.get(r.dataId),s=t.texData.get(a.dataId),p=Te(y$e(r.shape,a.shape,o.values,s.values,i),2),v=p[0],m=p[1],g=t.makeTensorInfo(m,i),y=t.texData.get(g.dataId);return y.values=v,g}var b;return k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?b=new wh(a$,r.shape,a.shape):b=new Gc(a$,r.shape,a.shape),t.runWebGLProgram(b,[r,a],i)}var xqe={kernelName:k.Multiply,backendName:"webgl",kernelFunc:Gx};function kqe(n,e,t){var r=dn([du(n.shape)],Te(pu(n.shape)),!1),a={dtype:n.dtype,shape:r,dataId:n.dataId},i=dn([du(e)],Te(pu(e)),!1),o=new wq(i,r),s=!0,u=[r],c=t.runWebGLProgram(o,[a],n.dtype,u,s);return{dataId:c.dataId,shape:e,dtype:c.dtype}}function Pe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.shape,o=t,s=k.util.sizeFromShape(a.shape),u=k.util.inferFromImplicitShape(i,s),c=k.util.sizeFromShape(u);k.util.assert(s===c,function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."});var l=o.texData.get(a.dataId);return l.isPacked&&!dh(a.shape,u)&&!(l.texture!==null&&dh(l.shape,u))?kqe(a,u,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var Sqe={kernelName:k.Reshape,backendName:"webgl",kernelFunc:Pe};var i$=function(){function n(e,t){this.variableNames=["x"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s=Math.floor(r/4)*4,u=r%4,c="sumValue += dot(values, ones);";if(t!=null){var l=1/t;c="sumValue += dot(values * ".concat(k.util.isInt(l)?l.toPrecision(2):l,", ones);")}var f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return 0.0;
        }
      `)),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `.concat(f,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(r,`;

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(s,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(c,`
        }

        int inIdx = inOffset + `).concat(s,`;
        if (`).concat(u===1,`) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          `).concat(c,`
        }
        setOutput(sumValue);
      }
    `)}return n}();var Nqe=function(){function n(e,t){this.variableNames=["x"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var l=Math.floor(r/4)*4,f=r%4,h=`
      if (`.concat(t==="sum",`) {
        sumValue += dot(values, ones);
      } else if (`).concat(t==="prod",`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `).concat(u,`(values, minMaxValue);
        if (`).concat(t==="min"," || ").concat(t==="max",`) {
          minMaxValue = `).concat(u,`(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `),d="vec4";t==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):t==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(s,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `).concat(p,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(r,`;

        vec4 minMaxValue = vec4(`).concat(s,`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          `).concat(d," values = ").concat(d,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          `).concat(d," values = ").concat(d,`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          `).concat(d," values = ").concat(d,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          `).concat(d," values = ").concat(d,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return n}();function Tqe(n){for(var e=[];e.length===0||e[e.length-1].outSize!==1;){var t=e.length?e[e.length-1].outSize:n[1],r=k.backend_util.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function gu(n,e,t,r){for(var a=Tqe(n.shape),i=n,o=0;o<a.length;o++){var s=a[o],u=s.inSize,c=s.windowSize,l=s.outSize,f=void 0,h=void 0;t==="mean"?f=o===0?new i$({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:l},u):new i$({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:l}):f=new Nqe({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:l},t),h=i,i=r.runWebGLProgram(f,[i],e),h.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(h)}return i}var Eqe=function(){function n(e,t){this.variableNames=["A"];for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=e[t[a]];this.outputShape=r,this.rank=r.length;var i=Wt(this.rank),o=Iqe(t);this.userCode=`
    void main() {
      `.concat(i,` resRC = getOutputCoords();
      setOutput(getA(`).concat(o,`));
    }
    `)}return n}();function Iqe(n){var e=n.length;if(e>6)throw Error("Transpose for rank ".concat(e," is not yet supported"));for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),a=0;a<n.length;a++)r[n[a]]=t[a];return r.join()}var Cqe=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=e[t[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Wt(this.rank),o=bq("rc",this.rank),s=new Array(this.rank),a=0;a<t.length;a++)s[t[a]]=o[a];var u="vec2(".concat(s.slice(-2).join(),")"),c="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),l="getChannel(getA(".concat(s.join(),"), ").concat(u,")");this.userCode=`
    void main() {
      `.concat(i,` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `).concat(l,`;
      if(`).concat(c,`) {
        result[1] = `).concat(l,`;
      }
      --`).concat(o[this.rank-1],`;
      if(++`).concat(o[this.rank-2]," < ").concat(r[this.rank-2],`) {
        result[2] = `).concat(l,`;
        if(`).concat(c,`) {
          result[3] = `).concat(l,`;
        }
      }
      setOutput(result);
    }
    `)}return n}();function hm(n,e,t){var r=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Cqe(n.shape,e):new Eqe(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}function Aqe(n,e,t,r){var a=e,i=n.shape.length,o=k.util.parseAxisParam(a,n.shape),s=o,u=k.backend_util.getAxesPermutation(s,i),c=u!=null,l=n;c&&(l=hm(n,u,r),s=k.backend_util.getInnerMostAxes(s.length,i)),k.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=Te(k.backend_util.computeOutAndReduceShapes(l.shape,s),2),h=f[0],d=f[1],p=h;t&&(p=k.backend_util.expandShapeToKeepDim(h,o));var v=k.util.sizeFromShape(d),m=k.util.sizeFromShape(n.shape),g=m/v,y=Pe({inputs:{x:l},attrs:{shape:[g,v]},backend:r}),b=k.sumOutType(n.dtype),w=gu(y,b,"sum",r),x=Pe({inputs:{x:w},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(w),c&&r.disposeIntermediateTensorInfo(l),x}function dm(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;return Aqe(a,i,o,t)}var _qe={kernelName:k.Sum,backendName:"webgl",kernelFunc:dm};function wr(n){for(var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.perm,o=t,s=a.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=a.shape[i[c]];var l;if(o.shouldExecuteOnCPU([a])){var f=o.texData.get(a.dataId),h=f.values,d=qx(h,a.shape,a.dtype,i,u);l=o.makeTensorInfo(u,a.dtype);var p=o.texData.get(l.dataId);p.values=d}else l=hm(a,i,o);return l}var Dqe={kernelName:k.Transpose,backendName:"webgl",kernelFunc:wr},Iq=1e3;function um(n){var e,t,r=n.a,a=n.b,i=n.transposeA,o=n.transposeB,s=n.backend,u=n.bias,c=u===void 0?null:u,l=n.preluActivationWeights,f=l===void 0?null:l,h=n.leakyreluAlpha,d=h===void 0?0:h,p=n.activation,v=p===void 0?null:p,m=r.shape.length,g=a.shape.length,y=i?r.shape[m-2]:r.shape[m-1],b=o?a.shape[g-1]:a.shape[g-2],w=i?r.shape[m-1]:r.shape[m-2],x=o?a.shape[g-2]:a.shape[g-1],N=r.shape.slice(0,-2),T=a.shape.slice(0,-2),E=k.util.sizeFromShape(N),C=k.util.sizeFromShape(T),F=k.broadcast_util.assertAndGetBroadcastShape(r.shape.slice(0,-2),a.shape.slice(0,-2)),D=F.concat([w,x]);k.util.assert(y===b,function(){return"Error in matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(r.shape," and ")+"".concat(a.shape," and transposeA=").concat(i)+" and transposeB=".concat(o," must match.")});var O=i?[E,y,w]:[E,w,y],L=o?[C,x,b]:[C,b,x],z=Pe({inputs:{x:r},backend:s,attrs:{shape:O}}),$=Pe({inputs:{x:a},backend:s,attrs:{shape:L}}),B=[z,$],W=Math.max(E,C),X=i?z.shape[1]:z.shape[2],Z=c!=null,V=f!=null,j=v==="leakyrelu",re=v!=null?ph(v,!0):null,ne=Z||V||j||re!=null,oe;if((w===1||x===1)&&X>Iq&&ne===!1){var le=z,pe=$;i&&(le=wr({inputs:{x:z},backend:s,attrs:{perm:[0,2,1]}}),B.push(le)),o&&(pe=wr({inputs:{x:$},backend:s,attrs:{perm:[0,2,1]}}),B.push(pe));var xe=x!==1,he=x===1,ye=le;xe&&(ye=Pe({inputs:{x:le},backend:s,attrs:{shape:[W,X,1]}}),B.push(ye));var we=x===1?2:1,Ae=pe;he&&(Ae=Pe({inputs:{x:pe},backend:s,attrs:{shape:[W,1,X]}}),B.push(Ae));var Ye=Gx({inputs:{a:ye,b:Ae},backend:s});oe=dm({inputs:{x:Ye},backend:s,attrs:{axis:we,keepDims:!0}}),B.push(Ye)}else{var ht=k.upcastType(r.dtype,a.dtype),at=new Eq(O,L,[W,w,x],i,o,Z,re,V,j),rt=[z,$];if(c!=null&&rt.push(c),V&&rt.push(f),j){var ft=s.makeTensorInfo([],"float32",k.util.createScalarValue(d,"float32"));rt.push(ft),B.push(ft)}oe=s.runWebGLProgram(at,rt,ht)}var st=Pe({inputs:{x:oe},backend:s,attrs:{shape:D}});B.push(oe);try{for(var Ze=ra(B),tt=Ze.next();!tt.done;tt=Ze.next()){var et=tt.value;s.disposeIntermediateTensorInfo(et)}}catch(rn){e={error:rn}}finally{try{tt&&!tt.done&&(t=Ze.return)&&t.call(Ze)}finally{if(e)throw e.error}}return st}function Fqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.a,i=e.b,o=e.bias,s=e.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation,f=r.leakyreluAlpha;return um({a,b:i,transposeA:u,transposeB:c,backend:t,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:l})}var Rqe={kernelName:k._FusedMatMul,backendName:"webgl",kernelFunc:Fqe};var o$="return abs(x);";function Oqe(n){var e=n.inputs,t=n.backend,r=e.x;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){var a=t.texData.get(r.dataId),i=gq(a.values);return t.makeTensorInfo(r.shape,r.dtype,i)}var o;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new es(r.shape,o$):o=new Bi(r.shape,o$),t.runWebGLProgram(o,[r],r.dtype)}var Pqe={kernelName:k.Abs,backendName:"webgl",kernelFunc:Oqe};var Mqe=Xa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Bqe=Nt({opSnippet:Mqe}),Lqe={kernelName:k.Acos,backendName:"webgl",kernelFunc:Bqe};var zqe=Xa+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,$qe=Nt({opSnippet:zqe}),qqe={kernelName:k.Acosh,backendName:"webgl",kernelFunc:$qe};var s$="return a + b;",Wqe=or({opSnippet:s$,packedOpSnippet:s$,supportsComplex:!0,cpuKernelImpl:Jze}),Vqe={kernelName:k.Add,backendName:"webgl",kernelFunc:Wqe};var Gqe=function(){function n(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var r=[];this.variableNames.forEach(function(i){r.push("float v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(r.join(`
        `),`

        float result = `).concat(a,`;
        setOutput(result);
      }
    `)}return n}();var Uqe=function(){function n(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var r=[];this.variableNames.forEach(function(i){r.push("vec4 v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(r.join(`
        `),`

        vec4 result = `).concat(a,`;
        setOutput(result);
      }
    `)}return n}();function sm(n){var e=n.inputs,t=n.backend,r=e;if(r.length===1)return aa({inputs:{x:r[0]},backend:t});if(r.length>k.env().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(r.length/2),i=sm({inputs:r.slice(0,a),backend:t}),o=sm({inputs:r.slice(a),backend:t});return sm({inputs:[i,o],backend:t})}var s=r.map(function(f){return f.dtype}).reduce(function(f,h){return k.upcastType(f,h)}),u=r.map(function(f){return f.shape}),c=k.env().getBool("WEBGL_PACK"),l=c?new Uqe(r[0].shape,u):new Gqe(r[0].shape,u);return t.runWebGLProgram(l,r,s)}var Hqe={kernelName:k.AddN,backendName:"webgl",kernelFunc:sm};function Kqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("all",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),d=h[0],p=h[1],v=k.util.sizeFromShape(p),m=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=gu(m,m.dtype,"all",t),y;if(o){var b=k.backend_util.expandShapeToKeepDim(d,u);y=Pe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Pe({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var jqe={kernelName:k.All,backendName:"webgl",kernelFunc:Kqe};function Xqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("any",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),d=h[0],p=h[1],v=k.util.sizeFromShape(p),m=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=gu(m,m.dtype,"any",t),y;if(o){var b=k.backend_util.expandShapeToKeepDim(d,u);y=Pe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Pe({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var Yqe={kernelName:k.Any,backendName:"webgl",kernelFunc:Xqe};var Zqe=function(){function n(e,t,r){this.variableNames=["A"];var a=e.windowSize,i=e.batchSize,o=e.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=t==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `.concat(a,`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `).concat(a,`; i++) {
          int inIdx = `).concat(u,`;
          float candidate = getA(batch, inIdx);
          if (candidate `).concat(s,` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `)}return n}();var Jqe=function(){function n(e,t,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,k.util.assert(e.length>2,function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")});var i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s=this.outputShape,u=s.length,c=Wt(u),l=br("coords",u),f,h;if(o===1){h=u+1;var d=Wt(h);f=`
        `.concat(d," sourceLocR = ").concat(d,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-1],`;
        `).concat(d," sourceLocG = ").concat(d,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-2],`;
        `).concat(d," sourceLocA = ").concat(d,"(").concat(l.join(),`, 0);
        --`).concat(l[u-1],`;
        `).concat(d," sourceLocB = ").concat(d,"(").concat(l.join(),`, 0);
        --`).concat(l[u-2],";")}else h=u,f=`
        `.concat(c,` sourceLocR = coords;
        ++`).concat(l[u-1],`;
        `).concat(c,` sourceLocG = coords;
        ++`).concat(l[u-2],`;
        `).concat(c,` sourceLocA = coords;
        --`).concat(l[u-1],`;
        `).concat(c,` sourceLocB = coords;
        --`).concat(l[u-2],";");var p=["x","y","z","w","u","v"].slice(0,h),v="."+p[h-1],m=p.map(function(C){return"int "+C}),g=br("sourceLocR",h-1).concat("inIdx.r"),y=br("sourceLocG",h-1).concat("inIdx.g"),b=br("sourceLocB",h-1).concat("inIdx.b"),w=br("sourceLocA",h-1).concat("inIdx.a"),x=r==="max"?"greaterThan":"lessThan",N=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`.concat(g.join(),`),
                             getBestIndicesAChannel(`).concat(y.join(),`),
                             getBestIndicesAChannel(`).concat(b.join(),`),
                             getBestIndicesAChannel(`).concat(w.join(),")));"),T=`vec4(
            getAChannel(`.concat(g.join(),`),
            hasNextCol ? getAChannel(`).concat(y.join(),`) : 0.,
            hasNextRow ? getAChannel(`).concat(b.join(),`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`).concat(w.join(),") : 0.)"),E=a?"":`
      float getBestIndicesAChannel(`.concat(m.join(),`) {
        return getChannel(getBestIndicesA(`).concat(p.join(),`),
                                          vec2(`).concat(p.slice(-2).join(),`));
      }`);this.userCode=`
      float getAChannel(`.concat(m.join(),`) {
        return getChannel(getA(`).concat(p.join(),`),
                               vec2(`).concat(p.slice(-2).join(),`));
      }
      `).concat(E,`
      void main() {
        `).concat(c,` coords = getOutputCoords();
        bool hasNextCol = `).concat(l[u-1]," < ").concat(s[u-1]-1,`;
        bool hasNextRow = `).concat(l[u-2]," < ").concat(s[u-2]-1,`;
        `).concat(f,`
        ivec4 srcIdx = ivec4(sourceLocR`).concat(v,", sourceLocG").concat(v,`,
          sourceLocB`).concat(v,", sourceLocA").concat(v,") * ").concat(t,`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `).concat(T,`;

        for (int i = 0; i < `).concat(t,`; i++) {
          inIdx = srcIdx;
          `).concat(N,`
          vec4 candidate = `).concat(T,`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`).concat(x,`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `)}return n}();function Cq(n,e,t,r){r===void 0&&(r=null);var a=e.shape[0],i=e.shape[1];r!=null&&(a=r.shape[0],i=r.shape[1]);var o=k.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new Zqe(s,t,r==null),c=[e];r!=null&&c.push(r);var l=n.runWebGLProgram(u,c,"int32");if(l.shape[1]===1)return l;var f=Cq(n,e,t,l);return n.disposeIntermediateTensorInfo(l),f}function Aq(n,e,t,r){r===void 0&&(r=null);var a=r!=null?r.shape:e.shape,i=a[a.length-1],o=k.backend_util.computeOptimalWindowSize(i),s=new Jqe(a,o,t,r==null),u=r==null?[e]:[e,r],c=n.runWebGLProgram(s,u,"int32");if(c.shape.length===e.shape.length){var l=Aq(n,e,t,c);return n.disposeIntermediateTensorInfo(c),l}return c}function _q(n,e,t,r){var a=[t];if(k.backend_util.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,e.shape.length),!k.env().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){var i=[],o=n.texData.get(e.dataId),s=o!==null&&o.isPacked,u=e;s&&(u=n.unpackTensor(e),i.push(u));var c=Te(k.backend_util.computeOutAndReduceShapes(u.shape,a),2),l=c[0],f=c[1],h=k.util.sizeFromShape(f),d=Pe({inputs:{x:u},backend:n,attrs:{shape:[-1,h]}});i.push(d);var p=Cq(n,d,r);i.push(p);var v=Pe({inputs:{x:p},backend:n,attrs:{shape:l}});return i.forEach(function(m){return n.disposeIntermediateTensorInfo(m)}),v}return Aq(n,e,r)}function Qqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=wr({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=_q(t,u,o[0],"max");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var eWe={kernelName:k.ArgMax,backendName:"webgl",kernelFunc:Qqe};function tWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=wr({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=_q(t,u,o[0],"min");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var nWe={kernelName:k.ArgMin,backendName:"webgl",kernelFunc:tWe};var rWe=Xa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,aWe=Nt({opSnippet:rWe}),iWe={kernelName:k.Asin,backendName:"webgl",kernelFunc:aWe};var oWe=Xa+"return log(x + sqrt(x * x + 1.0));",sWe=Nt({opSnippet:oWe}),uWe={kernelName:k.Asinh,backendName:"webgl",kernelFunc:sWe};var cWe=Xa+`
  return atan(x);
`,lWe=Nt({opSnippet:cWe}),fWe={kernelName:k.Atan,backendName:"webgl",kernelFunc:lWe};var hWe=Vx+`
  return atan(a, b);
`,dWe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+bh+`
  return result;
`,pWe=or({opSnippet:hWe,packedOpSnippet:dWe}),vWe={kernelName:k.Atan2,backendName:"webgl",kernelFunc:pWe};var mWe=Xa+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,gWe=Nt({opSnippet:mWe}),yWe={kernelName:k.Atanh,backendName:"webgl",kernelFunc:gWe};var vh=function(){function n(e,t,r,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;var v=t==="avg",m="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),y="0.0";if(v||(y="-1.0 / 1e-20"),r){var b=">=";this.userCode=`
        const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
        const ivec2 pads = ivec2(`).concat(d,", ").concat(p,`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `).concat(f,`;
              wR += `).concat(c,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(h,`;
                wC += `).concat(l,`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value `).concat(b,` currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `).concat(a?i?m:g:"wR * ".concat(h," + wC"),`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var w="max",x="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / max(count, 1.0)");var N=Math.floor(o/4)*4,T=o%4,E=`
      if (`.concat(v,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(w,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
      const ivec2 pads = ivec2(`).concat(d,", ").concat(p,`);
      const float initializationValue = `).concat(y,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(y,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `).concat(f,`;
            wR += `).concat(c,`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(N,`; wC += 4) {
            int xC = xCCorner + wC * `).concat(l,`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              getValue(batch, xR, xC + 3 * `).concat(l,`, d)
            );

            `).concat(E,`
          }

          int xC = xCCorner + `).concat(N,`;
          if (`).concat(T===1,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===2,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===3,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              initializationValue
            );

            `).concat(E,`
          }
        }
        setOutput(`).concat(x,`);
      }
    `)}return n}(),Ux=function(){function n(e,t,r,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,u=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,f=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,v=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var b=t==="avg",w="0.0";if(b||(w="-1.0 / 1e-20"),r){var x=">=";this.userCode=`
        const ivec3 strides =
            ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
        const ivec3 pads = ivec3(`).concat(m,", ").concat(g,", ").concat(y,`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `).concat(d,`;
              wD += `).concat(l,`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int wR = 0; wR < `).concat(p,`;
                wR += `).concat(f,`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int wC = 0; wC < `).concat(v,`;
                  wC += `).concat(h,`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value `).concat(x,` currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `).concat(a?i?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(p," * ").concat(v,` +
                      wR * `).concat(v," + wC"),`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var N="max",T="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(T="avgValue / max(count, 1.0)");var E=Math.floor(o/4)*4,C=o%4,F=`
      if (`.concat(b,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(N,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec3 strides =
        ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
      const ivec3 pads = ivec3(`).concat(m,", ").concat(g,", ").concat(y,`);
      const float initializationValue = `).concat(w,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(w,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `).concat(d,`;
            wD += `).concat(l,`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(p,`;
            wR += `).concat(f,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(E,`; wC += 4) {
              int xC = xCCorner + wC * `).concat(h,`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 3 * `).concat(h,`, ch)
              );

              `).concat(F,`
            }

            int xC = xCCorner + `).concat(E,`;
            if (`).concat(C===1,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `).concat(F,`
            } else if (`).concat(C===2,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                initializationValue,
                initializationValue
              );

              `).concat(F,`
            } else if (`).concat(C===3,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                initializationValue
              );

              `).concat(F,`
            }
          }
        }
        setOutput(`).concat(T,`);
      }
    `)}return n}();function bWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Hc(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return aa({inputs:{x:a},backend:t});var f=new vh(l,"avg",!1);return t.runWebGLProgram(f,[a],"float32")}var wWe={kernelName:k.AvgPool,backendName:"webgl",kernelFunc:bWe};function xWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,u,c),h=new Ux(f,"avg",!1);return t.runWebGLProgram(h,[a],"float32")}var kWe={kernelName:k.AvgPool3D,backendName:"webgl",kernelFunc:xWe};var SWe=function(){function n(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=u-1-e.padInfo.top,f=c-1-e.padInfo.left,h=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(`.concat(l,", ").concat(f,`);
      const float avgMultiplier = float(`).concat(h,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(u,`;
            wR += `).concat(o,`) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(c,`;
            wC+= `).concat(s,`) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),NWe=function(){function n(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,r=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=f-1-e.padInfo.front,v=h-1-e.padInfo.top,m=d-1-e.padInfo.left,g=1/(t*r*a);this.userCode=`
      const ivec3 pads = ivec3(`.concat(p,", ").concat(v,", ").concat(m,`);
      const float avgMultiplier = float(`).concat(g,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(f,`;
            wD += `).concat(u,`) {
          float dyD = float(dyDCorner + wD) / `).concat(i,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(h,`;
              wR += `).concat(c,`) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(d,`;
                wC += `).concat(l,`) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function TWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),d=new NWe(h);return t.runWebGLProgram(d,[a],o.dtype)}var EWe={kernelName:k.AvgPool3DGrad,backendName:"webgl",kernelFunc:TWe};function IWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i;Hc([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=k.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=new SWe(l);return t.runWebGLProgram(f,[a],o.dtype)}var CWe={kernelName:k.AvgPoolGrad,backendName:"webgl",kernelFunc:IWe};function AWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.a,i=e.b,o=r.transposeA,s=r.transposeB;return um({a,b:i,transposeA:o,transposeB:s,backend:t})}var _We={kernelName:k.BatchMatMul,backendName:"webgl",kernelFunc:AWe};var DWe=function(){function n(e,t,r,a,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,r);var s="0.0";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `.concat(s,`;
        float scale = `).concat(u,`;
        float inv = scale * inversesqrt(variance + float(`).concat(o,`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `)}return n}();var FWe=function(){function n(e,t,r,a,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,r);var s="vec4(0.0)";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `.concat(s,`;
        vec4 scale = `).concat(u,`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`).concat(o,`));

        setOutput((x - mean) * inv + offset);
      }
    `)}return n}();var RWe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.mean,o=e.variance,s=e.offset,u=e.scale;k.util.assert(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),k.util.assert(s==null||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),k.util.assert(u==null||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var c=r.varianceEpsilon;c==null&&(c=.001);var l=[a,i,o],f=null;s!=null&&(f=s.shape,l.push(s));var h=null;u!=null&&(h=u.shape,l.push(u));var d=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new FWe(a.shape,i.shape,o.shape,f,h,c):new DWe(a.shape,i.shape,o.shape,f,h,c),p=t.runWebGLProgram(d,l,l[0].dtype);return p},OWe={kernelName:k.FusedBatchNorm,backendName:"webgl",kernelFunc:RWe};var PWe=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=Wt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r=MWe(this.rank),a,i=e.map(function(o,s){return"sourceLoc.".concat(Cx[s]," = start[").concat(s,"] + coords.").concat(Cx[s],";")});a=`
        `.concat(t,` sourceLoc;
        `).concat(t,` coords = getOutputCoords();
        `).concat(i.join(`
`),`
      `),this.userCode=`
      void main() {
        `.concat(a,`
        setOutput(getSource(`).concat(r,`));
      }
    `)}return n}(),Cx=["x","y","z","w","u","v"];function MWe(n){if(n===1)return"sourceLoc";if(n<=6)return Cx.slice(0,n).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank ".concat(n," is not yet supported"))}var BWe=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var t=Wt(this.rank),r=br("coords",this.rank),a=br("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s=`
      result.x = `.concat(o,`;
      if (++`).concat(r[this.rank-1]," < ").concat(e[this.rank-1],`) {
        ++`).concat(a[this.rank-1],`;
        result.y = `).concat(o,`;
        --`).concat(a[this.rank-1],`;
      }
    `),u=this.rank===1?"":`
      --`.concat(r[this.rank-1],`;
      if (++`).concat(r[this.rank-2]," < ").concat(e[this.rank-2],`) {
        ++`).concat(a[this.rank-2],`;
        result.z = `).concat(o,`;
        if (++`).concat(r[this.rank-1]," < ").concat(e[this.rank-1],`) {
          ++`).concat(a[this.rank-1],`;
          result.w = `).concat(o,`;
        }
      }
    `),c=this.rank<=4?`sourceLoc = coords +
            `.concat(t,"(").concat(e.map(function(l,f){return"start[".concat(f,"]")}).join(),");"):e.map(function(l,f){return"".concat(a[f]," = ").concat(r[f]," + start[").concat(f,"];")}).join(`
`);this.userCode=`
      void main() {
        `.concat(t,` coords = getOutputCoords();
        `).concat(t,` sourceLoc;
        `).concat(c,`
        vec4 result = vec4(0.);
        `).concat(s,`
        `).concat(u,`
        setOutput(result);
      }
    `)}return n}();function LWe(n,e,t,r){var a=r.texData.get(n.dataId),i=r.makeTensorInfo(t,n.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=t,o.dtype=n.dtype;var s=k.slice_util.computeFlatOffset(e,k.util.computeStrides(n.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||n.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}function Jc(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.size,s=Te(k.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];if(k.slice_util.assertParamsValid(a,u,c),k.util.sizeFromShape(c)===0)return t.makeTensorInfo(c,a.dtype,[]);if(t.shouldExecuteOnCPU([a])||a.dtype==="string"){var l=t.texData.get(a.dataId),f=A$e(l.values,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var h=t.texData.get(a.dataId).isPacked,d=k.slice_util.isSliceContinous(a.shape,u,c);if(h||!d){var p=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new BWe(c):new PWe(c),v=[u];return t.runWebGLProgram(p,[a],a.dtype,v)}return t.uploadToGPU(a.dataId),LWe(a,u,c,t)}var zWe={kernelName:k.Slice,backendName:"webgl",kernelFunc:Jc};var $We=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.crops;k.util.assert(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=k.backend_util.getReshaped(a.shape,i,s),c=k.backend_util.getPermuted(u.length,i.length),l=k.backend_util.getReshapedPermuted(a.shape,i,s),f=k.backend_util.getSliceBeginCoords(o,i.length),h=k.backend_util.getSliceSize(l,o,i.length),d=[],p=Pe({inputs:{x:a},backend:t,attrs:{shape:u}}),v=wr({inputs:{x:p},backend:t,attrs:{perm:c}}),m=Pe({inputs:{x:v},backend:t,attrs:{shape:l}}),g=Jc({inputs:{x:m},backend:t,attrs:{begin:f,size:h}});return d.push(p),d.push(v),d.push(m),d.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},qWe={kernelName:k.BatchToSpaceND,backendName:"webgl",kernelFunc:$We};function WWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=mq(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var VWe={kernelName:k.Bincount,backendName:"webgl",kernelFunc:WWe};function GWe(n){var e=n.inputs,t=n.backend,r=e.s0,a=e.s1,i=t.readSync(r.dataId),o=t.readSync(a.dataId),s=k.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var UWe={kernelName:k.BroadcastArgs,backendName:"webgl",kernelFunc:GWe};var HWe="return float(a != b);",Dq=or({opSnippet:HWe,cpuKernelImpl:w$e,dtype:"bool"}),KWe={kernelName:k.NotEqual,backendName:"webgl",kernelFunc:Dq};function xh(n){var e=n.inputs,t=n.backend,r=e.input,a=t.texData.get(r.dataId);return aa({inputs:{x:a.complexTensorInfos.real},backend:t})}var jWe={kernelName:k.Real,backendName:"webgl",kernelFunc:xh};var XWe="return float(int(x));";function YWe(n,e){var t=new Bi(n.shape,XWe),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function Ax(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dtype;if(i==="complex64"){if(a.dtype==="complex64")return aa({inputs:{x:a},backend:t});var o=zBe.zeros(a.shape),s=Ax({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=ns({inputs:{real:s,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=xh({inputs:{input:a},backend:t}),u=Ax({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!k.util.hasEncodingLoss(a.dtype,i)){var u=aa({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}if(t.shouldExecuteOnCPU([a])){var l=t.texData.get(a.dataId).values,f=Te(e$e(l,a.shape,a.dtype,i),3),h=f[0],d=f[1],p=f[2];return t.makeTensorInfo(h,d,p)}if(i==="int32")return YWe(a,t);if(i==="bool"){var v=t.makeTensorInfo([],"bool",k.util.getTypedArrayFromDType("bool",1)),m={a,b:v},u=Dq({inputs:m,backend:t});return t.disposeIntermediateTensorInfo(v),u}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var ZWe={kernelName:k.Cast,backendName:"webgl",kernelFunc:Ax};var u$="return ceil(x);",JWe=Nt({opSnippet:u$,packedOpSnippet:u$,cpuKernelImpl:t$e}),QWe={kernelName:k.Ceil,backendName:"webgl",kernelFunc:JWe};var eVe=function(){function n(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n}();var tVe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n}();function nVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.clipValueMin,o=r.clipValueMax,s;k.env().getBool("WEBGL_PACK_CLIP")?s=new tVe(a.shape):s=new eVe(a.shape);var u=[[i],[o]];return t.runWebGLProgram(s,[a],a.dtype,u)}var rVe={kernelName:k.ClipByValue,backendName:"webgl",kernelFunc:nVe};var aVe=function(){function n(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}return n}();function c$(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function iVe(n){var e=n.inputs,t=n.backend,r=e.x,a=t.texData.get(r.dataId),i=new aVe(r.shape),o=[c$(r,a.complexTensorInfos.real),c$(r,a.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}var oVe={kernelName:k.ComplexAbs,backendName:"webgl",kernelFunc:iVe};var sVe=function(){function n(e){this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,1),this.variableNames=e.map(function(u,c){return"T".concat(c)});var t=new Array(e.length-1);t[0]=e[0][1];for(var r=1;r<t.length;r++)t[r]=t[r-1]+e[r][1];for(var a=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")],r=1;r<t.length;r++){var i=t[r-1];a.push("else if (yC < ".concat(t[r],") ")+"setOutput(getT".concat(r,"(yR, yC-").concat(i,"));"))}var o=t.length,s=t[t.length-1];a.push("else setOutput(getT".concat(o,"(yR, yC-").concat(s,"));")),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `.concat(a.join(`
        `),`
      }
    `)}return n}();var uVe=function(){function n(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,t);var r=this.outputShape,a=r.length,i=Wt(a),o=br("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(function(g,y){return"T".concat(y)});var u=new Array(e.length-1);u[0]=e[0][t];for(var c=1;c<u.length;c++)u[c]=u[c-1]+e[c][t];for(var l=s[t],f=s.slice(-2),h=s.join(),d="if (".concat(l," < ").concat(u[0],`) {
        return getChannel(
            getT0(`).concat(h,"), vec2(").concat(f.join(),`));
        }`),c=1;c<u.length;c++){var p=u[c-1];d+=`
        if (`.concat(l," < ").concat(u[c],"  && ").concat(l," >= ").concat(u[c-1],`) {
          return getChannel(
            getT`).concat(c,"(").concat(tm(s,l,p),`),
            vec2(`).concat(tm(f,l,p),`));
        }`)}var v=u.length,m=u[u.length-1];d+=`
        return getChannel(
          getT`.concat(v,"(").concat(tm(s,l,m),`),
          vec2(`).concat(tm(f,l,m),"));"),this.userCode=`
      float getValue(`.concat(s.map(function(g){return"int "+g}),`) {
        `).concat(d,`
      }

      void main() {
        `).concat(i,` coords = getOutputCoords();
        vec4 result = vec4(getValue(`).concat(o,`), 0., 0., 0.);

        `).concat(o[a-1]," = ").concat(o[a-1],` + 1;
        if (`).concat(o[a-1]," < ").concat(r[a-1],`) {
          result.g = getValue(`).concat(o,`);
        }

        `).concat(o[a-2]," = ").concat(o[a-2],` + 1;
        if (`).concat(o[a-2]," < ").concat(r[a-2],`) {
          result.a = getValue(`).concat(o,`);
        }

        `).concat(o[a-1]," = ").concat(o[a-1],` - 1;
        if (`).concat(o[a-2]," < ").concat(r[a-2],` &&
            `).concat(o[a-1]," < ").concat(r[a-1],`) {
          result.b = getValue(`).concat(o,`);
        }
        setOutput(result);
      }
    `)}return n}();function tm(n,e,t){var r=n.indexOf(e),a=n.map(function(i,o){return o===r?"".concat(i," - ").concat(t):i});return a.join()}function pm(n){var e=n.inputs,t=n.backend,r=e.input,a=t.texData.get(r.dataId);return aa({inputs:{x:a.complexTensorInfos.imag},backend:t})}var cVe={kernelName:k.Imag,backendName:"webgl",kernelFunc:pm};function fh(n,e,t){var r,a,i=n[0].dtype;if(i==="complex64"){var o=n.map(function(V){return xh({inputs:{input:V},backend:t})}),s=n.map(function(V){return pm({inputs:{input:V},backend:t})}),u=fh(o,e,t),c=fh(s,e,t),l=ns({inputs:{real:u,imag:c},backend:t});return o.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),s.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),l}var f=t.shouldExecuteOnCPU(n);if(i==="string"&&(f=!0),f){var h=n.map(function(V){var j=k.util.sizeFromShape(V.shape.slice(e)),re=[-1,j];return Pe({inputs:{x:V},backend:t,attrs:{shape:re}})}),d=h.map(function(V){return{vals:t.readSync(V.dataId),shape:V.shape}}),p=k.backend_util.computeOutShape(h.map(function(V){return V.shape}),1),v=h[0].shape[0]===1,m=n$e(d,p,i,v),g=k.backend_util.computeOutShape(n.map(function(V){return V.shape}),e),y=t.makeTensorInfo(g,i,m);return h.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),y}var b=n.filter(function(V){return k.util.sizeFromShape(V.shape)>0}),w=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&b[0].shape.length>1;if(b.length===1){var x=w?new Bi(n[0].shape,Qo):new es(n[0].shape,Qo);return t.runWebGLProgram(x,n,i)}var N=k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(b.length>N){for(var T=[],E=0;E<b.length;E+=N){var C=b.slice(E,E+N);T.push(fh(C,e,t))}var F=fh(T,e,t);try{for(var D=ra(T),O=D.next();!O.done;O=D.next()){var E=O.value;t.disposeIntermediateTensorInfo(E)}}catch(V){r={error:V}}finally{try{O&&!O.done&&(a=D.return)&&a.call(D)}finally{if(r)throw r.error}}return F}if(w){var L=new uVe(b.map(function(V){return V.shape}),e);return t.runWebGLProgram(L,b,i)}var z=lVe(b,e,t),$=z.tensors2D,B=z.outShape,W=new sVe($.map(function(V){return V.shape})),X=t.runWebGLProgram(W,$,i);$.forEach(function(V){return t.disposeIntermediateTensorInfo(V)});var Z=Pe({inputs:{x:X},attrs:{shape:B},backend:t});return t.disposeIntermediateTensorInfo(X),Z}function lVe(n,e,t){var r=k.backend_util.computeOutShape(n.map(function(i){return i.shape}),e),a=n.map(function(i){return Pe({inputs:{x:i},attrs:{shape:[-1,k.util.sizeFromShape(i.shape.slice(e))]},backend:t})});return{tensors2D:a,outShape:r}}function Fq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis,i=k.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(c){return c.shape});k.backend_util.assertParamsConsistent(o,i);var s=k.backend_util.computeOutShape(e.map(function(c){return c.shape}),i);if(k.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(c){return k.util.sizeFromShape(c.shape)>0});return u.length===1?aa({inputs:{x:u[0]},backend:t}):fh(u,i,t)}var fVe={kernelName:k.Concat,backendName:"webgl",kernelFunc:Fq};var Rq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,m=e.dataFormat==="channelsLast",g=m?1:2,y=m?2:3,b=m?3:1,w="",x="";r&&(a?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(r,`
        }`):i?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(r,`
        }`):w=`
          float activation(float x) {
            `.concat(r,`
          }
        `),x="result = activation(result);");var N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(w,`

      const ivec2 strides = ivec2(`).concat(u,", ").concat(c,`);
      const ivec2 pads = ivec2(`).concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`).concat(b,`];

        ivec2 xRCCorner =
            ivec2(coords[`).concat(g,"], coords[").concat(y,`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(h,`; wR++) {
          int xR = xRCorner + wR * `).concat(l,`;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(d,`; wC++) {
            int xC = xCCorner + wC * `).concat(f,`;

            if (xC < 0 || xC >= `).concat(e.inWidth,`) {
              continue;
            }

            for (int d1 = 0; d1 < `).concat(p,`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`).concat(m,`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`).concat(v===1,`) {

              if (`).concat(m,`) {
                dotProd +=
                    getX(batch, xR, xC, `).concat(p,`) *
                    getW(wR, wC, `).concat(p,`, d2);
              } else {
                dotProd +=
                    getX(batch, `).concat(p,`, xR, xC) *
                    getW(wR, wC, `).concat(p,`, d2);
              }

            } else if (`).concat(v===2,`) {
              vec2 wValues = vec2(
                getW(wR, wC, `).concat(p,`, d2),
                getW(wR, wC, `).concat(p,` + 1, d2)
              );

              if (`).concat(m,`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `).concat(p,`),
                  getX(batch, xR, xC, `).concat(p,` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `).concat(p,`, xR, xC),
                  getX(batch, `).concat(p,` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`).concat(v===3,`) {
              vec3 wValues = vec3(
                getW(wR, wC, `).concat(p,`, d2),
                getW(wR, wC, `).concat(p,` + 1, d2),
                getW(wR, wC, `).concat(p,` + 2, d2)
              );

              if (`).concat(m,`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `).concat(p,`),
                  getX(batch, xR, xC, `).concat(p,` + 1),
                  getX(batch, xR, xC, `).concat(p,` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `).concat(p,`, xR, xC),
                  getX(batch, `).concat(p,` + 1, xR, xC),
                  getX(batch, `).concat(p,` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `).concat(N,`
        `).concat(x,`
        setOutput(result);
      }
    `)}return n}(),hVe=function(){function n(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,r=e.padInfo.top,a=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.filterDepth,h=e.filterHeight,d=e.filterWidth,p=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`.concat(i,", ").concat(o,", ").concat(s,`);
      const ivec3 pads = ivec3(`).concat(t,", ").concat(r,", ").concat(a,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(f,`; wF++) {
          int xF = xFCorner + wF * `).concat(u,`;

          if (xF < 0 || xF >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(h,`; wR++) {
            int xR = xRCorner + wR * `).concat(c,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(d,`; wC++) {
              int xC = xCCorner + wC * `).concat(l,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              for (int d1 = 0; d1 < `).concat(p,`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`).concat(v===1,`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `).concat(p,`) *
                  getW(wF, wR, wC, `).concat(p,`, d2);
              } else if (`).concat(v===2,`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `).concat(p,`),
                  getX(batch, xF, xR, xC, `).concat(p,` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `).concat(p,`, d2),
                  getW(wF, wR, wC, `).concat(p,` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`).concat(v===3,`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `).concat(p,`),
                  getX(batch, xF, xR, xC, `).concat(p,` + 1),
                  getX(batch, xF, xR, xC, `).concat(p,` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `).concat(p,`, d2),
                  getW(wF, wR, wC, `).concat(p,` + 1, d2),
                  getW(wF, wR, wC, `).concat(p,` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();var Oq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kr(this.outputShape.length);for(var o=e.padInfo.left,s=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,l=e.filterWidth,f=l,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`,d=0;d<l;d++)h+=`
           vec4 xTexelC`.concat(d*2,`;
           int xTexelC`).concat(d*2,`Ready;
           vec4 xTexelC`).concat(d*2+1,`;
           int xTexelC`).concat(d*2+1,`Ready;
           vec4 xC`).concat(d,";");h+=`
     for (int r = 0; r < `.concat(c,`; r++) {
      for (int d1 = 0; d1 < `).concat(e.inChannels,`; d1 += 2) {
       `);for(var d=0;d<l;d++)h+=`
           xTexelC`.concat(d*2,` = vec4(0.0);
           xTexelC`).concat(d*2,`Ready = 0;
           xTexelC`).concat(d*2+1,` = vec4(0.0);
           xTexelC`).concat(d*2+1,`Ready = 0;
           xC`).concat(d," = vec4(0.0);");h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(var p=0;p<(f+1)/2;p++){var v=p*2;if(h+=`
           xC = xCCorner + `.concat(v*u,`;
           `),s===1){if(v<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }
               `),u===1&&v>0?h+=`
                 xC`.concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,`.xy);
                 `):h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC`.concat(v," = vec4(previous.zw, xTexelC").concat(v,`.xy);
                   } else {
                     xC`).concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,`.xy);
                   }
                   `)):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }

                 xC`).concat(v," = xTexelC").concat(v,`;
                 `),v+1<l)){var m=o%2===0?k.util.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + `.concat(m,`;

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                     xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC`).concat(v+1,`.zw = vec2(0.0);
                     }
                     xTexelC`).concat(v+1,`Ready = 1;
                   }
                   `),u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC`.concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,`.xy);
                     } else {
                      xC`).concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,`.xy);
                     }
                     `):h+=`
                     xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.xy);
                     `)):m===1?h+=`
                     xC`.concat(v+1," = xTexelC").concat(v,`;
                     `):h+=`
                     xCOffset = xC + `.concat(m,`;

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                       xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC`).concat(v+1,`.zw = vec2(0.0);
                       }
                       xTexelC`).concat(v+1,`Ready = 1;
                     }

                     xC`).concat(v+1," = xTexelC").concat(v+1,`;
                     `)}}else v<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                   xTexelC`).concat(v+1,` = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC`).concat(v+1,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v+1,`Ready = 1;
                 }

                 xC`).concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
               `),v+1<l&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC`.concat(v+1," = vec4(xTexelC").concat(v+1,`.xy, final.xy);
                 `))):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                   xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(v+1,`.zw = vec2(0.);
                   }
                   xTexelC`).concat(v+1,`Ready = 1;
                 }

                 xC`).concat(v,` = vec4(
                   xTexelC`).concat(v,".xy, xTexelC").concat(v+1,`.xy);
               `),v+1<l&&(h+=`
                   xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
                 `))));v<l&&(h+=`
             wTexel = getW(r, `.concat(v,`, d1, d2);
             dotProd += xC`).concat(v,`.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < `).concat(e.inChannels,`) {
               dotProd += xC`).concat(v,`.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `),v+1<l&&(h+=`
               wTexel = getW(r, `.concat(v+1,`, d1, d2);
               dotProd += xC`).concat(v+1,`.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < `).concat(e.inChannels,`) {
                 dotProd += xC`).concat(v+1,`.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `)))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;var g="",y="";r&&(a?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           `.concat(r,`
         }`):i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           `.concat(r,`
         }`):g=`vec4 activation(vec4 x) {
           `.concat(r,`
         }`),y="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       `.concat(g,`

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         `).concat(h,`

         vec4 result = dotProd - vec4(0.000000000000001);
         `).concat(b,`
         `).concat(y,`
         setOutput(result);
       }
     `)}return n}();var dVe=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);for(var r=t.dataFormat,a=xr(),i=r==="channelsLast",o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {"),c="",l=0;l<=1;l++)for(var f=0;f<=1;f++)c+=`
          blockIndex = rc.z + `.concat(f,`;
          pos = rc.y + `).concat(l,`;

          `).concat(u,`
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[`).concat(o,`] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[`).concat(s,`] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (`).concat(i,`) {
                  innerDims = vec2(d1, ch);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `);this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `.concat(c,`

        `).concat(a.output,` = result;
      }
    `)}return n}();function cm(n,e){var t=n.length;return t>=3?e?dn(dn([],Te(n.slice(0,-3)),!1),[n[t-3]*n[t-2],n[t-1]],!1):dn(dn([],Te(n.slice(0,-3)),!1),[n[t-3],n[t-2]*n[t-1]],!1):!e&&t===1&&n[0]>1?[n[0],1]:null}function Pq(n){var e,t,r=n.x,a=n.filter,i=n.convInfo,o=n.backend,s=n.bias,u=s===void 0?null:s,c=n.preluActivationWeights,l=c===void 0?null:c,f=n.leakyreluAlpha,h=f===void 0?0:f,d=n.activation,p=d===void 0?null:d,v=r.shape,m=o.texData.get(r.dataId),g=i.inChannels,y=v[0]*v[1]*v[2],b=i.outChannels,w=i.dataFormat==="channelsLast",x=!1,N=!1,T,E=[];if(l!=null){var C=cm(l.shape,w);C!=null&&(l=Pe({inputs:{x:l},backend:o,attrs:{shape:C}}),E.push(l))}if(u!=null){var C=cm(u.shape,w);C!=null&&(u=Pe({inputs:{x:u},backend:o,attrs:{shape:C}}),E.push(u))}var F=(y===1||b===1)&&g>Iq,D=!F&&m.isPacked&&w&&m.texture!=null&&v[2]%2!==0&&k.util.arraysEqual(m.shape.slice(-3),v.slice(-3));if(D){var C=v[0]*v[1]*(v[2]+1),O={dataId:r.dataId,shape:[1,C,i.inChannels],dtype:r.dtype},L=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,k.util.assert(dh(m.shape,O.shape),function(){return"packed reshape ".concat(m.shape," to ").concat(O.shape," isn't free")});var z=Pe({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});E.push(z);var $=um({a:O,b:z,backend:o,transposeA:x,transposeB:N,bias:u,activation:p,preluActivationWeights:l,leakyreluAlpha:h}),B=o.texData.get($.dataId);k.util.assert(B.isPacked,function(){return"batchMatMul result is expected to be packed"}),m.shape=L,B.shape=i.outShape,T=aa({inputs:{x:$},backend:o}),T.shape=i.outShape,E.push($)}else{var W=i.outHeight*i.outWidth,X=Pe({inputs:{x:r},backend:o,attrs:{shape:w?[i.batchSize,W,i.inChannels]:[i.batchSize,i.inChannels,W]}}),z=Pe({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),Z=um({a:w?X:z,b:w?z:X,transposeA:!w,transposeB:N,backend:o,bias:u,activation:p,preluActivationWeights:l,leakyreluAlpha:h});T=Pe({inputs:{x:Z},backend:o,attrs:{shape:i.outShape}}),E.push(X),E.push(z),E.push(Z)}try{for(var V=ra(E),j=V.next();!j.done;j=V.next()){var re=j.value;o.disposeIntermediateTensorInfo(re)}}catch(ne){e={error:ne}}finally{try{j&&!j.done&&(t=V.return)&&t.call(V)}finally{if(e)throw e.error}}return T}function Mq(n){var e,t,r=n.x,a=n.filter,i=n.convInfo,o=n.backend,s=n.bias,u=s===void 0?null:s,c=n.preluActivationWeights,l=c===void 0?null:c,f=n.leakyreluAlpha,h=f===void 0?0:f,d=n.activation,p=d===void 0?null:d,v=i.filterWidth,m=i.filterHeight,g=i.inChannels,y=i.outWidth,b=i.outHeight,w=i.dataFormat,x=w==="channelsLast",N=v*m*g,T=b*y,E=[i.batchSize,N,T],C=!0,F=!1,D=[];if(l!=null){var O=cm(l.shape,x);O!=null&&(l=Pe({inputs:{x:l},backend:o,attrs:{shape:O}}),D.push(l))}if(u!=null){var O=cm(u.shape,x);O!=null&&(u=Pe({inputs:{x:u},backend:o,attrs:{shape:O}}),D.push(u))}var L=Pe({inputs:{x:a},backend:o,attrs:{shape:[1,N,k.util.sizeFromShape(a.shape)/N]}});D.push(L);var z=new dVe(E,i),$=[r.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],B=o.runWebGLProgram(z,[r],"float32",$),W=Pe({inputs:{x:B},backend:o,attrs:{shape:E}});D.push(B),D.push(W);var X=u!=null,Z=l!=null,V=p==="leakyrelu",j=p?ph(p,!0):null,re=new Eq(x?W.shape:L.shape,x?L.shape:W.shape,x?[i.batchSize,T,i.outChannels]:[i.batchSize,i.outChannels,T],C,F,X,j,Z,V),ne=x?[W,L]:[L,W];if(u&&ne.push(u),Z&&ne.push(l),V){var oe=o.makeTensorInfo([],"float32",k.util.createScalarValue(h,"float32"));ne.push(oe),D.push(oe)}var le=o.runWebGLProgram(re,ne,"float32"),pe=Pe({inputs:{x:le},backend:o,attrs:{shape:i.outShape}});D.push(le);try{for(var xe=ra(D),he=xe.next();!he.done;he=xe.next()){var ye=he.value;o.disposeIntermediateTensorInfo(ye)}}catch(we){e={error:we}}finally{try{he&&!he.done&&(t=xe.return)&&t.call(xe)}finally{if(e)throw e.error}}return pe}function pVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),d;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))d=Pq({x:a,filter:i,convInfo:h,backend:t});else if(h.strideWidth<=2&&f==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var p=new Oq(h),v=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];d=t.runWebGLProgram(p,[a,i],"float32",v)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))d=Mq({x:a,filter:i,convInfo:h,backend:t});else{var p=new Rq(h);d=t.runWebGLProgram(p,[a,i],"float32")}var m=Pe({inputs:{x:d},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(d),m}var vVe={kernelName:k.Conv2D,backendName:"webgl",kernelFunc:pVe};var mVe=function(){function n(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,r=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(r," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              if (`).concat(o,`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),gVe=function(){function n(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",s=t-1-e.padInfo.top,u=r-1-e.padInfo.left,c=o?1:2,l=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`).concat(f,`];

        ivec2 dyCorner = ivec2(coords[`).concat(c,"], coords[").concat(l,`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(r,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(r,` - 1 - wC;

            for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {

              if (`).concat(o,`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),yVe=function(){function n(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,r=e.strideHeight,a=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yF = 0; yF < `).concat(e.outDepth,`; yF++) {
            int xF = wF + yF * `).concat(t," - ").concat(i,`;

            if (xF < 0 || xF >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
              int xR = wR + yR * `).concat(r," - ").concat(o,`;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
                int xC = wC + yC * `).concat(a," - ").concat(s,`;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),bVe=function(){function n(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,r=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=t-1-e.padInfo.front,c=r-1-e.padInfo.top,l=a-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`.concat(u,", ").concat(c,", ").concat(l,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(t,`; wF++) {
          float dyF = float(dyFCorner + wF) / `).concat(i,`.0;

          if (dyF < 0.0 || dyF >= `).concat(e.outDepth,`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `).concat(t,` - 1 - wF;

          for (int wR = 0; wR < `).concat(r,`; wR++) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `).concat(r,` - 1 - wR;

            for (int wC = 0; wC < `).concat(a,`; wC++) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `).concat(a,` - 1 - wC;

              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function wVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),d=new mVe(h);return t.runWebGLProgram(d,[a,i],"float32")}var xVe={kernelName:k.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:wVe};function kVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(c),h=k.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f),d=new gVe(h);return t.runWebGLProgram(d,[a,i],"float32")}var SVe={kernelName:k.Conv2DBackpropInput,backendName:"webgl",kernelFunc:kVe};function NVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=k.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new hVe(c);return t.runWebGLProgram(l,[a,i],"float32")}var TVe={kernelName:k.Conv3D,backendName:"webgl",kernelFunc:NVe};function EVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.filterShape,c=k.backend_util.computeConv3DInfo(a.shape,u,o,1,s),l=new yVe(c);return t.runWebGLProgram(l,[a,i],"float32")}var IVe={kernelName:k.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:EVe};function CVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.pad,s=r.strides,u=r.inputShape,c=k.backend_util.computeConv3DInfo(u,i.shape,s,1,o),l=new bVe(c);return t.runWebGLProgram(l,[a,i],"float32")}var AVe={kernelName:k.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:CVe};var _Ve=Zc+`
  return cos(x);
`,DVe=Nt({opSnippet:_Ve}),FVe={kernelName:k.Cos,backendName:"webgl",kernelFunc:DVe};var RVe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,OVe=Nt({opSnippet:RVe}),PVe={kernelName:k.Cosh,backendName:"webgl",kernelFunc:OVe};var MVe=function(){function n(e,t,r,a,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3],f=Te(t,1),h=f[0],d=Te(r,2),p=d[0],v=d[1];this.outputShape=[h,p,v,l];var m=a==="bilinear"?1:0,g=Te(["".concat(u-1,".0"),"".concat(c-1,".0")],2),y=g[0],b=g[1],w=Te(p>1?["".concat((u-1)/(p-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],3),x=w[0],N=w[1],T=w[2],E=Te(v>1?["".concat((c-1)/(v-1)),"(x2-x1) * width_ratio","x1*".concat(b," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(b)],3),C=E[0],F=E[1],D=E[2];this.userCode=`
      const float height_ratio = float(`.concat(x,`);
      const float width_ratio = float(`).concat(C,`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `).concat(s,`) {
          return;
        }

        float height_scale = `).concat(N,`;
        float width_scale = `).concat(F,`;

        float in_y = `).concat(T,`;
        if( in_y < 0.0 || in_y > `).concat(y,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }
        float in_x = `).concat(D,`;
        if( in_x < 0.0 || in_x > `).concat(b,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`).concat(m,` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `)}return n}();var BVe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new MVe(a.shape,i.shape,s,u,c);return t.runWebGLProgram(l,[a,i,o],"float32")},LVe={kernelName:k.CropAndResize,backendName:"webgl",kernelFunc:BVe},mh;(function(n){n.Prod="*",n.Sum="+"})(mh||(mh={}));var l$=function(){function n(e,t,r,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===mh.Prod?"1.0":"0.0",s=r?o:"getX(".concat(f$(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        `.concat(Wt(i),` coords = getOutputCoords();
        int end = `).concat(h$(i,"coords",this.op),`;
        float val = `).concat(s,`;
        int pow2 = int(pow(2.0, index));
        if (`).concat(c,`) {
          int idx = `).concat(l,`;
          `).concat(h$(i,"coords",this.op),` = idx;
          val `).concat(this.op,"= getX(").concat(f$(i,"coords",this.op),`);
        }
        setOutput(val);
      }
    `)}return n}();function f$(n,e,t){if(n===1)return"".concat(e);if(n===2)return"".concat(e,".x, ").concat(e,".y");if(n===3)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z");if(n===4)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z, ").concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(n," is not yet supported"))}function h$(n,e,t){if(n===1)return"".concat(e);if(n===2)return"".concat(e,".y");if(n===3)return"".concat(e,".z");if(n===4)return"".concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(n," is not yet supported"))}function Bq(n,e,t,r,a,i){var o=e.shape.length,s=k.backend_util.getAxesPermutation([r],o),u=e;s!=null&&(u=wr({inputs:{x:e},backend:t,attrs:{perm:s}}));var c=k.backend_util.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(e.shape.length-1," ")+"but got axis=".concat(r));for(var l=u.shape[c],f=aa({inputs:{x:u},backend:t}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var d=new l$(n,u.shape,!1,i),p=[[h]],v=f;f=t.runWebGLProgram(d,[f],f.dtype,p),t.disposeIntermediateTensorInfo(v)}if(a){var d=new l$(n,u.shape,a,i),v=f;f=t.runWebGLProgram(d,[f],f.dtype),t.disposeIntermediateTensorInfo(v)}if(s!=null){var m=k.backend_util.getUndoAxesPermutation(s),g=wr({inputs:{x:f},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}function zVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;return Bq(mh.Prod,a,t,i,o,s)}var $Ve={kernelName:k.Cumprod,backendName:"webgl",kernelFunc:zVe};function qVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;return Bq(mh.Sum,a,t,i,o,s)}var WVe={kernelName:k.Cumsum,backendName:"webgl",kernelFunc:qVe};function VVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=r.binaryOutput;if(a.shape.length===1){var u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=mq(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),d=Qze(f,h,o,s);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var GVe={kernelName:k.DenseBincount,backendName:"webgl",kernelFunc:VVe};var UVe=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `.concat(this.getHeightCoordString(),`;
      int w = `).concat(this.getWidthCoordString(),`;
      int d = `).concat(this.getDepthCoordString(),`;

      int in_h = h / `).concat(t,`;
      int offset_h = imod(h, `).concat(t,`);
      int in_w = w / `).concat(t,`;
      int offset_w = imod(w, `).concat(t,`);
      int offset_d = (offset_h * `).concat(t,` + offset_w) *
        `).concat(this.getOutputDepthSize(),`;
      int in_d = d + offset_d;

      float result = `).concat(this.getInputSamplingString(),`;
      setOutput(result);
    }
  `)}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}();function HVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=o==="NHWC"?a.shape[1]:a.shape[2],c=o==="NHWC"?a.shape[2]:a.shape[3],l=o==="NHWC"?a.shape[3]:a.shape[1],f=u*i,h=c*i,d=l/(i*i),p=o==="NHWC"?[s,f,h,d]:[s,d,f,h],v=new UVe(p,i,o);return t.runWebGLProgram(v,[a],a.dtype)}var KVe={kernelName:k.DepthToSpace,backendName:"webgl",kernelFunc:HVe};var Lq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kr(this.outputShape.length);var o=e.filterHeight,s=e.filterWidth,u=e.outChannels/e.inChannels,c="",l="";r&&(a?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(r,`
        }`):i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(r,`
        }`):c=`
          float activation(float x) {
            `.concat(r,`
          }
        `),l="result = activation(result);");var f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(c,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(u,`;
        int q = d2 - d1 * `).concat(u,`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `).concat(o,`; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < `).concat(s,`; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `).concat(f,`
        `).concat(l,`
        setOutput(result);
      }
    `)}return n}();var zq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kr(this.outputShape.length);for(var o=e.outChannels/e.inChannels,s=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,h=f,d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`,p=0;p<f;p++)d+=`
          vec4 xTexelC`.concat(p*2,`;
          int xTexelC`).concat(p*2,`Ready;
          vec4 xTexelC`).concat(p*2+1,`;
          int xTexelC`).concat(p*2+1,`Ready;
          vec4 xC`).concat(p,";");d+=`
    for (int r = 0; r < `.concat(l,`; r++) {
      `);for(var p=0;p<f;p++)d+=`
          xTexelC`.concat(p*2,` = vec4(0.0);
          xTexelC`).concat(p*2,`Ready = 0;
          xTexelC`).concat(p*2+1,` = vec4(0.0);
          xTexelC`).concat(p*2+1,`Ready = 0;
          xC`).concat(p," = vec4(0.0);");d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(var v=0;v<(h+1)/2;v++){var m=v*2;if(d+=`
          xC = xCCorner + `.concat(m*c,`;
          `),u===1){if(m<f&&(s%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }
              `),c===1&&m>0?d+=`
                xC`.concat(m," = vec4(xTexelC").concat(m-2,".zw, xTexelC").concat(m,`.xy);
                `):d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC`.concat(m," = vec4(previous.zw, xTexelC").concat(m,`.xy);
                  } else {
                    xC`).concat(m," = vec4(0.0, 0.0, xTexelC").concat(m,`.xy);
                  }
                  `)):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }

                xC`).concat(m," = xTexelC").concat(m,`;
                `),m+1<f)){var g=s%2===0?k.util.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + `.concat(g,`;

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                    xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC`).concat(m+1,`.zw = vec2(0.0);
                    }
                    xTexelC`).concat(m+1,`Ready = 1;
                  }
                  `),c>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC`.concat(m+1," = vec4(previous.zw, xTexelC").concat(m+1,`.xy);
                    } else {
                     xC`).concat(m+1," = vec4(0.0, 0.0, xTexelC").concat(m+1,`.xy);
                    }
                    `):d+=`
                    xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.xy);
                    `)):g===1?d+=`
                    xC`.concat(m+1," = xTexelC").concat(m,`;
                    `):d+=`
                    xCOffset = xC + `.concat(g,`;

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                      xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC`).concat(m+1,`.zw = vec2(0.0);
                      }
                      xTexelC`).concat(m+1,`Ready = 1;
                    }

                    xC`).concat(m+1," = xTexelC").concat(m+1,`;
                    `)}}else m<f&&(s%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                  xTexelC`).concat(m+1,` = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC`).concat(m+1,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m+1,`Ready = 1;
                }

                xC`).concat(m," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
              `),m+1<f&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC`.concat(m+1," = vec4(xTexelC").concat(m+1,`.xy, final.xy);
                `))):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                  xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(m+1,`.zw = vec2(0.);
                  }
                  xTexelC`).concat(m+1,`Ready = 1;
                }

                xC`).concat(m,` = vec4(
                  xTexelC`).concat(m,".xy, xTexelC").concat(m+1,`.xy);
              `),m+1<f&&(d+=`
                  xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
                `))));m<f&&(d+=`
            wTexel = getW(r, `.concat(m,`, d1, q);
            dotProd += xC`).concat(m,` * vec4(wTexel.xz, wTexel.xz);
          `),m+1<f&&(d+=`
              wTexel = getW(r, `.concat(m+1,`, d1, q);
              dotProd += xC`).concat(m+1,` * vec4(wTexel.xz, wTexel.xz);
            `)))}d+=`
    }
  `,d+=`
      }
    `;var y="",b="";r&&(a?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(r,`
        }`):i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(r,`
        }`):y=`vec4 activation(vec4 x) {
          `.concat(r,`
        }`),b="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(y,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(o,`;
        int q = d2 - d1 * `).concat(o,`;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        `).concat(d,`

        vec4 result = dotProd - vec4(0.000000000000001);
        `).concat(w,`
        `).concat(b,`
        setOutput(result);
      }
    `)}return n}();function jVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;l==null&&(l=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0),h;k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new zq(f):h=new Lq(f);var d=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(h,[a,i],"float32",d)}var XVe={kernelName:k.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:jVe};var YVe=function(){function n(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,r=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `.concat(o,` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `).concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(r," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),ZVe=function(){function n(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,s=r-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`.concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(r,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(r,` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `).concat(u,`; dm++) {
              int d2 = d1 * `).concat(u,` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function JVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,f=k.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=new YVe(f);return t.runWebGLProgram(h,[a,i],"float32")}var QVe={kernelName:k.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:JVe};function eGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape,f=k.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new ZVe(f);return t.runWebGLProgram(h,[a,i],"float32")}var tGe={kernelName:k.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:eGe};var nGe=function(){function n(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}return n}();function rGe(n){var e=n.inputs,t=n.backend,r=e.x,a=dn(dn([],Te(r.shape),!1),Te(r.shape),!1),i=k.util.sizeFromShape(r.shape),o=Pe({inputs:{x:r},backend:t,attrs:{shape:[i]}}),s=new nGe(i),u=t.runWebGLProgram(s,[o],o.dtype),c=Pe({inputs:{x:u},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),c}var aGe={kernelName:k.Diag,backendName:"webgl",kernelFunc:rGe};var iGe=function(){function n(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,r=e.inWidth,a=e.padInfo,i=e.strideHeight,o=e.strideWidth,s=e.filterHeight,u=e.filterWidth,c=e.dilationHeight,l=e.dilationWidth,f=a.top,h=a.left;this.userCode=`
      const ivec2 strides = ivec2(`.concat(i,", ").concat(o,`);
      const ivec2 pads = ivec2(`).concat(f,", ").concat(h,`);
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < `).concat(s,`; h++) {
          int hIn = hBeg + h * `).concat(c,`;

          if (hIn >= 0 && hIn < `).concat(t,`) {
            for (int w = 0; w < `).concat(u,`; w++) {
              int wIn = wBeg + w * `).concat(l,`;

              if (wIn >= 0 && wIn < `).concat(r,`) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `)}return n}();function oGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=k.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),l,f=new iGe(c);l=t.runWebGLProgram(f,[a,i],"float32");var h=Pe({inputs:{x:l},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(l),h}var sGe={kernelName:k.Dilation2D,backendName:"webgl",kernelFunc:oGe};function uGe(n){var e,t,r,a,i=n.inputs,o=n.backend,s=n.attrs,u=s.equation,c=i,l=k.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,d=l.idDims;k.backend_util.checkEinsumDimSizes(f.length,d,c);for(var p=k.backend_util.getEinsumComputePath(h,d),v=p.path,m=p.steps,g=m.length,y=null,b=f.length,w=[],x=0;x<g;++x){try{for(var N=(e=void 0,ra(m[x])),T=N.next();!T.done;T=N.next()){var E=T.value,C=k.backend_util.getEinsumPermutation(b,d[E]),F=C.permutationIndices,D=C.expandDims,O=void 0;k.backend_util.isIdentityPermutation(F)?O=c[E]:(O=wr({inputs:{x:c[E]},backend:o,attrs:{perm:F}}),w.push(O));for(var L=O.shape.slice(),z=0;z<D.length;++z)L.splice(D[z],0,1);k.util.arraysEqual(O.shape,L)||(O=Pe({inputs:{x:O},backend:o,attrs:{shape:L}}),w.push(O)),y===null?y=O:(y=Gx({inputs:{a:O,b:y},backend:o}),w.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=N.return)&&t.call(N)}finally{if(e)throw e.error}}x<g-1&&(v[x]>=0&&(y=dm({inputs:{x:y},backend:o,attrs:{axis:v[x]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var $=ra(w),B=$.next();!B.done;B=$.next()){var W=B.value;W!==y&&o.disposeIntermediateTensorInfo(W)}}catch(X){r={error:X}}finally{try{B&&!B.done&&(a=$.return)&&a.call($)}finally{if(r)throw r.error}}return y}var cGe={kernelName:k.Einsum,backendName:"webgl",kernelFunc:uGe};var lGe="return (x >= 0.0) ? x : (exp(x) - 1.0);",fGe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,hGe=Nt({opSnippet:lGe,packedOpSnippet:fGe}),dGe={kernelName:k.Elu,backendName:"webgl",kernelFunc:hGe};var pGe="return (b >= 1.0) ? a : a * (b + 1.0);",vGe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,mGe=function(n){var e=n.inputs,t=n.backend,r=e.dy,a=e.y,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new wh(vGe,r.shape,a.shape):new Gc(pGe,r.shape,a.shape);return t.runWebGLProgram(i,[r,a],r.dtype)},gGe={kernelName:k.EluGrad,backendName:"webgl",kernelFunc:mGe};var yGe=`
  return vec4(equal(a, b));
`,bGe="return float(a == b);",wGe=or({opSnippet:bGe,packedOpSnippet:yGe,dtype:"bool",cpuKernelImpl:r$e}),xGe={kernelName:k.Equal,backendName:"webgl",kernelFunc:wGe};var kGe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `.concat(k.backend_util.ERF_P,`;
  float a1 = `).concat(k.backend_util.ERF_A1,`;
  float a2 = `).concat(k.backend_util.ERF_A2,`;
  float a3 = `).concat(k.backend_util.ERF_A3,`;
  float a4 = `).concat(k.backend_util.ERF_A4,`;
  float a5 = `).concat(k.backend_util.ERF_A5,`;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`),SGe=Nt({opSnippet:kGe}),NGe={kernelName:k.Erf,backendName:"webgl",kernelFunc:SGe};var TGe=Zc+`
  return exp(x);
`,EGe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$q=Nt({opSnippet:TGe,packedOpSnippet:EGe,cpuKernelImpl:a$e,dtype:"float32"}),IGe={kernelName:k.Exp,backendName:"webgl",kernelFunc:$q};function _x(n){var e=n.inputs,t=n.attrs,r=n.backend,a=t.dim,i=e.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(k.util.assert(-(o+1)<=a,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+a+1),s.splice(u,0,1),Pe({inputs:{x:i},backend:r,attrs:{shape:s}})}var CGe={kernelName:k.ExpandDims,backendName:"webgl",kernelFunc:_x};var d$="return exp(x) - 1.0;",AGe=Nt({opSnippet:d$,packedOpSnippet:d$,cpuKernelImpl:i$e}),_Ge={kernelName:k.Expm1,backendName:"webgl",kernelFunc:AGe};var p$=function(){function n(e,t,r){this.variableNames=["real","imag"];var a=t[1];this.outputShape=t;var i=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),o=r?"".concat(a,".0"):"1.0",s;if(e==="real")s="return real * expR - imag * expI;";else if(e==="imag")s="return real * expI + imag * expR;";else throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));this.userCode=`
      const float exponentMultiplier = `.concat(i,`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `).concat(s,`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`).concat(a,`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `).concat(a,`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `).concat(o,`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `)}return n}();function qq(n,e,t){var r=t.texData.get(n.dataId),a=k.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Pe({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=s.shape,c=new p$("real",u,e),l=new p$("imag",u,e),f=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],h=t.runWebGLProgram(c,f,"float32"),d=t.runWebGLProgram(l,f,"float32"),p=ns({inputs:{real:h,imag:d},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d);var v=Pe({inputs:{x:p},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(p),v}function DGe(n){var e=n.inputs,t=n.backend,r=e.input;return qq(r,!1,t)}var FGe={kernelName:k.FFT,backendName:"webgl",kernelFunc:DGe};var RGe=function(){function n(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n}();function kh(n){var e=n.backend,t=n.attrs,r=t.shape,a=t.value,i=t.dtype;if(i=i||k.util.inferDtype(a),i==="string"){var o=k.util.getArrayFromDType(i,k.util.sizeFromShape(r));return o.fill(a),e.makeTensorInfo(r,i,o)}else{var s=new RGe(r,a),u=[[a]];return e.runWebGLProgram(s,[],i,u)}}var OGe={kernelName:k.Fill,backendName:"webgl",kernelFunc:kh};var PGe=function(){function n(e){this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = `.concat(t,` - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < `).concat(t,`) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return n}();var MGe={kernelName:k.FlipLeftRight,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.image,a=t,i=new PGe(r.shape),o=a.runWebGLProgram(i,[r],r.dtype);return o}};var v$="return floor(x);",BGe=Nt({opSnippet:v$,packedOpSnippet:v$,cpuKernelImpl:o$e}),LGe={kernelName:k.Floor,backendName:"webgl",kernelFunc:BGe};var zGe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,$Ge=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,qGe=or({opSnippet:zGe,packedOpSnippet:$Ge,dtype:"int32"}),WGe={kernelName:k.FloorDiv,backendName:"webgl",kernelFunc:qGe},VGe=function(){function n(e){this.variableNames=["A"];var t=xr(),r=Te(e,2),a=r[0],i=r[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`.concat(i,".0, ").concat(a,`.0);

        vec4 values = `).concat(t.texture2D,`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `)}return n}(),GGe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=xr(),r=Te(e,2),a=r[0],i=r[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`.concat(i,".0, ").concat(a,`.0);
            vec4 values = `).concat(t.texture2D,`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `).concat(t.output,` = result;
      }
    `)}return n}(),UGe={kernelName:k.FromPixels,backendName:"webgl",kernelFunc:HGe},$c,xx=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function HGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.pixels,i=r.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=Te(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],f=[l,c],h=[l,c,i];if(s||o){var d=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");($c==null||d!==xx)&&(xx=d,$c=document.createElement("canvas").getContext("2d",{willReadFrequently:xx})),$c.canvas.width=c,$c.canvas.height=l,$c.drawImage(a,0,0,c,l),a=$c.canvas}var p=t.makeTensorInfo(f,"int32");t.texData.get(p.dataId).usage=ba.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),a);var v=k.env().getBool("WEBGL_PACK")?new GGe(h):new VGe(h),m=t.runWebGLProgram(v,[p],"int32");return t.disposeData(p.dataId),m}function KGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,f=r.dilations,h=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=k.backend_util.convertConv2DDataFormat(l),m=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,f,c,h,!1,v),g,y=[],b=o!=null,w=s!=null,x=d==="leakyrelu",N=function(){var L=[a,i],z=function(B,W){if(W==="NCHW"&&B.shape.length===1&&B.shape[0]!==1){var X=Pe({inputs:{x:B},backend:t,attrs:{shape:[B.shape[0],1,1]}});return y.push(X),X}return B};if(b&&L.push(z(o,l)),w&&L.push(z(s,l)),x){var $=t.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));L.push($),y.push($)}return L};if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))g=Pq({x:a,filter:i,convInfo:m,backend:t,bias:o,activation:d,preluActivationWeights:s,leakyreluAlpha:p});else if(m.strideWidth<=2&&v==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var T=d?ph(d,!0):null,E=new Oq(m,b,T,w,x),C=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],F=N();g=t.runWebGLProgram(E,F,"float32",C)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))g=Mq({x:a,filter:i,convInfo:m,backend:t,bias:o,activation:d,preluActivationWeights:s,leakyreluAlpha:p});else{var T=d?ph(d,!1):null,E=new Rq(m,b,T,w,x),D=N();g=t.runWebGLProgram(E,D,"float32")}var O=Pe({inputs:{x:g},backend:t,attrs:{shape:m.outShape}});return y.push(g),y.forEach(function(L){return t.disposeIntermediateTensorInfo(L)}),O}var jGe={kernelName:k.FusedConv2D,backendName:"webgl",kernelFunc:KGe};function XGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,f=r.dimRoundingMode,h=r.activation,d=r.leakyreluAlpha,p=[],v=l;v==null&&(v=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(u,v),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(v,"'")});var m=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,v,c,f,!0),g=k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,y=h?ph(h,g):null,b=[a,i],w=o!=null,x=s!=null,N=h==="leakyrelu";if(w&&b.push(o),x&&b.push(s),N){var T=t.makeTensorInfo([],"float32",k.util.createScalarValue(d,"float32"));b.push(T),p.push(T)}var E;g?E=new zq(m,w,y,x,N):E=new Lq(m,w,y,x,N);var C=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],F=t.runWebGLProgram(E,b,"float32",C);return p.forEach(function(D){return t.disposeIntermediateTensorInfo(D)}),F}var YGe={kernelName:k.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:XGe},ZGe=function(){function n(e,t,r,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=Wt(r.length),o=`
    int index;`,s=0;s<this.sliceDim;s++)o+=`
          index = round(getIndices(coords[0], `.concat(s,`));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= `).concat(this.paramsShape[s],`;
          flattenIndex += index * `).concat(this.strides[s],";");this.userCode=`
         void main() {
          `.concat(i,` coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          `).concat(o,`

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `)}return n}();function JGe(n){var e=n.inputs,t=n.backend,r=e.params,a=e.indices,i=a.shape,o=i[i.length-1],s=k.util.sizeFromShape(r.shape),u=Te(k.backend_util.prepareAndValidate(r,a),4),c=u[0],l=u[1],f=u[2],h=u[3],d=Pe({inputs:{x:a},backend:t,attrs:{shape:[l,o]}}),p=Pe({inputs:{x:r},backend:t,attrs:{shape:[k.util.sizeFromShape(r.shape)/f,f]}});if(t.shouldExecuteOnCPU([r,a])||r.dtype==="string"){var v=t.readSync(a.dataId),m=t.bufferSync(r),g=s$e(v,m,r.dtype,l,o,f,h,r.shape,s);return t.makeTensorInfo(c,r.dtype,g.values)}var y=new ZGe(o,h,[l,f],r.shape),b=t.runWebGLProgram(y,[p,d],p.dtype),w=Pe({inputs:{x:b},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(b),w}var QGe={kernelName:k.GatherNd,backendName:"webgl",kernelFunc:JGe};var eUe=function(){function n(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var r=Wt(this.rank),a=tUe(e);this.userCode=`
      void main() {
        `.concat(r,` resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < `).concat(e[2],`) ? 1.0 : 0.0;
        setOutput(inBounds * getA(`).concat(a,`));
      }
    `)}return n}();function tUe(n,e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<n.length;a++)a===2?r.push("index"):r.push("".concat(t[a]));return r.join()}function Wq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.indices,o=r.axis,s=r.batchDims,u=k.util.parseAxisParam(o,a.shape)[0];if(k.env().get("DEBUG"))for(var c=t.readSync(i.dataId),l=a.shape[u],f=function(C){var F=c[C];k.util.assert(F<=l-1&&F>=0,function(){return"GatherV2: the index value ".concat(F," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var d=k.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),p=k.util.sizeFromShape(i.shape),v=[],m=Pe({inputs:{x:a},backend:t,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=Pe({inputs:{x:i},backend:t,attrs:{shape:[d.batchSize,p/d.batchSize]}});v.push(m),v.push(g);var y=[d.batchSize,d.outerSize,p/d.batchSize,d.sliceSize];if(t.shouldExecuteOnCPU([a,i])||a.dtype==="string"){var b=t.bufferSync(g),w=t.bufferSync(m),x=u$e(w,b,y);return v.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),t.makeTensorInfo(d.outputShape,x.dtype,x.values)}var N=new eUe(m.shape,y),T=t.runWebGLProgram(N,[m,g],m.dtype);v.push(T);var E=Pe({inputs:{x:T},backend:t,attrs:{shape:d.outputShape}});return v.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),E}var nUe={kernelName:k.GatherV2,backendName:"webgl",kernelFunc:Wq};var rUe="return float(a > b);",aUe=`
  return vec4(greaterThan(a, b));
`,iUe=or({opSnippet:rUe,packedOpSnippet:aUe,cpuKernelImpl:c$e,dtype:"bool"}),oUe={kernelName:k.Greater,backendName:"webgl",kernelFunc:iUe};var sUe="return float(a >= b);",uUe=`
  return vec4(greaterThanEqual(a, b));
`,cUe=or({opSnippet:sUe,packedOpSnippet:uUe,dtype:"bool",cpuKernelImpl:l$e}),lUe={kernelName:k.GreaterEqual,backendName:"webgl",kernelFunc:cUe};function fUe(n){var e=n.inputs,t=n.backend,r=e.input;return qq(r,!0,t)}var hUe={kernelName:k.IFFT,backendName:"webgl",kernelFunc:fUe};var dUe="return float(!isnan(x) && !isinf(x));",pUe=Nt({opSnippet:dUe,dtype:"bool"}),vUe={kernelName:k.IsFinite,backendName:"webgl",kernelFunc:pUe};var mUe="return float(isinf(x));",gUe=Nt({opSnippet:mUe,dtype:"bool"}),yUe={kernelName:k.IsInf,backendName:"webgl",kernelFunc:gUe};var bUe="return float(isnan(x));",wUe=Nt({opSnippet:bUe,dtype:"bool"}),xUe={kernelName:k.IsNan,backendName:"webgl",kernelFunc:wUe};var kUe="return float(a < b);",SUe=`
  return vec4(lessThan(a, b));
`,NUe=or({opSnippet:kUe,packedOpSnippet:SUe,cpuKernelImpl:f$e,dtype:"bool"}),TUe={kernelName:k.Less,backendName:"webgl",kernelFunc:NUe};var EUe="return float(a <= b);",IUe=`
  return vec4(lessThanEqual(a, b));
`,CUe=or({opSnippet:EUe,packedOpSnippet:IUe,cpuKernelImpl:h$e,dtype:"bool"}),AUe={kernelName:k.LessEqual,backendName:"webgl",kernelFunc:CUe};function _Ue(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.num,o=d$e(r,a,i);return e.makeTensorInfo([o.length],"float32",o)}var DUe={kernelName:k.LinSpace,backendName:"webgl",kernelFunc:_Ue};var FUe=Zc+`
  return x < 0.0 ? 0./0. : log(x);
`,RUe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,OUe=Nt({opSnippet:FUe,packedOpSnippet:RUe,cpuKernelImpl:p$e}),PUe={kernelName:k.Log,backendName:"webgl",kernelFunc:OUe};var MUe=Zc+`
  return log(1.0 + x);
`,BUe=Nt({opSnippet:MUe}),LUe={kernelName:k.Log1p,backendName:"webgl",kernelFunc:BUe};var zUe="return float(a >= 1.0 && b >= 1.0);",$Ue=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,qUe=or({opSnippet:zUe,packedOpSnippet:$Ue,dtype:"bool"}),WUe={kernelName:k.LogicalAnd,backendName:"webgl",kernelFunc:qUe};var VUe="return float(!(x >= 1.0));",GUe=Nt({opSnippet:VUe}),UUe={kernelName:k.LogicalNot,backendName:"webgl",kernelFunc:GUe};var HUe="return float(a >= 1.0 || b >= 1.0);",KUe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,jUe=or({opSnippet:HUe,packedOpSnippet:KUe,dtype:"bool"}),XUe={kernelName:k.LogicalOr,backendName:"webgl",kernelFunc:jUe};var YUe=function(){function n(e,t,r,a,i){this.variableNames=["x"],this.outputShape=[];var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(r,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`.concat(o,"; j <= ").concat(o,`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `).concat(s,`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `).concat(u,`;
        setOutput(val);
      }
    `)}return n}();var ZUe=function(){function n(e,t,r,a,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(r,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `.concat(this.outputShape[3],`;
        bool hasNextRow = c < `).concat(this.outputShape[2],`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `).concat(o,`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `).concat(o,"; j <= ").concat(o,`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`).concat(s,`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `).concat(u,`;
        setOutput(result);
      }
    `)}return n}();var JUe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new ZUe(a.shape,i,o,s,u):new YUe(a.shape,i,o,s,u);return t.runWebGLProgram(c,[a],a.dtype)},QUe={kernelName:k.LRN,backendName:"webgl",kernelFunc:JUe};var e6e=function(){function n(e,t,r,a,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=a,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `.concat(this.depth,`; ++d) {
          int depthBegin = int(max(0.0, float(d - `).concat(t,`)));
          int depthEnd = int(min(float(`).concat(this.depth,`),
              float(d + `).concat(t,` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `).concat(this.depth,`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`).concat(a,") * norm + float(").concat(r,`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`).concat(a,`)
                * float(`).concat(i,`)
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `).concat(i,`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `)}return n}();var t6e=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.y,o=e.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,f=new e6e(a.shape,s,u,c,l);return t.runWebGLProgram(f,[a,i,o],a.dtype)},n6e={kernelName:k.LRNGrad,backendName:"webgl",kernelFunc:t6e};function r6e(n,e,t,r){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(n.shape),o=i/a,s=Pe({inputs:{x:n},attrs:{shape:[o,a]},backend:r}),u=gu(s,n.dtype,"max",r),c=Pe({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}function Vq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=l!=null,h=t.shouldExecuteOnCPU([a]),d=a;if(f){if(h){for(var p=t.texData.get(d.dataId),v=p.values,m=new Array(s),g=0;g<m.length;g++)m[g]=a.shape[l[g]];var y=qx(v,a.shape,a.dtype,l,m);d=t.makeTensorInfo(m,a.dtype);var b=t.texData.get(d.dataId);b.values=y}else d=hm(a,l,t);c=k.backend_util.getInnerMostAxes(c.length,s)}k.backend_util.assertAxesAreInnerMostDims("max",c,s);var w=Te(k.backend_util.computeOutAndReduceShapes(d.shape,c),2),x=w[0],N=w[1],T=x;o&&(T=k.backend_util.expandShapeToKeepDim(x,u));var E;if(h){var p=t.texData.get(d.dataId),v=p.values,C=v$e(v,k.util.sizeFromShape(N),T,a.dtype);E=t.makeTensorInfo(T,a.dtype);var F=t.texData.get(E.dataId);F.values=C}else E=r6e(d,N,T,t);return f&&t.disposeIntermediateTensorInfo(d),E}var a6e={kernelName:k.Max,backendName:"webgl",kernelFunc:Vq};var i6e=Vx+`
  return max(a, b);
`,o6e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+bh+`
  return result;
`,s6e=or({opSnippet:i6e,packedOpSnippet:o6e,cpuKernelImpl:m$e}),u6e={kernelName:k.Maximum,backendName:"webgl",kernelFunc:s6e};function c6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Hc(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return aa({inputs:{x:a},backend:t});var f=new vh(l,"max",!1);return t.runWebGLProgram(f,[a],a.dtype)}var l6e={kernelName:k.MaxPool,backendName:"webgl",kernelFunc:c6e};function f6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,c,u),h=new Ux(f,"max",!1);return t.runWebGLProgram(h,[a],a.dtype)}var h6e={kernelName:k.MaxPool3D,backendName:"webgl",kernelFunc:f6e};var d6e=function(){function n(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,r=e.strideWidth,a=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=i-1-e.padInfo.top,u=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(i,`;
          wR += `).concat(a,`) {
          float dyR = float(dyRCorner + wR) / `).concat(t,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(o,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(r,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `).concat(c,` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `).concat(o,` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),p6e=function(){function n(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,r=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,f=u-1-e.padInfo.front,h=c-1-e.padInfo.top,d=l-1-e.padInfo.left,p=u*c*l-1;this.userCode=`
      const ivec3 pads = ivec3(`.concat(f,", ").concat(h,", ").concat(d,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(u,`;
           wD += `).concat(i,`) {
          float dyD = float(dyDCorner + wD) / `).concat(t,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(c,`;
              wR += `).concat(o,`) {
            float dyR = float(dyRCorner + wR) / `).concat(r,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(l,`;
                wC += `).concat(s,`) {
              float dyC = float(dyCCorner + wC) / `).concat(a,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `).concat(p,` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `).concat(c," * ").concat(l,` +
                  wR * `).concat(l,` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function v6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),d=new Ux(h,"max",!0),p=t.runWebGLProgram(d,[o],o.dtype),v=new p6e(h),m=t.runWebGLProgram(v,[a,p],o.dtype);return t.disposeIntermediateTensorInfo(p),m}var m6e={kernelName:k.MaxPool3DGrad,backendName:"webgl",kernelFunc:v6e};function g6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=e.output,s=i;Hc([i,o],"maxPoolGrad");var u=r.filterSize,c=r.strides,l=r.pad,f=r.dimRoundingMode,h=k.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),d=!0,p=new vh(h,"max",d),v=t.runWebGLProgram(p,[s],s.dtype),m=new d6e(h),g=t.runWebGLProgram(m,[a,v],s.dtype);return t.disposeIntermediateTensorInfo(v),g}var y6e={kernelName:k.MaxPoolGrad,backendName:"webgl",kernelFunc:g6e};function b6e(n,e,t,r){var a=new vh(t,"max",!1),i=r.runWebGLProgram(a,[n],"float32");a=new vh(t,"max",!0,!0,e);var o=r.runWebGLProgram(a,[n],"float32");return[i,o]}var w6e={kernelName:k.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=r;k.util.assert(a.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")});var l=[1,1];k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computePool2DInfo(a.shape,i,o,l,s),h=Te(b6e(a,u,f,c),2),d=h[0],p=h[1];return[d,p]}};function x6e(n,e,t,r){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(n.shape),o=i/a,s=Pe({inputs:{x:n},attrs:{shape:[o,a]},backend:r}),u=gu(s,"float32","mean",r),c=Pe({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}var k6e={kernelName:k.Mean,backendName:"webgl",kernelFunc:function(n){var e,t,r=n.inputs,a=n.attrs,i=n.backend,o=r.x,s=a.keepDims,u=a.axis,c=i,l=o.shape.length,f=k.util.parseAxisParam(u,o.shape),h=f,d=k.backend_util.getAxesPermutation(h,l),p=d!=null,v=c.shouldExecuteOnCPU([o]),m=[],g=o;if(p){if(v){for(var y=c.texData.get(g.dataId),b=y.values,w=new Array(l),x=0;x<w.length;x++)w[x]=o.shape[d[x]];var N=qx(b,o.shape,o.dtype,d,w);g=c.makeTensorInfo(w,o.dtype);var T=c.texData.get(g.dataId);T.values=N}else g=hm(o,d,c);m.push(g),h=k.backend_util.getInnerMostAxes(h.length,l)}k.backend_util.assertAxesAreInnerMostDims("sum",h,l);var E=Te(k.backend_util.computeOutAndReduceShapes(g.shape,h),2),C=E[0],F=E[1],D=C;s&&(D=k.backend_util.expandShapeToKeepDim(C,f));var O=x6e(g,F,D,c);try{for(var L=ra(m),z=L.next();!z.done;z=L.next()){var x=z.value;c.disposeIntermediateTensorInfo(x)}}catch($){e={error:$}}finally{try{z&&!z.done&&(t=L.return)&&t.call(L)}finally{if(e)throw e.error}}return O}};function S6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,a.shape.length)),k.backend_util.assertAxesAreInnerMostDims("min",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),d=h[0],p=h[1],v=k.util.sizeFromShape(p),m=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=gu(m,m.dtype,"min",t),y;if(o){var b=k.backend_util.expandShapeToKeepDim(d,u);y=Pe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Pe({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var N6e={kernelName:k.Min,backendName:"webgl",kernelFunc:S6e};var T6e=Vx+`
  return min(a, b);
`,E6e=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+bh+`
  return result;
`,I6e=or({opSnippet:T6e,packedOpSnippet:E6e,cpuKernelImpl:g$e}),C6e={kernelName:k.Minimum,backendName:"webgl",kernelFunc:I6e};var A6e=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=t.map(function(l,f){return l[0]+e[f]+l[1]});var a=e.length,i=Wt(a),o=t.map(function(l){return l[0]}).join(","),s=t.map(function(l,f){return l[0]+e[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c=r==="reflect"?0:1;if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - `).concat(c,`;
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + `).concat(c,`;
          }
          setOutput(getX(outC - start));
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        for (int i = 0; i < `).concat(a,`; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - `).concat(c,`;
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + `).concat(c,`;
          }
        }
        `).concat(i,` coords = outC - start;
        setOutput(getX(`).concat(u,`));
      }
    `)}return n}();var _6e=function(){function n(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(v,m){return v[0]+e[m]+v[1]});var a=e.length,i=Wt(a),o=t.map(function(v){return v[0]}).join(","),s=t.map(function(v,m){return v[0]+e[m]}).join(","),u=br("rc",a),c=br("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=r==="reflect"?0:1,d="";if(a===1){var p=`
        `.concat(i,` source = rc;
        if (source < start) {
          source = start * 2 - source - `).concat(h,`;
        } else if (source >= end) {
          source = (end - 1) * 2 - source + `).concat(h,`;
        }
        source -= start;
      `);d=`
        `.concat(i,` rc = outputLoc;
        `).concat(p,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(p,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
      `)}else{var p=`
        `.concat(i,` source = rc;
        `).concat(i," lt = ").concat(i,`(lessThan(source, start));
        `).concat(i," gte = ").concat(i,`(greaterThanEqual(source, end));
        `).concat(i,` orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - `).concat(h,`) +
                gte * ((end - 1) * 2 - source + `).concat(h,`);
        source -= start;
      `);d=`
        `.concat(i,` rc = outputLoc;
        `).concat(p,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(p,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
        rc = outputLoc;
        `).concat(u[a-2],` += 1;
        if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],`) {
          `).concat(p,`
          result[2] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          `).concat(u[a-1],` += 1;
          if(`).concat(l,`) {
            `).concat(p,`
            result[3] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          }
        }
      `)}this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(d,`
        setOutput(result);
      }
    `)}return n}();var D6e=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.mode,s=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _6e(a.shape,i,o):new A6e(a.shape,i,o),u=t.runWebGLProgram(s,[a],a.dtype);return u},F6e={kernelName:k.MirrorPad,backendName:"webgl",kernelFunc:D6e};var R6e=`if (b == 0.0) return NAN;
  return mod(a, b);`,O6e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+bh+`
  return result;
`,P6e=or({opSnippet:R6e,packedOpSnippet:O6e}),M6e={kernelName:k.Mod,backendName:"webgl",kernelFunc:P6e};var B6e=function(){function n(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `.concat(t-1,`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`).concat(t-1,`));
      }
    `)}return n}();var L6e=`
if (a == b) {
  return 1.0;
};
return a / b;`,z6e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Gq=or({opSnippet:L6e,packedOpSnippet:z6e,checkOutOfBounds:!0}),$6e={kernelName:k.RealDiv,backendName:"webgl",kernelFunc:Gq};var m$="return a - b;",Uq=or({opSnippet:m$,packedOpSnippet:m$,supportsComplex:!0,cpuKernelImpl:B$e}),q6e={kernelName:k.Sub,backendName:"webgl",kernelFunc:Uq};function Hq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.dim,o=k.util.parseAxisParam([i],a.shape),s=Vq({inputs:{x:a},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=k.backend_util.expandShapeToKeepDim(s.shape,o),c=Pe({inputs:{x:s},backend:t,attrs:{shape:u}}),l=Uq({inputs:{a,b:c},backend:t}),f=$q({inputs:{x:l},backend:t}),h=dm({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),d=Pe({inputs:{x:h},backend:t,attrs:{shape:u}}),p=Gq({inputs:{a:f,b:d},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),p}var W6e={kernelName:k.Softmax,backendName:"webgl",kernelFunc:Hq};function V6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:Hq({inputs:{logits:a},backend:t,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],f=new B6e(c,l,i),h=[[o]],d=t.runWebGLProgram(f,[u],"int32",h);return s||t.disposeIntermediateTensorInfo(u),d}var G6e={kernelName:k.Multinomial,backendName:"webgl",kernelFunc:V6e},U6e=Xa+`
  return -x;
`,H6e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function K6e(n){var e=n.inputs,t=n.backend,r=e.x;if(t.shouldExecuteOnCPU([r])){var a=t.texData.get(r.dataId),i=Te(b$e(a.values,r.shape,r.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,r.dtype,o)}var u;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?u=new es(r.shape,H6e):u=new Bi(r.shape,U6e),t.runWebGLProgram(u,[r],r.dtype)}var j6e={kernelName:k.Neg,backendName:"webgl",kernelFunc:K6e};var X6e=k.kernel_impls.nonMaxSuppressionV3Impl;function Y6e(n){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=X6e(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var Z6e={kernelName:k.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:Y6e};var J6e=k.kernel_impls.nonMaxSuppressionV4Impl;function Q6e(n){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=J6e(l,f,o,s,u,c),d=h.selectedIndices,p=h.validOutputs;return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}var eHe={kernelName:k.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:Q6e};var tHe=k.kernel_impls.nonMaxSuppressionV5Impl;function nHe(n){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=o,d=s,p=u,v=c,m=tHe(l,f,h,d,p,v),g=m.selectedIndices,y=m.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var rHe={kernelName:k.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:nHe};var aHe=function(){function n(e,t,r,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`.concat(a,"), float(").concat(r,`),
                      float(index == coords.y)));
      }
    `)}return n}(),iHe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=k.util.sizeFromShape(a.shape),l=new aHe(c,o,s,u),f=Pe({inputs:{x:a},backend:t,attrs:{shape:[c]}}),h=t.runWebGLProgram(l,[f],i);t.disposeIntermediateTensorInfo(f);var d=dn(dn([],Te(a.shape),!1),[o],!1),p=Pe({inputs:{x:h},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(h),p},oHe={kernelName:k.OneHot,backendName:"webgl",kernelFunc:iHe};function lm(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="complex64"){var a=xh({inputs:{input:r},backend:t}),i=lm({inputs:{x:a},backend:t}),o=pm({inputs:{input:r},backend:t}),s=lm({inputs:{x:o},backend:t}),u=ns({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return kh({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}var sHe={kernelName:k.ZerosLike,backendName:"webgl",kernelFunc:lm};function Kq(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){var a=xh({inputs:{input:r},backend:t}),i=Kq({inputs:{x:a},backend:t}),o=pm({inputs:{input:r},backend:t}),s=lm({inputs:{x:o},backend:t}),u=ns({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return kh({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}var uHe={kernelName:k.OnesLike,backendName:"webgl",kernelFunc:Kq};function cHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis;if(e.length===1)return _x({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){k.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),k.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=_x({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=Fq({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var lHe={kernelName:k.Pack,backendName:"webgl",kernelFunc:cHe};var fHe=function(){function n(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(c,l){return c[0]+e[l]+c[1]});var a=e.length,i=Wt(a),o=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,l){return c[0]+e[l]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          `).concat(i,` coords = outC - start;
          setOutput(getX(`).concat(u,`));
        }
      }
    `)}return n}();var hHe=function(){function n(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(g,y){return g[0]+e[y]+g[1]});for(var a=e.length,i=Wt(a),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,y){return g[0]+e[y]}).join(","),u=br("rc",a),c=br("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1],` += 1;
       if(`).concat(l,`) {
      `),a===1?"":`}
       rc = outputLoc;
       `.concat(u[a-2],` += 1;
       if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),a===1?"":"  ".concat(u[a-1],` += 1;
         if(`).concat(l,") {")],d=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",v=0,m=a===1?2:4;v<m;v++)p+=`
        `.concat(h[v],`
        if (`).concat(d,`) {
          result[`).concat(v,`] = float(value);
        } else {
          `).concat(i,` source = rc - start;
          result[`).concat(v,"] = getChannel(getX(").concat(c.join(),"), ").concat(f,`);
        }
      `);p+=a===1?"} ":"}}",this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(p,`
        setOutput(result);
      }
    `)}return n}();var jq=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.constantValue;if(k.util.sizeFromShape(a.shape)===0){var s=i.map(function(l,f){return l[0]+a.shape[f]+l[1]});return kh({backend:t,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hHe(a.shape,i,o):new fHe(a.shape,i,o),c=[[o]];return t.runWebGLProgram(u,[a],a.dtype,c)},dHe={kernelName:k.PadV2,backendName:"webgl",kernelFunc:jq};var pHe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,vHe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+bh+`
  return result;
`,mHe=or({opSnippet:pHe,packedOpSnippet:vHe}),gHe={kernelName:k.Pow,backendName:"webgl",kernelFunc:mHe};function yHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=[],c=k.util.parseAxisParam(i,a.shape),l=c,f=k.backend_util.getAxesPermutation(l,s),h=a;f!=null&&(h=wr({inputs:{x:a},backend:t,attrs:{perm:f}}),l=k.backend_util.getInnerMostAxes(l.length,s),u.push(h)),k.backend_util.assertAxesAreInnerMostDims("prod",l,s);var d;if(t.shouldExecuteOnCPU([h])){var p=t.texData.get(h.dataId).values,v=x$e(h.shape,h.dtype,p,l),m=v.outVals,g=v.outShape,y=v.outDtype;d=t.makeTensorInfo(g,y,m)}else{var b=Te(k.backend_util.computeOutAndReduceShapes(h.shape,l),2),g=b[0],w=b[1],x=k.util.sizeFromShape(w),N=Pe({inputs:{x:h},backend:t,attrs:{shape:[-1,x]}}),T=k.sumOutType(a.dtype),E=gu(N,T,"prod",t);d=Pe({inputs:{x:E},backend:t,attrs:{shape:g}}),u.push(N),u.push(E)}if(o){u.push(d);var C=k.backend_util.expandShapeToKeepDim(d.shape,c);d=Pe({inputs:{x:d},backend:t,attrs:{shape:C}})}return u.forEach(function(F){return t.disposeIntermediateTensorInfo(F)}),d}var bHe={kernelName:k.Prod,backendName:"webgl",kernelFunc:yHe};function wHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;r.outputRaggedRank;var s=a.map(function(g){return t.readSync(g.dataId)}),u=a.map(function(g){return g.shape}),c=t.readSync(i.dataId),l=t.readSync(o.dataId),f=Te(k$e(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],d=f[1],p=f[2],v=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),m=t.makeTensorInfo(p,i.dtype,d);return v.concat([m])}var xHe={kernelName:k.RaggedGather,backendName:"webgl",kernelFunc:wHe};function kHe(n){var e=n.inputs,t=n.backend,r=e.starts,a=e.limits,i=e.deltas,o=t.readSync(r.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(S$e(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),d=t.makeTensorInfo([f.length],r.dtype,f);return[h,d]}var SHe={kernelName:k.RaggedRange,backendName:"webgl",kernelFunc:kHe};function NHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=r.rowPartitionTypes,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=t.readSync(o.dataId),h=s.map(function(g){return t.readSync(g.dataId)}),d=s.map(function(g){return g.shape}),p=Te(N$e(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,d,u),2),v=p[0],m=p[1];return t.makeTensorInfo(v,i.dtype,m)}var THe={kernelName:k.RaggedTensorToTensor,backendName:"webgl",kernelFunc:NHe};var Xq=function(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.step,o=t.dtype,s=T$e(r,a,i,o);return e.makeTensorInfo([s.length],o,s)},EHe={kernelName:k.Range,backendName:"webgl",kernelFunc:Xq};var IHe="return 1.0 / x;",CHe=Nt({opSnippet:IHe}),AHe={kernelName:k.Reciprocal,backendName:"webgl",kernelFunc:CHe};var _He=Xa+`
  return (x < 0.0) ? 0.0 : x;
`,DHe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,FHe=Nt({opSnippet:_He,packedOpSnippet:DHe}),RHe={kernelName:k.Relu,backendName:"webgl",kernelFunc:FHe};var OHe=Xa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,PHe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,MHe=Nt({opSnippet:OHe,packedOpSnippet:PHe}),BHe={kernelName:k.Relu6,backendName:"webgl",kernelFunc:MHe};var LHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],d;i?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(d,`;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `)}return n}();var zHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],d;i?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(d,`;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(r-1,`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `)}return n}();function $He(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new zHe(a.shape,c,l,i,o):new LHe(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],"float32")}var qHe={kernelName:k.ResizeBilinear,backendName:"webgl",kernelFunc:$He};var WHe=function(){function n(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],f=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/f[0],d=l[1]/f[1],p=1/h,v=1/d,m=Math.ceil(p)*2+2,g=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(d,`);

        const float invHeightScale = float(`).concat(p,`);
        const float invWidthScale = float(`).concat(v,`);

        const int winHeight = int(`).concat(m,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `).concat(i-1,`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `).concat(o-1,`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return n}();function VHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners,s=new WHe(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var GHe={kernelName:k.ResizeBilinearGrad,backendName:"webgl",kernelFunc:VHe};var UHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],d=a?"0.5":"0.0",p;i?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(p,`;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(d,`)));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `)}return n}();var HHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],d=a?"0.5":"0.0",p;i?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(p,`;

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(d,`)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(r-1,`;

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `)}return n}();function KHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new HHe(a.shape,c,l,i,o):new UHe(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],a.dtype)}var jHe={kernelName:k.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:KHe};var XHe=function(){function n(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],f=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/f[0],d=l[1]/f[1],p=1/h,v=1/d,m=Math.ceil(p)*2+2,g=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(d,`);

        const float invHeightScale = float(`).concat(p,`);
        const float invWidthScale = float(`).concat(v,`);

        const int winHeight = int(`).concat(m,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float sourceFracRow =
              float(`).concat(l[0],`) *
                (float(dyR) / float(`).concat(f[0],`));

            float sourceFracCol =
                float(`).concat(l[1],`) *
                  (float(dyC) / float(`).concat(f[1],`));

            int sourceNearestRow = int(min(
                float(int(`).concat(i,`) - 1),
                `).concat(r,` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`).concat(o,`) - 1),
                `).concat(r,` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return n}();function YHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners,s=new XHe(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var ZHe={kernelName:k.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:YHe};var JHe=function(){function n(e,t){this.variableNames=["x"];var r=e.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`.concat(e[0],` - coord - 1));
        }
      `);return}var a=function(s){return t.indexOf(s)!==-1&&e[s]!==1?"".concat(e[s]," - coords[").concat(s,"] - 1"):"coords[".concat(s,"]")},i=e.map(function(s,u){return a(u)}).join(","),o=Wt(r);this.userCode=`
      void main() {
        `.concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(i,`));
      }
    `)}return n}();var QHe=function(){function n(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=e.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=e;var a=br("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=Wt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`.concat(e[0],` - rc - 1),
            `).concat(e[0],` - rc - 1);
          if(`).concat(i,`){
              result.g = getChannel(getX(`).concat(e[0],` - (rc  + 1) - 1),
                `).concat(e[0],` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `):this.userCode=`
        void main() {
          `.concat(s,` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `).concat(u(a.slice()),`;
          if(`).concat(i,`){
            result.g = `).concat(c(a.slice()),`;
          }
          if(`).concat(o,`) {
            result.b = `).concat(l(a.slice()),`;
            if(`).concat(i,`) {
              result.a = `).concat(f(a.slice()),`;
            }
          }
          setOutput(result);
        }
    `);function u(p){return h(p)}function c(p){return p[r-1]="("+p[r-1]+" + 1)",h(p)}function l(p){return p[r-2]="("+p[r-2]+" + 1)",h(p)}function f(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",h(p)}function h(p){var v=e.map(function(y,b){return d(b,p)}),m=v.join(","),g=v.slice(-2).join(",");return"getChannel(getX(".concat(m,"), vec2(").concat(g,"))")}function d(p,v){return t.indexOf(p)!==-1&&e[p]!==1?"".concat(e[p]," - ").concat(v[p]," - 1"):"".concat(v[p])}}return n}();function e5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dims,o=a.shape.length,s=k.util.parseAxisParam(i,a.shape);if(o===0)return aa({inputs:{x:a},backend:t});var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new QHe(a.shape,s):new JHe(a.shape,s);return t.runWebGLProgram(u,[a],a.dtype)}var t5e={kernelName:k.Reverse,backendName:"webgl",kernelFunc:e5e};var n5e=function(){function n(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=e[1],a=e[2];this.outputShape=e;var i="";typeof t=="number"?i="float outputValue = ".concat(t.toFixed(2),";"):i=`
        vec3 fill = vec3(`.concat(t.join(","),`);
        float outputValue = fill[coords[3]];`),this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          `.concat(i,`
          if(coordX >= 0 && coordX < `).concat(a," && coordY >= 0 && coordY < ").concat(r,`) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return n}(),r5e={kernelName:k.RotateWithOffset,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=r,c=new n5e(a.shape,o),l=Te(k.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),2),f=l[0],h=l[1],d=[[f,h,Math.sin(i),Math.cos(i)]],p=u.runWebGLProgram(c,[a],a.dtype,d);return p}};var a5e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,i5e=Nt({opSnippet:a5e}),o5e={kernelName:k.Round,backendName:"webgl",kernelFunc:i5e};var s5e="return inversesqrt(x);",u5e=Nt({opSnippet:s5e,cpuKernelImpl:E$e}),c5e={kernelName:k.Rsqrt,backendName:"webgl",kernelFunc:u5e};var Yq=function(){function n(e,t,r,a,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=Wt(i.length),c=Wt(o.length),l="";r===1?l="i":r===2&&(l="i, j");var f="getIndices(".concat(l,")"),h="";a===1?h="i":a===2&&(h="i, coords[1]");var d="getUpdates(".concat(h,")"),p=t>1?"strides[j]":"strides";this.userCode=`
        `.concat(u," strides = ").concat(u,"(").concat(i,`);

        void main() {
          `).concat(c,` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `).concat(e,`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `).concat(t,`; j++) {
              int index = round(`).concat(f,`);
              flattenedIndex += index * `).concat(p,`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `).concat(d,`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `)}return n}();function l5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=e.updates,o=r.shape,s=k.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,d=[h/l,l];if(h===0)return t.makeTensorInfo(o,a.dtype);var p=Pe({inputs:{x:a},backend:t,attrs:{shape:[c,u]}}),v=Pe({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),m=t.makeTensorInfo([],"float32",new Float32Array([0])),g=new Yq(c,u,p.shape.length,v.shape.length,f,d),y=t.runWebGLProgram(g,[v,p,m],v.dtype),b=Pe({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(m),b}var f5e={kernelName:k.ScatterNd,backendName:"webgl",kernelFunc:l5e};var h5e=function(){function n(e,t,r,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];var i="while (left < right) {",o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),s=k.env().getNumber("WEBGL_VERSION")===2?i:o,u=a==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         `.concat(s,`
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) `).concat(u,` value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `)}return n}();function d5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sortedSequence,i=e.values,o=r.side,s=new h5e(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return t.runWebGLProgram(s,[a,i],"int32",u)}var p5e={kernelName:k.SearchSorted,backendName:"webgl",kernelFunc:d5e};var v5e=function(){function n(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;var a,i;if(r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(r===1)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<t.length;c++)u.push("".concat(o[c])),c<e&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=Wt(r);this.userCode=`
      void main() {
        `.concat(l,` resRC = getOutputCoords();
        float cVal = getC(`).concat(a,`);
        if (cVal >= 1.0) {
          setOutput(getA(`).concat(i,`));
        } else {
          setOutput(getB(`).concat(i,`));
        }
      }
    `)}return n}();function m5e(n){var e=n.inputs,t=n.backend,r=e.condition,a=e.t,i=e.e,o=new v5e(r.shape.length,a.shape,a.shape.length);return t.runWebGLProgram(o,[r,a,i],k.upcastType(a.dtype,i.dtype))}var g5e={kernelName:k.Select,backendName:"webgl",kernelFunc:m5e};var y5e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `.concat(k.backend_util.SELU_SCALEALPHA,`;
  float scale = `).concat(k.backend_util.SELU_SCALE,`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`),b5e=Nt({opSnippet:y5e}),w5e={kernelName:k.Selu,backendName:"webgl",kernelFunc:b5e};var x5e=Zc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,k5e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,S5e=Nt({opSnippet:x5e,packedOpSnippet:k5e,cpuKernelImpl:C$e}),N5e={kernelName:k.Sigmoid,backendName:"webgl",kernelFunc:S5e};var T5e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,E5e=Nt({opSnippet:T5e}),I5e={kernelName:k.Sign,backendName:"webgl",kernelFunc:E5e};var C5e=Zc+`
  return sin(x);
`,A5e=Nt({opSnippet:C5e}),_5e={kernelName:k.Sin,backendName:"webgl",kernelFunc:A5e};var D5e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,F5e=Nt({opSnippet:D5e}),R5e={kernelName:k.Sinh,backendName:"webgl",kernelFunc:F5e};var O5e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,P5e=Nt({opSnippet:O5e}),M5e={kernelName:k.Softplus,backendName:"webgl",kernelFunc:P5e},B5e=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.paddings;k.util.assert(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=[[0,0]];u.push.apply(u,dn([],Te(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],f=jq({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),h=k.backend_util.getReshaped(f.shape,i,s,!1),d=k.backend_util.getPermuted(h.length,i.length,!1),p=k.backend_util.getReshapedPermuted(f.shape,i,s,!1),v=Pe({inputs:{x:f},backend:t,attrs:{shape:h}}),m=wr({inputs:{x:v},backend:t,attrs:{perm:d}}),g=Pe({inputs:{x:m},backend:t,attrs:{shape:p}});return l.push(f),l.push(v),l.push(m),l.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},L5e={kernelName:k.SpaceToBatchND,backendName:"webgl",kernelFunc:B5e};function z5e(n){var e=n.inputs,t=n.backend,r=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         `.concat(i.shape));if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         `.concat(r.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.readSync(r.dataId),u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],f=Te(_$e(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=f[0],d=f[1],p=f[2],v=f[3],m=f[4];return[t.makeTensorInfo(d,r.dtype,h),t.makeTensorInfo([d[0]],a.dtype,p),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(function(g){return Number(g)}))),t.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var $5e={kernelName:k.SparseFillEmptyRows,backendName:"webgl",kernelFunc:z5e};function q5e(n){var e=n.inputs,t=n.backend,r=e.inputIndices,a=e.inputShape,i=e.newShape;if(r.shape.length!==2)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(a.shape.length!==1)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.readSync(a.dataId)),s=t.readSync(r.dataId),u=Array.from(t.readSync(i.dataId)),c=Te(D$e(s,r.shape,r.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,r.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var W5e={kernelName:k.SparseReshape,backendName:"webgl",kernelFunc:q5e};function V5e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              `.concat(i.shape));var o=t.readSync(r.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(yq(o,r.shape,r.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var G5e={kernelName:k.SparseSegmentMean,backendName:"webgl",kernelFunc:V5e};function U5e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             `.concat(i.shape));var o=t.readSync(r.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(yq(o,r.shape,r.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var H5e={kernelName:k.SparseSegmentSum,backendName:"webgl",kernelFunc:U5e};function K5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=r.outputShape,u=k.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,d=u.outputSize,p=!1;if(i.dtype==="string"){var v=t.bufferSync(a),m=t.bufferSync(i),g=k.util.decodeString(t.readSync(o.dataId)[0]),y=I$e(v,m,s,d,f,l,c,h,g,p);return t.makeTensorInfo(s,y.dtype,y.values)}var b=new Yq(l,c,a.shape.length,i.shape.length,h,[d,1],p),w=t.runWebGLProgram(b,[i,a,o],i.dtype),x=Pe({inputs:{x:w},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(w),x}var j5e={kernelName:k.SparseToDense,backendName:"webgl",kernelFunc:K5e};function X5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.numOrSizeSplits,o=r.axis,s=k.util.parseAxisParam(o,a.shape)[0],u=k.backend_util.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),f=a.shape.slice();return u.map(function(h){var d=dn([],Te(f),!1);d[s]=h;var p=Jc({inputs:{x:a},backend:t,attrs:{begin:l,size:d}});return l[s]+=h,p})}var Y5e={kernelName:k.SplitV,backendName:"webgl",kernelFunc:X5e};var g$="return sqrt(x);",Z5e=Nt({opSnippet:g$,packedOpSnippet:g$,cpuKernelImpl:F$e}),J5e={kernelName:k.Sqrt,backendName:"webgl",kernelFunc:Z5e};var Q5e="return x * x;",eKe=Nt({opSnippet:Q5e}),tKe={kernelName:k.Square,backendName:"webgl",kernelFunc:eKe};var y$="return (a - b) * (a - b);",nKe=or({opSnippet:y$,packedOpSnippet:y$}),rKe={kernelName:k.SquaredDifference,backendName:"webgl",kernelFunc:nKe};function aKe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=Xa+`
    return x > 0.0 ? 1.0 : float(`.concat(t.alpha,`);
  `),o=new Bi(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}var iKe={kernelName:k.Step,backendName:"webgl",kernelFunc:aKe};var oKe=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=r;var a=r.length,i=Wt(r.length),o=Wt(r.length),s="";if(a===1)s="coords * strides + begin";else{var u=0;s=r.map(function(c,l){return u++,r.length===1?"coords * strides[".concat(l,"] + begin[").concat(l,"]"):"coords[".concat(u-1,"] * strides[").concat(l,"] + begin[").concat(l,"]")}).join(",")}this.userCode=`
      `.concat(i," begin = ").concat(i,"(").concat(e,`);
      `).concat(i," strides = ").concat(i,"(").concat(t,`);

      void main() {
        `).concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(s,`));
      }
    `)}return n}();function sKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,f=r.newAxisMask,h=r.shrinkAxisMask,d=k.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),p=d.finalShapeSparse,v=d.finalShape,m=d.isIdentity,g=d.sliceDim0,y=d.isSimpleSlice,b=d.begin,w=d.end,x=d.strides,N;if(m)N=Pe({inputs:{x:a},backend:t,attrs:{shape:v}});else if(g||y){k.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=k.slice_util.computeOutShape(b,w,x),E=Jc({inputs:{x:a},backend:t,attrs:{begin:b,size:T}});N=Pe({inputs:{x:E},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.shouldExecuteOnCPU([a]);if(C){var F=t.readSync(a.dataId),D=k.buffer(a.shape,a.dtype,F),O=R$e(p,D,x,b);N=t.makeTensorInfo(v,a.dtype,O.values)}else{var L=new oKe(b,x,p);N=t.runWebGLProgram(L,[a],a.dtype)}}var z=Pe({inputs:{x:N},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(N),z}var uKe={kernelName:k.StridedSlice,backendName:"webgl",kernelFunc:sKe};function cKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.readSync(l.dataId),d=t.readSync(f.dataId),p=Te(O$e(h,d,a,i,o,s,u,c),2),v=p[0],m=p[1];return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(f.shape,"int32",m)]}var lKe={kernelName:k.StringNGrams,backendName:"webgl",kernelFunc:cKe};function fKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],c=Te(P$e(s,u,a),3),l=c[0],f=c[1],h=c[2],d=f.length;return[t.makeTensorInfo([d,2],"int32",l),t.makeTensorInfo([d],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var hKe={kernelName:k.StringSplit,backendName:"webgl",kernelFunc:fKe};function dKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.readSync(i.dataId),s=M$e(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var pKe={kernelName:k.StringToHashBucketFast,backendName:"webgl",kernelFunc:dKe};var vKe="return tan(x);",mKe=Nt({opSnippet:vKe}),gKe={kernelName:k.Tan,backendName:"webgl",kernelFunc:mKe};var yKe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,bKe=Nt({opSnippet:yKe}),wKe={kernelName:k.Tanh,backendName:"webgl",kernelFunc:bKe};var xKe=function(){function n(e,t){this.variableNames=["A"];for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=e[a]*t[a];this.outputShape=r,this.rank=r.length;var i=Wt(this.rank),o=kKe(e);this.userCode=`
      void main() {
        `.concat(i,` resRC = getOutputCoords();
        setOutput(getA(`).concat(o,`));
      }
    `)}return n}();function kKe(n){var e=n.length;if(e>5)throw Error("Tile for rank ".concat(e," is not yet supported"));if(e===1)return"imod(resRC, ".concat(n[0],")");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<n.length;a++)r.push("imod(".concat(t[a],", ").concat(n[a],")"));return r.join()}function Zq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reps;if(a.dtype==="string"||a.shape.length>5){var o=t.readSync(a.dataId),s=a.dtype==="string"?o.map(function(h){return k.util.decodeString(h)}):o,u=k.buffer(a.shape,a.dtype,s),c=L$e(u,i);return t.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new xKe(a.shape,i),f=t.runWebGLProgram(l,[a],a.dtype);return f}var SKe={kernelName:k.Tile,backendName:"webgl",kernelFunc:Zq},NKe=function(){function n(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}return n}(),TKe=function(){function n(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}return n}();function fu(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function b$(n){for(var e=1;e<n;)e*=2;return e}function EKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.k,o=r.sorted,s=k.env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=k.env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(t.shouldExecuteOnCPU([a])||l<s||i>u){var f=t.readSync(a.dataId),h=Te(z$e(f,c,a.dtype,i,o),2),d=h[0],p=h[1];return[t.makeTensorInfo(d.shape,d.dtype,d.values),t.makeTensorInfo(p.shape,p.dtype,p.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,a.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(l===1)return[a,kh({attrs:{shape:c,dtype:"int32",value:0},backend:t})];var v=t.texData.get(a.dataId),m=v!==null&&v.isPacked,g=m?t.unpackTensor(a):a,y=k.util.sizeFromShape(c),b=y/l,w=Pe({inputs:{x:g},attrs:{shape:[b,l]},backend:t});m&&fu(t,g);for(var x=b$(i),N=b$(l),T=null,E=function(){return T===null?[w,w]:[w,T]},C=function(ne,oe,le){var pe=E(),xe=new NKe(le),he=T===null?1:0,ye=[[l],[he],[Number.NEGATIVE_INFINITY],[ne],[oe]],we=T;T=t.runWebGLProgram(xe,pe,"int32",ye),fu(t,we)},F=1;F<x;F*=2)for(var D=F*2,O=F;O>=1;O/=2)C(D,O,[b,N]);for(var L=N;L>x;L/=2){var z=E(),$=new TKe([b,L/2]),B=T===null?1:0,W=[[l],[B],[x]],X=T;T=t.runWebGLProgram($,z,"int32",W),fu(t,X);for(var F=x/2,D=F*2,O=F;O>=1;O/=2)C(D,O,T.shape)}var Z=T;T=Jc({inputs:{x:T},backend:t,attrs:{begin:0,size:[b,i]}}),fu(t,Z);var V=Wq({inputs:{x:w,indices:T},backend:t,attrs:{axis:1,batchDims:1}});fu(t,w);var j=c.slice(0,-1);j.push(i),Z=T,T=Pe({inputs:{x:T},attrs:{shape:j},backend:t}),fu(t,Z);var re=V;return V=Pe({inputs:{x:V},attrs:{shape:j},backend:t}),fu(t,re),[V,T]}var IKe={kernelName:k.TopK,backendName:"webgl",kernelFunc:EKe};var CKe=function(){function n(e,t,r,a,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;var s=r==="nearest"?1:2,u;switch(a){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(`.concat(u,` == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < `).concat(e," && 0 <= coordX && coordX < ").concat(t,`) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(`).concat(i,`);
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(`).concat(i,`);
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(`).concat(t,`));
                float mapY = mapCoord(inY, float(`).concat(e,`));

                if (`).concat(s,` == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `)}return n}();function AKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.image,i=e.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=Te(a.shape,4),f=l[0],h=l[1],d=l[2],p=l[3],v=Te(c??[h,d],2),m=v[0],g=v[1],y=[f,m,g,p],b=new CKe(h,d,o,s,u,y);return t.runWebGLProgram(b,[a,i],"float32")}var _Ke={kernelName:k.Transform,backendName:"webgl",kernelFunc:AKe};function DKe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=t.axis,i=e.x;Hc(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=$$e(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}var FKe={kernelName:k.Unique,backendName:"webgl",kernelFunc:DKe};function RKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,f=0;f<s;f++)f!==i&&(c[l++]=o.shape[f]);var h=[],d=new Array(s).fill(0),p=o.shape.slice();p[i]=1;for(var v=new Array(u),f=0;f<v.length;f++){d[i]=f;var m=Jc({inputs:{x:o},backend:t,attrs:{begin:d,size:p}}),g=Pe({inputs:{x:m},backend:t,attrs:{shape:c}});v[f]=g,h.push(m)}return h.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),v}var OKe={kernelName:k.Unpack,backendName:"webgl",kernelFunc:RKe};var PKe=function(){function n(e,t){this.variableNames=["x","segmentIds"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=e.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u="0.0",c="sumValue",l=Math.floor(r/4)*4,f=r%4,h=`
        sumValue += dot(values, segFilter);
    `,d="";i%r>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `));var p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return -1.0;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(u,`;

      float getValue(int batch, int inIdx) {
        `).concat(d,`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `).concat(p,`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `).concat(o,")) * float(").concat(r,`));
        int currentSeg = int(mod(float(outIdx), float(`).concat(o,`)));

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return n}();function MKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=k.backend_util.getAxesPermutation([c],s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),u.push(f),c=k.backend_util.getInnerMostAxes(1,s)[0]);var h=k.backend_util.segment_util.computeOutShape(f.shape,c,o),d=k.util.sizeFromShape([f.shape[c]]),p=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,d]}});u.push(p);var v=k.sumOutType(a.dtype),m=function(x,N,T,E,C){var F=x.shape[0],D=x.shape[1],O=k.backend_util.segment_util.segOpComputeOptimalWindowSize(D,C),L={windowSize:O,inSize:D,batchSize:F,numSegments:C},z=new PKe(L,N),$=t.compileAndRun(z,[x,T],E);if(u.push($),$.shape[1]===C)return $;var B=Xq({backend:t,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),W=Zq({inputs:{x:B},backend:t,attrs:{reps:[D/O]}});u.push(B),u.push(W);var X=m($,N,W,E,C);return X},g=m(p,"unsortedSegmentSum",i,v,o),y=Pe({inputs:{x:g},backend:t,attrs:{shape:h}}),b=y;if(l!=null){u.push(y);var w=k.backend_util.getUndoAxesPermutation(l);b=wr({inputs:{x:b},backend:t,attrs:{perm:w}})}return u.forEach(function(x){return t.disposeIntermediateTensorInfo(x)}),b}var BKe={kernelName:k.UnsortedSegmentSum,backendName:"webgl",kernelFunc:MKe},kx,w$,LKe=[Rqe,Pqe,Lqe,qqe,Vqe,Hqe,jqe,Yqe,eWe,nWe,iWe,uWe,fWe,vWe,yWe,wWe,kWe,EWe,CWe,_We,OWe,qWe,VWe,UWe,ZWe,QWe,rVe,mqe,oVe,fVe,vVe,xVe,SVe,TVe,IVe,AVe,FVe,PVe,LVe,$Ve,WVe,GVe,KVe,XVe,QVe,tGe,aGe,sGe,cGe,dGe,gGe,xGe,NGe,IGe,CGe,_Ge,FGe,OGe,MGe,LGe,WGe,UGe,jGe,YGe,QGe,nUe,oUe,lUe,vqe,hUe,cVe,vUe,yUe,xUe,yqe,TUe,AUe,DUe,PUe,LUe,WUe,UUe,XUe,QUe,n6e,a6e,u6e,l6e,h6e,m6e,y6e,w6e,k6e,N6e,C6e,F6e,M6e,G6e,xqe,j6e,Z6e,eHe,rHe,KWe,oHe,uHe,lHe,dHe,gHe,wqe,bHe,xHe,SHe,THe,EHe,jWe,$6e,AHe,RHe,BHe,Sqe,qHe,GHe,jHe,ZHe,t5e,r5e,o5e,c5e,f5e,p5e,g5e,w5e,N5e,I5e,_5e,R5e,zWe,W6e,M5e,L5e,$5e,W5e,G5e,H5e,j5e,Y5e,J5e,tKe,rKe,iKe,uKe,lKe,hKe,pKe,q6e,_qe,gKe,wKe,SKe,IKe,_Ke,Dqe,FKe,OKe,BKe,sHe];try{for(oh=ra(LKe),qc=oh.next();!qc.done;qc=oh.next())x$=qc.value,k.registerKernel(x$)}catch(n){kx={error:n}}finally{try{qc&&!qc.done&&(w$=oh.return)&&w$.call(oh)}finally{if(kx)throw kx.error}}var x$,oh,qc;Li.GPGPUContext=om;Li.MathBackendWebGL=Wx;Li.forceHalfFloat=xq;Li.gpgpu_util=XLe;Li.setWebGLContext=k$;Li.version_webgl=dqe;Li.webgl=pqe;Li.webgl_util=tLe});var ZG=Y(ku=>{"use strict";Object.defineProperty(ku,"__esModule",{value:!0});function zKe(n){return n&&typeof n=="object"&&"default"in n?n.default:n}var Xx=As(),xW=PR(),$Ke=zKe(xW),Yx=u4(),Zx=VB(),kW=fL(),qKe=Uz(),WKe=Jq(),SW="Abs",NW="Acos",TW="Acosh",vk="Add",VKe="AddN",GKe="All",UKe="Any",EW="ArgMax",IW="ArgMin",CW="Asin",AW="Asinh",_W="Atan",DW="Atanh",FW="Atan2",RW="AvgPool",HKe="AvgPoolGrad",KKe="AvgPool3D",jKe="AvgPool3DGrad",OW="BatchMatMul",PW="BatchToSpaceND",XKe="BroadcastTo",mk="Cast",MW="Ceil",BW="ClipByValue",YKe="Complex",LW="ComplexAbs",zW="Concat",$W="Conv2D",ZKe="Conv2DBackpropFilter",qW="Conv2DBackpropInput",JKe="Conv3D",QKe="Conv3DBackpropFilterV2",eje="Conv3DBackpropInputV2",WW="Cos",VW="Cosh",tje="Cumprod",GW="Cumsum",nje="DepthToSpace",UW="DepthwiseConv2dNative",rje="DepthwiseConv2dNativeBackpropFilter",aje="DepthwiseConv2dNativeBackpropInput",HW="Dilation2D",ije="Dilation2DBackpropInput",oje="Dilation2DBackpropFilter",KW="RealDiv",jW="Elu",sje="EluGrad",XW="Erf",uje="Equal",YW="Exp",ZW="ExpandDims",JW="Expm1",cje="FFT",lje="Fill",QW="Floor",eV="FloorDiv",tV="FusedBatchNorm",nV="GatherV2",fje="Greater",rV="GreaterEqual",gk="Identity",hje="IFFT",dje="Imag",aV="IsFinite",iV="IsInf",oV="IsNan",sV="LeakyRelu",pje="Less",vje="LessEqual",uV="Log",cV="Log1p",mje="LogicalAnd",gje="LogicalNot",yje="LogicalOr",bje="LogSoftmax",lV="LRN",wje="LRNGrad",fV="Max",hV="Maximum",dV="MaxPool",xje="MaxPoolGrad",kje="MaxPool3D",Sje="MaxPool3DGrad",pV="Mean",vV="Min",mV="Minimum",gV="MirrorPad",yV="Mod",bV="Multiply",wV="Neg",Nje="NotEqual",xV="OnesLike",kV="OneHot",SV="Pack",NV="PadV2",TV="Pow",EV="Prelu",IV="Prod",Tje="Real",CV="Reciprocal",AV="Relu",_V="Reshape",DV="ResizeNearestNeighbor",Eje="ResizeNearestNeighborGrad",FV="ResizeBilinear",Ije="ResizeBilinearGrad",RV="Relu6",OV="Reverse",PV="Round",MV="Rsqrt",BV="Select",LV="Selu",zV="Slice",$V="Sin",qV="Sinh",WV="Sign",VV="Sigmoid",GV="Softplus",UV="Sqrt",HV="Sum",KV="SpaceToBatchND",jV="SplitV",XV="Softmax",YV="SquaredDifference",Cje="Square",Aje="StridedSlice",ZV="Sub",JV="Tan",QV="Tanh",yk="Tile",_je="TopK",vm="Transpose",Dje="Unique",eG="Unpack",tG="UnsortedSegmentSum",nG="ZerosLike",rG="Step";var Fje=1e-7,Rje=1e-4,Jx=class{refCount(e){return ia("refCount")}incRef(e){return ia("incRef")}timerAvailable(){return!0}time(e){return ia("time")}read(e){return ia("read")}readSync(e){return ia("readSync")}readToGPU(e,t){return ia("readToGPU")}numDataIds(){return ia("numDataIds")}disposeData(e,t){return ia("disposeData")}write(e,t,r){return ia("write")}move(e,t,r,a,i){return ia("move")}createTensorFromGPUData(e,t,r){return ia("createTensorFromGPUData")}memory(){return ia("memory")}floatPrecision(){return ia("floatPrecision")}epsilon(){return this.floatPrecision()===32?Fje:Rje}dispose(){return ia("dispose")}};function ia(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function ie(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Oje(n,e,t=""){ie(bk(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function fo(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function bk(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function _h(n){return n%1===0}function mm(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function qi(n,e){let t=e.length;return n=n==null?e.map((r,a)=>a):[].concat(n),ie(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),ie(n.every(r=>_h(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function Pje(n,e){let t=[],r=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:qi(e,n).sort(),o=0;for(let s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${n[s]}' is not 1`);(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function Mje(n,e){for(let t=0;t<n.length;t++){let r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function Bje(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Qx(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function Lje(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function wk(n){return typeof n=="string"||n instanceof String}function zje(n){return typeof n=="boolean"}function $je(n){return typeof n=="number"}function xk(n){return Array.isArray(n)?xk(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":$je(n)?"float32":wk(n)?"string":zje(n)?"bool":"float32"}function ek(n){return!!(n&&n.constructor&&n.call&&n.apply)}function aG(n){let e=n.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function iG(n,e,t,r=!1){let a=new Array;if(e.length===1){let i=e[0]*(r?2:1);for(let o=0;o<i;o++)a[o]=t[n+o]}else{let i=e[0],o=e.slice(1),s=o.reduce((u,c)=>u*c)*(r?2:1);for(let u=0;u<i;u++)a[u]=iG(n+u*s,o,t,r)}return a}function Qq(n,e,t=!1){if(n.length===0)return e[0];let r=n.reduce((a,i)=>a*i)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return iG(0,n,e,t)}function oG(n,e){let t=kk(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function kk(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function Lh(n){n.forEach(e=>{ie(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Sk(n){return n&&n.then&&typeof n.then=="function"}var eW="tfjsflags",tk=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=qje,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(xn().getBool("IS_TEST")||xn().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){let a=this.urlFlags[e];xn().getBool("IS_TEST")||xn().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${a}.`),this.set(e,a)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(Sk(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);eW in e&&e[eW].split(",").forEach(r=>{let[a,i]=r.split(":");this.urlFlags[a]=Vje(a,i)})}};function qje(n){let e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(Wje(e,r[0],r[1]),r.join("="))),e}function Wje(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Vje(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${n}.`)}function xn(){return sG}var sG=null;function Gje(n){sG=n}var Hx;function uG(){if(Hx==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Hx=n}return Hx}function Uje(){let n=uG();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Nk(n,e){let t=Uje();if(t.has(n))return t.get(n);{let r=e();return t.set(n,r),t.get(n)}}function Qc(...n){xn().getBool("IS_TEST")||xn().getBool("PROD")||console.warn(...n)}var cG=Nk("kernelRegistry",()=>new Map),nk=Nk("gradRegistry",()=>new Map);function tW(n,e){let t=Kje(n,e);return cG.get(t)}function nW(n){return nk.get(n)}function rW(n){let e=cG.entries(),t=[];for(;;){let{done:r,value:a}=e.next();if(r)break;let[i,o]=a,[s]=i.split("_");s===n&&t.push(o)}return t}function Hje(n){let{kernelName:e}=n;nk.has(e)&&xn().getBool("DEBUG")&&Qc(`Overriding the gradient for '${e}'`),nk.set(e,n)}function Kje(n,e){return`${e}_${n}`}var jje=$Ke||xW;function Tk(n){return jje.fromString(n,!0,16)}var rot=Tk("c3a5c85c97cb3127"),aot=Tk("b492b66fbe98f273"),iot=Tk("9ae16a3b2f90404f");function Xje(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function lG(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Dh(n)),xn().getBool("DEBUG")&&Mje(n,e),Xje(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){let t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function wm(){return xn().platform.now()}function Yje(n,e="utf-8"){return e=e||"utf-8",xn().platform.encode(n,e)}function aW(n,e="utf-8"){return e=e||"utf-8",xn().platform.decode(n,e)}function Si(n){return xn().platform.isTypedArray(n)}function Dh(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Sk(n)||n==null||Si(n)&&t)e.push(n);else if(Array.isArray(n)||Si(n))for(let r=0;r<n.length;++r)Dh(n[r],e,t);else{let r=-1;for(let a of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(a)&&(r=Math.max(r,Number(a)));for(let a=0;a<=r;a++)Dh(n[a],e,t)}return e}var rk=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new ak)}profileKernel(e,t,r){let a,i=()=>{a=r()},o,s=wm();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(let c of a)c.dataSync();o=Promise.resolve({kernelMs:wm()-s})}if(xn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<a.length;c++){let l=a[c];l.data().then(f=>{Zje(f,l.dtype,e)})}return{kernelName:e,outputs:a,inputs:t,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:r,timeMs:a,inputs:i,extraInfo:o}=e;r.forEach(s=>{Promise.all([s.data(),a,o]).then(u=>{this.logger.logKernelProfile(t,s,u[0],u[1],i,u[2])})})}};function Zje(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){let a=n[r];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${t}'`),!0}return!1}var ak=class{logKernelProfile(e,t,r,a,i,o){let s=typeof a=="number"?mm(`${a}ms`,9):a.error,u=mm(e,25),c=t.rank,l=t.size,f=mm(t.shape.toString(),14),h="";for(let d in i){let p=i[d];if(p!=null){let v=p.shape||t.shape,m=v.length;h+=`${d}: ${m}D ${m>0?v:""} `}}console.log(`%c${u}	%c${s}	%c${c}D ${f}	%c${l}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function Jje(n,e,t){let r={},a={};for(let u=0;u<e.length;u++)r[e[u].id]=!0;for(let u=0;u<n.length;u++){let c=n[u],l=c.inputs;for(let f in l){let h=l[f],d=!1;for(let p=0;p<e.length;p++)if(r[h.id]){c.outputs.forEach(v=>r[v.id]=!0),d=!0,a[c.id]=!0;break}if(d)break}}let i={};i[t.id]=!0;let o={};for(let u=n.length-1;u>=0;u--){let c=n[u],l=c.inputs;for(let f=0;f<c.outputs.length;f++)if(i[c.outputs[f].id]){for(let h in l)i[l[h].id]=!0,o[c.id]=!0;break}}let s=[];for(let u=0;u<n.length;u++){let c=n[u];if(a[c.id]&&o[c.id]){let l={};for(let h in c.inputs){let d=c.inputs[h];r[d.id]&&(l[h]=d)}let f=Object.assign({},c);f.inputs=l,f.outputs=c.outputs,s.push(f)}}return s}function Qje(n,e,t,r){for(let a=e.length-1;a>=0;a--){let i=e[a],o=[];if(i.outputs.forEach(u=>{let c=n[u.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let s=i.gradient(o);for(let u in i.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);let c=t(()=>s[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);let l=i.inputs[u];if(!bk(c.shape,l.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${l.shape}'`);if(n[l.id]==null)n[l.id]=c;else{let f=n[l.id];n[l.id]=r(f,c),f.dispose()}}}}var iW=20,Sh=3,Kx=7;function e8e(n,e,t,r){let a=aG(e),i=t8e(n,e,t,a),o=e.length,s=gm(n,e,t,a,i),u=["Tensor"];return r&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(s.map(c=>"    "+c).join(`
`)),u.join(`
`)}function t8e(n,e,t,r){let a=fo(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Ch(n):n;if(s>1)for(let c=0;c<a/i;c++){let l=c*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Ih(u[l+f],0,t).length)}return o}function Ih(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(Kx))} + ${parseFloat(n[1].toFixed(Kx))}j`:wk(n)?r=`'${n}'`:t==="bool"?r=fG(n):r=parseFloat(n.toFixed(Kx)).toString(),mm(r,e)}function fG(n){return n===0?"false":"true"}function gm(n,e,t,r,a,i=!0){let o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){let v=Ch(n);return[Ih(v[0],0,t)]}return t==="bool"?[fG(n[0])]:[n[0].toString()]}if(u===1){if(s>iW){let m=Sh*o,g=Array.from(n.slice(0,m)),y=Array.from(n.slice((s-Sh)*o,s*o));return t==="complex64"&&(g=Ch(g),y=Ch(y)),["["+g.map((b,w)=>Ih(b,a[w],t)).join(", ")+", ..., "+y.map((b,w)=>Ih(b,a[s-Sh+w],t)).join(", ")+"]"]}let v=t==="complex64"?Ch(n):Array.from(n);return["["+v.map((m,g)=>Ih(m,a[g],t)).join(", ")+"]"]}let c=e.slice(1),l=r.slice(1),f=r[0]*o,h=[];if(s>iW){for(let v=0;v<Sh;v++){let m=v*f,g=m+f;h.push(...gm(n.slice(m,g),c,t,l,a,!1))}h.push("...");for(let v=s-Sh;v<s;v++){let m=v*f,g=m+f;h.push(...gm(n.slice(m,g),c,t,l,a,v===s-1))}}else for(let v=0;v<s;v++){let m=v*f,g=m+f;h.push(...gm(n.slice(m,g),c,t,l,a,v===s-1))}let d=u===2?",":"";h[0]="["+(s>0?h[0]+d:"");for(let v=1;v<h.length-1;v++)h[v]=" "+h[v]+d;let p=`,
`;for(let v=2;v<u;v++)p+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":p),h}function Ch(n){let e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var zi=null,Nh=null,n8e=null;function r8e(n){zi=n}function a8e(n){n8e=n}var Sr=class{constructor(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=fo(e),this.strides=aG(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return Nh.buffer(this.shape,this.dtype,e)}bufferSync(){return Nh.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return Qq(this.shape,e,this.dtype==="complex64")}arraySync(){return Qq(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=zi().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(r=>aW(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),zi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=zi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>aW(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await zi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(zi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Nh.print(this,e)}clone(){return this.throwIfDisposed(),Nh.clone(this)}toString(e=!1){let t=this.dataSync();return e8e(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Nh.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),zi().makeVariable(this,e,t,r)}};Object.defineProperty(Sr,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ce(){return Nk("Tensor",()=>Sr)}ce();var tl=class extends Sr{constructor(e,t,r,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!bk(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);zi().disposeTensor(this),this.dataId=e.dataId,zi().incRef(this,null)}dispose(){zi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(tl,Symbol.hasInstance,{value:n=>n instanceof Sr&&n.assign!=null&&n.assign instanceof Function});var oW;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(oW||(oW={}));var ik;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(ik||(ik={}));var ok;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(ok||(ok={}));var sk;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(sk||(sk={}));var uk;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(uk||(uk={}));var i8e={float32:sk,int32:ik,bool:ok,complex64:uk};function o8e(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return i8e[n][e]}function Qn(n,e){if(n.dtype===e.dtype)return[n,e];let t=o8e(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function hG(n){let e=[];return dG(n,e,new Set),e}function dG(n,e,t){if(n==null)return;if(n instanceof Sr){e.push(n);return}if(!s8e(n))return;let r=n;for(let a in r){let i=r[a];t.has(i)||(t.add(i),dG(i,e,t))}}function s8e(n){return Array.isArray(n)||typeof n=="object"}function jx(n){return n.kernelName!=null}var xm=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},rs=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new xm}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Qc(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new rk(this.backendInstance),!0}setupRegisteredKernels(){rW(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){rW(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let r=t.factory();if(r&&!(r instanceof Jx)&&typeof r.then=="function"){let a=++this.pendingBackendInitId,i=r.then(o=>a<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,Qc(`Initialization of backend ${e} failed`),Qc(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Qc(`Initialization of backend ${e} failed`),Qc(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let r=e[t],{success:a,asyncInit:i}=this.initializeBackend(r);if(i||a)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let a;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(a),()=>(a=t(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(e,t,r){e();try{let a=r();return t(),a}catch(a){throw t(),a}}nextTensorId(){return rs.nextTensorId++}nextVariableId(){return rs.nextVariableId++}clone(e){let t=ae.runKernel(gk,{x:e}),r={x:e},a=o=>({x:()=>{let s="float32",u={x:o},c={dtype:s};return ae.runKernel(mk,u,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,!(tW(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){let a=this.backend.numDataIds(),i=0;r.forEach(u=>{i+=u.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[],a=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u,c=jx(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(jx(e)){let{kernelName:p,inputs:v,attrs:m}=e;this.backendName==null&&this.backend;let g=tW(p,this.backendName);ie(g!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),s=()=>{let y=this.backend.numDataIds();u=g.kernelFunc({inputs:v,attrs:m,backend:this.backend});let b=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,y,b);let w=b.map(x=>x.rank!=null?x:this.makeTensorFromTensorInfo(x));if(a){let x=this.getTensorsForGradient(p,v,w);r=this.saveTensorsForBackwardMode(x)}return w}}else{let{forwardFunc:p}=e,v=m=>{!a||(r=m.map(g=>this.keep(this.clone(g))))};s=()=>{let m=this.backend.numDataIds();u=this.tidy(()=>p(this.backend,v));let g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,m,g),g}}let{inputs:l,attrs:f}=e,h=jx(e)?null:e.backwardsFunc,d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=s():(d=this.profiler.profileKernel(c,l,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),t=d.outputs)}),a&&this.addTapeNode(c,l,t,h,r,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(p=>l[p]!=null?l[p].shape:null),outputShapes:t.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,t,r){let a=nW(e);if(a!=null){let i=a.inputsToSave||[],o=a.outputsToSave||[],s;a.saveAllInputs?(ie(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(c=>t[c])):s=i.map(c=>t[c]);let u=r.filter((c,l)=>o[l]);return s.concat(u)}return[]}makeTensor(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;let i=e;r==="string"&&wk(e[0])&&(i=e.map(u=>Yje(u)));let o=a.write(i,t,r),s=new Sr(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){let u=this.state.tensorInfo.get(o),c=Lje(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s}makeTensorFromDataId(e,t,r,a){r=r||"float32";let i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)}makeTensorFromTensorInfo(e,t){let{dataId:r,shape:a,dtype:i}=e,o=new Sr(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,r,a){r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));let i=new tl(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Qx(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof tl||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let r=e.size*Qx(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,a,i,o){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},u=nW(e);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=c=>(c=c.map((l,f)=>{if(l==null){let h=r[f],d=kk(h.size,h.dtype);return this.makeTensor(d,h.shape,h.dtype)}return l}),a(c.length>1?c:c[0],i,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=hG(e),r=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let o=this.state.activeScope.track[i];!o.kept&&!r.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===a.id&&this.track(i)})}gradients(e,t,r,a=!1){if(ie(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));ie(i instanceof Sr,()=>"The result y returned by f() must be a tensor.");let o=Jje(this.state.activeTape,t,i);if(!a&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let s={};s[i.id]=r??u8e(i.shape),Qje(s,o,c=>this.tidy(c),l8e);let u=t.map(c=>s[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(let l of c.saved)l.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(e){return ie(ek(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{ie(t.every(s=>s instanceof Sr),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r,a={};t.forEach((s,u)=>{a[u]=s});let i=(s,u)=>(r=e(...t,u),ie(r.value instanceof Sr,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ie(ek(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(s,u)=>{let c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];ie(l.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ie(l.every(h=>h instanceof Sr),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return l.forEach((h,d)=>{f[d]=()=>h}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=wm(),r=await this.backend.time(e);return r.wallMs=wm()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new xm;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};rs.nextTensorId=0;rs.nextVariableId=0;function u8e(n){let e=oG(fo(n),"float32");return ae.makeTensor(e,n,"float32")}function c8e(){let n=uG();if(n._tfengine==null){let e=new tk(n);n._tfengine=new rs(e)}return Gje(n._tfengine.ENV),r8e(()=>n._tfengine),n._tfengine}var ae=c8e();function l8e(n,e){let t={a:n,b:e};return ae.runKernel(vk,t)}function f8e(n,e){let t=n;if(Si(n))return e==="string"?[]:[n.length];if(typeof n=="object"){if("texture"in n){let i=n.channels||"RGBA";return[n.height,n.width*i.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:Qx(e))]}if(!Array.isArray(n))return[];let a=[];for(;Array.isArray(t)||Si(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(n)&&xn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&pG(n,a,[]),a}function pG(n,e,t){if(t=t||[],!Array.isArray(n)&&!Si(n)){ie(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}ie(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),ie(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);let r=e.slice(1);for(let a=0;a<n.length;++a)pG(n[a],r,t.concat(a))}function sW(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function ee(n,e,t,r="numeric"){if(n instanceof Sr)return sW(r,n.dtype,e,t),n;let a=xk(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),sW(r,a,e,t),n==null||!Si(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){let u=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}let i=f8e(n,a);!Si(n)&&!Array.isArray(n)&&(n=[n]);let s=a!=="string"?lG(n,a):Dh(n,[],!0);return ae.makeTensor(s,i,a)}function vG(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>ee(i,`${e}[${o}]`,t,r))}var h8e="__op";function ue(n){let e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+h8e;let a=(...i)=>{ae.startScope(t);try{let o=r(...i);return Sk(o)&&console.error("Cannot return a Promise inside of tidy."),ae.endScope(o),o}catch(o){throw ae.endScope(null),o}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function d8e(n,e){let t=ee(n,"x","cast");if(!Bje(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:t},a={dtype:e};return ae.runKernel(mk,r,a)}var ot=ue({cast_:d8e});function p8e(n,e){let t=ee(n,"a","mul"),r=ee(e,"b","mul");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(bV,a)}var $e=ue({mul_:p8e});function v8e(n,e=0){let r={x:ee(n,"x","step")},a={alpha:e};return ae.runKernel(rG,r,a)}var Cm=ue({step_:v8e});var mG={kernelName:SW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,Cm(ot(t,"float32"),-1))}}};function m8e(n,e){let t=ee(n,"a","floorDiv"),r=ee(e,"b","floorDiv");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(eV,a)}var gG=ue({floorDiv_:m8e});function g8e(n,e){let t=ee(n,"a","div"),r=ee(e,"b","div");if([t,r]=Qn(t,r),t.dtype==="int32"&&r.dtype==="int32")return gG(t,r);let a={a:t,b:r},i={};return ae.runKernel(KW,a,i)}var Fn=ue({div_:g8e});function y8e(n){let t={x:ee(n,"x","neg")};return ae.runKernel(wV,t)}var Nr=ue({neg_:y8e});function b8e(n,e,t,r){if(r==null)r=xk(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return ae.backend.createTensorFromGPUData(n,e||t,r)}if(!Si(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Lh(e);let a=fo(e),i=fo(t);ie(a===i,()=>`Based on the provided shape, [${e}], the tensor should have ${a} values but has ${i}`);for(let o=0;o<t.length;++o){let s=t[o],u=o===t.length-1?s!==fo(e.slice(o)):!0;ie(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Si(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?lG(n,r):Dh(n,[],!0),ae.makeTensor(n,e,r)}function Jn(n,e){if((Si(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Si(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return b8e(n,[],[],e)}function w8e(n){let t={x:ee(n,"x","sqrt","float32")};return ae.runKernel(UV,t)}var as=ue({sqrt_:w8e});function x8e(n){let e=ee(n,"x","square"),t={};return ae.runKernel("Square",{x:e},t)}var sr=ue({square_:x8e});function k8e(n,e){let t=ee(n,"a","sub"),r=ee(e,"b","sub");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(ZV,a)}var fr=ue({sub_:k8e});var S8e={kernelName:NW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=sr(ot(t,"float32")),a=as(fr(Jn(1),r));return Nr(Fn(n,a))}}}};var N8e={kernelName:TW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=as(fr(sr(ot(t,"float32")),1));return Fn(n,r)}}}};function ur(n,e){let t=[];for(let r=0;r<e.length;r++){let a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Rn(n,e){let t=[],r=Math.max(n.length,e.length);for(let a=0;a<r;a++){let i=n[n.length-a-1];i==null&&(i=1);let o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){let s=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(s)}else t.unshift(i)}return t}function T8e(n,e){let r={x:ee(n,"x","reshape","string_or_numeric")},a={shape:e};return ae.runKernel(_V,r,a)}var de=ue({reshape_:T8e});function E8e(n,e=null,t=!1){let r=ee(n,"x","sum");r.dtype==="bool"&&(r=ot(r,"int32"));let a={x:r},i={axis:e,keepDims:t};return ae.runKernel(HV,a,i)}var Tt=ue({sum_:E8e});var I8e={kernelName:vk,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=n,u=ur(t.shape,a);return u.length>0&&(s=Tt(s,u)),de(s,t.shape)},b:()=>{let s=n,u=ur(r.shape,a);return u.length>0&&(s=Tt(s,u)),de(s,r.shape)}}}};var C8e={kernelName:VKe,saveAllInputs:!0,gradFunc:(n,e)=>{let t={};return e.forEach((r,a)=>{t[a]=()=>n.clone()}),t}};function A8e(n){let t={x:ee(n,"x","zerosLike")};return ae.runKernel(nG,t)}var kn=ue({zerosLike_:A8e});var _8e={kernelName:EW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>kn(t)}}};var D8e={kernelName:IW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>kn(t)}}};var F8e={kernelName:CW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,as(fr(Jn(1),sr(ot(t,"float32")))))}}};function R8e(n,e){let t=ee(n,"a","add"),r=ee(e,"b","add");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(vk,a)}var Ya=ue({add_:R8e});var O8e={kernelName:AW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=as(Ya(Jn(1),sr(ot(t,"float32"))));return Fn(n,r)}}}};var P8e={kernelName:FW,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=Ya(sr(t),sr(r)),u=$e(n,Fn(r,s)),c=ur(t.shape,a);return c.length>0&&(u=Tt(u,c)),de(u,t.shape)},b:()=>{let s=Ya(sr(t),sr(r)),u=Nr($e(n,Fn(t,s))),c=ur(r.shape,a);return c.length>0&&(u=Tt(u,c)),de(u,r.shape)}}}};var M8e={kernelName:_W,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,Ya(sr(ot(t,"float32")),1))}}};var B8e={kernelName:DW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,fr(Jn(1),sr(ot(t,"float32"))))}}};function L8e(n,e,t,r,a,i,o="channelsLast"){let[s,u]=Fh(e),c;if(o==="channelsLast")c=[s,u,n[3],n[3]];else if(o==="channelsFirst")c=[s,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return z8e(n,c,t,r,a,i,!1,o)}function z8e(n,e,t,r,a,i,o=!1,s="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if(s==="channelsLast")[u,c,l,f]=n;else if(s==="channelsFirst")[u,f,c,l]=n;else throw new Error(`Unknown dataFormat ${s}`);let[h,d,,p]=e,[v,m]=Fh(t),[g,y]=Fh(r),b=ck(h,g),w=ck(d,y),{padInfo:x,outHeight:N,outWidth:T}=W8e(a,c,l,v,m,b,w,i,s),E=o?p*f:p,C;return s==="channelsFirst"?C=[u,E,N,T]:s==="channelsLast"&&(C=[u,N,T,E]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:T,outChannels:E,padInfo:x,strideHeight:v,strideWidth:m,filterHeight:h,filterWidth:d,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:g,dilationWidth:y,inShape:n,outShape:C,filterShape:e}}function $8e(n,e,t,r,a){r==null&&(r=q8e(n,e,t));let i=n[0],o=n[1],s=km((i-e+2*r)/t+1,a),u=km((o-e+2*r)/t+1,a);return[s,u]}function q8e(n,e,t,r=1){let a=ck(e,r);return Math.floor((n[0]*(t-1)-t+a)/2)}function Fh(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function ck(n,e){return e<=1?n:n+(n-1)*(e-1)}function W8e(n,e,t,r,a,i,o,s,u){let c,l,f;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};let d=$8e([e,t],i,r,n,s);l=d[0],f=d[1]}else if(n==="same"){l=Math.ceil(e/r),f=Math.ceil(t/a);let h=Math.max(0,(l-1)*r+i-e),d=Math.max(0,(f-1)*a+o-t),p=Math.floor(h/2),v=h-p,m=Math.floor(d/2),g=d-m;c={top:p,bottom:v,left:m,right:g,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/a);else if(typeof n=="object"){let h=u==="channelsLast"?n[1][0]:n[2][0],d=u==="channelsLast"?n[1][1]:n[2][1],p=u==="channelsLast"?n[2][0]:n[3][0],v=u==="channelsLast"?n[2][1]:n[3][1];c={top:h,bottom:d,left:p,right:v,type:h===0&&d===0&&p===0&&v===0?"VALID":"EXPLICIT"},l=km((e-i+h+d)/r+1,s),f=km((t-o+p+v)/a+1,s)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:l,outWidth:f}}function km(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Rh(n){let[e,t,r]=Fh(n);return e===1&&t===1&&r===1}function il(n,e){return Rh(n)||Rh(e)}function Sm(n){return Fh(n).every(e=>e>0)}function Ni(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")ie(_h(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(a=>{ie(_h(a),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${a}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}function V8e(n,e,t,r,a,i){let o=ee(n,"dy","avgPool3dGrad"),s=ee(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=de(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=de(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),ie(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),ie(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Ni("avgPool3dGrad",a,i);let f={dy:u,input:c},h={filterSize:t,strides:r,pad:a,dimRoundingMode:i},d=ae.runKernel(jKe,f,h);return l?de(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var G8e=ue({avgPool3dGrad_:V8e});var U8e={kernelName:KKe,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=t;return{x:()=>G8e(n,r,a,i,o,s)}}};function H8e(n,e,t,r,a){let i=ee(n,"dy","avgPoolGrad"),o=ee(e,"input","avgPoolGrad");ie(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let s=o,u=i,c=!1;o.rank===3&&(c=!0,s=de(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=de(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),ie(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);let l={dy:u,input:s},f={filterSize:t,strides:r,pad:a},h=ae.runKernel(HKe,l,f);return c?de(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var K8e=ue({avgPoolGrad_:H8e});var j8e={kernelName:RW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{filterSize:a,strides:i,pad:o}=t;return{x:()=>K8e(n,r,a,i,o)}}};function X8e(n,e,t=!1,r=!1){let a=ee(n,"a","matMul"),i=ee(e,"b","matMul");[a,i]=Qn(a,i);let o={a,b:i},s={transposeA:t,transposeB:r};return ae.runKernel(OW,o,s)}var xa=ue({matMul_:X8e});var Y8e={kernelName:OW,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{let[r,a]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>xa(n,a,!1,!0),b:()=>xa(r,n,!0,!1)}:!i&&o?{a:()=>xa(n,a,!1,!1),b:()=>xa(n,r,!0,!1)}:i&&!o?{a:()=>xa(a,n,!1,!0),b:()=>xa(r,n,!1,!1)}:{a:()=>xa(a,n,!0,!0),b:()=>xa(n,r,!0,!0)}}};function Z8e(n,e,t){let r=ee(n,"x","spaceToBatchND");ie(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),ie(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),ie(r.shape.reduce((o,s,u)=>u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let a={x:r},i={blockShape:e,paddings:t};return ae.runKernel(KV,a,i)}var Ek=ue({spaceToBatchND_:Z8e});var J8e={kernelName:PW,gradFunc:(n,e,t)=>{let{blockShape:r,crops:a}=t;return{x:()=>Ek(n,r,a)}}};var Q8e={kernelName:XKe,gradFunc:(n,e,t)=>{let r=t,a=r.inputShape,i=r.shape,o=Array.from(i);for(let u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);let s=[];for(let u=0;u<o.length;u++)o[u]>1&&s.push(u);return{x:()=>Tt(n,s,!0)}}};var e7e={kernelName:mk,gradFunc:n=>({x:()=>n.clone()})};var t7e={kernelName:MW,gradFunc:n=>({x:()=>kn(n)})};function n7e(n,e){let t=ee(n,"a","greaterEqual","string_or_numeric"),r=ee(e,"b","greaterEqual","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(rV,a)}var Am=ue({greaterEqual_:n7e});function r7e(n,e){let t=ee(n,"a","lessEqual","string_or_numeric"),r=ee(e,"b","lessEqual","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(vje,a)}var _m=ue({lessEqual_:r7e});function a7e(n,e){let t=ee(n,"a","logicalAnd","bool"),r=ee(e,"b","logicalAnd","bool");Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(mje,a)}var Oh=ue({logicalAnd_:a7e});function i7e(n){let t={x:ee(n,"x","clone","string_or_numeric")};return ae.runKernel(gk,t)}var yG=ue({clone_:i7e});function o7e(n,e){let t=ee(n,"broadcastTo","x"),r=t.shape;if(Lh(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=de(t,c)}let a=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(a[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(i.map((c,l)=>c>1?l:-1).filter(c=>c>=0).length===0)return yG(t);let s={x:t},u={reps:i};return ae.runKernel(yk,s,u)}var ym=ue({broadcastTo_:o7e});function s7e(n,e,t){let r=ee(e,"a","where"),a=ee(t,"b","where"),i=ee(n,"condition","where","bool"),o=Rn(Rn(i.shape,r.shape),a.shape),s=ym(i,o),u=ym(r,o),c=ym(a,o),l={condition:s,t:u,e:c};return ae.runKernel(BV,l)}var ho=ue({where_:s7e});var u7e={kernelName:BW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{clipValueMin:a,clipValueMax:i}=t;return{x:()=>ho(Oh(Am(r,a),_m(r,i)),n,kn(n))}}};var c7e={kernelName:LW,inputsToSave:["x"],gradFunc:mG.gradFunc};function l7e(n,e,t=0){let a={x:ee(n,"x","split")},i={numOrSizeSplits:e,axis:t};return ae.runKernel(jV,a,i)}var Nm=ue({split_:l7e});var f7e={kernelName:zW,saveAllInputs:!0,gradFunc:(n,e,t)=>{let r=e.map(u=>u.shape),{axis:a}=t,i=qi(a,e[0].shape)[0],o=r.map(u=>u[i]);return Nm(n,o,i).map(u=>()=>u)}};function h7e(n,e,t,r,a,i="NHWC",o){let s=n;n.rank===3&&(s=de(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=de(e,[1,e.shape[0],e.shape[1],e.shape[2]])),ie(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),ie(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),ie(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];ie(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),ie(l===t[3],()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${t[3]}).`),Ni("conv2dDerFilter",a,o);let f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ae.runKernel(ZKe,f,h)}var bG=ue({conv2DBackpropFilter_:h7e});function d7e(n,e,t,r,a,i="NHWC",o){ie(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let s=n,u=e,c=!1;e.rank===3&&(c=!0,u=de(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),ie(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),ie(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),ie(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];ie(l===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[2]}.`),ie(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Ni("conv2dDerInput",a,o);let h={dy:u,filter:t},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=ae.runKernel(qW,h,d);return c?de(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var wG=ue({conv2DBackpropInput_:d7e});var p7e={kernelName:$W,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let[r,a]=e,{dilations:i,strides:o,pad:s,dataFormat:u}=t;return ie(Rh(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>wG(r.shape,n,a,o,s,u),filter:()=>bG(r,n,a.shape,o,s,u)}}};function v7e(n,e,t,r,a="NHWC",i=[1,1],o){let s=ee(n,"x","conv2d","float32"),u=ee(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=de(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Ni("conv2d",r,o);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),ie(il(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ie(Sm(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),ie(Sm(t),()=>"Error in conv2D: Strides should be larger than 0.");let h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=ae.runKernel($W,h,d);return l?de(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Dm=ue({conv2d_:v7e});var m7e={kernelName:qW,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{let[r,a]=e,{strides:i,pad:o,dataFormat:s,dimRoundingMode:u}=t;return{dy:()=>Dm(n,a,i,o,s,1,u),filter:()=>bG(n,r,a.shape,i,o,s,u)}}};function g7e(n,e,t,r,a){let i=n;n.rank===4&&(i=de(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=de(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),ie(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),ie(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),ie(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),ie(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),ie(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);let s={x:i,dy:o},u={strides:r,pad:a,filterShape:t};return ae.runKernel(QKe,s,u)}var y7e=ue({conv3DBackpropFilter_:g7e});function b7e(n,e,t,r,a){ie(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,s=!1;e.rank===4&&(s=!0,o=de(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);let u=i[4],c=o.shape[4];ie(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),ie(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),ie(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),ie(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),ie(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);let l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=ae.runKernel(eje,l,f);return s?de(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var w7e=ue({conv3DBackpropInput_:b7e});var x7e={kernelName:JKe,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let{dilations:r,strides:a,pad:i}=t;ie(Rh(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[o,s]=e;return{x:()=>w7e(o.shape,n,s,a,i),filter:()=>y7e(o,n,s.shape,a,i)}}};function k7e(n){let t={x:ee(n,"x","sin","float32")};return ae.runKernel($V,t)}var xG=ue({sin_:k7e});var S7e={kernelName:WW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(Nr(xG(ot(t,"float32"))),n)}}};function N7e(n){let t={x:ee(n,"x","sinh")};return ae.runKernel(qV,t)}var kG=ue({sinh_:N7e});var T7e={kernelName:VW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(kG(ot(t,"float32")),n)}}};function E7e(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function I7e(n,e,t){let r=n.length+e.length,a=[],i=0,o=0;for(let s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function C7e(n,e){let t=[],r=n.length;for(let i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);let a=e.map(i=>n[i]);return[t,a]}function Tm(n,e){let t=e.map(r=>1);return I7e(n,t,e)}function SG(n,e){if(E7e(n,e))return null;let t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function Ik(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function A7e(n,e=0,t=!1,r=!1){let i={x:ee(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:r};return ae.runKernel(GW,i,o)}var NG=ue({cumsum_:A7e});function _7e(n){xn().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}a8e(_7e);function D7e(n,e){return ae.tidy(n,e)}function uW(n){hG(n).forEach(t=>t.dispose())}function F7e(n,e){let t=ee(n,"real","complex"),r=ee(e,"imag","complex");Oje(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);let a={real:t,imag:r};return ae.runKernel(YKe,a)}var nl=ue({complex_:F7e});function R7e(n){let t={input:ee(n,"input","imag")};return ae.runKernel(dje,t)}var Ck=ue({imag_:R7e});function O7e(n){let t={input:ee(n,"input","real")};return ae.runKernel(Tje,t)}var Em=ue({real_:O7e});function P7e(n,e,t){let r=ee(n,"x","transpose");if(e==null&&(e=r.shape.map((o,s)=>s).reverse()),ie(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(o=>{ie(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();let a={x:r},i={perm:e};return r.dtype==="complex64"?D7e(()=>{let o=Em(r),s=Ck(r);return o=ae.runKernel(vm,{x:o},i),s=ae.runKernel(vm,{x:s},i),t&&(s=Nr(s)),nl(o,s)}):ae.runKernel(vm,a,i)}var yu=ue({transpose_:P7e});var M7e={kernelName:GW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{axis:a,exclusive:i,reverse:o}=t;return{x:()=>{let s=SG([a],r.rank),u=NG(n,a,i,!o);return s!=null&&(u=yu(u,s)),u}}}};function B7e(n,e,t,r,a,i=[1,1],o){let s=n;n.rank===3&&(s=de(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=de(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ae.runKernel(rje,c,l)}var L7e=ue({depthwiseConv2dNativeBackpropFilter_:B7e});function z7e(n,e,t,r,a,i=[1,1],o){let s=e,u=!1;e.rank===3&&(u=!0,s=de(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=ae.runKernel(aje,c,l);return u?de(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var $7e=ue({depthwiseConv2dNativeBackpropInput_:z7e});var q7e={kernelName:UW,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let{dilations:r,strides:a,pad:i,dimRoundingMode:o}=t,s=r??[1,1];ie(Rh(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[u,c]=e;return ie(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),ie(u.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),ie(il(a,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${s}'.`),Ni("depthwiseConv2d",i,o),{x:()=>$7e(u.shape,n,c,a,i,s,o),filter:()=>L7e(u,n,c.shape,a,i,s,o)}}};var W7e={kernelName:HW,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let[r,a]=e,i={x:r,filter:a,dy:n},o={x:r,filter:a,dy:n};return{x:()=>ae.runKernel(ije,i,t),filter:()=>ae.runKernel(oje,o,t)}}};var V7e={kernelName:jW,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e,r={dy:n,y:t};return{x:()=>ae.runKernel(sje,r)}}};function G7e(n){let t={x:ee(n,"x","exp")};return ae.runKernel(YW,t)}var is=ue({exp_:G7e});var U7e={kernelName:XW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e,r=$e(is(Nr(sr(t))),2/Math.sqrt(Math.PI));return{x:()=>$e(n,r)}}};var H7e={kernelName:YW,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,t)}}};var K7e={kernelName:ZW,inputsToSave:["input"],gradFunc:(n,e)=>{let[t]=e;return{input:()=>de(n,t.shape)}}};var j7e={kernelName:JW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,is(t))}}};var X7e={kernelName:QW,gradFunc:n=>({x:()=>kn(n)})};var Y7e={kernelName:eV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=Fn(n,ot(r,"float32")),u=ur(t.shape,a);return u.length>0?de(Tt(s,u),t.shape):s},b:()=>{let s=$e(n,ot(t,"float32")),u=ur(r.shape,a);u.length>0&&(s=de(Tt(s,u),r.shape));let c=sr(r);return Nr(Fn(s,ot(c,"float32")))}}}};function Z7e(n){let t={x:ee(n,"x","rsqrt","float32")};return ae.runKernel(MV,t)}var TG=ue({rsqrt_:Z7e});function J7e(n,e){let t=ee(n,"x","tile","string_or_numeric");ie(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let r={x:t},a={reps:e};return ae.runKernel(yk,r,a)}var EG=ue({tile_:J7e});var Q7e={kernelName:tV,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{let{varianceEpsilon:r}=t,[a,i,o,s]=e,u=s??Jn(1),c=ur(i.shape,a.shape),l=[];if(i.rank===1){for(let w=0;w<a.shape.length-1;++w)l.push(a.shape[w]);l.push(1)}let f=fr(a,i),h=$e(n,u),d=TG(Ya(o,Jn(r))),p=$e($e($e(d,d),d),Jn(-.5));return{x:()=>i.rank===1?de($e($e(n,EG(de(d,[1,1,1,i.shape[0]]),l)),u),a.shape):de($e($e(n,d),u),a.shape),mean:()=>{let w=$e($e(d,Jn(-1)),h);return i.rank===1&&(w=Tt(w,c)),de(w,i.shape)},variance:()=>{let w=$e($e(p,f),h);return i.rank===1&&(w=Tt(w,c)),de(w,i.shape)},scale:()=>{let w=$e(f,d),x=$e(n,w);return i.rank===1&&(x=Tt(x,c)),de(x,i.shape)},offset:()=>{let w=n;return i.rank===1&&(w=Tt(w,c)),de(w,i.shape)}}}};function eXe(n,e,t){let r=ee(n,"x","unsortedSegmentSum"),a=ee(e,"segmentIds","unsortedSegmentSum","int32");ie(_h(t),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:a},o={numSegments:t};return ae.runKernel(tG,i,o)}var IG=ue({unsortedSegmentSum_:eXe});var tXe={kernelName:nV,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{let[r,a]=e,{axis:i}=t,o=qi(i,r.shape)[0];return{x:()=>{let u=r.shape,c=a.size,l=u.slice(0,o),f=l.length,h=u.slice(i,u.length).slice(1),d=h.length,p=cW(0,f),v=cW(f+1,f+1+d),m=lW([l,[c],h]),g=de(n,m),y=de(a,[c]),b=lW([[f],p,v]),w=yu(g,b),x=IG(w,y,r.shape[o]),N=Ik(b);return x=yu(x,N),x},indices:()=>a}}};function cW(n,e){let t=[];for(let r=n;r<e;++r)t.push(r);return t}function lW(n){let e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var nXe={kernelName:rV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e;return{a:()=>kn(t),b:()=>kn(r)}}};var rXe={kernelName:gk,gradFunc:n=>({x:()=>ot(n,"float32")})};var aXe={kernelName:aV,gradFunc:n=>({x:()=>kn(n)})};var iXe={kernelName:iV,gradFunc:n=>({x:()=>kn(n)})};var oXe={kernelName:oV,gradFunc:n=>({x:()=>kn(n)})};function sXe(n,e){let t=ee(n,"a","greater","string_or_numeric"),r=ee(e,"b","greater","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(fje,a)}var ol=ue({greater_:sXe});var uXe={kernelName:sV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{alpha:a}=t,i=ol(r,0);return{x:()=>ho(i,n,$e(n,a))}}};var cXe={kernelName:cV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,Ya(t,1))}}};var lXe={kernelName:uV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,ot(t,"float32"))}}};var fXe={kernelName:bje,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r]=e,{axis:a}=t;return{logits:()=>{let o=is(r);return fr(n,$e(Tt(n,a,!0),o))}}}};function hXe(n,e,t,r=5,a=1,i=1,o=.5){let s={x:n,y:e,dy:t},u={depthRadius:r,bias:a,alpha:i,beta:o};return ae.runKernel(wje,s,u)}var dXe=ue({localResponseNormalizationBackprop_:hXe});var pXe={kernelName:lV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r,a]=e,{depthRadius:i,bias:o,alpha:s,beta:u}=t;return{x:()=>dXe(r,a,n,i,o,s,u)}}};function vXe(n,e){let t=ee(n,"a","equal","string_or_numeric"),r=ee(e,"b","equal","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(uje,a)}var Ak=ue({equal_:vXe});function CG(n,e,t,r){return e.rank<t.rank&&(e=de(e,Tm(e.shape,r))),n.rank<t.rank&&(n=de(n,Tm(n.shape,r))),{x:()=>$e(n,ot(Ak(t,e),n.dtype))}}var fW={kernelName:fV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let r=t,{reductionIndices:a}=r,i=e[0],o=e[1],s=qi(a,i.shape),u=CG(n,o,i,s);return{x:()=>u.x()}}};function mXe(n,e){let t=ee(n,"a","less","string_or_numeric"),r=ee(e,"b","less","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(pje,a)}var AG=ue({less_:mXe});var gXe={kernelName:hV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e;return{a:()=>$e(n,ot(Am(t,r),"float32")),b:()=>$e(n,ot(AG(t,r),"float32"))}}};function yXe(n,e,t,r,a,i,o){let s=ee(n,"dy","maxPool3dGrad"),u=ee(e,"input","maxPool3dGrad"),c=ee(t,"output","maxPool3dGrad"),l=s,f=u,h=c,d=!1;u.rank===4&&(d=!0,l=de(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=de(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=de(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),ie(l.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),ie(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),ie(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Ni("maxPool3dGrad",i,o);let p={dy:l,input:f,output:h},v={filterSize:r,strides:a,pad:i,dimRoundingMode:o},m=ae.runKernel(Sje,p,v);return d?de(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var bXe=ue({maxPool3dGrad_:yXe});var wXe={kernelName:kje,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r,a]=e,{filterSize:i,strides:o,pad:s,dimRoundingMode:u}=t;return{x:()=>bXe(n,r,a,i,o,s,u)}}};function xXe(n,e,t,r,a,i,o){let s=ee(n,"dy","maxPoolGrad"),u=ee(e,"input","maxPoolGrad"),c=ee(t,"output","maxPoolGrad");ie(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),ie(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),ie(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Ni("maxPoolGrad",i,o);let l={dy:s,input:u,output:c},f={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return ae.runKernel(xje,l,f)}var kXe=ue({maxPoolGrad_:xXe});var SXe={kernelName:dV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r,a]=e,{filterSize:i,strides:o,pad:s}=t;return{x:()=>kXe(n,r,a,i,o,s)}}};function Ph(n,e="float32"){if(Lh(n),e==="complex64"){let r=Ph(n,"float32"),a=Ph(n,"float32");return nl(r,a)}let t=kk(fo(n),e);return ae.makeTensor(t,n,e)}function Fm(n,e="float32"){if(Lh(n),e==="complex64"){let r=Fm(n,"float32"),a=Ph(n,"float32");return nl(r,a)}let t=oG(fo(n),e);return ae.makeTensor(t,n,e)}var NXe={kernelName:pV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{axis:a}=t,i=qi(a,r.shape),s=C7e(r.shape,i)[1],u=fo(s);return{x:()=>{let l=r.shape.slice();i.forEach(d=>{l[d]=1});let f=de(n,l);return Fn($e(f,Fm(r.shape,"float32")),u)}}}};var TXe={kernelName:vV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let r=t,{axis:a}=r,[i,o]=e,s=qi(a,i.shape),u=CG(n,o,i,s);return{x:()=>u.x()}}};var EXe={kernelName:mV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e;return{a:()=>$e(n,ot(_m(t,r),"float32")),b:()=>$e(n,ot(ol(t,r),"float32"))}}};function IXe(n,e,t){let r=ee(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let a={x:r},i={begin:e,size:t};return ae.runKernel(zV,a,i)}var $i=ue({slice_:IXe});var CXe={kernelName:gV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let r=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>$i(n,i,r.shape)}}};function AXe(n){let t={x:ee(n,"x","floor","float32")};return ae.runKernel(QW,t)}var _G=ue({floor_:AXe});var _Xe={kernelName:yV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=ur(t.shape,a);return s.length>0?de(Tt(n,s),t.shape):n},b:()=>{let s=$e(n,Nr(_G(Fn(t,r)))),u=ur(r.shape,a);return u.length>0?de(Tt(s,u),r.shape):s}}}};var DXe={kernelName:bV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=$e(n,ot(r,"float32")),u=ur(t.shape,a);return u.length>0?de(Tt(s,u),t.shape):s},b:()=>{let s=$e(n,ot(t,"float32")),u=ur(r.shape,a);return u.length>0?de(Tt(s,u),r.shape):s}}}};var FXe={kernelName:wV,gradFunc:n=>({x:()=>Nr(n)})};var RXe={kernelName:kV,inputsToSave:["indices"],gradFunc:(n,e)=>{let t=e[0];return{indices:()=>Ph(t.shape,"float32")}}};var OXe={kernelName:xV,gradFunc:n=>({x:()=>kn(n)})};function PXe(n,e=0){let t=ee(n,"x","unstack","string_or_numeric");ie(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let r={value:t},a={axis:e};return ae.runKernel(eG,r,a)}var DG=ue({unstack_:PXe});var MXe={kernelName:SV,saveAllInputs:!0,gradFunc:(n,e,t)=>{let{axis:r}=t;return DG(n,r).map(i=>()=>i)}};var hW={kernelName:NV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let r=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>$i(n,i,r.shape)}}};function BXe(n){let t={x:ee(n,"x","log","float32")};return ae.runKernel(uV,t)}var Rm=ue({log_:BXe});function LXe(n,e){let t=ee(n,"base","pow"),r=ee(e,"exp","pow");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(TV,a)}var Om=ue({pow_:LXe});var zXe={kernelName:TV,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{let[t,r,a]=e,i=t,o=r,s=Rn(i.shape,o.shape);return{a:()=>{let l=ot(o,"float32"),f=$e(n,$e(l,Om(i,fr(l,Jn(1))))),h=ur(i.shape,s);return h.length>0&&(f=Tt(f,h)),de(f,i.shape)},b:()=>{let l=ol(i,0),f=ho(l,Rm(i),kn(i)),h=$e(n,$e(a,f)),d=ur(o.shape,s);return d.length>0&&(h=Tt(h,d)),de(h,o.shape)}}}};var $Xe={kernelName:EV,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{let[t,r]=e,a=ol(t,0);return{x:()=>ho(a,n,$e(n,r)),alpha:()=>{let i=ho(a,kn(n),$e(n,t)),o=ur(r.shape,n.shape);return o.length>0&&(i=Tt(i,o)),de(i,r.shape)}}}};function qXe(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ka=xn();ka.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ka.registerFlag("IS_BROWSER",()=>qXe());ka.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ka.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ka.registerFlag("PROD",()=>!1);ka.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ka.getBool("DEBUG"));ka.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ka.registerFlag("IS_TEST",()=>!1);ka.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);ka.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ka.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ka.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);var _k=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function dW(n){return _k?Buffer.byteLength(n):new Blob([n]).size}function WXe(n){if(_k)return Buffer.from(n).toString("base64");let e=new Uint8Array(n),t="";for(let r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function VXe(n){if(_k){let r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function GXe(n){if(n.length===1)return n[0];let e=0;n.forEach(a=>{e+=a.byteLength});let t=new Uint8Array(e),r=0;return n.forEach(a=>{t.set(new Uint8Array(a),r),r+=a.byteLength}),t.buffer}function FG(n,e){let t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function UXe(n,e,t){let r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}async function HXe(n,e){let t,r;return n.weightsManifest!=null&&([t,r]=await e(n.weightsManifest)),UXe(n,t,r)}function Pm(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:dW(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:dW(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function KXe(n){let e=[];for(let t of n)e.push(...t.weights);return e}var Gn=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Gn.instance==null&&(Gn.instance=new Gn),Gn.instance}static registerSaveRouter(e){Gn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Gn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Gn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Gn.getHandlers(e,"load",t)}static getHandlers(e,t,r){let a=[];return(t==="load"?Gn.getInstance().loadRouters:Gn.getInstance().saveRouters).forEach(o=>{let s=o(e,r);s!==null&&a.push(s)}),a}};var jXe="tensorflowjs",XXe=1,Ah="models_store",bm="model_info_store";function YXe(){if(!xn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ZXe(n){let e=n.result;e.createObjectStore(Ah,{keyPath:"modelPath"}),e.createObjectStore(bm,{keyPath:"modelPath"})}var rl=class{constructor(e){if(this.indexedDB=YXe(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,a)=>{let i=this.indexedDB.open(jXe,XXe);i.onupgradeneeded=()=>ZXe(i),i.onsuccess=()=>{let o=i.result;if(t==null){let s=o.transaction(Ah,"readonly"),c=s.objectStore(Ah).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(c.result.modelArtifacts)},c.onerror=l=>(o.close(),a(c.error)),s.oncomplete=()=>o.close()}else{let s=Pm(t),u=o.transaction(bm,"readwrite"),c=u.objectStore(bm),l=c.put({modelPath:this.modelPath,modelArtifactsInfo:s}),f;l.onsuccess=()=>{f=o.transaction(Ah,"readwrite");let d=f.objectStore(Ah).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s});d.onsuccess=()=>r({modelArtifactsInfo:s}),d.onerror=p=>{c=u.objectStore(bm);let v=c.delete(this.modelPath);v.onsuccess=()=>(o.close(),a(d.error)),v.onerror=m=>(o.close(),a(d.error))}},l.onerror=h=>(o.close(),a(l.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>a(i.error)})}};rl.URL_SCHEME="indexeddb://";var RG=n=>xn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(rl.URL_SCHEME)?JXe(n.slice(rl.URL_SCHEME.length)):null;Gn.registerSaveRouter(RG);Gn.registerLoadRouter(RG);function JXe(n){return new rl(n)}var Th="/",Eh="tensorflowjs_models",QXe="info",e9e="model_topology",t9e="weight_specs",n9e="weight_data",r9e="model_metadata";function a9e(n){return{info:[Eh,n,QXe].join(Th),topology:[Eh,n,e9e].join(Th),weightSpecs:[Eh,n,t9e].join(Th),weightData:[Eh,n,n9e].join(Th),modelMetadata:[Eh,n,r9e].join(Th)}}function i9e(n){for(let e of Object.values(n))window.localStorage.removeItem(e)}var al=class{constructor(e){if(!xn().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=a9e(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=Pm(e);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,WXe(e.weightData));let i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}}catch{throw i9e(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=a;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let s=JSON.parse(i);t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,s.signature!=null&&(t.signature=s.signature),s.userDefinedMetadata!=null&&(t.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(t.modelInitializer=s.modelInitializer),s.initializerSignature!=null&&(t.initializerSignature=s.initializerSignature),s.trainingConfig!=null&&(t.trainingConfig=s.trainingConfig)}let o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=VXe(o),t}};al.URL_SCHEME="localstorage://";var OG=n=>xn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(al.URL_SCHEME)?o9e(n.slice(al.URL_SCHEME.length)):null;Gn.registerSaveRouter(OG);Gn.registerLoadRouter(OG);function o9e(n){return new al(n)}var s9e="model",u9e=".json",c9e=".weights.bin";function pW(n){return new Promise(e=>setTimeout(e)).then(n)}var po=class{constructor(e){if(!xn().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(po.URL_SCHEME)&&(e=e.slice(po.URL_SCHEME.length)),(e==null||e.length===0)&&(e=s9e),this.modelJsonFileName=e+u9e,this.weightDataFileName=e+c9e}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=FG(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(o.download=this.modelJsonFileName,o.href=i,await pW(()=>o.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;s.download=this.weightDataFileName,s.href=t,await pW(()=>s.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Pm(e)}}}};po.URL_SCHEME="downloads://";var l9e=n=>xn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(po.URL_SCHEME)?f9e(n.slice(po.URL_SCHEME.length)):null;Gn.registerSaveRouter(l9e);function f9e(n="model"){return new po(n)}function vW(n,e,t,r){o(n),t=t??0,r=r??1,s(t,r);let a=0,i=u=>(u.then(c=>{let l=t+ ++a/n.length*(r-t);return e(l),c}),u);function o(u){ie(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function s(u,c){ie(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),ie(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),ie(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(n.map(i))}async function h9e(n,e){e==null&&(e={});let t=e.fetchFunc==null?xn().platform.fetch:e.fetchFunc,r=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=0,i=.5,s=(e.onProgress==null?await Promise.all(r):await vW(r,e.onProgress,a,i)).map(f=>f.arrayBuffer()),u=.5,c=1;return e.onProgress==null?await Promise.all(s):await vW(s,e.onProgress,u,c)}var d9e="application/octet-stream",p9e="application/json",Mh=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(ie(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=xn().platform.fetch,ie(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&ie(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=FG(e,r);t.body.append("model.json",new Blob([JSON.stringify(a)],{type:p9e}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:d9e}),"model.weights.bin");let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:Pm(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}let r=t.modelTopology,a=t.weightsManifest;if(r==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return HXe(t,i=>this.loadWeights(i))}async loadWeights(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[r,a]=v9e(t),i=this.weightPathPrefix||r,o=KXe(e),s=[],u=[];for(let l of e)for(let f of l.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):s.push(i+f+a);this.weightUrlConverter&&s.push(...await Promise.all(u));let c=await h9e(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,GXe(c)]}};Mh.URL_SCHEME_REGEX=/^https?:\/\//;function v9e(n){let e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),a=t>e?n.substring(t):"";return[r+"/",a]}function mW(n){return n.match(Mh.URL_SCHEME_REGEX)!=null}var PG=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(r=>mW(r)):t=mW(n),t)return m9e(n,e)}return null};Gn.registerSaveRouter(PG);Gn.registerLoadRouter(PG);function m9e(n,e){return new Mh(n,e)}function g9e(n,e,t=1,r=0,a="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let o={indices:ee(n,"indices","oneHot","int32")},s={dtype:a,depth:e,onValue:t,offValue:r};return ae.runKernel(kV,o,s)}var y9e=ue({oneHot_:g9e});function b9e(n,e,t){let r,a=n.shape.length;typeof e=="number"?r=[e,...new Array(a-1).fill(0)]:e.length<a?r=e.concat(new Array(a-e.length).fill(0)):r=e.slice(),r.forEach(o=>{ie(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=[t,...new Array(a-1).fill(-1)]:t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map((o,s)=>o>=0?o:(ie(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${s}.`),n.shape[s]-r[s])),[r,i]}var lk=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}};function w9e(n){let e=ee(n,"x","abs");if(e.dtype==="complex64"){let t={x:e};return ae.runKernel(LW,t)}else{let t={x:e};return ae.runKernel(SW,t)}}var lo=ue({abs_:w9e});function x9e(n){let t={x:ee(n,"x","acos")};return ae.runKernel(NW,t)}var k9e=ue({acos_:x9e});function S9e(n){let t={x:ee(n,"x","acosh")};return ae.runKernel(TW,t)}var N9e=ue({acosh_:S9e});function T9e(n,e=null,t=!1){let a={x:ee(n,"x","all","bool")},i={axis:e,keepDims:t};return ae.runKernel(GKe,a,i)}var E9e=ue({all_:T9e});function I9e(n,e=null,t=!1){let a={x:ee(n,"x","any","bool")},i={axis:e,keepDims:t};return ae.runKernel(UKe,a,i)}var C9e=ue({any_:I9e});function A9e(n,e=0){let r={x:ee(n,"x","argMax")},a={axis:e};return ae.runKernel(EW,r,a)}var _9e=ue({argMax_:A9e});function D9e(n,e=0){let r={x:ee(n,"x","argMin")},a={axis:e};return ae.runKernel(IW,r,a)}var F9e=ue({argMin_:D9e});function R9e(n){let t={x:ee(n,"x","asin")};return ae.runKernel(CW,t)}var O9e=ue({asin_:R9e});function P9e(n){let t={x:ee(n,"x","asinh")};return ae.runKernel(AW,t)}var M9e=ue({asinh_:P9e});function B9e(n){let t={x:ee(n,"x","atan")};return ae.runKernel(_W,t)}var L9e=ue({atan_:B9e});function z9e(n,e){let t=ee(n,"a","atan2"),r=ee(e,"b","atan2");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(FW,a)}var $9e=ue({atan2_:z9e});function q9e(n){let t={x:ee(n,"x","atanh")};return ae.runKernel(DW,t)}var W9e=ue({atanh_:q9e});function V9e(n,e,t,r,a){let i=ee(n,"x","avgPool","float32"),o=1;ie(il(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let s=i,u=!1;i.rank===3&&(u=!0,s=de(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),Ni("avgPool",r,a);let c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=ae.runKernel(RW,c,l);return f=ot(f,i.dtype),u?de(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var MG=ue({avgPool_:V9e});function G9e(n,e=0){ie(n.length>=1,()=>"Pass at least one tensor to concat");let t=vG(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return yG(t[0]);let r=t,a={axis:e};return ae.runKernel(zW,r,a)}var Bh=ue({concat_:G9e});function U9e(n){let t={x:ee(n,"x","sigmoid","float32")};return ae.runKernel(VV,t)}var Dk=ue({sigmoid_:U9e});function H9e(n){let t={x:ee(n,"x","tanh","float32")};return ae.runKernel(QV,t)}var K9e=ue({tanh_:H9e});function j9e(n,e,t){let r=ee(n,"x","batchToSpaceND"),a=e.reduce((s,u)=>s*u);ie(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),ie(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),ie(r.shape[0]%a===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${a}`);let i={x:r},o={blockShape:e,crops:t};return ae.runKernel(PW,i,o)}var Fk=ue({batchToSpaceND_:j9e});function X9e(n){let e;return n.rank===0||n.rank===1?e=de(n,[1,1,1,n.size]):n.rank===2?e=de(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=de(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function Y9e(n,e,t,r,a,i){i==null&&(i=.001);let o=ee(n,"x","batchNorm"),s=ee(e,"mean","batchNorm"),u=ee(t,"variance","batchNorm"),c;a!=null&&(c=ee(a,"scale","batchNorm"));let l;r!=null&&(l=ee(r,"offset","batchNorm")),ie(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ie(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ie(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:X9e(o),scale:c,offset:l,mean:s,variance:u},d={varianceEpsilon:i},p=ae.runKernel(tV,h,d);return de(p,o.shape)}var Z9e=ue({batchNorm_:Y9e});function J9e(n){let t={x:ee(n,"x","ceil","float32")};return ae.runKernel(MW,t)}var Q9e=ue({ceil_:J9e});function eYe(n,e,t){Lh(n);let r={shape:n,value:e,dtype:t};return ae.runKernel(lje,{},r)}function tYe(n,e,t){let r=ee(n,"x","clipByValue");if(ie(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return eYe(r.shape,e,r.dtype);let a={x:r},i={clipValueMin:e,clipValueMax:t};return ae.runKernel(BW,a,i)}var nYe=ue({clipByValue_:tYe});function rYe(n,e,t,r,a="NWC",i=1,o){let s=ee(n,"x","conv1d"),u=ee(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=de(s,[1,s.shape[0],s.shape[1]])),ie(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),ie(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Ni("conv1d",r,o),ie(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),ie(il(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),ie(Sm(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),ie(Sm(t),()=>"Error in conv1D: Stride should be larger than 0."),ie(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let f=de(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=de(c,[c.shape[0],1,c.shape[1],c.shape[2]]),m=Dm(h,f,[1,t],r,"NHWC",[1,i],o);return l?de(m,[m.shape[2],m.shape[3]]):de(m,[m.shape[0],m.shape[2],m.shape[3]])}var aYe=ue({conv1d_:rYe});function iYe(n,e,t,r,a,i){let o=ee(n,"x","conv2dTranspose"),s=ee(e,"filter","conv2dTranspose");return wG(t,o,s,r,a,"NHWC",i)}var oYe=ue({conv2dTranspose_:iYe});function sYe(n){let t={x:ee(n,"x","cos","float32")};return ae.runKernel(WW,t)}var Rk=ue({cos_:sYe});function uYe(n){let t={x:ee(n,"x","cosh","float32")};return ae.runKernel(VW,t)}var BG=ue({cosh_:uYe});function cYe(n,e=0,t=!1,r=!1){let i={x:ee(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:r};return ae.runKernel(tje,i,o)}var fk=ue({cumprod_:cYe});function lYe(n,e,t="NHWC"){let r=ee(n,"x","depthToSpace","float32"),a=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];ie(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),ie(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e}  for depthToSpace with input shape
    ${r.shape}`),ie(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${r.shape}`),ie(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`);let s={x:r},u={blockSize:e,dataFormat:t};return ae.runKernel(nje,s,u)}var fYe=ue({depthToSpace_:lYe});function hYe(n,e,t,r,a="NHWC",i=[1,1],o){let s=ee(n,"x","depthwiseConv2d","float32"),u=ee(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=de(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Ni("depthwiseConv2d",r,o);let h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=ae.runKernel(UW,h,d);return l?de(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var LG=ue({depthwiseConv2d_:hYe});function dYe(n,e,t,r,a=[1,1],i="NHWC"){let o=ee(n,"x","dilation2d"),s=ee(e,"filter","dilation2d");ie(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),ie(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),ie(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,c=!1;o.rank===3&&(u=de(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),ie(u.shape[3]===s.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${s.shape[2]}`);let l={x:u,filter:s},f={strides:t,pad:r,dilations:a},h=ae.runKernel(HW,l,f);return c?de(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var pYe=ue({dilation2d_:dYe});function vYe(n,e){let t=ee(n,"a","div"),r=ee(e,"b","div");[t,r]=Qn(t,r);let a=Fn(t,r),i=kn(a),o=Ak(r,i);return ho(o,i,a)}var mYe=ue({divNoNan_:vYe});function gYe(n,e){let t=ee(n,"t1","dot"),r=ee(e,"t2","dot");ie((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);let a=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(ie(a===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`),t.rank===1&&r.rank===1){let o=de(t,[1,-1]),s=de(r,[-1,1]),u=xa(o,s);return de(u,[])}else if(t.rank===1&&r.rank===2){let o=de(t,[1,-1]),s=de(r,[r.shape[0],r.shape[1]]),u=xa(o,s);return de(u,[u.size])}else if(t.rank===2&&r.rank===1){let o=de(r,[-1,1]),s=xa(t,o);return de(s,[s.size])}else{let o=de(r,[r.shape[0],r.shape[1]]);return xa(t,o)}}var yYe=ue({dot_:gYe});function bYe(n){let t={x:ee(n,"x","elu","float32")};return ae.runKernel(jW,t)}var wYe=ue({elu_:bYe});function xYe(n){let e=ee(n,"x","erf");ie(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ot(e,"float32"));let t={x:e};return ae.runKernel(XW,t)}var kYe=ue({erf_:xYe});function SYe(n,e=null,t=!1){let a={x:ee(n,"x","max")},i={reductionIndices:e,keepDims:t};return ae.runKernel(fV,a,i)}var el=ue({max_:SYe});function NYe(n,e=null,t=!1){let a={x:ee(n,"x","min")},i={axis:e,keepDims:t};return ae.runKernel(vV,a,i)}var hk=ue({min_:NYe});function TYe(n,e="euclidean",t=null,r=!1){n=ee(n,"x","norm");let a=zG(n,e,t),i=a.shape;if(r){let o=qi(t,n.shape);i=Tm(a.shape,o)}return de(a,i)}function zG(n,e,t=null){if(n.rank===0)return lo(n);if(n.rank!==1&&t===null)return zG(de(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Tt(lo(n),t);if(e===1/0)return el(lo(n),t);if(e===-1/0)return hk(lo(n),t);if(e==="euclidean"||e===2)return as(Tt(Om(lo(n),Jn(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return el(Tt(lo(n),t[0]),t[1]-1);if(e===1/0)return el(Tt(lo(n),t[1]),t[0]);if(e===-1/0)return hk(Tt(lo(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return as(Tt(sr(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var $G=ue({norm_:TYe});function EYe(n,e=null,t=!1){return $G(n,"euclidean",e,t)}var IYe=ue({euclideanNorm_:EYe});function CYe(n,e=0){let t=ee(n,"x","expandDims","string_or_numeric");ie(e<=t.rank,()=>"Axis must be <= rank of the tensor");let r={input:t},a={dim:e};return ae.runKernel(ZW,r,a)}var qG=ue({expandDims_:CYe});function AYe(n){let t={x:ee(n,"x","expm1")};return ae.runKernel(JW,t)}var _Ye=ue({expm1_:AYe});function DYe(n,e,t=0,r=0){let a=ee(n,"x","gather"),i=ee(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return ae.runKernel(nV,o,s)}var WG=ue({gather_:DYe});function FYe(n){let t={x:ee(n,"x","isFinite")};return ae.runKernel(aV,t)}var RYe=ue({isFinite_:FYe});function OYe(n){let t={x:ee(n,"x","isInf")};return ae.runKernel(iV,t)}var PYe=ue({isInf_:OYe});function MYe(n){let t={x:ee(n,"x","isNaN")};return ae.runKernel(oV,t)}var BYe=ue({isNaN_:MYe});function LYe(n,e=.2){let r={x:ee(n,"x","leakyRelu")},a={alpha:e};return ae.runKernel(sV,r,a)}var zYe=ue({leakyRelu_:LYe});function $Ye(n,e=5,t=1,r=1,a=.5){let i=ee(n,"x","localResponseNormalization");ie(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),ie(_h(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,s=!1;i.rank===3&&(s=!0,o=de(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let u={x:o},c={depthRadius:e,bias:t,alpha:r,beta:a},l=ae.runKernel(lV,u,c);return s?de(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var qYe=ue({localResponseNormalization_:$Ye});function WYe(n){let t={x:ee(n,"x","log1p")};return ae.runKernel(cV,t)}var VYe=ue({log1p_:WYe});function GYe(n,e){ie(ek(n),()=>"The f passed in variableGrads(f) must be a function"),ie(e==null||Array.isArray(e)&&e.every(c=>c instanceof tl),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let c in ae.registeredVariables)e.push(ae.registeredVariables[c])}let r=t?e.filter(c=>!c.trainable):null,a=e.length;e=e.filter(c=>c.trainable),ie(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let i=!0,{value:o,grads:s}=ae.gradients(n,e,null,i);ie(s.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ie(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let u={};return e.forEach((c,l)=>{s[l]!=null&&(u[c.name]=s[l])}),r?.forEach(c=>u[c.name]=null),{value:o,grads:u}}function VG(n){return ae.customGrad(n)}function UYe(n){let t={x:ee(n,"x","softplus")};return ae.runKernel(GV,t)}var GG=ue({softplus_:UYe});function HYe(n){let e=ee(n,"x","logSigmoid");return VG(r=>({value:Nr(GG(Nr(r))),gradFunc:o=>$e(o,Dk(Nr(r)))}))(e)}var KYe=ue({logSigmoid_:HYe});function jYe(n,e=-1){let t=ee(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return VG((a,i)=>{let s=el(a,e,!0),u=fr(a,s),c=fr(ot(u,"float32"),Rm(Tt(is(u),e,!0)));return i([c]),{value:c,gradFunc:(f,h)=>{let[d]=h,p=!0,v=is(d);return fr(f,$e(Tt(f,e,p),v))}}})(t)}var XYe=ue({logSoftmax_:jYe});function YYe(n,e=null,t=!1){let r=ee(n,"x","logSumExp"),a=qi(e,r.shape),i=el(r,a,!0),o=fr(r,i),s=is(o),u=Tt(s,a),c=Rm(u),l=Ya(de(i,c.shape),c);if(t){let f=Tm(l.shape,a);return de(l,f)}return l}var ZYe=ue({logSumExp_:YYe});function JYe(n){let t={x:ee(n,"x","logicalNot","bool")};return ae.runKernel(gje,t)}var Ok=ue({logicalNot_:JYe});function QYe(n,e){let t=ee(n,"a","logicalOr","bool"),r=ee(e,"b","logicalOr","bool");Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(yje,a)}var UG=ue({logicalOr_:QYe});function eZe(n,e){let t=ee(n,"a","logicalXor","bool"),r=ee(e,"b","logicalXor","bool");return Rn(t.shape,r.shape),Oh(UG(n,e),Ok(Oh(n,e)))}var tZe=ue({logicalXor_:eZe});function nZe(n,e,t,r,a){let i=ee(n,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=de(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),ie(il(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Ni("maxPool",r,a);let c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=ae.runKernel(dV,c,l);return u?de(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var HG=ue({maxPool_:nZe});function rZe(n,e){let t=ee(n,"a","maximum"),r=ee(e,"b","maximum");[t,r]=Qn(t,r),t.dtype==="bool"&&(t=ot(t,"int32"),r=ot(r,"int32")),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(hV,a)}var KG=ue({maximum_:rZe});function aZe(n,e=null,t=!1){let a={x:ee(n,"x","mean")},i={axis:e,keepDims:t};return ae.runKernel(pV,a,i)}var iZe=ue({mean_:aZe});function oZe(n,e){let t=ee(n,"a","minimum"),r=ee(e,"b","minimum");[t,r]=Qn(t,r),t.dtype==="bool"&&(t=ot(t,"int32"),r=ot(r,"int32")),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(mV,a)}var sZe=ue({minimum_:oZe});function uZe(n,e,t){ie(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let r=ee(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ie(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);let a=t==="reflect"?1:0;for(let s=0;s<r.rank;s++)ie(e[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ie(e[s][0]>=0&&e[s][0]<=r.shape[s]-a&&e[s][1]>=0&&e[s][1]<=r.shape[s]-a,()=>`Padding in dimension ${s} cannot be greater than or equal to ${r.shape[s]-a} or less than 0 for input of shape ${r.shape}`);let i={paddings:e,mode:t},o={x:r};return ae.runKernel(gV,o,i)}var cZe=ue({mirrorPad_:uZe});function lZe(n,e){let t=ee(n,"a","mod"),r=ee(e,"b","mod");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(yV,a)}var fZe=ue({mod_:lZe});function hZe(n,e){let t=ee(n,"a","notEqual","string_or_numeric"),r=ee(e,"b","notEqual","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(Nje,a)}var dZe=ue({notEqual_:hZe});function pZe(n){let t={x:ee(n,"x","onesLike")};return ae.runKernel(xV,t)}var vZe=ue({onesLike_:pZe});function mZe(n,e,t=0){let r=ee(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:e,constantValue:t},i={x:r};return ae.runKernel(NV,i,a)}var jG=ue({pad_:mZe});function gZe(n,e,t,r,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),r===0&&(r="valid");let s=ee(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=de(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(il(i,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`);let l=L8e(u.shape,e,i,a,r),f=[l.dilationHeight,l.dilationWidth],h;r==="same"?h=bZe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];let d=f[0]===1&&f[1]===1,[p,v]=yZe([l.inHeight,l.inWidth],f,h),m=d?r:"valid",g=d?u:Ek(u,f,p),b=(t==="avg"?()=>MG(g,e,i,m,o):()=>HG(g,e,i,m,o))(),w=d?b:Fk(b,f,v);return c?de(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function yZe(n,e,t){let r=t.map(l=>l[0]),a=t.map(l=>l[1]),i=n.concat(r,a),o=e.map((l,f)=>(l-i[f]%l)%l),s=a.map((l,f)=>l+o[f]),u=e.map((l,f)=>[r[f],s[f]]),c=e.map((l,f)=>[0,o[f]]);return[u,c]}function bZe(n,e){let r=n.map((o,s)=>o+(o-1)*(e[s]-1)).map(o=>o-1),a=r.map(o=>Math.floor(o/2)),i=r.map((o,s)=>o-a[s]);return r.map((o,s)=>[a[s],i[s]])}var wZe=ue({pool_:gZe});function xZe(n,e){let t=ee(n,"x","prelu"),r=ee(e,"alpha","prelu"),a={x:t,alpha:r};return ae.runKernel(EV,a)}var kZe=ue({prelu_:xZe});function SZe(n,e=null,t=!1){let r=ee(n,"x","prod");r.dtype==="bool"&&(r=ot(r,"int32"));let a={x:r},i={axis:e,keepDims:t};return ae.runKernel(IV,a,i)}var NZe=ue({prod_:SZe});var bu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wu(n,e){return e={exports:{}},n(e,e.exports),e.exports}var TZe=wu(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(bu,n,!1)}),EZe=wu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(bu,n,!1)}),IZe=wu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(bu,n,!1)}),CZe=wu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d,p;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d,p=[];if(f===(f|0))d=p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?d=p[7]=-1:d=p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(bu,n,!1)}),AZe=wu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(bu,n,!1)}),_Ze=wu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(bu,n,!1)}),xu=wu(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=Od()}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:bu,[],Math)});xu.alea=TZe;xu.xor128=EZe;xu.xorwow=IZe;xu.xorshift7=CZe;xu.xor4096=AZe;xu.tychei=_Ze;var DZe=xu,oot=DZe.alea;function FZe(n){let t={x:ee(n,"x","reciprocal")};return ae.runKernel(CV,t)}var RZe=ue({reciprocal_:FZe});function OZe(n){let t={x:ee(n,"x","relu")};return ae.runKernel(AV,t)}var PZe=ue({relu_:OZe});function MZe(n){let t={x:ee(n,"x","relu6")};return ae.runKernel(RV,t)}var BZe=ue({relu6_:MZe});function LZe(n,e){let r={x:ee(n,"x","reverse")},a={dims:e};return ae.runKernel(OV,r,a)}var Im=ue({reverse_:LZe});function zZe(n){let t={x:ee(n,"x","round")};return ae.runKernel(PV,t)}var $Ze=ue({round_:zZe});function qZe(n){let t={x:ee(n,"x","selu")};return ae.runKernel(LV,t)}var WZe=ue({selu_:qZe});function VZe(n,e,t,r,a,i=[1,1],o="NHWC"){let s=ee(n,"x","separableConv2d"),u=ee(e,"depthwiseFilter","separableConv2d"),c=ee(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=de(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ie(l.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`),ie(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),ie(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let h=u.shape[2],d=u.shape[3];ie(c.shape[2]===h*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*d}, but got ${c.shape[2]}.`);let p=LG(l,u,r,a,o,i),m=Dm(p,c,1,"valid",o);return f?de(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var GZe=ue({separableConv2d_:VZe});function UZe(n){let t={x:ee(n,"x","sign")};return ae.runKernel(WV,t)}var HZe=ue({sign_:UZe});function KZe(n,e=-1){let t=ee(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let r={logits:t},a={dim:e};return ae.runKernel(XV,r,a)}var jZe=ue({softmax_:KZe});function XZe(n){ie(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);let e={input:n};return ae.runKernel(cje,e)}var XG=ue({fft_:XZe});function YZe(n){ie(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);let e={input:n};return ae.runKernel(hje,e)}var dk=ue({ifft_:YZe});function ZZe(n){let e=n.shape[n.shape.length-1],t=n.size/e,r;if(e<=2){let a=de(n,[t,e]);r=dk(a)}else{let a=[t,2*(e-1)],i=de(Em(n),[t,e]),o=de(Ck(n),[t,e]),s=Im($i(i,[0,1],[t,e-2]),1),u=$e(Im($i(o,[0,1],[t,e-2]),1),Jn(-1)),c=Bh([i,s],1),l=Bh([o,u],1),f=de(nl(c,l),[a[0],a[1]]);r=dk(f)}if(r=Em(r),n.rank===3&&n.shape[0]!==0){let a=r,i=n.shape[0];r=de(r,[i,r.shape[0]/i,r.shape[1]]),a.dispose()}return r}var JZe=ue({irfft_:ZZe});function QZe(n,e){ie(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1],r=n.size/t,a;if(e!=null&&e<t){let p=n.shape.map(m=>0),v=n.shape.map(m=>m);v[n.shape.length-1]=e,a=$i(n,p,v),t=e}else if(e!=null&&e>t){let p=n.shape.map(v=>v);p[n.shape.length-1]=e-t,a=Bh([n,Ph(p)],n.shape.length-1),t=e}else a=n;let i=kn(a),o=de(nl(a,i),[r,t]),s=XG(o),u=Math.floor(t/2)+1,c=Em(s),l=Ck(s),f=Nm(c,[u,t-u],c.shape.length-1),h=Nm(l,[u,t-u],l.shape.length-1),d=a.shape.slice();return d[a.shape.length-1]=u,de(nl(f[0],h[0]),d)}var eJe=ue({rfft_:QZe});function tJe(n,e){let t=ee(n,"a","squaredDifference"),r=ee(e,"b","squaredDifference");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r},i={};return ae.runKernel(YV,a,i)}var nJe=ue({squaredDifference_:tJe});function rJe(n,e){let t=ee(n,"x","squeeze","string_or_numeric");return de(t,Pje(t.shape,e).newShape)}var aJe=ue({squeeze_:rJe});function iJe(n,e=0){let t=vG(n,"tensors","stack","string_or_numeric");ie(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&ie(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let r=t,a={axis:e};return ae.runKernel(SV,r,a)}var YG=ue({stack_:iJe});function oJe(n,e,t,r,a=0,i=0,o=0,s=0,u=0){let l={x:ee(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ae.runKernel(Aje,l,f)}var sJe=ue({stridedSlice_:oJe});function uJe(n){let t={x:ee(n,"x","tan","float32")};return ae.runKernel(JV,t)}var cJe=ue({tan_:uJe});function lJe(n,e=1,t=!0){let r=ee(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${e}`);let i={x:r},o={k:e,sorted:t},[s,u]=ae.runKernel(_je,i,o);return{values:s,indices:u}}var fJe=ue({topk_:lJe});function hJe(n,e=0){let t=ee(n,"x","unique","string_or_numeric");ie(t.rank>0,()=>"The input tensor must be at least 1D");let r={x:t},a={axis:e},[i,o]=ae.runKernel(Dje,r,a);return{values:i,indices:o}}var dJe=ue({unique_:hJe});function pJe(n,e,t=!1,r=!1){let a=ee(n,"images","resizeBilinear");ie(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),ie(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=de(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=ae.runKernel(FV,s,u);return o?de(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var vJe=ue({resizeBilinear_:pJe});function mJe(n,e,t=!1,r=!1){let a=ee(n,"images","resizeNearestNeighbor");ie(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),ie(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ie(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=de(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=ae.runKernel(DV,s,u);return o?de(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var gJe=ue({resizeNearestNeighbor_:mJe});var gW;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(gW||(gW={}));var pk=class extends lk{minimize(e,t=!1,r){let{value:a,grads:i}=this.computeGradients(e,r);if(r!=null){let o=r.map(s=>({name:s.name,tensor:i[s.name]}));this.applyGradients(o)}else this.applyGradients(i);return uW(i),t?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return GYe(e,t)}dispose(){this.iterations_!=null&&uW(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Jn(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(pk,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});var sot=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n())();var yW;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(yW||(yW={}));var yJe=1.7580993408473768,bJe=1.0507009873554805;function wJe(n,e,t){let r=n.shape.slice();r[t]=1;let a=de(e,r),i=fk(n,t,!0,!1),o=fk(n,t,!0,!0),s=$e(i,o);return $e(a,s)}function xJe(n,e,t){let r=n.shape.length,a=r-t.length,i=SG(t,r),o=n;i!=null&&(o=yu(n,i));let s=o.shape.slice(),c=s.splice(r-t.length,t.length).reduce((h,d)=>h*d,1);s.push(c);let l=o.reshape(s),f=wJe(l,e,a);if(f=f.reshape(o.shape),i!=null){let h=Ik(i);f=yu(f,h)}return f}var kJe={kernelName:IV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{axis:a}=t,i=[];return a==null?i=r.shape.map((o,s)=>s):typeof a=="number"?i=[a]:i=a,{x:()=>xJe(r,n,i)}}};var SJe={kernelName:KW,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=Fn(n,ot(r,"float32")),u=ur(t.shape,a);return u.length>0?de(Tt(s,u),t.shape):s},b:()=>{let s=$e(n,ot(t,"float32")),u=ur(r.shape,a);u.length>0&&(s=de(Tt(s,u),r.shape));let c=sr(r);return Nr(Fn(s,ot(c,"float32")))}}}};var NJe={kernelName:CV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,Nr(sr(t)))}}};var TJe={kernelName:RV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e,r=$e(_m(t,6),Cm(t));return{x:()=>$e(n,ot(r,"float32"))}}};var EJe={kernelName:AV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,ot(Cm(t),"float32"))}}};var IJe={kernelName:_V,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>de(n,t.shape)}}};var CJe={kernelName:FV,inputsToSave:["images"],gradFunc:(n,e,t)=>{let[r]=e,a={dy:n,images:r};return{images:()=>ae.runKernel(Ije,a,t)}}};var AJe={kernelName:DV,inputsToSave:["images"],gradFunc:(n,e,t)=>{let[r]=e,a={dy:n,images:r};return{images:()=>ae.runKernel(Eje,a,t)}}};var _Je={kernelName:OV,gradFunc:(n,e,t)=>{let{dims:r}=t,a=qi(r,n.shape);return{x:()=>Im(n,a)}}};var DJe={kernelName:PV,gradFunc:n=>({x:()=>kn(n)})};var FJe={kernelName:MV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Nr(Fn(n,$e(Om(t,1.5),2)))}}};var RJe={kernelName:BV,inputsToSave:["condition"],gradFunc:(n,e)=>{let[t]=e;return{condition:()=>ot(kn(t),"float32"),t:()=>$e(n,ot(t,n.dtype)),e:()=>$e(n,ot(Ok(t),n.dtype))}}};var OJe={kernelName:LV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=ol(t,Jn(0)),a=Jn(yJe),i=Jn(bJe),o=$e(n,i),s=$e($e(n,a),is(ot(t,"float32")));return ho(r,o,s)}}}};var PJe={kernelName:VV,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,$e(t,fr(Jn(1),t)))}}};var MJe={kernelName:WV,gradFunc:n=>({x:()=>kn(n)})};var BJe={kernelName:$V,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(Rk(ot(t,"float32")),n)}}};var LJe={kernelName:qV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(BG(ot(t,"float32")),n)}}};var zJe={kernelName:zV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{begin:a,size:i}=t,o=r.shape,[s,u]=b9e(r,a,i),c=[];for(let l=0;l<n.rank;l++)c.push([s[l],o[l]-s[l]-u[l]]);return{x:()=>jG(n,c)}}};var $Je={kernelName:XV,outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r]=e,{dim:a}=t,i=!0,o=$e(n,r);return{logits:()=>fr(o,$e(Tt(o,[a],i),r))}}};var qJe={kernelName:GV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,Dk(t))}}};var bW={kernelName:KV,gradFunc:(n,e,t)=>{let{blockShape:r,paddings:a}=t;return{x:()=>Fk(n,r,a)}}};var wW={kernelName:jV,gradFunc:(n,e,t)=>{let{axis:r}=t;return{x:()=>Bh(n,r)}}};var WJe={kernelName:UV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,$e(as(ot(t,"float32")),2))}}};var VJe={kernelName:Cje,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,$e(ot(t,"float32"),2))}}};var GJe={kernelName:YV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Jn(2);return{a:()=>$e(n,$e(a,fr(t,r))),b:()=>$e(n,$e(a,fr(r,t)))}}};var UJe={kernelName:rG,gradFunc:n=>({x:()=>kn(n)})};var HJe={kernelName:ZV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=n,u=ur(t.shape,a);return u.length>0&&(s=Tt(s,u)),de(s,t.shape)},b:()=>{let s=n,u=ur(r.shape,a);return u.length>0&&(s=Tt(s,u)),de(Nr(s),r.shape)}}}};var KJe={kernelName:HV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,a=r.shape.slice(),{axis:i}=t;qi(i,r.shape).forEach(c=>{a[c]=1});let s=de(n,a),u=$e(s,Fm(r.shape,"float32"));return{x:()=>u}}};var jJe={kernelName:JV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,sr(Rk(t)))}}};var XJe={kernelName:QV,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(fr(Jn(1),sr(t)),n)}}};var YJe={kernelName:yk,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{reps:a}=t;return{x:()=>{let o=kn(r);if(r.rank===1)for(let s=0;s<a[0];++s)o=Ya(o,$i(n,[s*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)o=Ya(o,$i(n,[s*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)o=Ya(o,$i(n,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)for(let l=0;l<a[3];++l)o=Ya(o,$i(n,[s*r.shape[0],u*r.shape[1],c*r.shape[2],l*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};var ZJe={kernelName:vm,gradFunc:(n,e,t)=>{let r=t,{perm:a}=r,i=Ik(a);return{x:()=>yu(n,i)}}};var JJe={kernelName:eG,gradFunc:(n,e,t)=>{let r=t,{axis:a}=r;return{value:()=>YG(n,a)}}};var QJe={kernelName:tG,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>eQe(n,t)}}};function eQe(n,e){let t=KG(e,kn(e)),r=WG(n,t),a=Am(e,Jn(0,"int32")),i=r.rank-a.rank;for(let s=0;s<i;++s)a=qG(a,s+1);a=Oh(a,Fm(r.shape,"bool"));let o=kn(r);return ho(a,r,o)}var tQe={kernelName:nG,gradFunc:n=>({x:()=>kn(n)})};var nQe=[mG,S8e,N8e,I8e,C8e,_8e,D8e,F8e,O8e,P8e,M8e,B8e,U8e,j8e,Y8e,J8e,Q8e,e7e,t7e,u7e,c7e,f7e,m7e,p7e,x7e,S7e,T7e,M7e,q7e,W7e,SJe,V7e,U7e,H7e,K7e,j7e,Y7e,X7e,Q7e,tXe,nXe,rXe,aXe,iXe,oXe,uXe,cXe,lXe,fXe,pXe,fW,fW,gXe,wXe,SXe,NXe,TXe,EXe,CXe,_Xe,DXe,FXe,RXe,OXe,MXe,hW,hW,zXe,$Xe,kJe,NJe,TJe,EJe,IJe,CJe,AJe,_Je,DJe,FJe,RJe,OJe,PJe,MJe,BJe,LJe,zJe,$Je,qJe,bW,bW,wW,wW,WJe,GJe,VJe,UJe,HJe,KJe,jJe,XJe,YJe,ZJe,JJe,QJe,tQe];for(let n of nQe)Hje(n);ce().prototype.abs=function(){return this.throwIfDisposed(),lo(this)};ce().prototype.acos=function(){return this.throwIfDisposed(),k9e(this)};ce().prototype.acosh=function(){return this.throwIfDisposed(),N9e(this)};ce().prototype.add=function(n){return this.throwIfDisposed(),Ya(this,n)};ce().prototype.all=function(n,e){return this.throwIfDisposed(),E9e(this,n,e)};ce().prototype.any=function(n,e){return this.throwIfDisposed(),C9e(this,n,e)};ce().prototype.argMax=function(n){return this.throwIfDisposed(),_9e(this,n)};ce().prototype.argMin=function(n){return this.throwIfDisposed(),F9e(this,n)};ce().prototype.asScalar=function(){return this.throwIfDisposed(),ie(this.size===1,()=>"The array must have only 1 element."),de(this,[])};ce().prototype.asType=function(n){return this.throwIfDisposed(),ot(this,n)};ce().prototype.as1D=function(){return this.throwIfDisposed(),de(this,[this.size])};ce().prototype.as2D=function(n,e){return this.throwIfDisposed(),de(this,[n,e])};ce().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),de(this,[n,e,t])};ce().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),de(this,[n,e,t,r])};ce().prototype.as5D=function(n,e,t,r,a){return this.throwIfDisposed(),de(this,[n,e,t,r,a])};ce().prototype.asin=function(){return this.throwIfDisposed(),O9e(this)};ce().prototype.asinh=function(){return this.throwIfDisposed(),M9e(this)};ce().prototype.atan=function(){return this.throwIfDisposed(),L9e(this)};ce().prototype.atan2=function(n){return this.throwIfDisposed(),$9e(this,n)};ce().prototype.atanh=function(){return this.throwIfDisposed(),W9e(this)};ce().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),MG(this,n,e,t,r)};ce().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),Fk(this,n,e)};ce().prototype.batchNorm=function(n,e,t,r,a){return this.throwIfDisposed(),Z9e(this,n,e,t,r,a)};ce().prototype.broadcastTo=function(n){return this.throwIfDisposed(),ym(this,n)};ce().prototype.cast=function(n){return this.throwIfDisposed(),ot(this,n)};ce().prototype.ceil=function(){return this.throwIfDisposed(),Q9e(this)};ce().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),nYe(this,n,e)};ce().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Sr&&(n=[n]),Bh([this,...n],e)};ce().prototype.conv1d=function(n,e,t,r,a,i){return this.throwIfDisposed(),aYe(this,n,e,t,r,a,i)};ce().prototype.conv2dTranspose=function(n,e,t,r,a){return this.throwIfDisposed(),oYe(this,n,e,t,r,a)};ce().prototype.conv2d=function(n,e,t,r,a,i){return this.throwIfDisposed(),Dm(this,n,e,t,r,a,i)};ce().prototype.cos=function(){return this.throwIfDisposed(),Rk(this)};ce().prototype.cosh=function(){return this.throwIfDisposed(),BG(this)};ce().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),fk(this,n,e,t)};ce().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),NG(this,n,e,t)};ce().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),fYe(this,n,e)};ce().prototype.depthwiseConv2d=function(n,e,t,r,a,i){return this.throwIfDisposed(),LG(this,n,e,t,r,a,i)};ce().prototype.dilation2d=function(n,e,t,r,a){return this.throwIfDisposed(),pYe(this,n,e,t,r,a)};ce().prototype.divNoNan=function(n){return this.throwIfDisposed(),mYe(this,n)};ce().prototype.div=function(n){return this.throwIfDisposed(),Fn(this,n)};ce().prototype.dot=function(n){return this.throwIfDisposed(),yYe(this,n)};ce().prototype.elu=function(){return this.throwIfDisposed(),wYe(this)};ce().prototype.equal=function(n){return this.throwIfDisposed(),Ak(this,n)};ce().prototype.erf=function(){return this.throwIfDisposed(),kYe(this)};ce().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),IYe(this,n,e)};ce().prototype.exp=function(){return this.throwIfDisposed(),is(this)};ce().prototype.expandDims=function(n){return this.throwIfDisposed(),qG(this,n)};ce().prototype.expm1=function(){return this.throwIfDisposed(),_Ye(this)};ce().prototype.fft=function(){return this.throwIfDisposed(),XG(this)};ce().prototype.flatten=function(){return this.throwIfDisposed(),de(this,[this.size])};ce().prototype.floor=function(){return this.throwIfDisposed(),_G(this)};ce().prototype.floorDiv=function(n){return this.throwIfDisposed(),gG(this,n)};ce().prototype.gather=function(n,e){return this.throwIfDisposed(),WG(this,n,e)};ce().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Am(this,n)};ce().prototype.greater=function(n){return this.throwIfDisposed(),ol(this,n)};ce().prototype.ifft=function(){return this.throwIfDisposed(),dk(this)};ce().prototype.irfft=function(){return this.throwIfDisposed(),JZe(this)};ce().prototype.isFinite=function(){return this.throwIfDisposed(),RYe(this)};ce().prototype.isInf=function(){return this.throwIfDisposed(),PYe(this)};ce().prototype.isNaN=function(){return this.throwIfDisposed(),BYe(this)};ce().prototype.leakyRelu=function(n){return this.throwIfDisposed(),zYe(this,n)};ce().prototype.lessEqual=function(n){return this.throwIfDisposed(),_m(this,n)};ce().prototype.less=function(n){return this.throwIfDisposed(),AG(this,n)};ce().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),qYe(this,n,e,t,r)};ce().prototype.logSigmoid=function(){return this.throwIfDisposed(),KYe(this)};ce().prototype.logSoftmax=function(n){return this.throwIfDisposed(),XYe(this,n)};ce().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),ZYe(this,n,e)};ce().prototype.log=function(){return this.throwIfDisposed(),Rm(this)};ce().prototype.log1p=function(){return this.throwIfDisposed(),VYe(this)};ce().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Oh(this,n)};ce().prototype.logicalNot=function(){return this.throwIfDisposed(),Ok(this)};ce().prototype.logicalOr=function(n){return this.throwIfDisposed(),UG(this,n)};ce().prototype.logicalXor=function(n){return this.throwIfDisposed(),tZe(this,n)};ce().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),xa(this,n,e,t)};ce().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),HG(this,n,e,t,r)};ce().prototype.max=function(n,e){return this.throwIfDisposed(),el(this,n,e)};ce().prototype.maximum=function(n){return this.throwIfDisposed(),KG(this,n)};ce().prototype.mean=function(n,e){return this.throwIfDisposed(),iZe(this,n,e)};ce().prototype.min=function(n,e){return this.throwIfDisposed(),hk(this,n,e)};ce().prototype.minimum=function(n){return this.throwIfDisposed(),sZe(this,n)};ce().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),cZe(this,n,e)};ce().prototype.mod=function(n){return this.throwIfDisposed(),fZe(this,n)};ce().prototype.mul=function(n){return this.throwIfDisposed(),$e(this,n)};ce().prototype.neg=function(){return this.throwIfDisposed(),Nr(this)};ce().prototype.norm=function(n,e,t){return this.throwIfDisposed(),$G(this,n,e,t)};ce().prototype.notEqual=function(n){return this.throwIfDisposed(),dZe(this,n)};ce().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),y9e(this,n,e,t)};ce().prototype.onesLike=function(){return this.throwIfDisposed(),vZe(this)};ce().prototype.pad=function(n,e){return this.throwIfDisposed(),jG(this,n,e)};ce().prototype.pool=function(n,e,t,r,a,i){return this.throwIfDisposed(),wZe(this,n,e,t,r,a,i)};ce().prototype.pow=function(n){return this.throwIfDisposed(),Om(this,n)};ce().prototype.prelu=function(n){return this.throwIfDisposed(),kZe(this,n)};ce().prototype.prod=function(n,e){return this.throwIfDisposed(),NZe(this,n,e)};ce().prototype.reciprocal=function(){return this.throwIfDisposed(),RZe(this)};ce().prototype.relu=function(){return this.throwIfDisposed(),PZe(this)};ce().prototype.relu6=function(){return this.throwIfDisposed(),BZe(this)};ce().prototype.reshapeAs=function(n){return this.throwIfDisposed(),de(this,n.shape)};ce().prototype.reshape=function(n){return this.throwIfDisposed(),de(this,n)};ce().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),vJe(this,n,e,t)};ce().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),gJe(this,n,e,t)};ce().prototype.reverse=function(n){return this.throwIfDisposed(),Im(this,n)};ce().prototype.rfft=function(){return this.throwIfDisposed(),eJe(this)};ce().prototype.round=function(){return this.throwIfDisposed(),$Ze(this)};ce().prototype.rsqrt=function(){return this.throwIfDisposed(),TG(this)};ce().prototype.selu=function(){return this.throwIfDisposed(),WZe(this)};ce().prototype.separableConv2d=function(n,e,t,r,a,i){return this.throwIfDisposed(),GZe(this,n,e,t,r,a,i)};ce().prototype.sigmoid=function(){return this.throwIfDisposed(),Dk(this)};ce().prototype.sign=function(){return this.throwIfDisposed(),HZe(this)};ce().prototype.sin=function(){return this.throwIfDisposed(),xG(this)};ce().prototype.sinh=function(){return this.throwIfDisposed(),kG(this)};ce().prototype.slice=function(n,e){return this.throwIfDisposed(),$i(this,n,e)};ce().prototype.softmax=function(n){return this.throwIfDisposed(),jZe(this,n)};ce().prototype.softplus=function(){return this.throwIfDisposed(),GG(this)};ce().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),Ek(this,n,e)};ce().prototype.split=function(n,e){return this.throwIfDisposed(),Nm(this,n,e)};ce().prototype.sqrt=function(){return this.throwIfDisposed(),as(this)};ce().prototype.square=function(){return this.throwIfDisposed(),sr(this)};ce().prototype.squaredDifference=function(n){return this.throwIfDisposed(),nJe(this,n)};ce().prototype.squeeze=function(n){return this.throwIfDisposed(),aJe(this,n)};ce().prototype.stack=function(n,e){this.throwIfDisposed();let t=n instanceof Sr?[this,n]:[this,...n];return YG(t,e)};ce().prototype.step=function(n){return this.throwIfDisposed(),Cm(this,n)};ce().prototype.stridedSlice=function(n,e,t,r,a,i,o,s){return this.throwIfDisposed(),sJe(this,n,e,t,r,a,i,o,s)};ce().prototype.sub=function(n){return this.throwIfDisposed(),fr(this,n)};ce().prototype.sum=function(n,e){return this.throwIfDisposed(),Tt(this,n,e)};ce().prototype.tan=function(){return this.throwIfDisposed(),cJe(this)};ce().prototype.tanh=function(){return this.throwIfDisposed(),K9e(this)};ce().prototype.tile=function(n){return this.throwIfDisposed(),EG(this,n)};ce().prototype.toBool=function(){return this.throwIfDisposed(),ot(this,"bool")};ce().prototype.toFloat=function(){return this.throwIfDisposed(),ot(this,"float32")};ce().prototype.toInt=function(){return this.throwIfDisposed(),ot(this,"int32")};ce().prototype.topk=function(n,e){return this.throwIfDisposed(),fJe(this,n,e)};ce().prototype.transpose=function(n){return this.throwIfDisposed(),yu(this,n)};ce().prototype.unique=function(n){return this.throwIfDisposed(),dJe(this,n)};ce().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),IG(this,n,e)};ce().prototype.unstack=function(n){return this.throwIfDisposed(),DG(this,n)};ce().prototype.where=function(n,e){return this.throwIfDisposed(),ho(n,this,e)};ce().prototype.zerosLike=function(){return this.throwIfDisposed(),kn(this)};var rQe="4.2.0";var aQe={"tfjs-core":Xx.version_core,"tfjs-backend-cpu":qKe.version_cpu,"tfjs-backend-webgl":WKe.version_webgl,"tfjs-data":kW.version_data,"tfjs-layers":Yx.version_layers,"tfjs-converter":Zx.version_converter,tfjs:rQe};Object.keys(Xx).forEach(function(n){n!=="default"&&Object.defineProperty(ku,n,{enumerable:!0,get:function(){return Xx[n]}})});Object.keys(Yx).forEach(function(n){n!=="default"&&Object.defineProperty(ku,n,{enumerable:!0,get:function(){return Yx[n]}})});Object.keys(Zx).forEach(function(n){n!=="default"&&Object.defineProperty(ku,n,{enumerable:!0,get:function(){return Zx[n]}})});ku.data=kW;ku.version=aQe});var sl=Y((cot,eU)=>{var{argmin:iQe,distance:oQe,isArray:sQe,isDataFrame:JG,isNumber:uQe,isSeries:cQe,shape:lQe}=Et(),zh=ZG(),fQe=new Function("try { return this === window } catch(e) { return false }");function QG(n){return $h(n)?QG(n.arraySync()):JG(n)?!0:sQe(n)&&lQe(n).length===2}function $h(n){return n instanceof zh.Tensor}function hQe(n){return uQe(n)&&parseInt(n)===n&&n>=0}function dQe(n,e){return zh.tidy(()=>{$h(n)&&(n=n.arraySync()),$h(e)&&(e=e.arraySync());let t=[],r=e.slice();return n.forEach(a=>{let i=iQe(r.map(o=>oQe(a,o)));t.push(r[i]),r.splice(i,1)}),t.concat(r)})}function pQe(n){return zh.tidy(()=>((JG(n)||cQe(n))&&(n=n.values),$h(n)||(n=zh.tensor(n)),n.div(n.abs())))}eU.exports={isBrowser:fQe,isMatrix:QG,isTFTensor:$h,isWholeNumber:hQe,orderCentroids:dQe,sign:pQe,tf:zh}});var Bk=Y((lot,rU)=>{var{assert:Pk,flatten:tU,isDataFrame:Su,isEqual:Mk,isSeries:Nu,isUndefined:vQe,shape:ul}=Et(),{isTFTensor:Tu,sign:mQe,tf:Wi}=sl();function gQe(n,e){return Tu(n)&&(n=n.arraySync()),(Su(n)||Nu(n))&&(n=n.values),Tu(e)&&(e=e.arraySync()),(Su(e)||Nu(e))&&(e=e.values),Pk(Mk(ul(n),ul(e)),"`yPred` and `yTrue` must have the same shape!"),Wi.tidy(()=>Wi.tensor(n).sub(Wi.tensor(e)).pow(2).sum().arraySync())}function yQe(n,e){Tu(n)&&(n=n.arraySync()),(Su(n)||Nu(n))&&(n=n.values),Tu(e)&&(e=e.arraySync()),(Su(e)||Nu(e))&&(e=e.values),Pk(Mk(ul(n),ul(e)),"`yPred` and `yTrue` must have the same shape!");let t=tU(n),r=tU(e),a=0;return t.forEach((i,o)=>{i===r[o]&&a++}),a/t.length}function nU(n,e,t){return Wi.tidy(()=>{Tu(n)&&(n=n.arraySync()),(Su(n)||Nu(n))&&(n=n.values),Tu(e)&&(e=e.arraySync()),(Su(e)||Nu(e))&&(e=e.values),vQe(t)&&(t=n),Tu(t)&&(t=t.arraySync()),(Su(t)||Nu(t))&&(t=t.values),typeof t=="number"&&(t=[t]),Pk(Mk(ul(n),ul(e)),"`yTrue` and `yPred` must have the same shape!"),n=Wi.tensor(n),e=Wi.tensor(e),t=Wi.tensor(t);let r=n.sub(e).pow(2).sum(),a=n.sub(t.mean()).pow(2).sum();return Wi.scalar(1).sub(r.div(a)).arraySync()})}function bQe(n,e,t){return Wi.tidy(()=>{let r=Wi.scalar(nU(n,e,t));return mQe(r).mul(r.abs().sqrt()).arraySync()})}rU.exports={sse:gQe,accuracy:yQe,rSquared:nU,rScore:bQe}});var Vi=Y((fot,aU)=>{aU.exports={shouldIgnoreNaNValues:!0}});var cl=Y((hot,oU)=>{var{assert:wQe,flatten:xQe,isArray:kQe,isDataFrame:SQe,isNumber:NQe,isSeries:TQe}=Et();function iU(n){if(SQe(n)||TQe(n))return iU(n.values);wQe(kQe(n),"The `containsOnlyNumbers` function only works on arrays, Series, and DataFrames!");let e=xQe(n);for(let t=0;t<e.length;t++)if(!NQe(e[t]))return!1;return!0}oU.exports=iU});var zk=Y((dot,sU)=>{var{dropMissing:EQe,flatten:IQe,isArray:CQe,isDataFrame:AQe,isSeries:_Qe}=Et();function Lk(n){return typeof n=="number"?n===0||n===1:AQe(n)||_Qe(n)?Lk(n.values):CQe(n)?n.length===0?!1:EQe(IQe(n)).every(t=>Lk(t)):!1}sU.exports=Lk});var gU=Y((pot,mU)=>{var{abs:uU,apply:cU,assert:lU,clamp:DQe,copy:FQe,divide:RQe,dropNaN:OQe,flatten:PQe,isArray:MQe,isDataFrame:BQe,isNumber:fU,isSeries:LQe,max:hU,median:dU,min:zQe,sort:$Qe,subtract:pU}=Et(),qQe=Vi(),WQe=cl(),VQe=zk();function vU(n,e){if(BQe(n)||LQe(n)){let u=n.copy();return u._values=vU(u._values,e),u}if(lU(MQe(n),"The `clipOutliers` function only works on arrays, Series, and DataFrames!"),e=e||5,lU(fU(e),"Any `maxScore` value passed into the `clipOutliers` function must be a number!"),!qQe.shouldIgnoreNaNValues&&!WQe(n))return cU(n,()=>NaN);let t=PQe(n),r=OQe(t);if(VQe(r)||r.length===0)return n;let a=dU(r),i=dU(uU(pU(r,a))),o=!1;if(i===0){let u=$Qe(FQe(r)),c=u.filter(d=>d<a),l=u.filter(d=>d>a),f=a,h=a;if(c.length>0&&(f=hU(c)),l.length>0&&(h=zQe(l)),i=(h-f)/2,i===0)return n;o=(a-f)/i>e||(h-a)/i>e}return hU(RQe(uU(pU(r,a)),i))>e||o?cU(n,u=>fU(u)?DQe(u,a-e*i,a+e*i):u):n}mU.exports=vU});var qk=Y((vot,TU)=>{var{assert:yU,dropNaN:bU,isArray:wU,isSeries:xU,mean:kU,shape:SU,variance:NU}=Et(),GQe=Vi();function $k(n,e){if(xU(n))return $k(n.values,e);if(xU(e))return $k(n,e.values);yU(wU(n)&&wU(e)&&SU(n).length===1&&SU(e).length===1,"The `cohensd` function only works on 1-dimensional arrays and Series!"),yU(n.length===e.length,"Two arrays or Series passed into the `cohensd` function must have the same length!"),GQe.shouldIgnoreNaNValues&&(n=bU(n),e=bU(e));try{let t=kU(n),r=kU(e),a=Math.sqrt((NU(n)+NU(e))/2);return(t-r)/a}catch{return NaN}}TU.exports=$k});var AU=Y((mot,CU)=>{var{assert:EU,DataFrame:UQe,isArray:HQe,isSeries:KQe,shape:jQe,zeros:XQe}=Et();function IU(n){if(KQe(n)){let r=new UQe(IU(n.values));return r.index=n.index.slice(),r.columns=n.index.slice(),r}EU(HQe(n),"The `diagonalize` function only works on 1-dimensional arrays and Series!");let e=jQe(n);EU(e.length===1,"The `diagonalize` function only works on 1-dimensional arrays and Series!");let t=XQe([e[0],e[0]]);return n.forEach((r,a)=>t[a][a]=r),t}CU.exports=IU});var Uk=Y((got,RU)=>{var{assert:Wk,clamp:YQe,correl:_U,DataFrame:Mm,dropNaNPairwise:ZQe,isArray:DU,isDataFrame:Bm,isJagged:FU,isUndefined:JQe,ndarray:QQe}=Et(),eet=Vi();function Vk(n){let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return Object.defineProperty(n,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),n}function Gk(n,e){if(JQe(e)&&(e=n),Bm(n)){let r=new Mm(Gk(n.values,e));return r.index=n.columns.slice(),r.columns=Bm(e)?e.columns.slice():new Mm(e).columns.slice(),Vk(r)}if(Bm(e)){let r=new Mm(Gk(n,e.values));return r.index=Bm(n)?n.columns.slice():new Mm(n).columns.slice(),r.columns=e.columns.slice(),Vk(r)}Wk(DU(n)&&DU(e),"The `getCorrelationMatrix` function only works on 2-dimensional arrays and DataFrames!"),Wk(!FU(n)&&!FU(e),"The `getCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),Wk(n.length===e.length,'The dimensions of the matrices you passed into the `getCorrelationMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=QQe([n[0].length,e[0].length]);for(let r=0;r<n[0].length;r++){let a=n.map(i=>i[r]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);eet.shouldIgnoreNaNValues?t[r][i]=_U(...ZQe(a,o)):t[r][i]=_U(a,o)}}return Vk(YQe(t,-1,1))}RU.exports=Gk});var Hk=Y((yot,OU)=>{function tet(n){try{let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return n[e]===Symbol.for(e)}catch{return!1}}OU.exports=tet});var LU=Y((bot,BU)=>{var{DataFrame:Kk,isArray:net,isDataFrame:Lm,isNumber:PU,MathError:ret,sort:aet}=Et(),MU=Uk(),iet=Hk();function oet(n,e,t){t=Object.values(arguments).find(i=>PU(i))||1-1e-5;let r=(()=>{let i=Object.values(arguments).filter(o=>net(o)||Lm(o));if(i.length===1){let o=i[0];if(iet(o))return Lm(o)?o:new Kk(o);{let s=MU(o,null);return Lm(s)?s:new Kk(s)}}if(i.length===2){let o=MU(i[0],i[1]);return Lm(o)?o:new Kk(o)}throw new ret("You must pass 1 or 2 2-dimensional arrays or DataFrames into the `getHighlyCorrelatedColumns` function!")})(),a={};return r.values.forEach((i,o)=>{i.forEach((s,u)=>{if(PU(s)&&s>t){let c=r.index[o],l=r.columns[u];a[c]||(a[c]=[]),a[c].indexOf(l)<0&&a[c].push(l),a[l]||(a[l]=[]),a[l].indexOf(c)<0&&a[l].push(c)}})}),Object.keys(a).forEach(i=>{a[i]=aet(a[i])}),a}BU.exports=oet});var jk=Y((wot,$U)=>{var{dropNaN:set,isArray:uet,isDataFrame:cet,isNumber:fet,isSeries:het,pow:det,sqrt:pet,sum:vet}=Et(),met=Vi();function zU(n){return cet(n)||het(n)?zU(n.values):fet(n)?Math.abs(n):uet(n)?(met.shouldIgnoreNaNValues&&(n=set(n)),pet(vet(det(n,2)))):NaN}$U.exports=zU});var Xk=Y((xot,GU)=>{var{assert:qU,DataFrame:get,isArray:yet,isSeries:bet,isString:wet,isUndefined:WU,set:xet,shape:ket,sort:Net}=Et();function VU(){if(arguments.length===1&&bet(arguments[0])){let{name:a,values:i}=arguments[0],o=VU(a,i),s=new get(o);return s.index=arguments[0].index.slice(),s}let[n,e]=arguments;qU(wet(n),"When passing two arguments into the `getOneHotEncodings` function, the first argument must be a string representing the name of the variable being encoded!"),qU(yet(e)&&ket(e).length===1,"When passing two arguments into the `getOneHotEncodings` function, the second argument must be a 1-dimensional array!");let t={};return Net(xet(e)).filter(a=>typeof a!="number"||a.toString()!=="NaN").filter(a=>!WU(a)).map(a=>n+"_"+a).slice(0,-1).forEach(a=>{t[a]=e.map(i=>a===n+"_"+i?1:typeof i=="number"&&i.toString()==="NaN"?NaN:WU(i)?NaN:0)}),t}GU.exports=VU});var HU=Y((kot,UU)=>{var{count:Tet}=Et();function Eet(n){return Tet(n).map(t=>(t.percentage=t.count/n.length,t))}UU.exports=Eet});var KU=Y((Sot,Iet)=>{Iet.exports=[.5,.49601,.49202,.48803,.48405,.48006,.47608,.4721,.46812,.46414,.46017,.4562,.45224,.44828,.44433,.44038,.4364,.43251,.42858,.42465,.42074,.41683,.41294,.40905,.40517,.40129,.39743,.39358,.38974,.38591,.38209,.37828,.37448,.3707,.36693,.36317,.35942,.35569,.35197,.34827,.34458,.3409,.33724,.3336,.32997,.32636,.32276,.31918,.31561,.31207,.30854,.30503,.30153,.29806,.2946,.29116,.28774,.28434,.28096,.2776,.27425,.27093,.26763,.26435,.26109,.25785,.25463,.25143,.24825,.2451,.24196,.23885,.23576,.2327,.22965,.22663,.22363,.22065,.2177,.21476,.21186,.20897,.20611,.20327,.20045,.19766,.19489,.19215,.18943,.18673,.18406,.18141,.17879,.17619,.17361,.17106,.16853,.16602,.16354,.16109,.15866,.15625,.15386,.15151,.14917,.14686,.14457,.14231,.14007,.13786,.13567,.1335,.13136,.12924,.12714,.12507,.12302,.121,.119,.11702,.11507,.11314,.11123,.10935,.10749,.10565,.10383,.10204,.10027,.09853,.0968,.0951,.09342,.09176,.09012,.08851,.08692,.08534,.08379,.08226,.08076,.07927,.0778,.07636,.07493,.07353,.07215,.07078,.06944,.06811,.06681,.06552,.06426,.06301,.06178,.06057,.05938,.05821,.05705,.05592,.0548,.0537,.05262,.05155,.0505,.04947,.04846,.04746,.04648,.04551,.04457,.04363,.04272,.04182,.04093,.04006,.0392,.03836,.03754,.03673,.03593,.03515,.03438,.03362,.03288,.03216,.03144,.03074,.03005,.02938,.02872,.02807,.02743,.0268,.02619,.02559,.025,.02442,.02385,.0233,.02275,.02222,.02169,.02118,.02068,.02018,.0197,.01923,.01876,.01831,.01786,.01743,.017,.01659,.01618,.01578,.01539,.015,.01463,.01426,.0139,.01355,.01321,.01287,.01255,.01222,.01191,.0116,.0113,.01101,.01072,.01044,.01017,.0099,.00964,.00939,.00914,.00889,.00866,.00842,.0082,.00798,.00776,.00755,.00734,.00714,.00695,.00676,.00657,.00639,.00621,.00604,.00587,.0057,.00554,.00539,.00523,.00508,.00494,.0048,.00466,.00453,.0044,.00427,.00415,.00402,.00391,.00379,.00368,.00357,.00347,.00336,.00326,.00317,.00307,.00298,.00289,.0028,.00272,.00264,.00256,.00248,.0024,.00233,.00226,.00219,.00212,.00205,.00199,.00193,.00187,.00181,.00175,.00169,.00164,.00159,.00154,.00149,.00144,.00139,.00135,.00131,.00126,.00122,.00118,.00114,.00111,.00107,.00104,.001,97e-5,94e-5,9e-4,87e-5,84e-5,82e-5,79e-5,76e-5,74e-5,71e-5,69e-5,66e-5,64e-5,62e-5,6e-4,58e-5,56e-5,54e-5,52e-5,5e-4,48e-5,47e-5,45e-5,43e-5,42e-5,4e-4,39e-5,38e-5,36e-5,35e-5,34e-5,32e-5,31e-5,3e-4,29e-5,28e-5,27e-5,26e-5,25e-5,24e-5,23e-5,22e-5,22e-5,21e-5,2e-4,19e-5,19e-5,18e-5,17e-5,17e-5,16e-5,15e-5,15e-5,14e-5,14e-5,13e-5,13e-5,12e-5,12e-5,11e-5,11e-5,1e-4,1e-4,1e-4,9e-5,9e-5,8e-5,8e-5,8e-5,8e-5,7e-5,7e-5,7e-5,6e-5,6e-5,6e-5,6e-5,5e-5,5e-5,5e-5,5e-5,5e-5,4e-5,4e-5,4e-5,4e-5,4e-5,4e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,2e-5,2e-5,2e-5,2e-5]});var Zk=Y((Not,n6)=>{var{abs:jU,assert:Cet,dropNaNPairwise:Aet,flatten:zm,isArray:XU,isDataFrame:YU,isEqual:_et,isSeries:ZU,mean:JU,remap:Det,round:Fet,shape:QU,sqrt:Ret,std:e6}=Et(),Oet=Vi(),t6=KU();function Pet(n){return jU(n)>4.1?0:t6[Fet(Det(jU(n),0,4.1,0,t6.length))]}function Yk(n,e){if(YU(n)||ZU(n))return Yk(n.values,e);if(YU(e)||ZU(e))return Yk(n,e.values);Cet(XU(n)&&XU(e)&&_et(QU(n),QU(e)),"You must pass two identically-shaped arrays, Series, or DataFrames into the `pValue` function!");let[t,r]=Oet.shouldIgnoreNaNValues?Aet(zm(n),zm(e)):[zm(n),zm(e)];if(t.length===0||r.length===0)return NaN;let a=JU(t),i=JU(r),o=e6(t),s=e6(r),u=t.length,c=r.length,l=(a-i)/Ret(o*o/u+s*s/c);return 2*Pet(l)}n6.exports=Yk});var s6=Y((Tot,o6)=>{var{assert:Jk,clamp:Met,DataFrame:$m,dropNaNPairwise:Bet,isArray:r6,isDataFrame:qm,isJagged:a6,isUndefined:Let,ndarray:zet}=Et(),$et=Vi(),i6=Zk();function Qk(n){let e="@jrc03c/js-data-science-helpers/get-p-value-matrix";return Object.defineProperty(n,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),n}function e2(n,e){if(Let(e)&&(e=n),qm(n)){let r=new $m(e2(n.values,e));return r.index=n.columns.slice(),r.columns=qm(e)?e.columns.slice():new $m(e).columns.slice(),Qk(r)}if(qm(e)){let r=new $m(e2(n,e.values));return r.index=qm(n)?n.columns.slice():new $m(n).columns.slice(),r.columns=e.columns.slice(),Qk(r)}Jk(r6(n)&&r6(e),"The `getPValueMatrix` function only works on 2-dimensional arrays and DataFrames!"),Jk(!a6(n)&&!a6(e),"The `getPValueMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),Jk(n.length===e.length,'The dimensions of the matrices you passed into the `getPValueMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=zet([n[0].length,e[0].length]);for(let r=0;r<n[0].length;r++){let a=n.map(i=>i[r]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);$et.shouldIgnoreNaNValues?t[r][i]=i6(...Bet(a,o)):t[r][i]=i6(a,o)}}return Qk(Met(t,0,1))}o6.exports=e2});var h6=Y((Eot,f6)=>{var{assert:Wm,intersect:qet,isDataFrame:u6,isSeries:c6,isUndefined:l6}=Et(),ll=class{constructor(e){let t=this;Wm(l6(e)||e===ll.DROP_NAN_MODE||e===ll.DROP_MISSING_MODE,"The `mode` value passed into the `IndexMatcher` constructor must be undefined or one of [IndexMatcher.DROP_NAN_MODE, IndexMatcher.DROP_MISSING_MODE]! (By default, the mode is `Indexer.DROP_MISSING_MODE`.)"),t.mode=l6(e)?ll.DROP_MISSING_MODE:e,t.index=null}fit(){let e=this,t=[];return Object.values(arguments).forEach(r=>{Wm(u6(r)||c6(r),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),e.mode===ll.DROP_MISSING_MODE?t.push(r.dropMissing().index):t.push(r.dropNaN().index)}),e.index=qet(...t),e}transform(){let e=this;Wm(!!e.index,"The IndexMatcher hasn't been fitted yet! Please call the `fit` method before calling the `transform` method.");let t=Object.values(arguments).map(r=>(Wm(u6(r)||c6(r),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),r.get(e.index,null)));return t.length===1?t[0]:t}fitAndTransform(){return this.fit(...arguments).transform(...arguments)}},qh=ll;Ym(qh,"DROP_NAN_MODE","DROP_NAN_MODE"),Ym(qh,"DROP_MISSING_MODE","DROP_MISSING_MODE");f6.exports=qh});var n2=Y((Cot,g6)=>{var{assert:t2,isArray:Wet,isBoolean:Vet,isDataFrame:d6,isSeries:p6,int:Get,isNumber:Uet,isUndefined:v6,range:m6,set:Het,shape:Ket,shuffle:jet}=Et();g6.exports=function(){let e=Array.from(arguments),t=e.find(d=>Vet(d)),r=v6(t)?!0:t,a=e.find(d=>Uet(d)),i=v6(a)?.1:a;t2(i>0&&i<1,"`testSize` must be a number between 0 and 1 (exclusive on both ends)!");let o=e.filter(d=>Wet(d)||d6(d)||p6(d));t2(o.length>0,"You must pass at least one dataset into the `trainTestSplit` function!");let s=o.map(d=>Ket(d)[0]);t2(Het(s).length===1,`All datasets passed into the \`trainTestSplit\` function must be the same length at their shallowest dimension! The lengths of your datasets, though, are: ${s.join(", ")}`);let u=[],c=r?jet(m6(0,s[0])):m6(0,s[0]),l=Get((1-i)*c.length),f=c.slice(0,l),h=c.slice(l);return o.forEach(d=>{if(d6(d))u.push(d.get(f,null)),u.push(d.get(h,null));else if(p6(d))u.push(d.get(f)),u.push(d.get(h));else{let p=[],v=[];d.forEach((m,g)=>{f.indexOf(g)>-1?p.push(m):v.push(m)}),u.push(p),u.push(v)}}),u}});var Gm=Y((Aot,S6)=>{var{add:Xet,argmin:Yet,assert:Zet,flatten:y6,isArray:Jet,isDataFrame:b6,isEqual:Qet,int:ett,isNumber:ttt,isSeries:w6,normal:r2,pow:ntt,random:rtt,range:att,scale:itt,shape:Vm,subtract:ott,sum:stt}=Et(),utt=n2();function a2(n,e){(b6(n)||w6(n))&&(n=n.values),(b6(e)||w6(e))&&(e=e.values),Zet(Qet(Vm(n),Vm(e)),"`yPred` and `yTrue` must have the same shape!");let t=y6(n),r=y6(e),a=0;return t.forEach((i,o)=>{i===r[o]&&a++}),a/t.length}function ctt(n){test(`tests that the \`${n.name}\` model works correctly`,()=>{let e=r2([5,10]).map(f=>f.map(h=>h*100+r2()*100)),t=[],r=att(0,500).map(()=>{let f=ett(rtt()*e.length),h=e[f];return t.push(f),Xet(h,itt(5,r2(Vm(h))))}),[a,i,o,s]=utt(r,t),u=new n({k:e.length});u.fit(a),u.centroids=x6(e,u.centroids);let c=u.predict(a),l=u.predict(i);expect(a2(o,c)).toBeGreaterThan(.95),expect(a2(s,l)).toBeGreaterThan(.95)})}function ltt(n){return Jet(n)&&Vm(n).length===2}function ftt(n){return ttt(n)&&parseInt(n)===n&&n>=0}function x6(n,e){return n.map(t=>e[Yet(e.map(r=>k6(t,r)))])}function k6(n,e){return stt(ntt(ott(n,e),2))}S6.exports={accuracy:a2,createGenericTest:ctt,isMatrix:ltt,isWholeNumber:ftt,orderCentroids:x6,sse:k6}});var s2=Y((_ot,I6)=>{var{add:N6,argmin:htt,assert:Eu,copy:dtt,distance:T6,divide:ptt,isDataFrame:vtt,isFunction:mtt,isUndefined:Um,normal:gtt,random:ytt,range:btt,scale:wtt,shuffle:xtt,zeros:E6}=Et(),{isMatrix:ktt,isWholeNumber:i2,sse:Stt}=Gm(),o2=class{constructor(e){Eu(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),Eu(i2(e.k),"`k` must be a whole number!"),Eu(i2(e.maxIterations)||Um(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),Eu(i2(e.maxRestarts)||Um(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),Eu(typeof e.tolerance=="number"||Um(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.k=e.k,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.centroids=null,t._fitState=null}initializeCentroids(e){let t=this;return xtt(e).slice(0,t.k)}fitStep(e,t){let r=this;if(Eu(ktt(e),"`x` must be a matrix!"),vtt(e)&&(e=e.values),Um(t)||Eu(mtt(t),"If defined, `progress` must be a function!"),r._fitState){if(r._fitState.isFinished)return r}else{let u=r.initializeCentroids(e);r._fitState={currentRestart:0,currentIteration:0,currentCentroids:u,bestCentroids:u,bestScore:-1/0,isFinished:!1}}let a=r.predict(e,r._fitState.currentCentroids),i=[],o=E6(r.k);e.forEach((u,c)=>{let l=a[c];i[l]||(i[l]=E6(u.length)),i[l]=N6(i[l],u),o[l]++});let s=btt(0,r.k).map(u=>o[u]===0?N6(r._fitState.currentCentroids[parseInt(ytt()*r._fitState.currentCentroids.length)],wtt(.001,gtt(r._fitState.currentCentroids[0].length))):ptt(i[u],o[u]));if(T6(r._fitState.currentCentroids,s)<r.tolerance?r._fitState.currentIteration=r.maxIterations-1:r._fitState.currentCentroids=s,t&&t((r._fitState.currentRestart+r._fitState.currentIteration/r.maxIterations)/r.maxRestarts,r),r._fitState.currentIteration++,r._fitState.currentIteration>=r.maxIterations){let u=r.score(e,r._fitState.currentCentroids);if(u>r._fitState.bestScore&&(r._fitState.bestScore=u,r._fitState.bestCentroids=dtt(r._fitState.currentCentroids)),r._fitState.currentIteration=0,r._fitState.currentRestart++,r._fitState.currentRestart>=r.maxRestarts)r._fitState.isFinished=!0,r.centroids=r._fitState.bestCentroids,t&&t(1,r);else{let c=r.initializeCentroids(e);r._fitState.currentCentroids=c}}return r}fit(e,t){let r=this;for(r._fitState&&(r._fitState=null);!r._fitState||!r._fitState.isFinished;)r.fitStep(e,t);return r}predict(e,t){if(t=t||this.centroids,!t)throw new Error("No centroids were provided to the `predict` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `predict` method or run the `fit` method first!");return e.map(a=>htt(t.map(i=>T6(a,i))))}score(e,t){let r=this;if(t=t||r.centroids,!t)throw new Error("No centroids were provided to the `score` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `score` method or run the `fit` method first!");let i=r.predict(e,t).map(o=>t[o]);return-Stt(e,i)}};I6.exports=o2});var c2=Y((Dot,_6)=>{var{argmin:Ntt,distance:C6,divide:Ttt,max:Ett,random:A6}=Et(),Itt=s2(),u2=class extends Itt{initializeCentroids(e){let t=this,r=[e[parseInt(A6()*e.length)]];for(;r.length<t.k;){let a=e.map(o=>C6(o,r[Ntt(r.map(s=>C6(o,s)))])),i=Ttt(a,Ett(a));r.push(e[i.findIndex(o=>A6()<o)])}return r}};_6.exports=u2});var R6=Y((Fot,F6)=>{var{assert:vo,isArray:Ctt,isDataFrame:Att,isEqual:_tt,isFunction:Dtt,isUndefined:fl,range:Ftt,shape:D6}=Et(),{isMatrix:Rtt,isWholeNumber:l2}=Gm(),Ott=c2(),f2=class{constructor(e){fl(e)&&(e={}),vo(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),fl(e.ks)&&(e.ks=Ftt(1,16)),vo(Ctt(e.ks),"`ks` must be an array of whole numbers!"),e.ks.forEach(r=>{vo(l2(r),"`ks` must be an array of whole numbers!")}),vo(l2(e.maxIterations)||fl(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),vo(l2(e.maxRestarts)||fl(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),vo(typeof e.tolerance=="number"||fl(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.ks=e.ks,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.scoreStopRatio=e.scoreStopRatio||.85,t.modelClass=e.modelClass||Ott,t.fittedModel=null,t._fitState=null}fitStep(e,t){let r=this;if(vo(Rtt(e),"`x` must be a matrix!"),Att(e)&&(e=e.values),fl(t)||vo(Dtt(t),"If defined, `progress` must be a function!"),!r._fitState)r._fitState={isFinished:!1,lastScore:-1/0,currentIndex:0};else if(r._fitState.isFinished)return r;let a=r.ks[r._fitState.currentIndex],i=new r.modelClass({k:a,maxRestarts:10,maxIterations:20});i.fit(e,s=>t?t((r._fitState.currentIndex+s)/(r.ks.length+1)):null);let o=i.score(e);return o/r._fitState.lastScore>r.scoreStopRatio?(r._fitState.isFinished=!0,r._fitState.currentIndex--):(r._fitState.lastScore=o,r._fitState.currentIndex+1>=r.ks.length?r._fitState.isFinished=!0:r._fitState.currentIndex++),r._fitState.isFinished&&(r.fittedModel=new r.modelClass({k:r.ks[r._fitState.currentIndex],maxRestarts:r.maxRestarts,maxIterations:r.maxIterations}),r.fittedModel.fit(e,s=>t?t((r.ks.length+s)/(r.ks.length+1)):null),t&&t(1)),r}fit(e,t){let r=this;for(r._fitState=null;!r._fitState||!r._fitState.isFinished;)r.fitStep(e,t);return r}predict(e,t){return this.fittedModel.predict(e,t)}score(e,t){return this.fittedModel.score(e,t)}get k(){return this.fittedModel.k}set k(e){throw new Error("You can't set the k-value manually! It has to be set automatically via the `fit` method.")}get centroids(){return this.fittedModel.centroids}set centroids(e){let t=this;vo(_tt(D6(e),D6(t.fittedModel.centroids)),"When assigning a new value to the `centroids` property, the new centroids must have the same shape as the old centroids!"),t.fittedModel.centroids=e}};F6.exports=f2});var P6=Y((Rot,O6)=>{O6.exports={KMeansMeta:R6(),KMeansNaive:s2(),KMeansPlusPlus:c2(),helpers:Gm()}});var h2=Y((Oot,q6)=>{var{apply:Ptt,assert:Mtt,dropNaN:M6,isArray:Btt,isDataFrame:Ltt,isSeries:ztt,mean:B6,std:L6}=Et(),z6=Vi();function $6(n){if(Ltt(n)||ztt(n)){let r=n.copy();return r.values=$6(r.values),r}Mtt(Btt(n),"The `normalize` function only works on arrays, Series, and DataFrames!");let e=(()=>z6.shouldIgnoreNaNValues?B6(M6(n)):B6(n))(),t=(()=>z6.shouldIgnoreNaNValues?L6(M6(n)):L6(n))();return t===0?n:Ptt(n,r=>(r-e)/t)}q6.exports=$6});var p2=Y((Pot,H6)=>{var{assert:hl,dot:W6,isArray:V6,isSeries:d2,scale:$tt,Series:qtt,shape:G6}=Et(),U6=cl();function Hm(n,e){if(d2(n)){if(d2(e))return new qtt(Hm(n.values,e.values));{let t=n.copy();return t.values=Hm(n.values,e),t}}if(d2(e)){let t=e.copy();return t.values=Hm(n,e.values),t}return hl(V6(n),"`project` only works on vectors!"),hl(V6(e),"`project` only works on vectors!"),hl(U6(n),"`project` only works on vectors of numbers!"),hl(U6(e),"`project` only works on vectors of numbers!"),hl(G6(n).length===1,"`project` only works on vectors!"),hl(G6(e).length===1,"`project` only works on vectors!"),$tt(W6(e,n)/W6(e,e),e)}H6.exports=Hm});var Z6=Y((Mot,Y6)=>{var{assert:K6,copy:Wtt,DataFrame:Vtt,divide:Gtt,isArray:Utt,isDataFrame:Htt,isJagged:Ktt,shape:jtt,subtract:Xtt,transpose:j6}=Et(),Ytt=cl(),Ztt=jk(),Jtt=p2();function X6(n){if(Htt(n)){let a=new Vtt(X6(n.values));return a.index=n.index.slice(),a.columns=n.columns.slice(),a}K6(Utt(n)&&!Ktt(n)&&jtt(n).length===2,"`orthonormalize` only works on matrices!"),K6(Ytt(n),"`orthonormalize` only works on matrices of numbers!");let e=j6(n),t=[];e.forEach(a=>{let i=Wtt(a);t.forEach(o=>{i=Xtt(i,Jtt(i,o))}),t.push(i)});let r=t.map(a=>Gtt(a,Ztt(a)));return j6(r)}Y6.exports=X6});var Q6=Y((Bot,J6)=>{function Qtt(n){if(typeof n!="string")throw new Error("`text` must be a string!");n=n.trim();let e="",t=!1;for(let r=0;r<n.length;r++){let a=n[r];a.match(/[A-Za-z0-9]/g)?(e.length===0?e+=a.toLowerCase():t?e+=a.toUpperCase():e+=a,t=!1):!a.includes("'")&&!a.includes("\u2019")&&!a.includes("\u275C")&&(t=!0)}return e}J6.exports=Qtt});var tH=Y((Lot,eH)=>{function ent(n,e){return e=e||"",n.split(`
`).map(t=>t.trim().length>0?e+t:t).join(`
`)}eH.exports=ent});var rH=Y((zot,nH)=>{function tnt(n,e,t){if(typeof n!="string")throw new Error("`text` must be a string!");if(typeof e!="string")throw new Error("`a` must be a string!");if(typeof t!="string")throw new Error("`b` must be a string!");return n.split(e).join(t)}nH.exports=tnt});var iH=Y(($ot,aH)=>{aH.exports="!\"#%&'()*+,-./:;<=>?@[]^_`{|}~\xA0\xA1\xA4\xA7\xA9\xAA\xAB\xAE\xB0\xB1\xB6\xB7\xBA\xBB\xBF\xD7\xF7\u0254\u0300\u0301\u0302\u0303\u037E\u0387\u055A\u055B\u055C\u055D\u055E\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A\u066B\u066C\u066D\u06D4\u0700\u0701\u0702\u0703\u0704\u0705\u0706\u0707\u0708\u0709\u070A\u070B\u070C\u070D\u07F7\u07F8\u07F9\u0830\u0831\u0832\u0833\u0834\u0835\u0836\u0837\u0838\u0839\u083A\u083B\u083C\u083D\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04\u0F05\u0F06\u0F07\u0F08\u0F09\u0F0A\u0F0B\u0F0C\u0F0D\u0F0E\u0F0F\u0F10\u0F11\u0F12\u0F14\u0F3A\u0F3B\u0F3C\u0F3D\u0F85\u0FD0\u0FD1\u0FD2\u0FD3\u0FD4\u0FD9\u0FDA\u104A\u104B\u104C\u104D\u104E\u104F\u10FB\u1360\u1361\u1362\u1363\u1364\u1365\u1366\u1367\u1368\u1400\u166E\u169B\u169C\u16EB\u16EC\u16ED\u1735\u1736\u17D4\u17D5\u17D6\u17D8\u17D9\u17DA\u1800\u1801\u1802\u1803\u1804\u1805\u1806\u1807\u1808\u1809\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0\u1AA1\u1AA2\u1AA3\u1AA4\u1AA5\u1AA6\u1AA8\u1AA9\u1AAA\u1AAB\u1AAC\u1AAD\u1B5A\u1B5B\u1B5C\u1B5D\u1B5E\u1B5F\u1B60\u1BFC\u1BFD\u1BFE\u1BFF\u1C3B\u1C3C\u1C3D\u1C3E\u1C3F\u1C7E\u1C7F\u1CC0\u1CC1\u1CC2\u1CC3\u1CC4\u1CC5\u1CC6\u1CC7\u1CD3\u2010\u2011\u2012\u2013\u2014\u2015\u2016\u2017\u2018\u2019\u201A\u201B\u201C\u201D\u201E\u201F\u2020\u2021\u2022\u2023\u2024\u2025\u2026\u2027\u2030\u2031\u2032\u2033\u2034\u2035\u2036\u2037\u2038\u2039\u203A\u203B\u203C\u203D\u203E\u203F\u2040\u2041\u2042\u2043\u2045\u2046\u2047\u2048\u2049\u204A\u204B\u204C\u204D\u204E\u204F\u2050\u2051\u2052\u2053\u2054\u2055\u2056\u2057\u2058\u2059\u205A\u205B\u205C\u205D\u205E\u207D\u207E\u208D\u208E\u2116\u2117\u2120\u2122\u212E\u2212\u2234\u2235\u2248\u2300\u2308\u2309\u230A\u230B\u2311\u2329\u232A\u2380\u25CA\u25CC\u261E\u2640\u2642\u26A5\u2766\u2767\u2768\u2769\u276A\u276B\u276C\u276D\u276E\u276F\u2770\u2771\u2772\u2773\u2774\u2775\u27C5\u27C6\u27E6\u27E7\u27E8\u27E9\u27EA\u27EB\u27EC\u27ED\u27EE\u27EF\u2983\u2984\u2985\u2986\u2987\u2988\u2989\u298A\u298B\u298C\u298D\u298E\u298F\u2990\u2991\u2992\u2993\u2994\u2995\u2996\u2997\u2998\u29D8\u29D9\u29DA\u29DB\u29FC\u29FD\u2CF9\u2CFA\u2CFB\u2CFC\u2CFE\u2CFF\u2D70\u2E00\u2E01\u2E02\u2E03\u2E04\u2E05\u2E06\u2E07\u2E08\u2E09\u2E0A\u2E0B\u2E0C\u2E0D\u2E0E\u2E0F\u2E10\u2E11\u2E12\u2E13\u2E14\u2E15\u2E16\u2E17\u2E18\u2E19\u2E1A\u2E1B\u2E1C\u2E1D\u2E1E\u2E1F\u2E20\u2E21\u2E22\u2E23\u2E24\u2E25\u2E26\u2E27\u2E28\u2E29\u2E2A\u2E2B\u2E2C\u2E2D\u2E2E\u2E30\u2E31\u2E32\u2E33\u2E34\u2E35\u2E36\u2E37\u2E38\u2E39\u2E3A\u2E3B\u2E3C\u2E3D\u2E3E\u2E3F\u2E40\u2E41\u2E42\u2E43\u2E44\u2E45\u2E46\u2E47\u2E48\u2E49\u2E4A\u2E4B\u2E4C\u2E4D\u2E4E\u2E4F\u2E52\u3001\u3002\u3003\u3008\u3009\u300A\u300B\u300C\u300D\u300E\u300F\u3010\u3011\u3014\u3015\u3016\u3017\u3018\u3019\u301A\u301B\u301C\u301D\u301E\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D\uA60E\uA60F\uA673\uA67E\uA6F2\uA6F3\uA6F4\uA6F5\uA6F6\uA6F7\uA874\uA875\uA876\uA877\uA8CE\uA8CF\uA8F8\uA8F9\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1\uA9C2\uA9C3\uA9C4\uA9C5\uA9C6\uA9C7\uA9C8\uA9C9\uA9CA\uA9CB\uA9CC\uA9CD\uA9DE\uA9DF\uAA5C\uAA5D\uAA5E\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uD800\uD801\uD802\uD803\uD804\uD805\uD806\uD807\uD809\uD81A\uD81B\uD82F\uD836\uD83A\u{1F03B}\uDC41\uDC42\uDC43\uDC44\uDC45\uDC47\uDC48\uDC49\uDC4A\uDC4B\uDC4C\uDC4D\uDC4E\uDC4F\uDC57\uDC5A\uDC5B\uDC5D\uDC70\uDC71\uDC72\uDC73\uDC74\uDC9F\uDCBB\uDCBC\uDCBE\uDCBF\uDCC0\uDCC1\uDCC6\uDD00\uDD01\uDD02\uDD1F\uDD2F\uDD3F\uDD40\uDD41\uDD42\uDD43\uDD44\uDD45\uDD46\uDD5E\uDD5F\uDD6F\uDD74\uDD75\uDDC1\uDDC2\uDDC3\uDDC4\uDDC5\uDDC6\uDDC7\uDDC8\uDDC9\uDDCA\uDDCB\uDDCC\uDDCD\uDDCE\uDDCF\uDDD0\uDDD1\uDDD2\uDDD3\uDDD4\uDDD5\uDDD6\uDDD7\uDDDB\uDDDD\uDDDE\uDDDF\uDDE2\uDE38\uDE39\uDE3A\uDE3B\uDE3C\uDE3D\uDE3F\uDE40\uDE41\uDE42\uDE43\uDE44\uDE45\uDE46\uDE50\uDE51\uDE52\uDE53\uDE54\uDE55\uDE56\uDE57\uDE58\uDE60\uDE61\uDE62\uDE63\uDE64\uDE65\uDE66\uDE67\uDE68\uDE69\uDE6A\uDE6B\uDE6C\uDE6E\uDE6F\uDE7F\uDE87\uDE88\uDE89\uDE8A\uDE8B\uDE97\uDE98\uDE99\uDE9A\uDE9B\uDE9C\uDE9E\uDE9F\uDEA0\uDEA1\uDEA2\uDEA9\uDEAD\uDEF0\uDEF1\uDEF2\uDEF3\uDEF4\uDEF5\uDEF6\uDEF7\uDEF8\uDF37\uDF38\uDF39\uDF3A\uDF3B\uDF3C\uDF3D\uDF3E\uDF3F\uDF44\uDF55\uDF56\uDF57\uDF58\uDF59\uDF99\uDF9A\uDF9B\uDF9C\uDF9F\uDFD0\uDFE2\uDFFF\uFD3F\uFE10\uFE11\uFE12\uFE13\uFE14\uFE15\uFE16\uFE17\uFE18\uFE19\uFE30\uFE31\uFE32\uFE33\uFE34\uFE35\uFE36\uFE37\uFE38\uFE39\uFE3A\uFE3B\uFE3C\uFE3D\uFE3E\uFE3F\uFE40\uFE41\uFE42\uFE43\uFE44\uFE45\uFE46\uFE47\uFE48\uFE49\uFE4A\uFE4B\uFE4C\uFE4D\uFE4E\uFE4F\uFE50\uFE51\uFE52\uFE54\uFE55\uFE56\uFE57\uFE58\uFE59\uFE5A\uFE5B\uFE5C\uFE5D\uFE5E\uFE5F\uFE60\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01\uFF02\uFF03\uFF05\uFF06\uFF07\uFF08\uFF09\uFF0A\uFF0C\uFF0D\uFF0E\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B\uFF3C\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F\uFF60\uFF61\uFF62\uFF63\uFF64\uFF65"});var v2=Y((qot,uH)=>{var nnt=rH(),rnt=iH(),oH="  ",sH=" ";function ant(n){if(typeof n!="string")throw new Error("`text` must be a string!");let e="";for(let t=0;t<n.length;t++){let r=n[t].toLowerCase();rnt.includes(r)?e+=sH:e+=r}for(;e.includes(oH);)e=nnt(e,oH,sH);return e.trim()}uH.exports=ant});var lH=Y((Wot,cH)=>{var int=v2();function ont(n){if(typeof n!="string")throw new Error("`text` must be a string!");let e=int(n).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("-")}cH.exports=ont});var hH=Y((Vot,fH)=>{var snt=v2();function unt(n){if(typeof n!="string")throw new Error("`text` must be a string!");let e=snt(n).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("_")}fH.exports=unt});var pH=Y((Got,dH)=>{var{decycle:cnt}=Et();function lnt(n,e,t){return JSON.stringify(cnt(n),e,t)}dH.exports=lnt});var mH=Y((Uot,vH)=>{function fnt(n){let e=n.split(`
`),t=e.filter(a=>a.trim().length>0).map(a=>a.split("").findIndex(i=>!i.match(/\s/g))),r=Math.min(...t);return e.map(a=>a.substring(r)).join(`
`)}vH.exports=fnt});var yH=Y((Hot,gH)=>{function hnt(n,e){if(typeof n!="string")throw new Error("The first argument to the `wrap` function must be a string!");if((typeof e>"u"||e===null)&&(typeof process<"u"&&typeof process.stdout<"u"&&typeof process.stdout.columns=="number"?e=process.stdout.columns>80?80:process.stdout.columns:e=80),isNaN(e)||typeof e!="number")throw new Error("The second argument to the `wrap` function must be undefined, null, or an integer!");let t=[];return n.split(`
`).forEach(r=>{if(r.trim().length===0)return t.push("");let a=r.split(/[^\s]/g)[0],i=r.replace(a,"").split(" "),o=a;i.forEach(s=>{let u=o+(o.trim().length>0?" ":"")+s;u.length>e?(t.push(o),o=a+s):o=u}),o.length>0&&t.push(o)}),t.join(`
`)}gH.exports=hnt});var bH=Y((Kot,m2)=>{var Wh={camelify:Q6(),indent:tH(),kebabify:lH(),snakeify:hH(),stringify:pH(),unindent:mH(),wrap:yH(),dump(){Object.keys(Wh).forEach(n=>{typeof global<"u"&&(global[n]=Wh[n]),typeof window<"u"&&(window[n]=Wh[n])})}};typeof m2<"u"&&(m2.exports=Wh);typeof window<"u"&&(window.JSTextTools=Wh)});var EH=Y((jot,TH)=>{var{assert:dl,correl:wH,count:dnt,DataFrame:xH,inferType:pnt,isArray:vnt,isDataFrame:mnt,isFunction:gnt,isJagged:ynt,isNumber:Vh,isUndefined:kH,shape:bnt,sort:wnt,sum:xnt}=Et(),{stringify:knt}=bH(),Snt=Xk(),SH=n=>Vh(n)&&(parseInt(n)===n||n===1/0);function NH(n,e){e=e||{};let t=Vh(e.maxUniqueValues)?e.maxUniqueValues:7,r=Vh(e.minNonMissingValues)?e.minNonMissingValues:15,a=Vh(e.maxCorrelationThreshold)?e.maxCorrelationThreshold:1-1e-5,i=e.progress||null;if(vnt(n))return dl(bnt(n).length===2&&!ynt(n),"The `convertToNumerical` function only works on non-jagged 2-dimensional arrays and DataFrames!"),NH(new xH(n));dl(mnt(n),"You must pass a DataFrame into the `convertToNumerical` function!"),dl(SH(t),"`maxUniqueValues` must be a whole number!"),dl(SH(r),"`minNonMissingValues` must be a whole number!"),dl(Vh(a),"`maxCorrelationThreshold` must be a number!"),kH(i)||dl(gnt(i),"If defined, `progress` must be a function!");let o={};return n.apply((s,u)=>{i&&i(u/n.columns.length);let c=pnt(s.values);if(c.type==="boolean"&&(c.values=c.values.map(f=>f?1:0)),c.type==="date"&&(c.values=c.values.map(f=>{try{return f.getTime()}catch{return NaN}})),c.type==="null")return;c.type,c.type==="object"&&(c.values=c.values.map(f=>knt(f))),c.type;let l=c.values.filter(f=>!kH(f));if(!(c.values.length-l.length>r)){if(c.type!=="boolean"){let f=wnt(dnt(l),(d,p)=>p.count-d.count);if(xnt(f.slice(0,t).map(d=>d.count))/l.length>=.9){if(f.length<2)return;let d=Snt(s.name,c.values);for(;Object.keys(d).length>0;){let p=Object.keys(d)[0],v=d[p];delete d[p];let m=Object.keys(o);for(let g=0;g<m.length;g++){let y=o[m[g]];if(wH(v,y)>a)return}o[p]=v}return}if(c.type==="object"||c.type==="string")return}if(c.type==="boolean"||c.type==="date"||c.type==="number"){let f=Object.keys(o);for(let h=0;h<f.length;h++){let d=o[f[h]];if(wH(c.values,d)>a)return}o[s.name]=c.values}}}),new xH(o)}TH.exports=NH});var MH=Y((Xot,PH)=>{var{abs:Nnt,add:Tnt,assert:Gh,isArray:IH,isDataFrame:CH,isEqual:Ent,isSeries:AH,mean:Int,pow:_H,scale:Cnt,shape:DH,sign:Ant,sqrt:_nt,sum:FH}=Et(),RH=cl(),OH=(n,e)=>Tnt(n,Cnt(e,-1));function g2(n,e){if(CH(n)||AH(n))return g2(n.values,e);if(CH(e)||AH(e))return g2(n,e.values);Gh(IH(n),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Gh(IH(e),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Gh(Ent(DH(n),DH(e)),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Gh(RH(n),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Gh(RH(e),"You must pass two same-shaped numerical arrays into the `rScore` function!");let t=FH(_H(OH(n,e),2)),r=FH(_H(OH(n,Int(n)),2));if(r===0)return NaN;let a=1-t/r;return Ant(a)*_nt(Nnt(a))}PH.exports=g2});var qH=Y((Yot,$H)=>{var{argmax:BH,assert:Uh,copy:Dnt,DataFrame:Fnt,dot:Rnt,isArray:Ont,isDataFrame:Pnt,isEqual:LH,isJagged:Mnt,isNumber:Bnt,reverse:Lnt,shape:znt,transpose:$nt}=Et();function zH(n){if(Ont(n)){Uh(znt(n).length===2&&!Mnt(n),"The `sortCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!");let s=new Fnt(n);return s.index=s.columns.slice(),zH(s).values}Uh(Pnt(n),"You must pass a 2-dimensional array or DataFrame into the `sortCorrelationMatrix` function!");let e=n.copy(),t=[];e.values.forEach((s,u)=>{s.forEach((c,l)=>{Bnt(c)?Uh(c>=-1&&c<=1,"The correlation matrix passed into the `sortCorrelationMatrix` function must not contain values less than -1 or greater than 1!"):(t.push({row:e.index[u],col:e.columns[l],value:c}),e.values[u][l]=-1/0)})}),Uh(LH(e.values,$nt(e.values)),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical!"),Uh(LH(e.index,e.columns),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical! (In this case, although the values themselves are symmetrical, the row and column names differ.)");let r=Dnt(e.index),a=[];for(;r.length>0;)if(a.length===0){let s=BH(e.values.map(u=>Rnt(u,u)));a.push(r[s]),r.splice(s,1)}else{let s=e.index.indexOf(a.at(-1)),u=BH(r.map(l=>e.values[e.index.indexOf(l)][s])),c=r[u];a.push(c),r.splice(u,1)}let i=Lnt(a),o=e.get(i,i);return t.forEach(s=>{let u=o.index.indexOf(s.row),c=o.columns.indexOf(s.col);o.values[u][c]=s.value,o.values[c][u]=s.value}),o}$H.exports=zH});var VH=Y((Zot,WH)=>{var qnt=h2();function Wnt(){return qnt(...arguments)}WH.exports=Wnt});var JH=Y((Jot,ZH)=>{var{assert:Km,DataFrame:GH,dropNaN:Vnt,flatten:UH,isArray:Gnt,isDataFrame:y2,isSeries:b2,mean:HH,range:Unt,Series:KH,shape:jH,stdev:XH,transpose:YH}=Et(),Hnt=Vi(),w2=class{constructor(){let e=this;e.means=[],e.stdevs=[],e.wasFittedOnAVector=!1,e.hasBeenFitted=!1}_getDataArrayAndShape(e){if(y2(e))return[e.values,e.shape];if(b2(e)){let r=YH([e.values]);return[r,jH(r)]}Km(Gnt(e),"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!");let t=jH(e);return Km(t.length<3,"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!"),t.length===1&&(t.push(1),e=YH([e])),[e,t]}fit(e){let t=this,r=t._getDataArrayAndShape(e);e=r[0];let a=r[1];return t.wasFittedOnAVector=a.indexOf(1)>-1,t.means=[],t.stdevs=[],Unt(0,a[1]).forEach(i=>{let o=e.map(s=>s[i]);if(Hnt.shouldIgnoreNaNValues){let s=Vnt(o);t.means.push(HH(s)),t.stdevs.push(XH(s))}else t.means.push(HH(o)),t.stdevs.push(XH(o))}),t.hasBeenFitted=!0,t}transform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(y2(e)){let o=new GH(t.transform(e.values));return o.columns=e.columns,o.index=e.index,o}if(b2(e)){let o=new KH(t.transform(e.values));return o.name=e.name,o.index=e.index,o}let r=t._getDataArrayAndShape(e);e=r[0];let a=r[1];Km(a[1]===t.means.length,"The data you passed into the `transform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>(s-t.means[u])/t.stdevs[u]));return t.wasFittedOnAVector?UH(i):i}untransform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(y2(e)){let o=new GH(t.untransform(e.values));return o.columns=e.columns,o.index=e.index,o}if(b2(e)){let o=new KH(t.untransform(e.values));return o.name=e.name,o.index=e.index,o}let r=t._getDataArrayAndShape(e);e=r[0];let a=r[1];Km(a[1]===t.means.length,"The data you passed into the `untransform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>s*t.stdevs[u]+t.means[u]));return t.wasFittedOnAVector?UH(i):i}};ZH.exports=w2});var x2=Y((Qot,e5)=>{var{MathError:Knt}=Et(),QH={clipOutliers:gU(),cohensD:qk(),cohensd:qk(),common:Vi(),containsOnlyNumbers:cl(),diagonalize:AU(),getCorrelationMatrix:Uk(),getHighlyCorrelatedColumns:LU(),getMagnitude:jk(),getOneHotEncodings:Xk(),getPercentages:HU(),getPValueMatrix:s6(),IndexMatcher:h6(),isBinary:zk(),isCorrelationMatrix:Hk(),KMeans:P6(),normalize:h2(),orthonormalize:Z6(),convertToNumerical:EH(),project:p2(),pValue:Zk(),rScore:MH(),sortCorrelationMatrix:qH(),standardize:VH(),StandardScaler:JH(),trainTestSplit:n2(),dump(){let n=this,e=typeof global<"u"?global:typeof window<"u"?window:null;if(!e)throw new Knt("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(n).forEach(t=>{try{Object.defineProperty(e,t,{configurable:!1,enumerable:!0,writable:!1,value:n[t]})}catch{e[t]=n[t]}})}};try{window.JSDataScienceHelpers=QH}catch{}try{e5.exports=QH}catch{}});var T2=Y((est,n5)=>{var{add:jnt,assert:os,isDataFrame:k2,isFunction:Xnt,isUndefined:S2,normal:Ynt,random:Znt,scale:Jnt,shape:jm}=Et(),{isMatrix:Hh,isTFTensor:Kh,tf:Za}=sl(),{KMeansNaive:Qnt}=x2().KMeans,{sse:t5}=Bk(),N2=class extends Qnt{initializeCentroids(e){return Za.tidy(()=>Za.tensor(super.initializeCentroids(e)))}fitStep(e,t){let r=this;if(os(Hh(e),"`x` must be a matrix!"),k2(e)&&(e=e.values),S2(t)||os(Xnt(t),"If defined, `progress` must be a function!"),Kh(e)&&(e=e.arraySync()),r._fitState){if(r._fitState.isFinished)return r}else{let a=r.initializeCentroids(e);r._fitState={currentRestart:0,currentIteration:0,currentCentroids:a,bestCentroids:a,bestScore:-1/0,isFinished:!1}}return Za.tidy(()=>{let a=Za.tensor(e),i=r.predict(a,r._fitState.currentCentroids),o=[];for(let u=0;u<r.k;u++){let c=[];if(i.forEach((l,f)=>{l===u&&c.push(f)}),c.length===0){let l=f=>f[parseInt(Znt()*f.length)];o.push(jnt(l(r._fitState.currentCentroids.arraySync()),Jnt(.01,Ynt(e[0].length))))}else{let l=a.gather(c);o.push(l.mean(0))}}if(o=Za.stack(o),t5(r._fitState.currentCentroids,o)<r.tolerance&&(r._fitState.currentIteration=r.maxIterations-1),r._fitState.currentIteration++,r._fitState.currentIteration>=r.maxIterations){r._fitState.currentRestart++;let u=r.score(a,o);u>r._fitState.bestScore&&(r._fitState.bestScore=u,r._fitState.bestCentroids=o.clone()),r._fitState.currentIteration=0,r._fitState.currentRestart>=r.maxRestarts?r._fitState.isFinished=!0:r._fitState.currentCentroids=r.initializeCentroids(e)}else r._fitState.currentCentroids=o.clone();return r._fitState.isFinished?(r.centroids=r._fitState.bestCentroids.arraySync(),r._fitState={isFinished:!0},t&&t(1,r)):t&&t((r._fitState.currentRestart+r._fitState.currentIteration/r.maxIterations)/r.maxRestarts,r),r})}fit(e,t){let r=this;for(r._fitState=null;!r._fitState||!r._fitState.isFinished;)r.fitStep(e,t);return r}predict(e,t){let r=this;return Kh(e)&&(e=e.arraySync()),k2(e)&&(e=e.values),os(Hh(e),"`x` must be a matrix!"),t=t||r.centroids,Kh(t)&&(t=t.arraySync()),os(Hh(t)||S2(t),"`centroids` must be a matrix or undefined!"),os(jm(e)[1]===jm(t)[1],"`x` and `centroids` must have the same number of columns!"),Za.tidy(()=>{let a=Za.tensor(e).expandDims(1),i=Za.tensor(t).expandDims(0);return a.sub(i).pow(2).sum(2).argMin(1).arraySync()})}score(e,t){let r=this;return Kh(e)&&(e=e.arraySync()),k2(e)&&(e=e.values),os(Hh(e),"`x` must be a matrix!"),t=t||r.centroids,Kh(t)&&(t=t.arraySync()),os(Hh(t)||S2(t),"`centroids` must be a matrix or undefined!"),os(jm(e)[1]===jm(t)[1],"`x` and `centroids` must have the same number of columns!"),Za.tidy(()=>{let a=Za.tensor(e),i=Za.tensor(t),o=Za.tidy(()=>{let s=r.predict(a,i);return i.gather(s).arraySync()});return-t5(a,o)})}};n5.exports=N2});var C2=Y((tst,a5)=>{var{assert:ert,int:r5,random:E2}=Et(),{isMatrix:trt,tf:pl}=sl(),nrt=T2(),I2=class extends nrt{initializeCentroids(e){ert(trt(e),"`x` must be a matrix!");let t=this;return pl.tidy(()=>{let r=pl.tensor(e),a=[r5(E2()*e.length)];for(;a.length<t.k;){let i=a.map(l=>e[l]),o=pl.tensor(t.predict(e,i),null,"int32"),s=pl.tidy(()=>pl.tensor(i).gather(o).sub(r).pow(2).sum(1)),u=s.div(s.max()).arraySync(),c=0;for(let l=0;l<1e4;l++){c=r5(E2()*u.length);let f=u[c];if(E2()<f)break}a.push(c)}return pl.tensor(a.map(i=>e[i]))})}};a5.exports=I2});var s5=Y((nst,o5)=>{var{assert:rrt,isEqual:art,shape:i5}=Et(),{KMeansMeta:irt}=x2().KMeans,{isTFTensor:ort}=sl(),srt=C2(),A2=class extends irt{constructor(e){super(e);let t=this;e=e||{},t.modelClass=e.modelClass||srt}get centroids(){let e=this;return e.fittedModel?e.fittedModel.centroids:e._fitState.bestCentroids}set centroids(e){let t=this;ort(e)&&(e=e.arraySync());let r=i5(e);if(t.centroids){let a=t.centroids,i=i5(a);rrt(art(r,i),`The new centroids must have the same shape as the old centroids! (expected: [${i.join(", ")}], received: [${r.join(", ")}])`)}t.fittedModel||(t.fittedModel=new t.modelClass({k:r[0],maxIterations:t.maxIterations,maxRestarts:t.maxRestarts,tolerance:t.tolerance})),t.fittedModel.centroids=e}};o5.exports=A2});var c5=Y((rst,u5)=>{u5.exports={TFKMeansMeta:s5(),TFKMeansNaive:T2(),TFKMeansPlusPlus:C2()}});var urt=Y((ast,_2)=>{var l5={helpers:sl(),metrics:Bk(),models:c5()};typeof _2<"u"&&(_2.exports=l5);typeof window<"u"&&(window.TFKMeans=l5)});urt();})();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/** @license See the LICENSE file. */
